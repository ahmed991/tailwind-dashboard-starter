var sj=Object.defineProperty;var lj=(e,n,l)=>n in e?sj(e,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[n]=l;var q1=(e,n,l)=>lj(e,typeof n!="symbol"?n+"":n,l);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))u(y);new MutationObserver(y=>{for(const b of y)if(b.type==="childList")for(const I of b.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&u(I)}).observe(document,{childList:!0,subtree:!0});function l(y){const b={};return y.integrity&&(b.integrity=y.integrity),y.referrerPolicy&&(b.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?b.credentials="include":y.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function u(y){if(y.ep)return;y.ep=!0;const b=l(y);fetch(y.href,b)}})();function Bs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var W1={exports:{}},V_={},H1={exports:{}},Ci={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xP;function cj(){if(xP)return Ci;xP=1;var e=Symbol.for("react.element"),n=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),u=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),b=Symbol.for("react.provider"),I=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),k=Symbol.for("react.memo"),L=Symbol.for("react.lazy"),$=Symbol.iterator;function q(ot){return ot===null||typeof ot!="object"?null:(ot=$&&ot[$]||ot["@@iterator"],typeof ot=="function"?ot:null)}var Z={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ie=Object.assign,oe={};function le(ot,St,Ur){this.props=ot,this.context=St,this.refs=oe,this.updater=Ur||Z}le.prototype.isReactComponent={},le.prototype.setState=function(ot,St){if(typeof ot!="object"&&typeof ot!="function"&&ot!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ot,St,"setState")},le.prototype.forceUpdate=function(ot){this.updater.enqueueForceUpdate(this,ot,"forceUpdate")};function xe(){}xe.prototype=le.prototype;function ge(ot,St,Ur){this.props=ot,this.context=St,this.refs=oe,this.updater=Ur||Z}var ke=ge.prototype=new xe;ke.constructor=ge,ie(ke,le.prototype),ke.isPureReactComponent=!0;var et=Array.isArray,ze=Object.prototype.hasOwnProperty,nt={current:null},pt={key:!0,ref:!0,__self:!0,__source:!0};function Gt(ot,St,Ur){var gn,Sr={},kr=null,Vr=null;if(St!=null)for(gn in St.ref!==void 0&&(Vr=St.ref),St.key!==void 0&&(kr=""+St.key),St)ze.call(St,gn)&&!pt.hasOwnProperty(gn)&&(Sr[gn]=St[gn]);var wn=arguments.length-2;if(wn===1)Sr.children=Ur;else if(1<wn){for(var Nt=Array(wn),Qr=0;Qr<wn;Qr++)Nt[Qr]=arguments[Qr+2];Sr.children=Nt}if(ot&&ot.defaultProps)for(gn in wn=ot.defaultProps,wn)Sr[gn]===void 0&&(Sr[gn]=wn[gn]);return{$$typeof:e,type:ot,key:kr,ref:Vr,props:Sr,_owner:nt.current}}function ir(ot,St){return{$$typeof:e,type:ot.type,key:St,ref:ot.ref,props:ot.props,_owner:ot._owner}}function Br(ot){return typeof ot=="object"&&ot!==null&&ot.$$typeof===e}function Zt(ot){var St={"=":"=0",":":"=2"};return"$"+ot.replace(/[=:]/g,function(Ur){return St[Ur]})}var dr=/\/+/g;function Dr(ot,St){return typeof ot=="object"&&ot!==null&&ot.key!=null?Zt(""+ot.key):St.toString(36)}function vr(ot,St,Ur,gn,Sr){var kr=typeof ot;(kr==="undefined"||kr==="boolean")&&(ot=null);var Vr=!1;if(ot===null)Vr=!0;else switch(kr){case"string":case"number":Vr=!0;break;case"object":switch(ot.$$typeof){case e:case n:Vr=!0}}if(Vr)return Vr=ot,Sr=Sr(Vr),ot=gn===""?"."+Dr(Vr,0):gn,et(Sr)?(Ur="",ot!=null&&(Ur=ot.replace(dr,"$&/")+"/"),vr(Sr,St,Ur,"",function(Qr){return Qr})):Sr!=null&&(Br(Sr)&&(Sr=ir(Sr,Ur+(!Sr.key||Vr&&Vr.key===Sr.key?"":(""+Sr.key).replace(dr,"$&/")+"/")+ot)),St.push(Sr)),1;if(Vr=0,gn=gn===""?".":gn+":",et(ot))for(var wn=0;wn<ot.length;wn++){kr=ot[wn];var Nt=gn+Dr(kr,wn);Vr+=vr(kr,St,Ur,Nt,Sr)}else if(Nt=q(ot),typeof Nt=="function")for(ot=Nt.call(ot),wn=0;!(kr=ot.next()).done;)kr=kr.value,Nt=gn+Dr(kr,wn++),Vr+=vr(kr,St,Ur,Nt,Sr);else if(kr==="object")throw St=String(ot),Error("Objects are not valid as a React child (found: "+(St==="[object Object]"?"object with keys {"+Object.keys(ot).join(", ")+"}":St)+"). If you meant to render a collection of children, use an array instead.");return Vr}function Ar(ot,St,Ur){if(ot==null)return ot;var gn=[],Sr=0;return vr(ot,gn,"","",function(kr){return St.call(Ur,kr,Sr++)}),gn}function zr(ot){if(ot._status===-1){var St=ot._result;St=St(),St.then(function(Ur){(ot._status===0||ot._status===-1)&&(ot._status=1,ot._result=Ur)},function(Ur){(ot._status===0||ot._status===-1)&&(ot._status=2,ot._result=Ur)}),ot._status===-1&&(ot._status=0,ot._result=St)}if(ot._status===1)return ot._result.default;throw ot._result}var qr={current:null},lr={transition:null},br={ReactCurrentDispatcher:qr,ReactCurrentBatchConfig:lr,ReactCurrentOwner:nt};function Ft(){throw Error("act(...) is not supported in production builds of React.")}return Ci.Children={map:Ar,forEach:function(ot,St,Ur){Ar(ot,function(){St.apply(this,arguments)},Ur)},count:function(ot){var St=0;return Ar(ot,function(){St++}),St},toArray:function(ot){return Ar(ot,function(St){return St})||[]},only:function(ot){if(!Br(ot))throw Error("React.Children.only expected to receive a single React element child.");return ot}},Ci.Component=le,Ci.Fragment=l,Ci.Profiler=y,Ci.PureComponent=ge,Ci.StrictMode=u,Ci.Suspense=D,Ci.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=br,Ci.act=Ft,Ci.cloneElement=function(ot,St,Ur){if(ot==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ot+".");var gn=ie({},ot.props),Sr=ot.key,kr=ot.ref,Vr=ot._owner;if(St!=null){if(St.ref!==void 0&&(kr=St.ref,Vr=nt.current),St.key!==void 0&&(Sr=""+St.key),ot.type&&ot.type.defaultProps)var wn=ot.type.defaultProps;for(Nt in St)ze.call(St,Nt)&&!pt.hasOwnProperty(Nt)&&(gn[Nt]=St[Nt]===void 0&&wn!==void 0?wn[Nt]:St[Nt])}var Nt=arguments.length-2;if(Nt===1)gn.children=Ur;else if(1<Nt){wn=Array(Nt);for(var Qr=0;Qr<Nt;Qr++)wn[Qr]=arguments[Qr+2];gn.children=wn}return{$$typeof:e,type:ot.type,key:Sr,ref:kr,props:gn,_owner:Vr}},Ci.createContext=function(ot){return ot={$$typeof:I,_currentValue:ot,_currentValue2:ot,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ot.Provider={$$typeof:b,_context:ot},ot.Consumer=ot},Ci.createElement=Gt,Ci.createFactory=function(ot){var St=Gt.bind(null,ot);return St.type=ot,St},Ci.createRef=function(){return{current:null}},Ci.forwardRef=function(ot){return{$$typeof:o,render:ot}},Ci.isValidElement=Br,Ci.lazy=function(ot){return{$$typeof:L,_payload:{_status:-1,_result:ot},_init:zr}},Ci.memo=function(ot,St){return{$$typeof:k,type:ot,compare:St===void 0?null:St}},Ci.startTransition=function(ot){var St=lr.transition;lr.transition={};try{ot()}finally{lr.transition=St}},Ci.unstable_act=Ft,Ci.useCallback=function(ot,St){return qr.current.useCallback(ot,St)},Ci.useContext=function(ot){return qr.current.useContext(ot)},Ci.useDebugValue=function(){},Ci.useDeferredValue=function(ot){return qr.current.useDeferredValue(ot)},Ci.useEffect=function(ot,St){return qr.current.useEffect(ot,St)},Ci.useId=function(){return qr.current.useId()},Ci.useImperativeHandle=function(ot,St,Ur){return qr.current.useImperativeHandle(ot,St,Ur)},Ci.useInsertionEffect=function(ot,St){return qr.current.useInsertionEffect(ot,St)},Ci.useLayoutEffect=function(ot,St){return qr.current.useLayoutEffect(ot,St)},Ci.useMemo=function(ot,St){return qr.current.useMemo(ot,St)},Ci.useReducer=function(ot,St,Ur){return qr.current.useReducer(ot,St,Ur)},Ci.useRef=function(ot){return qr.current.useRef(ot)},Ci.useState=function(ot){return qr.current.useState(ot)},Ci.useSyncExternalStore=function(ot,St,Ur){return qr.current.useSyncExternalStore(ot,St,Ur)},Ci.useTransition=function(){return qr.current.useTransition()},Ci.version="18.3.1",Ci}var bP;function jg(){return bP||(bP=1,H1.exports=cj()),H1.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wP;function uj(){if(wP)return V_;wP=1;var e=jg(),n=Symbol.for("react.element"),l=Symbol.for("react.fragment"),u=Object.prototype.hasOwnProperty,y=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,b={key:!0,ref:!0,__self:!0,__source:!0};function I(o,D,k){var L,$={},q=null,Z=null;k!==void 0&&(q=""+k),D.key!==void 0&&(q=""+D.key),D.ref!==void 0&&(Z=D.ref);for(L in D)u.call(D,L)&&!b.hasOwnProperty(L)&&($[L]=D[L]);if(o&&o.defaultProps)for(L in D=o.defaultProps,D)$[L]===void 0&&($[L]=D[L]);return{$$typeof:n,type:o,key:q,ref:Z,props:$,_owner:y.current}}return V_.Fragment=l,V_.jsx=I,V_.jsxs=I,V_}var SP;function hj(){return SP||(SP=1,W1.exports=uj()),W1.exports}var Me=hj(),Ae=jg();const dj=Bs(Ae);var Dv={},Z1={exports:{}},Bl={},X1={exports:{}},Y1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TP;function fj(){return TP||(TP=1,function(e){function n(lr,br){var Ft=lr.length;lr.push(br);e:for(;0<Ft;){var ot=Ft-1>>>1,St=lr[ot];if(0<y(St,br))lr[ot]=br,lr[Ft]=St,Ft=ot;else break e}}function l(lr){return lr.length===0?null:lr[0]}function u(lr){if(lr.length===0)return null;var br=lr[0],Ft=lr.pop();if(Ft!==br){lr[0]=Ft;e:for(var ot=0,St=lr.length,Ur=St>>>1;ot<Ur;){var gn=2*(ot+1)-1,Sr=lr[gn],kr=gn+1,Vr=lr[kr];if(0>y(Sr,Ft))kr<St&&0>y(Vr,Sr)?(lr[ot]=Vr,lr[kr]=Ft,ot=kr):(lr[ot]=Sr,lr[gn]=Ft,ot=gn);else if(kr<St&&0>y(Vr,Ft))lr[ot]=Vr,lr[kr]=Ft,ot=kr;else break e}}return br}function y(lr,br){var Ft=lr.sortIndex-br.sortIndex;return Ft!==0?Ft:lr.id-br.id}if(typeof performance=="object"&&typeof performance.now=="function"){var b=performance;e.unstable_now=function(){return b.now()}}else{var I=Date,o=I.now();e.unstable_now=function(){return I.now()-o}}var D=[],k=[],L=1,$=null,q=3,Z=!1,ie=!1,oe=!1,le=typeof setTimeout=="function"?setTimeout:null,xe=typeof clearTimeout=="function"?clearTimeout:null,ge=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ke(lr){for(var br=l(k);br!==null;){if(br.callback===null)u(k);else if(br.startTime<=lr)u(k),br.sortIndex=br.expirationTime,n(D,br);else break;br=l(k)}}function et(lr){if(oe=!1,ke(lr),!ie)if(l(D)!==null)ie=!0,zr(ze);else{var br=l(k);br!==null&&qr(et,br.startTime-lr)}}function ze(lr,br){ie=!1,oe&&(oe=!1,xe(Gt),Gt=-1),Z=!0;var Ft=q;try{for(ke(br),$=l(D);$!==null&&(!($.expirationTime>br)||lr&&!Zt());){var ot=$.callback;if(typeof ot=="function"){$.callback=null,q=$.priorityLevel;var St=ot($.expirationTime<=br);br=e.unstable_now(),typeof St=="function"?$.callback=St:$===l(D)&&u(D),ke(br)}else u(D);$=l(D)}if($!==null)var Ur=!0;else{var gn=l(k);gn!==null&&qr(et,gn.startTime-br),Ur=!1}return Ur}finally{$=null,q=Ft,Z=!1}}var nt=!1,pt=null,Gt=-1,ir=5,Br=-1;function Zt(){return!(e.unstable_now()-Br<ir)}function dr(){if(pt!==null){var lr=e.unstable_now();Br=lr;var br=!0;try{br=pt(!0,lr)}finally{br?Dr():(nt=!1,pt=null)}}else nt=!1}var Dr;if(typeof ge=="function")Dr=function(){ge(dr)};else if(typeof MessageChannel<"u"){var vr=new MessageChannel,Ar=vr.port2;vr.port1.onmessage=dr,Dr=function(){Ar.postMessage(null)}}else Dr=function(){le(dr,0)};function zr(lr){pt=lr,nt||(nt=!0,Dr())}function qr(lr,br){Gt=le(function(){lr(e.unstable_now())},br)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(lr){lr.callback=null},e.unstable_continueExecution=function(){ie||Z||(ie=!0,zr(ze))},e.unstable_forceFrameRate=function(lr){0>lr||125<lr?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ir=0<lr?Math.floor(1e3/lr):5},e.unstable_getCurrentPriorityLevel=function(){return q},e.unstable_getFirstCallbackNode=function(){return l(D)},e.unstable_next=function(lr){switch(q){case 1:case 2:case 3:var br=3;break;default:br=q}var Ft=q;q=br;try{return lr()}finally{q=Ft}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(lr,br){switch(lr){case 1:case 2:case 3:case 4:case 5:break;default:lr=3}var Ft=q;q=lr;try{return br()}finally{q=Ft}},e.unstable_scheduleCallback=function(lr,br,Ft){var ot=e.unstable_now();switch(typeof Ft=="object"&&Ft!==null?(Ft=Ft.delay,Ft=typeof Ft=="number"&&0<Ft?ot+Ft:ot):Ft=ot,lr){case 1:var St=-1;break;case 2:St=250;break;case 5:St=1073741823;break;case 4:St=1e4;break;default:St=5e3}return St=Ft+St,lr={id:L++,callback:br,priorityLevel:lr,startTime:Ft,expirationTime:St,sortIndex:-1},Ft>ot?(lr.sortIndex=Ft,n(k,lr),l(D)===null&&lr===l(k)&&(oe?(xe(Gt),Gt=-1):oe=!0,qr(et,Ft-ot))):(lr.sortIndex=St,n(D,lr),ie||Z||(ie=!0,zr(ze))),lr},e.unstable_shouldYield=Zt,e.unstable_wrapCallback=function(lr){var br=q;return function(){var Ft=q;q=br;try{return lr.apply(this,arguments)}finally{q=Ft}}}}(Y1)),Y1}var EP;function pj(){return EP||(EP=1,X1.exports=fj()),X1.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AP;function mj(){if(AP)return Bl;AP=1;var e=jg(),n=pj();function l(m){for(var v="https://reactjs.org/docs/error-decoder.html?invariant="+m,P=1;P<arguments.length;P++)v+="&args[]="+encodeURIComponent(arguments[P]);return"Minified React error #"+m+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var u=new Set,y={};function b(m,v){I(m,v),I(m+"Capture",v)}function I(m,v){for(y[m]=v,m=0;m<v.length;m++)u.add(v[m])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),D=Object.prototype.hasOwnProperty,k=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,L={},$={};function q(m){return D.call($,m)?!0:D.call(L,m)?!1:k.test(m)?$[m]=!0:(L[m]=!0,!1)}function Z(m,v,P,N){if(P!==null&&P.type===0)return!1;switch(typeof v){case"function":case"symbol":return!0;case"boolean":return N?!1:P!==null?!P.acceptsBooleans:(m=m.toLowerCase().slice(0,5),m!=="data-"&&m!=="aria-");default:return!1}}function ie(m,v,P,N){if(v===null||typeof v>"u"||Z(m,v,P,N))return!0;if(N)return!1;if(P!==null)switch(P.type){case 3:return!v;case 4:return v===!1;case 5:return isNaN(v);case 6:return isNaN(v)||1>v}return!1}function oe(m,v,P,N,W,ee,be){this.acceptsBooleans=v===2||v===3||v===4,this.attributeName=N,this.attributeNamespace=W,this.mustUseProperty=P,this.propertyName=m,this.type=v,this.sanitizeURL=ee,this.removeEmptyString=be}var le={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(m){le[m]=new oe(m,0,!1,m,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(m){var v=m[0];le[v]=new oe(v,1,!1,m[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(m){le[m]=new oe(m,2,!1,m.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(m){le[m]=new oe(m,2,!1,m,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(m){le[m]=new oe(m,3,!1,m.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(m){le[m]=new oe(m,3,!0,m,null,!1,!1)}),["capture","download"].forEach(function(m){le[m]=new oe(m,4,!1,m,null,!1,!1)}),["cols","rows","size","span"].forEach(function(m){le[m]=new oe(m,6,!1,m,null,!1,!1)}),["rowSpan","start"].forEach(function(m){le[m]=new oe(m,5,!1,m.toLowerCase(),null,!1,!1)});var xe=/[\-:]([a-z])/g;function ge(m){return m[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(m){var v=m.replace(xe,ge);le[v]=new oe(v,1,!1,m,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(m){var v=m.replace(xe,ge);le[v]=new oe(v,1,!1,m,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(m){var v=m.replace(xe,ge);le[v]=new oe(v,1,!1,m,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(m){le[m]=new oe(m,1,!1,m.toLowerCase(),null,!1,!1)}),le.xlinkHref=new oe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(m){le[m]=new oe(m,1,!1,m.toLowerCase(),null,!0,!0)});function ke(m,v,P,N){var W=le.hasOwnProperty(v)?le[v]:null;(W!==null?W.type!==0:N||!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(ie(v,P,W,N)&&(P=null),N||W===null?q(v)&&(P===null?m.removeAttribute(v):m.setAttribute(v,""+P)):W.mustUseProperty?m[W.propertyName]=P===null?W.type===3?!1:"":P:(v=W.attributeName,N=W.attributeNamespace,P===null?m.removeAttribute(v):(W=W.type,P=W===3||W===4&&P===!0?"":""+P,N?m.setAttributeNS(N,v,P):m.setAttribute(v,P))))}var et=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ze=Symbol.for("react.element"),nt=Symbol.for("react.portal"),pt=Symbol.for("react.fragment"),Gt=Symbol.for("react.strict_mode"),ir=Symbol.for("react.profiler"),Br=Symbol.for("react.provider"),Zt=Symbol.for("react.context"),dr=Symbol.for("react.forward_ref"),Dr=Symbol.for("react.suspense"),vr=Symbol.for("react.suspense_list"),Ar=Symbol.for("react.memo"),zr=Symbol.for("react.lazy"),qr=Symbol.for("react.offscreen"),lr=Symbol.iterator;function br(m){return m===null||typeof m!="object"?null:(m=lr&&m[lr]||m["@@iterator"],typeof m=="function"?m:null)}var Ft=Object.assign,ot;function St(m){if(ot===void 0)try{throw Error()}catch(P){var v=P.stack.trim().match(/\n( *(at )?)/);ot=v&&v[1]||""}return`
`+ot+m}var Ur=!1;function gn(m,v){if(!m||Ur)return"";Ur=!0;var P=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(v)if(v=function(){throw Error()},Object.defineProperty(v.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(v,[])}catch(kt){var N=kt}Reflect.construct(m,[],v)}else{try{v.call()}catch(kt){N=kt}m.call(v.prototype)}else{try{throw Error()}catch(kt){N=kt}m()}}catch(kt){if(kt&&N&&typeof kt.stack=="string"){for(var W=kt.stack.split(`
`),ee=N.stack.split(`
`),be=W.length-1,Ge=ee.length-1;1<=be&&0<=Ge&&W[be]!==ee[Ge];)Ge--;for(;1<=be&&0<=Ge;be--,Ge--)if(W[be]!==ee[Ge]){if(be!==1||Ge!==1)do if(be--,Ge--,0>Ge||W[be]!==ee[Ge]){var rt=`
`+W[be].replace(" at new "," at ");return m.displayName&&rt.includes("<anonymous>")&&(rt=rt.replace("<anonymous>",m.displayName)),rt}while(1<=be&&0<=Ge);break}}}finally{Ur=!1,Error.prepareStackTrace=P}return(m=m?m.displayName||m.name:"")?St(m):""}function Sr(m){switch(m.tag){case 5:return St(m.type);case 16:return St("Lazy");case 13:return St("Suspense");case 19:return St("SuspenseList");case 0:case 2:case 15:return m=gn(m.type,!1),m;case 11:return m=gn(m.type.render,!1),m;case 1:return m=gn(m.type,!0),m;default:return""}}function kr(m){if(m==null)return null;if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m;switch(m){case pt:return"Fragment";case nt:return"Portal";case ir:return"Profiler";case Gt:return"StrictMode";case Dr:return"Suspense";case vr:return"SuspenseList"}if(typeof m=="object")switch(m.$$typeof){case Zt:return(m.displayName||"Context")+".Consumer";case Br:return(m._context.displayName||"Context")+".Provider";case dr:var v=m.render;return m=m.displayName,m||(m=v.displayName||v.name||"",m=m!==""?"ForwardRef("+m+")":"ForwardRef"),m;case Ar:return v=m.displayName||null,v!==null?v:kr(m.type)||"Memo";case zr:v=m._payload,m=m._init;try{return kr(m(v))}catch{}}return null}function Vr(m){var v=m.type;switch(m.tag){case 24:return"Cache";case 9:return(v.displayName||"Context")+".Consumer";case 10:return(v._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return m=v.render,m=m.displayName||m.name||"",v.displayName||(m!==""?"ForwardRef("+m+")":"ForwardRef");case 7:return"Fragment";case 5:return v;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return kr(v);case 8:return v===Gt?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v}return null}function wn(m){switch(typeof m){case"boolean":case"number":case"string":case"undefined":return m;case"object":return m;default:return""}}function Nt(m){var v=m.type;return(m=m.nodeName)&&m.toLowerCase()==="input"&&(v==="checkbox"||v==="radio")}function Qr(m){var v=Nt(m)?"checked":"value",P=Object.getOwnPropertyDescriptor(m.constructor.prototype,v),N=""+m[v];if(!m.hasOwnProperty(v)&&typeof P<"u"&&typeof P.get=="function"&&typeof P.set=="function"){var W=P.get,ee=P.set;return Object.defineProperty(m,v,{configurable:!0,get:function(){return W.call(this)},set:function(be){N=""+be,ee.call(this,be)}}),Object.defineProperty(m,v,{enumerable:P.enumerable}),{getValue:function(){return N},setValue:function(be){N=""+be},stopTracking:function(){m._valueTracker=null,delete m[v]}}}}function Tn(m){m._valueTracker||(m._valueTracker=Qr(m))}function Kt(m){if(!m)return!1;var v=m._valueTracker;if(!v)return!0;var P=v.getValue(),N="";return m&&(N=Nt(m)?m.checked?"true":"false":m.value),m=N,m!==P?(v.setValue(m),!0):!1}function We(m){if(m=m||(typeof document<"u"?document:void 0),typeof m>"u")return null;try{return m.activeElement||m.body}catch{return m.body}}function fr(m,v){var P=v.checked;return Ft({},v,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:P??m._wrapperState.initialChecked})}function jr(m,v){var P=v.defaultValue==null?"":v.defaultValue,N=v.checked!=null?v.checked:v.defaultChecked;P=wn(v.value!=null?v.value:P),m._wrapperState={initialChecked:N,initialValue:P,controlled:v.type==="checkbox"||v.type==="radio"?v.checked!=null:v.value!=null}}function mr(m,v){v=v.checked,v!=null&&ke(m,"checked",v,!1)}function en(m,v){mr(m,v);var P=wn(v.value),N=v.type;if(P!=null)N==="number"?(P===0&&m.value===""||m.value!=P)&&(m.value=""+P):m.value!==""+P&&(m.value=""+P);else if(N==="submit"||N==="reset"){m.removeAttribute("value");return}v.hasOwnProperty("value")?Oi(m,v.type,P):v.hasOwnProperty("defaultValue")&&Oi(m,v.type,wn(v.defaultValue)),v.checked==null&&v.defaultChecked!=null&&(m.defaultChecked=!!v.defaultChecked)}function uo(m,v,P){if(v.hasOwnProperty("value")||v.hasOwnProperty("defaultValue")){var N=v.type;if(!(N!=="submit"&&N!=="reset"||v.value!==void 0&&v.value!==null))return;v=""+m._wrapperState.initialValue,P||v===m.value||(m.value=v),m.defaultValue=v}P=m.name,P!==""&&(m.name=""),m.defaultChecked=!!m._wrapperState.initialChecked,P!==""&&(m.name=P)}function Oi(m,v,P){(v!=="number"||We(m.ownerDocument)!==m)&&(P==null?m.defaultValue=""+m._wrapperState.initialValue:m.defaultValue!==""+P&&(m.defaultValue=""+P))}var Di=Array.isArray;function ii(m,v,P,N){if(m=m.options,v){v={};for(var W=0;W<P.length;W++)v["$"+P[W]]=!0;for(P=0;P<m.length;P++)W=v.hasOwnProperty("$"+m[P].value),m[P].selected!==W&&(m[P].selected=W),W&&N&&(m[P].defaultSelected=!0)}else{for(P=""+wn(P),v=null,W=0;W<m.length;W++){if(m[W].value===P){m[W].selected=!0,N&&(m[W].defaultSelected=!0);return}v!==null||m[W].disabled||(v=m[W])}v!==null&&(v.selected=!0)}}function ti(m,v){if(v.dangerouslySetInnerHTML!=null)throw Error(l(91));return Ft({},v,{value:void 0,defaultValue:void 0,children:""+m._wrapperState.initialValue})}function $i(m,v){var P=v.value;if(P==null){if(P=v.children,v=v.defaultValue,P!=null){if(v!=null)throw Error(l(92));if(Di(P)){if(1<P.length)throw Error(l(93));P=P[0]}v=P}v==null&&(v=""),P=v}m._wrapperState={initialValue:wn(P)}}function Zn(m,v){var P=wn(v.value),N=wn(v.defaultValue);P!=null&&(P=""+P,P!==m.value&&(m.value=P),v.defaultValue==null&&m.defaultValue!==P&&(m.defaultValue=P)),N!=null&&(m.defaultValue=""+N)}function Ii(m){var v=m.textContent;v===m._wrapperState.initialValue&&v!==""&&v!==null&&(m.value=v)}function ci(m){switch(m){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Co(m,v){return m==null||m==="http://www.w3.org/1999/xhtml"?ci(v):m==="http://www.w3.org/2000/svg"&&v==="foreignObject"?"http://www.w3.org/1999/xhtml":m}var Ka,oa=function(m){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(v,P,N,W){MSApp.execUnsafeLocalFunction(function(){return m(v,P,N,W)})}:m}(function(m,v){if(m.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in m)m.innerHTML=v;else{for(Ka=Ka||document.createElement("div"),Ka.innerHTML="<svg>"+v.valueOf().toString()+"</svg>",v=Ka.firstChild;m.firstChild;)m.removeChild(m.firstChild);for(;v.firstChild;)m.appendChild(v.firstChild)}});function ta(m,v){if(v){var P=m.firstChild;if(P&&P===m.lastChild&&P.nodeType===3){P.nodeValue=v;return}}m.textContent=v}var ho={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},js=["Webkit","ms","Moz","O"];Object.keys(ho).forEach(function(m){js.forEach(function(v){v=v+m.charAt(0).toUpperCase()+m.substring(1),ho[v]=ho[m]})});function fa(m,v,P){return v==null||typeof v=="boolean"||v===""?"":P||typeof v!="number"||v===0||ho.hasOwnProperty(m)&&ho[m]?(""+v).trim():v+"px"}function pa(m,v){m=m.style;for(var P in v)if(v.hasOwnProperty(P)){var N=P.indexOf("--")===0,W=fa(P,v[P],N);P==="float"&&(P="cssFloat"),N?m.setProperty(P,W):m[P]=W}}var un=Ft({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function zn(m,v){if(v){if(un[m]&&(v.children!=null||v.dangerouslySetInnerHTML!=null))throw Error(l(137,m));if(v.dangerouslySetInnerHTML!=null){if(v.children!=null)throw Error(l(60));if(typeof v.dangerouslySetInnerHTML!="object"||!("__html"in v.dangerouslySetInnerHTML))throw Error(l(61))}if(v.style!=null&&typeof v.style!="object")throw Error(l(62))}}function Cn(m,v){if(m.indexOf("-")===-1)return typeof v.is=="string";switch(m){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Fr=null;function Bn(m){return m=m.target||m.srcElement||window,m.correspondingUseElement&&(m=m.correspondingUseElement),m.nodeType===3?m.parentNode:m}var oi=null,An=null,Nn=null;function Xn(m){if(m=Ru(m)){if(typeof oi!="function")throw Error(l(280));var v=m.stateNode;v&&(v=kh(v),oi(m.stateNode,m.type,v))}}function ki(m){An?Nn?Nn.push(m):Nn=[m]:An=m}function Dt(){if(An){var m=An,v=Nn;if(Nn=An=null,Xn(m),v)for(m=0;m<v.length;m++)Xn(v[m])}}function mi(m,v){return m(v)}function Ki(){}var Qe=!1;function Q(m,v,P){if(Qe)return m(v,P);Qe=!0;try{return mi(m,v,P)}finally{Qe=!1,(An!==null||Nn!==null)&&(Ki(),Dt())}}function ae(m,v){var P=m.stateNode;if(P===null)return null;var N=kh(P);if(N===null)return null;P=N[v];e:switch(v){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(N=!N.disabled)||(m=m.type,N=!(m==="button"||m==="input"||m==="select"||m==="textarea")),m=!N;break e;default:m=!1}if(m)return null;if(P&&typeof P!="function")throw Error(l(231,v,typeof P));return P}var Se=!1;if(o)try{var De={};Object.defineProperty(De,"passive",{get:function(){Se=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch{Se=!1}function Pe(m,v,P,N,W,ee,be,Ge,rt){var kt=Array.prototype.slice.call(arguments,3);try{v.apply(P,kt)}catch(pr){this.onError(pr)}}var Le=!1,Fe=null,Be=!1,Ye=null,ht={onError:function(m){Le=!0,Fe=m}};function Ze(m,v,P,N,W,ee,be,Ge,rt){Le=!1,Fe=null,Pe.apply(ht,arguments)}function Lt(m,v,P,N,W,ee,be,Ge,rt){if(Ze.apply(this,arguments),Le){if(Le){var kt=Fe;Le=!1,Fe=null}else throw Error(l(198));Be||(Be=!0,Ye=kt)}}function Vt(m){var v=m,P=m;if(m.alternate)for(;v.return;)v=v.return;else{m=v;do v=m,(v.flags&4098)!==0&&(P=v.return),m=v.return;while(m)}return v.tag===3?P:null}function Ot(m){if(m.tag===13){var v=m.memoizedState;if(v===null&&(m=m.alternate,m!==null&&(v=m.memoizedState)),v!==null)return v.dehydrated}return null}function gr(m){if(Vt(m)!==m)throw Error(l(188))}function wr(m){var v=m.alternate;if(!v){if(v=Vt(m),v===null)throw Error(l(188));return v!==m?null:m}for(var P=m,N=v;;){var W=P.return;if(W===null)break;var ee=W.alternate;if(ee===null){if(N=W.return,N!==null){P=N;continue}break}if(W.child===ee.child){for(ee=W.child;ee;){if(ee===P)return gr(W),m;if(ee===N)return gr(W),v;ee=ee.sibling}throw Error(l(188))}if(P.return!==N.return)P=W,N=ee;else{for(var be=!1,Ge=W.child;Ge;){if(Ge===P){be=!0,P=W,N=ee;break}if(Ge===N){be=!0,N=W,P=ee;break}Ge=Ge.sibling}if(!be){for(Ge=ee.child;Ge;){if(Ge===P){be=!0,P=ee,N=W;break}if(Ge===N){be=!0,N=ee,P=W;break}Ge=Ge.sibling}if(!be)throw Error(l(189))}}if(P.alternate!==N)throw Error(l(190))}if(P.tag!==3)throw Error(l(188));return P.stateNode.current===P?m:v}function Mr(m){return m=wr(m),m!==null?Nr(m):null}function Nr(m){if(m.tag===5||m.tag===6)return m;for(m=m.child;m!==null;){var v=Nr(m);if(v!==null)return v;m=m.sibling}return null}var ui=n.unstable_scheduleCallback,tn=n.unstable_cancelCallback,Jn=n.unstable_shouldYield,Rn=n.unstable_requestPaint,hn=n.unstable_now,li=n.unstable_getCurrentPriorityLevel,ji=n.unstable_ImmediatePriority,oo=n.unstable_UserBlockingPriority,fo=n.unstable_NormalPriority,Ho=n.unstable_LowPriority,sl=n.unstable_IdlePriority,ko=null,eo=null;function Ro(m){if(eo&&typeof eo.onCommitFiberRoot=="function")try{eo.onCommitFiberRoot(ko,m,void 0,(m.current.flags&128)===128)}catch{}}var Wi=Math.clz32?Math.clz32:dd,ll=Math.log,_u=Math.LN2;function dd(m){return m>>>=0,m===0?32:31-(ll(m)/_u|0)|0}var Hl=64,yu=4194304;function Zl(m){switch(m&-m){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return m&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return m}}function cl(m,v){var P=m.pendingLanes;if(P===0)return 0;var N=0,W=m.suspendedLanes,ee=m.pingedLanes,be=P&268435455;if(be!==0){var Ge=be&~W;Ge!==0?N=Zl(Ge):(ee&=be,ee!==0&&(N=Zl(ee)))}else be=P&~W,be!==0?N=Zl(be):ee!==0&&(N=Zl(ee));if(N===0)return 0;if(v!==0&&v!==N&&(v&W)===0&&(W=N&-N,ee=v&-v,W>=ee||W===16&&(ee&4194240)!==0))return v;if((N&4)!==0&&(N|=P&16),v=m.entangledLanes,v!==0)for(m=m.entanglements,v&=N;0<v;)P=31-Wi(v),W=1<<P,N|=m[P],v&=~W;return N}function fd(m,v){switch(m){case 1:case 2:case 4:return v+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Cp(m,v){for(var P=m.suspendedLanes,N=m.pingedLanes,W=m.expirationTimes,ee=m.pendingLanes;0<ee;){var be=31-Wi(ee),Ge=1<<be,rt=W[be];rt===-1?((Ge&P)===0||(Ge&N)!==0)&&(W[be]=fd(Ge,v)):rt<=v&&(m.expiredLanes|=Ge),ee&=~Ge}}function Ja(m){return m=m.pendingLanes&-1073741825,m!==0?m:m&1073741824?1073741824:0}function yf(){var m=Hl;return Hl<<=1,(Hl&4194240)===0&&(Hl=64),m}function ma(m){for(var v=[],P=0;31>P;P++)v.push(m);return v}function Pa(m,v,P){m.pendingLanes|=v,v!==536870912&&(m.suspendedLanes=0,m.pingedLanes=0),m=m.eventTimes,v=31-Wi(v),m[v]=P}function Xl(m,v){var P=m.pendingLanes&~v;m.pendingLanes=v,m.suspendedLanes=0,m.pingedLanes=0,m.expiredLanes&=v,m.mutableReadLanes&=v,m.entangledLanes&=v,v=m.entanglements;var N=m.eventTimes;for(m=m.expirationTimes;0<P;){var W=31-Wi(P),ee=1<<W;v[W]=0,N[W]=-1,m[W]=-1,P&=~ee}}function Qa(m,v){var P=m.entangledLanes|=v;for(m=m.entanglements;P;){var N=31-Wi(P),W=1<<N;W&v|m[N]&v&&(m[N]|=v),P&=~W}}var hi=0;function es(m){return m&=-m,1<m?4<m?(m&268435455)!==0?16:536870912:4:1}var ch,pd,ul,uh,vf,vu=!1,Zo=[],Us=null,Vs=null,ts=null,hh=new Map,Mc=new Map,$s=[],Mn="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function xu(m,v){switch(m){case"focusin":case"focusout":Us=null;break;case"dragenter":case"dragleave":Vs=null;break;case"mouseover":case"mouseout":ts=null;break;case"pointerover":case"pointerout":hh.delete(v.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mc.delete(v.pointerId)}}function hl(m,v,P,N,W,ee){return m===null||m.nativeEvent!==ee?(m={blockedOn:v,domEventName:P,eventSystemFlags:N,nativeEvent:ee,targetContainers:[W]},v!==null&&(v=Ru(v),v!==null&&pd(v)),m):(m.eventSystemFlags|=N,v=m.targetContainers,W!==null&&v.indexOf(W)===-1&&v.push(W),m)}function Yg(m,v,P,N,W){switch(v){case"focusin":return Us=hl(Us,m,v,P,N,W),!0;case"dragenter":return Vs=hl(Vs,m,v,P,N,W),!0;case"mouseover":return ts=hl(ts,m,v,P,N,W),!0;case"pointerover":var ee=W.pointerId;return hh.set(ee,hl(hh.get(ee)||null,m,v,P,N,W)),!0;case"gotpointercapture":return ee=W.pointerId,Mc.set(ee,hl(Mc.get(ee)||null,m,v,P,N,W)),!0}return!1}function Mp(m){var v=ac(m.target);if(v!==null){var P=Vt(v);if(P!==null){if(v=P.tag,v===13){if(v=Ot(P),v!==null){m.blockedOn=v,vf(m.priority,function(){ul(P)});return}}else if(v===3&&P.stateNode.current.memoizedState.isDehydrated){m.blockedOn=P.tag===3?P.stateNode.containerInfo:null;return}}}m.blockedOn=null}function dl(m){if(m.blockedOn!==null)return!1;for(var v=m.targetContainers;0<v.length;){var P=fl(m.domEventName,m.eventSystemFlags,v[0],m.nativeEvent);if(P===null){P=m.nativeEvent;var N=new P.constructor(P.type,P);Fr=N,P.target.dispatchEvent(N),Fr=null}else return v=Ru(P),v!==null&&pd(v),m.blockedOn=P,!1;v.shift()}return!0}function Yl(m,v,P){dl(m)&&P.delete(v)}function dh(){vu=!1,Us!==null&&dl(Us)&&(Us=null),Vs!==null&&dl(Vs)&&(Vs=null),ts!==null&&dl(ts)&&(ts=null),hh.forEach(Yl),Mc.forEach(Yl)}function fh(m,v){m.blockedOn===v&&(m.blockedOn=null,vu||(vu=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,dh)))}function bu(m){function v(W){return fh(W,m)}if(0<Zo.length){fh(Zo[0],m);for(var P=1;P<Zo.length;P++){var N=Zo[P];N.blockedOn===m&&(N.blockedOn=null)}}for(Us!==null&&fh(Us,m),Vs!==null&&fh(Vs,m),ts!==null&&fh(ts,m),hh.forEach(v),Mc.forEach(v),P=0;P<$s.length;P++)N=$s[P],N.blockedOn===m&&(N.blockedOn=null);for(;0<$s.length&&(P=$s[0],P.blockedOn===null);)Mp(P),P.blockedOn===null&&$s.shift()}var ys=et.ReactCurrentBatchConfig,Oc=!0;function ph(m,v,P,N){var W=hi,ee=ys.transition;ys.transition=null;try{hi=1,md(m,v,P,N)}finally{hi=W,ys.transition=ee}}function xf(m,v,P,N){var W=hi,ee=ys.transition;ys.transition=null;try{hi=4,md(m,v,P,N)}finally{hi=W,ys.transition=ee}}function md(m,v,P,N){if(Oc){var W=fl(m,v,P,N);if(W===null)Np(m,v,N,aa,P),xu(m,N);else if(Yg(W,m,v,P,N))N.stopPropagation();else if(xu(m,N),v&4&&-1<Mn.indexOf(m)){for(;W!==null;){var ee=Ru(W);if(ee!==null&&ch(ee),ee=fl(m,v,P,N),ee===null&&Np(m,v,N,aa,P),ee===W)break;W=ee}W!==null&&N.stopPropagation()}else Np(m,v,N,null,P)}}var aa=null;function fl(m,v,P,N){if(aa=null,m=Bn(N),m=ac(m),m!==null)if(v=Vt(m),v===null)m=null;else if(P=v.tag,P===13){if(m=Ot(v),m!==null)return m;m=null}else if(P===3){if(v.stateNode.current.memoizedState.isDehydrated)return v.tag===3?v.stateNode.containerInfo:null;m=null}else v!==m&&(m=null);return aa=m,null}function bf(m){switch(m){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(li()){case ji:return 1;case oo:return 4;case fo:case Ho:return 16;case sl:return 536870912;default:return 16}default:return 16}}var pl=null,mh=null,ml=null;function Ca(){if(ml)return ml;var m,v=mh,P=v.length,N,W="value"in pl?pl.value:pl.textContent,ee=W.length;for(m=0;m<P&&v[m]===W[m];m++);var be=P-m;for(N=1;N<=be&&v[P-N]===W[ee-N];N++);return ml=W.slice(m,1<N?1-N:void 0)}function gh(m){var v=m.keyCode;return"charCode"in m?(m=m.charCode,m===0&&v===13&&(m=13)):m=v,m===10&&(m=13),32<=m||m===13?m:0}function wu(){return!0}function _h(){return!1}function dn(m){function v(P,N,W,ee,be){this._reactName=P,this._targetInst=W,this.type=N,this.nativeEvent=ee,this.target=be,this.currentTarget=null;for(var Ge in m)m.hasOwnProperty(Ge)&&(P=m[Ge],this[Ge]=P?P(ee):ee[Ge]);return this.isDefaultPrevented=(ee.defaultPrevented!=null?ee.defaultPrevented:ee.returnValue===!1)?wu:_h,this.isPropagationStopped=_h,this}return Ft(v.prototype,{preventDefault:function(){this.defaultPrevented=!0;var P=this.nativeEvent;P&&(P.preventDefault?P.preventDefault():typeof P.returnValue!="unknown"&&(P.returnValue=!1),this.isDefaultPrevented=wu)},stopPropagation:function(){var P=this.nativeEvent;P&&(P.stopPropagation?P.stopPropagation():typeof P.cancelBubble!="unknown"&&(P.cancelBubble=!0),this.isPropagationStopped=wu)},persist:function(){},isPersistent:wu}),v}var Su={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(m){return m.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xr=dn(Su),yh=Ft({},Su,{view:0,detail:0}),wf=dn(yh),vh,Tu,ga,gl=Ft({},yh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kc,button:0,buttons:0,relatedTarget:function(m){return m.relatedTarget===void 0?m.fromElement===m.srcElement?m.toElement:m.fromElement:m.relatedTarget},movementX:function(m){return"movementX"in m?m.movementX:(m!==ga&&(ga&&m.type==="mousemove"?(vh=m.screenX-ga.screenX,Tu=m.screenY-ga.screenY):Tu=vh=0,ga=m),vh)},movementY:function(m){return"movementY"in m?m.movementY:Tu}}),Kl=dn(gl),ur=Ft({},gl,{dataTransfer:0}),Qn=dn(ur),Vn=Ft({},yh,{relatedTarget:0}),sa=dn(Vn),Dc=Ft({},Su,{animationName:0,elapsedTime:0,pseudoElement:0}),jn=dn(Dc),Eu=Ft({},Su,{clipboardData:function(m){return"clipboardData"in m?m.clipboardData:window.clipboardData}}),gd=dn(Eu),_d=Ft({},Su,{data:0}),la=dn(_d),po={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Kg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Op(m){var v=this.nativeEvent;return v.getModifierState?v.getModifierState(m):(m=yd[m])?!!v[m]:!1}function kc(){return Op}var Rc=Ft({},yh,{key:function(m){if(m.key){var v=po[m.key]||m.key;if(v!=="Unidentified")return v}return m.type==="keypress"?(m=gh(m),m===13?"Enter":String.fromCharCode(m)):m.type==="keydown"||m.type==="keyup"?Kg[m.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kc,charCode:function(m){return m.type==="keypress"?gh(m):0},keyCode:function(m){return m.type==="keydown"||m.type==="keyup"?m.keyCode:0},which:function(m){return m.type==="keypress"?gh(m):m.type==="keydown"||m.type==="keyup"?m.keyCode:0}}),Sf=dn(Rc),_a=Ft({},gl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),vs=dn(_a),Ma=Ft({},yh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kc}),Hm=dn(Ma),xh=Ft({},Su,{propertyName:0,elapsedTime:0,pseudoElement:0}),bo=dn(xh),ya=Ft({},gl,{deltaX:function(m){return"deltaX"in m?m.deltaX:"wheelDeltaX"in m?-m.wheelDeltaX:0},deltaY:function(m){return"deltaY"in m?m.deltaY:"wheelDeltaY"in m?-m.wheelDeltaY:"wheelDelta"in m?-m.wheelDelta:0},deltaZ:0,deltaMode:0}),Yr=dn(ya),Jt=[9,13,27,32],Au=o&&"CompositionEvent"in window,Tr=null;o&&"documentMode"in document&&(Tr=document.documentMode);var Iu=o&&"TextEvent"in window&&!Tr,Pu=o&&(!Au||Tr&&8<Tr&&11>=Tr),Pr=" ",Dp=!1;function xs(m,v){switch(m){case"keyup":return Jt.indexOf(v.keyCode)!==-1;case"keydown":return v.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function kp(m){return m=m.detail,typeof m=="object"&&"data"in m?m.data:null}var Jl=!1;function ca(m,v){switch(m){case"compositionend":return kp(v);case"keypress":return v.which!==32?null:(Dp=!0,Pr);case"textInput":return m=v.data,m===Pr&&Dp?null:m;default:return null}}function va(m,v){if(Jl)return m==="compositionend"||!Au&&xs(m,v)?(m=Ca(),ml=mh=pl=null,Jl=!1,m):null;switch(m){case"paste":return null;case"keypress":if(!(v.ctrlKey||v.altKey||v.metaKey)||v.ctrlKey&&v.altKey){if(v.char&&1<v.char.length)return v.char;if(v.which)return String.fromCharCode(v.which)}return null;case"compositionend":return Pu&&v.locale!=="ko"?null:v.data;default:return null}}var bh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ql(m){var v=m&&m.nodeName&&m.nodeName.toLowerCase();return v==="input"?!!bh[m.type]:v==="textarea"}function Lc(m,v,P,N){ki(N),v=Ph(v,"onChange"),0<v.length&&(P=new xr("onChange","change",null,P,N),m.push({event:P,listeners:v}))}var Gs=null,Lo=null;function vd(m){Jm(m,0)}function zc(m){var v=$c(m);if(Kt(v))return m}function Jg(m,v){if(m==="change")return v}var _l=!1;if(o){var xd;if(o){var bs="oninput"in document;if(!bs){var Tf=document.createElement("div");Tf.setAttribute("oninput","return;"),bs=typeof Tf.oninput=="function"}xd=bs}else xd=!1;_l=xd&&(!document.documentMode||9<document.documentMode)}function ec(){Gs&&(Gs.detachEvent("onpropertychange",Zm),Lo=Gs=null)}function Zm(m){if(m.propertyName==="value"&&zc(Lo)){var v=[];Lc(v,Lo,m,Bn(m)),Q(vd,v)}}function Qg(m,v,P){m==="focusin"?(ec(),Gs=v,Lo=P,Gs.attachEvent("onpropertychange",Zm)):m==="focusout"&&ec()}function Xm(m){if(m==="selectionchange"||m==="keyup"||m==="keydown")return zc(Lo)}function Ym(m,v){if(m==="click")return zc(v)}function e_(m,v){if(m==="input"||m==="change")return zc(v)}function Ef(m,v){return m===v&&(m!==0||1/m===1/v)||m!==m&&v!==v}var ws=typeof Object.is=="function"?Object.is:Ef;function Ss(m,v){if(ws(m,v))return!0;if(typeof m!="object"||m===null||typeof v!="object"||v===null)return!1;var P=Object.keys(m),N=Object.keys(v);if(P.length!==N.length)return!1;for(N=0;N<P.length;N++){var W=P[N];if(!D.call(v,W)||!ws(m[W],v[W]))return!1}return!0}function Rp(m){for(;m&&m.firstChild;)m=m.firstChild;return m}function Lp(m,v){var P=Rp(m);m=0;for(var N;P;){if(P.nodeType===3){if(N=m+P.textContent.length,m<=v&&N>=v)return{node:P,offset:v-m};m=N}e:{for(;P;){if(P.nextSibling){P=P.nextSibling;break e}P=P.parentNode}P=void 0}P=Rp(P)}}function yl(m,v){return m&&v?m===v?!0:m&&m.nodeType===3?!1:v&&v.nodeType===3?yl(m,v.parentNode):"contains"in m?m.contains(v):m.compareDocumentPosition?!!(m.compareDocumentPosition(v)&16):!1:!1}function wh(){for(var m=window,v=We();v instanceof m.HTMLIFrameElement;){try{var P=typeof v.contentWindow.location.href=="string"}catch{P=!1}if(P)m=v.contentWindow;else break;v=We(m.document)}return v}function bd(m){var v=m&&m.nodeName&&m.nodeName.toLowerCase();return v&&(v==="input"&&(m.type==="text"||m.type==="search"||m.type==="tel"||m.type==="url"||m.type==="password")||v==="textarea"||m.contentEditable==="true")}function Ts(m){var v=wh(),P=m.focusedElem,N=m.selectionRange;if(v!==P&&P&&P.ownerDocument&&yl(P.ownerDocument.documentElement,P)){if(N!==null&&bd(P)){if(v=N.start,m=N.end,m===void 0&&(m=v),"selectionStart"in P)P.selectionStart=v,P.selectionEnd=Math.min(m,P.value.length);else if(m=(v=P.ownerDocument||document)&&v.defaultView||window,m.getSelection){m=m.getSelection();var W=P.textContent.length,ee=Math.min(N.start,W);N=N.end===void 0?ee:Math.min(N.end,W),!m.extend&&ee>N&&(W=N,N=ee,ee=W),W=Lp(P,ee);var be=Lp(P,N);W&&be&&(m.rangeCount!==1||m.anchorNode!==W.node||m.anchorOffset!==W.offset||m.focusNode!==be.node||m.focusOffset!==be.offset)&&(v=v.createRange(),v.setStart(W.node,W.offset),m.removeAllRanges(),ee>N?(m.addRange(v),m.extend(be.node,be.offset)):(v.setEnd(be.node,be.offset),m.addRange(v)))}}for(v=[],m=P;m=m.parentNode;)m.nodeType===1&&v.push({element:m,left:m.scrollLeft,top:m.scrollTop});for(typeof P.focus=="function"&&P.focus(),P=0;P<v.length;P++)m=v[P],m.element.scrollLeft=m.left,m.element.scrollTop=m.top}}var Sh=o&&"documentMode"in document&&11>=document.documentMode,qs=null,wd=null,Fc=null,Oa=!1;function Sd(m,v,P){var N=P.window===P?P.document:P.nodeType===9?P:P.ownerDocument;Oa||qs==null||qs!==We(N)||(N=qs,"selectionStart"in N&&bd(N)?N={start:N.selectionStart,end:N.selectionEnd}:(N=(N.ownerDocument&&N.ownerDocument.defaultView||window).getSelection(),N={anchorNode:N.anchorNode,anchorOffset:N.anchorOffset,focusNode:N.focusNode,focusOffset:N.focusOffset}),Fc&&Ss(Fc,N)||(Fc=N,N=Ph(wd,"onSelect"),0<N.length&&(v=new xr("onSelect","select",null,v,P),m.push({event:v,listeners:N}),v.target=qs)))}function zt(m,v){var P={};return P[m.toLowerCase()]=v.toLowerCase(),P["Webkit"+m]="webkit"+v,P["Moz"+m]="moz"+v,P}var Nc={animationend:zt("Animation","AnimationEnd"),animationiteration:zt("Animation","AnimationIteration"),animationstart:zt("Animation","AnimationStart"),transitionend:zt("Transition","TransitionEnd")},Th={},Td={};o&&(Td=document.createElement("div").style,"AnimationEvent"in window||(delete Nc.animationend.animation,delete Nc.animationiteration.animation,delete Nc.animationstart.animation),"TransitionEvent"in window||delete Nc.transitionend.transition);function Eh(m){if(Th[m])return Th[m];if(!Nc[m])return m;var v=Nc[m],P;for(P in v)if(v.hasOwnProperty(P)&&P in Td)return Th[m]=v[P];return m}var Bc=Eh("animationend"),rs=Eh("animationiteration"),Cu=Eh("animationstart"),tc=Eh("transitionend"),Ah=new Map,jc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ns(m,v){Ah.set(m,v),b(v,[m])}for(var Sn=0;Sn<jc.length;Sn++){var Ed=jc[Sn],t_=Ed.toLowerCase(),Km=Ed[0].toUpperCase()+Ed.slice(1);ns(t_,"on"+Km)}ns(Bc,"onAnimationEnd"),ns(rs,"onAnimationIteration"),ns(Cu,"onAnimationStart"),ns("dblclick","onDoubleClick"),ns("focusin","onFocus"),ns("focusout","onBlur"),ns(tc,"onTransitionEnd"),I("onMouseEnter",["mouseout","mouseover"]),I("onMouseLeave",["mouseout","mouseover"]),I("onPointerEnter",["pointerout","pointerover"]),I("onPointerLeave",["pointerout","pointerover"]),b("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),b("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),b("onBeforeInput",["compositionend","keypress","textInput","paste"]),b("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),b("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),b("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zp=new Set("cancel close invalid load scroll toggle".split(" ").concat(Mu));function Mi(m,v,P){var N=m.type||"unknown-event";m.currentTarget=P,Lt(N,v,void 0,m),m.currentTarget=null}function Jm(m,v){v=(v&4)!==0;for(var P=0;P<m.length;P++){var N=m[P],W=N.event;N=N.listeners;e:{var ee=void 0;if(v)for(var be=N.length-1;0<=be;be--){var Ge=N[be],rt=Ge.instance,kt=Ge.currentTarget;if(Ge=Ge.listener,rt!==ee&&W.isPropagationStopped())break e;Mi(W,Ge,kt),ee=rt}else for(be=0;be<N.length;be++){if(Ge=N[be],rt=Ge.instance,kt=Ge.currentTarget,Ge=Ge.listener,rt!==ee&&W.isPropagationStopped())break e;Mi(W,Ge,kt),ee=rt}}}if(Be)throw m=Ye,Be=!1,Ye=null,m}function ao(m,v){var P=v[Cd];P===void 0&&(P=v[Cd]=new Set);var N=m+"__bubble";P.has(N)||(Pd(v,m,2,!1),P.add(N))}function Fp(m,v,P){var N=0;v&&(N|=4),Pd(P,m,N,v)}var Ad="_reactListening"+Math.random().toString(36).slice(2);function Id(m){if(!m[Ad]){m[Ad]=!0,u.forEach(function(P){P!=="selectionchange"&&(zp.has(P)||Fp(P,!1,m),Fp(P,!0,m))});var v=m.nodeType===9?m:m.ownerDocument;v===null||v[Ad]||(v[Ad]=!0,Fp("selectionchange",!1,v))}}function Pd(m,v,P,N){switch(bf(v)){case 1:var W=ph;break;case 4:W=xf;break;default:W=md}P=W.bind(null,v,P,m),W=void 0,!Se||v!=="touchstart"&&v!=="touchmove"&&v!=="wheel"||(W=!0),N?W!==void 0?m.addEventListener(v,P,{capture:!0,passive:W}):m.addEventListener(v,P,!0):W!==void 0?m.addEventListener(v,P,{passive:W}):m.addEventListener(v,P,!1)}function Np(m,v,P,N,W){var ee=N;if((v&1)===0&&(v&2)===0&&N!==null)e:for(;;){if(N===null)return;var be=N.tag;if(be===3||be===4){var Ge=N.stateNode.containerInfo;if(Ge===W||Ge.nodeType===8&&Ge.parentNode===W)break;if(be===4)for(be=N.return;be!==null;){var rt=be.tag;if((rt===3||rt===4)&&(rt=be.stateNode.containerInfo,rt===W||rt.nodeType===8&&rt.parentNode===W))return;be=be.return}for(;Ge!==null;){if(be=ac(Ge),be===null)return;if(rt=be.tag,rt===5||rt===6){N=ee=be;continue e}Ge=Ge.parentNode}}N=N.return}Q(function(){var kt=ee,pr=Bn(P),yr=[];e:{var cr=Ah.get(m);if(cr!==void 0){var $r=xr,nn=m;switch(m){case"keypress":if(gh(P)===0)break e;case"keydown":case"keyup":$r=Sf;break;case"focusin":nn="focus",$r=sa;break;case"focusout":nn="blur",$r=sa;break;case"beforeblur":case"afterblur":$r=sa;break;case"click":if(P.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$r=Kl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$r=Qn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$r=Hm;break;case Bc:case rs:case Cu:$r=jn;break;case tc:$r=bo;break;case"scroll":$r=wf;break;case"wheel":$r=Yr;break;case"copy":case"cut":case"paste":$r=gd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$r=vs}var ln=(v&4)!==0,Uo=!ln&&m==="scroll",wt=ln?cr!==null?cr+"Capture":null:cr;ln=[];for(var ut=kt,Tt;ut!==null;){Tt=ut;var ar=Tt.stateNode;if(Tt.tag===5&&ar!==null&&(Tt=ar,wt!==null&&(ar=ae(ut,wt),ar!=null&&ln.push(Ih(ut,ar,Tt)))),Uo)break;ut=ut.return}0<ln.length&&(cr=new $r(cr,nn,null,P,pr),yr.push({event:cr,listeners:ln}))}}if((v&7)===0){e:{if(cr=m==="mouseover"||m==="pointerover",$r=m==="mouseout"||m==="pointerout",cr&&P!==Fr&&(nn=P.relatedTarget||P.fromElement)&&(ac(nn)||nn[oc]))break e;if(($r||cr)&&(cr=pr.window===pr?pr:(cr=pr.ownerDocument)?cr.defaultView||cr.parentWindow:window,$r?(nn=P.relatedTarget||P.toElement,$r=kt,nn=nn?ac(nn):null,nn!==null&&(Uo=Vt(nn),nn!==Uo||nn.tag!==5&&nn.tag!==6)&&(nn=null)):($r=null,nn=kt),$r!==nn)){if(ln=Kl,ar="onMouseLeave",wt="onMouseEnter",ut="mouse",(m==="pointerout"||m==="pointerover")&&(ln=vs,ar="onPointerLeave",wt="onPointerEnter",ut="pointer"),Uo=$r==null?cr:$c($r),Tt=nn==null?cr:$c(nn),cr=new ln(ar,ut+"leave",$r,P,pr),cr.target=Uo,cr.relatedTarget=Tt,ar=null,ac(pr)===kt&&(ln=new ln(wt,ut+"enter",nn,P,pr),ln.target=Tt,ln.relatedTarget=Uo,ar=ln),Uo=ar,$r&&nn)t:{for(ln=$r,wt=nn,ut=0,Tt=ln;Tt;Tt=rc(Tt))ut++;for(Tt=0,ar=wt;ar;ar=rc(ar))Tt++;for(;0<ut-Tt;)ln=rc(ln),ut--;for(;0<Tt-ut;)wt=rc(wt),Tt--;for(;ut--;){if(ln===wt||wt!==null&&ln===wt.alternate)break t;ln=rc(ln),wt=rc(wt)}ln=null}else ln=null;$r!==null&&Af(yr,cr,$r,ln,!1),nn!==null&&Uo!==null&&Af(yr,Uo,nn,ln,!0)}}e:{if(cr=kt?$c(kt):window,$r=cr.nodeName&&cr.nodeName.toLowerCase(),$r==="select"||$r==="input"&&cr.type==="file")var pn=Jg;else if(Ql(cr))if(_l)pn=e_;else{pn=Xm;var En=Qg}else($r=cr.nodeName)&&$r.toLowerCase()==="input"&&(cr.type==="checkbox"||cr.type==="radio")&&(pn=Ym);if(pn&&(pn=pn(m,kt))){Lc(yr,pn,P,pr);break e}En&&En(m,cr,kt),m==="focusout"&&(En=cr._wrapperState)&&En.controlled&&cr.type==="number"&&Oi(cr,"number",cr.value)}switch(En=kt?$c(kt):window,m){case"focusin":(Ql(En)||En.contentEditable==="true")&&(qs=En,wd=kt,Fc=null);break;case"focusout":Fc=wd=qs=null;break;case"mousedown":Oa=!0;break;case"contextmenu":case"mouseup":case"dragend":Oa=!1,Sd(yr,P,pr);break;case"selectionchange":if(Sh)break;case"keydown":case"keyup":Sd(yr,P,pr)}var Dn;if(Au)e:{switch(m){case"compositionstart":var Un="onCompositionStart";break e;case"compositionend":Un="onCompositionEnd";break e;case"compositionupdate":Un="onCompositionUpdate";break e}Un=void 0}else Jl?xs(m,P)&&(Un="onCompositionEnd"):m==="keydown"&&P.keyCode===229&&(Un="onCompositionStart");Un&&(Pu&&P.locale!=="ko"&&(Jl||Un!=="onCompositionStart"?Un==="onCompositionEnd"&&Jl&&(Dn=Ca()):(pl=pr,mh="value"in pl?pl.value:pl.textContent,Jl=!0)),En=Ph(kt,Un),0<En.length&&(Un=new la(Un,m,null,P,pr),yr.push({event:Un,listeners:En}),Dn?Un.data=Dn:(Dn=kp(P),Dn!==null&&(Un.data=Dn)))),(Dn=Iu?ca(m,P):va(m,P))&&(kt=Ph(kt,"onBeforeInput"),0<kt.length&&(pr=new la("onBeforeInput","beforeinput",null,P,pr),yr.push({event:pr,listeners:kt}),pr.data=Dn))}Jm(yr,v)})}function Ih(m,v,P){return{instance:m,listener:v,currentTarget:P}}function Ph(m,v){for(var P=v+"Capture",N=[];m!==null;){var W=m,ee=W.stateNode;W.tag===5&&ee!==null&&(W=ee,ee=ae(m,P),ee!=null&&N.unshift(Ih(m,ee,W)),ee=ae(m,v),ee!=null&&N.push(Ih(m,ee,W))),m=m.return}return N}function rc(m){if(m===null)return null;do m=m.return;while(m&&m.tag!==5);return m||null}function Af(m,v,P,N,W){for(var ee=v._reactName,be=[];P!==null&&P!==N;){var Ge=P,rt=Ge.alternate,kt=Ge.stateNode;if(rt!==null&&rt===N)break;Ge.tag===5&&kt!==null&&(Ge=kt,W?(rt=ae(P,ee),rt!=null&&be.unshift(Ih(P,rt,Ge))):W||(rt=ae(P,ee),rt!=null&&be.push(Ih(P,rt,Ge)))),P=P.return}be.length!==0&&m.push({event:v,listeners:be})}var Ou=/\r\n?/g,Bp=/\u0000|\uFFFD/g;function jp(m){return(typeof m=="string"?m:""+m).replace(Ou,`
`).replace(Bp,"")}function nc(m,v,P){if(v=jp(v),jp(m)!==v&&P)throw Error(l(425))}function Uc(){}var Ch=null,Mh=null;function Vc(m,v){return m==="textarea"||m==="noscript"||typeof v.children=="string"||typeof v.children=="number"||typeof v.dangerouslySetInnerHTML=="object"&&v.dangerouslySetInnerHTML!==null&&v.dangerouslySetInnerHTML.__html!=null}var Oh=typeof setTimeout=="function"?setTimeout:void 0,Up=typeof clearTimeout=="function"?clearTimeout:void 0,Vp=typeof Promise=="function"?Promise:void 0,$p=typeof queueMicrotask=="function"?queueMicrotask:typeof Vp<"u"?function(m){return Vp.resolve(null).then(m).catch(If)}:Oh;function If(m){setTimeout(function(){throw m})}function Du(m,v){var P=v,N=0;do{var W=P.nextSibling;if(m.removeChild(P),W&&W.nodeType===8)if(P=W.data,P==="/$"){if(N===0){m.removeChild(W),bu(v);return}N--}else P!=="$"&&P!=="$?"&&P!=="$!"||N++;P=W}while(P);bu(v)}function ic(m){for(;m!=null;m=m.nextSibling){var v=m.nodeType;if(v===1||v===3)break;if(v===8){if(v=m.data,v==="$"||v==="$!"||v==="$?")break;if(v==="/$")return null}}return m}function Gp(m){m=m.previousSibling;for(var v=0;m;){if(m.nodeType===8){var P=m.data;if(P==="$"||P==="$!"||P==="$?"){if(v===0)return m;v--}else P==="/$"&&v++}m=m.previousSibling}return null}var ku=Math.random().toString(36).slice(2),Da="__reactFiber$"+ku,Dh="__reactProps$"+ku,oc="__reactContainer$"+ku,Cd="__reactEvents$"+ku,r_="__reactListeners$"+ku,Pf="__reactHandles$"+ku;function ac(m){var v=m[Da];if(v)return v;for(var P=m.parentNode;P;){if(v=P[oc]||P[Da]){if(P=v.alternate,v.child!==null||P!==null&&P.child!==null)for(m=Gp(m);m!==null;){if(P=m[Da])return P;m=Gp(m)}return v}m=P,P=m.parentNode}return null}function Ru(m){return m=m[Da]||m[oc],!m||m.tag!==5&&m.tag!==6&&m.tag!==13&&m.tag!==3?null:m}function $c(m){if(m.tag===5||m.tag===6)return m.stateNode;throw Error(l(33))}function kh(m){return m[Dh]||null}var Md=[],Ws=-1;function is(m){return{current:m}}function Ui(m){0>Ws||(m.current=Md[Ws],Md[Ws]=null,Ws--)}function Ji(m,v){Ws++,Md[Ws]=m.current,m.current=v}var wo={},zo=is(wo),ua=is(!1),vl=wo;function sc(m,v){var P=m.type.contextTypes;if(!P)return wo;var N=m.stateNode;if(N&&N.__reactInternalMemoizedUnmaskedChildContext===v)return N.__reactInternalMemoizedMaskedChildContext;var W={},ee;for(ee in P)W[ee]=v[ee];return N&&(m=m.stateNode,m.__reactInternalMemoizedUnmaskedChildContext=v,m.__reactInternalMemoizedMaskedChildContext=W),W}function ha(m){return m=m.childContextTypes,m!=null}function Rh(){Ui(ua),Ui(zo)}function Od(m,v,P){if(zo.current!==wo)throw Error(l(168));Ji(zo,v),Ji(ua,P)}function Cf(m,v,P){var N=m.stateNode;if(v=v.childContextTypes,typeof N.getChildContext!="function")return P;N=N.getChildContext();for(var W in N)if(!(W in v))throw Error(l(108,Vr(m)||"Unknown",W));return Ft({},P,N)}function Lu(m){return m=(m=m.stateNode)&&m.__reactInternalMemoizedMergedChildContext||wo,vl=zo.current,Ji(zo,m),Ji(ua,ua.current),!0}function Lh(m,v,P){var N=m.stateNode;if(!N)throw Error(l(169));P?(m=Cf(m,v,vl),N.__reactInternalMemoizedMergedChildContext=m,Ui(ua),Ui(zo),Ji(zo,m)):Ui(ua),Ji(ua,P)}var os=null,Dd=!1,lc=!1;function Qm(m){os===null?os=[m]:os.push(m)}function n_(m){Dd=!0,Qm(m)}function cc(){if(!lc&&os!==null){lc=!0;var m=0,v=hi;try{var P=os;for(hi=1;m<P.length;m++){var N=P[m];do N=N(!0);while(N!==null)}os=null,Dd=!1}catch(W){throw os!==null&&(os=os.slice(m+1)),ui(ji,cc),W}finally{hi=v,lc=!1}}return null}var zu=[],zh=0,Mf=null,Fh=0,xa=[],as=0,ss=null,xl=1,bl="";function uc(m,v){zu[zh++]=Fh,zu[zh++]=Mf,Mf=m,Fh=v}function kd(m,v,P){xa[as++]=xl,xa[as++]=bl,xa[as++]=ss,ss=m;var N=xl;m=bl;var W=32-Wi(N)-1;N&=~(1<<W),P+=1;var ee=32-Wi(v)+W;if(30<ee){var be=W-W%5;ee=(N&(1<<be)-1).toString(32),N>>=be,W-=be,xl=1<<32-Wi(v)+W|P<<W|N,bl=ee+m}else xl=1<<ee|P<<W|N,bl=m}function wl(m){m.return!==null&&(uc(m,1),kd(m,1,0))}function Of(m){for(;m===Mf;)Mf=zu[--zh],zu[zh]=null,Fh=zu[--zh],zu[zh]=null;for(;m===ss;)ss=xa[--as],xa[as]=null,bl=xa[--as],xa[as]=null,xl=xa[--as],xa[as]=null}var so=null,ka=null,Qi=!1,Es=null;function Df(m,v){var P=Mo(5,null,null,0);P.elementType="DELETED",P.stateNode=v,P.return=m,v=m.deletions,v===null?(m.deletions=[P],m.flags|=16):v.push(P)}function Rd(m,v){switch(m.tag){case 5:var P=m.type;return v=v.nodeType!==1||P.toLowerCase()!==v.nodeName.toLowerCase()?null:v,v!==null?(m.stateNode=v,so=m,ka=ic(v.firstChild),!0):!1;case 6:return v=m.pendingProps===""||v.nodeType!==3?null:v,v!==null?(m.stateNode=v,so=m,ka=null,!0):!1;case 13:return v=v.nodeType!==8?null:v,v!==null?(P=ss!==null?{id:xl,overflow:bl}:null,m.memoizedState={dehydrated:v,treeContext:P,retryLane:1073741824},P=Mo(18,null,null,0),P.stateNode=v,P.return=m,m.child=P,so=m,ka=null,!0):!1;default:return!1}}function Nh(m){return(m.mode&1)!==0&&(m.flags&128)===0}function kf(m){if(Qi){var v=ka;if(v){var P=v;if(!Rd(m,v)){if(Nh(m))throw Error(l(418));v=ic(P.nextSibling);var N=so;v&&Rd(m,v)?Df(N,P):(m.flags=m.flags&-4097|2,Qi=!1,so=m)}}else{if(Nh(m))throw Error(l(418));m.flags=m.flags&-4097|2,Qi=!1,so=m}}}function Ld(m){for(m=m.return;m!==null&&m.tag!==5&&m.tag!==3&&m.tag!==13;)m=m.return;so=m}function Sl(m){if(m!==so)return!1;if(!Qi)return Ld(m),Qi=!0,!1;var v;if((v=m.tag!==3)&&!(v=m.tag!==5)&&(v=m.type,v=v!=="head"&&v!=="body"&&!Vc(m.type,m.memoizedProps)),v&&(v=ka)){if(Nh(m))throw qp(),Error(l(418));for(;v;)Df(m,v),v=ic(v.nextSibling)}if(Ld(m),m.tag===13){if(m=m.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(l(317));e:{for(m=m.nextSibling,v=0;m;){if(m.nodeType===8){var P=m.data;if(P==="/$"){if(v===0){ka=ic(m.nextSibling);break e}v--}else P!=="$"&&P!=="$!"&&P!=="$?"||v++}m=m.nextSibling}ka=null}}else ka=so?ic(m.stateNode.nextSibling):null;return!0}function qp(){for(var m=ka;m;)m=ic(m.nextSibling)}function Bh(){ka=so=null,Qi=!1}function Hs(m){Es===null?Es=[m]:Es.push(m)}var i_=et.ReactCurrentBatchConfig;function Fu(m,v,P){if(m=P.ref,m!==null&&typeof m!="function"&&typeof m!="object"){if(P._owner){if(P=P._owner,P){if(P.tag!==1)throw Error(l(309));var N=P.stateNode}if(!N)throw Error(l(147,m));var W=N,ee=""+m;return v!==null&&v.ref!==null&&typeof v.ref=="function"&&v.ref._stringRef===ee?v.ref:(v=function(be){var Ge=W.refs;be===null?delete Ge[ee]:Ge[ee]=be},v._stringRef=ee,v)}if(typeof m!="string")throw Error(l(284));if(!P._owner)throw Error(l(290,m))}return m}function Nu(m,v){throw m=Object.prototype.toString.call(v),Error(l(31,m==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":m))}function Bu(m){var v=m._init;return v(m._payload)}function Gc(m){function v(wt,ut){if(m){var Tt=wt.deletions;Tt===null?(wt.deletions=[ut],wt.flags|=16):Tt.push(ut)}}function P(wt,ut){if(!m)return null;for(;ut!==null;)v(wt,ut),ut=ut.sibling;return null}function N(wt,ut){for(wt=new Map;ut!==null;)ut.key!==null?wt.set(ut.key,ut):wt.set(ut.index,ut),ut=ut.sibling;return wt}function W(wt,ut){return wt=ds(wt,ut),wt.index=0,wt.sibling=null,wt}function ee(wt,ut,Tt){return wt.index=Tt,m?(Tt=wt.alternate,Tt!==null?(Tt=Tt.index,Tt<ut?(wt.flags|=2,ut):Tt):(wt.flags|=2,ut)):(wt.flags|=1048576,ut)}function be(wt){return m&&wt.alternate===null&&(wt.flags|=2),wt}function Ge(wt,ut,Tt,ar){return ut===null||ut.tag!==6?(ut=Jh(Tt,wt.mode,ar),ut.return=wt,ut):(ut=W(ut,Tt),ut.return=wt,ut)}function rt(wt,ut,Tt,ar){var pn=Tt.type;return pn===pt?pr(wt,ut,Tt.props.children,ar,Tt.key):ut!==null&&(ut.elementType===pn||typeof pn=="object"&&pn!==null&&pn.$$typeof===zr&&Bu(pn)===ut.type)?(ar=W(ut,Tt.props),ar.ref=Fu(wt,ut,Tt),ar.return=wt,ar):(ar=Ll(Tt.type,Tt.key,Tt.props,null,wt.mode,ar),ar.ref=Fu(wt,ut,Tt),ar.return=wt,ar)}function kt(wt,ut,Tt,ar){return ut===null||ut.tag!==4||ut.stateNode.containerInfo!==Tt.containerInfo||ut.stateNode.implementation!==Tt.implementation?(ut=Ku(Tt,wt.mode,ar),ut.return=wt,ut):(ut=W(ut,Tt.children||[]),ut.return=wt,ut)}function pr(wt,ut,Tt,ar,pn){return ut===null||ut.tag!==7?(ut=zl(Tt,wt.mode,ar,pn),ut.return=wt,ut):(ut=W(ut,Tt),ut.return=wt,ut)}function yr(wt,ut,Tt){if(typeof ut=="string"&&ut!==""||typeof ut=="number")return ut=Jh(""+ut,wt.mode,Tt),ut.return=wt,ut;if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case ze:return Tt=Ll(ut.type,ut.key,ut.props,null,wt.mode,Tt),Tt.ref=Fu(wt,null,ut),Tt.return=wt,Tt;case nt:return ut=Ku(ut,wt.mode,Tt),ut.return=wt,ut;case zr:var ar=ut._init;return yr(wt,ar(ut._payload),Tt)}if(Di(ut)||br(ut))return ut=zl(ut,wt.mode,Tt,null),ut.return=wt,ut;Nu(wt,ut)}return null}function cr(wt,ut,Tt,ar){var pn=ut!==null?ut.key:null;if(typeof Tt=="string"&&Tt!==""||typeof Tt=="number")return pn!==null?null:Ge(wt,ut,""+Tt,ar);if(typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case ze:return Tt.key===pn?rt(wt,ut,Tt,ar):null;case nt:return Tt.key===pn?kt(wt,ut,Tt,ar):null;case zr:return pn=Tt._init,cr(wt,ut,pn(Tt._payload),ar)}if(Di(Tt)||br(Tt))return pn!==null?null:pr(wt,ut,Tt,ar,null);Nu(wt,Tt)}return null}function $r(wt,ut,Tt,ar,pn){if(typeof ar=="string"&&ar!==""||typeof ar=="number")return wt=wt.get(Tt)||null,Ge(ut,wt,""+ar,pn);if(typeof ar=="object"&&ar!==null){switch(ar.$$typeof){case ze:return wt=wt.get(ar.key===null?Tt:ar.key)||null,rt(ut,wt,ar,pn);case nt:return wt=wt.get(ar.key===null?Tt:ar.key)||null,kt(ut,wt,ar,pn);case zr:var En=ar._init;return $r(wt,ut,Tt,En(ar._payload),pn)}if(Di(ar)||br(ar))return wt=wt.get(Tt)||null,pr(ut,wt,ar,pn,null);Nu(ut,ar)}return null}function nn(wt,ut,Tt,ar){for(var pn=null,En=null,Dn=ut,Un=ut=0,wa=null;Dn!==null&&Un<Tt.length;Un++){Dn.index>Un?(wa=Dn,Dn=null):wa=Dn.sibling;var Vi=cr(wt,Dn,Tt[Un],ar);if(Vi===null){Dn===null&&(Dn=wa);break}m&&Dn&&Vi.alternate===null&&v(wt,Dn),ut=ee(Vi,ut,Un),En===null?pn=Vi:En.sibling=Vi,En=Vi,Dn=wa}if(Un===Tt.length)return P(wt,Dn),Qi&&uc(wt,Un),pn;if(Dn===null){for(;Un<Tt.length;Un++)Dn=yr(wt,Tt[Un],ar),Dn!==null&&(ut=ee(Dn,ut,Un),En===null?pn=Dn:En.sibling=Dn,En=Dn);return Qi&&uc(wt,Un),pn}for(Dn=N(wt,Dn);Un<Tt.length;Un++)wa=$r(Dn,wt,Un,Tt[Un],ar),wa!==null&&(m&&wa.alternate!==null&&Dn.delete(wa.key===null?Un:wa.key),ut=ee(wa,ut,Un),En===null?pn=wa:En.sibling=wa,En=wa);return m&&Dn.forEach(function(Fl){return v(wt,Fl)}),Qi&&uc(wt,Un),pn}function ln(wt,ut,Tt,ar){var pn=br(Tt);if(typeof pn!="function")throw Error(l(150));if(Tt=pn.call(Tt),Tt==null)throw Error(l(151));for(var En=pn=null,Dn=ut,Un=ut=0,wa=null,Vi=Tt.next();Dn!==null&&!Vi.done;Un++,Vi=Tt.next()){Dn.index>Un?(wa=Dn,Dn=null):wa=Dn.sibling;var Fl=cr(wt,Dn,Vi.value,ar);if(Fl===null){Dn===null&&(Dn=wa);break}m&&Dn&&Fl.alternate===null&&v(wt,Dn),ut=ee(Fl,ut,Un),En===null?pn=Fl:En.sibling=Fl,En=Fl,Dn=wa}if(Vi.done)return P(wt,Dn),Qi&&uc(wt,Un),pn;if(Dn===null){for(;!Vi.done;Un++,Vi=Tt.next())Vi=yr(wt,Vi.value,ar),Vi!==null&&(ut=ee(Vi,ut,Un),En===null?pn=Vi:En.sibling=Vi,En=Vi);return Qi&&uc(wt,Un),pn}for(Dn=N(wt,Dn);!Vi.done;Un++,Vi=Tt.next())Vi=$r(Dn,wt,Un,Vi.value,ar),Vi!==null&&(m&&Vi.alternate!==null&&Dn.delete(Vi.key===null?Un:Vi.key),ut=ee(Vi,ut,Un),En===null?pn=Vi:En.sibling=Vi,En=Vi);return m&&Dn.forEach(function(Uy){return v(wt,Uy)}),Qi&&uc(wt,Un),pn}function Uo(wt,ut,Tt,ar){if(typeof Tt=="object"&&Tt!==null&&Tt.type===pt&&Tt.key===null&&(Tt=Tt.props.children),typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case ze:e:{for(var pn=Tt.key,En=ut;En!==null;){if(En.key===pn){if(pn=Tt.type,pn===pt){if(En.tag===7){P(wt,En.sibling),ut=W(En,Tt.props.children),ut.return=wt,wt=ut;break e}}else if(En.elementType===pn||typeof pn=="object"&&pn!==null&&pn.$$typeof===zr&&Bu(pn)===En.type){P(wt,En.sibling),ut=W(En,Tt.props),ut.ref=Fu(wt,En,Tt),ut.return=wt,wt=ut;break e}P(wt,En);break}else v(wt,En);En=En.sibling}Tt.type===pt?(ut=zl(Tt.props.children,wt.mode,ar,Tt.key),ut.return=wt,wt=ut):(ar=Ll(Tt.type,Tt.key,Tt.props,null,wt.mode,ar),ar.ref=Fu(wt,ut,Tt),ar.return=wt,wt=ar)}return be(wt);case nt:e:{for(En=Tt.key;ut!==null;){if(ut.key===En)if(ut.tag===4&&ut.stateNode.containerInfo===Tt.containerInfo&&ut.stateNode.implementation===Tt.implementation){P(wt,ut.sibling),ut=W(ut,Tt.children||[]),ut.return=wt,wt=ut;break e}else{P(wt,ut);break}else v(wt,ut);ut=ut.sibling}ut=Ku(Tt,wt.mode,ar),ut.return=wt,wt=ut}return be(wt);case zr:return En=Tt._init,Uo(wt,ut,En(Tt._payload),ar)}if(Di(Tt))return nn(wt,ut,Tt,ar);if(br(Tt))return ln(wt,ut,Tt,ar);Nu(wt,Tt)}return typeof Tt=="string"&&Tt!==""||typeof Tt=="number"?(Tt=""+Tt,ut!==null&&ut.tag===6?(P(wt,ut.sibling),ut=W(ut,Tt),ut.return=wt,wt=ut):(P(wt,ut),ut=Jh(Tt,wt.mode,ar),ut.return=wt,wt=ut),be(wt)):P(wt,ut)}return Uo}var Zs=Gc(!0),jh=Gc(!1),qc=is(null),ju=null,Wc=null,Uh=null;function zd(){Uh=Wc=ju=null}function Hc(m){var v=qc.current;Ui(qc),m._currentValue=v}function Uu(m,v,P){for(;m!==null;){var N=m.alternate;if((m.childLanes&v)!==v?(m.childLanes|=v,N!==null&&(N.childLanes|=v)):N!==null&&(N.childLanes&v)!==v&&(N.childLanes|=v),m===P)break;m=m.return}}function qt(m,v){ju=m,Uh=Wc=null,m=m.dependencies,m!==null&&m.firstContext!==null&&((m.lanes&v)!==0&&(Xo=!0),m.firstContext=null)}function ba(m){var v=m._currentValue;if(Uh!==m)if(m={context:m,memoizedValue:v,next:null},Wc===null){if(ju===null)throw Error(l(308));Wc=m,ju.dependencies={lanes:0,firstContext:m}}else Wc=Wc.next=m;return v}var ls=null;function Tl(m){ls===null?ls=[m]:ls.push(m)}function hc(m,v,P,N){var W=v.interleaved;return W===null?(P.next=P,Tl(v)):(P.next=W.next,W.next=P),v.interleaved=P,_r(m,N)}function _r(m,v){m.lanes|=v;var P=m.alternate;for(P!==null&&(P.lanes|=v),P=m,m=m.return;m!==null;)m.childLanes|=v,P=m.alternate,P!==null&&(P.childLanes|=v),P=m,m=m.return;return P.tag===3?P.stateNode:null}var El=!1;function Wp(m){m.updateQueue={baseState:m.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Hp(m,v){m=m.updateQueue,v.updateQueue===m&&(v.updateQueue={baseState:m.baseState,firstBaseUpdate:m.firstBaseUpdate,lastBaseUpdate:m.lastBaseUpdate,shared:m.shared,effects:m.effects})}function cs(m,v){return{eventTime:m,lane:v,tag:0,payload:null,callback:null,next:null}}function dc(m,v,P){var N=m.updateQueue;if(N===null)return null;if(N=N.shared,(K&2)!==0){var W=N.pending;return W===null?v.next=v:(v.next=W.next,W.next=v),N.pending=v,_r(m,P)}return W=N.interleaved,W===null?(v.next=v,Tl(N)):(v.next=W.next,W.next=v),N.interleaved=v,_r(m,P)}function Rf(m,v,P){if(v=v.updateQueue,v!==null&&(v=v.shared,(P&4194240)!==0)){var N=v.lanes;N&=m.pendingLanes,P|=N,v.lanes=P,Qa(m,P)}}function Zp(m,v){var P=m.updateQueue,N=m.alternate;if(N!==null&&(N=N.updateQueue,P===N)){var W=null,ee=null;if(P=P.firstBaseUpdate,P!==null){do{var be={eventTime:P.eventTime,lane:P.lane,tag:P.tag,payload:P.payload,callback:P.callback,next:null};ee===null?W=ee=be:ee=ee.next=be,P=P.next}while(P!==null);ee===null?W=ee=v:ee=ee.next=v}else W=ee=v;P={baseState:N.baseState,firstBaseUpdate:W,lastBaseUpdate:ee,shared:N.shared,effects:N.effects},m.updateQueue=P;return}m=P.lastBaseUpdate,m===null?P.firstBaseUpdate=v:m.next=v,P.lastBaseUpdate=v}function Lf(m,v,P,N){var W=m.updateQueue;El=!1;var ee=W.firstBaseUpdate,be=W.lastBaseUpdate,Ge=W.shared.pending;if(Ge!==null){W.shared.pending=null;var rt=Ge,kt=rt.next;rt.next=null,be===null?ee=kt:be.next=kt,be=rt;var pr=m.alternate;pr!==null&&(pr=pr.updateQueue,Ge=pr.lastBaseUpdate,Ge!==be&&(Ge===null?pr.firstBaseUpdate=kt:Ge.next=kt,pr.lastBaseUpdate=rt))}if(ee!==null){var yr=W.baseState;be=0,pr=kt=rt=null,Ge=ee;do{var cr=Ge.lane,$r=Ge.eventTime;if((N&cr)===cr){pr!==null&&(pr=pr.next={eventTime:$r,lane:0,tag:Ge.tag,payload:Ge.payload,callback:Ge.callback,next:null});e:{var nn=m,ln=Ge;switch(cr=v,$r=P,ln.tag){case 1:if(nn=ln.payload,typeof nn=="function"){yr=nn.call($r,yr,cr);break e}yr=nn;break e;case 3:nn.flags=nn.flags&-65537|128;case 0:if(nn=ln.payload,cr=typeof nn=="function"?nn.call($r,yr,cr):nn,cr==null)break e;yr=Ft({},yr,cr);break e;case 2:El=!0}}Ge.callback!==null&&Ge.lane!==0&&(m.flags|=64,cr=W.effects,cr===null?W.effects=[Ge]:cr.push(Ge))}else $r={eventTime:$r,lane:cr,tag:Ge.tag,payload:Ge.payload,callback:Ge.callback,next:null},pr===null?(kt=pr=$r,rt=yr):pr=pr.next=$r,be|=cr;if(Ge=Ge.next,Ge===null){if(Ge=W.shared.pending,Ge===null)break;cr=Ge,Ge=cr.next,cr.next=null,W.lastBaseUpdate=cr,W.shared.pending=null}}while(!0);if(pr===null&&(rt=yr),W.baseState=rt,W.firstBaseUpdate=kt,W.lastBaseUpdate=pr,v=W.shared.interleaved,v!==null){W=v;do be|=W.lane,W=W.next;while(W!==v)}else ee===null&&(W.shared.lanes=0);Ie|=be,m.lanes=be,m.memoizedState=yr}}function eg(m,v,P){if(m=v.effects,v.effects=null,m!==null)for(v=0;v<m.length;v++){var N=m[v],W=N.callback;if(W!==null){if(N.callback=null,N=P,typeof W!="function")throw Error(l(191,W));W.call(N)}}}var Vu={},As=is(Vu),$u=is(Vu),Gu=is(Vu);function Fo(m){if(m===Vu)throw Error(l(174));return m}function Al(m,v){switch(Ji(Gu,v),Ji($u,m),Ji(As,Vu),m=v.nodeType,m){case 9:case 11:v=(v=v.documentElement)?v.namespaceURI:Co(null,"");break;default:m=m===8?v.parentNode:v,v=m.namespaceURI||null,m=m.tagName,v=Co(v,m)}Ui(As),Ji(As,v)}function Is(){Ui(As),Ui($u),Ui(Gu)}function Fd(m){Fo(Gu.current);var v=Fo(As.current),P=Co(v,m.type);v!==P&&(Ji($u,m),Ji(As,P))}function Vh(m){$u.current===m&&(Ui(As),Ui($u))}var Hi=is(0);function Nd(m){for(var v=m;v!==null;){if(v.tag===13){var P=v.memoizedState;if(P!==null&&(P=P.dehydrated,P===null||P.data==="$?"||P.data==="$!"))return v}else if(v.tag===19&&v.memoizedProps.revealOrder!==void 0){if((v.flags&128)!==0)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===m)break;for(;v.sibling===null;){if(v.return===null||v.return===m)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}var Ua=[];function $n(){for(var m=0;m<Ua.length;m++)Ua[m]._workInProgressVersionPrimary=null;Ua.length=0}var Zc=et.ReactCurrentDispatcher,Il=et.ReactCurrentBatchConfig,Xc=0,mo=null,No=null,ra=null,fc=!1,Xs=!1,Ct=0,Xt=0;function So(){throw Error(l(321))}function Ri(m,v){if(v===null)return!1;for(var P=0;P<v.length&&P<m.length;P++)if(!ws(m[P],v[P]))return!1;return!0}function qe(m,v,P,N,W,ee){if(Xc=ee,mo=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,Zc.current=m===null||m.memoizedState===null?Zu:Zh,m=P(N,W),Xs){ee=0;do{if(Xs=!1,Ct=0,25<=ee)throw Error(l(301));ee+=1,ra=No=null,v.updateQueue=null,Zc.current=La,m=P(N,W)}while(Xs)}if(Zc.current=Hu,v=No!==null&&No.next!==null,Xc=0,ra=No=mo=null,fc=!1,v)throw Error(l(300));return m}function us(){var m=Ct!==0;return Ct=0,m}function hs(){var m={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ra===null?mo.memoizedState=ra=m:ra=ra.next=m,ra}function Ra(){if(No===null){var m=mo.alternate;m=m!==null?m.memoizedState:null}else m=No.next;var v=ra===null?mo.memoizedState:ra.next;if(v!==null)ra=v,No=m;else{if(m===null)throw Error(l(310));No=m,m={memoizedState:No.memoizedState,baseState:No.baseState,baseQueue:No.baseQueue,queue:No.queue,next:null},ra===null?mo.memoizedState=ra=m:ra=ra.next=m}return ra}function qu(m,v){return typeof v=="function"?v(m):v}function zf(m){var v=Ra(),P=v.queue;if(P===null)throw Error(l(311));P.lastRenderedReducer=m;var N=No,W=N.baseQueue,ee=P.pending;if(ee!==null){if(W!==null){var be=W.next;W.next=ee.next,ee.next=be}N.baseQueue=W=ee,P.pending=null}if(W!==null){ee=W.next,N=N.baseState;var Ge=be=null,rt=null,kt=ee;do{var pr=kt.lane;if((Xc&pr)===pr)rt!==null&&(rt=rt.next={lane:0,action:kt.action,hasEagerState:kt.hasEagerState,eagerState:kt.eagerState,next:null}),N=kt.hasEagerState?kt.eagerState:m(N,kt.action);else{var yr={lane:pr,action:kt.action,hasEagerState:kt.hasEagerState,eagerState:kt.eagerState,next:null};rt===null?(Ge=rt=yr,be=N):rt=rt.next=yr,mo.lanes|=pr,Ie|=pr}kt=kt.next}while(kt!==null&&kt!==ee);rt===null?be=N:rt.next=Ge,ws(N,v.memoizedState)||(Xo=!0),v.memoizedState=N,v.baseState=be,v.baseQueue=rt,P.lastRenderedState=N}if(m=P.interleaved,m!==null){W=m;do ee=W.lane,mo.lanes|=ee,Ie|=ee,W=W.next;while(W!==m)}else W===null&&(P.lanes=0);return[v.memoizedState,P.dispatch]}function Ff(m){var v=Ra(),P=v.queue;if(P===null)throw Error(l(311));P.lastRenderedReducer=m;var N=P.dispatch,W=P.pending,ee=v.memoizedState;if(W!==null){P.pending=null;var be=W=W.next;do ee=m(ee,be.action),be=be.next;while(be!==W);ws(ee,v.memoizedState)||(Xo=!0),v.memoizedState=ee,v.baseQueue===null&&(v.baseState=ee),P.lastRenderedState=ee}return[ee,N]}function Wu(){}function tg(m,v){var P=mo,N=Ra(),W=v(),ee=!ws(N.memoizedState,W);if(ee&&(N.memoizedState=W,Xo=!0),N=N.queue,na(Bd.bind(null,P,N,m),[m]),N.getSnapshot!==v||ee||ra!==null&&ra.memoizedState.tag&1){if(P.flags|=2048,Yc(9,Xp.bind(null,P,N,W,v),void 0,null),ce===null)throw Error(l(349));(Xc&30)!==0||rg(P,v,W)}return W}function rg(m,v,P){m.flags|=16384,m={getSnapshot:v,value:P},v=mo.updateQueue,v===null?(v={lastEffect:null,stores:null},mo.updateQueue=v,v.stores=[m]):(P=v.stores,P===null?v.stores=[m]:P.push(m))}function Xp(m,v,P,N){v.value=P,v.getSnapshot=N,Nf(v)&&Bf(m)}function Bd(m,v,P){return P(function(){Nf(v)&&Bf(m)})}function Nf(m){var v=m.getSnapshot;m=m.value;try{var P=v();return!ws(m,P)}catch{return!0}}function Bf(m){var v=_r(m,1);v!==null&&Wt(v,m,1,-1)}function Yp(m){var v=hs();return typeof m=="function"&&(m=m()),v.memoizedState=v.baseState=m,m={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:qu,lastRenderedState:m},v.queue=m,m=m.dispatch=Kp.bind(null,mo,m),[v.memoizedState,m]}function Yc(m,v,P,N){return m={tag:m,create:v,destroy:P,deps:N,next:null},v=mo.updateQueue,v===null?(v={lastEffect:null,stores:null},mo.updateQueue=v,v.lastEffect=m.next=m):(P=v.lastEffect,P===null?v.lastEffect=m.next=m:(N=P.next,P.next=m,m.next=N,v.lastEffect=m)),m}function $h(){return Ra().memoizedState}function Pl(m,v,P,N){var W=hs();mo.flags|=m,W.memoizedState=Yc(1|v,P,void 0,N===void 0?null:N)}function Gh(m,v,P,N){var W=Ra();N=N===void 0?null:N;var ee=void 0;if(No!==null){var be=No.memoizedState;if(ee=be.destroy,N!==null&&Ri(N,be.deps)){W.memoizedState=Yc(v,P,ee,N);return}}mo.flags|=m,W.memoizedState=Yc(1|v,P,ee,N)}function pc(m,v){return Pl(8390656,8,m,v)}function na(m,v){return Gh(2048,8,m,v)}function ng(m,v){return Gh(4,2,m,v)}function qh(m,v){return Gh(4,4,m,v)}function gi(m,v){if(typeof v=="function")return m=m(),v(m),function(){v(null)};if(v!=null)return m=m(),v.current=m,function(){v.current=null}}function On(m,v,P){return P=P!=null?P.concat([m]):null,Gh(4,4,gi.bind(null,v,m),P)}function jd(){}function Cl(m,v){var P=Ra();v=v===void 0?null:v;var N=P.memoizedState;return N!==null&&v!==null&&Ri(v,N[1])?N[0]:(P.memoizedState=[m,v],m)}function Ud(m,v){var P=Ra();v=v===void 0?null:v;var N=P.memoizedState;return N!==null&&v!==null&&Ri(v,N[1])?N[0]:(m=m(),P.memoizedState=[m,v],m)}function Kc(m,v,P){return(Xc&21)===0?(m.baseState&&(m.baseState=!1,Xo=!0),m.memoizedState=P):(ws(P,v)||(P=yf(),mo.lanes|=P,Ie|=P,m.baseState=!0),v)}function Wh(m,v){var P=hi;hi=P!==0&&4>P?P:4,m(!0);var N=Il.transition;Il.transition={};try{m(!1),v()}finally{hi=P,Il.transition=N}}function Vd(){return Ra().memoizedState}function Hh(m,v,P){var N=er(m);if(P={lane:N,action:P,hasEagerState:!1,eagerState:null,next:null},jf(m))Ys(v,P);else if(P=hc(m,v,P,N),P!==null){var W=Bt();Wt(P,m,N,W),Ml(P,v,N)}}function Kp(m,v,P){var N=er(m),W={lane:N,action:P,hasEagerState:!1,eagerState:null,next:null};if(jf(m))Ys(v,W);else{var ee=m.alternate;if(m.lanes===0&&(ee===null||ee.lanes===0)&&(ee=v.lastRenderedReducer,ee!==null))try{var be=v.lastRenderedState,Ge=ee(be,P);if(W.hasEagerState=!0,W.eagerState=Ge,ws(Ge,be)){var rt=v.interleaved;rt===null?(W.next=W,Tl(v)):(W.next=rt.next,rt.next=W),v.interleaved=W;return}}catch{}finally{}P=hc(m,v,W,N),P!==null&&(W=Bt(),Wt(P,m,N,W),Ml(P,v,N))}}function jf(m){var v=m.alternate;return m===mo||v!==null&&v===mo}function Ys(m,v){Xs=fc=!0;var P=m.pending;P===null?v.next=v:(v.next=P.next,P.next=v),m.pending=v}function Ml(m,v,P){if((P&4194240)!==0){var N=v.lanes;N&=m.pendingLanes,P|=N,v.lanes=P,Qa(m,P)}}var Hu={readContext:ba,useCallback:So,useContext:So,useEffect:So,useImperativeHandle:So,useInsertionEffect:So,useLayoutEffect:So,useMemo:So,useReducer:So,useRef:So,useState:So,useDebugValue:So,useDeferredValue:So,useTransition:So,useMutableSource:So,useSyncExternalStore:So,useId:So,unstable_isNewReconciler:!1},Zu={readContext:ba,useCallback:function(m,v){return hs().memoizedState=[m,v===void 0?null:v],m},useContext:ba,useEffect:pc,useImperativeHandle:function(m,v,P){return P=P!=null?P.concat([m]):null,Pl(4194308,4,gi.bind(null,v,m),P)},useLayoutEffect:function(m,v){return Pl(4194308,4,m,v)},useInsertionEffect:function(m,v){return Pl(4,2,m,v)},useMemo:function(m,v){var P=hs();return v=v===void 0?null:v,m=m(),P.memoizedState=[m,v],m},useReducer:function(m,v,P){var N=hs();return v=P!==void 0?P(v):v,N.memoizedState=N.baseState=v,m={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:m,lastRenderedState:v},N.queue=m,m=m.dispatch=Hh.bind(null,mo,m),[N.memoizedState,m]},useRef:function(m){var v=hs();return m={current:m},v.memoizedState=m},useState:Yp,useDebugValue:jd,useDeferredValue:function(m){return hs().memoizedState=m},useTransition:function(){var m=Yp(!1),v=m[0];return m=Wh.bind(null,m[1]),hs().memoizedState=m,[v,m]},useMutableSource:function(){},useSyncExternalStore:function(m,v,P){var N=mo,W=hs();if(Qi){if(P===void 0)throw Error(l(407));P=P()}else{if(P=v(),ce===null)throw Error(l(349));(Xc&30)!==0||rg(N,v,P)}W.memoizedState=P;var ee={value:P,getSnapshot:v};return W.queue=ee,pc(Bd.bind(null,N,ee,m),[m]),N.flags|=2048,Yc(9,Xp.bind(null,N,ee,P,v),void 0,null),P},useId:function(){var m=hs(),v=ce.identifierPrefix;if(Qi){var P=bl,N=xl;P=(N&~(1<<32-Wi(N)-1)).toString(32)+P,v=":"+v+"R"+P,P=Ct++,0<P&&(v+="H"+P.toString(32)),v+=":"}else P=Xt++,v=":"+v+"r"+P.toString(32)+":";return m.memoizedState=v},unstable_isNewReconciler:!1},Zh={readContext:ba,useCallback:Cl,useContext:ba,useEffect:na,useImperativeHandle:On,useInsertionEffect:ng,useLayoutEffect:qh,useMemo:Ud,useReducer:zf,useRef:$h,useState:function(){return zf(qu)},useDebugValue:jd,useDeferredValue:function(m){var v=Ra();return Kc(v,No.memoizedState,m)},useTransition:function(){var m=zf(qu)[0],v=Ra().memoizedState;return[m,v]},useMutableSource:Wu,useSyncExternalStore:tg,useId:Vd,unstable_isNewReconciler:!1},La={readContext:ba,useCallback:Cl,useContext:ba,useEffect:na,useImperativeHandle:On,useInsertionEffect:ng,useLayoutEffect:qh,useMemo:Ud,useReducer:Ff,useRef:$h,useState:function(){return Ff(qu)},useDebugValue:jd,useDeferredValue:function(m){var v=Ra();return No===null?v.memoizedState=m:Kc(v,No.memoizedState,m)},useTransition:function(){var m=Ff(qu)[0],v=Ra().memoizedState;return[m,v]},useMutableSource:Wu,useSyncExternalStore:tg,useId:Vd,unstable_isNewReconciler:!1};function Bo(m,v){if(m&&m.defaultProps){v=Ft({},v),m=m.defaultProps;for(var P in m)v[P]===void 0&&(v[P]=m[P]);return v}return v}function $d(m,v,P,N){v=m.memoizedState,P=P(N,v),P=P==null?v:Ft({},v,P),m.memoizedState=P,m.lanes===0&&(m.updateQueue.baseState=P)}var Ks={isMounted:function(m){return(m=m._reactInternals)?Vt(m)===m:!1},enqueueSetState:function(m,v,P){m=m._reactInternals;var N=Bt(),W=er(m),ee=cs(N,W);ee.payload=v,P!=null&&(ee.callback=P),v=dc(m,ee,W),v!==null&&(Wt(v,m,W,N),Rf(v,m,W))},enqueueReplaceState:function(m,v,P){m=m._reactInternals;var N=Bt(),W=er(m),ee=cs(N,W);ee.tag=1,ee.payload=v,P!=null&&(ee.callback=P),v=dc(m,ee,W),v!==null&&(Wt(v,m,W,N),Rf(v,m,W))},enqueueForceUpdate:function(m,v){m=m._reactInternals;var P=Bt(),N=er(m),W=cs(P,N);W.tag=2,v!=null&&(W.callback=v),v=dc(m,W,N),v!==null&&(Wt(v,m,N,P),Rf(v,m,N))}};function Uf(m,v,P,N,W,ee,be){return m=m.stateNode,typeof m.shouldComponentUpdate=="function"?m.shouldComponentUpdate(N,ee,be):v.prototype&&v.prototype.isPureReactComponent?!Ss(P,N)||!Ss(W,ee):!0}function Gd(m,v,P){var N=!1,W=wo,ee=v.contextType;return typeof ee=="object"&&ee!==null?ee=ba(ee):(W=ha(v)?vl:zo.current,N=v.contextTypes,ee=(N=N!=null)?sc(m,W):wo),v=new v(P,ee),m.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=Ks,m.stateNode=v,v._reactInternals=m,N&&(m=m.stateNode,m.__reactInternalMemoizedUnmaskedChildContext=W,m.__reactInternalMemoizedMaskedChildContext=ee),v}function Xh(m,v,P,N){m=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(P,N),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(P,N),v.state!==m&&Ks.enqueueReplaceState(v,v.state,null)}function qd(m,v,P,N){var W=m.stateNode;W.props=P,W.state=m.memoizedState,W.refs={},Wp(m);var ee=v.contextType;typeof ee=="object"&&ee!==null?W.context=ba(ee):(ee=ha(v)?vl:zo.current,W.context=sc(m,ee)),W.state=m.memoizedState,ee=v.getDerivedStateFromProps,typeof ee=="function"&&($d(m,v,ee,P),W.state=m.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof W.getSnapshotBeforeUpdate=="function"||typeof W.UNSAFE_componentWillMount!="function"&&typeof W.componentWillMount!="function"||(v=W.state,typeof W.componentWillMount=="function"&&W.componentWillMount(),typeof W.UNSAFE_componentWillMount=="function"&&W.UNSAFE_componentWillMount(),v!==W.state&&Ks.enqueueReplaceState(W,W.state,null),Lf(m,P,W,N),W.state=m.memoizedState),typeof W.componentDidMount=="function"&&(m.flags|=4194308)}function to(m,v){try{var P="",N=v;do P+=Sr(N),N=N.return;while(N);var W=P}catch(ee){W=`
Error generating stack: `+ee.message+`
`+ee.stack}return{value:m,source:v,stack:W,digest:null}}function Wd(m,v,P){return{value:m,source:null,stack:P??null,digest:v??null}}function Hd(m,v){try{console.error(v.value)}catch(P){setTimeout(function(){throw P})}}var Jc=typeof WeakMap=="function"?WeakMap:Map;function Yh(m,v,P){P=cs(-1,P),P.tag=3,P.payload={element:null};var N=v.value;return P.callback=function(){He||(He=!0,Ue=N),Hd(m,v)},P}function Vf(m,v,P){P=cs(-1,P),P.tag=3;var N=m.type.getDerivedStateFromError;if(typeof N=="function"){var W=v.value;P.payload=function(){return N(W)},P.callback=function(){Hd(m,v)}}var ee=m.stateNode;return ee!==null&&typeof ee.componentDidCatch=="function"&&(P.callback=function(){Hd(m,v),typeof N!="function"&&(ft===null?ft=new Set([this]):ft.add(this));var be=v.stack;this.componentDidCatch(v.value,{componentStack:be!==null?be:""})}),P}function Zd(m,v,P){var N=m.pingCache;if(N===null){N=m.pingCache=new Jc;var W=new Set;N.set(v,W)}else W=N.get(v),W===void 0&&(W=new Set,N.set(v,W));W.has(P)||(W.add(P),m=jo.bind(null,m,v,P),v.then(m,m))}function Qc(m){do{var v;if((v=m.tag===13)&&(v=m.memoizedState,v=v!==null?v.dehydrated!==null:!0),v)return m;m=m.return}while(m!==null);return null}function $f(m,v,P,N,W){return(m.mode&1)===0?(m===v?m.flags|=65536:(m.flags|=128,P.flags|=131072,P.flags&=-52805,P.tag===1&&(P.alternate===null?P.tag=17:(v=cs(-1,1),v.tag=2,dc(P,v,1))),P.lanes|=1),m):(m.flags|=65536,m.lanes=W,m)}var Xd=et.ReactCurrentOwner,Xo=!1;function Yo(m,v,P,N){v.child=m===null?jh(v,null,P,N):Zs(v,m.child,P,N)}function Gf(m,v,P,N,W){P=P.render;var ee=v.ref;return qt(v,W),N=qe(m,v,P,N,ee,W),P=us(),m!==null&&!Xo?(v.updateQueue=m.updateQueue,v.flags&=-2053,m.lanes&=~W,Va(m,v,W)):(Qi&&P&&wl(v),v.flags|=1,Yo(m,v,N,W),v.child)}function Yd(m,v,P,N,W){if(m===null){var ee=P.type;return typeof ee=="function"&&!Ds(ee)&&ee.defaultProps===void 0&&P.compare===null&&P.defaultProps===void 0?(v.tag=15,v.type=ee,Jp(m,v,ee,N,W)):(m=Ll(P.type,null,N,v,v.mode,W),m.ref=v.ref,m.return=v,v.child=m)}if(ee=m.child,(m.lanes&W)===0){var be=ee.memoizedProps;if(P=P.compare,P=P!==null?P:Ss,P(be,N)&&m.ref===v.ref)return Va(m,v,W)}return v.flags|=1,m=ds(ee,N),m.ref=v.ref,m.return=v,v.child=m}function Jp(m,v,P,N,W){if(m!==null){var ee=m.memoizedProps;if(Ss(ee,N)&&m.ref===v.ref)if(Xo=!1,v.pendingProps=N=ee,(m.lanes&W)!==0)(m.flags&131072)!==0&&(Xo=!0);else return v.lanes=m.lanes,Va(m,v,W)}return qf(m,v,P,N,W)}function Kd(m,v,P){var N=v.pendingProps,W=N.children,ee=m!==null?m.memoizedState:null;if(N.mode==="hidden")if((v.mode&1)===0)v.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ji(Te,Ee),Ee|=P;else{if((P&1073741824)===0)return m=ee!==null?ee.baseLanes|P:P,v.lanes=v.childLanes=1073741824,v.memoizedState={baseLanes:m,cachePool:null,transitions:null},v.updateQueue=null,Ji(Te,Ee),Ee|=m,null;v.memoizedState={baseLanes:0,cachePool:null,transitions:null},N=ee!==null?ee.baseLanes:P,Ji(Te,Ee),Ee|=N}else ee!==null?(N=ee.baseLanes|P,v.memoizedState=null):N=P,Ji(Te,Ee),Ee|=N;return Yo(m,v,W,P),v.child}function Qp(m,v){var P=v.ref;(m===null&&P!==null||m!==null&&m.ref!==P)&&(v.flags|=512,v.flags|=2097152)}function qf(m,v,P,N,W){var ee=ha(P)?vl:zo.current;return ee=sc(v,ee),qt(v,W),P=qe(m,v,P,N,ee,W),N=us(),m!==null&&!Xo?(v.updateQueue=m.updateQueue,v.flags&=-2053,m.lanes&=~W,Va(m,v,W)):(Qi&&N&&wl(v),v.flags|=1,Yo(m,v,P,W),v.child)}function em(m,v,P,N,W){if(ha(P)){var ee=!0;Lu(v)}else ee=!1;if(qt(v,W),v.stateNode===null)Kf(m,v),Gd(v,P,N),qd(v,P,N,W),N=!0;else if(m===null){var be=v.stateNode,Ge=v.memoizedProps;be.props=Ge;var rt=be.context,kt=P.contextType;typeof kt=="object"&&kt!==null?kt=ba(kt):(kt=ha(P)?vl:zo.current,kt=sc(v,kt));var pr=P.getDerivedStateFromProps,yr=typeof pr=="function"||typeof be.getSnapshotBeforeUpdate=="function";yr||typeof be.UNSAFE_componentWillReceiveProps!="function"&&typeof be.componentWillReceiveProps!="function"||(Ge!==N||rt!==kt)&&Xh(v,be,N,kt),El=!1;var cr=v.memoizedState;be.state=cr,Lf(v,N,be,W),rt=v.memoizedState,Ge!==N||cr!==rt||ua.current||El?(typeof pr=="function"&&($d(v,P,pr,N),rt=v.memoizedState),(Ge=El||Uf(v,P,Ge,N,cr,rt,kt))?(yr||typeof be.UNSAFE_componentWillMount!="function"&&typeof be.componentWillMount!="function"||(typeof be.componentWillMount=="function"&&be.componentWillMount(),typeof be.UNSAFE_componentWillMount=="function"&&be.UNSAFE_componentWillMount()),typeof be.componentDidMount=="function"&&(v.flags|=4194308)):(typeof be.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=N,v.memoizedState=rt),be.props=N,be.state=rt,be.context=kt,N=Ge):(typeof be.componentDidMount=="function"&&(v.flags|=4194308),N=!1)}else{be=v.stateNode,Hp(m,v),Ge=v.memoizedProps,kt=v.type===v.elementType?Ge:Bo(v.type,Ge),be.props=kt,yr=v.pendingProps,cr=be.context,rt=P.contextType,typeof rt=="object"&&rt!==null?rt=ba(rt):(rt=ha(P)?vl:zo.current,rt=sc(v,rt));var $r=P.getDerivedStateFromProps;(pr=typeof $r=="function"||typeof be.getSnapshotBeforeUpdate=="function")||typeof be.UNSAFE_componentWillReceiveProps!="function"&&typeof be.componentWillReceiveProps!="function"||(Ge!==yr||cr!==rt)&&Xh(v,be,N,rt),El=!1,cr=v.memoizedState,be.state=cr,Lf(v,N,be,W);var nn=v.memoizedState;Ge!==yr||cr!==nn||ua.current||El?(typeof $r=="function"&&($d(v,P,$r,N),nn=v.memoizedState),(kt=El||Uf(v,P,kt,N,cr,nn,rt)||!1)?(pr||typeof be.UNSAFE_componentWillUpdate!="function"&&typeof be.componentWillUpdate!="function"||(typeof be.componentWillUpdate=="function"&&be.componentWillUpdate(N,nn,rt),typeof be.UNSAFE_componentWillUpdate=="function"&&be.UNSAFE_componentWillUpdate(N,nn,rt)),typeof be.componentDidUpdate=="function"&&(v.flags|=4),typeof be.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof be.componentDidUpdate!="function"||Ge===m.memoizedProps&&cr===m.memoizedState||(v.flags|=4),typeof be.getSnapshotBeforeUpdate!="function"||Ge===m.memoizedProps&&cr===m.memoizedState||(v.flags|=1024),v.memoizedProps=N,v.memoizedState=nn),be.props=N,be.state=nn,be.context=rt,N=kt):(typeof be.componentDidUpdate!="function"||Ge===m.memoizedProps&&cr===m.memoizedState||(v.flags|=4),typeof be.getSnapshotBeforeUpdate!="function"||Ge===m.memoizedProps&&cr===m.memoizedState||(v.flags|=1024),N=!1)}return Wf(m,v,P,N,ee,W)}function Wf(m,v,P,N,W,ee){Qp(m,v);var be=(v.flags&128)!==0;if(!N&&!be)return W&&Lh(v,P,!1),Va(m,v,ee);N=v.stateNode,Xd.current=v;var Ge=be&&typeof P.getDerivedStateFromError!="function"?null:N.render();return v.flags|=1,m!==null&&be?(v.child=Zs(v,m.child,null,ee),v.child=Zs(v,null,Ge,ee)):Yo(m,v,Ge,ee),v.memoizedState=N.state,W&&Lh(v,P,!0),v.child}function Hf(m){var v=m.stateNode;v.pendingContext?Od(m,v.pendingContext,v.pendingContext!==v.context):v.context&&Od(m,v.context,!1),Al(m,v.containerInfo)}function tm(m,v,P,N,W){return Bh(),Hs(W),v.flags|=256,Yo(m,v,P,N),v.child}var Zf={dehydrated:null,treeContext:null,retryLane:0};function Xf(m){return{baseLanes:m,cachePool:null,transitions:null}}function rm(m,v,P){var N=v.pendingProps,W=Hi.current,ee=!1,be=(v.flags&128)!==0,Ge;if((Ge=be)||(Ge=m!==null&&m.memoizedState===null?!1:(W&2)!==0),Ge?(ee=!0,v.flags&=-129):(m===null||m.memoizedState!==null)&&(W|=1),Ji(Hi,W&1),m===null)return kf(v),m=v.memoizedState,m!==null&&(m=m.dehydrated,m!==null)?((v.mode&1)===0?v.lanes=1:m.data==="$!"?v.lanes=8:v.lanes=1073741824,null):(be=N.children,m=N.fallback,ee?(N=v.mode,ee=v.child,be={mode:"hidden",children:be},(N&1)===0&&ee!==null?(ee.childLanes=0,ee.pendingProps=be):ee=Yu(be,N,0,null),m=zl(m,N,P,null),ee.return=v,m.return=v,ee.sibling=m,v.child=ee,v.child.memoizedState=Xf(P),v.memoizedState=Zf,m):Yf(v,be));if(W=m.memoizedState,W!==null&&(Ge=W.dehydrated,Ge!==null))return o_(m,v,be,N,Ge,W,P);if(ee){ee=N.fallback,be=v.mode,W=m.child,Ge=W.sibling;var rt={mode:"hidden",children:N.children};return(be&1)===0&&v.child!==W?(N=v.child,N.childLanes=0,N.pendingProps=rt,v.deletions=null):(N=ds(W,rt),N.subtreeFlags=W.subtreeFlags&14680064),Ge!==null?ee=ds(Ge,ee):(ee=zl(ee,be,P,null),ee.flags|=2),ee.return=v,N.return=v,N.sibling=ee,v.child=N,N=ee,ee=v.child,be=m.child.memoizedState,be=be===null?Xf(P):{baseLanes:be.baseLanes|P,cachePool:null,transitions:be.transitions},ee.memoizedState=be,ee.childLanes=m.childLanes&~P,v.memoizedState=Zf,N}return ee=m.child,m=ee.sibling,N=ds(ee,{mode:"visible",children:N.children}),(v.mode&1)===0&&(N.lanes=P),N.return=v,N.sibling=null,m!==null&&(P=v.deletions,P===null?(v.deletions=[m],v.flags|=16):P.push(m)),v.child=N,v.memoizedState=null,N}function Yf(m,v){return v=Yu({mode:"visible",children:v},m.mode,0,null),v.return=m,m.child=v}function Jd(m,v,P,N){return N!==null&&Hs(N),Zs(v,m.child,null,P),m=Yf(v,v.pendingProps.children),m.flags|=2,v.memoizedState=null,m}function o_(m,v,P,N,W,ee,be){if(P)return v.flags&256?(v.flags&=-257,N=Wd(Error(l(422))),Jd(m,v,be,N)):v.memoizedState!==null?(v.child=m.child,v.flags|=128,null):(ee=N.fallback,W=v.mode,N=Yu({mode:"visible",children:N.children},W,0,null),ee=zl(ee,W,be,null),ee.flags|=2,N.return=v,ee.return=v,N.sibling=ee,v.child=N,(v.mode&1)!==0&&Zs(v,m.child,null,be),v.child.memoizedState=Xf(be),v.memoizedState=Zf,ee);if((v.mode&1)===0)return Jd(m,v,be,null);if(W.data==="$!"){if(N=W.nextSibling&&W.nextSibling.dataset,N)var Ge=N.dgst;return N=Ge,ee=Error(l(419)),N=Wd(ee,N,void 0),Jd(m,v,be,N)}if(Ge=(be&m.childLanes)!==0,Xo||Ge){if(N=ce,N!==null){switch(be&-be){case 4:W=2;break;case 16:W=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:W=32;break;case 536870912:W=268435456;break;default:W=0}W=(W&(N.suspendedLanes|be))!==0?0:W,W!==0&&W!==ee.retryLane&&(ee.retryLane=W,_r(m,W),Wt(N,m,W,-1))}return zi(),N=Wd(Error(l(421))),Jd(m,v,be,N)}return W.data==="$?"?(v.flags|=128,v.child=m.child,v=Qo.bind(null,m),W._reactRetry=v,null):(m=ee.treeContext,ka=ic(W.nextSibling),so=v,Qi=!0,Es=null,m!==null&&(xa[as++]=xl,xa[as++]=bl,xa[as++]=ss,xl=m.id,bl=m.overflow,ss=v),v=Yf(v,N.children),v.flags|=4096,v)}function ig(m,v,P){m.lanes|=v;var N=m.alternate;N!==null&&(N.lanes|=v),Uu(m.return,v,P)}function Si(m,v,P,N,W){var ee=m.memoizedState;ee===null?m.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:N,tail:P,tailMode:W}:(ee.isBackwards=v,ee.rendering=null,ee.renderingStartTime=0,ee.last=N,ee.tail=P,ee.tailMode=W)}function nm(m,v,P){var N=v.pendingProps,W=N.revealOrder,ee=N.tail;if(Yo(m,v,N.children,P),N=Hi.current,(N&2)!==0)N=N&1|2,v.flags|=128;else{if(m!==null&&(m.flags&128)!==0)e:for(m=v.child;m!==null;){if(m.tag===13)m.memoizedState!==null&&ig(m,P,v);else if(m.tag===19)ig(m,P,v);else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===v)break e;for(;m.sibling===null;){if(m.return===null||m.return===v)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}N&=1}if(Ji(Hi,N),(v.mode&1)===0)v.memoizedState=null;else switch(W){case"forwards":for(P=v.child,W=null;P!==null;)m=P.alternate,m!==null&&Nd(m)===null&&(W=P),P=P.sibling;P=W,P===null?(W=v.child,v.child=null):(W=P.sibling,P.sibling=null),Si(v,!1,W,P,ee);break;case"backwards":for(P=null,W=v.child,v.child=null;W!==null;){if(m=W.alternate,m!==null&&Nd(m)===null){v.child=W;break}m=W.sibling,W.sibling=P,P=W,W=m}Si(v,!0,P,null,ee);break;case"together":Si(v,!1,null,null,void 0);break;default:v.memoizedState=null}return v.child}function Kf(m,v){(v.mode&1)===0&&m!==null&&(m.alternate=null,v.alternate=null,v.flags|=2)}function Va(m,v,P){if(m!==null&&(v.dependencies=m.dependencies),Ie|=v.lanes,(P&v.childLanes)===0)return null;if(m!==null&&v.child!==m.child)throw Error(l(153));if(v.child!==null){for(m=v.child,P=ds(m,m.pendingProps),v.child=P,P.return=v;m.sibling!==null;)m=m.sibling,P=P.sibling=ds(m,m.pendingProps),P.return=v;P.sibling=null}return v.child}function a_(m,v,P){switch(v.tag){case 3:Hf(v),Bh();break;case 5:Fd(v);break;case 1:ha(v.type)&&Lu(v);break;case 4:Al(v,v.stateNode.containerInfo);break;case 10:var N=v.type._context,W=v.memoizedProps.value;Ji(qc,N._currentValue),N._currentValue=W;break;case 13:if(N=v.memoizedState,N!==null)return N.dehydrated!==null?(Ji(Hi,Hi.current&1),v.flags|=128,null):(P&v.child.childLanes)!==0?rm(m,v,P):(Ji(Hi,Hi.current&1),m=Va(m,v,P),m!==null?m.sibling:null);Ji(Hi,Hi.current&1);break;case 19:if(N=(P&v.childLanes)!==0,(m.flags&128)!==0){if(N)return nm(m,v,P);v.flags|=128}if(W=v.memoizedState,W!==null&&(W.rendering=null,W.tail=null,W.lastEffect=null),Ji(Hi,Hi.current),N)break;return null;case 22:case 23:return v.lanes=0,Kd(m,v,P)}return Va(m,v,P)}var Xu,Jf,Qd,Kh;Xu=function(m,v){for(var P=v.child;P!==null;){if(P.tag===5||P.tag===6)m.appendChild(P.stateNode);else if(P.tag!==4&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===v)break;for(;P.sibling===null;){if(P.return===null||P.return===v)return;P=P.return}P.sibling.return=P.return,P=P.sibling}},Jf=function(){},Qd=function(m,v,P,N){var W=m.memoizedProps;if(W!==N){m=v.stateNode,Fo(As.current);var ee=null;switch(P){case"input":W=fr(m,W),N=fr(m,N),ee=[];break;case"select":W=Ft({},W,{value:void 0}),N=Ft({},N,{value:void 0}),ee=[];break;case"textarea":W=ti(m,W),N=ti(m,N),ee=[];break;default:typeof W.onClick!="function"&&typeof N.onClick=="function"&&(m.onclick=Uc)}zn(P,N);var be;P=null;for(kt in W)if(!N.hasOwnProperty(kt)&&W.hasOwnProperty(kt)&&W[kt]!=null)if(kt==="style"){var Ge=W[kt];for(be in Ge)Ge.hasOwnProperty(be)&&(P||(P={}),P[be]="")}else kt!=="dangerouslySetInnerHTML"&&kt!=="children"&&kt!=="suppressContentEditableWarning"&&kt!=="suppressHydrationWarning"&&kt!=="autoFocus"&&(y.hasOwnProperty(kt)?ee||(ee=[]):(ee=ee||[]).push(kt,null));for(kt in N){var rt=N[kt];if(Ge=W!=null?W[kt]:void 0,N.hasOwnProperty(kt)&&rt!==Ge&&(rt!=null||Ge!=null))if(kt==="style")if(Ge){for(be in Ge)!Ge.hasOwnProperty(be)||rt&&rt.hasOwnProperty(be)||(P||(P={}),P[be]="");for(be in rt)rt.hasOwnProperty(be)&&Ge[be]!==rt[be]&&(P||(P={}),P[be]=rt[be])}else P||(ee||(ee=[]),ee.push(kt,P)),P=rt;else kt==="dangerouslySetInnerHTML"?(rt=rt?rt.__html:void 0,Ge=Ge?Ge.__html:void 0,rt!=null&&Ge!==rt&&(ee=ee||[]).push(kt,rt)):kt==="children"?typeof rt!="string"&&typeof rt!="number"||(ee=ee||[]).push(kt,""+rt):kt!=="suppressContentEditableWarning"&&kt!=="suppressHydrationWarning"&&(y.hasOwnProperty(kt)?(rt!=null&&kt==="onScroll"&&ao("scroll",m),ee||Ge===rt||(ee=[])):(ee=ee||[]).push(kt,rt))}P&&(ee=ee||[]).push("style",P);var kt=ee;(v.updateQueue=kt)&&(v.flags|=4)}},Kh=function(m,v,P,N){P!==N&&(v.flags|=4)};function $a(m,v){if(!Qi)switch(m.tailMode){case"hidden":v=m.tail;for(var P=null;v!==null;)v.alternate!==null&&(P=v),v=v.sibling;P===null?m.tail=null:P.sibling=null;break;case"collapsed":P=m.tail;for(var N=null;P!==null;)P.alternate!==null&&(N=P),P=P.sibling;N===null?v||m.tail===null?m.tail=null:m.tail.sibling=null:N.sibling=null}}function Ko(m){var v=m.alternate!==null&&m.alternate.child===m.child,P=0,N=0;if(v)for(var W=m.child;W!==null;)P|=W.lanes|W.childLanes,N|=W.subtreeFlags&14680064,N|=W.flags&14680064,W.return=m,W=W.sibling;else for(W=m.child;W!==null;)P|=W.lanes|W.childLanes,N|=W.subtreeFlags,N|=W.flags,W.return=m,W=W.sibling;return m.subtreeFlags|=N,m.childLanes=P,v}function ro(m,v,P){var N=v.pendingProps;switch(Of(v),v.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ko(v),null;case 1:return ha(v.type)&&Rh(),Ko(v),null;case 3:return N=v.stateNode,Is(),Ui(ua),Ui(zo),$n(),N.pendingContext&&(N.context=N.pendingContext,N.pendingContext=null),(m===null||m.child===null)&&(Sl(v)?v.flags|=4:m===null||m.memoizedState.isDehydrated&&(v.flags&256)===0||(v.flags|=1024,Es!==null&&(Gn(Es),Es=null))),Jf(m,v),Ko(v),null;case 5:Vh(v);var W=Fo(Gu.current);if(P=v.type,m!==null&&v.stateNode!=null)Qd(m,v,P,N,W),m.ref!==v.ref&&(v.flags|=512,v.flags|=2097152);else{if(!N){if(v.stateNode===null)throw Error(l(166));return Ko(v),null}if(m=Fo(As.current),Sl(v)){N=v.stateNode,P=v.type;var ee=v.memoizedProps;switch(N[Da]=v,N[Dh]=ee,m=(v.mode&1)!==0,P){case"dialog":ao("cancel",N),ao("close",N);break;case"iframe":case"object":case"embed":ao("load",N);break;case"video":case"audio":for(W=0;W<Mu.length;W++)ao(Mu[W],N);break;case"source":ao("error",N);break;case"img":case"image":case"link":ao("error",N),ao("load",N);break;case"details":ao("toggle",N);break;case"input":jr(N,ee),ao("invalid",N);break;case"select":N._wrapperState={wasMultiple:!!ee.multiple},ao("invalid",N);break;case"textarea":$i(N,ee),ao("invalid",N)}zn(P,ee),W=null;for(var be in ee)if(ee.hasOwnProperty(be)){var Ge=ee[be];be==="children"?typeof Ge=="string"?N.textContent!==Ge&&(ee.suppressHydrationWarning!==!0&&nc(N.textContent,Ge,m),W=["children",Ge]):typeof Ge=="number"&&N.textContent!==""+Ge&&(ee.suppressHydrationWarning!==!0&&nc(N.textContent,Ge,m),W=["children",""+Ge]):y.hasOwnProperty(be)&&Ge!=null&&be==="onScroll"&&ao("scroll",N)}switch(P){case"input":Tn(N),uo(N,ee,!0);break;case"textarea":Tn(N),Ii(N);break;case"select":case"option":break;default:typeof ee.onClick=="function"&&(N.onclick=Uc)}N=W,v.updateQueue=N,N!==null&&(v.flags|=4)}else{be=W.nodeType===9?W:W.ownerDocument,m==="http://www.w3.org/1999/xhtml"&&(m=ci(P)),m==="http://www.w3.org/1999/xhtml"?P==="script"?(m=be.createElement("div"),m.innerHTML="<script><\/script>",m=m.removeChild(m.firstChild)):typeof N.is=="string"?m=be.createElement(P,{is:N.is}):(m=be.createElement(P),P==="select"&&(be=m,N.multiple?be.multiple=!0:N.size&&(be.size=N.size))):m=be.createElementNS(m,P),m[Da]=v,m[Dh]=N,Xu(m,v,!1,!1),v.stateNode=m;e:{switch(be=Cn(P,N),P){case"dialog":ao("cancel",m),ao("close",m),W=N;break;case"iframe":case"object":case"embed":ao("load",m),W=N;break;case"video":case"audio":for(W=0;W<Mu.length;W++)ao(Mu[W],m);W=N;break;case"source":ao("error",m),W=N;break;case"img":case"image":case"link":ao("error",m),ao("load",m),W=N;break;case"details":ao("toggle",m),W=N;break;case"input":jr(m,N),W=fr(m,N),ao("invalid",m);break;case"option":W=N;break;case"select":m._wrapperState={wasMultiple:!!N.multiple},W=Ft({},N,{value:void 0}),ao("invalid",m);break;case"textarea":$i(m,N),W=ti(m,N),ao("invalid",m);break;default:W=N}zn(P,W),Ge=W;for(ee in Ge)if(Ge.hasOwnProperty(ee)){var rt=Ge[ee];ee==="style"?pa(m,rt):ee==="dangerouslySetInnerHTML"?(rt=rt?rt.__html:void 0,rt!=null&&oa(m,rt)):ee==="children"?typeof rt=="string"?(P!=="textarea"||rt!=="")&&ta(m,rt):typeof rt=="number"&&ta(m,""+rt):ee!=="suppressContentEditableWarning"&&ee!=="suppressHydrationWarning"&&ee!=="autoFocus"&&(y.hasOwnProperty(ee)?rt!=null&&ee==="onScroll"&&ao("scroll",m):rt!=null&&ke(m,ee,rt,be))}switch(P){case"input":Tn(m),uo(m,N,!1);break;case"textarea":Tn(m),Ii(m);break;case"option":N.value!=null&&m.setAttribute("value",""+wn(N.value));break;case"select":m.multiple=!!N.multiple,ee=N.value,ee!=null?ii(m,!!N.multiple,ee,!1):N.defaultValue!=null&&ii(m,!!N.multiple,N.defaultValue,!0);break;default:typeof W.onClick=="function"&&(m.onclick=Uc)}switch(P){case"button":case"input":case"select":case"textarea":N=!!N.autoFocus;break e;case"img":N=!0;break e;default:N=!1}}N&&(v.flags|=4)}v.ref!==null&&(v.flags|=512,v.flags|=2097152)}return Ko(v),null;case 6:if(m&&v.stateNode!=null)Kh(m,v,m.memoizedProps,N);else{if(typeof N!="string"&&v.stateNode===null)throw Error(l(166));if(P=Fo(Gu.current),Fo(As.current),Sl(v)){if(N=v.stateNode,P=v.memoizedProps,N[Da]=v,(ee=N.nodeValue!==P)&&(m=so,m!==null))switch(m.tag){case 3:nc(N.nodeValue,P,(m.mode&1)!==0);break;case 5:m.memoizedProps.suppressHydrationWarning!==!0&&nc(N.nodeValue,P,(m.mode&1)!==0)}ee&&(v.flags|=4)}else N=(P.nodeType===9?P:P.ownerDocument).createTextNode(N),N[Da]=v,v.stateNode=N}return Ko(v),null;case 13:if(Ui(Hi),N=v.memoizedState,m===null||m.memoizedState!==null&&m.memoizedState.dehydrated!==null){if(Qi&&ka!==null&&(v.mode&1)!==0&&(v.flags&128)===0)qp(),Bh(),v.flags|=98560,ee=!1;else if(ee=Sl(v),N!==null&&N.dehydrated!==null){if(m===null){if(!ee)throw Error(l(318));if(ee=v.memoizedState,ee=ee!==null?ee.dehydrated:null,!ee)throw Error(l(317));ee[Da]=v}else Bh(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;Ko(v),ee=!1}else Es!==null&&(Gn(Es),Es=null),ee=!0;if(!ee)return v.flags&65536?v:null}return(v.flags&128)!==0?(v.lanes=P,v):(N=N!==null,N!==(m!==null&&m.memoizedState!==null)&&N&&(v.child.flags|=8192,(v.mode&1)!==0&&(m===null||(Hi.current&1)!==0?we===0&&(we=3):zi())),v.updateQueue!==null&&(v.flags|=4),Ko(v),null);case 4:return Is(),Jf(m,v),m===null&&Id(v.stateNode.containerInfo),Ko(v),null;case 10:return Hc(v.type._context),Ko(v),null;case 17:return ha(v.type)&&Rh(),Ko(v),null;case 19:if(Ui(Hi),ee=v.memoizedState,ee===null)return Ko(v),null;if(N=(v.flags&128)!==0,be=ee.rendering,be===null)if(N)$a(ee,!1);else{if(we!==0||m!==null&&(m.flags&128)!==0)for(m=v.child;m!==null;){if(be=Nd(m),be!==null){for(v.flags|=128,$a(ee,!1),N=be.updateQueue,N!==null&&(v.updateQueue=N,v.flags|=4),v.subtreeFlags=0,N=P,P=v.child;P!==null;)ee=P,m=N,ee.flags&=14680066,be=ee.alternate,be===null?(ee.childLanes=0,ee.lanes=m,ee.child=null,ee.subtreeFlags=0,ee.memoizedProps=null,ee.memoizedState=null,ee.updateQueue=null,ee.dependencies=null,ee.stateNode=null):(ee.childLanes=be.childLanes,ee.lanes=be.lanes,ee.child=be.child,ee.subtreeFlags=0,ee.deletions=null,ee.memoizedProps=be.memoizedProps,ee.memoizedState=be.memoizedState,ee.updateQueue=be.updateQueue,ee.type=be.type,m=be.dependencies,ee.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext}),P=P.sibling;return Ji(Hi,Hi.current&1|2),v.child}m=m.sibling}ee.tail!==null&&hn()>Et&&(v.flags|=128,N=!0,$a(ee,!1),v.lanes=4194304)}else{if(!N)if(m=Nd(be),m!==null){if(v.flags|=128,N=!0,P=m.updateQueue,P!==null&&(v.updateQueue=P,v.flags|=4),$a(ee,!0),ee.tail===null&&ee.tailMode==="hidden"&&!be.alternate&&!Qi)return Ko(v),null}else 2*hn()-ee.renderingStartTime>Et&&P!==1073741824&&(v.flags|=128,N=!0,$a(ee,!1),v.lanes=4194304);ee.isBackwards?(be.sibling=v.child,v.child=be):(P=ee.last,P!==null?P.sibling=be:v.child=be,ee.last=be)}return ee.tail!==null?(v=ee.tail,ee.rendering=v,ee.tail=v.sibling,ee.renderingStartTime=hn(),v.sibling=null,P=Hi.current,Ji(Hi,N?P&1|2:P&1),v):(Ko(v),null);case 22:case 23:return _n(),N=v.memoizedState!==null,m!==null&&m.memoizedState!==null!==N&&(v.flags|=8192),N&&(v.mode&1)!==0?(Ee&1073741824)!==0&&(Ko(v),v.subtreeFlags&6&&(v.flags|=8192)):Ko(v),null;case 24:return null;case 25:return null}throw Error(l(156,v.tag))}function Js(m,v){switch(Of(v),v.tag){case 1:return ha(v.type)&&Rh(),m=v.flags,m&65536?(v.flags=m&-65537|128,v):null;case 3:return Is(),Ui(ua),Ui(zo),$n(),m=v.flags,(m&65536)!==0&&(m&128)===0?(v.flags=m&-65537|128,v):null;case 5:return Vh(v),null;case 13:if(Ui(Hi),m=v.memoizedState,m!==null&&m.dehydrated!==null){if(v.alternate===null)throw Error(l(340));Bh()}return m=v.flags,m&65536?(v.flags=m&-65537|128,v):null;case 19:return Ui(Hi),null;case 4:return Is(),null;case 10:return Hc(v.type._context),null;case 22:case 23:return _n(),null;case 24:return null;default:return null}}var eu=!1,Jo=!1,og=typeof WeakSet=="function"?WeakSet:Set,Wr=null;function Ol(m,v){var P=m.ref;if(P!==null)if(typeof P=="function")try{P(null)}catch(N){fn(m,v,N)}else P.current=null}function Qf(m,v,P){try{P()}catch(N){fn(m,v,N)}}var ep=!1;function Ps(m,v){if(Ch=Oc,m=wh(),bd(m)){if("selectionStart"in m)var P={start:m.selectionStart,end:m.selectionEnd};else e:{P=(P=m.ownerDocument)&&P.defaultView||window;var N=P.getSelection&&P.getSelection();if(N&&N.rangeCount!==0){P=N.anchorNode;var W=N.anchorOffset,ee=N.focusNode;N=N.focusOffset;try{P.nodeType,ee.nodeType}catch{P=null;break e}var be=0,Ge=-1,rt=-1,kt=0,pr=0,yr=m,cr=null;t:for(;;){for(var $r;yr!==P||W!==0&&yr.nodeType!==3||(Ge=be+W),yr!==ee||N!==0&&yr.nodeType!==3||(rt=be+N),yr.nodeType===3&&(be+=yr.nodeValue.length),($r=yr.firstChild)!==null;)cr=yr,yr=$r;for(;;){if(yr===m)break t;if(cr===P&&++kt===W&&(Ge=be),cr===ee&&++pr===N&&(rt=be),($r=yr.nextSibling)!==null)break;yr=cr,cr=yr.parentNode}yr=$r}P=Ge===-1||rt===-1?null:{start:Ge,end:rt}}else P=null}P=P||{start:0,end:0}}else P=null;for(Mh={focusedElem:m,selectionRange:P},Oc=!1,Wr=v;Wr!==null;)if(v=Wr,m=v.child,(v.subtreeFlags&1028)!==0&&m!==null)m.return=v,Wr=m;else for(;Wr!==null;){v=Wr;try{var nn=v.alternate;if((v.flags&1024)!==0)switch(v.tag){case 0:case 11:case 15:break;case 1:if(nn!==null){var ln=nn.memoizedProps,Uo=nn.memoizedState,wt=v.stateNode,ut=wt.getSnapshotBeforeUpdate(v.elementType===v.type?ln:Bo(v.type,ln),Uo);wt.__reactInternalSnapshotBeforeUpdate=ut}break;case 3:var Tt=v.stateNode.containerInfo;Tt.nodeType===1?Tt.textContent="":Tt.nodeType===9&&Tt.documentElement&&Tt.removeChild(Tt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(l(163))}}catch(ar){fn(v,v.return,ar)}if(m=v.sibling,m!==null){m.return=v.return,Wr=m;break}Wr=v.return}return nn=ep,ep=!1,nn}function mc(m,v,P){var N=v.updateQueue;if(N=N!==null?N.lastEffect:null,N!==null){var W=N=N.next;do{if((W.tag&m)===m){var ee=W.destroy;W.destroy=void 0,ee!==void 0&&Qf(v,P,ee)}W=W.next}while(W!==N)}}function tu(m,v){if(v=v.updateQueue,v=v!==null?v.lastEffect:null,v!==null){var P=v=v.next;do{if((P.tag&m)===m){var N=P.create;P.destroy=N()}P=P.next}while(P!==v)}}function ru(m){var v=m.ref;if(v!==null){var P=m.stateNode;switch(m.tag){case 5:m=P;break;default:m=P}typeof v=="function"?v(m):v.current=m}}function Dl(m){var v=m.alternate;v!==null&&(m.alternate=null,Dl(v)),m.child=null,m.deletions=null,m.sibling=null,m.tag===5&&(v=m.stateNode,v!==null&&(delete v[Da],delete v[Dh],delete v[Cd],delete v[r_],delete v[Pf])),m.stateNode=null,m.return=null,m.dependencies=null,m.memoizedProps=null,m.memoizedState=null,m.pendingProps=null,m.stateNode=null,m.updateQueue=null}function Cs(m){return m.tag===5||m.tag===3||m.tag===4}function Ms(m){e:for(;;){for(;m.sibling===null;){if(m.return===null||Cs(m.return))return null;m=m.return}for(m.sibling.return=m.return,m=m.sibling;m.tag!==5&&m.tag!==6&&m.tag!==18;){if(m.flags&2||m.child===null||m.tag===4)continue e;m.child.return=m,m=m.child}if(!(m.flags&2))return m.stateNode}}function kl(m,v,P){var N=m.tag;if(N===5||N===6)m=m.stateNode,v?P.nodeType===8?P.parentNode.insertBefore(m,v):P.insertBefore(m,v):(P.nodeType===8?(v=P.parentNode,v.insertBefore(m,P)):(v=P,v.appendChild(m)),P=P._reactRootContainer,P!=null||v.onclick!==null||(v.onclick=Uc));else if(N!==4&&(m=m.child,m!==null))for(kl(m,v,P),m=m.sibling;m!==null;)kl(m,v,P),m=m.sibling}function gc(m,v,P){var N=m.tag;if(N===5||N===6)m=m.stateNode,v?P.insertBefore(m,v):P.appendChild(m);else if(N!==4&&(m=m.child,m!==null))for(gc(m,v,P),m=m.sibling;m!==null;)gc(m,v,P),m=m.sibling}var d=null,r=!1;function s(m,v,P){for(P=P.child;P!==null;)f(m,v,P),P=P.sibling}function f(m,v,P){if(eo&&typeof eo.onCommitFiberUnmount=="function")try{eo.onCommitFiberUnmount(ko,P)}catch{}switch(P.tag){case 5:Jo||Ol(P,v);case 6:var N=d,W=r;d=null,s(m,v,P),d=N,r=W,d!==null&&(r?(m=d,P=P.stateNode,m.nodeType===8?m.parentNode.removeChild(P):m.removeChild(P)):d.removeChild(P.stateNode));break;case 18:d!==null&&(r?(m=d,P=P.stateNode,m.nodeType===8?Du(m.parentNode,P):m.nodeType===1&&Du(m,P),bu(m)):Du(d,P.stateNode));break;case 4:N=d,W=r,d=P.stateNode.containerInfo,r=!0,s(m,v,P),d=N,r=W;break;case 0:case 11:case 14:case 15:if(!Jo&&(N=P.updateQueue,N!==null&&(N=N.lastEffect,N!==null))){W=N=N.next;do{var ee=W,be=ee.destroy;ee=ee.tag,be!==void 0&&((ee&2)!==0||(ee&4)!==0)&&Qf(P,v,be),W=W.next}while(W!==N)}s(m,v,P);break;case 1:if(!Jo&&(Ol(P,v),N=P.stateNode,typeof N.componentWillUnmount=="function"))try{N.props=P.memoizedProps,N.state=P.memoizedState,N.componentWillUnmount()}catch(Ge){fn(P,v,Ge)}s(m,v,P);break;case 21:s(m,v,P);break;case 22:P.mode&1?(Jo=(N=Jo)||P.memoizedState!==null,s(m,v,P),Jo=N):s(m,v,P);break;default:s(m,v,P)}}function _(m){var v=m.updateQueue;if(v!==null){m.updateQueue=null;var P=m.stateNode;P===null&&(P=m.stateNode=new og),v.forEach(function(N){var W=Qs.bind(null,m,N);P.has(N)||(P.add(N),N.then(W,W))})}}function x(m,v){var P=v.deletions;if(P!==null)for(var N=0;N<P.length;N++){var W=P[N];try{var ee=m,be=v,Ge=be;e:for(;Ge!==null;){switch(Ge.tag){case 5:d=Ge.stateNode,r=!1;break e;case 3:d=Ge.stateNode.containerInfo,r=!0;break e;case 4:d=Ge.stateNode.containerInfo,r=!0;break e}Ge=Ge.return}if(d===null)throw Error(l(160));f(ee,be,W),d=null,r=!1;var rt=W.alternate;rt!==null&&(rt.return=null),W.return=null}catch(kt){fn(W,v,kt)}}if(v.subtreeFlags&12854)for(v=v.child;v!==null;)S(v,m),v=v.sibling}function S(m,v){var P=m.alternate,N=m.flags;switch(m.tag){case 0:case 11:case 14:case 15:if(x(v,m),E(m),N&4){try{mc(3,m,m.return),tu(3,m)}catch(ln){fn(m,m.return,ln)}try{mc(5,m,m.return)}catch(ln){fn(m,m.return,ln)}}break;case 1:x(v,m),E(m),N&512&&P!==null&&Ol(P,P.return);break;case 5:if(x(v,m),E(m),N&512&&P!==null&&Ol(P,P.return),m.flags&32){var W=m.stateNode;try{ta(W,"")}catch(ln){fn(m,m.return,ln)}}if(N&4&&(W=m.stateNode,W!=null)){var ee=m.memoizedProps,be=P!==null?P.memoizedProps:ee,Ge=m.type,rt=m.updateQueue;if(m.updateQueue=null,rt!==null)try{Ge==="input"&&ee.type==="radio"&&ee.name!=null&&mr(W,ee),Cn(Ge,be);var kt=Cn(Ge,ee);for(be=0;be<rt.length;be+=2){var pr=rt[be],yr=rt[be+1];pr==="style"?pa(W,yr):pr==="dangerouslySetInnerHTML"?oa(W,yr):pr==="children"?ta(W,yr):ke(W,pr,yr,kt)}switch(Ge){case"input":en(W,ee);break;case"textarea":Zn(W,ee);break;case"select":var cr=W._wrapperState.wasMultiple;W._wrapperState.wasMultiple=!!ee.multiple;var $r=ee.value;$r!=null?ii(W,!!ee.multiple,$r,!1):cr!==!!ee.multiple&&(ee.defaultValue!=null?ii(W,!!ee.multiple,ee.defaultValue,!0):ii(W,!!ee.multiple,ee.multiple?[]:"",!1))}W[Dh]=ee}catch(ln){fn(m,m.return,ln)}}break;case 6:if(x(v,m),E(m),N&4){if(m.stateNode===null)throw Error(l(162));W=m.stateNode,ee=m.memoizedProps;try{W.nodeValue=ee}catch(ln){fn(m,m.return,ln)}}break;case 3:if(x(v,m),E(m),N&4&&P!==null&&P.memoizedState.isDehydrated)try{bu(v.containerInfo)}catch(ln){fn(m,m.return,ln)}break;case 4:x(v,m),E(m);break;case 13:x(v,m),E(m),W=m.child,W.flags&8192&&(ee=W.memoizedState!==null,W.stateNode.isHidden=ee,!ee||W.alternate!==null&&W.alternate.memoizedState!==null||(ct=hn())),N&4&&_(m);break;case 22:if(pr=P!==null&&P.memoizedState!==null,m.mode&1?(Jo=(kt=Jo)||pr,x(v,m),Jo=kt):x(v,m),E(m),N&8192){if(kt=m.memoizedState!==null,(m.stateNode.isHidden=kt)&&!pr&&(m.mode&1)!==0)for(Wr=m,pr=m.child;pr!==null;){for(yr=Wr=pr;Wr!==null;){switch(cr=Wr,$r=cr.child,cr.tag){case 0:case 11:case 14:case 15:mc(4,cr,cr.return);break;case 1:Ol(cr,cr.return);var nn=cr.stateNode;if(typeof nn.componentWillUnmount=="function"){N=cr,P=cr.return;try{v=N,nn.props=v.memoizedProps,nn.state=v.memoizedState,nn.componentWillUnmount()}catch(ln){fn(N,P,ln)}}break;case 5:Ol(cr,cr.return);break;case 22:if(cr.memoizedState!==null){j(yr);continue}}$r!==null?($r.return=cr,Wr=$r):j(yr)}pr=pr.sibling}e:for(pr=null,yr=m;;){if(yr.tag===5){if(pr===null){pr=yr;try{W=yr.stateNode,kt?(ee=W.style,typeof ee.setProperty=="function"?ee.setProperty("display","none","important"):ee.display="none"):(Ge=yr.stateNode,rt=yr.memoizedProps.style,be=rt!=null&&rt.hasOwnProperty("display")?rt.display:null,Ge.style.display=fa("display",be))}catch(ln){fn(m,m.return,ln)}}}else if(yr.tag===6){if(pr===null)try{yr.stateNode.nodeValue=kt?"":yr.memoizedProps}catch(ln){fn(m,m.return,ln)}}else if((yr.tag!==22&&yr.tag!==23||yr.memoizedState===null||yr===m)&&yr.child!==null){yr.child.return=yr,yr=yr.child;continue}if(yr===m)break e;for(;yr.sibling===null;){if(yr.return===null||yr.return===m)break e;pr===yr&&(pr=null),yr=yr.return}pr===yr&&(pr=null),yr.sibling.return=yr.return,yr=yr.sibling}}break;case 19:x(v,m),E(m),N&4&&_(m);break;case 21:break;default:x(v,m),E(m)}}function E(m){var v=m.flags;if(v&2){try{e:{for(var P=m.return;P!==null;){if(Cs(P)){var N=P;break e}P=P.return}throw Error(l(160))}switch(N.tag){case 5:var W=N.stateNode;N.flags&32&&(ta(W,""),N.flags&=-33);var ee=Ms(m);gc(m,ee,W);break;case 3:case 4:var be=N.stateNode.containerInfo,Ge=Ms(m);kl(m,Ge,be);break;default:throw Error(l(161))}}catch(rt){fn(m,m.return,rt)}m.flags&=-3}v&4096&&(m.flags&=-4097)}function C(m,v,P){Wr=m,R(m)}function R(m,v,P){for(var N=(m.mode&1)!==0;Wr!==null;){var W=Wr,ee=W.child;if(W.tag===22&&N){var be=W.memoizedState!==null||eu;if(!be){var Ge=W.alternate,rt=Ge!==null&&Ge.memoizedState!==null||Jo;Ge=eu;var kt=Jo;if(eu=be,(Jo=rt)&&!kt)for(Wr=W;Wr!==null;)be=Wr,rt=be.child,be.tag===22&&be.memoizedState!==null?B(W):rt!==null?(rt.return=be,Wr=rt):B(W);for(;ee!==null;)Wr=ee,R(ee),ee=ee.sibling;Wr=W,eu=Ge,Jo=kt}F(m)}else(W.subtreeFlags&8772)!==0&&ee!==null?(ee.return=W,Wr=ee):F(m)}}function F(m){for(;Wr!==null;){var v=Wr;if((v.flags&8772)!==0){var P=v.alternate;try{if((v.flags&8772)!==0)switch(v.tag){case 0:case 11:case 15:Jo||tu(5,v);break;case 1:var N=v.stateNode;if(v.flags&4&&!Jo)if(P===null)N.componentDidMount();else{var W=v.elementType===v.type?P.memoizedProps:Bo(v.type,P.memoizedProps);N.componentDidUpdate(W,P.memoizedState,N.__reactInternalSnapshotBeforeUpdate)}var ee=v.updateQueue;ee!==null&&eg(v,ee,N);break;case 3:var be=v.updateQueue;if(be!==null){if(P=null,v.child!==null)switch(v.child.tag){case 5:P=v.child.stateNode;break;case 1:P=v.child.stateNode}eg(v,be,P)}break;case 5:var Ge=v.stateNode;if(P===null&&v.flags&4){P=Ge;var rt=v.memoizedProps;switch(v.type){case"button":case"input":case"select":case"textarea":rt.autoFocus&&P.focus();break;case"img":rt.src&&(P.src=rt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(v.memoizedState===null){var kt=v.alternate;if(kt!==null){var pr=kt.memoizedState;if(pr!==null){var yr=pr.dehydrated;yr!==null&&bu(yr)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(l(163))}Jo||v.flags&512&&ru(v)}catch(cr){fn(v,v.return,cr)}}if(v===m){Wr=null;break}if(P=v.sibling,P!==null){P.return=v.return,Wr=P;break}Wr=v.return}}function j(m){for(;Wr!==null;){var v=Wr;if(v===m){Wr=null;break}var P=v.sibling;if(P!==null){P.return=v.return,Wr=P;break}Wr=v.return}}function B(m){for(;Wr!==null;){var v=Wr;try{switch(v.tag){case 0:case 11:case 15:var P=v.return;try{tu(4,v)}catch(rt){fn(v,P,rt)}break;case 1:var N=v.stateNode;if(typeof N.componentDidMount=="function"){var W=v.return;try{N.componentDidMount()}catch(rt){fn(v,W,rt)}}var ee=v.return;try{ru(v)}catch(rt){fn(v,ee,rt)}break;case 5:var be=v.return;try{ru(v)}catch(rt){fn(v,be,rt)}}}catch(rt){fn(v,v.return,rt)}if(v===m){Wr=null;break}var Ge=v.sibling;if(Ge!==null){Ge.return=v.return,Wr=Ge;break}Wr=v.return}}var G=Math.ceil,J=et.ReactCurrentDispatcher,Y=et.ReactCurrentOwner,te=et.ReactCurrentBatchConfig,K=0,ce=null,fe=null,pe=0,Ee=0,Te=is(0),we=0,ye=null,Ie=0,Oe=0,Xe=0,je=null,st=null,ct=0,Et=1/0,Ve=null,He=!1,Ue=null,ft=null,Ke=!1,gt=null,dt=0,vt=0,bt=null,Yt=-1,tr=0;function Bt(){return(K&6)!==0?hn():Yt!==-1?Yt:Yt=hn()}function er(m){return(m.mode&1)===0?1:(K&2)!==0&&pe!==0?pe&-pe:i_.transition!==null?(tr===0&&(tr=yf()),tr):(m=hi,m!==0||(m=window.event,m=m===void 0?16:bf(m.type)),m)}function Wt(m,v,P,N){if(50<vt)throw vt=0,bt=null,Error(l(185));Pa(m,P,N),((K&2)===0||m!==ce)&&(m===ce&&((K&2)===0&&(Oe|=P),we===4&&Hr(m,pe)),hr(m,N),P===1&&K===0&&(v.mode&1)===0&&(Et=hn()+500,Dd&&cc()))}function hr(m,v){var P=m.callbackNode;Cp(m,v);var N=cl(m,m===ce?pe:0);if(N===0)P!==null&&tn(P),m.callbackNode=null,m.callbackPriority=0;else if(v=N&-N,m.callbackPriority!==v){if(P!=null&&tn(P),v===1)m.tag===0?n_(Li.bind(null,m)):Qm(Li.bind(null,m)),$p(function(){(K&6)===0&&cc()}),P=null;else{switch(es(N)){case 1:P=ji;break;case 4:P=oo;break;case 16:P=fo;break;case 536870912:P=sl;break;default:P=fo}P=za(P,Or.bind(null,m))}m.callbackPriority=v,m.callbackNode=P}}function Or(m,v){if(Yt=-1,tr=0,(K&6)!==0)throw Error(l(327));var P=m.callbackNode;if(ri()&&m.callbackNode!==P)return null;var N=cl(m,m===ce?pe:0);if(N===0)return null;if((N&30)!==0||(N&m.expiredLanes)!==0||v)v=Gi(m,N);else{v=N;var W=K;K|=2;var ee=no();(ce!==m||pe!==v)&&(Ve=null,Et=hn()+500,yn(m,v));do try{Zr();break}catch(Ge){Wn(m,Ge)}while(!0);zd(),J.current=ee,K=W,fe!==null?v=0:(ce=null,pe=0,v=we)}if(v!==0){if(v===2&&(W=Ja(m),W!==0&&(N=W,v=rn(m,W))),v===1)throw P=ye,yn(m,0),Hr(m,N),hr(m,hn()),P;if(v===6)Hr(m,N);else{if(W=m.current.alternate,(N&30)===0&&!qn(W)&&(v=Gi(m,N),v===2&&(ee=Ja(m),ee!==0&&(N=ee,v=rn(m,ee))),v===1))throw P=ye,yn(m,0),Hr(m,N),hr(m,hn()),P;switch(m.finishedWork=W,m.finishedLanes=N,v){case 0:case 1:throw Error(l(345));case 2:Yn(m,st,Ve);break;case 3:if(Hr(m,N),(N&130023424)===N&&(v=ct+500-hn(),10<v)){if(cl(m,0)!==0)break;if(W=m.suspendedLanes,(W&N)!==N){Bt(),m.pingedLanes|=m.suspendedLanes&W;break}m.timeoutHandle=Oh(Yn.bind(null,m,st,Ve),v);break}Yn(m,st,Ve);break;case 4:if(Hr(m,N),(N&4194240)===N)break;for(v=m.eventTimes,W=-1;0<N;){var be=31-Wi(N);ee=1<<be,be=v[be],be>W&&(W=be),N&=~ee}if(N=W,N=hn()-N,N=(120>N?120:480>N?480:1080>N?1080:1920>N?1920:3e3>N?3e3:4320>N?4320:1960*G(N/1960))-N,10<N){m.timeoutHandle=Oh(Yn.bind(null,m,st,Ve),N);break}Yn(m,st,Ve);break;case 5:Yn(m,st,Ve);break;default:throw Error(l(329))}}}return hr(m,hn()),m.callbackNode===P?Or.bind(null,m):null}function rn(m,v){var P=je;return m.current.memoizedState.isDehydrated&&(yn(m,v).flags|=256),m=Gi(m,v),m!==2&&(v=st,st=P,v!==null&&Gn(v)),m}function Gn(m){st===null?st=m:st.push.apply(st,m)}function qn(m){for(var v=m;;){if(v.flags&16384){var P=v.updateQueue;if(P!==null&&(P=P.stores,P!==null))for(var N=0;N<P.length;N++){var W=P[N],ee=W.getSnapshot;W=W.value;try{if(!ws(ee(),W))return!1}catch{return!1}}}if(P=v.child,v.subtreeFlags&16384&&P!==null)P.return=v,v=P;else{if(v===m)break;for(;v.sibling===null;){if(v.return===null||v.return===m)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function Hr(m,v){for(v&=~Xe,v&=~Oe,m.suspendedLanes|=v,m.pingedLanes&=~v,m=m.expirationTimes;0<v;){var P=31-Wi(v),N=1<<P;m[P]=-1,v&=~N}}function Li(m){if((K&6)!==0)throw Error(l(327));ri();var v=cl(m,0);if((v&1)===0)return hr(m,hn()),null;var P=Gi(m,v);if(m.tag!==0&&P===2){var N=Ja(m);N!==0&&(v=N,P=rn(m,N))}if(P===1)throw P=ye,yn(m,0),Hr(m,v),hr(m,hn()),P;if(P===6)throw Error(l(345));return m.finishedWork=m.current.alternate,m.finishedLanes=v,Yn(m,st,Ve),hr(m,hn()),null}function _i(m,v){var P=K;K|=1;try{return m(v)}finally{K=P,K===0&&(Et=hn()+500,Dd&&cc())}}function Rr(m){gt!==null&&gt.tag===0&&(K&6)===0&&ri();var v=K;K|=1;var P=te.transition,N=hi;try{if(te.transition=null,hi=1,m)return m()}finally{hi=N,te.transition=P,K=v,(K&6)===0&&cc()}}function _n(){Ee=Te.current,Ui(Te)}function yn(m,v){m.finishedWork=null,m.finishedLanes=0;var P=m.timeoutHandle;if(P!==-1&&(m.timeoutHandle=-1,Up(P)),fe!==null)for(P=fe.return;P!==null;){var N=P;switch(Of(N),N.tag){case 1:N=N.type.childContextTypes,N!=null&&Rh();break;case 3:Is(),Ui(ua),Ui(zo),$n();break;case 5:Vh(N);break;case 4:Is();break;case 13:Ui(Hi);break;case 19:Ui(Hi);break;case 10:Hc(N.type._context);break;case 22:case 23:_n()}P=P.return}if(ce=m,fe=m=ds(m.current,null),pe=Ee=v,we=0,ye=null,Xe=Oe=Ie=0,st=je=null,ls!==null){for(v=0;v<ls.length;v++)if(P=ls[v],N=P.interleaved,N!==null){P.interleaved=null;var W=N.next,ee=P.pending;if(ee!==null){var be=ee.next;ee.next=W,N.next=be}P.pending=N}ls=null}return m}function Wn(m,v){do{var P=fe;try{if(zd(),Zc.current=Hu,fc){for(var N=mo.memoizedState;N!==null;){var W=N.queue;W!==null&&(W.pending=null),N=N.next}fc=!1}if(Xc=0,ra=No=mo=null,Xs=!1,Ct=0,Y.current=null,P===null||P.return===null){we=1,ye=v,fe=null;break}e:{var ee=m,be=P.return,Ge=P,rt=v;if(v=pe,Ge.flags|=32768,rt!==null&&typeof rt=="object"&&typeof rt.then=="function"){var kt=rt,pr=Ge,yr=pr.tag;if((pr.mode&1)===0&&(yr===0||yr===11||yr===15)){var cr=pr.alternate;cr?(pr.updateQueue=cr.updateQueue,pr.memoizedState=cr.memoizedState,pr.lanes=cr.lanes):(pr.updateQueue=null,pr.memoizedState=null)}var $r=Qc(be);if($r!==null){$r.flags&=-257,$f($r,be,Ge,ee,v),$r.mode&1&&Zd(ee,kt,v),v=$r,rt=kt;var nn=v.updateQueue;if(nn===null){var ln=new Set;ln.add(rt),v.updateQueue=ln}else nn.add(rt);break e}else{if((v&1)===0){Zd(ee,kt,v),zi();break e}rt=Error(l(426))}}else if(Qi&&Ge.mode&1){var Uo=Qc(be);if(Uo!==null){(Uo.flags&65536)===0&&(Uo.flags|=256),$f(Uo,be,Ge,ee,v),Hs(to(rt,Ge));break e}}ee=rt=to(rt,Ge),we!==4&&(we=2),je===null?je=[ee]:je.push(ee),ee=be;do{switch(ee.tag){case 3:ee.flags|=65536,v&=-v,ee.lanes|=v;var wt=Yh(ee,rt,v);Zp(ee,wt);break e;case 1:Ge=rt;var ut=ee.type,Tt=ee.stateNode;if((ee.flags&128)===0&&(typeof ut.getDerivedStateFromError=="function"||Tt!==null&&typeof Tt.componentDidCatch=="function"&&(ft===null||!ft.has(Tt)))){ee.flags|=65536,v&=-v,ee.lanes|=v;var ar=Vf(ee,Ge,v);Zp(ee,ar);break e}}ee=ee.return}while(ee!==null)}In(P)}catch(pn){v=pn,fe===P&&P!==null&&(fe=P=P.return);continue}break}while(!0)}function no(){var m=J.current;return J.current=Hu,m===null?Hu:m}function zi(){(we===0||we===3||we===2)&&(we=4),ce===null||(Ie&268435455)===0&&(Oe&268435455)===0||Hr(ce,pe)}function Gi(m,v){var P=K;K|=2;var N=no();(ce!==m||pe!==v)&&(Ve=null,yn(m,v));do try{Ti();break}catch(W){Wn(m,W)}while(!0);if(zd(),K=P,J.current=N,fe!==null)throw Error(l(261));return ce=null,pe=0,we}function Ti(){for(;fe!==null;)di(fe)}function Zr(){for(;fe!==null&&!Jn();)di(fe)}function di(m){var v=Rl(m.alternate,m,Ee);m.memoizedProps=m.pendingProps,v===null?In(m):fe=v,Y.current=null}function In(m){var v=m;do{var P=v.alternate;if(m=v.return,(v.flags&32768)===0){if(P=ro(P,v,Ee),P!==null){fe=P;return}}else{if(P=Js(P,v),P!==null){P.flags&=32767,fe=P;return}if(m!==null)m.flags|=32768,m.subtreeFlags=0,m.deletions=null;else{we=6,fe=null;return}}if(v=v.sibling,v!==null){fe=v;return}fe=v=m}while(v!==null);we===0&&(we=5)}function Yn(m,v,P){var N=hi,W=te.transition;try{te.transition=null,hi=1,Fn(m,v,P,N)}finally{te.transition=W,hi=N}return null}function Fn(m,v,P,N){do ri();while(gt!==null);if((K&6)!==0)throw Error(l(327));P=m.finishedWork;var W=m.finishedLanes;if(P===null)return null;if(m.finishedWork=null,m.finishedLanes=0,P===m.current)throw Error(l(177));m.callbackNode=null,m.callbackPriority=0;var ee=P.lanes|P.childLanes;if(Xl(m,ee),m===ce&&(fe=ce=null,pe=0),(P.subtreeFlags&2064)===0&&(P.flags&2064)===0||Ke||(Ke=!0,za(fo,function(){return ri(),null})),ee=(P.flags&15990)!==0,(P.subtreeFlags&15990)!==0||ee){ee=te.transition,te.transition=null;var be=hi;hi=1;var Ge=K;K|=4,Y.current=null,Ps(m,P),S(P,m),Ts(Mh),Oc=!!Ch,Mh=Ch=null,m.current=P,C(P),Rn(),K=Ge,hi=be,te.transition=ee}else m.current=P;if(Ke&&(Ke=!1,gt=m,dt=W),ee=m.pendingLanes,ee===0&&(ft=null),Ro(P.stateNode),hr(m,hn()),v!==null)for(N=m.onRecoverableError,P=0;P<v.length;P++)W=v[P],N(W.value,{componentStack:W.stack,digest:W.digest});if(He)throw He=!1,m=Ue,Ue=null,m;return(dt&1)!==0&&m.tag!==0&&ri(),ee=m.pendingLanes,(ee&1)!==0?m===bt?vt++:(vt=0,bt=m):vt=0,cc(),null}function ri(){if(gt!==null){var m=es(dt),v=te.transition,P=hi;try{if(te.transition=null,hi=16>m?16:m,gt===null)var N=!1;else{if(m=gt,gt=null,dt=0,(K&6)!==0)throw Error(l(331));var W=K;for(K|=4,Wr=m.current;Wr!==null;){var ee=Wr,be=ee.child;if((Wr.flags&16)!==0){var Ge=ee.deletions;if(Ge!==null){for(var rt=0;rt<Ge.length;rt++){var kt=Ge[rt];for(Wr=kt;Wr!==null;){var pr=Wr;switch(pr.tag){case 0:case 11:case 15:mc(8,pr,ee)}var yr=pr.child;if(yr!==null)yr.return=pr,Wr=yr;else for(;Wr!==null;){pr=Wr;var cr=pr.sibling,$r=pr.return;if(Dl(pr),pr===kt){Wr=null;break}if(cr!==null){cr.return=$r,Wr=cr;break}Wr=$r}}}var nn=ee.alternate;if(nn!==null){var ln=nn.child;if(ln!==null){nn.child=null;do{var Uo=ln.sibling;ln.sibling=null,ln=Uo}while(ln!==null)}}Wr=ee}}if((ee.subtreeFlags&2064)!==0&&be!==null)be.return=ee,Wr=be;else e:for(;Wr!==null;){if(ee=Wr,(ee.flags&2048)!==0)switch(ee.tag){case 0:case 11:case 15:mc(9,ee,ee.return)}var wt=ee.sibling;if(wt!==null){wt.return=ee.return,Wr=wt;break e}Wr=ee.return}}var ut=m.current;for(Wr=ut;Wr!==null;){be=Wr;var Tt=be.child;if((be.subtreeFlags&2064)!==0&&Tt!==null)Tt.return=be,Wr=Tt;else e:for(be=ut;Wr!==null;){if(Ge=Wr,(Ge.flags&2048)!==0)try{switch(Ge.tag){case 0:case 11:case 15:tu(9,Ge)}}catch(pn){fn(Ge,Ge.return,pn)}if(Ge===be){Wr=null;break e}var ar=Ge.sibling;if(ar!==null){ar.return=Ge.return,Wr=ar;break e}Wr=Ge.return}}if(K=W,cc(),eo&&typeof eo.onPostCommitFiberRoot=="function")try{eo.onPostCommitFiberRoot(ko,m)}catch{}N=!0}return N}finally{hi=P,te.transition=v}}return!1}function To(m,v,P){v=to(P,v),v=Yh(m,v,1),m=dc(m,v,1),v=Bt(),m!==null&&(Pa(m,1,v),hr(m,v))}function fn(m,v,P){if(m.tag===3)To(m,m,P);else for(;v!==null;){if(v.tag===3){To(v,m,P);break}else if(v.tag===1){var N=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof N.componentDidCatch=="function"&&(ft===null||!ft.has(N))){m=to(P,m),m=Vf(v,m,1),v=dc(v,m,1),m=Bt(),v!==null&&(Pa(v,1,m),hr(v,m));break}}v=v.return}}function jo(m,v,P){var N=m.pingCache;N!==null&&N.delete(v),v=Bt(),m.pingedLanes|=m.suspendedLanes&P,ce===m&&(pe&P)===P&&(we===4||we===3&&(pe&130023424)===pe&&500>hn()-ct?yn(m,0):Xe|=P),hr(m,v)}function Zi(m,v){v===0&&((m.mode&1)===0?v=1:(v=yu,yu<<=1,(yu&130023424)===0&&(yu=4194304)));var P=Bt();m=_r(m,v),m!==null&&(Pa(m,v,P),hr(m,P))}function Qo(m){var v=m.memoizedState,P=0;v!==null&&(P=v.retryLane),Zi(m,P)}function Qs(m,v){var P=0;switch(m.tag){case 13:var N=m.stateNode,W=m.memoizedState;W!==null&&(P=W.retryLane);break;case 19:N=m.stateNode;break;default:throw Error(l(314))}N!==null&&N.delete(v),Zi(m,P)}var Rl;Rl=function(m,v,P){if(m!==null)if(m.memoizedProps!==v.pendingProps||ua.current)Xo=!0;else{if((m.lanes&P)===0&&(v.flags&128)===0)return Xo=!1,a_(m,v,P);Xo=(m.flags&131072)!==0}else Xo=!1,Qi&&(v.flags&1048576)!==0&&kd(v,Fh,v.index);switch(v.lanes=0,v.tag){case 2:var N=v.type;Kf(m,v),m=v.pendingProps;var W=sc(v,zo.current);qt(v,P),W=qe(null,v,N,m,W,P);var ee=us();return v.flags|=1,typeof W=="object"&&W!==null&&typeof W.render=="function"&&W.$$typeof===void 0?(v.tag=1,v.memoizedState=null,v.updateQueue=null,ha(N)?(ee=!0,Lu(v)):ee=!1,v.memoizedState=W.state!==null&&W.state!==void 0?W.state:null,Wp(v),W.updater=Ks,v.stateNode=W,W._reactInternals=v,qd(v,N,m,P),v=Wf(null,v,N,!0,ee,P)):(v.tag=0,Qi&&ee&&wl(v),Yo(null,v,W,P),v=v.child),v;case 16:N=v.elementType;e:{switch(Kf(m,v),m=v.pendingProps,W=N._init,N=W(N._payload),v.type=N,W=v.tag=el(N),m=Bo(N,m),W){case 0:v=qf(null,v,N,m,P);break e;case 1:v=em(null,v,N,m,P);break e;case 11:v=Gf(null,v,N,m,P);break e;case 14:v=Yd(null,v,N,Bo(N.type,m),P);break e}throw Error(l(306,N,""))}return v;case 0:return N=v.type,W=v.pendingProps,W=v.elementType===N?W:Bo(N,W),qf(m,v,N,W,P);case 1:return N=v.type,W=v.pendingProps,W=v.elementType===N?W:Bo(N,W),em(m,v,N,W,P);case 3:e:{if(Hf(v),m===null)throw Error(l(387));N=v.pendingProps,ee=v.memoizedState,W=ee.element,Hp(m,v),Lf(v,N,null,P);var be=v.memoizedState;if(N=be.element,ee.isDehydrated)if(ee={element:N,isDehydrated:!1,cache:be.cache,pendingSuspenseBoundaries:be.pendingSuspenseBoundaries,transitions:be.transitions},v.updateQueue.baseState=ee,v.memoizedState=ee,v.flags&256){W=to(Error(l(423)),v),v=tm(m,v,N,P,W);break e}else if(N!==W){W=to(Error(l(424)),v),v=tm(m,v,N,P,W);break e}else for(ka=ic(v.stateNode.containerInfo.firstChild),so=v,Qi=!0,Es=null,P=jh(v,null,N,P),v.child=P;P;)P.flags=P.flags&-3|4096,P=P.sibling;else{if(Bh(),N===W){v=Va(m,v,P);break e}Yo(m,v,N,P)}v=v.child}return v;case 5:return Fd(v),m===null&&kf(v),N=v.type,W=v.pendingProps,ee=m!==null?m.memoizedProps:null,be=W.children,Vc(N,W)?be=null:ee!==null&&Vc(N,ee)&&(v.flags|=32),Qp(m,v),Yo(m,v,be,P),v.child;case 6:return m===null&&kf(v),null;case 13:return rm(m,v,P);case 4:return Al(v,v.stateNode.containerInfo),N=v.pendingProps,m===null?v.child=Zs(v,null,N,P):Yo(m,v,N,P),v.child;case 11:return N=v.type,W=v.pendingProps,W=v.elementType===N?W:Bo(N,W),Gf(m,v,N,W,P);case 7:return Yo(m,v,v.pendingProps,P),v.child;case 8:return Yo(m,v,v.pendingProps.children,P),v.child;case 12:return Yo(m,v,v.pendingProps.children,P),v.child;case 10:e:{if(N=v.type._context,W=v.pendingProps,ee=v.memoizedProps,be=W.value,Ji(qc,N._currentValue),N._currentValue=be,ee!==null)if(ws(ee.value,be)){if(ee.children===W.children&&!ua.current){v=Va(m,v,P);break e}}else for(ee=v.child,ee!==null&&(ee.return=v);ee!==null;){var Ge=ee.dependencies;if(Ge!==null){be=ee.child;for(var rt=Ge.firstContext;rt!==null;){if(rt.context===N){if(ee.tag===1){rt=cs(-1,P&-P),rt.tag=2;var kt=ee.updateQueue;if(kt!==null){kt=kt.shared;var pr=kt.pending;pr===null?rt.next=rt:(rt.next=pr.next,pr.next=rt),kt.pending=rt}}ee.lanes|=P,rt=ee.alternate,rt!==null&&(rt.lanes|=P),Uu(ee.return,P,v),Ge.lanes|=P;break}rt=rt.next}}else if(ee.tag===10)be=ee.type===v.type?null:ee.child;else if(ee.tag===18){if(be=ee.return,be===null)throw Error(l(341));be.lanes|=P,Ge=be.alternate,Ge!==null&&(Ge.lanes|=P),Uu(be,P,v),be=ee.sibling}else be=ee.child;if(be!==null)be.return=ee;else for(be=ee;be!==null;){if(be===v){be=null;break}if(ee=be.sibling,ee!==null){ee.return=be.return,be=ee;break}be=be.return}ee=be}Yo(m,v,W.children,P),v=v.child}return v;case 9:return W=v.type,N=v.pendingProps.children,qt(v,P),W=ba(W),N=N(W),v.flags|=1,Yo(m,v,N,P),v.child;case 14:return N=v.type,W=Bo(N,v.pendingProps),W=Bo(N.type,W),Yd(m,v,N,W,P);case 15:return Jp(m,v,v.type,v.pendingProps,P);case 17:return N=v.type,W=v.pendingProps,W=v.elementType===N?W:Bo(N,W),Kf(m,v),v.tag=1,ha(N)?(m=!0,Lu(v)):m=!1,qt(v,P),Gd(v,N,W),qd(v,N,W,P),Wf(null,v,N,!0,m,P);case 19:return nm(m,v,P);case 22:return Kd(m,v,P)}throw Error(l(156,v.tag))};function za(m,v){return ui(m,v)}function Os(m,v,P,N){this.tag=m,this.key=P,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=N,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mo(m,v,P,N){return new Os(m,v,P,N)}function Ds(m){return m=m.prototype,!(!m||!m.isReactComponent)}function el(m){if(typeof m=="function")return Ds(m)?1:0;if(m!=null){if(m=m.$$typeof,m===dr)return 11;if(m===Ar)return 14}return 2}function ds(m,v){var P=m.alternate;return P===null?(P=Mo(m.tag,v,m.key,m.mode),P.elementType=m.elementType,P.type=m.type,P.stateNode=m.stateNode,P.alternate=m,m.alternate=P):(P.pendingProps=v,P.type=m.type,P.flags=0,P.subtreeFlags=0,P.deletions=null),P.flags=m.flags&14680064,P.childLanes=m.childLanes,P.lanes=m.lanes,P.child=m.child,P.memoizedProps=m.memoizedProps,P.memoizedState=m.memoizedState,P.updateQueue=m.updateQueue,v=m.dependencies,P.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},P.sibling=m.sibling,P.index=m.index,P.ref=m.ref,P}function Ll(m,v,P,N,W,ee){var be=2;if(N=m,typeof m=="function")Ds(m)&&(be=1);else if(typeof m=="string")be=5;else e:switch(m){case pt:return zl(P.children,W,ee,v);case Gt:be=8,W|=8;break;case ir:return m=Mo(12,P,v,W|2),m.elementType=ir,m.lanes=ee,m;case Dr:return m=Mo(13,P,v,W),m.elementType=Dr,m.lanes=ee,m;case vr:return m=Mo(19,P,v,W),m.elementType=vr,m.lanes=ee,m;case qr:return Yu(P,W,ee,v);default:if(typeof m=="object"&&m!==null)switch(m.$$typeof){case Br:be=10;break e;case Zt:be=9;break e;case dr:be=11;break e;case Ar:be=14;break e;case zr:be=16,N=null;break e}throw Error(l(130,m==null?m:typeof m,""))}return v=Mo(be,P,v,W),v.elementType=m,v.type=N,v.lanes=ee,v}function zl(m,v,P,N){return m=Mo(7,m,N,v),m.lanes=P,m}function Yu(m,v,P,N){return m=Mo(22,m,N,v),m.elementType=qr,m.lanes=P,m.stateNode={isHidden:!1},m}function Jh(m,v,P){return m=Mo(6,m,null,v),m.lanes=P,m}function Ku(m,v,P){return v=Mo(4,m.children!==null?m.children:[],m.key,v),v.lanes=P,v.stateNode={containerInfo:m.containerInfo,pendingChildren:null,implementation:m.implementation},v}function yi(m,v,P,N,W){this.tag=v,this.containerInfo=m,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ma(0),this.expirationTimes=ma(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ma(0),this.identifierPrefix=N,this.onRecoverableError=W,this.mutableSourceEagerHydrationData=null}function nu(m,v,P,N,W,ee,be,Ge,rt){return m=new yi(m,v,P,Ge,rt),v===1?(v=1,ee===!0&&(v|=8)):v=0,ee=Mo(3,null,null,v),m.current=ee,ee.stateNode=m,ee.memoizedState={element:N,isDehydrated:P,cache:null,transitions:null,pendingSuspenseBoundaries:null},Wp(ee),m}function im(m,v,P){var N=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:nt,key:N==null?null:""+N,children:m,containerInfo:v,implementation:P}}function s_(m){if(!m)return wo;m=m._reactInternals;e:{if(Vt(m)!==m||m.tag!==1)throw Error(l(170));var v=m;do{switch(v.tag){case 3:v=v.stateNode.context;break e;case 1:if(ha(v.type)){v=v.stateNode.__reactInternalMemoizedMergedChildContext;break e}}v=v.return}while(v!==null);throw Error(l(171))}if(m.tag===1){var P=m.type;if(ha(P))return Cf(m,P,v)}return v}function Ny(m,v,P,N,W,ee,be,Ge,rt){return m=nu(P,N,!0,m,W,ee,be,Ge,rt),m.context=s_(null),P=m.current,N=Bt(),W=er(P),ee=cs(N,W),ee.callback=v??null,dc(P,ee,W),m.current.lanes=W,Pa(m,W,N),hr(m,N),m}function tp(m,v,P,N){var W=v.current,ee=Bt(),be=er(W);return P=s_(P),v.context===null?v.context=P:v.pendingContext=P,v=cs(ee,be),v.payload={element:m},N=N===void 0?null:N,N!==null&&(v.callback=N),m=dc(W,v,be),m!==null&&(Wt(m,W,be,ee),Rf(m,W,be)),be}function tl(m){if(m=m.current,!m.child)return null;switch(m.child.tag){case 5:return m.child.stateNode;default:return m.child.stateNode}}function iu(m,v){if(m=m.memoizedState,m!==null&&m.dehydrated!==null){var P=m.retryLane;m.retryLane=P!==0&&P<v?P:v}}function ag(m,v){iu(m,v),(m=m.alternate)&&iu(m,v)}function By(){return null}var om=typeof reportError=="function"?reportError:function(m){console.error(m)};function am(m){this._internalRoot=m}Qh.prototype.render=am.prototype.render=function(m){var v=this._internalRoot;if(v===null)throw Error(l(409));tp(m,v,null,null)},Qh.prototype.unmount=am.prototype.unmount=function(){var m=this._internalRoot;if(m!==null){this._internalRoot=null;var v=m.containerInfo;Rr(function(){tp(null,m,null,null)}),v[oc]=null}};function Qh(m){this._internalRoot=m}Qh.prototype.unstable_scheduleHydration=function(m){if(m){var v=uh();m={blockedOn:null,target:m,priority:v};for(var P=0;P<$s.length&&v!==0&&v<$s[P].priority;P++);$s.splice(P,0,m),P===0&&Mp(m)}};function rp(m){return!(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)}function sm(m){return!(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11&&(m.nodeType!==8||m.nodeValue!==" react-mount-point-unstable "))}function lm(){}function l_(m,v,P,N,W){if(W){if(typeof N=="function"){var ee=N;N=function(){var kt=tl(be);ee.call(kt)}}var be=Ny(v,N,m,0,null,!1,!1,"",lm);return m._reactRootContainer=be,m[oc]=be.current,Id(m.nodeType===8?m.parentNode:m),Rr(),be}for(;W=m.lastChild;)m.removeChild(W);if(typeof N=="function"){var Ge=N;N=function(){var kt=tl(rt);Ge.call(kt)}}var rt=nu(m,0,!1,null,null,!1,!1,"",lm);return m._reactRootContainer=rt,m[oc]=rt.current,Id(m.nodeType===8?m.parentNode:m),Rr(function(){tp(v,rt,P,N)}),rt}function np(m,v,P,N,W){var ee=P._reactRootContainer;if(ee){var be=ee;if(typeof W=="function"){var Ge=W;W=function(){var rt=tl(be);Ge.call(rt)}}tp(v,be,m,W)}else be=l_(P,v,m,W,N);return tl(be)}ch=function(m){switch(m.tag){case 3:var v=m.stateNode;if(v.current.memoizedState.isDehydrated){var P=Zl(v.pendingLanes);P!==0&&(Qa(v,P|1),hr(v,hn()),(K&6)===0&&(Et=hn()+500,cc()))}break;case 13:Rr(function(){var N=_r(m,1);if(N!==null){var W=Bt();Wt(N,m,1,W)}}),ag(m,1)}},pd=function(m){if(m.tag===13){var v=_r(m,134217728);if(v!==null){var P=Bt();Wt(v,m,134217728,P)}ag(m,134217728)}},ul=function(m){if(m.tag===13){var v=er(m),P=_r(m,v);if(P!==null){var N=Bt();Wt(P,m,v,N)}ag(m,v)}},uh=function(){return hi},vf=function(m,v){var P=hi;try{return hi=m,v()}finally{hi=P}},oi=function(m,v,P){switch(v){case"input":if(en(m,P),v=P.name,P.type==="radio"&&v!=null){for(P=m;P.parentNode;)P=P.parentNode;for(P=P.querySelectorAll("input[name="+JSON.stringify(""+v)+'][type="radio"]'),v=0;v<P.length;v++){var N=P[v];if(N!==m&&N.form===m.form){var W=kh(N);if(!W)throw Error(l(90));Kt(N),en(N,W)}}}break;case"textarea":Zn(m,P);break;case"select":v=P.value,v!=null&&ii(m,!!P.multiple,v,!1)}},mi=_i,Ki=Rr;var jy={usingClientEntryPoint:!1,Events:[Ru,$c,kh,ki,Dt,_i]},ip={findFiberByHostInstance:ac,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ed={bundleType:ip.bundleType,version:ip.version,rendererPackageName:ip.rendererPackageName,rendererConfig:ip.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:et.ReactCurrentDispatcher,findHostInstanceByFiber:function(m){return m=Mr(m),m===null?null:m.stateNode},findFiberByHostInstance:ip.findFiberByHostInstance||By,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cm.isDisabled&&cm.supportsFiber)try{ko=cm.inject(ed),eo=cm}catch{}}return Bl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jy,Bl.createPortal=function(m,v){var P=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!rp(v))throw Error(l(200));return im(m,v,null,P)},Bl.createRoot=function(m,v){if(!rp(m))throw Error(l(299));var P=!1,N="",W=om;return v!=null&&(v.unstable_strictMode===!0&&(P=!0),v.identifierPrefix!==void 0&&(N=v.identifierPrefix),v.onRecoverableError!==void 0&&(W=v.onRecoverableError)),v=nu(m,1,!1,null,null,P,!1,N,W),m[oc]=v.current,Id(m.nodeType===8?m.parentNode:m),new am(v)},Bl.findDOMNode=function(m){if(m==null)return null;if(m.nodeType===1)return m;var v=m._reactInternals;if(v===void 0)throw typeof m.render=="function"?Error(l(188)):(m=Object.keys(m).join(","),Error(l(268,m)));return m=Mr(v),m=m===null?null:m.stateNode,m},Bl.flushSync=function(m){return Rr(m)},Bl.hydrate=function(m,v,P){if(!sm(v))throw Error(l(200));return np(null,m,v,!0,P)},Bl.hydrateRoot=function(m,v,P){if(!rp(m))throw Error(l(405));var N=P!=null&&P.hydratedSources||null,W=!1,ee="",be=om;if(P!=null&&(P.unstable_strictMode===!0&&(W=!0),P.identifierPrefix!==void 0&&(ee=P.identifierPrefix),P.onRecoverableError!==void 0&&(be=P.onRecoverableError)),v=Ny(v,null,m,1,P??null,W,!1,ee,be),m[oc]=v.current,Id(m),N)for(m=0;m<N.length;m++)P=N[m],W=P._getVersion,W=W(P._source),v.mutableSourceEagerHydrationData==null?v.mutableSourceEagerHydrationData=[P,W]:v.mutableSourceEagerHydrationData.push(P,W);return new Qh(v)},Bl.render=function(m,v,P){if(!sm(v))throw Error(l(200));return np(null,m,v,!1,P)},Bl.unmountComponentAtNode=function(m){if(!sm(m))throw Error(l(40));return m._reactRootContainer?(Rr(function(){np(null,null,m,!1,function(){m._reactRootContainer=null,m[oc]=null})}),!0):!1},Bl.unstable_batchedUpdates=_i,Bl.unstable_renderSubtreeIntoContainer=function(m,v,P,N){if(!sm(P))throw Error(l(200));if(m==null||m._reactInternals===void 0)throw Error(l(38));return np(m,v,P,!1,N)},Bl.version="18.3.1-next-f1338f8080-20240426",Bl}var IP;function ek(){if(IP)return Z1.exports;IP=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}return e(),Z1.exports=mj(),Z1.exports}var PP;function gj(){if(PP)return Dv;PP=1;var e=ek();return Dv.createRoot=e.createRoot,Dv.hydrateRoot=e.hydrateRoot,Dv}var _j=gj();const yj=Bs(_j);function tk(e){var n,l,u="";if(typeof e=="string"||typeof e=="number")u+=e;else if(typeof e=="object")if(Array.isArray(e)){var y=e.length;for(n=0;n<y;n++)e[n]&&(l=tk(e[n]))&&(u&&(u+=" "),u+=l)}else for(l in e)e[l]&&(u&&(u+=" "),u+=l);return u}function co(){for(var e,n,l=0,u="",y=arguments.length;l<y;l++)(e=arguments[l])&&(n=tk(e))&&(u&&(u+=" "),u+=n);return u}var K1,CP;function vj(){if(CP)return K1;CP=1;const e=(D,k,L,$)=>{if(L==="length"||L==="prototype"||L==="arguments"||L==="caller")return;const q=Object.getOwnPropertyDescriptor(D,L),Z=Object.getOwnPropertyDescriptor(k,L);!n(q,Z)&&$||Object.defineProperty(D,L,Z)},n=function(D,k){return D===void 0||D.configurable||D.writable===k.writable&&D.enumerable===k.enumerable&&D.configurable===k.configurable&&(D.writable||D.value===k.value)},l=(D,k)=>{const L=Object.getPrototypeOf(k);L!==Object.getPrototypeOf(D)&&Object.setPrototypeOf(D,L)},u=(D,k)=>`/* Wrapped ${D}*/
${k}`,y=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),b=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name"),I=(D,k,L)=>{const $=L===""?"":`with ${L.trim()}() `,q=u.bind(null,$,k.toString());Object.defineProperty(q,"name",b),Object.defineProperty(D,"toString",{...y,value:q})};return K1=(D,k,{ignoreNonConfigurable:L=!1}={})=>{const{name:$}=D;for(const q of Reflect.ownKeys(k))e(D,k,q,L);return l(D,k),I(D,k,$),D},K1}var Q_={exports:{}},J1,MP;function xj(){return MP||(MP=1,J1=()=>{const e={};return e.promise=new Promise((n,l)=>{e.resolve=n,e.reject=l}),e}),J1}var kv=Q_.exports,OP;function bj(){return OP||(OP=1,function(e,n){var l=kv&&kv.__awaiter||function(I,o,D,k){return new(D||(D=Promise))(function(L,$){function q(oe){try{ie(k.next(oe))}catch(le){$(le)}}function Z(oe){try{ie(k.throw(oe))}catch(le){$(le)}}function ie(oe){oe.done?L(oe.value):new D(function(le){le(oe.value)}).then(q,Z)}ie((k=k.apply(I,o||[])).next())})},u=kv&&kv.__importDefault||function(I){return I&&I.__esModule?I:{default:I}};Object.defineProperty(n,"__esModule",{value:!0});const y=u(xj());function b(I,o="maxAge"){let D,k,L;const $=()=>l(this,void 0,void 0,function*(){if(D!==void 0)return;const ie=oe=>l(this,void 0,void 0,function*(){L=y.default();const le=oe[1][o]-Date.now();if(le<=0){I.delete(oe[0]),L.resolve();return}return D=oe[0],k=setTimeout(()=>{I.delete(oe[0]),L&&L.resolve()},le),typeof k.unref=="function"&&k.unref(),L.promise});try{for(const oe of I)yield ie(oe)}catch{}D=void 0}),q=()=>{D=void 0,k!==void 0&&(clearTimeout(k),k=void 0),L!==void 0&&(L.reject(void 0),L=void 0)},Z=I.set.bind(I);return I.set=(ie,oe)=>{I.has(ie)&&I.delete(ie);const le=Z(ie,oe);return D&&D===ie&&q(),$(),le},$(),I}n.default=b,e.exports=b,e.exports.default=b}(Q_,Q_.exports)),Q_.exports}var Q1,DP;function wj(){if(DP)return Q1;DP=1;const e=vj(),n=bj(),l=new WeakMap,u=new WeakMap,y=(b,{cacheKey:I,cache:o=new Map,maxAge:D}={})=>{typeof D=="number"&&n(o);const k=function(...L){const $=I?I(L):L[0],q=o.get($);if(q)return q.data;const Z=b.apply(this,L);return o.set($,{data:Z,maxAge:D?Date.now()+D:Number.POSITIVE_INFINITY}),Z};return e(k,b,{ignoreNonConfigurable:!0}),u.set(k,o),k};return y.decorator=(b={})=>(I,o,D)=>{const k=I[o];if(typeof k!="function")throw new TypeError("The decorated value must be a function");delete D.value,delete D.writable,D.get=function(){if(!l.has(this)){const L=y(k,b);return l.set(this,L),L}return l.get(this)}},y.clear=b=>{const I=u.get(b);if(!I)throw new TypeError("Can't clear a function that was not memoized!");if(typeof I.clear!="function")throw new TypeError("The cache Map can't be cleared!");I.clear()},Q1=y,Q1}var Sj=wj();const rk=Bs(Sj);function Tj(e){return typeof e=="string"}function Ej(e,n,l){return l.indexOf(e)===n}function Aj(e){return e.toLowerCase()===e}function kP(e){return e.indexOf(",")===-1?e:e.split(",")}function $w(e){if(!e)return e;if(e==="C"||e==="posix"||e==="POSIX")return"en-US";if(e.indexOf(".")!==-1){var n=e.split(".")[0],l=n===void 0?"":n;return $w(l)}if(e.indexOf("@")!==-1){var u=e.split("@")[0],l=u===void 0?"":u;return $w(l)}if(e.indexOf("-")===-1||!Aj(e))return e;var y=e.split("-"),b=y[0],I=y[1],o=I===void 0?"":I;return"".concat(b,"-").concat(o.toUpperCase())}function Ij(e){var n=e===void 0?{}:e,l=n.useFallbackLocale,u=l===void 0?!0:l,y=n.fallbackLocale,b=y===void 0?"en-US":y,I=[];if(typeof navigator<"u"){for(var o=navigator.languages||[],D=[],k=0,L=o;k<L.length;k++){var $=L[k];D=D.concat(kP($))}var q=navigator.language,Z=q&&kP(q);I=I.concat(D,Z)}return u&&I.push(b),I.filter(Tj).map($w).filter(Ej)}var Pj=rk(Ij,{cacheKey:JSON.stringify});function Cj(e){return Pj(e)[0]||null}var nk=rk(Cj,{cacheKey:JSON.stringify});function df(e,n,l){return function(y,b){b===void 0&&(b=l);var I=e(y)+b;return n(I)}}function vy(e){return function(l){return new Date(e(l).getTime()-1)}}function xy(e,n){return function(u){return[e(u),n(u)]}}function Wo(e){if(e instanceof Date)return e.getFullYear();if(typeof e=="number")return e;var n=parseInt(e,10);if(typeof e=="string"&&!isNaN(n))return n;throw new Error("Failed to get year from date: ".concat(e,"."))}function bp(e){if(e instanceof Date)return e.getMonth();throw new Error("Failed to get month from date: ".concat(e,"."))}function V0(e){if(e instanceof Date)return e.getDate();throw new Error("Failed to get year from date: ".concat(e,"."))}function Ug(e){var n=Wo(e),l=n+(-n+1)%100,u=new Date;return u.setFullYear(l,0,1),u.setHours(0,0,0,0),u}var Mj=df(Wo,Ug,-100),ik=df(Wo,Ug,100),QS=vy(ik),Oj=df(Wo,QS,-100),ok=xy(Ug,QS);function wp(e){var n=Wo(e),l=n+(-n+1)%10,u=new Date;return u.setFullYear(l,0,1),u.setHours(0,0,0,0),u}var ak=df(Wo,wp,-10),eT=df(Wo,wp,10),$0=vy(eT),sk=df(Wo,$0,-10),lk=xy(wp,$0);function Vg(e){var n=Wo(e),l=new Date;return l.setFullYear(n,0,1),l.setHours(0,0,0,0),l}var ck=df(Wo,Vg,-1),tT=df(Wo,Vg,1),G0=vy(tT),uk=df(Wo,G0,-1),Dj=xy(Vg,G0);function rT(e,n){return function(u,y){y===void 0&&(y=n);var b=Wo(u),I=bp(u)+y,o=new Date;return o.setFullYear(b,I,1),o.setHours(0,0,0,0),e(o)}}function Nm(e){var n=Wo(e),l=bp(e),u=new Date;return u.setFullYear(n,l,1),u.setHours(0,0,0,0),u}var hk=rT(Nm,-1),nT=rT(Nm,1),by=vy(nT),dk=rT(by,-1),kj=xy(Nm,by);function Rj(e,n){return function(u,y){y===void 0&&(y=n);var b=Wo(u),I=bp(u),o=V0(u)+y,D=new Date;return D.setFullYear(b,I,o),D.setHours(0,0,0,0),e(D)}}function wy(e){var n=Wo(e),l=bp(e),u=V0(e),y=new Date;return y.setFullYear(n,l,u),y.setHours(0,0,0,0),y}var Lj=Rj(wy,1),iT=vy(Lj),zj=xy(wy,iT);function fk(e){return V0(by(e))}var ms={GREGORY:"gregory",HEBREW:"hebrew",ISLAMIC:"islamic",ISO_8601:"iso8601"},Fj={gregory:["en-CA","en-US","es-AR","es-BO","es-CL","es-CO","es-CR","es-DO","es-EC","es-GT","es-HN","es-MX","es-NI","es-PA","es-PE","es-PR","es-SV","es-VE","pt-BR"],hebrew:["he","he-IL"],islamic:["ar","ar-AE","ar-BH","ar-DZ","ar-EG","ar-IQ","ar-JO","ar-KW","ar-LY","ar-OM","ar-QA","ar-SA","ar-SD","ar-SY","ar-YE","dv","dv-MV","ps","ps-AR"]},oT=[0,1,2,3,4,5,6],eb=new Map;function Nj(e){return function(l,u){var y=l||nk();eb.has(y)||eb.set(y,new Map);var b=eb.get(y);return b.has(e)||b.set(e,new Intl.DateTimeFormat(y||void 0,e).format),b.get(e)(u)}}function Bj(e){var n=new Date(e);return new Date(n.setHours(12))}function Bm(e){return function(n,l){return Nj(e)(n,Bj(l))}}var jj={day:"numeric"},Uj={day:"numeric",month:"long",year:"numeric"},Vj={month:"long"},$j={month:"long",year:"numeric"},Gj={weekday:"short"},qj={weekday:"long"},Wj={year:"numeric"},Hj=Bm(jj),Zj=Bm(Uj),Xj=Bm(Vj),pk=Bm($j),Yj=Bm(Gj),Kj=Bm(qj),q0=Bm(Wj),Jj=oT[0],Qj=oT[5],RP=oT[6];function oy(e,n){n===void 0&&(n=ms.ISO_8601);var l=e.getDay();switch(n){case ms.ISO_8601:return(l+6)%7;case ms.ISLAMIC:return(l+1)%7;case ms.HEBREW:case ms.GREGORY:return l;default:throw new Error("Unsupported calendar type.")}}function e4(e){var n=Ug(e);return Wo(n)}function t4(e){var n=wp(e);return Wo(n)}function Gw(e,n){n===void 0&&(n=ms.ISO_8601);var l=Wo(e),u=bp(e),y=e.getDate()-oy(e,n);return new Date(l,u,y)}function r4(e,n){n===void 0&&(n=ms.ISO_8601);var l=n===ms.GREGORY?ms.GREGORY:ms.ISO_8601,u=Gw(e,n),y=Wo(e)+1,b,I;do b=new Date(y,0,l===ms.ISO_8601?4:1),I=Gw(b,n),y-=1;while(e<I);return Math.round((u.getTime()-I.getTime())/(864e5*7))+1}function Pm(e,n){switch(e){case"century":return Ug(n);case"decade":return wp(n);case"year":return Vg(n);case"month":return Nm(n);case"day":return wy(n);default:throw new Error("Invalid rangeType: ".concat(e))}}function n4(e,n){switch(e){case"century":return Mj(n);case"decade":return ak(n);case"year":return ck(n);case"month":return hk(n);default:throw new Error("Invalid rangeType: ".concat(e))}}function mk(e,n){switch(e){case"century":return ik(n);case"decade":return eT(n);case"year":return tT(n);case"month":return nT(n);default:throw new Error("Invalid rangeType: ".concat(e))}}function i4(e,n){switch(e){case"decade":return ak(n,-100);case"year":return ck(n,-10);case"month":return hk(n,-12);default:throw new Error("Invalid rangeType: ".concat(e))}}function o4(e,n){switch(e){case"decade":return eT(n,100);case"year":return tT(n,10);case"month":return nT(n,12);default:throw new Error("Invalid rangeType: ".concat(e))}}function gk(e,n){switch(e){case"century":return QS(n);case"decade":return $0(n);case"year":return G0(n);case"month":return by(n);case"day":return iT(n);default:throw new Error("Invalid rangeType: ".concat(e))}}function a4(e,n){switch(e){case"century":return Oj(n);case"decade":return sk(n);case"year":return uk(n);case"month":return dk(n);default:throw new Error("Invalid rangeType: ".concat(e))}}function s4(e,n){switch(e){case"decade":return sk(n,-100);case"year":return uk(n,-10);case"month":return dk(n,-12);default:throw new Error("Invalid rangeType: ".concat(e))}}function LP(e,n){switch(e){case"century":return ok(n);case"decade":return lk(n);case"year":return Dj(n);case"month":return kj(n);case"day":return zj(n);default:throw new Error("Invalid rangeType: ".concat(e))}}function l4(e,n,l){var u=[n,l].sort(function(y,b){return y.getTime()-b.getTime()});return[Pm(e,u[0]),gk(e,u[1])]}function _k(e,n,l){return l.map(function(u){return(n||q0)(e,u)}).join("  ")}function c4(e,n,l){return _k(e,n,ok(l))}function yk(e,n,l){return _k(e,n,lk(l))}function u4(e){return e.getDay()===new Date().getDay()}function vk(e,n){n===void 0&&(n=ms.ISO_8601);var l=e.getDay();switch(n){case ms.ISLAMIC:case ms.HEBREW:return l===Qj||l===RP;case ms.ISO_8601:case ms.GREGORY:return l===RP||l===Jj;default:throw new Error("Unsupported calendar type.")}}var id="react-calendar__navigation";function h4(e){var n=e.activeStartDate,l=e.drillUp,u=e.formatMonthYear,y=u===void 0?pk:u,b=e.formatYear,I=b===void 0?q0:b,o=e.locale,D=e.maxDate,k=e.minDate,L=e.navigationAriaLabel,$=L===void 0?"":L,q=e.navigationAriaLive,Z=e.navigationLabel,ie=e.next2AriaLabel,oe=ie===void 0?"":ie,le=e.next2Label,xe=le===void 0?"":le,ge=e.nextAriaLabel,ke=ge===void 0?"":ge,et=e.nextLabel,ze=et===void 0?"":et,nt=e.prev2AriaLabel,pt=nt===void 0?"":nt,Gt=e.prev2Label,ir=Gt===void 0?"":Gt,Br=e.prevAriaLabel,Zt=Br===void 0?"":Br,dr=e.prevLabel,Dr=dr===void 0?"":dr,vr=e.setActiveStartDate,Ar=e.showDoubleView,zr=e.view,qr=e.views,lr=qr.indexOf(zr)>0,br=zr!=="century",Ft=n4(zr,n),ot=br?i4(zr,n):void 0,St=mk(zr,n),Ur=br?o4(zr,n):void 0,gn=function(){if(Ft.getFullYear()<0)return!0;var fr=a4(zr,n);return k&&k>=fr}(),Sr=br&&function(){if(ot.getFullYear()<0)return!0;var fr=s4(zr,n);return k&&k>=fr}(),kr=D&&D<St,Vr=br&&D&&D<Ur;function wn(){vr(Ft,"prev")}function Nt(){vr(ot,"prev2")}function Qr(){vr(St,"next")}function Tn(){vr(Ur,"next2")}function Kt(fr){var jr=function(){switch(zr){case"century":return c4(o,I,fr);case"decade":return yk(o,I,fr);case"year":return I(o,fr);case"month":return y(o,fr);default:throw new Error("Invalid view: ".concat(zr,"."))}}();return Z?Z({date:fr,label:jr,locale:o||nk()||void 0,view:zr}):jr}function We(){var fr="".concat(id,"__label");return Me.jsxs("button",{"aria-label":$,"aria-live":q,className:fr,disabled:!lr,onClick:l,style:{flexGrow:1},type:"button",children:[Me.jsx("span",{className:"".concat(fr,"__labelText ").concat(fr,"__labelText--from"),children:Kt(n)}),Ar?Me.jsxs(Me.Fragment,{children:[Me.jsx("span",{className:"".concat(fr,"__divider"),children:"  "}),Me.jsx("span",{className:"".concat(fr,"__labelText ").concat(fr,"__labelText--to"),children:Kt(St)})]}):null]})}return Me.jsxs("div",{className:id,children:[ir!==null&&br?Me.jsx("button",{"aria-label":pt,className:"".concat(id,"__arrow ").concat(id,"__prev2-button"),disabled:Sr,onClick:Nt,type:"button",children:ir}):null,Dr!==null&&Me.jsx("button",{"aria-label":Zt,className:"".concat(id,"__arrow ").concat(id,"__prev-button"),disabled:gn,onClick:wn,type:"button",children:Dr}),We(),ze!==null&&Me.jsx("button",{"aria-label":ke,className:"".concat(id,"__arrow ").concat(id,"__next-button"),disabled:kr,onClick:Qr,type:"button",children:ze}),xe!==null&&br?Me.jsx("button",{"aria-label":oe,className:"".concat(id,"__arrow ").concat(id,"__next2-button"),disabled:Vr,onClick:Tn,type:"button",children:xe}):null]})}var Sg=function(){return Sg=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},Sg.apply(this,arguments)},d4=function(e,n){var l={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(l[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,u=Object.getOwnPropertySymbols(e);y<u.length;y++)n.indexOf(u[y])<0&&Object.prototype.propertyIsEnumerable.call(e,u[y])&&(l[u[y]]=e[u[y]]);return l};function zP(e){return"".concat(e,"%")}function aT(e){var n=e.children,l=e.className,u=e.count,y=e.direction,b=e.offset,I=e.style,o=e.wrap,D=d4(e,["children","className","count","direction","offset","style","wrap"]);return Me.jsx("div",Sg({className:l,style:Sg({display:"flex",flexDirection:y,flexWrap:o?"wrap":"nowrap"},I)},D,{children:Ae.Children.map(n,function(k,L){var $=b&&L===0?zP(100*b/u):null;return Ae.cloneElement(k,Sg(Sg({},k.props),{style:{flexBasis:zP(100/u),flexShrink:0,flexGrow:0,overflow:"hidden",marginLeft:$,marginInlineStart:$,marginInlineEnd:0}}))})}))}function f4(e,n,l){return n&&n>e?n:l&&l<e?l:e}function ay(e,n){return n[0]<=e&&n[1]>=e}function p4(e,n){return e[0]<=n[0]&&e[1]>=n[1]}function xk(e,n){return ay(e[0],n)||ay(e[1],n)}function FP(e,n,l){var u=xk(n,e),y=[];if(u){y.push(l);var b=ay(e[0],n),I=ay(e[1],n);b&&y.push("".concat(l,"Start")),I&&y.push("".concat(l,"End")),b&&I&&y.push("".concat(l,"BothEnds"))}return y}function m4(e){return Array.isArray(e)?e[0]!==null&&e[1]!==null:e!==null}function g4(e){if(!e)throw new Error("args is required");var n=e.value,l=e.date,u=e.hover,y="react-calendar__tile",b=[y];if(!l)return b;var I=new Date,o=function(){if(Array.isArray(l))return l;var Z=e.dateType;if(!Z)throw new Error("dateType is required when date is not an array of two dates");return LP(Z,l)}();if(ay(I,o)&&b.push("".concat(y,"--now")),!n||!m4(n))return b;var D=function(){if(Array.isArray(n))return n;var Z=e.valueType;if(!Z)throw new Error("valueType is required when value is not an array of two dates");return LP(Z,n)}();p4(D,o)?b.push("".concat(y,"--active")):xk(D,o)&&b.push("".concat(y,"--hasActive"));var k=FP(D,o,"".concat(y,"--range"));b.push.apply(b,k);var L=Array.isArray(n)?n:[n];if(u&&L.length===1){var $=u>D[0]?[D[0],u]:[u,D[0]],q=FP($,o,"".concat(y,"--hover"));b.push.apply(b,q)}return b}function W0(e){for(var n=e.className,l=e.count,u=l===void 0?3:l,y=e.dateTransform,b=e.dateType,I=e.end,o=e.hover,D=e.offset,k=e.renderTile,L=e.start,$=e.step,q=$===void 0?1:$,Z=e.value,ie=e.valueType,oe=[],le=L;le<=I;le+=q){var xe=y(le);oe.push(k({classes:g4({date:xe,dateType:b,hover:o,value:Z,valueType:ie}),date:xe}))}return Me.jsx(aT,{className:n,count:u,offset:D,wrap:!0,children:oe})}function H0(e){var n=e.activeStartDate,l=e.children,u=e.classes,y=e.date,b=e.formatAbbr,I=e.locale,o=e.maxDate,D=e.maxDateTransform,k=e.minDate,L=e.minDateTransform,$=e.onClick,q=e.onMouseOver,Z=e.style,ie=e.tileClassName,oe=e.tileContent,le=e.tileDisabled,xe=e.view,ge=Ae.useMemo(function(){var et={activeStartDate:n,date:y,view:xe};return typeof ie=="function"?ie(et):ie},[n,y,ie,xe]),ke=Ae.useMemo(function(){var et={activeStartDate:n,date:y,view:xe};return typeof oe=="function"?oe(et):oe},[n,y,oe,xe]);return Me.jsxs("button",{className:co(u,ge),disabled:k&&L(k)>y||o&&D(o)<y||(le==null?void 0:le({activeStartDate:n,date:y,view:xe})),onClick:$?function(et){return $(y,et)}:void 0,onFocus:q?function(){return q(y)}:void 0,onMouseOver:q?function(){return q(y)}:void 0,style:Z,type:"button",children:[b?Me.jsx("abbr",{"aria-label":b(I,y),children:l}):l,ke]})}var qw=function(){return qw=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},qw.apply(this,arguments)},_4=function(e,n){var l={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(l[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,u=Object.getOwnPropertySymbols(e);y<u.length;y++)n.indexOf(u[y])<0&&Object.prototype.propertyIsEnumerable.call(e,u[y])&&(l[u[y]]=e[u[y]]);return l},NP="react-calendar__century-view__decades__decade";function y4(e){var n=e.classes,l=n===void 0?[]:n,u=e.currentCentury,y=e.formatYear,b=y===void 0?q0:y,I=_4(e,["classes","currentCentury","formatYear"]),o=I.date,D=I.locale,k=[];return l&&k.push.apply(k,l),k.push(NP),Ug(o).getFullYear()!==u&&k.push("".concat(NP,"--neighboringCentury")),Me.jsx(H0,qw({},I,{classes:k,maxDateTransform:$0,minDateTransform:wp,view:"century",children:yk(D,b,o)}))}var Ww=function(){return Ww=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},Ww.apply(this,arguments)},BP=function(e,n){var l={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(l[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,u=Object.getOwnPropertySymbols(e);y<u.length;y++)n.indexOf(u[y])<0&&Object.prototype.propertyIsEnumerable.call(e,u[y])&&(l[u[y]]=e[u[y]]);return l};function v4(e){var n=e.activeStartDate,l=e.hover,u=e.showNeighboringCentury,y=e.value,b=e.valueType,I=BP(e,["activeStartDate","hover","showNeighboringCentury","value","valueType"]),o=e4(n),D=o+(u?119:99);return Me.jsx(W0,{className:"react-calendar__century-view__decades",dateTransform:wp,dateType:"decade",end:D,hover:l,renderTile:function(k){var L=k.date,$=BP(k,["date"]);return Me.jsx(y4,Ww({},I,$,{activeStartDate:n,currentCentury:o,date:L}),L.getTime())},start:o,step:10,value:y,valueType:b})}var Hw=function(){return Hw=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},Hw.apply(this,arguments)};function x4(e){function n(){return Me.jsx(v4,Hw({},e))}return Me.jsx("div",{className:"react-calendar__century-view",children:n()})}var Zw=function(){return Zw=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},Zw.apply(this,arguments)},b4=function(e,n){var l={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(l[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,u=Object.getOwnPropertySymbols(e);y<u.length;y++)n.indexOf(u[y])<0&&Object.prototype.propertyIsEnumerable.call(e,u[y])&&(l[u[y]]=e[u[y]]);return l},jP="react-calendar__decade-view__years__year";function w4(e){var n=e.classes,l=n===void 0?[]:n,u=e.currentDecade,y=e.formatYear,b=y===void 0?q0:y,I=b4(e,["classes","currentDecade","formatYear"]),o=I.date,D=I.locale,k=[];return l&&k.push.apply(k,l),k.push(jP),wp(o).getFullYear()!==u&&k.push("".concat(jP,"--neighboringDecade")),Me.jsx(H0,Zw({},I,{classes:k,maxDateTransform:G0,minDateTransform:Vg,view:"decade",children:b(D,o)}))}var Xw=function(){return Xw=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},Xw.apply(this,arguments)},UP=function(e,n){var l={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(l[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,u=Object.getOwnPropertySymbols(e);y<u.length;y++)n.indexOf(u[y])<0&&Object.prototype.propertyIsEnumerable.call(e,u[y])&&(l[u[y]]=e[u[y]]);return l};function S4(e){var n=e.activeStartDate,l=e.hover,u=e.showNeighboringDecade,y=e.value,b=e.valueType,I=UP(e,["activeStartDate","hover","showNeighboringDecade","value","valueType"]),o=t4(n),D=o+(u?11:9);return Me.jsx(W0,{className:"react-calendar__decade-view__years",dateTransform:Vg,dateType:"year",end:D,hover:l,renderTile:function(k){var L=k.date,$=UP(k,["date"]);return Me.jsx(w4,Xw({},I,$,{activeStartDate:n,currentDecade:o,date:L}),L.getTime())},start:o,value:y,valueType:b})}var Yw=function(){return Yw=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},Yw.apply(this,arguments)};function T4(e){function n(){return Me.jsx(S4,Yw({},e))}return Me.jsx("div",{className:"react-calendar__decade-view",children:n()})}var Kw=function(){return Kw=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},Kw.apply(this,arguments)},E4=function(e,n){var l={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(l[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,u=Object.getOwnPropertySymbols(e);y<u.length;y++)n.indexOf(u[y])<0&&Object.prototype.propertyIsEnumerable.call(e,u[y])&&(l[u[y]]=e[u[y]]);return l},VP=function(e,n,l){if(l||arguments.length===2)for(var u=0,y=n.length,b;u<y;u++)(b||!(u in n))&&(b||(b=Array.prototype.slice.call(n,0,u)),b[u]=n[u]);return e.concat(b||Array.prototype.slice.call(n))},A4="react-calendar__year-view__months__month";function I4(e){var n=e.classes,l=n===void 0?[]:n,u=e.formatMonth,y=u===void 0?Xj:u,b=e.formatMonthYear,I=b===void 0?pk:b,o=E4(e,["classes","formatMonth","formatMonthYear"]),D=o.date,k=o.locale;return Me.jsx(H0,Kw({},o,{classes:VP(VP([],l,!0),[A4],!1),formatAbbr:I,maxDateTransform:by,minDateTransform:Nm,view:"year",children:y(k,D)}))}var Jw=function(){return Jw=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},Jw.apply(this,arguments)},$P=function(e,n){var l={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(l[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,u=Object.getOwnPropertySymbols(e);y<u.length;y++)n.indexOf(u[y])<0&&Object.prototype.propertyIsEnumerable.call(e,u[y])&&(l[u[y]]=e[u[y]]);return l};function P4(e){var n=e.activeStartDate,l=e.hover,u=e.value,y=e.valueType,b=$P(e,["activeStartDate","hover","value","valueType"]),I=0,o=11,D=Wo(n);return Me.jsx(W0,{className:"react-calendar__year-view__months",dateTransform:function(k){var L=new Date;return L.setFullYear(D,k,1),Nm(L)},dateType:"month",end:o,hover:l,renderTile:function(k){var L=k.date,$=$P(k,["date"]);return Me.jsx(I4,Jw({},b,$,{activeStartDate:n,date:L}),L.getTime())},start:I,value:u,valueType:y})}var Qw=function(){return Qw=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},Qw.apply(this,arguments)};function C4(e){function n(){return Me.jsx(P4,Qw({},e))}return Me.jsx("div",{className:"react-calendar__year-view",children:n()})}var eS=function(){return eS=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},eS.apply(this,arguments)},M4=function(e,n){var l={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(l[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,u=Object.getOwnPropertySymbols(e);y<u.length;y++)n.indexOf(u[y])<0&&Object.prototype.propertyIsEnumerable.call(e,u[y])&&(l[u[y]]=e[u[y]]);return l},tb="react-calendar__month-view__days__day";function O4(e){var n=e.calendarType,l=e.classes,u=l===void 0?[]:l,y=e.currentMonthIndex,b=e.formatDay,I=b===void 0?Hj:b,o=e.formatLongDate,D=o===void 0?Zj:o,k=M4(e,["calendarType","classes","currentMonthIndex","formatDay","formatLongDate"]),L=k.date,$=k.locale,q=[];return u&&q.push.apply(q,u),q.push(tb),vk(L,n)&&q.push("".concat(tb,"--weekend")),L.getMonth()!==y&&q.push("".concat(tb,"--neighboringMonth")),Me.jsx(H0,eS({},k,{classes:q,formatAbbr:D,maxDateTransform:iT,minDateTransform:wy,view:"month",children:I($,L)}))}var tS=function(){return tS=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},tS.apply(this,arguments)},GP=function(e,n){var l={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(l[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,u=Object.getOwnPropertySymbols(e);y<u.length;y++)n.indexOf(u[y])<0&&Object.prototype.propertyIsEnumerable.call(e,u[y])&&(l[u[y]]=e[u[y]]);return l};function D4(e){var n=e.activeStartDate,l=e.calendarType,u=e.hover,y=e.showFixedNumberOfWeeks,b=e.showNeighboringMonth,I=e.value,o=e.valueType,D=GP(e,["activeStartDate","calendarType","hover","showFixedNumberOfWeeks","showNeighboringMonth","value","valueType"]),k=Wo(n),L=bp(n),$=y||b,q=oy(n,l),Z=$?0:q,ie=($?-q:0)+1,oe=function(){if(y)return ie+6*7-1;var le=fk(n);if(b){var xe=new Date;xe.setFullYear(k,L,le),xe.setHours(0,0,0,0);var ge=7-oy(xe,l)-1;return le+ge}return le}();return Me.jsx(W0,{className:"react-calendar__month-view__days",count:7,dateTransform:function(le){var xe=new Date;return xe.setFullYear(k,L,le),wy(xe)},dateType:"day",hover:u,end:oe,renderTile:function(le){var xe=le.date,ge=GP(le,["date"]);return Me.jsx(O4,tS({},D,ge,{activeStartDate:n,calendarType:l,currentMonthIndex:L,date:xe}),xe.getTime())},offset:Z,start:ie,value:I,valueType:o})}var bk="react-calendar__month-view__weekdays",rb="".concat(bk,"__weekday");function k4(e){for(var n=e.calendarType,l=e.formatShortWeekday,u=l===void 0?Yj:l,y=e.formatWeekday,b=y===void 0?Kj:y,I=e.locale,o=e.onMouseLeave,D=new Date,k=Nm(D),L=Wo(k),$=bp(k),q=[],Z=1;Z<=7;Z+=1){var ie=new Date(L,$,Z-oy(k,n)),oe=b(I,ie);q.push(Me.jsx("div",{className:co(rb,u4(ie)&&"".concat(rb,"--current"),vk(ie,n)&&"".concat(rb,"--weekend")),children:Me.jsx("abbr",{"aria-label":oe,title:oe,children:u(I,ie).replace(".","")})},Z))}return Me.jsx(aT,{className:bk,count:7,onFocus:o,onMouseOver:o,children:q})}var i0=function(){return i0=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},i0.apply(this,arguments)},qP=function(e,n){var l={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(l[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,u=Object.getOwnPropertySymbols(e);y<u.length;y++)n.indexOf(u[y])<0&&Object.prototype.propertyIsEnumerable.call(e,u[y])&&(l[u[y]]=e[u[y]]);return l},WP="react-calendar__tile";function R4(e){var n=e.onClickWeekNumber,l=e.weekNumber,u=Me.jsx("span",{children:l});if(n){var y=e.date,b=e.onClickWeekNumber,I=e.weekNumber,o=qP(e,["date","onClickWeekNumber","weekNumber"]);return Me.jsx("button",i0({},o,{className:WP,onClick:function(D){return b(I,y,D)},type:"button",children:u}))}else{e.date,e.onClickWeekNumber,e.weekNumber;var o=qP(e,["date","onClickWeekNumber","weekNumber"]);return Me.jsx("div",i0({},o,{className:WP,children:u}))}}function L4(e){var n=e.activeStartDate,l=e.calendarType,u=e.onClickWeekNumber,y=e.onMouseLeave,b=e.showFixedNumberOfWeeks,I=function(){if(b)return 6;var k=fk(n),L=oy(n,l),$=k-(7-L);return 1+Math.ceil($/7)}(),o=function(){for(var k=Wo(n),L=bp(n),$=V0(n),q=[],Z=0;Z<I;Z+=1)q.push(Gw(new Date(k,L,$+Z*7),l));return q}(),D=o.map(function(k){return r4(k,l)});return Me.jsx(aT,{className:"react-calendar__month-view__weekNumbers",count:I,direction:"column",onFocus:y,onMouseOver:y,style:{flexBasis:"calc(100% * (1 / 8)",flexShrink:0},children:D.map(function(k,L){var $=o[L];if(!$)throw new Error("date is not defined");return Me.jsx(R4,{date:$,onClickWeekNumber:u,weekNumber:k},k)})})}var rS=function(){return rS=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},rS.apply(this,arguments)},z4=function(e,n){var l={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(l[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,u=Object.getOwnPropertySymbols(e);y<u.length;y++)n.indexOf(u[y])<0&&Object.prototype.propertyIsEnumerable.call(e,u[y])&&(l[u[y]]=e[u[y]]);return l};function F4(e){if(e)for(var n=0,l=Object.entries(Fj);n<l.length;n++){var u=l[n],y=u[0],b=u[1];if(b.includes(e))return y}return ms.ISO_8601}function N4(e){var n=e.activeStartDate,l=e.locale,u=e.onMouseLeave,y=e.showFixedNumberOfWeeks,b=e.calendarType,I=b===void 0?F4(l):b,o=e.formatShortWeekday,D=e.formatWeekday,k=e.onClickWeekNumber,L=e.showWeekNumbers,$=z4(e,["calendarType","formatShortWeekday","formatWeekday","onClickWeekNumber","showWeekNumbers"]);function q(){return Me.jsx(k4,{calendarType:I,formatShortWeekday:o,formatWeekday:D,locale:l,onMouseLeave:u})}function Z(){return L?Me.jsx(L4,{activeStartDate:n,calendarType:I,onClickWeekNumber:k,onMouseLeave:u,showFixedNumberOfWeeks:y}):null}function ie(){return Me.jsx(D4,rS({calendarType:I},$))}var oe="react-calendar__month-view";return Me.jsx("div",{className:co(oe,L?"".concat(oe,"--weekNumbers"):""),children:Me.jsxs("div",{style:{display:"flex",alignItems:"flex-end"},children:[Z(),Me.jsxs("div",{style:{flexGrow:1,width:"100%"},children:[q(),ie()]})]})})}var Tg=function(){return Tg=Object.assign||function(e){for(var n,l=1,u=arguments.length;l<u;l++){n=arguments[l];for(var y in n)Object.prototype.hasOwnProperty.call(n,y)&&(e[y]=n[y])}return e},Tg.apply(this,arguments)},Rv="react-calendar",e0=["century","decade","year","month"],B4=["decade","year","month","day"],sT=new Date;sT.setFullYear(1,0,1);sT.setHours(0,0,0,0);var j4=new Date(864e13);function ey(e){return e instanceof Date?e:new Date(e)}function wk(e,n){return e0.slice(e0.indexOf(e),e0.indexOf(n)+1)}function U4(e,n,l){var u=wk(n,l);return u.indexOf(e)!==-1}function lT(e,n,l){return e&&U4(e,n,l)?e:l}function Sk(e){var n=e0.indexOf(e);return B4[n]}function V4(e,n){var l=Array.isArray(e)?e[n]:e;if(!l)return null;var u=ey(l);if(Number.isNaN(u.getTime()))throw new Error("Invalid date: ".concat(e));return u}function Tk(e,n){var l=e.value,u=e.minDate,y=e.maxDate,b=e.maxDetail,I=V4(l,n);if(!I)return null;var o=Sk(b),D=function(){switch(n){case 0:return Pm(o,I);case 1:return gk(o,I);default:throw new Error("Invalid index value: ".concat(n))}}();return f4(D,u,y)}var cT=function(e){return Tk(e,0)},Ek=function(e){return Tk(e,1)},$4=function(e){return[cT,Ek].map(function(n){return n(e)})};function Ak(e){var n=e.maxDate,l=e.maxDetail,u=e.minDate,y=e.minDetail,b=e.value,I=e.view,o=lT(I,y,l),D=cT({value:b,minDate:u,maxDate:n,maxDetail:l})||new Date;return Pm(o,D)}function G4(e){var n=e.activeStartDate,l=e.defaultActiveStartDate,u=e.defaultValue,y=e.defaultView,b=e.maxDate,I=e.maxDetail,o=e.minDate,D=e.minDetail,k=e.value,L=e.view,$=lT(L,D,I),q=n||l;return q?Pm($,q):Ak({maxDate:b,maxDetail:I,minDate:o,minDetail:D,value:k||u,view:L||y})}function nb(e){return e&&(!Array.isArray(e)||e.length===1)}function Lv(e,n){return e instanceof Date&&n instanceof Date&&e.getTime()===n.getTime()}var zv=Ae.forwardRef(function(n,l){var u=n.activeStartDate,y=n.allowPartialRange,b=n.calendarType,I=n.className,o=n.defaultActiveStartDate,D=n.defaultValue,k=n.defaultView,L=n.formatDay,$=n.formatLongDate,q=n.formatMonth,Z=n.formatMonthYear,ie=n.formatShortWeekday,oe=n.formatWeekday,le=n.formatYear,xe=n.goToRangeStartOnSelect,ge=xe===void 0?!0:xe,ke=n.inputRef,et=n.locale,ze=n.maxDate,nt=ze===void 0?j4:ze,pt=n.maxDetail,Gt=pt===void 0?"month":pt,ir=n.minDate,Br=ir===void 0?sT:ir,Zt=n.minDetail,dr=Zt===void 0?"century":Zt,Dr=n.navigationAriaLabel,vr=n.navigationAriaLive,Ar=n.navigationLabel,zr=n.next2AriaLabel,qr=n.next2Label,lr=n.nextAriaLabel,br=n.nextLabel,Ft=n.onActiveStartDateChange,ot=n.onChange,St=n.onClickDay,Ur=n.onClickDecade,gn=n.onClickMonth,Sr=n.onClickWeekNumber,kr=n.onClickYear,Vr=n.onDrillDown,wn=n.onDrillUp,Nt=n.onViewChange,Qr=n.prev2AriaLabel,Tn=n.prev2Label,Kt=n.prevAriaLabel,We=n.prevLabel,fr=n.returnValue,jr=fr===void 0?"start":fr,mr=n.selectRange,en=n.showDoubleView,uo=n.showFixedNumberOfWeeks,Oi=n.showNavigation,Di=Oi===void 0?!0:Oi,ii=n.showNeighboringCentury,ti=n.showNeighboringDecade,$i=n.showNeighboringMonth,Zn=$i===void 0?!0:$i,Ii=n.showWeekNumbers,ci=n.tileClassName,Co=n.tileContent,Ka=n.tileDisabled,oa=n.value,ta=n.view,ho=Ae.useState(o),js=ho[0],fa=ho[1],pa=Ae.useState(null),un=pa[0],zn=pa[1],Cn=Ae.useState(Array.isArray(D)?D.map(function(Ot){return Ot!==null?ey(Ot):null}):D!=null?ey(D):null),Fr=Cn[0],Bn=Cn[1],oi=Ae.useState(k),An=oi[0],Nn=oi[1],Xn=u||js||G4({activeStartDate:u,defaultActiveStartDate:o,defaultValue:D,defaultView:k,maxDate:nt,maxDetail:Gt,minDate:Br,minDetail:dr,value:oa,view:ta}),ki=function(){var Ot=function(){return mr&&nb(Fr)?Fr:oa!==void 0?oa:Fr}();return Ot?Array.isArray(Ot)?Ot.map(function(gr){return gr!==null?ey(gr):null}):Ot!==null?ey(Ot):null:null}(),Dt=Sk(Gt),mi=lT(ta||An,dr,Gt),Ki=wk(dr,Gt),Qe=mr?un:null,Q=Ki.indexOf(mi)<Ki.length-1,ae=Ki.indexOf(mi)>0,Se=Ae.useCallback(function(Ot){var gr=function(){switch(jr){case"start":return cT;case"end":return Ek;case"range":return $4;default:throw new Error("Invalid returnValue.")}}();return gr({maxDate:nt,maxDetail:Gt,minDate:Br,value:Ot})},[nt,Gt,Br,jr]),De=Ae.useCallback(function(Ot,gr){fa(Ot);var wr={action:gr,activeStartDate:Ot,value:ki,view:mi};Ft&&!Lv(Xn,Ot)&&Ft(wr)},[Xn,Ft,ki,mi]),Pe=Ae.useCallback(function(Ot,gr){var wr=function(){switch(mi){case"century":return Ur;case"decade":return kr;case"year":return gn;case"month":return St;default:throw new Error("Invalid view: ".concat(mi,"."))}}();wr&&wr(Ot,gr)},[St,Ur,gn,kr,mi]),Le=Ae.useCallback(function(Ot,gr){if(Q){Pe(Ot,gr);var wr=Ki[Ki.indexOf(mi)+1];if(!wr)throw new Error("Attempted to drill down from the lowest view.");fa(Ot),Nn(wr);var Mr={action:"drillDown",activeStartDate:Ot,value:ki,view:wr};Ft&&!Lv(Xn,Ot)&&Ft(Mr),Nt&&mi!==wr&&Nt(Mr),Vr&&Vr(Mr)}},[Xn,Q,Ft,Pe,Vr,Nt,ki,mi,Ki]),Fe=Ae.useCallback(function(){if(ae){var Ot=Ki[Ki.indexOf(mi)-1];if(!Ot)throw new Error("Attempted to drill up from the highest view.");var gr=Pm(Ot,Xn);fa(gr),Nn(Ot);var wr={action:"drillUp",activeStartDate:gr,value:ki,view:Ot};Ft&&!Lv(Xn,gr)&&Ft(wr),Nt&&mi!==Ot&&Nt(wr),wn&&wn(wr)}},[Xn,ae,Ft,wn,Nt,ki,mi,Ki]),Be=Ae.useCallback(function(Ot,gr){var wr=ki;Pe(Ot,gr);var Mr=mr&&!nb(wr),Nr;if(mr)if(Mr)Nr=Pm(Dt,Ot);else{if(!wr)throw new Error("previousValue is required");if(Array.isArray(wr))throw new Error("previousValue must not be an array");Nr=l4(Dt,wr,Ot)}else Nr=Se(Ot);var ui=!mr||Mr||ge?Ak({maxDate:nt,maxDetail:Gt,minDate:Br,minDetail:dr,value:Nr,view:mi}):null;gr.persist(),fa(ui),Bn(Nr);var tn={action:"onChange",activeStartDate:ui,value:Nr,view:mi};if(Ft&&!Lv(Xn,ui)&&Ft(tn),ot)if(mr){var Jn=nb(Nr);if(!Jn)ot(Nr||null,gr);else if(y){if(Array.isArray(Nr))throw new Error("value must not be an array");ot([Nr||null,null],gr)}}else ot(Nr||null,gr)},[Xn,y,Se,ge,nt,Gt,Br,dr,Ft,ot,Pe,mr,ki,Dt,mi]);function Ye(Ot){zn(Ot)}function ht(){zn(null)}Ae.useImperativeHandle(l,function(){return{activeStartDate:Xn,drillDown:Le,drillUp:Fe,onChange:Be,setActiveStartDate:De,value:ki,view:mi}},[Xn,Le,Fe,Be,De,ki,mi]);function Ze(Ot){var gr=Ot?mk(mi,Xn):Pm(mi,Xn),wr=Q?Le:Be,Mr={activeStartDate:gr,hover:Qe,locale:et,maxDate:nt,minDate:Br,onClick:wr,onMouseOver:mr?Ye:void 0,tileClassName:ci,tileContent:Co,tileDisabled:Ka,value:ki,valueType:Dt};switch(mi){case"century":return Me.jsx(x4,Tg({formatYear:le,showNeighboringCentury:ii},Mr));case"decade":return Me.jsx(T4,Tg({formatYear:le,showNeighboringDecade:ti},Mr));case"year":return Me.jsx(C4,Tg({formatMonth:q,formatMonthYear:Z},Mr));case"month":return Me.jsx(N4,Tg({calendarType:b,formatDay:L,formatLongDate:$,formatShortWeekday:ie,formatWeekday:oe,onClickWeekNumber:Sr,onMouseLeave:mr?ht:void 0,showFixedNumberOfWeeks:typeof uo<"u"?uo:en,showNeighboringMonth:Zn,showWeekNumbers:Ii},Mr));default:throw new Error("Invalid view: ".concat(mi,"."))}}function Lt(){return Di?Me.jsx(h4,{activeStartDate:Xn,drillUp:Fe,formatMonthYear:Z,formatYear:le,locale:et,maxDate:nt,minDate:Br,navigationAriaLabel:Dr,navigationAriaLive:vr,navigationLabel:Ar,next2AriaLabel:zr,next2Label:qr,nextAriaLabel:lr,nextLabel:br,prev2AriaLabel:Qr,prev2Label:Tn,prevAriaLabel:Kt,prevLabel:We,setActiveStartDate:De,showDoubleView:en,view:mi,views:Ki}):null}var Vt=Array.isArray(ki)?ki:[ki];return Me.jsxs("div",{className:co(Rv,mr&&Vt.length===1&&"".concat(Rv,"--selectRange"),en&&"".concat(Rv,"--doubleView"),I),ref:ke,children:[Lt(),Me.jsxs("div",{className:"".concat(Rv,"__viewContainer"),onBlur:mr?ht:void 0,onMouseLeave:mr?ht:void 0,children:[Ze(),en?Ze(!0):null]})]})}),t0={exports:{}},q4=t0.exports,HP;function W4(){return HP||(HP=1,function(e,n){(function(l,u){e.exports=u()})(q4,function(){var l,u,y;function b(o,D){if(!l)l=D;else if(!u)u=D;else{var k="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",L={};l(L),y=D(L),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(y.workerUrl=window.URL.createObjectURL(new Blob([k],{type:"text/javascript"})))}}b(["exports"],function(o){var D=1e-6,k=typeof Float32Array<"u"?Float32Array:Array;function L(a,t){var i=t[0],c=t[1],h=t[2],p=t[3],g=i*p-h*c;return g?(a[0]=p*(g=1/g),a[1]=-c*g,a[2]=-h*g,a[3]=i*g,a):null}function $(){var a=new k(9);return k!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function q(a,t){var i=t[0],c=t[1],h=t[2],p=t[3],g=t[4],w=t[5],T=t[6],A=t[7],M=t[8];return a[0]=g*M-w*A,a[1]=h*A-c*M,a[2]=c*w-h*g,a[3]=w*T-p*M,a[4]=i*M-h*T,a[5]=h*p-i*w,a[6]=p*A-g*T,a[7]=c*T-i*A,a[8]=i*g-c*p,a}function Z(a,t,i){var c=t[0],h=t[1],p=t[2],g=t[3],w=t[4],T=t[5],A=t[6],M=t[7],O=t[8],z=i[0],U=i[1],V=i[2],H=i[3],re=i[4],ne=i[5],de=i[6],ue=i[7],X=i[8];return a[0]=z*c+U*g+V*A,a[1]=z*h+U*w+V*M,a[2]=z*p+U*T+V*O,a[3]=H*c+re*g+ne*A,a[4]=H*h+re*w+ne*M,a[5]=H*p+re*T+ne*O,a[6]=de*c+ue*g+X*A,a[7]=de*h+ue*w+X*M,a[8]=de*p+ue*T+X*O,a}function ie(){var a=new k(16);return k!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function oe(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function le(a,t){var i=t[0],c=t[1],h=t[2],p=t[3],g=t[4],w=t[5],T=t[6],A=t[7],M=t[8],O=t[9],z=t[10],U=t[11],V=t[12],H=t[13],re=t[14],ne=t[15],de=i*w-c*g,ue=i*T-h*g,X=i*A-p*g,se=c*T-h*w,he=c*A-p*w,_e=h*A-p*T,Ce=M*H-O*V,Re=M*re-z*V,Ne=M*ne-U*V,$e=O*re-z*H,at=O*ne-U*H,xt=z*ne-U*re,mt=de*xt-ue*at+X*$e+se*Ne-he*Re+_e*Ce;return mt?(a[0]=(w*xt-T*at+A*$e)*(mt=1/mt),a[1]=(h*at-c*xt-p*$e)*mt,a[2]=(H*_e-re*he+ne*se)*mt,a[3]=(z*he-O*_e-U*se)*mt,a[4]=(T*Ne-g*xt-A*Re)*mt,a[5]=(i*xt-h*Ne+p*Re)*mt,a[6]=(re*X-V*_e-ne*ue)*mt,a[7]=(M*_e-z*X+U*ue)*mt,a[8]=(g*at-w*Ne+A*Ce)*mt,a[9]=(c*Ne-i*at-p*Ce)*mt,a[10]=(V*he-H*X+ne*de)*mt,a[11]=(O*X-M*he-U*de)*mt,a[12]=(w*Re-g*$e-T*Ce)*mt,a[13]=(i*$e-c*Re+h*Ce)*mt,a[14]=(H*ue-V*se-re*de)*mt,a[15]=(M*se-O*ue+z*de)*mt,a):null}function xe(a,t,i){var c=t[0],h=t[1],p=t[2],g=t[3],w=t[4],T=t[5],A=t[6],M=t[7],O=t[8],z=t[9],U=t[10],V=t[11],H=t[12],re=t[13],ne=t[14],de=t[15],ue=i[0],X=i[1],se=i[2],he=i[3];return a[0]=ue*c+X*w+se*O+he*H,a[1]=ue*h+X*T+se*z+he*re,a[2]=ue*p+X*A+se*U+he*ne,a[3]=ue*g+X*M+se*V+he*de,a[4]=(ue=i[4])*c+(X=i[5])*w+(se=i[6])*O+(he=i[7])*H,a[5]=ue*h+X*T+se*z+he*re,a[6]=ue*p+X*A+se*U+he*ne,a[7]=ue*g+X*M+se*V+he*de,a[8]=(ue=i[8])*c+(X=i[9])*w+(se=i[10])*O+(he=i[11])*H,a[9]=ue*h+X*T+se*z+he*re,a[10]=ue*p+X*A+se*U+he*ne,a[11]=ue*g+X*M+se*V+he*de,a[12]=(ue=i[12])*c+(X=i[13])*w+(se=i[14])*O+(he=i[15])*H,a[13]=ue*h+X*T+se*z+he*re,a[14]=ue*p+X*A+se*U+he*ne,a[15]=ue*g+X*M+se*V+he*de,a}function ge(a,t,i){var c,h,p,g,w,T,A,M,O,z,U,V,H=i[0],re=i[1],ne=i[2];return t===a?(a[12]=t[0]*H+t[4]*re+t[8]*ne+t[12],a[13]=t[1]*H+t[5]*re+t[9]*ne+t[13],a[14]=t[2]*H+t[6]*re+t[10]*ne+t[14],a[15]=t[3]*H+t[7]*re+t[11]*ne+t[15]):(h=t[1],p=t[2],g=t[3],w=t[4],T=t[5],A=t[6],M=t[7],O=t[8],z=t[9],U=t[10],V=t[11],a[0]=c=t[0],a[1]=h,a[2]=p,a[3]=g,a[4]=w,a[5]=T,a[6]=A,a[7]=M,a[8]=O,a[9]=z,a[10]=U,a[11]=V,a[12]=c*H+w*re+O*ne+t[12],a[13]=h*H+T*re+z*ne+t[13],a[14]=p*H+A*re+U*ne+t[14],a[15]=g*H+M*re+V*ne+t[15]),a}function ke(a,t,i){var c=i[0],h=i[1],p=i[2];return a[0]=t[0]*c,a[1]=t[1]*c,a[2]=t[2]*c,a[3]=t[3]*c,a[4]=t[4]*h,a[5]=t[5]*h,a[6]=t[6]*h,a[7]=t[7]*h,a[8]=t[8]*p,a[9]=t[9]*p,a[10]=t[10]*p,a[11]=t[11]*p,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a}function et(a,t,i){var c=Math.sin(i),h=Math.cos(i),p=t[4],g=t[5],w=t[6],T=t[7],A=t[8],M=t[9],O=t[10],z=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=p*h+A*c,a[5]=g*h+M*c,a[6]=w*h+O*c,a[7]=T*h+z*c,a[8]=A*h-p*c,a[9]=M*h-g*c,a[10]=O*h-w*c,a[11]=z*h-T*c,a}function ze(a,t,i){var c=Math.sin(i),h=Math.cos(i),p=t[0],g=t[1],w=t[2],T=t[3],A=t[8],M=t[9],O=t[10],z=t[11];return t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=p*h-A*c,a[1]=g*h-M*c,a[2]=w*h-O*c,a[3]=T*h-z*c,a[8]=p*c+A*h,a[9]=g*c+M*h,a[10]=w*c+O*h,a[11]=T*c+z*h,a}function nt(a,t,i){var c=Math.sin(i),h=Math.cos(i),p=t[0],g=t[1],w=t[2],T=t[3],A=t[4],M=t[5],O=t[6],z=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=p*h+A*c,a[1]=g*h+M*c,a[2]=w*h+O*c,a[3]=T*h+z*c,a[4]=A*h-p*c,a[5]=M*h-g*c,a[6]=O*h-w*c,a[7]=z*h-T*c,a}function pt(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Gt(a,t,i){var c,h,p,g=i[0],w=i[1],T=i[2],A=Math.hypot(g,w,T);return A<D?null:(g*=A=1/A,w*=A,T*=A,c=Math.sin(t),h=Math.cos(t),a[0]=g*g*(p=1-h)+h,a[1]=w*g*p+T*c,a[2]=T*g*p-w*c,a[3]=0,a[4]=g*w*p-T*c,a[5]=w*w*p+h,a[6]=T*w*p+g*c,a[7]=0,a[8]=g*T*p+w*c,a[9]=w*T*p-g*c,a[10]=T*T*p+h,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function ir(a,t){var i=t[0],c=t[1],h=t[2],p=t[3],g=i+i,w=c+c,T=h+h,A=i*g,M=c*g,O=c*w,z=h*g,U=h*w,V=h*T,H=p*g,re=p*w,ne=p*T;return a[0]=1-O-V,a[1]=M+ne,a[2]=z-re,a[3]=0,a[4]=M-ne,a[5]=1-A-V,a[6]=U+H,a[7]=0,a[8]=z+re,a[9]=U-H,a[10]=1-A-O,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}Math.hypot||(Math.hypot=function(){for(var a=0,t=arguments.length;t--;)a+=arguments[t]*arguments[t];return Math.sqrt(a)});var Br=xe;function Zt(){var a=new k(3);return k!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function dr(a){var t=new k(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t}function Dr(a){return Math.hypot(a[0],a[1],a[2])}function vr(a,t,i){var c=new k(3);return c[0]=a,c[1]=t,c[2]=i,c}function Ar(a,t,i){return a[0]=t[0]+i[0],a[1]=t[1]+i[1],a[2]=t[2]+i[2],a}function zr(a,t,i){return a[0]=t[0]-i[0],a[1]=t[1]-i[1],a[2]=t[2]-i[2],a}function qr(a,t,i){return a[0]=t[0]*i[0],a[1]=t[1]*i[1],a[2]=t[2]*i[2],a}function lr(a,t,i){return a[0]=Math.min(t[0],i[0]),a[1]=Math.min(t[1],i[1]),a[2]=Math.min(t[2],i[2]),a}function br(a,t,i){return a[0]=Math.max(t[0],i[0]),a[1]=Math.max(t[1],i[1]),a[2]=Math.max(t[2],i[2]),a}function Ft(a,t,i){return a[0]=t[0]*i,a[1]=t[1]*i,a[2]=t[2]*i,a}function ot(a,t,i,c){return a[0]=t[0]+i[0]*c,a[1]=t[1]+i[1]*c,a[2]=t[2]+i[2]*c,a}function St(a,t){var i=t[0]-a[0],c=t[1]-a[1],h=t[2]-a[2];return i*i+c*c+h*h}function Ur(a){var t=a[0],i=a[1],c=a[2];return t*t+i*i+c*c}function gn(a,t){return a[0]=-t[0],a[1]=-t[1],a[2]=-t[2],a}function Sr(a,t){var i=t[0],c=t[1],h=t[2],p=i*i+c*c+h*h;return p>0&&(p=1/Math.sqrt(p)),a[0]=t[0]*p,a[1]=t[1]*p,a[2]=t[2]*p,a}function kr(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]}function Vr(a,t,i){var c=t[0],h=t[1],p=t[2],g=i[0],w=i[1],T=i[2];return a[0]=h*T-p*w,a[1]=p*g-c*T,a[2]=c*w-h*g,a}function wn(a,t,i,c){var h=t[0],p=t[1],g=t[2];return a[0]=h+c*(i[0]-h),a[1]=p+c*(i[1]-p),a[2]=g+c*(i[2]-g),a}function Nt(a,t,i){var c=t[0],h=t[1],p=t[2],g=i[3]*c+i[7]*h+i[11]*p+i[15];return a[0]=(i[0]*c+i[4]*h+i[8]*p+i[12])/(g=g||1),a[1]=(i[1]*c+i[5]*h+i[9]*p+i[13])/g,a[2]=(i[2]*c+i[6]*h+i[10]*p+i[14])/g,a}function Qr(a,t,i){var c=t[0],h=t[1],p=t[2];return a[0]=c*i[0]+h*i[3]+p*i[6],a[1]=c*i[1]+h*i[4]+p*i[7],a[2]=c*i[2]+h*i[5]+p*i[8],a}function Tn(a,t,i){var c=i[0],h=i[1],p=i[2],g=t[0],w=t[1],T=t[2],A=h*T-p*w,M=p*g-c*T,O=c*w-h*g,z=h*O-p*M,U=p*A-c*O,V=c*M-h*A,H=2*i[3];return M*=H,O*=H,U*=2,V*=2,a[0]=g+(A*=H)+(z*=2),a[1]=w+M+U,a[2]=T+O+V,a}function Kt(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]}var We=zr,fr=qr,jr=Dr;function mr(){var a=new k(4);return k!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function en(a,t,i){return a[0]=t[0]*i,a[1]=t[1]*i,a[2]=t[2]*i,a[3]=t[3]*i,a}function uo(a,t){var i=t[0],c=t[1],h=t[2],p=t[3],g=i*i+c*c+h*h+p*p;return g>0&&(g=1/Math.sqrt(g)),a[0]=i*g,a[1]=c*g,a[2]=h*g,a[3]=p*g,a}function Oi(a,t,i){var c=t[0],h=t[1],p=t[2],g=t[3];return a[0]=i[0]*c+i[4]*h+i[8]*p+i[12]*g,a[1]=i[1]*c+i[5]*h+i[9]*p+i[13]*g,a[2]=i[2]*c+i[6]*h+i[10]*p+i[14]*g,a[3]=i[3]*c+i[7]*h+i[11]*p+i[15]*g,a}function Di(){var a=new k(4);return k!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function ii(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function ti(a,t,i){i*=.5;var c=t[0],h=t[1],p=t[2],g=t[3],w=Math.sin(i),T=Math.cos(i);return a[0]=c*T+g*w,a[1]=h*T+p*w,a[2]=p*T-h*w,a[3]=g*T-c*w,a}function $i(a,t,i){i*=.5;var c=t[0],h=t[1],p=t[2],g=t[3],w=Math.sin(i),T=Math.cos(i);return a[0]=c*T-p*w,a[1]=h*T+g*w,a[2]=p*T+c*w,a[3]=g*T-h*w,a}Zt(),mr();var Zn,Ii,ci,Co,Ka,oa=uo,ta=(Zn=Zt(),Ii=vr(1,0,0),ci=vr(0,1,0),function(a,t,i){var c=kr(t,i);return c<-.999999?(Vr(Zn,Ii,t),jr(Zn)<1e-6&&Vr(Zn,ci,t),Sr(Zn,Zn),function(h,p,g){g*=.5;var w=Math.sin(g);h[0]=w*p[0],h[1]=w*p[1],h[2]=w*p[2],h[3]=Math.cos(g)}(a,Zn,Math.PI),a):c>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(Vr(Zn,t,i),a[0]=Zn[0],a[1]=Zn[1],a[2]=Zn[2],a[3]=1+c,oa(a,a))});function ho(){var a=new k(2);return k!=Float32Array&&(a[0]=0,a[1]=0),a}function js(a,t){var i=new k(2);return i[0]=a,i[1]=t,i}function fa(a,t,i){return a[0]=t[0]+i[0],a[1]=t[1]+i[1],a}function pa(a,t,i){return a[0]=t[0]-i[0],a[1]=t[1]-i[1],a}function un(a,t,i){return a[0]=t[0]*i,a[1]=t[1]*i,a}function zn(a){return Math.hypot(a[0],a[1])}function Cn(a,t){var i=t[0],c=t[1],h=i*i+c*c;return h>0&&(h=1/Math.sqrt(h)),a[0]=t[0]*h,a[1]=t[1]*h,a}function Fr(a,t){return a[0]*t[0]+a[1]*t[1]}function Bn(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}Di(),Di(),$(),ho();var oi,An,Nn=function(){if(Ka)return Co;function a(t,i,c,h){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=c,this.p2y=h}return Ka=1,Co=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,h=0;h<8;h++){var p=this.sampleCurveX(c)-t;if(Math.abs(p)<i)return c;var g=this.sampleCurveDerivativeX(c);if(Math.abs(g)<1e-6)break;c-=p/g}var w=0,T=1;for(c=t,h=0;h<20&&(p=this.sampleCurveX(c),!(Math.abs(p-t)<i));h++)t>p?w=c:T=c,c=.5*(T-w)+w;return c},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},Co}(),Xn=Bn(Nn);function ki(){if(An)return oi;function a(t,i){this.x=t,this.y=i}return An=1,oi=a,a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,i){return this.clone()._rotateAround(t,i)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var i=t.x-this.x,c=t.y-this.y;return i*i+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,i){return Math.atan2(this.x*i-this.y*t,this.x*t+this.y*i)},_matMult:function(t){var i=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var i=Math.cos(t),c=Math.sin(t),h=c*this.x+i*this.y;return this.x=i*this.x-c*this.y,this.y=h,this},_rotateAround:function(t,i){var c=Math.cos(t),h=Math.sin(t),p=i.y+h*(this.x-i.x)+c*(this.y-i.y);return this.x=i.x+c*(this.x-i.x)-h*(this.y-i.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t},oi}var Dt=Bn(ki());function mi(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let i=0;i<a.length;i++)if(!mi(a[i],t[i]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const i in a)if(!mi(a[i],t[i]))return!1;return!0}return a===t}const Ki=Math.PI/180,Qe=180/Math.PI;function Q(a){return a*Ki}function ae(a){return a*Qe}const Se=[[0,0],[1,0],[1,1],[0,1]];function De(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,i=t*a;return 4*(a<.5?i:3*(a-t)+i-.75)}function Pe(a,t,i,c){const h=new Xn(a,t,i,c);return function(p){return h.solve(p)}}const Le=Pe(.25,.1,.25,1);function Fe(a,t,i){return Math.min(i,Math.max(t,a))}function Be(a,t,i){return(i=Fe((i-a)/(t-a),0,1))*i*(3-2*i)}function Ye(a,t,i){const c=i-t,h=((a-t)%c+c)%c+t;return h===t?i:h}function ht(a,t,i){if(!a.length)return i(null,[]);let c=a.length;const h=new Array(a.length);let p=null;a.forEach((g,w)=>{t(g,(T,A)=>{T&&(p=T),h[w]=A,--c==0&&i(p,h)})})}function Ze(a,...t){for(const i of t)for(const c in i)a[c]=i[c];return a}let Lt=1;function Vt(){return Lt++}function Ot(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function gr(a,t){a.forEach(i=>{t[i]&&(t[i]=t[i].bind(t))})}function wr(a,t,i){const c={};for(const h in a)c[h]=t.call(this,a[h],h,a);return c}function Mr(a,t,i){const c={};for(const h in a)t.call(this,a[h],h,a)&&(c[h]=a[h]);return c}function Nr(a){return Array.isArray(a)?a.map(Nr):typeof a=="object"&&a?wr(a,Nr):a}const ui={};function tn(a){ui[a]||(typeof console<"u"&&console.warn(a),ui[a]=!0)}function Jn(a,t,i){return(i.y-a.y)*(t.x-a.x)>(t.y-a.y)*(i.x-a.x)}function Rn(a){let t=0;for(let i,c,h=0,p=a.length,g=p-1;h<p;g=h++)i=a[h],c=a[g],t+=(c.x-i.x)*(i.y+c.y);return t}function hn([a,t,i]){const c=Q(t+90),h=Q(i);return{x:a*Math.cos(c)*Math.sin(h),y:a*Math.sin(c)*Math.sin(h),z:a*Math.cos(h),azimuthal:t,polar:i}}function li(a){return(typeof self<"u"||a!==void 0)&&typeof WorkerGlobalScope<"u"&&(a!==void 0?a:self)instanceof WorkerGlobalScope}function ji(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,c,h,p)=>{const g=h||p;return t[c]=!g||g.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}let oo=null;function fo(a,t){return[a[4*t],a[4*t+1],a[4*t+2],a[4*t+3]]}function Ho(a,t,i,c){for(;t<i;){const h=t+i>>1;a[h]<c?t=h+1:i=h}return t}function sl(a,t,i,c){for(;t<i;){const h=t+i>>1;a[h]<=c?t=h+1:i=h}return t}function ko(a){return a>0?1/(1.001-a):1+a}function eo(a){return a>0?1-1/(1.001-a):-a}function Ro(a,t,i){return(a-t.min)*(i.max-i.min)/(t.max-t.min)+i.min}const Wi={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Wi.API_URL)return null;try{const a=new URL(Wi.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ll(a){return Wi.API_URL_REGEX.test(a)}function _u(a){return Wi.API_SPRITE_REGEX.test(a)}let dd,Hl,yu,Zl,cl,fd;function Cp(){return dd==null&&(dd=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),dd}const Ja={now:()=>Zl!==void 0?Zl:performance.now(),setNow(a){Zl=a},restoreNow(){Zl=void 0},frame(a){const t=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(a,t=0){const{width:i,height:c}=a;cl||(cl=document.createElement("canvas"));const h=cl.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>cl.width||c>cl.height)&&(cl.width=i,cl.height=c),h.clearRect(-t,-t,i+2*t,c+2*t),h.drawImage(a,0,0,i,c),h.getImageData(-t,-t,i+2*t,c+2*t)},resolveURL:a=>(Hl||(Hl=document.createElement("a")),Hl.href=a,Hl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(yu==null&&(yu=window.matchMedia("(prefers-reduced-motion: reduce)")),yu.matches)},hasCanvasFingerprintNoise(){if(fd!==void 0)return fd;if(!Cp())return fd=!1,!1;const a=new OffscreenCanvas(85,1),t=a.getContext("2d",{willReadFrequently:!0});let i=0;for(let h=0;h<a.width;++h)t.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,t.fillRect(h,0,1,1);const c=t.getImageData(0,0,a.width,a.height);i=0;for(let h=0;h<c.data.length;++h)if(h%4!=3&&i++!==c.data[h])return fd=!0,!0;return fd=!1,!1}};function yf(a,t){const i=a.indexOf("?");if(i<0)return`${a}?${new URLSearchParams(t).toString()}`;const c=new URLSearchParams(a.slice(i));for(const h in t)c.set(h,t[h]);return`${a.slice(0,i)}?${c.toString()}`}function ma(a,t={persistentParams:[]}){const i=a.indexOf("?");if(i<0)return a;const c=new URLSearchParams,h=new URLSearchParams(a.slice(i));for(const g of t.persistentParams){const w=h.get(g);w&&c.set(g,w)}const p=c.toString();return`${a.slice(0,i)}${p.length>0?`?${p}`:""}`}const Pa="mapbox-tiles";let Xl=500,Qa=50;const hi=["language","worldview","jobid"];let es,ch;function pd(){try{return caches}catch{}}function ul(){const a=pd();a&&es==null&&(es=a.open(Pa))}let uh=1/0;const vf={supported:!1,testSupport:function(a){!Us&&Zo&&(Vs?hh(a):vu=a)}};let vu,Zo,Us=!1,Vs=!1;const ts=typeof self<"u"?self:{};function hh(a){const t=a.createTexture();a.bindTexture(a.TEXTURE_2D,t);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Zo),a.isContextLost())return;vf.supported=!0}catch{}a.deleteTexture(t),Us=!0}ts.document&&(Zo=ts.document.createElement("img"),Zo.onload=function(){vu&&hh(vu),vu=null,Vs=!0},Zo.onerror=function(){Us=!0,vu=null},Zo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Mc={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Mc);class $s extends Error{constructor(t,i,c){i===401&&ll(c)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=i,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Mn=li()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,xu=function(a,t){if(!(/^file:/.test(i=a.url)||/^file:/.test(Mn())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,h){const p=new AbortController,g=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Mn(),referrerPolicy:c.referrerPolicy,signal:p.signal});let w=!1,T=!1;const A=(M=g.url).indexOf("sku=")>0&&ll(M);var M;c.type==="json"&&g.headers.set("Accept","application/json");const O=(U,V,H)=>{if(T)return;if(U&&U.message!=="SecurityError"&&tn(U.toString()),V&&H)return z(V);const re=Date.now();fetch(g).then(ne=>{if(ne.ok){const de=A?ne.clone():null;return z(ne,de,re)}return h(new $s(ne.statusText,ne.status,c.url))}).catch(ne=>{ne.name!=="AbortError"&&h(new Error(`${ne.message} ${c.url}`))})},z=(U,V,H)=>{(c.type==="arrayBuffer"?U.arrayBuffer():c.type==="json"?U.json():U.text()).then(re=>{T||(V&&H&&function(ne,de,ue){if(ul(),es==null)return;const X=ji(de.headers.get("Cache-Control")||"");if(X["no-store"])return;const se={status:de.status,statusText:de.statusText,headers:new Headers};de.headers.forEach((Ce,Re)=>se.headers.set(Re,Ce)),X["max-age"]&&se.headers.set("Expires",new Date(ue+1e3*X["max-age"]).toUTCString());const he=se.headers.get("Expires");if(!he||new Date(he).getTime()-ue<42e4)return;let _e=ma(ne.url,{persistentParams:hi});if(de.status===206){const Ce=ne.headers.get("Range");if(!Ce)return;se.status=200,_e=yf(_e,{range:Ce})}(function(Ce,Re){if(ch===void 0)try{new Response(new ReadableStream),ch=!0}catch{ch=!1}ch?Re(Ce.body):Ce.blob().then(Re).catch(Ne=>tn(Ne.message))})(de,Ce=>{const Re=new Response((Ne=de.status)!==200&&Ne!==404&&[101,103,204,205,304].includes(Ne)?null:Ce,se);var Ne;ul(),es!=null&&es.then($e=>$e.put(_e,Re)).catch($e=>tn($e.message))})}(g,V,H),w=!0,h(null,re,U.headers.get("Cache-Control"),U.headers.get("Expires")))}).catch(re=>{T||h(new Error(re.message))})};return A?function(U,V){if(ul(),es==null)return V(null);es.then(H=>{let re=ma(U.url,{persistentParams:hi});const ne=U.headers.get("Range");ne&&(re=yf(re,{range:ne})),H.match(re).then(de=>{const ue=function(X){if(!X)return!1;const se=new Date(X.headers.get("Expires")||0),he=ji(X.headers.get("Cache-Control")||"");return Number(se)>Date.now()&&!he["no-cache"]}(de);H.delete(re).catch(V),ue&&H.put(re,de.clone()).catch(V),V(null,de,ue)}).catch(V)}).catch(V)}(g,O):O(null,null),{cancel:()=>{T=!0,w||p.abort()}}}(a,t);if(li(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,t,void 0,!0)}var i;return function(c,h){const p=new XMLHttpRequest;p.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const g in c.headers)p.setRequestHeader(g,c.headers[g]);return c.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=c.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let g=p.response;if(c.type==="json")try{g=JSON.parse(p.response)}catch(w){return h(w)}h(null,g,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new $s(p.statusText,p.status,c.url))},p.send(c.body),{cancel:()=>p.abort()}}(a,t)},hl=function(a,t){return xu(Ze(a,{type:"arrayBuffer"}),t)};function Yg(a){const t=document.createElement("a");return t.href=a,t.protocol===location.protocol&&t.host===location.host}const Mp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let dl,Yl;dl=[],Yl=0;const dh=function(a,t){if(vf.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Yl>=Wi.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:a,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return dl.push(p),p}Yl++;let i=!1;const c=()=>{if(!i)for(i=!0,Yl--;dl.length&&Yl<Wi.MAX_PARALLEL_IMAGE_REQUESTS;){const p=dl.shift(),{requestParameters:g,callback:w,cancelled:T}=p;T||(p.cancel=dh(g,w).cancel)}},h=hl(a,(p,g,w,T)=>{c(),p?t(p):g&&(self.createImageBitmap?function(A,M){const O=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(O).then(z=>{M(null,z)}).catch(z=>{M(new Error(`Could not load image because of ${z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(A,M)=>t(A,M,w,T)):function(A,M){const O=new Image;O.onload=()=>{M(null,O),URL.revokeObjectURL(O.src),O.onload=null,requestAnimationFrame(()=>{O.src=Mp})},O.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new Blob([new Uint8Array(A)],{type:"image/png"});O.src=A.byteLength?URL.createObjectURL(z):Mp}(g,(A,M)=>t(A,M,w,T)))});return{cancel:()=>{h.cancel(),c()}}};var fh,bu,ys,Oc={exports:{}},ph={exports:{}},xf={exports:{}},md=function(){if(ys)return Oc.exports;ys=1;var a=(fh||(fh=1,ph.exports=function(i,c){var h,p,g,w,T,A,M,O;for(p=i.length-(h=3&i.length),g=c,T=3432918353,A=461845907,O=0;O<p;)M=255&i.charCodeAt(O)|(255&i.charCodeAt(++O))<<8|(255&i.charCodeAt(++O))<<16|(255&i.charCodeAt(++O))<<24,++O,g=27492+(65535&(w=5*(65535&(g=(g^=M=(65535&(M=(M=(65535&M)*T+(((M>>>16)*T&65535)<<16)&4294967295)<<15|M>>>17))*A+(((M>>>16)*A&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(M=0,h){case 3:M^=(255&i.charCodeAt(O+2))<<16;case 2:M^=(255&i.charCodeAt(O+1))<<8;case 1:g^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(O)))*T+(((M>>>16)*T&65535)<<16)&4294967295)<<15|M>>>17))*A+(((M>>>16)*A&65535)<<16)&4294967295}return g^=i.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),ph.exports),t=(bu||(bu=1,xf.exports=function(i,c){for(var h,p=i.length,g=c^p,w=0;p>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++w;switch(p){case 3:g^=(255&i.charCodeAt(w+2))<<16;case 2:g^=(255&i.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&i.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),xf.exports);return Oc.exports=a,Oc.exports.murmur3=a,Oc.exports.murmur2=t,Oc.exports}(),aa=Bn(md);class fl{constructor(t,...i){Ze(this,i[0]||{}),this.type=t}}class bf extends fl{constructor(t,i={}){super("error",Ze({error:t},i))}}function pl(a,t,i){i[a]&&i[a].indexOf(t)!==-1||(i[a]=i[a]||[],i[a].push(t))}function mh(a,t,i){if(i&&i[a]){const c=i[a].indexOf(t);c!==-1&&i[a].splice(c,1)}}class ml{on(t,i){return this._listeners=this._listeners||{},pl(t,i,this._listeners),this}off(t,i){return mh(t,i,this._listeners),mh(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},pl(t,i,this._oneTimeListeners),this):new Promise(c=>{this.once(t,c)})}fire(t,i){const c=typeof t=="string"?new fl(t,i):t,h=c.type;if(this.listens(h)){c.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const T of p)T.call(this,c);const g=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const T of g)mh(h,T,this._oneTimeListeners),T.call(this,c);const w=this._eventedParent;w&&(Ze(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(c))}else c instanceof bf&&console.error(c.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}class Ca{constructor(t){typeof t=="string"?this.name=t:(this.name=t.name,this.iconsetId=t.iconsetId)}static from(t){return new Ca(t)}static toString(t){return t.iconsetId?`${t.name}${t.iconsetId}`:t.name}static parse(t){const[i,c]=t.split("");return new Ca({name:i,iconsetId:c})}static isEqual(t,i){return t.name===i.name&&t.iconsetId===i.iconsetId}toString(){return Ca.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var gh,wu={},_h=function(){if(gh)return wu;gh=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(p){return(p=Math.round(p))<0?0:p>255?255:p}function i(p){return t(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function c(p){return(g=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:g>1?1:g;var g}function h(p,g,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?p+(g-p)*w*6:2*w<1?g:3*w<2?p+(g-p)*(2/3-w)*6:p}try{wu.parseCSSColor=function(p){var g,w=p.replace(/ /g,"").toLowerCase();if(w in a)return a[w].slice();if(w[0]==="#")return w.length===4?(g=parseInt(w.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:w.length===7&&(g=parseInt(w.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var T=w.indexOf("("),A=w.indexOf(")");if(T!==-1&&A+1===w.length){var M=w.substr(0,T),O=w.substr(T+1,A-(T+1)).split(","),z=1;switch(M){case"rgba":if(O.length!==4)return null;z=c(O.pop());case"rgb":return O.length!==3?null:[i(O[0]),i(O[1]),i(O[2]),z];case"hsla":if(O.length!==4)return null;z=c(O.pop());case"hsl":if(O.length!==3)return null;var U=(parseFloat(O[0])%360+360)%360/360,V=c(O[1]),H=c(O[2]),re=H<=.5?H*(V+1):H+V-H*V,ne=2*H-re;return[t(255*h(ne,re,U+1/3)),t(255*h(ne,re,U)),t(255*h(ne,re,U-1/3)),z];default:return null}}return null}}catch{}return wu}();class dn{constructor(t,i,c,h=1){this.r=t,this.g=i,this.b=c,this.a=h}static parse(t){if(!t)return;if(t instanceof dn)return t;if(typeof t!="string")return;const i=_h.parseCSSColor(t);return i?new dn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toStringPremultipliedAlpha(){const[t,i,c,h]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(t)},${Math.round(i)},${Math.round(c)},${h})`}toString(){const[t,i,c,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*t)},${Math.round(255*i)},${Math.round(255*c)},${h})`}toRenderColor(t){const{r:i,g:c,b:h,a:p}=this;return new Su(t,i,c,h,p)}clone(){return new dn(this.r,this.g,this.b,this.a)}}class Su{constructor(t,i,c,h,p){if(t){const g=t.image.height,w=g*g;i=p===0?0:i/p*(g-1),c=p===0?0:c/p*(g-1),h=p===0?0:h/p*(g-1);const T=Math.floor(i),A=Math.floor(c),M=Math.floor(h),O=Math.ceil(i),z=Math.ceil(c),U=Math.ceil(h),V=i-T,H=c-A,re=h-M,ne=t.image.data,de=4*(T+A*w+M*g),ue=4*(T+A*w+U*g),X=4*(T+z*w+M*g),se=4*(T+z*w+U*g),he=4*(O+A*w+M*g),_e=4*(O+A*w+U*g),Ce=4*(O+z*w+M*g),Re=4*(O+z*w+U*g);if(de<0||Re>=ne.length)throw new Error("out of range");this.r=xr(xr(xr(ne[de],ne[ue],re),xr(ne[X],ne[se],re),H),xr(xr(ne[he],ne[_e],re),xr(ne[Ce],ne[Re],re),H),V)/255*p,this.g=xr(xr(xr(ne[de+1],ne[ue+1],re),xr(ne[X+1],ne[se+1],re),H),xr(xr(ne[he+1],ne[_e+1],re),xr(ne[Ce+1],ne[Re+1],re),H),V)/255*p,this.b=xr(xr(xr(ne[de+2],ne[ue+2],re),xr(ne[X+2],ne[se+2],re),H),xr(xr(ne[he+2],ne[_e+2],re),xr(ne[Ce+2],ne[Re+2],re),H),V)/255*p,this.a=p}else this.r=i,this.g=c,this.b=h,this.a=p}toArray(){const{r:t,g:i,b:c,a:h}=this;return h===0?[0,0,0,0]:[255*t/h,255*i/h,255*c/h,h]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:t,g:i,b:c,a:h}=this,p=Math.min(Math.max(t/h,0),1),g=Math.min(Math.max(i/h,0),1),w=Math.min(Math.max(c/h,0),1),T=Math.min(p,g,w),A=Math.max(p,g,w),M=(T+A)/2;if(T===A)return[0,0,100*M,h];const O=A-T,z=M>.5?O/(2-A-T):O/(A+T);let U=0;return A===p?U=(g-w)/O+(g<w?6:0):A===g?U=(w-p)/O+2:A===w&&(U=(p-g)/O+4),U*=60,[Math.min(Math.max(U,0),360),Math.min(Math.max(100*z,0),100),Math.min(Math.max(100*M,0),100),h]}toArray01(){const{r:t,g:i,b:c,a:h}=this;return h===0?[0,0,0,0]:[t/h,i/h,c/h,h]}toArray01Scaled(t){const{r:i,g:c,b:h,a:p}=this;return p===0?[0,0,0]:[i/p*t,c/p*t,h/p*t]}toArray01PremultipliedAlpha(){const{r:t,g:i,b:c,a:h}=this;return[t,i,c,h]}toArray01Linear(){const{r:t,g:i,b:c,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(t/h,2.2),Math.pow(i/h,2.2),Math.pow(c/h,2.2),h]}}function xr(a,t,i){return a*(1-i)+t*i}function yh(a,t,i){return a.map((c,h)=>xr(c,t[h],i))}function wf(a){return a*a*a*a*a}dn.black=new dn(0,0,0,1),dn.white=new dn(1,1,1,1),dn.transparent=new dn(0,0,0,0),dn.red=new dn(1,0,0,1),dn.blue=new dn(0,0,1,1);var vh=Object.freeze({__proto__:null,array:yh,color:function(a,t,i){return new dn(xr(a.r,t.r,i),xr(a.g,t.g,i),xr(a.b,t.b,i),xr(a.a,t.a,i))},easeIn:wf,number:xr});function Tu(a,...t){for(const i of t)for(const c in i)a[c]=i[c];return a}class ga extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}class gl{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[c,h]of i)this.bindings[c]=h}concat(t){return new gl(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Kl={kind:"null"},ur={kind:"number"},Qn={kind:"string"},Vn={kind:"boolean"},sa={kind:"color"},Dc={kind:"object"},jn={kind:"value"},Eu={kind:"collator"},gd={kind:"formatted"},_d={kind:"resolvedImage"};function la(a,t){return{kind:"array",itemType:a,N:t}}function po(a){if(a.kind==="array"){const t=po(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const Kg=[Kl,ur,Qn,Vn,sa,gd,Dc,la(jn),_d];function yd(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!yd(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const i of Kg)if(!yd(i,t))return null}}return`Expected ${po(a)} but found ${po(t)} instead.`}function Op(a,t){return t.some(i=>i.kind===a.kind)}function kc(a,t){return t.some(i=>i==="null"?a===null:i==="array"?Array.isArray(a):i==="object"?a&&!Array.isArray(a)&&typeof a=="object":i===typeof a)}class Rc{constructor(t,i,c){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Sf{constructor(t,i,c,h,p){this.text=t.normalize?t.normalize():t,this.image=i,this.scale=c,this.fontStack=h,this.textColor=p}}class _a{constructor(t){this.sections=t}static fromString(t){return new _a([new Sf(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||!!t.image&&t.image.hasPrimary())}static factory(t){return t instanceof _a?t:_a.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const i of this.sections){if(i.image){const h=i.image.getPrimary().id.toString();t.push(["image",h]);continue}t.push(i.text);const c={};i.fontStack&&(c["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(c["font-scale"]=i.scale),i.textColor&&(c["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),t.push(c)}return t}}class vs{constructor(t,i={}){if(this.id=Ca.from(t),this.options=Object.assign({},i),i.transform){const{a:c,b:h,c:p,d:g,e:w,f:T}=i.transform;this.options.transform=new DOMMatrix([c,h,p,g,w,T])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:t,b:i,c,d:h,e:p,f:g}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:t,b:i,c,d:h,e:p,f:g}})}static parse(t){let i,c,h,p;try{({name:i,iconsetId:c,params:h,transform:p}=JSON.parse(t)||{})}catch{return null}if(!i)return null;const{a:g,b:w,c:T,d:A,e:M,f:O}=p||{};return new vs({name:i,iconsetId:c},{params:h,transform:new DOMMatrix([g,w,T,A,M,O])})}scaleSelf(t,i){return this.options.transform.scaleSelf(t,i),this}}class Ma{constructor(t,i,c,h,p=!1){this.primaryId=Ca.from(t),this.primaryOptions=i,c&&(this.secondaryId=Ca.from(c)),this.secondaryOptions=h,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new vs(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new vs(this.secondaryId,this.secondaryOptions):null}static from(t){return typeof t=="string"?Ma.build({name:t}):t}static build(t,i,c,h){return!t||typeof t=="object"&&!("name"in t)?null:new Ma(t,c,i,h)}}function Hm(a,t,i,c){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[a,t,i,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[a,t,i,c]:[a,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function xh(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof dn||a instanceof Rc||a instanceof _a||a instanceof Ma)return!0;if(Array.isArray(a)){for(const t of a)if(!xh(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!xh(a[t]))return!1;return!0}return!1}function bo(a){if(a===null)return Kl;if(typeof a=="string")return Qn;if(typeof a=="boolean")return Vn;if(typeof a=="number")return ur;if(a instanceof dn)return sa;if(a instanceof Rc)return Eu;if(a instanceof _a)return gd;if(a instanceof Ma)return _d;if(Array.isArray(a)){const t=a.length;let i;for(const c of a){const h=bo(c);if(i){if(i===h)continue;i=jn;break}i=h}return la(i||jn,t)}return Dc}function ya(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof dn?a.toStringPremultipliedAlpha():a instanceof _a||a instanceof Ma?a.toString():JSON.stringify(a)}class Yr{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!xh(t[1]))return i.error("invalid value");const c=t[1];let h=bo(c);const p=i.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new Yr(h,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof dn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof _a?this.value.serialize():this.value}}class Jt{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Au={string:Qn,number:ur,boolean:Vn,object:Dc};class Tr{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let c,h=1;const p=t[0];if(p==="array"){let w,T;if(t.length>2){const A=t[1];if(typeof A!="string"||!(A in Au)||A==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);w=Au[A],h++}else w=jn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);T=t[2],h++}c=la(w,T)}else c=Au[p];const g=[];for(;h<t.length;h++){const w=i.parse(t[h],h,jn);if(!w)return null;g.push(w)}return new Tr(c,g)}evaluate(t){for(let i=0;i<this.args.length;i++){const c=this.args[i].evaluate(t);if(!yd(this.type,bo(c)))return c;if(i===this.args.length-1)throw new Jt(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${po(bo(c))} but was expected to be of type ${po(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,i=[t.kind];if(t.kind==="array"){const c=t.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){i.push(c.kind);const h=t.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(c=>c.serialize()))}}class Iu{constructor(t){this.type=gd,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return i.error("First argument must be an image or text section.");const h=[];let p=!1;for(let g=1;g<=t.length-1;++g){const w=t[g];if(p&&typeof w=="object"&&!Array.isArray(w)){p=!1;let T=null;if(w["font-scale"]&&(T=i.parseObjectValue(w["font-scale"],g,"font-scale",ur),!T))return null;let A=null;if(w["text-font"]&&(A=i.parseObjectValue(w["text-font"],g,"text-font",la(Qn)),!A))return null;let M=null;if(w["text-color"]&&(M=i.parseObjectValue(w["text-color"],g,"text-color",sa),!M))return null;const O=h[h.length-1];O.scale=T,O.font=A,O.textColor=M}else{const T=i.parse(t[g],g,jn);if(!T)return null;const A=T.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:T,scale:null,font:null,textColor:null})}}return new Iu(h)}evaluate(t){return new _a(this.sections.map(i=>{const c=i.content.evaluate(t);return bo(c)===_d?new Sf("",c,null,null,null):new Sf(ya(c),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const i of this.sections){t.push(i.content.serialize());const c={};i.scale&&(c["font-scale"]=i.scale.serialize()),i.font&&(c["text-font"]=i.font.serialize()),i.textColor&&(c["text-color"]=i.textColor.serialize()),t.push(c)}return t}}class Pu{constructor(t,i,c,h){this._imageWarnHistory={},this.type=_d,this.namePrimary=t,this.nameSecondary=i,c&&(this.paramsPrimary=c.params,this.iconsetIdPrimary=c.iconset?c.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(t,i){if(t.length<2)return i.error("Expected two or more arguments.");let c=1;const h=[];function p(){if(c<t.length){const w=i.parse(t[c],c++,Qn);return w?(h.push({image:w,options:{}}),!0):(i.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(c<t.length){const T=t[c];if((w=T)===null||typeof w!="object"||Array.isArray(w))return!0;const A=T.params,M=T.iconset,O=i.concat(c);if(!A&&!M)return c++,!0;if(A){if(typeof A!="object"||A.constructor!==Object)return O.error('Image options "params" should be an object'),!1;const z={},U=O.concat(void 0,"params");for(const V in A){if(!V)return U.error("Image parameter name should be non-empty"),!1;const H=U.concat(void 0,V).parse(A[V],void 0,sa,void 0,{typeAnnotation:"coerce"});if(!H)return!1;z[V]=H}h[h.length-1].options.params=z}if(M){if(typeof M!="object"||M.constructor!==Object)return O.error('Image options "iconset" should be an object'),!1;if(!M.id)return O.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=M}return c++,!0}var w;return!0}for(let w=0;w<2;w++)if(!p()||!g())return;return new Pu(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(t,i){const c={};if(i){for(const h in i)if(i[h])try{c[h]=i[h].evaluate(t)}catch{continue}if(Object.keys(c).length!==0)return{params:c}}}evaluate(t){const i={name:this.namePrimary.evaluate(t),iconsetId:this.iconsetIdPrimary},c=this.nameSecondary?{name:this.nameSecondary.evaluate(t),iconsetId:this.iconsetIdSecondary}:void 0,h=Ma.build(i,c,this.paramsPrimary?this.evaluateParams(t,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(t,this.paramsSecondary):void 0);if(h&&t.availableImages){const p=h.getPrimary().id;if(h.available=t.availableImages.some(g=>Ca.isEqual(g,p)),h.available){const g=h.getSecondary()?h.getSecondary().id:null;g&&(h.available=t.availableImages.some(w=>Ca.isEqual(w,g)))}}return h}eachChild(t){if(t(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&t(this.paramsPrimary[i]);if(this.nameSecondary&&(t(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&t(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(t,i){const c={};if(i&&(c.iconset={id:i}),t){c.params={};for(const h in t)t[h]&&(c.params[h]=t[h].serialize())}return Object.keys(c).length>0?c:void 0}serialize(){const t=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&t.push(i)}if(this.nameSecondary&&(t.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&t.push(i)}return t}}function Pr(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}const Dp={"to-boolean":Vn,"to-color":sa,"to-number":ur,"to-string":Qn};class xs{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const c=t[0],h=[];let p=Kl;if(c==="to-array"){if(!Array.isArray(t[1]))return null;const g=t[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);p=la(i.expectedType.itemType,g)}else{if(!(g>0&&xh(t[1][0])))return null;p=la(bo(t[1][0]),g)}for(let w=0;w<g;w++){const T=t[1][w];let A;if(Pr(T)==="array")A=i.parse(T,void 0,p.itemType);else{const M=Pr(T);if(M!==p.itemType.kind)return i.error(`Expected ${p.itemType.kind} but found ${M}.`);A=i.registry.literal.parse(["literal",T===void 0?null:T],i)}if(!A)return null;h.push(A)}}else{if((c==="to-boolean"||c==="to-string")&&t.length!==2)return i.error("Expected one argument.");p=Dp[c];for(let g=1;g<t.length;g++){const w=i.parse(t[g],g,jn);if(!w)return null;h.push(w)}}return new xs(p,h)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let i,c;for(const h of this.args){if(i=h.evaluate(t),c=null,i instanceof dn)return i;if(typeof i=="string"){const p=t.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(c=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Hm(i[0],i[1],i[2],i[3]),!c))return new dn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Jt(c||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const c of this.args){if(i=c.evaluate(t),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new Jt(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?_a.fromString(ya(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Ma.build(ya(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(i=>i.evaluate(t)):ya(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Iu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Pu(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{t.push(i.serialize())}),t}}const kp=["Unknown","Point","LineString","Polygon"];class Jl{constructor(t,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?kp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:c,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*i-t[0])+this.featureDistanceData.bearing[1]*(h*i-t[1])}return 0}parseColor(t){let i=this._parseColorCache[t];return i||(i=this._parseColorCache[t]=dn.parse(t)),i}getConfig(t){return this.options?this.options.get(t):null}}class ca{constructor(t,i,c,h,p){this.name=t,this.type=i,this._evaluate=c,this.args=h,this._overloadIndex=p}evaluate(t){if(!this._evaluate){const i=ca.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,i){const c=t[0],h=ca.definitions[c];if(!h)return i.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,w=[];let T=null,A=-1;for(const[M,O]of g){if(Array.isArray(M)&&M.length!==t.length-1)continue;w.push(M),A++,T=new Vp(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const z=[];let U=!1;for(let V=1;V<t.length;V++){const H=t[V],re=Array.isArray(M)?M[V-1]:M.type,ne=T.parse(H,1+z.length,re);if(!ne){U=!0;break}z.push(ne)}if(!U)if(Array.isArray(M)&&M.length!==z.length)T.error(`Expected ${M.length} arguments, but found ${z.length} instead.`);else{for(let V=0;V<z.length;V++){const H=Array.isArray(M)?M[V]:M.type,re=z[V];T.concat(V+1).checkSubtype(H,re.type)}if(T.errors.length===0)return new ca(c,p,O,z,A)}}if(w.length===1)i.errors.push(...T.errors);else{const M=(w.length?w:g.map(([z])=>z)).map(va).join(" | "),O=[];for(let z=1;z<t.length;z++){const U=i.parse(t[z],1+O.length);if(!U)return null;O.push(po(U.type))}i.error(`Expected arguments of type ${M}, but found (${O.join(", ")}) instead.`)}return null}static register(t,i){ca.definitions=i;for(const c in i)t[c]=ca}}function va(a){return Array.isArray(a)?`(${a.map(po).join(", ")})`:`(${po(a.type)}...)`}class bh{constructor(t,i,c){this.type=Eu,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return i.error("Collator options argument must be an object.");const h=c["case-sensitive"]===void 0?i.parse(!1,1,Vn):i.parseObjectValue(c["case-sensitive"],1,"case-sensitive",Vn);if(!h)return null;const p=c["diacritic-sensitive"]===void 0?i.parse(!1,1,Vn):i.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",Vn);if(!p)return null;let g=null;return c.locale&&(g=i.parseObjectValue(c.locale,1,"locale",Qn),!g)?null:new bh(h,p,g)}evaluate(t){return new Rc(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function Ql(a,t,i=0,c=a.length-1,h=Gs){for(;c>i;){if(c-i>600){const T=c-i+1,A=t-i+1,M=Math.log(T),O=.5*Math.exp(2*M/3),z=.5*Math.sqrt(M*O*(T-O)/T)*(A-T/2<0?-1:1);Ql(a,t,Math.max(i,Math.floor(t-A*O/T+z)),Math.min(c,Math.floor(t+(T-A)*O/T+z)),h)}const p=a[t];let g=i,w=c;for(Lc(a,i,t),h(a[c],p)>0&&Lc(a,i,c);g<w;){for(Lc(a,g,w),g++,w--;h(a[g],p)<0;)g++;for(;h(a[w],p)>0;)w--}h(a[i],p)===0?Lc(a,i,w):(w++,Lc(a,w,c)),w<=t&&(i=w+1),t<=w&&(c=w-1)}}function Lc(a,t,i){const c=a[t];a[t]=a[i],a[i]=c}function Gs(a,t){return a<t?-1:a>t?1:0}function Lo(a){let t=0;for(let i,c,h=0,p=a.length,g=p-1;h<p;g=h++)i=a[h],c=a[g],t+=(c.x-i.x)*(i.y+c.y);return t}function vd(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function zc(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function Jg(a,t,i){const c=a[0]-t[0],h=a[1]-t[1],p=a[0]-i[0],g=a[1]-i[1];return c*g-p*h==0&&c*p<=0&&h*g<=0}function _l(a,t,i=!1){let c=!1;for(let w=0,T=t.length;w<T;w++){const A=t[w];for(let M=0,O=A.length,z=O-1;M<O;z=M++){const U=A[z],V=A[M];if(Jg(a,U,V))return i;(p=U)[1]>(h=a)[1]!=(g=V)[1]>h[1]&&h[0]<(g[0]-p[0])*(h[1]-p[1])/(g[1]-p[1])+p[0]&&(c=!c)}}var h,p,g;return c}function xd(a,t,i,c){const h=c[0]-i[0],p=c[1]-i[1],g=(a[0]-i[0])*p-h*(a[1]-i[1]),w=(t[0]-i[0])*p-h*(t[1]-i[1]);return g>0&&w<0||g<0&&w>0}function bs(a,t,i,c){return(h=[c[0]-i[0],c[1]-i[1]])[0]*(p=[t[0]-a[0],t[1]-a[1]])[1]-h[1]*p[0]!=0&&!(!xd(a,t,i,c)||!xd(i,c,a,t));var h,p}function Tf(a){const t=new Dt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Dt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const c of a[0])t.x>c.x&&(t.x=c.x),t.y>c.y&&(t.y=c.y),i.x<c.x&&(i.x=c.x),i.y<c.y&&(i.y=c.y);return{min:t,max:i}}const ec=8192;function Zm(a,t){const i=(180+a[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(i*h*ec),Math.round(c*h*ec)]}function Qg(a,t){for(let i=0;i<t.length;i++)if(_l(a,t[i]))return!0;return!1}function Xm(a,t,i){for(const c of i)for(let h=0,p=c.length,g=p-1;h<p;g=h++)if(bs(a,t,c[g],c[h]))return!0;return!1}function Ym(a,t){for(let i=0;i<a.length;++i)if(!_l(a[i],t))return!1;for(let i=0;i<a.length-1;++i)if(Xm(a[i],a[i+1],t))return!1;return!0}function e_(a,t){for(let i=0;i<t.length;i++)if(Ym(a,t[i]))return!0;return!1}function Ef(a,t,i){const c=[];for(let h=0;h<a.length;h++){const p=[];for(let g=0;g<a[h].length;g++){const w=Zm(a[h][g],i);vd(t,w),p.push(w)}c.push(p)}return c}function ws(a,t,i){const c=[];for(let h=0;h<a.length;h++){const p=Ef(a[h],t,i);c.push(p)}return c}function Ss(a,t,i,c){if(a[0]<i[0]||a[0]>i[2]){const h=.5*c;let p=a[0]-i[0]>h?-c:i[0]-a[0]>h?c:0;p===0&&(p=a[0]-i[2]>h?-c:i[2]-a[0]>h?c:0),a[0]+=p}vd(t,a)}function Rp(a,t,i,c){const h=Math.pow(2,c.z)*ec,p=[c.x*ec,c.y*ec],g=[];if(!a)return g;for(const w of a)for(const T of w){const A=[T.x+p[0],T.y+p[1]];Ss(A,t,i,h),g.push(A)}return g}function Lp(a,t,i,c){const h=Math.pow(2,c.z)*ec,p=[c.x*ec,c.y*ec],g=[];if(!a)return g;for(const T of a){const A=[];for(const M of T){const O=[M.x+p[0],M.y+p[1]];vd(t,O),A.push(O)}g.push(A)}if(t[2]-t[0]<=h/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of g)for(const A of T)Ss(A,t,i,h)}var w;return g}class yl{constructor(t,i){this.type=Vn,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(xh(t[1])){const c=t[1];if(c.type==="FeatureCollection")for(let h=0;h<c.features.length;++h){const p=c.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new yl(c,c.features[h].geometry)}else if(c.type==="Feature"){const h=c.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new yl(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new yl(c,c)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,c){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(c.type==="Polygon"){const w=Ef(c.coordinates,p,g),T=Rp(i.geometry(),h,p,g);if(!zc(h,p))return!1;for(const A of T)if(!_l(A,w))return!1}if(c.type==="MultiPolygon"){const w=ws(c.coordinates,p,g),T=Rp(i.geometry(),h,p,g);if(!zc(h,p))return!1;for(const A of T)if(!Qg(A,w))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,c){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(c.type==="Polygon"){const w=Ef(c.coordinates,p,g),T=Lp(i.geometry(),h,p,g);if(!zc(h,p))return!1;for(const A of T)if(!Ym(A,w))return!1}if(c.type==="MultiPolygon"){const w=ws(c.coordinates,p,g),T=Lp(i.geometry(),h,p,g);if(!zc(h,p))return!1;for(const A of T)if(!e_(A,w))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const wh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},bd=1/298.257223563,Ts=bd*(2-bd),Sh=Math.PI/180;class qs{static fromTile(t,i,c){const h=Math.PI*(1-2*(t+.5)/Math.pow(2,i)),p=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Sh;return new qs(p,c)}static get units(){return wh}constructor(t,i){if(t===void 0)throw new Error("No latitude given.");if(i&&!wh[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(wh).join(", ")}`);const c=6378.137*Sh*(i?wh[i]:1),h=Math.cos(t*Sh),p=1/(1-Ts*(1-h*h)),g=Math.sqrt(p);this.kx=c*g*h,this.ky=c*g*p*(1-Ts)}distance(t,i){const c=Oa(t[0]-i[0])*this.kx,h=(t[1]-i[1])*this.ky;return Math.sqrt(c*c+h*h)}bearing(t,i){const c=Oa(i[0]-t[0])*this.kx;return Math.atan2(c,(i[1]-t[1])*this.ky)/Sh}destination(t,i,c){const h=c*Sh;return this.offset(t,Math.sin(h)*i,Math.cos(h)*i)}offset(t,i,c){return[t[0]+i/this.kx,t[1]+c/this.ky]}lineDistance(t){let i=0;for(let c=0;c<t.length-1;c++)i+=this.distance(t[c],t[c+1]);return i}area(t){let i=0;for(let c=0;c<t.length;c++){const h=t[c];for(let p=0,g=h.length,w=g-1;p<g;w=p++)i+=Oa(h[p][0]-h[w][0])*(h[p][1]+h[w][1])*(c?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(t,i){let c=0;if(i<=0)return t[0];for(let h=0;h<t.length-1;h++){const p=t[h],g=t[h+1],w=this.distance(p,g);if(c+=w,c>i)return Fc(p,g,(i-(c-w))/w)}return t[t.length-1]}pointToSegmentDistance(t,i,c){let[h,p]=i,g=Oa(c[0]-h)*this.kx,w=(c[1]-p)*this.ky;if(g!==0||w!==0){const T=(Oa(t[0]-h)*this.kx*g+(t[1]-p)*this.ky*w)/(g*g+w*w);T>1?(h=c[0],p=c[1]):T>0&&(h+=g/this.kx*T,p+=w/this.ky*T)}return g=Oa(t[0]-h)*this.kx,w=(t[1]-p)*this.ky,Math.sqrt(g*g+w*w)}pointOnLine(t,i){let c=1/0,h=t[0][0],p=t[0][1],g=0,w=0;for(let T=0;T<t.length-1;T++){let A=t[T][0],M=t[T][1],O=Oa(t[T+1][0]-A)*this.kx,z=(t[T+1][1]-M)*this.ky,U=0;O===0&&z===0||(U=(Oa(i[0]-A)*this.kx*O+(i[1]-M)*this.ky*z)/(O*O+z*z),U>1?(A=t[T+1][0],M=t[T+1][1]):U>0&&(A+=O/this.kx*U,M+=z/this.ky*U)),O=Oa(i[0]-A)*this.kx,z=(i[1]-M)*this.ky;const V=O*O+z*z;V<c&&(c=V,h=A,p=M,g=T,w=U)}return{point:[h,p],index:g,t:Math.max(0,Math.min(1,w))}}lineSlice(t,i,c){let h=this.pointOnLine(c,t),p=this.pointOnLine(c,i);if(h.index>p.index||h.index===p.index&&h.t>p.t){const A=h;h=p,p=A}const g=[h.point],w=h.index+1,T=p.index;!wd(c[w],g[0])&&w<=T&&g.push(c[w]);for(let A=w+1;A<=T;A++)g.push(c[A]);return wd(c[T],p.point)||g.push(p.point),g}lineSliceAlong(t,i,c){let h=0;const p=[];for(let g=0;g<c.length-1;g++){const w=c[g],T=c[g+1],A=this.distance(w,T);if(h+=A,h>t&&p.length===0&&p.push(Fc(w,T,(t-(h-A))/A)),h>=i)return p.push(Fc(w,T,(i-(h-A))/A)),p;h>t&&p.push(T)}return p}bufferPoint(t,i){const c=i/this.ky,h=i/this.kx;return[t[0]-h,t[1]-c,t[0]+h,t[1]+c]}bufferBBox(t,i){const c=i/this.ky,h=i/this.kx;return[t[0]-h,t[1]-c,t[2]+h,t[3]+c]}insideBBox(t,i){return Oa(t[0]-i[0])>=0&&Oa(t[0]-i[2])<=0&&t[1]>=i[1]&&t[1]<=i[3]}}function wd(a,t){return a[0]===t[0]&&a[1]===t[1]}function Fc(a,t,i){const c=Oa(t[0]-a[0]);return[a[0]+c*i,a[1]+(t[1]-a[1])*i]}function Oa(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class Sd{constructor(t=[],i=(c,h)=>c<h?-1:c>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:c}=this,h=i[t];for(;t>0;){const p=t-1>>1,g=i[p];if(c(h,g)>=0)break;i[t]=g,t=p}i[t]=h}_down(t){const{data:i,compare:c}=this,h=this.length>>1,p=i[t];for(;t<h;){let g=1+(t<<1);const w=g+1;if(w<this.length&&c(i[w],i[g])<0&&(g=w),c(i[g],p)>=0)break;i[t]=i[g],t=g}i[t]=p}}var zt=8192;function Nc(a,t){return t.dist-a.dist}const Th=100,Td=50;function Eh(a){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==a.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==a[i])return!1;return!0}function Bc(a){return a[1]-a[0]+1}function rs(a,t){const i=a[1]>=a[0]&&a[1]<t;return i||console.warn("Distance Expression: Index is out of range"),i}function Cu(a,t){if(a[0]>a[1])return[null,null];const i=Bc(a);if(t){if(i===2)return[a,null];const c=Math.floor(i/2);return[[a[0],a[0]+c],[a[0]+c,a[1]]]}{if(i===1)return[a,null];const c=Math.floor(i/2)-1;return[[a[0],a[0]+c],[a[0]+c+1,a[1]]]}}function tc(a,t){const i=[1/0,1/0,-1/0,-1/0];if(!rs(t,a.length))return i;for(let c=t[0];c<=t[1];++c)vd(i,a[c]);return i}function Ah(a){const t=[1/0,1/0,-1/0,-1/0];for(let i=0;i<a.length;++i)for(let c=0;c<a[i].length;++c)vd(t,a[i][c]);return t}function jc(a,t,i){if(Eh(a)||Eh(t))return NaN;let c=0,h=0;return a[2]<t[0]&&(c=t[0]-a[2]),a[0]>t[2]&&(c=a[0]-t[2]),a[1]>t[3]&&(h=a[1]-t[3]),a[3]<t[1]&&(h=t[1]-a[3]),i.distance([0,0],[c,h])}function ns(a){return 360*a-180}function Sn(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Ed(a,t){const i=Math.pow(2,t.z),c=(a.y/zt+t.y)/i;return[ns((a.x/zt+t.x)/i),Sn(c)]}function t_(a,t){const i=[];for(let c=0;c<a.length;++c)i.push(Ed(a[c],t));return i}function Km(a,t,i){const c=i.pointOnLine(t,a).point;return i.distance(a,c)}function Mu(a,t,i,c,h){const p=i.slice(c[0],c[1]+1);let g=1/0;for(let w=t[0];w<=t[1];++w)if((g=Math.min(g,Km(a[w],p,h)))===0)return 0;return g}function zp(a,t,i,c,h){const p=Math.min(h.pointToSegmentDistance(a,i,c),h.pointToSegmentDistance(t,i,c)),g=Math.min(h.pointToSegmentDistance(i,a,t),h.pointToSegmentDistance(c,a,t));return Math.min(p,g)}function Mi(a,t,i,c,h){if(!rs(t,a.length)||!rs(c,i.length))return NaN;let p=1/0;for(let g=t[0];g<t[1];++g)for(let w=c[0];w<c[1];++w){if(bs(a[g],a[g+1],i[w],i[w+1]))return 0;p=Math.min(p,zp(a[g],a[g+1],i[w],i[w+1],h))}return p}function Jm(a,t,i,c,h){if(!rs(t,a.length)||!rs(c,i.length))return NaN;let p=1/0;for(let g=t[0];g<=t[1];++g)for(let w=c[0];w<=c[1];++w)if((p=Math.min(p,h.distance(a[g],i[w])))===0)return p;return p}function ao(a,t,i){if(_l(a,t,!0))return 0;let c=1/0;for(const h of t){const p=h.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[p-1]&&(c=Math.min(c,i.pointToSegmentDistance(a,h[p-1],h[0])))===0||(c=Math.min(c,Km(a,h,i)))===0)return c}return c}function Fp(a,t,i,c){if(!rs(t,a.length))return NaN;for(let p=t[0];p<=t[1];++p)if(_l(a[p],i,!0))return 0;let h=1/0;for(let p=t[0];p<t[1];++p)for(const g of i)for(let w=0,T=g.length,A=T-1;w<T;A=w++){if(bs(a[p],a[p+1],g[A],g[w]))return 0;h=Math.min(h,zp(a[p],a[p+1],g[A],g[w],c))}return h}function Ad(a,t){for(const i of a)for(let c=0;c<=i.length-1;++c)if(_l(i[c],t,!0))return!0;return!1}function Id(a,t,i,c=1/0){const h=Ah(a),p=Ah(t);if(c!==1/0&&jc(h,p,i)>=c)return c;if(zc(h,p)){if(Ad(a,t))return 0}else if(Ad(t,a))return 0;let g=c;for(const w of a)for(let T=0,A=w.length,M=A-1;T<A;M=T++)for(const O of t)for(let z=0,U=O.length,V=U-1;z<U;V=z++){if(bs(w[M],w[T],O[V],O[z]))return 0;g=Math.min(g,zp(w[M],w[T],O[V],O[z],i))}return g}function Pd(a,t,i,c,h,p,g){if(p===null||g===null)return;const w=jc(tc(c,p),tc(h,g),i);w<t&&a.push({dist:w,range1:p,range2:g})}function Np(a,t,i,c,h=1/0){let p=Math.min(c.distance(a[0],i[0][0]),h);if(p===0)return p;const g=new Sd([{dist:0,range1:[0,a.length-1],range2:[0,0]}],Nc),w=t?Td:Th,T=Ah(i);for(;g.length;){const A=g.pop();if(A.dist>=p)continue;const M=A.range1;if(Bc(M)<=w){if(!rs(M,a.length))return NaN;if(t){const O=Fp(a,M,i,c);if((p=Math.min(p,O))===0)return p}else for(let O=M[0];O<=M[1];++O){const z=ao(a[O],i,c);if((p=Math.min(p,z))===0)return p}}else{const O=Cu(M,t);if(O[0]!==null){const z=jc(tc(a,O[0]),T,c);z<p&&g.push({dist:z,range1:O[0],range2:[0,0]})}if(O[1]!==null){const z=jc(tc(a,O[1]),T,c);z<p&&g.push({dist:z,range1:O[1],range2:[0,0]})}}}return p}function Ih(a,t,i,c,h,p=1/0){let g=Math.min(p,h.distance(a[0],i[0]));if(g===0)return g;const w=new Sd([{dist:0,range1:[0,a.length-1],range2:[0,i.length-1]}],Nc),T=t?Td:Th,A=c?Td:Th;for(;w.length;){const M=w.pop();if(M.dist>=g)continue;const O=M.range1,z=M.range2;if(Bc(O)<=T&&Bc(z)<=A){if(!rs(O,a.length)||!rs(z,i.length))return NaN;if(t&&c?g=Math.min(g,Mi(a,O,i,z,h)):t||c?t&&!c?g=Math.min(g,Mu(i,z,a,O,h)):!t&&c&&(g=Math.min(g,Mu(a,O,i,z,h))):g=Math.min(g,Jm(a,O,i,z,h)),g===0)return g}else{const U=Cu(O,t),V=Cu(z,c);Pd(w,g,h,a,i,U[0],V[0]),Pd(w,g,h,a,i,U[0],V[1]),Pd(w,g,h,a,i,U[1],V[0]),Pd(w,g,h,a,i,U[1],V[1])}}return g}function Ph(a,t,i,c,h=1/0){let p=h;const g=tc(a,[0,a.length-1]);for(const w of i)if(!(p!==1/0&&jc(g,tc(w,[0,w.length-1]),c)>=p)&&(p=Math.min(p,Ih(a,t,w,!0,c,p)),p===0))return p;return p}function rc(a,t,i,c,h=1/0){let p=h;const g=tc(a,[0,a.length-1]);for(const w of i){if(p!==1/0&&jc(g,Ah(w),c)>=p)continue;const T=Np(a,t,w,c,p);if(isNaN(T))return T;if((p=Math.min(p,T))===0)return p}return p}function Af(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class Ou{constructor(t,i){this.type=ur,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(xh(t[1])){const c=t[1];if(c.type==="FeatureCollection"){for(let h=0;h<c.features.length;++h)if(Af(c.features[h].geometry.type))return new Ou(c,c.features[h].geometry)}else if(c.type==="Feature"){if(Af(c.geometry.type))return new Ou(c,c.geometry)}else if(Af(c.type))return new Ou(c,c)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const i=t.geometry(),c=t.canonicalID();if(i!=null&&c!=null){if(t.geometryType()==="Point")return function(h,p,g){const w=[];for(const A of h)for(const M of A)w.push(Ed(M,p));const T=new qs(w[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?Ih(w,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",T):g.type==="MultiLineString"?Ph(w,!1,g.coordinates,T):g.type==="Polygon"||g.type==="MultiPolygon"?rc(w,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,T):null}(i,c,this.geometries);if(t.geometryType()==="LineString")return function(h,p,g){const w=[];for(const A of h){const M=[];for(const O of A)M.push(Ed(O,p));w.push(M)}const T=new qs(w[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Ph(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",w,T);if(g.type==="MultiLineString"){let A=1/0;for(let M=0;M<g.coordinates.length;M++){const O=Ph(g.coordinates[M],!0,w,T,A);if(isNaN(O))return O;if((A=Math.min(A,O))===0)return A}return A}if(g.type==="Polygon"||g.type==="MultiPolygon"){let A=1/0;for(let M=0;M<w.length;M++){const O=rc(w[M],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,T,A);if(isNaN(O))return O;if((A=Math.min(A,O))===0)return A}return A}return null}(i,c,this.geometries);if(t.geometryType()==="Polygon")return function(h,p,g){const w=[];for(const A of function(M,O){const z=M.length;if(z<=1)return[M];const U=[];let V,H;for(let re=0;re<z;re++){const ne=Lo(M[re]);ne!==0&&(M[re].area=Math.abs(ne),H===void 0&&(H=ne<0),H===ne<0?(V&&U.push(V),V=[M[re]]):V.push(M[re]))}return V&&U.push(V),U}(h)){const M=[];for(let O=0;O<A.length;++O)M.push(t_(A[O],p));w.push(M)}const T=new qs(w[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return rc(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",w,T);if(g.type==="MultiLineString"){let A=1/0;for(let M=0;M<g.coordinates.length;M++){const O=rc(g.coordinates[M],!0,w,T,A);if(isNaN(O))return O;if((A=Math.min(A,O))===0)return A}return A}return g.type==="Polygon"||g.type==="MultiPolygon"?function(A,M,O){let z=1/0;for(const U of A)for(const V of M){const H=Id(U,V,O,z);if(isNaN(H))return H;if((z=Math.min(z,H))===0)return z}return z}(g.type==="Polygon"?[g.coordinates]:g.coordinates,w,T):null}(i,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Bp(a,t){switch(a){case"string":return ya(t);case"number":return+t;case"boolean":return!!t;case"color":return dn.parse(t);case"formatted":return _a.fromString(ya(t));case"resolvedImage":return Ma.build(ya(t))}return t}function jp(a,t,i,c){return c!==void 0&&(a=c*Math.round(a/c)),t!==void 0&&a<t&&(a=t),i!==void 0&&a>i&&(a=i),a}class nc{constructor(t,i,c){this.type=t,this.key=i,this.scope=c}static parse(t,i){let c=i.expectedType;if(c==null&&(c=jn),t.length<2||t.length>3)return i.error("Invalid number of arguments for 'config' expression.");const h=i.parse(t[1],1);if(!(h instanceof Yr))return i.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const p=i.parse(t[2],2);return p instanceof Yr?new nc(c,ya(h.value),ya(p.value)):i.error("Scope of 'config' expression must be a string literal.")}return new nc(c,ya(h.value))}evaluate(t){const i=[this.key,this.scope,t.scope].filter(Boolean).join(""),c=t.getConfig(i);if(!c)return null;const{type:h,value:p,values:g,minValue:w,maxValue:T,stepValue:A}=c,M=c.default.evaluate(t);let O=M;if(p){const z=t.scope;t.scope=(z||"").split("").slice(1).join(""),O=p.evaluate(t),t.scope=z}return h&&(O=Bp(h,O)),O===void 0||w===void 0&&T===void 0&&A===void 0||(typeof O=="number"?O=jp(O,w,T,A):Array.isArray(O)&&(O=O.map(z=>typeof z=="number"?jp(z,w,T,A):z))),p!==void 0&&O!==void 0&&g&&!g.includes(O)&&(O=M,h&&(O=Bp(h,O))),(h&&h!==this.type||O!==void 0&&bo(O)!==this.type)&&(O=Bp(this.type.kind,O)),O}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}function Uc(a){if(a instanceof ca&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof yl||a instanceof Ou)return!1;let t=!0;return a.eachChild(i=>{t&&!Uc(i)&&(t=!1)}),t}function Ch(a){if(a instanceof ca&&a.name==="feature-state")return!1;let t=!0;return a.eachChild(i=>{t&&!Ch(i)&&(t=!1)}),t}function Mh(a){if(a instanceof nc)return new Set([a.key]);let t=new Set;return a.eachChild(i=>{t=new Set([...t,...Mh(i)])}),t}function Vc(a,t){if(a instanceof ca&&t.indexOf(a.name)>=0)return!1;let i=!0;return a.eachChild(c=>{i&&!Vc(c,t)&&(i=!1)}),i}class Oh{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const c=t[1];return i.scope.has(c)?new Oh(c,i.scope.get(c)):i.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Up{constructor(t,i=[],c,h=new gl,p=[],g,w){this.registry=t,this.path=i,this.key=i.map(T=>typeof T=="string"?`['${T}']`:`[${T}]`).join(""),this.scope=h,this.errors=p,this.expectedType=c,this._scope=g,this.options=w}parse(t,i,c,h,p={}){return i||c?this.concat(i,null,c,h)._parse(t,p):this._parse(t,p)}parseObjectValue(t,i,c,h,p,g={}){return this.concat(i,c,h,p)._parse(t,g)}_parse(t,i){function c(h,p,g){return g==="assert"?new Tr(p,[h]):g==="coerce"?new xs(p,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(h){let p=h.parse(t,this);if(!p)return null;if(this.expectedType){const g=this.expectedType,w=p.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||w.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(g,w))return null}else p=c(p,g,i.typeAnnotation||"coerce");else p=c(p,g,i.typeAnnotation||"assert")}if(!(p instanceof Yr)&&p.type.kind!=="resolvedImage"&&$p(p)){const g=new Jl(this._scope,this.options);try{p=new Yr(p.type,p.evaluate(g))}catch(w){return this.error(w.message),null}}return p}return xs.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,c,h){let p=typeof t=="number"?this.path.concat(t):this.path;p=typeof i=="string"?p.concat(i):p;const g=h?this.scope.concat(h):this.scope;return new Up(this.registry,p,c||null,g,this.errors,this._scope,this.options)}error(t,...i){const c=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new ga(c,t))}checkSubtype(t,i){const c=yd(t,i);return c&&this.error(c),c}}var Vp=Up;function $p(a){if(a instanceof Oh)return $p(a.boundExpression);if(a instanceof ca&&a.name==="error"||a instanceof bh||a instanceof yl||a instanceof Ou||a instanceof nc)return!1;const t=a instanceof xs||a instanceof Tr;let i=!0;return a.eachChild(c=>{i=t?i&&$p(c):i&&c instanceof Yr}),!!i&&Uc(a)&&Vc(a,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function If(a,t){const i=a.length-1;let c,h,p=0,g=i,w=0;for(;p<=g;)if(w=Math.floor((p+g)/2),c=a[w],h=a[w+1],c<=t){if(w===i||t<h)return w;p=w+1}else{if(!(c>t))throw new Jt("Input is not a number.");g=w-1}return 0}class Du{constructor(t,i,c){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[h,p]of c)this.labels.push(h),this.outputs.push(p)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const c=i.parse(t[1],1,ur);if(!c)return null;const h=[];let p=null;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let g=1;g<t.length;g+=2){const w=g===1?-1/0:t[g],T=t[g+1],A=g,M=g+1;if(typeof w!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(h.length&&h[h.length-1][0]>=w)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const O=i.parse(T,M,p);if(!O)return null;p=p||O.type,h.push([w,O])}return new Du(p,c,h)}evaluate(t){const i=this.labels,c=this.outputs;if(i.length===1)return c[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return c[0].evaluate(t);const p=i.length;return h>=i[p-1]?c[p-1].evaluate(t):c[If(i,h)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&t.push(this.labels[i]),t.push(this.outputs[i].serialize());return t}}const ic=.95047,Gp=1.08883,ku=4/29,Da=6/29,Dh=3*Da*Da,oc=Da*Da*Da,Cd=Math.PI/180,r_=180/Math.PI;function Pf(a){return a>oc?Math.pow(a,1/3):a/Dh+ku}function ac(a){return a>Da?a*a*a:Dh*(a-ku)}function Ru(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function $c(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function kh(a){const t=$c(a.r),i=$c(a.g),c=$c(a.b),h=Pf((.4124564*t+.3575761*i+.1804375*c)/ic),p=Pf((.2126729*t+.7151522*i+.072175*c)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-Pf((.0193339*t+.119192*i+.9503041*c)/Gp)),alpha:a.a}}function Md(a){let t=(a.l+16)/116,i=isNaN(a.a)?t:t+a.a/500,c=isNaN(a.b)?t:t-a.b/200;return t=1*ac(t),i=ic*ac(i),c=Gp*ac(c),new dn(Ru(3.2404542*i-1.5371385*t-.4985314*c),Ru(-.969266*i+1.8760108*t+.041556*c),Ru(.0556434*i-.2040259*t+1.0572252*c),a.alpha)}function Ws(a,t,i){const c=t-a;return a+i*(c>180||c<-180?c-360*Math.round(c/360):c)}const is={forward:kh,reverse:Md,interpolate:function(a,t,i){return{l:xr(a.l,t.l,i),a:xr(a.a,t.a,i),b:xr(a.b,t.b,i),alpha:xr(a.alpha,t.alpha,i)}}},Ui={forward:function(a){const{l:t,a:i,b:c}=kh(a),h=Math.atan2(c,i)*r_;return{h:h<0?h+360:h,c:Math.sqrt(i*i+c*c),l:t,alpha:a.a}},reverse:function(a){const t=a.h*Cd,i=a.c;return Md({l:a.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:a.alpha})},interpolate:function(a,t,i){return{h:Ws(a.h,t.h,i),c:xr(a.c,t.c,i),l:xr(a.l,t.l,i),alpha:xr(a.alpha,t.alpha,i)}}};var Ji=Object.freeze({__proto__:null,hcl:Ui,lab:is});class wo{constructor(t,i,c,h,p){this.type=t,this.operator=i,this.interpolation=c,this.input=h,this.labels=[],this.outputs=[];for(const[g,w]of p)this.labels.push(g),this.outputs.push(w)}static interpolationFactor(t,i,c,h){let p=0;if(t.name==="exponential")p=zo(i,t.base,c,h);else if(t.name==="linear")p=zo(i,1,c,h);else if(t.name==="cubic-bezier"){const g=t.controlPoints;p=new Xn(g[0],g[1],g[2],g[3]).solve(zo(i,1,c,h))}return p}static parse(t,i){let[c,h,p,...g]=t;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const A=h[1];if(typeof A!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:A}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const A=h.slice(1);if(A.length!==4||A.some(M=>typeof M!="number"||M<0||M>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:A}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length-1>3&&(t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,ur),!p)return null;const w=[];let T=null;c==="interpolate-hcl"||c==="interpolate-lab"?T=sa:i.expectedType&&i.expectedType.kind!=="value"&&(T=i.expectedType);for(let A=0;A<g.length;A+=2){const M=g[A],O=g[A+1],z=A+3,U=A+4;if(typeof M!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(w.length&&w[w.length-1][0]>=M)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const V=i.parse(O,U,T);if(!V)return null;T=T||V.type,w.push([M,V])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new wo(T,c,h,p,w):i.error(`Type ${po(T)} is not interpolatable.`)}evaluate(t){const i=this.labels,c=this.outputs;if(i.length===1)return c[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return c[0].evaluate(t);const p=i.length;if(h>=i[p-1])return c[p-1].evaluate(t);const g=If(i,h),w=wo.interpolationFactor(this.interpolation,h,i[g],i[g+1]),T=c[g].evaluate(t),A=c[g+1].evaluate(t);return this.operator==="interpolate"?vh[this.type.kind.toLowerCase()](T,A,w):this.operator==="interpolate-hcl"?Ui.reverse(Ui.interpolate(Ui.forward(T),Ui.forward(A),w)):is.reverse(is.interpolate(is.forward(T),is.forward(A),w))}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,t,this.input.serialize()];for(let c=0;c<this.labels.length;c++)i.push(this.labels[c],this.outputs[c].serialize());return i}}function zo(a,t,i,c){const h=c-i,p=a-i;return h===0?0:t===1?p/h:(Math.pow(t,p)-1)/(Math.pow(t,h)-1)}class ua{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let c=null;const h=i.expectedType;h&&h.kind!=="value"&&(c=h);const p=[];for(const w of t.slice(1)){const T=i.parse(w,1+p.length,c,void 0,{typeAnnotation:"omit"});if(!T)return null;c=c||T.type,p.push(T)}const g=h&&p.some(w=>yd(h,w.type));return new ua(g?jn:c,p)}evaluate(t){let i,c=null,h=0;for(const p of this.args){if(h++,c=p.evaluate(t),c&&c instanceof Ma&&!c.available&&(i||(i=c),c=null,h===this.args.length))return i;if(c!==null)break}return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(i=>{t.push(i.serialize())}),t}}class vl{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let p=1;p<t.length-1;p+=2){const g=t[p];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const w=i.parse(t[p+1],p+1);if(!w)return null;c.push([g,w])}const h=i.parse(t[t.length-1],t.length-1,i.expectedType,c);return h?new vl(c,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[i,c]of this.bindings)t.push(i,c.serialize());return t.push(this.result.serialize()),t}}class sc{constructor(t,i,c){this.type=t,this.index=i,this.input=c}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=i.parse(t[1],1,ur),h=i.parse(t[2],2,la(i.expectedType||jn));return c&&h?new sc(h.type.itemType,c,h):null}evaluate(t){const i=this.index.evaluate(t),c=this.input.evaluate(t);if(i<0)throw new Jt(`Array index out of bounds: ${i} < 0.`);if(i>=c.length)throw new Jt(`Array index out of bounds: ${i} > ${c.length-1}.`);if(i!==Math.floor(i))throw new Jt(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return c[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ha{constructor(t,i,c){this.type=t,this.index=i,this.input=c}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=i.parse(t[1],1,ur),h=i.parse(t[2],2,la(i.expectedType||jn));return c&&h?new ha(h.type.itemType,c,h):null}evaluate(t){const i=this.index.evaluate(t),c=this.input.evaluate(t);if(i<0)throw new Jt(`Array index out of bounds: ${i} < 0.`);if(i>c.length-1)throw new Jt(`Array index out of bounds: ${i} > ${c.length-1}.`);if(i===Math.floor(i))return c[i];const h=Math.floor(i),p=Math.ceil(i),g=c[h],w=c[p];if(typeof g!="number"||typeof w!="number")throw new Jt(`Cannot interpolate between non-number values at index ${i}.`);const T=i-h;return g*(1-T)+w*T}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Rh{constructor(t,i){this.type=Vn,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=i.parse(t[1],1,jn),h=i.parse(t[2],2,jn);return c&&h?Op(c.type,[Vn,Qn,ur,Kl,jn])?new Rh(c,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${po(c.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(c==null)return!1;if(!kc(i,["boolean","string","number","null"]))throw new Jt(`Expected first argument to be of type boolean, string, number or null, but found ${po(bo(i))} instead.`);if(!kc(c,["string","array"]))throw new Jt(`Expected second argument to be of type array or string, but found ${po(bo(c))} instead.`);return c.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Od{constructor(t,i,c){this.type=ur,this.needle=t,this.haystack=i,this.fromIndex=c}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=i.parse(t[1],1,jn),h=i.parse(t[2],2,jn);if(!c||!h)return null;if(!Op(c.type,[Vn,Qn,ur,Kl,jn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${po(c.type)} instead`);if(t.length===4){const p=i.parse(t[3],3,ur);return p?new Od(c,h,p):null}return new Od(c,h)}evaluate(t){const i=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!kc(i,["boolean","string","number","null"]))throw new Jt(`Expected first argument to be of type boolean, string, number or null, but found ${po(bo(i))} instead.`);if(!kc(c,["string","array"]))throw new Jt(`Expected second argument to be of type array or string, but found ${po(bo(c))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(t);return c.indexOf(i,h)}return c.indexOf(i)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Cf{constructor(t,i,c,h,p,g){this.inputType=t,this.type=i,this.input=c,this.cases=h,this.outputs=p,this.otherwise=g}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let c,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const p={},g=[];for(let A=2;A<t.length-1;A+=2){let M=t[A];const O=t[A+1];Array.isArray(M)||(M=[M]);const z=i.concat(A);if(M.length===0)return z.error("Expected at least one branch label.");for(const V of M){if(typeof V!="number"&&typeof V!="string")return z.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return z.error("Numeric branch labels must be integer values.");if(c){if(z.checkSubtype(c,bo(V)))return null}else c=bo(V);if(p[String(V)]!==void 0)return z.error("Branch labels must be unique.");p[String(V)]=g.length}const U=i.parse(O,A,h);if(!U)return null;h=h||U.type,g.push(U)}const w=i.parse(t[1],1,jn);if(!w)return null;const T=i.parse(t[t.length-1],t.length-1,h);return T?w.type.kind!=="value"&&i.concat(1).checkSubtype(c,w.type)?null:new Cf(c,h,w,p,g,T):null}evaluate(t){const i=this.input.evaluate(t);return(bo(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),c=[],h={};for(const g of i){const w=h[this.cases[g]];w===void 0?(h[this.cases[g]]=c.length,c.push([this.cases[g],[g]])):c[w][1].push(g)}const p=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,w]of c)t.push(w.length===1?p(w[0]):w.map(p)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}class Lu{constructor(t,i,c){this.type=t,this.branches=i,this.otherwise=c}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const h=[];for(let g=1;g<t.length-1;g+=2){const w=i.parse(t[g],g,Vn);if(!w)return null;const T=i.parse(t[g+1],g+1,c);if(!T)return null;h.push([w,T]),c=c||T.type}const p=i.parse(t[t.length-1],t.length-1,c);return p?new Lu(c,h,p):null}evaluate(t){for(const[i,c]of this.branches)if(i.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,c]of this.branches)t(i),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(i=>{t.push(i.serialize())}),t}}class Lh{constructor(t,i,c,h){this.type=t,this.input=i,this.beginIndex=c,this.endIndex=h}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=i.parse(t[1],1,jn),h=i.parse(t[2],2,ur);if(!c||!h)return null;if(!Op(c.type,[la(jn),Qn,jn]))return i.error(`Expected first argument to be of type array or string, but found ${po(c.type)} instead`);if(t.length===4){const p=i.parse(t[3],3,ur);return p?new Lh(c.type,c,h,p):null}return new Lh(c.type,c,h)}evaluate(t){const i=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!kc(i,["string","array"]))throw new Jt(`Expected first argument to be of type array or string, but found ${po(bo(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(t);return i.slice(c,h)}return i.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function os(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Dd(a,t,i,c){return c.compare(t,i)===0}function lc(a,t,i){const c=a!=="=="&&a!=="!=";return class Ik{constructor(p,g,w){this.type=Vn,this.lhs=p,this.rhs=g,this.collator=w,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const w=p[0];let T=g.parse(p[1],1,jn);if(!T)return null;if(!os(w,T.type))return g.concat(1).error(`"${w}" comparisons are not supported for type '${po(T.type)}'.`);let A=g.parse(p[2],2,jn);if(!A)return null;if(!os(w,A.type))return g.concat(2).error(`"${w}" comparisons are not supported for type '${po(A.type)}'.`);if(T.type.kind!==A.type.kind&&T.type.kind!=="value"&&A.type.kind!=="value")return g.error(`Cannot compare types '${po(T.type)}' and '${po(A.type)}'.`);c&&(T.type.kind==="value"&&A.type.kind!=="value"?T=new Tr(A.type,[T]):T.type.kind!=="value"&&A.type.kind==="value"&&(A=new Tr(T.type,[A])));let M=null;if(p.length===4){if(T.type.kind!=="string"&&A.type.kind!=="string"&&T.type.kind!=="value"&&A.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(M=g.parse(p[3],3,Eu),!M)return null}return new Ik(T,A,M)}evaluate(p){const g=this.lhs.evaluate(p),w=this.rhs.evaluate(p);if(c&&this.hasUntypedArgument){const T=bo(g),A=bo(w);if(T.kind!==A.kind||T.kind!=="string"&&T.kind!=="number")throw new Jt(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${T.kind}, ${A.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const T=bo(g),A=bo(w);if(T.kind!=="string"||A.kind!=="string")return t(p,g,w)}return this.collator?i(p,g,w,this.collator.evaluate(p)):t(p,g,w)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[a];return this.eachChild(g=>{p.push(g.serialize())}),p}}}const Qm=lc("==",function(a,t,i){return t===i},Dd),n_=lc("!=",function(a,t,i){return t!==i},function(a,t,i,c){return!Dd(0,t,i,c)}),cc=lc("<",function(a,t,i){return t<i},function(a,t,i,c){return c.compare(t,i)<0}),zu=lc(">",function(a,t,i){return t>i},function(a,t,i,c){return c.compare(t,i)>0}),zh=lc("<=",function(a,t,i){return t<=i},function(a,t,i,c){return c.compare(t,i)<=0}),Mf=lc(">=",function(a,t,i){return t>=i},function(a,t,i,c){return c.compare(t,i)>=0});class Fh{constructor(t,i,c,h,p,g){this.type=Qn,this.number=t,this.locale=i,this.currency=c,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const c=i.parse(t[1],1,ur);if(!c)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=i.parseObjectValue(h.locale,2,"locale",Qn),!p))return null;let g=null;if(h.currency&&(g=i.parseObjectValue(h.currency,2,"currency",Qn),!g))return null;let w=null;if(h.unit&&(w=i.parseObjectValue(h.unit,2,"unit",Qn),!w))return null;let T=null;if(h["min-fraction-digits"]&&(T=i.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",ur),!T))return null;let A=null;return h["max-fraction-digits"]&&(A=i.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",ur),!A)?null:new Fh(c,p,g,w,T,A)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class xa{constructor(t){this.type=ur,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=i.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${po(c.type)} instead.`):new xa(c):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Jt(`Expected value to be of type string or array, but found ${po(bo(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(i=>{t.push(i.serialize())}),t}}function as(a){return function(){a=1831565813+(a|=0)|0;let t=Math.imul(a^a>>>15,1|a);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const ss={"==":Qm,"!=":n_,">":zu,"<":cc,">=":Mf,"<=":zh,array:Tr,at:sc,"at-interpolated":ha,boolean:Tr,case:Lu,coalesce:ua,collator:bh,format:Iu,image:Pu,in:Rh,"index-of":Od,interpolate:wo,"interpolate-hcl":wo,"interpolate-lab":wo,length:xa,let:vl,literal:Yr,match:Cf,number:Tr,"number-format":Fh,object:Tr,slice:Lh,step:Du,string:Tr,"to-boolean":xs,"to-color":xs,"to-number":xs,"to-string":xs,var:Oh,within:yl,distance:Ou,config:nc};function xl(a,[t,i,c,h]){t=t.evaluate(a),i=i.evaluate(a),c=c.evaluate(a);const p=h?h.evaluate(a):1,g=Hm(t,i,c,p);if(g)throw new Jt(g);return new dn(t/255*p,i/255*p,c/255*p,p)}function bl(a,[t,i,c,h]){t=t.evaluate(a),i=i.evaluate(a),c=c.evaluate(a);const p=h?h.evaluate(a):1,g=function(A,M,O,z){return typeof A=="number"&&A>=0&&A<=360?typeof M=="number"&&M>=0&&M<=100&&typeof O=="number"&&O>=0&&O<=100?z===void 0||typeof z=="number"&&z>=0&&z<=1?null:`Invalid hsla value [${[A,M,O,z].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof z=="number"?[A,M,O,z]:[A,M,O]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof z=="number"?[A,M,O,z]:[A,M,O]).join(", ")}]: 'h' must be between 0 and 360.`}(t,i,c,p);if(g)throw new Jt(g);const w=`hsla(${t}, ${i}%, ${c}%, ${p})`,T=dn.parse(w);if(!T)throw new Jt(`Failed to parse HSLA color: ${w}`);return T}function uc(a,t){return a in t}function kd(a,t){const i=t[a];return i===void 0?null:i}function wl(a){return{type:a}}function Of(a){return{result:"success",value:a}}function so(a){return{result:"error",value:a}}function ka(a,t){return!!a&&!!a.parameters&&a.parameters.indexOf(t)>-1}function Qi(a){return a["property-type"]==="data-driven"}function Es(a){return ka(a.expression,"measure-light")}function Df(a){return ka(a.expression,"zoom")}function Rd(a){return!!a.expression&&a.expression.interpolated}function Nh(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function kf(a){return a}function Ld(a,t){const i=t.type==="color",c=a.stops&&typeof a.stops[0][0]=="object",h=c||!(c||a.property!==void 0),p=a.type||(Rd(t)?"exponential":"interval");if(i&&((a=Tu({},a)).stops&&(a.stops=a.stops.map(A=>[A[0],dn.parse(A[1])])),a.default=dn.parse(a.default?a.default:t.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!Ji[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let g,w,T;if(p==="exponential")g=Hs;else if(p==="interval")g=Bh;else if(p==="categorical"){g=qp,w=Object.create(null);for(const A of a.stops)w[A[0]]=A[1];T=typeof a.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);g=i_}if(c){const A={},M=[];for(let U=0;U<a.stops.length;U++){const V=a.stops[U],H=V[0].zoom;A[H]===void 0&&(A[H]={zoom:H,type:a.type,property:a.property,default:a.default,stops:[]},M.push(H)),A[H].stops.push([V[0].value,V[1]])}const O=[];for(const U of M)O.push([A[U].zoom,Ld(A[U],t)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:wo.interpolationFactor.bind(void 0,z),zoomStops:O.map(U=>U[0]),evaluate:({zoom:U},V)=>Hs({stops:O,base:a.base},t,U).evaluate(U,V)}}if(h){const A=p==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:wo.interpolationFactor.bind(void 0,A),zoomStops:a.stops.map(M=>M[0]),evaluate:({zoom:M})=>g(a,t,M,w,T)}}return{kind:"source",evaluate(A,M){const O=M&&M.properties?M.properties[a.property]:void 0;return O===void 0?Sl(a.default,t.default):g(a,t,O,w,T)}}}function Sl(a,t,i){return a!==void 0?a:t!==void 0?t:i!==void 0?i:void 0}function qp(a,t,i,c,h){return Sl(typeof i===h?c[i]:void 0,a.default,t.default)}function Bh(a,t,i){if(Pr(i)!=="number")return Sl(a.default,t.default);const c=a.stops.length;if(c===1||i<=a.stops[0][0])return a.stops[0][1];if(i>=a.stops[c-1][0])return a.stops[c-1][1];const h=If(a.stops.map(p=>p[0]),i);return a.stops[h][1]}function Hs(a,t,i){const c=a.base!==void 0?a.base:1;if(Pr(i)!=="number")return Sl(a.default,t.default);const h=a.stops.length;if(h===1||i<=a.stops[0][0])return a.stops[0][1];if(i>=a.stops[h-1][0])return a.stops[h-1][1];const p=If(a.stops.map(M=>M[0]),i),g=function(M,O,z,U){const V=U-z,H=M-z;return V===0?0:O===1?H/V:(Math.pow(O,H)-1)/(Math.pow(O,V)-1)}(i,c,a.stops[p][0],a.stops[p+1][0]),w=a.stops[p][1],T=a.stops[p+1][1];let A=vh[t.type]||kf;if(a.colorSpace&&a.colorSpace!=="rgb"){const M=Ji[a.colorSpace];A=(O,z)=>M.reverse(M.interpolate(M.forward(O),M.forward(z),g))}return typeof w.evaluate=="function"?{evaluate(...M){const O=w.evaluate.apply(void 0,M),z=T.evaluate.apply(void 0,M);if(O!==void 0&&z!==void 0)return A(O,z,g)}}:A(w,T,g)}function i_(a,t,i){return t.type==="color"?i=dn.parse(i):t.type==="formatted"?i=_a.fromString(i.toString()):t.type==="resolvedImage"?i=Ma.build(i.toString()):Pr(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0),Sl(i,a.default,t.default)}ca.register(ss,{error:[{kind:"error"},[Qn],(a,[t])=>{throw new Jt(t.evaluate(a))}],typeof:[Qn,[jn],(a,[t])=>po(bo(t.evaluate(a)))],"to-rgba":[la(ur,4),[sa],(a,[t])=>t.evaluate(a).toRenderColor(null).toArray()],"to-hsla":[la(ur,4),[sa],(a,[t])=>t.evaluate(a).toRenderColor(null).toHslaArray()],rgb:[sa,[ur,ur,ur],xl],rgba:[sa,[ur,ur,ur,ur],xl],hsl:[sa,[ur,ur,ur],bl],hsla:[sa,[ur,ur,ur,ur],bl],has:{type:Vn,overloads:[[[Qn],(a,[t])=>uc(t.evaluate(a),a.properties())],[[Qn,Dc],(a,[t,i])=>uc(t.evaluate(a),i.evaluate(a))]]},get:{type:jn,overloads:[[[Qn],(a,[t])=>kd(t.evaluate(a),a.properties())],[[Qn,Dc],(a,[t,i])=>kd(t.evaluate(a),i.evaluate(a))]]},"feature-state":[jn,[Qn],(a,[t])=>kd(t.evaluate(a),a.featureState||{})],properties:[Dc,[],a=>a.properties()],"geometry-type":[Qn,[],a=>a.geometryType()],id:[jn,[],a=>a.id()],zoom:[ur,[],a=>a.globals.zoom],pitch:[ur,[],a=>a.globals.pitch||0],"distance-from-center":[ur,[],a=>a.distanceFromCenter()],"measure-light":[ur,[Qn],(a,[t])=>a.measureLight(t.evaluate(a))],"heatmap-density":[ur,[],a=>a.globals.heatmapDensity||0],"line-progress":[ur,[],a=>a.globals.lineProgress||0],"raster-value":[ur,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[ur,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[ur,[],a=>a.globals.skyRadialProgress||0],accumulated:[jn,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[ur,wl(ur),(a,t)=>{let i=0;for(const c of t)i+=c.evaluate(a);return i}],"*":[ur,wl(ur),(a,t)=>{let i=1;for(const c of t)i*=c.evaluate(a);return i}],"-":{type:ur,overloads:[[[ur,ur],(a,[t,i])=>t.evaluate(a)-i.evaluate(a)],[[ur],(a,[t])=>-t.evaluate(a)]]},"/":[ur,[ur,ur],(a,[t,i])=>t.evaluate(a)/i.evaluate(a)],"%":[ur,[ur,ur],(a,[t,i])=>t.evaluate(a)%i.evaluate(a)],ln2:[ur,[],()=>Math.LN2],pi:[ur,[],()=>Math.PI],e:[ur,[],()=>Math.E],"^":[ur,[ur,ur],(a,[t,i])=>Math.pow(t.evaluate(a),i.evaluate(a))],sqrt:[ur,[ur],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[ur,[ur],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[ur,[ur],(a,[t])=>Math.log(t.evaluate(a))],log2:[ur,[ur],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[ur,[ur],(a,[t])=>Math.sin(t.evaluate(a))],cos:[ur,[ur],(a,[t])=>Math.cos(t.evaluate(a))],tan:[ur,[ur],(a,[t])=>Math.tan(t.evaluate(a))],asin:[ur,[ur],(a,[t])=>Math.asin(t.evaluate(a))],acos:[ur,[ur],(a,[t])=>Math.acos(t.evaluate(a))],atan:[ur,[ur],(a,[t])=>Math.atan(t.evaluate(a))],min:[ur,wl(ur),(a,t)=>Math.min(...t.map(i=>i.evaluate(a)))],max:[ur,wl(ur),(a,t)=>Math.max(...t.map(i=>i.evaluate(a)))],abs:[ur,[ur],(a,[t])=>Math.abs(t.evaluate(a))],round:[ur,[ur],(a,[t])=>{const i=t.evaluate(a);return i<0?-Math.round(-i):Math.round(i)}],floor:[ur,[ur],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[ur,[ur],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[Vn,[Qn,jn],(a,[t,i])=>a.properties()[t.value]===i.value],"filter-id-==":[Vn,[jn],(a,[t])=>a.id()===t.value],"filter-type-==":[Vn,[Qn],(a,[t])=>a.geometryType()===t.value],"filter-<":[Vn,[Qn,jn],(a,[t,i])=>{const c=a.properties()[t.value],h=i.value;return typeof c==typeof h&&c<h}],"filter-id-<":[Vn,[jn],(a,[t])=>{const i=a.id(),c=t.value;return typeof i==typeof c&&i<c}],"filter->":[Vn,[Qn,jn],(a,[t,i])=>{const c=a.properties()[t.value],h=i.value;return typeof c==typeof h&&c>h}],"filter-id->":[Vn,[jn],(a,[t])=>{const i=a.id(),c=t.value;return typeof i==typeof c&&i>c}],"filter-<=":[Vn,[Qn,jn],(a,[t,i])=>{const c=a.properties()[t.value],h=i.value;return typeof c==typeof h&&c<=h}],"filter-id-<=":[Vn,[jn],(a,[t])=>{const i=a.id(),c=t.value;return typeof i==typeof c&&i<=c}],"filter->=":[Vn,[Qn,jn],(a,[t,i])=>{const c=a.properties()[t.value],h=i.value;return typeof c==typeof h&&c>=h}],"filter-id->=":[Vn,[jn],(a,[t])=>{const i=a.id(),c=t.value;return typeof i==typeof c&&i>=c}],"filter-has":[Vn,[jn],(a,[t])=>t.value in a.properties()],"filter-has-id":[Vn,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Vn,[la(Qn)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[Vn,[la(jn)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[Vn,[Qn,la(jn)],(a,[t,i])=>i.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[Vn,[Qn,la(jn)],(a,[t,i])=>function(c,h,p,g){for(;p<=g;){const w=p+g>>1;if(h[w]===c)return!0;h[w]>c?g=w-1:p=w+1}return!1}(a.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Vn,overloads:[[[Vn,Vn],(a,[t,i])=>t.evaluate(a)&&i.evaluate(a)],[wl(Vn),(a,t)=>{for(const i of t)if(!i.evaluate(a))return!1;return!0}]]},any:{type:Vn,overloads:[[[Vn,Vn],(a,[t,i])=>t.evaluate(a)||i.evaluate(a)],[wl(Vn),(a,t)=>{for(const i of t)if(i.evaluate(a))return!0;return!1}]]},"!":[Vn,[Vn],(a,[t])=>!t.evaluate(a)],"is-supported-script":[Vn,[Qn],(a,[t])=>{const i=a.globals&&a.globals.isSupportedScript;return!i||i(t.evaluate(a))}],upcase:[Qn,[Qn],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[Qn,[Qn],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[Qn,wl(jn),(a,t)=>t.map(i=>ya(i.evaluate(a))).join("")],"resolved-locale":[Qn,[Eu],(a,[t])=>t.evaluate(a).resolvedLocale()],random:[ur,[ur,ur,jn],(a,t)=>{const[i,c,h]=t.map(g=>g.evaluate(a));if(i>c||i===c)return i;let p;if(typeof h=="string")p=function(g){let w=0;if(g.length===0)return w;for(let T=0;T<g.length;T++)w=(w<<5)-w+g.charCodeAt(T),w|=0;return w}(h);else{if(typeof h!="number")throw new Jt(`Invalid seed input: ${h}`);p=h}return i+as(p)()*(c-i)}]});class Fu{constructor(t,i,c,h){this.expression=t,this._warningHistory={},this._evaluator=new Jl(c,h),this._defaultValue=i?function(p){return p.type==="color"&&(Nh(p.default)||Array.isArray(p.default))?new dn(0,0,0,0):p.type==="color"?dn.parse(p.default)||null:p.default===void 0?null:p.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=Mh(t)}evaluateWithoutErrorHandling(t,i,c,h,p,g,w,T){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=c,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(t,i,c,h,p,g,w,T){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=c||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Jt(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${A.message}`)),this._defaultValue}}}function Nu(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in ss}function Bu(a,t,i,c){const h=new Vp(ss,[],t?function(g){const w={color:sa,string:Qn,number:ur,enum:Qn,boolean:Vn,formatted:gd,resolvedImage:_d};return g.type==="array"?la(w[g.value]||jn,g.length):w[g.type]}(t):void 0,void 0,void 0,i,c),p=h.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Of(new Fu(p,t,i,c)):so(h.errors)}class Gc{constructor(t,i,c,h){this.kind=t,this._styleExpression=i,this.isLightConstant=c,this.isLineProgressConstant=h,this.isStateDependent=t!=="constant"&&!Ch(i.expression),this.configDependencies=Mh(i.expression)}evaluateWithoutErrorHandling(t,i,c,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,c,h,p,g)}evaluate(t,i,c,h,p,g){return this._styleExpression.evaluate(t,i,c,h,p,g)}}class Zs{constructor(t,i,c,h,p,g){this.kind=t,this.zoomStops=c,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!Ch(i.expression),this.isLightConstant=p,this.isLineProgressConstant=g,this.configDependencies=Mh(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,i,c,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,c,h,p,g)}evaluate(t,i,c,h,p,g){return this._styleExpression.evaluate(t,i,c,h,p,g)}interpolationFactor(t,i,c){return this.interpolationType?wo.interpolationFactor(this.interpolationType,t,i,c):0}}function jh(a,t,i,c){if((a=Bu(a,t,i,c)).result==="error")return a;const h=a.value.expression,p=Uc(h);if(!p&&!Qi(t))return so([new ga("","data expressions not supported")]);const g=Vc(h,["zoom","pitch","distance-from-center"]);if(!g&&!Df(t))return so([new ga("","zoom expressions not supported")]);const w=Vc(h,["measure-light"]);if(!w&&!Es(t))return so([new ga("","measure-light expression not supported")]);const T=Vc(h,["line-progress"]);if(!T&&!function(O){return ka(O.expression,"line-progress")}(t))return so([new ga("","line-progress expression not supported")]);const A=t.expression&&t.expression.relaxZoomRestriction,M=ju(h);return M||g||A?M instanceof ga?so([M]):M instanceof wo&&!Rd(t)?so([new ga("",'"interpolate" expressions cannot be used with this property')]):Of(M?new Zs(p&&T?"camera":"composite",a.value,M.labels,M instanceof wo?M.interpolation:void 0,w,T):new Gc(p&&T?"constant":"source",a.value,w,T)):so([new ga("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class qc{constructor(t,i){this._parameters=t,this._specification=i,Tu(this,Ld(this._parameters,this._specification))}static deserialize(t){return new qc(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ju(a){let t=null;if(a instanceof vl)t=ju(a.result);else if(a instanceof ua){for(const i of a.args)if(t=ju(i),t)break}else(a instanceof Du||a instanceof wo)&&a.input instanceof ca&&a.input.name==="zoom"&&(t=a);return t instanceof ga||a.eachChild(i=>{const c=ju(i);c instanceof ga?t=c:t&&c&&t!==c&&(t=new ga("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var Wc,Uh,zd=function(){if(Uh)return Wc;Uh=1,Wc=t;var a=3;function t(i,c,h){var p=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var g=new Int32Array(this.arrayBuffer);i=g[0],this.d=(c=g[1])+2*(h=g[2]);for(var w=0;w<this.d*this.d;w++){var T=g[a+w],A=g[a+w+1];p.push(T===A?null:g.subarray(T,A))}var M=g[a+p.length+1];this.keys=g.subarray(g[a+p.length],M),this.bboxes=g.subarray(M),this.insert=this._insertReadonly}else{this.d=c+2*h;for(var O=0;O<this.d*this.d;O++)p.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=i,this.padding=h,this.scale=c/i,this.uid=0;var z=h/c*i;this.min=-z,this.max=i+z}return t.prototype.insert=function(i,c,h,p,g){this._forEachCell(c,h,p,g,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(c),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(g)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(i,c,h,p,g,w){this.cells[g].push(w)},t.prototype.query=function(i,c,h,p,g){var w=this.min,T=this.max;if(i<=w&&c<=w&&T<=h&&T<=p&&!g)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(i,c,h,p,this._queryCell,A,{},g),A},t.prototype._queryCell=function(i,c,h,p,g,w,T,A){var M=this.cells[g];if(M!==null)for(var O=this.keys,z=this.bboxes,U=0;U<M.length;U++){var V=M[U];if(T[V]===void 0){var H=4*V;(A?A(z[H+0],z[H+1],z[H+2],z[H+3]):i<=z[H+2]&&c<=z[H+3]&&h>=z[H+0]&&p>=z[H+1])?(T[V]=!0,w.push(O[V])):T[V]=!1}}},t.prototype._forEachCell=function(i,c,h,p,g,w,T,A){for(var M=this._convertToCellCoord(i),O=this._convertToCellCoord(c),z=this._convertToCellCoord(h),U=this._convertToCellCoord(p),V=M;V<=z;V++)for(var H=O;H<=U;H++){var re=this.d*H+V;if((!A||A(this._convertFromCellCoord(V),this._convertFromCellCoord(H),this._convertFromCellCoord(V+1),this._convertFromCellCoord(H+1)))&&g.call(this,i,c,h,p,re,w,T,A))return}},t.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},t.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,c=a+this.cells.length+1+1,h=0,p=0;p<this.cells.length;p++)h+=this.cells[p].length;var g=new Int32Array(c+h+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var w=c,T=0;T<i.length;T++){var A=i[T];g[a+T]=w,g.set(A,w),w+=A.length}return g[a+i.length]=w,g.set(this.keys,w),g[a+i.length+1]=w+=this.keys.length,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer},Wc}(),Hc=Bn(zd);const Uu={};function qt(a,t,i={}){Object.defineProperty(a,"_classRegistryKey",{value:t,writable:!1}),Uu[t]={klass:a,omit:i.omit||[]}}qt(Object,"Object"),Hc.serialize=function(a,t){const i=a.toArrayBuffer();return t&&t.add(i),{buffer:i}},Hc.deserialize=function(a){return new Hc(a.buffer)},Object.defineProperty(Hc,"name",{value:"Grid"}),qt(Hc,"Grid"),typeof DOMMatrix<"u"&&qt(DOMMatrix,"DOMMatrix"),qt(dn,"Color"),qt(Error,"Error"),qt(_a,"Formatted"),qt(Sf,"FormattedSection"),qt($s,"AJAXError"),qt(Ma,"ResolvedImage"),qt(qc,"StylePropertyFunction"),qt(Fu,"StyleExpression",{omit:["_evaluator"]}),qt(Ca,"ImageId"),qt(vs,"ImageVariant"),qt(Zs,"ZoomDependentExpression"),qt(Gc,"ZoomConstantExpression"),qt(ca,"CompoundExpression",{omit:["_evaluate"]});for(const a in ss)Uu[ss[a]._classRegistryKey]||qt(ss[a],`Expression${a}`);function ba(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function ls(a){return self.ImageBitmap&&a instanceof ImageBitmap}function Tl(a,t){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(ba(a)||ls(a))return t&&t.add(a),a;if(ArrayBuffer.isView(a))return t&&t.add(a.buffer),a;if(a instanceof ImageData)return t&&t.add(a.data.buffer),a;if(Array.isArray(a)){const i=[];for(const c of a)i.push(Tl(c,t));return i}if(a instanceof Map){const i={$name:"Map",entries:[]};for(const[c,h]of a.entries())i.entries.push(Tl(c),Tl(h,t));return i}if(a instanceof Set){const i={$name:"Set"};let c=0;for(const h of a.values())i[++c]=Tl(h);return i}if(a instanceof DOMMatrix){const i={$name:"DOMMatrix"},c=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of c)i[h]=a[h];return i}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){const i=a.constructor,c=i._classRegistryKey;if(!c)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const h=i.serialize?i.serialize(a,t):{};if(!i.serialize){for(const p in a)a.hasOwnProperty(p)&&(Uu[c].omit.indexOf(p)>=0||(h[p]=Tl(a[p],t)));a instanceof Error&&(h.message=a.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(h.$name=c),h}throw new Error("can't serialize object of type "+typeof a)}function hc(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||ba(a)||ls(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(hc);if(typeof a=="object"){const t=a.$name||"Object";if(t==="Map"){const h=a.entries||[],p=new Map;for(let g=0;g<h.length;g+=2)p.set(hc(h[g]),hc(h[g+1]));return p}if(t==="Set"){const h=new Set;for(const p of Object.keys(a))p!=="$name"&&h.add(hc(a[p]));return h}if(t==="DOMMatrix"){let h;return h=a.is2D?[a.a,a.b,a.c,a.d,a.e,a.f]:[a.m11,a.m12,a.m13,a.m14,a.m21,a.m22,a.m23,a.m24,a.m31,a.m32,a.m33,a.m34,a.m41,a.m42,a.m43,a.m44],new DOMMatrix(h)}if(t==="BigInt")return BigInt(a.value);const{klass:i}=Uu[t];if(!i)throw new Error(`Can't deserialize unregistered class "${t}".`);if(i.deserialize)return i.deserialize(a);const c=Object.create(i.prototype);for(const h of Object.keys(a))h!=="$name"&&(c[h]=hc(a[h]));return c}throw new Error("can't deserialize object of type "+typeof a)}const _r={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function El(a){for(const t of a)if(cs(t.charCodeAt(0)))return!0;return!1}function Wp(a){for(const t of a)if(!Hp(t.charCodeAt(0)))return!1;return!0}function Hp(a){return!(_r.Arabic(a)||_r["Arabic Supplement"](a)||_r["Arabic Extended-A"](a)||_r["Arabic Presentation Forms-A"](a)||_r["Arabic Presentation Forms-B"](a))}function cs(a){return!(a!==746&&a!==747&&(a<4352||!(_r["Bopomofo Extended"](a)||_r.Bopomofo(a)||_r["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||_r["CJK Compatibility Ideographs"](a)||_r["CJK Compatibility"](a)||_r["CJK Radicals Supplement"](a)||_r["CJK Strokes"](a)||!(!_r["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||_r["CJK Unified Ideographs Extension A"](a)||_r["CJK Unified Ideographs"](a)||_r["Enclosed CJK Letters and Months"](a)||_r["Hangul Compatibility Jamo"](a)||_r["Hangul Jamo Extended-A"](a)||_r["Hangul Jamo Extended-B"](a)||_r["Hangul Jamo"](a)||_r["Hangul Syllables"](a)||_r.Hiragana(a)||_r["Ideographic Description Characters"](a)||_r.Kanbun(a)||_r["Kangxi Radicals"](a)||_r["Katakana Phonetic Extensions"](a)||_r.Katakana(a)&&a!==12540||!(!_r["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!_r["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||_r["Unified Canadian Aboriginal Syllabics"](a)||_r["Unified Canadian Aboriginal Syllabics Extended"](a)||_r["Vertical Forms"](a)||_r["Yijing Hexagram Symbols"](a)||_r["Yi Syllables"](a)||_r["Yi Radicals"](a))))}function dc(a){return!(cs(a)||function(t){return!!(_r["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||_r["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||_r["Letterlike Symbols"](t)||_r["Number Forms"](t)||_r["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||_r["Control Pictures"](t)&&t!==9251||_r["Optical Character Recognition"](t)||_r["Enclosed Alphanumerics"](t)||_r["Geometric Shapes"](t)||_r["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||_r["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||_r["CJK Symbols and Punctuation"](t)||_r.Katakana(t)||_r["Private Use Area"](t)||_r["CJK Compatibility Forms"](t)||_r["Small Form Variants"](t)||_r["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(a))}function Rf(a){return _r.Arabic(a)||_r["Arabic Supplement"](a)||_r["Arabic Extended-A"](a)||_r["Arabic Presentation Forms-A"](a)||_r["Arabic Presentation Forms-B"](a)}function Zp(a){return a>=1424&&a<=2303||_r["Arabic Presentation Forms-A"](a)||_r["Arabic Presentation Forms-B"](a)}function Lf(a,t){return!(!t&&Zp(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||_r.Khmer(a))}function eg(a){for(const t of a)if(Zp(t.charCodeAt(0)))return!0;return!1}const Vu="deferred",As="loading",$u="loaded";let Gu=null,Fo="unavailable",Al=null;const Is=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Fo="error"),Gu&&Gu(a)};function Fd(){Vh.fire(new fl("pluginStateChange",{pluginStatus:Fo,pluginURL:Al}))}const Vh=new ml,Hi=function(){return Fo},Nd=function(){if(Fo!==Vu||!Al)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Fo=As,Fd(),Al&&hl({url:Al},a=>{a?Is(a):(Fo=$u,Fd())})},Ua={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Fo===$u||Ua.applyArabicShaping!=null,isLoading:()=>Fo===As,setState(a){Fo=a.pluginStatus,Al=a.pluginURL},isParsed:()=>Ua.applyArabicShaping!=null&&Ua.processBidirectionalText!=null&&Ua.processStyledBidirectionalText!=null,getPluginURL:()=>Al};class $n{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(i,c){for(const h of i)if(!Lf(h.charCodeAt(0),c))return!1;return!0}(t,Ua.isLoaded())}}class Zc{constructor(t,i,c,h){this.property=t,this.value=i,this.expression=function(p,g,w,T){if(Nh(p))return new qc(p,g);if(Nu(p)||Array.isArray(p)&&p.length>0){const A=jh(p,g,w,T);if(A.result==="error")throw new Error(A.value.map(M=>`${M.key}: ${M.message}`).join(", "));return A.value}{let A=p;return typeof p=="string"&&g.type==="color"&&(A=dn.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>A}}}(i===void 0?t.specification.default:i,t.specification,c,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,c){return this.property.possiblyEvaluate(this,t,i,c)}}class Il{constructor(t,i,c){this.property=t,this.value=new Zc(t,void 0,i,c)}transitioned(t,i){return new mo(this.property,this.value,i,Ze({},t.transition,this.transition),t.now)}untransitioned(){return new mo(this.property,this.value,null,{},0)}}class Xc{constructor(t,i,c){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=i,this._options=c,this.configDependencies=new Set}getValue(t){return Nr(this._values[t].value.value)}setValue(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new Il(this._values[t].property,this._scope,this._options)),this._values[t].value=new Zc(this._values[t].property,i===null?void 0:Nr(i),this._scope,this._options),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]))}setTransitionOrValue(t,i){i&&(this._options=i);const c=this._properties.properties;if(t)for(const h in t){const p=t[h];if(h.endsWith("-transition")){const g=h.slice(0,-11);c[g]&&this.setTransition(g,p)}else c.hasOwnProperty(h)&&this.setValue(h,p)}}getTransition(t){return Nr(this._values[t].transition)}setTransition(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new Il(this._values[t].property)),this._values[t].transition=Nr(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const c=this.getValue(i);c!==void 0&&(t[i]=c);const h=this.getTransition(i);h!==void 0&&(t[`${i}-transition`]=h)}return t}transitioned(t,i){const c=new No(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].transitioned(t,i._values[h]);return c}untransitioned(){const t=new No(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class mo{constructor(t,i,c,h,p){const g=h.delay||0,w=h.duration||0;p=p||0,this.property=t,this.value=i,this.begin=p+g,this.end=this.begin+w,t.specification.transition&&(h.delay||h.duration)&&(this.prior=c)}possiblyEvaluate(t,i,c){const h=t.now||0,p=this.value.possiblyEvaluate(t,i,c),g=this.prior;if(g){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return g.possiblyEvaluate(t,i,c);{const w=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,i,c),p,De(w))}}return p}}class No{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,c){const h=new Xs(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(t,i,c);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ra{constructor(t,i,c){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=i,this._options=c,this.configDependencies=new Set}getValue(t){return Nr(this._values[t].value)}setValue(t,i){this._values[t]=new Zc(this._values[t].property,i===null?void 0:Nr(i),this._scope,this._options),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]))}serialize(){const t={};for(const i of Object.keys(this._values)){const c=this.getValue(i);c!==void 0&&(t[i]=c)}return t}possiblyEvaluate(t,i,c){const h=new Xs(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(t,i,c);return h}}class fc{constructor(t,i,c){this.property=t,this.value=i,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,c,h){return this.property.evaluate(this.value,this.parameters,t,i,c,h)}}class Xs{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ct{constructor(t){this.specification=t}possiblyEvaluate(t,i){return t.expression.evaluate(i)}interpolate(t,i,c){const h=vh[this.specification.type];return h?h(t,i,c):t}}class Xt{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,c,h){return new fc(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},c,h)}:t.expression,i)}interpolate(t,i,c){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new fc(this,{kind:"constant",value:void 0},t.parameters);const h=vh[this.specification.type];return h?new fc(this,{kind:"constant",value:h(t.value.value,i.value.value,c)},t.parameters):t}evaluate(t,i,c,h,p,g){return t.kind==="constant"?t.value:t.evaluate(i,c,h,p,g)}}class So{constructor(t){this.specification=t}possiblyEvaluate(t,i,c,h){return!!t.expression.evaluate(i,null,{},c,h)}interpolate(){return!1}}class Ri{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new $n(0,{});for(const c in t){const h=t[c];h.specification.overridable&&this.overridableProperties.push(c);const p=this.defaultPropertyValues[c]=new Zc(h,void 0),g=this.defaultTransitionablePropertyValues[c]=new Il(h);this.defaultTransitioningPropertyValues[c]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=p.possiblyEvaluate(i)}}}qt(Xt,"DataDrivenProperty"),qt(Ct,"DataConstantProperty"),qt(So,"ColorRampProperty");var qe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white"},"sky-atmosphere-color":{"type":"color","default":"white"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function us(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function hs(a){if(Array.isArray(a))return a.map(hs);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const i in a)t[i]=hs(a[i]);return t}return us(a)}function Ra(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!Ra(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function qu(a,t="",i=null,c="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ra(a)||(a=Bd(a));const h=a;let p=!0;try{p=function(M){if(!Wu(M))return M;let O=hs(M);return Ff(O),O=zf(O),O}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let g=null,w=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){w=qe[`filter_${c}`];const M=Bu(p,w,t,i);if(M.result==="error")throw new Error(M.value.map(O=>`${O.key}: ${O.message}`).join(", "));g=(O,z,U)=>M.value.evaluate(O,z,{},U)}let T=null,A=null;if(p!==h){const M=Bu(h,w,t,i);if(M.result==="error")throw new Error(M.value.map(O=>`${O.key}: ${O.message}`).join(", "));T=(O,z,U,V,H)=>M.value.evaluate(O,z,{},U,void 0,void 0,V,H),A=!Uc(M.value.expression)}return{filter:g,dynamicFilter:T||void 0,needGeometry:Xp(p),needFeature:!!A}}function zf(a){if(!Array.isArray(a))return a;const t=function(i){if(tg.has(i[0])){for(let c=1;c<i.length;c++)if(Wu(i[c]))return!0}return i}(a);return t===!0?t:t.map(i=>zf(i))}function Ff(a){let t=!1;const i=[];if(a[0]==="case"){for(let c=1;c<a.length-1;c+=2)t=t||Wu(a[c]),i.push(a[c+1]);i.push(a[a.length-1])}else if(a[0]==="match"){t=t||Wu(a[1]);for(let c=2;c<a.length-1;c+=2)i.push(a[c+1]);i.push(a[a.length-1])}else if(a[0]==="step"){t=t||Wu(a[1]);for(let c=1;c<a.length-1;c+=2)i.push(a[c+1])}t&&(a.length=0,a.push("any",...i));for(let c=1;c<a.length;c++)Ff(a[c])}function Wu(a){if(!Array.isArray(a))return!1;if((t=a[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let i=1;i<a.length;i++)if(Wu(a[i]))return!0;return!1}const tg=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function rg(a,t){return a<t?-1:a>t?1:0}function Xp(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(Xp(a[t]))return!0;return!1}function Bd(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?Nf(a[1],a[2],"=="):t==="!="?Yc(Nf(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Nf(a[1],a[2],t):t==="any"?(i=a.slice(1),["any"].concat(i.map(Bd))):t==="all"?["all"].concat(a.slice(1).map(Bd)):t==="none"?["all"].concat(a.slice(1).map(Bd).map(Yc)):t==="in"?Bf(a[1],a.slice(2)):t==="!in"?Yc(Bf(a[1],a.slice(2))):t==="has"?Yp(a[1]):t!=="!has"||Yc(Yp(a[1]));var i}function Nf(a,t,i){switch(a){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,a,t]}}function Bf(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",a,["literal",t.sort(rg)]]:["filter-in-small",a,["literal",t]]}}function Yp(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Yc(a){return["!",a]}const $h="";function Pl(a,t){return t?`${a}${$h}${t}`:a}const Gh="-transition",pc=new Set(["fill","line","background","hillshade","raster"]);class na extends ml{constructor(t,i,c,h,p){if(super(),this.id=t.id,this.fqid=Pl(this.id,c),this.type=t.type,this.scope=c,this.lut=h,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,t.type!=="custom"){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;const g=Bu(this.filter,qe[`filter_${t.type}`]);g.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...g.value.configDependencies]))}if(t.slot&&(this.slot=t.slot),i.layout&&(this._unevaluatedLayout=new ra(i.layout,this.scope,p),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new Xc(i.paint,this.scope,p);for(const g in t.paint)this.setPaintProperty(g,t.paint[g]);for(const g in t.layout)this.setLayoutProperty(g,t.layout[g]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xs(i.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D(!0)&&pc.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i){if(this.type==="custom"&&t==="visibility")return void(this.visibility=i);const c=this._unevaluatedLayout;c._properties.properties[t]&&(c.setValue(t,i),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return t.endsWith(Gh)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i){const c=this._transitionablePaint,h=c._properties.properties;if(t.endsWith(Gh)){const O=t.slice(0,-11);return h[O]&&c.setTransition(O,i||void 0),!1}if(!h[t])return!1;const p=c._values[t],g=p.value.isDataDriven(),w=p.value;c.setValue(t,i),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(t);const T=c._values[t].value,A=T.isDataDriven(),M=t.endsWith("pattern")||t==="line-dasharray";return A||g||M||this._handleOverridablePaintPropertyUpdate(t,w,T)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,i,c){return null}_handleOverridablePaintPropertyUpdate(t,i,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){return Mr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,i)=>!(t===void 0||i==="layout"&&!Object.keys(t).length||i==="paint"&&!Object.keys(t).length))}is3D(t){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof fc&&Qi(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=qu(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(t){}queryIntersectsFeature(t,i,c,h,p,g,w,T,A){}}const ng={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class qh{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function On(a,t=1){let i=0,c=0;return{members:a.map(h=>{const p=ng[h.type].BYTES_PER_ELEMENT,g=i=jd(i,Math.max(t,p)),w=h.components||1;return c=Math.max(c,p),i+=p*w,{name:h.name,type:h.type,components:w,offset:g}}),size:jd(i,Math.max(c,t)),alignment:t}}function jd(a,t){return Math.ceil(a/t)*t}class Cl extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const c=this.length;return this.resize(c+1),this.emplace(c,t,i)}emplace(t,i,c){const h=2*t;return this.int16[h+0]=i,this.int16[h+1]=c,t}}Cl.prototype.bytesPerElement=4,qt(Cl,"StructArrayLayout2i4");class Ud extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,c)}emplace(t,i,c,h){const p=3*t;return this.int16[p+0]=i,this.int16[p+1]=c,this.int16[p+2]=h,t}}Ud.prototype.bytesPerElement=6,qt(Ud,"StructArrayLayout3i6");class Kc extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,c,h)}emplace(t,i,c,h,p){const g=4*t;return this.int16[g+0]=i,this.int16[g+1]=c,this.int16[g+2]=h,this.int16[g+3]=p,t}}Kc.prototype.bytesPerElement=8,qt(Kc,"StructArrayLayout4i8");class Wh extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}Wh.prototype.bytesPerElement=4,qt(Wh,"StructArrayLayout1f4");class Vd extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,c)}emplace(t,i,c,h){const p=4*t,g=2*t;return this.int16[p+0]=i,this.int16[p+1]=c,this.float32[g+1]=h,t}}Vd.prototype.bytesPerElement=8,qt(Vd,"StructArrayLayout2i1f8");class Hh extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,c)}emplace(t,i,c,h){const p=4*t;return this.int16[p+0]=i,this.int16[p+1]=c,this.int16[p+2]=h,t}}Hh.prototype.bytesPerElement=8,qt(Hh,"StructArrayLayout3i8");class Kp extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,c,h,p)}emplace(t,i,c,h,p,g){const w=5*t;return this.int16[w+0]=i,this.int16[w+1]=c,this.int16[w+2]=h,this.int16[w+3]=p,this.int16[w+4]=g,t}}Kp.prototype.bytesPerElement=10,qt(Kp,"StructArrayLayout5i10");class jf extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p,g,w){const T=this.length;return this.resize(T+1),this.emplace(T,t,i,c,h,p,g,w)}emplace(t,i,c,h,p,g,w,T){const A=6*t,M=12*t,O=3*t;return this.int16[A+0]=i,this.int16[A+1]=c,this.uint8[M+4]=h,this.uint8[M+5]=p,this.uint8[M+6]=g,this.uint8[M+7]=w,this.float32[O+2]=T,t}}jf.prototype.bytesPerElement=12,qt(jf,"StructArrayLayout2i4ub1f12");class Ys extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,c)}emplace(t,i,c,h){const p=3*t;return this.float32[p+0]=i,this.float32[p+1]=c,this.float32[p+2]=h,t}}Ys.prototype.bytesPerElement=12,qt(Ys,"StructArrayLayout3f12");class Ml extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,c,h,p)}emplace(t,i,c,h,p,g){const w=6*t,T=3*t;return this.uint16[w+0]=i,this.uint16[w+1]=c,this.uint16[w+2]=h,this.uint16[w+3]=p,this.float32[T+2]=g,t}}Ml.prototype.bytesPerElement=12,qt(Ml,"StructArrayLayout4ui1f12");class Hu extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,c,h)}emplace(t,i,c,h,p){const g=4*t;return this.uint16[g+0]=i,this.uint16[g+1]=c,this.uint16[g+2]=h,this.uint16[g+3]=p,t}}Hu.prototype.bytesPerElement=8,qt(Hu,"StructArrayLayout4ui8");class Zu extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p,g){const w=this.length;return this.resize(w+1),this.emplace(w,t,i,c,h,p,g)}emplace(t,i,c,h,p,g,w){const T=6*t;return this.int16[T+0]=i,this.int16[T+1]=c,this.int16[T+2]=h,this.int16[T+3]=p,this.int16[T+4]=g,this.int16[T+5]=w,t}}Zu.prototype.bytesPerElement=12,qt(Zu,"StructArrayLayout6i12");class Zh extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p,g,w,T,A,M,O,z){const U=this.length;return this.resize(U+1),this.emplace(U,t,i,c,h,p,g,w,T,A,M,O,z)}emplace(t,i,c,h,p,g,w,T,A,M,O,z,U){const V=12*t;return this.int16[V+0]=i,this.int16[V+1]=c,this.int16[V+2]=h,this.int16[V+3]=p,this.uint16[V+4]=g,this.uint16[V+5]=w,this.uint16[V+6]=T,this.uint16[V+7]=A,this.int16[V+8]=M,this.int16[V+9]=O,this.int16[V+10]=z,this.int16[V+11]=U,t}}Zh.prototype.bytesPerElement=24,qt(Zh,"StructArrayLayout4i4ui4i24");class La extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p,g){const w=this.length;return this.resize(w+1),this.emplace(w,t,i,c,h,p,g)}emplace(t,i,c,h,p,g,w){const T=10*t,A=5*t;return this.int16[T+0]=i,this.int16[T+1]=c,this.int16[T+2]=h,this.float32[A+2]=p,this.float32[A+3]=g,this.float32[A+4]=w,t}}La.prototype.bytesPerElement=20,qt(La,"StructArrayLayout3i3f20");class Bo extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,c,h)}emplace(t,i,c,h,p){const g=4*t;return this.float32[g+0]=i,this.float32[g+1]=c,this.float32[g+2]=h,this.float32[g+3]=p,t}}Bo.prototype.bytesPerElement=16,qt(Bo,"StructArrayLayout4f16");class $d extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}$d.prototype.bytesPerElement=4,qt($d,"StructArrayLayout1ul4");class Ks extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const c=this.length;return this.resize(c+1),this.emplace(c,t,i)}emplace(t,i,c){const h=2*t;return this.uint16[h+0]=i,this.uint16[h+1]=c,t}}Ks.prototype.bytesPerElement=4,qt(Ks,"StructArrayLayout2ui4");class Uf extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p,g,w,T,A,M,O,z,U){const V=this.length;return this.resize(V+1),this.emplace(V,t,i,c,h,p,g,w,T,A,M,O,z,U)}emplace(t,i,c,h,p,g,w,T,A,M,O,z,U,V){const H=20*t,re=10*t;return this.int16[H+0]=i,this.int16[H+1]=c,this.int16[H+2]=h,this.int16[H+3]=p,this.int16[H+4]=g,this.float32[re+3]=w,this.float32[re+4]=T,this.float32[re+5]=A,this.float32[re+6]=M,this.int16[H+14]=O,this.uint32[re+8]=z,this.uint16[H+18]=U,this.uint16[H+19]=V,t}}Uf.prototype.bytesPerElement=40,qt(Uf,"StructArrayLayout5i4f1i1ul2ui40");class Gd extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p,g,w){const T=this.length;return this.resize(T+1),this.emplace(T,t,i,c,h,p,g,w)}emplace(t,i,c,h,p,g,w,T){const A=8*t;return this.int16[A+0]=i,this.int16[A+1]=c,this.int16[A+2]=h,this.int16[A+4]=p,this.int16[A+5]=g,this.int16[A+6]=w,this.int16[A+7]=T,t}}Gd.prototype.bytesPerElement=16,qt(Gd,"StructArrayLayout3i2i2i16");class Xh extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,c,h,p)}emplace(t,i,c,h,p,g){const w=4*t,T=8*t;return this.float32[w+0]=i,this.float32[w+1]=c,this.float32[w+2]=h,this.int16[T+6]=p,this.int16[T+7]=g,t}}Xh.prototype.bytesPerElement=16,qt(Xh,"StructArrayLayout2f1f2i16");class qd extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p,g){const w=this.length;return this.resize(w+1),this.emplace(w,t,i,c,h,p,g)}emplace(t,i,c,h,p,g,w){const T=20*t,A=5*t;return this.uint8[T+0]=i,this.uint8[T+1]=c,this.float32[A+1]=h,this.float32[A+2]=p,this.float32[A+3]=g,this.float32[A+4]=w,t}}qd.prototype.bytesPerElement=20,qt(qd,"StructArrayLayout2ub4f20");class to extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,c)}emplace(t,i,c,h){const p=3*t;return this.uint16[p+0]=i,this.uint16[p+1]=c,this.uint16[p+2]=h,t}}to.prototype.bytesPerElement=6,qt(to,"StructArrayLayout3ui6");class Wd extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p,g,w,T,A,M,O,z,U,V,H,re,ne,de,ue,X,se){const he=this.length;return this.resize(he+1),this.emplace(he,t,i,c,h,p,g,w,T,A,M,O,z,U,V,H,re,ne,de,ue,X,se)}emplace(t,i,c,h,p,g,w,T,A,M,O,z,U,V,H,re,ne,de,ue,X,se,he){const _e=30*t,Ce=15*t,Re=60*t;return this.int16[_e+0]=i,this.int16[_e+1]=c,this.int16[_e+2]=h,this.float32[Ce+2]=p,this.float32[Ce+3]=g,this.uint16[_e+8]=w,this.uint16[_e+9]=T,this.uint32[Ce+5]=A,this.uint32[Ce+6]=M,this.uint32[Ce+7]=O,this.uint16[_e+16]=z,this.uint16[_e+17]=U,this.uint16[_e+18]=V,this.float32[Ce+10]=H,this.float32[Ce+11]=re,this.uint8[Re+48]=ne,this.uint8[Re+49]=de,this.uint8[Re+50]=ue,this.uint32[Ce+13]=X,this.int16[_e+28]=se,this.uint8[Re+58]=he,t}}Wd.prototype.bytesPerElement=60,qt(Wd,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Hd extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p,g,w,T,A,M,O,z,U,V,H,re,ne,de,ue,X,se,he,_e,Ce,Re,Ne,$e,at,xt,mt,yt,At,tt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,t,i,c,h,p,g,w,T,A,M,O,z,U,V,H,re,ne,de,ue,X,se,he,_e,Ce,Re,Ne,$e,at,xt,mt,yt,At,tt)}emplace(t,i,c,h,p,g,w,T,A,M,O,z,U,V,H,re,ne,de,ue,X,se,he,_e,Ce,Re,Ne,$e,at,xt,mt,yt,At,tt,_t){const Je=20*t,it=40*t,Pt=80*t;return this.float32[Je+0]=i,this.float32[Je+1]=c,this.int16[it+4]=h,this.int16[it+5]=p,this.int16[it+6]=g,this.int16[it+7]=w,this.int16[it+8]=T,this.int16[it+9]=A,this.int16[it+10]=M,this.int16[it+11]=O,this.int16[it+12]=z,this.uint16[it+13]=U,this.uint16[it+14]=V,this.uint16[it+15]=H,this.uint16[it+16]=re,this.uint16[it+17]=ne,this.uint16[it+18]=de,this.uint16[it+19]=ue,this.uint16[it+20]=X,this.uint16[it+21]=se,this.uint16[it+22]=he,this.uint16[it+23]=_e,this.uint16[it+24]=Ce,this.uint16[it+25]=Re,this.uint16[it+26]=Ne,this.uint16[it+27]=$e,this.uint32[Je+14]=at,this.float32[Je+15]=xt,this.float32[Je+16]=mt,this.float32[Je+17]=yt,this.float32[Je+18]=At,this.uint8[Pt+76]=tt,this.uint16[it+39]=_t,t}}Hd.prototype.bytesPerElement=80,qt(Hd,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Jc extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,c,h,p)}emplace(t,i,c,h,p,g){const w=5*t;return this.float32[w+0]=i,this.float32[w+1]=c,this.float32[w+2]=h,this.float32[w+3]=p,this.float32[w+4]=g,t}}Jc.prototype.bytesPerElement=20,qt(Jc,"StructArrayLayout5f20");class Yh extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p,g,w){const T=this.length;return this.resize(T+1),this.emplace(T,t,i,c,h,p,g,w)}emplace(t,i,c,h,p,g,w,T){const A=7*t;return this.float32[A+0]=i,this.float32[A+1]=c,this.float32[A+2]=h,this.float32[A+3]=p,this.float32[A+4]=g,this.float32[A+5]=w,this.float32[A+6]=T,t}}Yh.prototype.bytesPerElement=28,qt(Yh,"StructArrayLayout7f28");class Vf extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p,g,w,T,A,M,O){const z=this.length;return this.resize(z+1),this.emplace(z,t,i,c,h,p,g,w,T,A,M,O)}emplace(t,i,c,h,p,g,w,T,A,M,O,z){const U=11*t;return this.float32[U+0]=i,this.float32[U+1]=c,this.float32[U+2]=h,this.float32[U+3]=p,this.float32[U+4]=g,this.float32[U+5]=w,this.float32[U+6]=T,this.float32[U+7]=A,this.float32[U+8]=M,this.float32[U+9]=O,this.float32[U+10]=z,t}}Vf.prototype.bytesPerElement=44,qt(Vf,"StructArrayLayout11f44");class Zd extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p,g,w,T,A){const M=this.length;return this.resize(M+1),this.emplace(M,t,i,c,h,p,g,w,T,A)}emplace(t,i,c,h,p,g,w,T,A,M){const O=9*t;return this.float32[O+0]=i,this.float32[O+1]=c,this.float32[O+2]=h,this.float32[O+3]=p,this.float32[O+4]=g,this.float32[O+5]=w,this.float32[O+6]=T,this.float32[O+7]=A,this.float32[O+8]=M,t}}Zd.prototype.bytesPerElement=36,qt(Zd,"StructArrayLayout9f36");class Qc extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const c=this.length;return this.resize(c+1),this.emplace(c,t,i)}emplace(t,i,c){const h=2*t;return this.float32[h+0]=i,this.float32[h+1]=c,t}}Qc.prototype.bytesPerElement=8,qt(Qc,"StructArrayLayout2f8");class $f extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,c,h)}emplace(t,i,c,h,p){const g=6*t;return this.uint32[3*t+0]=i,this.uint16[g+2]=c,this.uint16[g+3]=h,this.uint16[g+4]=p,t}}$f.prototype.bytesPerElement=12,qt($f,"StructArrayLayout1ul3ui12");class Xd extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}Xd.prototype.bytesPerElement=2,qt(Xd,"StructArrayLayout1ui2");class Xo extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p,g,w,T,A,M,O,z,U,V,H,re){const ne=this.length;return this.resize(ne+1),this.emplace(ne,t,i,c,h,p,g,w,T,A,M,O,z,U,V,H,re)}emplace(t,i,c,h,p,g,w,T,A,M,O,z,U,V,H,re,ne){const de=16*t;return this.float32[de+0]=i,this.float32[de+1]=c,this.float32[de+2]=h,this.float32[de+3]=p,this.float32[de+4]=g,this.float32[de+5]=w,this.float32[de+6]=T,this.float32[de+7]=A,this.float32[de+8]=M,this.float32[de+9]=O,this.float32[de+10]=z,this.float32[de+11]=U,this.float32[de+12]=V,this.float32[de+13]=H,this.float32[de+14]=re,this.float32[de+15]=ne,t}}Xo.prototype.bytesPerElement=64,qt(Xo,"StructArrayLayout16f64");class Yo extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,c,h,p,g,w){const T=this.length;return this.resize(T+1),this.emplace(T,t,i,c,h,p,g,w)}emplace(t,i,c,h,p,g,w,T){const A=10*t,M=5*t;return this.uint16[A+0]=i,this.uint16[A+1]=c,this.uint16[A+2]=h,this.uint16[A+3]=p,this.float32[M+2]=g,this.float32[M+3]=w,this.float32[M+4]=T,t}}Yo.prototype.bytesPerElement=20,qt(Yo,"StructArrayLayout4ui3f20");class Gf extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.int16[1*t+0]=i,t}}Gf.prototype.bytesPerElement=2,qt(Gf,"StructArrayLayout1i2");class Yd extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint8[1*t+0]=i,t}}Yd.prototype.bytesPerElement=1,qt(Yd,"StructArrayLayout1ub1");class Jp extends qh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Jp.prototype.size=40;class Kd extends Uf{get(t){return new Jp(this,t)}}qt(Kd,"CollisionBoxArray");class Qp extends qh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Qp.prototype.size=60;class qf extends Wd{get(t){return new Qp(this,t)}}qt(qf,"PlacedSymbolArray");class em extends qh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}em.prototype.size=80;class Wf extends Hd{get(t){return new em(this,t)}}qt(Wf,"SymbolInstanceArray");class Hf extends Wh{getoffsetX(t){return this.float32[1*t+0]}}qt(Hf,"GlyphOffsetArray");class tm extends Cl{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}qt(tm,"SymbolLineVertexArray");class Zf extends qh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Zf.prototype.size=12;class Xf extends $f{get(t){return new Zf(this,t)}}qt(Xf,"FeatureIndexArray");class rm extends Ks{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}qt(rm,"FillExtrusionCentroidArray");class Yf extends qh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Yf.prototype.size=6;class Jd extends Ud{get(t){return new Yf(this,t)}}qt(Jd,"FillExtrusionWallArray");const o_=On([{name:"a_pos",components:2,type:"Int16"}],4),ig=On([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Si{constructor(t=[]){this.segments=t}_prepareSegment(t,i,c,h){let p=this.segments[this.segments.length-1];return t>Si.MAX_VERTEX_ARRAY_LENGTH&&tn(`Max vertices per segment is ${Si.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!p||p.vertexLength+t>Si.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:i,primitiveOffset:c,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}prepareSegment(t,i,c,h){return this._prepareSegment(t,i.length,c.length,h)}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,c,h){return new Si([{vertexOffset:t,primitiveOffset:i,vertexLength:c,primitiveLength:h,vaos:{},sortKey:0}])}}function nm(a,t){return 256*(a=Fe(Math.floor(a),0,255))+Fe(Math.floor(t),0,255)}Si.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qt(Si,"SegmentVector");const Kf=On([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Va=On([{name:"a_pattern_b",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),a_=On([{name:"a_dash",components:4,type:"Uint16"}]);class Xu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,i,c,h){this.ids.push(Jf(t)),this.positions.push(i,c,h)}eachPosition(t,i){const c=Jf(t);let h=0,p=this.ids.length-1;for(;h<p;){const g=h+p>>1;this.ids[g]>=c?p=g:h=g+1}for(;this.ids[h]===c;)i(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(t,i){const c=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Qd(c,h,0,c.length-1),i&&(i.add(c.buffer),i.add(h.buffer)),{ids:c,positions:h}}static deserialize(t){const i=new Xu;let c;i.ids=t.ids,i.positions=t.positions;for(const h of i.ids)h!==c&&i.uniqueIds.push(h),c=h;return i.indexed=!0,i}}function Jf(a){const t=+a;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:aa(String(a))}function Qd(a,t,i,c){for(;i<c;){const h=a[i+c>>1];let p=i-1,g=c+1;for(;;){do p++;while(a[p]<h);do g--;while(a[g]>h);if(p>=g)break;Kh(a,p,g),Kh(t,3*p,3*g),Kh(t,3*p+1,3*g+1),Kh(t,3*p+2,3*g+2)}g-i<c-g?(Qd(a,t,i,g),i=g+1):(Qd(a,t,g+1,c),c=g)}}function Kh(a,t,i){const c=a[t];a[t]=a[i],a[i]=c}qt(Xu,"FeaturePositionMap");class $a{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,i),this.initialized=!0),!!this.location}set(t,i,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Ko extends $a{constructor(t){super(t),this.current=0}set(t,i,c){this.fetchUniformLocation(t,i)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class ro extends $a{constructor(t){super(t),this.current=0}set(t,i,c){this.fetchUniformLocation(t,i)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Js extends $a{constructor(t){super(t),this.current=[0,0]}set(t,i,c){this.fetchUniformLocation(t,i)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class eu extends $a{constructor(t){super(t),this.current=[0,0,0]}set(t,i,c){this.fetchUniformLocation(t,i)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class Jo extends $a{constructor(t){super(t),this.current=[0,0,0,0]}set(t,i,c){this.fetchUniformLocation(t,i)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class og extends $a{constructor(t){super(t),this.current=dn.transparent.toRenderColor(null)}set(t,i,c){this.fetchUniformLocation(t,i)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const Wr=new Float32Array(16);class Ol extends $a{constructor(t){super(t),this.current=Wr}set(t,i,c){if(this.fetchUniformLocation(t,i)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let h=1;h<16;h++)if(c[h]!==this.current[h]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const Qf=new Float32Array(9),ep=new Float32Array(4);class Ps extends $a{constructor(t){super(t),this.current=ep}set(t,i,c){if(this.fetchUniformLocation(t,i)){for(let h=0;h<4;h++)if(c[h]!==this.current[h]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function mc(a){return[nm(255*a.r,255*a.g),nm(255*a.b,255*a.a)]}class tu{constructor(t,i,c,h){this.value=t,this.uniformNames=i.map(p=>`u_${p}`),this.type=c,this.context=h}setUniform(t,i,c,h,p){const g=h.constantOr(this.value);i.set(t,p,g instanceof dn?g.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(t,i){return this.type==="color"?new og(t):new ro(t)}}class ru{constructor(t,i){this.uniformNames=i.map(c=>`u_${c}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(t,i){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(t,i,c,h,p){let g=null;p!=="u_pattern"&&p!=="u_dash"||(g=this.pattern),p==="u_pattern_b"&&(g=this.patternTransition),p==="u_pixel_ratio"&&(g=this.pixelRatio),g&&i.set(t,p,g)}getBinding(t,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Jo(t):new ro(t)}}class Dl{constructor(t,i,c,h){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,i,c,h,p,g,w){const T=this.paintVertexArray.length,A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new $n(0,{brightness:g}),i,{},p,h,w):this.expression.kind==="constant"&&this.expression.value,M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new $n(0,{brightness:g}),i,{},p,h,w):this.lutExpression.value)==="none";this.paintVertexArray.resize(t),this._setPaintValue(T,t,A,M?null:this.context.lut)}updatePaintArray(t,i,c,h,p,g,w){const T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w},c,h,void 0,p):this.expression.kind==="constant"&&this.expression.value,A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new $n(0,{brightness:w}),c,h,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(t,i,T,A?null:this.context.lut)}_setPaintValue(t,i,c,h){if(this.type==="color"){const p=mc(c.toRenderColor(h));for(let g=t;g<i;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=t;p<i;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Cs{constructor(t,i,c,h,p,g){this.expression=t,this.uniformNames=i.map(w=>`u_${w}_t`),this.type=c,this.useIntegerZoom=h,this.context=p,this.maxValue=0,this.paintVertexAttributes=i.map(w=>({name:`a_${w}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,i,c,h,p,g,w){const T=this.expression.evaluate(new $n(this.context.zoom,{brightness:g}),i,{},p,h,w),A=this.expression.evaluate(new $n(this.context.zoom+1,{brightness:g}),i,{},p,h,w),M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new $n(0,{brightness:g}),i,{},p,h,w):this.lutExpression.value)==="none",O=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(O,t,T,A,M?null:this.context.lut)}updatePaintArray(t,i,c,h,p,g,w){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:w},c,h,void 0,p),A=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w},c,h,void 0,p),M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new $n(0,{brightness:w}),c,h,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(t,i,T,A,M?null:this.context.lut)}_setPaintValue(t,i,c,h,p){if(this.type==="color"){const g=mc(c.toRenderColor(p)),w=mc(c.toRenderColor(p));for(let T=t;T<i;T++)this.paintVertexArray.emplace(T,g[0],g[1],w[0],w[1])}else{for(let g=t;g<i;g++)this.paintVertexArray.emplace(g,c,h);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i,c,h,p){const g=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,w=Fe(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);i.set(t,p,w)}getBinding(t,i){return new ro(t)}}class Ms{constructor(t,i,c,h,p){this.expression=t,this.layerId=p,this.paintVertexAttributes=(c==="array"?a_:Kf).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new h,this.paintTransitionVertexArray=new Ml}populatePaintArray(t,i,c,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(p,t,i.patterns&&i.patterns[this.layerId],c)}updatePaintArray(t,i,c,h,p,g,w){this._setPaintValues(t,i,c.patterns&&c.patterns[this.layerId],g)}_setPaintValues(t,i,c,h){if(!h||!c)return;const p=h[c[0]],g=h[c[1]];if(p){if(p){const{tl:w,br:T,pixelRatio:A}=p;for(let M=t;M<i;M++)this.paintVertexArray.emplace(M,w[0],w[1],T[0],T[1],A)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:w,br:T,pixelRatio:A}=g;for(let M=t;M<i;M++)this.paintTransitionVertexArray.emplace(M,w[0],w[1],T[0],T[1],A)}}}upload(t){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=t.createVertexBuffer(this.paintTransitionVertexArray,Va.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class kl{constructor(t,i,c=()=>!0){this.binders={},this._buffers=[],this.context=i;const h=[];for(const p in t.paint._values){const g=t.paint.get(p);if(p.endsWith("-use-theme")||!c(p)||!(g instanceof fc&&Qi(g.property.specification)))continue;const w=r(p,t.type),T=g.value,A=g.property.specification.type,M=!!g.property.useIntegerZoom,O=p==="line-dasharray"||p.endsWith("pattern"),z=t.paint.get(`${p}-use-theme`),U=p==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant"||z&&z.value.kind!=="constant";if(T.kind!=="constant"||U)if(T.kind==="source"||U||O){const V=_(p,A,"source");this.binders[p]=O?new Ms(T,w,A,V,t.id):new Dl(T,w,A,V),h.push(`/a_${p}`)}else{const V=_(p,A,"composite");this.binders[p]=new Cs(T,w,A,M,i,V),h.push(`/z_${p}`)}else this.binders[p]=O?new ru(T.value,w):new tu(T.value,w,A,i),h.push(`/u_${p}`);z&&(this.binders[p].lutExpression=z.value)}this.cacheKey=h.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof Dl||i instanceof Cs?i.maxValue:0}populatePaintArrays(t,i,c,h,p,g,w){for(const T in this.binders){const A=this.binders[T];A.context=this.context,(A instanceof Dl||A instanceof Cs||A instanceof Ms)&&A.populatePaintArray(t,i,c,h,p,g,w)}}setConstantPatternPositions(t,i){for(const c in this.binders){const h=this.binders[c];h instanceof ru&&h.setConstantPatternPositions(t,i)}}getPatternTransitionVertexBuffer(t){const i=this.binders[t];return i instanceof Ms?i.paintTransitionVertexBuffer:null}updatePaintArrays(t,i,c,h,p,g,w,T,A){let M=!1;const O=Object.keys(t),z=O.length!==0&&!T,U=z?O:i.uniqueIds;this.context.lut=p.lut;for(const V in this.binders){const H=this.binders[V];if(H.context=this.context,(H instanceof Dl||H instanceof Cs||H instanceof Ms)&&H.expression&&H.expression.kind&&H.expression.kind!=="constant"&&(H.expression.isStateDependent===!0||H.expression.isLightConstant===!1)){const re=p.paint.get(V);H.expression=re.value;for(const ne of U){const de=t[ne.toString()];i.eachPosition(ne,(ue,X,se)=>{const he=h.feature(ue);H.updatePaintArray(X,se,he,de,g,w,A)})}if(!z)for(const ne of c.uniqueIds){const de=t[ne.toString()];c.eachPosition(ne,(ue,X,se)=>{const he=h.feature(ue);H.updatePaintArray(X,se,he,de,g,w,A)})}M=!0}}return M}defines(){const t=[];for(const i in this.binders){const c=this.binders[i];(c instanceof tu||c instanceof ru)&&t.push(...c.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const c=this.binders[i];if(c instanceof Dl||c instanceof Cs||c instanceof Ms)for(let h=0;h<c.paintVertexAttributes.length;h++)t.push(c.paintVertexAttributes[h].name);if(c instanceof Ms)for(let h=0;h<Va.members.length;h++)t.push(Va.members[h].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const c=this.binders[i];if(c instanceof tu||c instanceof ru||c instanceof Cs)for(const h of c.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const i=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof tu||h instanceof ru||h instanceof Cs)for(const p of h.uniformNames)i.push({name:p,property:c,binding:h.getBinding(t,p)})}return i}setUniforms(t,i,c,h,p){for(const{name:g,property:w,binding:T}of c)this.binders[w].setUniform(t,T,p,h.get(w),g)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const i=this.binders[t];(i instanceof Dl||i instanceof Cs||i instanceof Ms)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof Ms&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(t){for(const i in this.binders){const c=this.binders[i];(c instanceof Dl||c instanceof Cs||c instanceof Ms)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof Dl||i instanceof Cs||i instanceof Ms)&&i.destroy()}}}class gc{constructor(t,i,c=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new kl(h,i,c);this.needsUpload=!1,this._featureMap=new Xu,this._featureMapWithoutIds=new Xu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,i,c,h,p,g,w,T){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(t,i,h,p,g,w,T);i.id!==void 0?this._featureMap.add(i.id,c,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,c,h,p,g,w){for(const T of c)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,i,T,h,p,g,w||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const d={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"]};function r(a,t){return d[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}const s={"line-pattern":{source:Ml,composite:Ml},"fill-pattern":{source:Ml,composite:Ml},"fill-extrusion-pattern":{source:Ml,composite:Ml},"line-dasharray":{source:Hu,composite:Hu}},f={color:{source:Qc,composite:Bo},number:{source:Wh,composite:Qc}};function _(a,t,i){const c=s[a];return c&&c[i]||f[t][i]}qt(tu,"ConstantBinder"),qt(ru,"PatternConstantBinder"),qt(Dl,"SourceExpressionBinder"),qt(Ms,"PatternCompositeBinder"),qt(Cs,"CompositeExpressionBinder"),qt(kl,"ProgramConfiguration",{omit:["_buffers"]}),qt(gc,"ProgramConfigurationSet");const x=zt/Math.PI/2,S=5,E=6,C=16383,R=64,F=[R,32,16],j=-x,B=x;function G(a,t,i,c=x){return i=Q(i),[a*Math.sin(i)*c,-t*c,a*Math.cos(i)*c]}function J(a,t,i){return G(Math.cos(Q(a)),Math.sin(Q(a)),t,i)}const Y=63710088e-1,te=2*Math.PI*Y;class K{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new K(Ye(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,c=this.lat*i,h=t.lat*i,p=Math.sin(c)*Math.sin(h)+Math.cos(c)*Math.cos(h)*Math.cos((t.lng-this.lng)*i);return Y*Math.acos(Math.min(p,1))}toBounds(t=0){const i=360*t/40075017,c=i/Math.cos(Math.PI/180*this.lat);return new ce({lng:this.lng-c,lat:this.lat-i},{lng:this.lng+c,lat:this.lat+i})}toEcef(t){return J(this.lat,this.lng,x+t*x/Y)}static convert(t){if(t instanceof K)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new K(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new K(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ce{constructor(t,i){if(t)if(i)this.setSouthWest(t).setNorthEast(i);else if(t.length===4){const c=t;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{const c=t;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(t){return this._ne=t instanceof K?new K(t.lng,t.lat):K.convert(t),this}setSouthWest(t){return this._sw=t instanceof K?new K(t.lng,t.lat):K.convert(t),this}extend(t){const i=this._sw,c=this._ne;let h,p;if(t instanceof K)h=t,p=t;else{if(!(t instanceof ce))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ce.convert(t)):this.extend(K.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(K.convert(t)):this;if(h=t._sw,p=t._ne,!h||!p)return this}return i||c?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),c.lng=Math.max(p.lng,c.lng),c.lat=Math.max(p.lat,c.lat)):(this._sw=new K(h.lng,h.lat),this._ne=new K(p.lng,p.lat)),this}getCenter(){return new K((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new K(this.getWest(),this.getNorth())}getSouthEast(){return new K(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:i,lat:c}=K.convert(t);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&h}static convert(t){if(t)return t instanceof ce?t:new ce(t)}}const fe=0,pe=25.5;function Ee(a){return te*Math.cos(a*Math.PI/180)}function Te(a){return(180+a)/360}function we(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function ye(a,t){return a/Ee(t)}function Ie(a){return 360*a-180}function Oe(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Xe(a,t){return a*Ee(Oe(t))}const je=85.051129;function st(a){return Math.cos(Q(Fe(a,-je,je)))}function ct(a,t){const i=Fe(t,fe,pe),c=Math.pow(2,i);return st(a)*te/(512*c)}function Et(a){return 1/Math.cos(a*Math.PI/180)}function Ve(a,t=0){const i=Math.exp(Math.PI*(1-(a.y+t/zt)/(1<<a.z)*2));return 80150034*i/(i*i+1)/zt/(1<<a.z)}class He{constructor(t,i,c=0){this.x=+t,this.y=+i,this.z=+c}static fromLngLat(t,i=0){const c=K.convert(t);return new He(Te(c.lng),we(c.lat),ye(i,c.lat))}toLngLat(){return new K(Ie(this.x),Oe(this.y))}toAltitude(){return Xe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/te*Et(Oe(this.y))}}function Ue(a,t,i,c,h,p,g,w,T){const A=(t+c)/2,M=(i+h)/2,O=new Dt(A,M);w(O),function(z,U,V,H,re,ne){const de=V-re,ue=H-ne;return Math.abs((H-U)*de-(V-z)*ue)/Math.hypot(de,ue)}(O.x,O.y,p.x,p.y,g.x,g.y)>=T?(Ue(a,t,i,A,M,p,O,w,T),Ue(a,A,M,c,h,O,g,w,T)):a.push(g)}function ft(a,t,i){let c=a[0],h=c.x,p=c.y;t(c);const g=[c];for(let w=1;w<a.length;w++){const T=a[w],{x:A,y:M}=T;t(T),Ue(g,h,p,A,M,c,T,t,i),h=A,p=M,c=T}return g}function Ke(a,t,i,c){if(c(t,i)){const h=t.add(i)._mult(.5);Ke(a,t,h,c),Ke(a,h,i,c)}else a.push(i)}function gt(a,t){let i=a[0];const c=[i];for(let h=1;h<a.length;h++){const p=a[h];Ke(c,i,p,t),i=p}return c}const dt=Math.pow(2,14)-1,vt=-dt-1;function bt(a,t){const i=Math.round(a.x*t),c=Math.round(a.y*t);return a.x=Fe(i,vt,dt),a.y=Fe(c,vt,dt),(i<a.x||i>a.x+1||c<a.y||c>a.y+1)&&tn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Yt(a,t,i){const c=a.loadGeometry(),h=a.extent,p=zt/h;if(t&&i&&i.projection.isReprojectedInTileSpace){const g=1<<t.z,{scale:w,x:T,y:A,projection:M}=i,O=z=>{const U=Ie((t.x+z.x/h)/g),V=Oe((t.y+z.y/h)/g),H=M.project(U,V);z.x=(H.x*w-T)*h,z.y=(H.y*w-A)*h};for(let z=0;z<c.length;z++)if(a.type!==1)c[z]=ft(c[z],O,1);else{const U=[];for(const V of c[z])V.x<0||V.x>=h||V.y<0||V.y>=h||(O(V),U.push(V));c[z]=U}}for(const g of c)for(const w of g)bt(w,p);return c}function tr(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?Yt(a):[]}}function Bt(a,t,i,c,h){a.emplaceBack(2*t+(c+1)/2,2*i+(h+1)/2)}function er(a,t,i){a.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Wt{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Cl,this.indexArray=new to,this.segments=new Si,this.programConfigurations=new gc(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(t,i){}populate(t,i,c,h){const p=this.layers[0],g=[];let w=null;p.type==="circle"&&(w=p.layout.get("circle-sort-key"));for(const{feature:A,id:M,index:O,sourceLayerIndex:z}of t){const U=this.layers[0]._featureFilter.needGeometry,V=tr(A,U);if(!this.layers[0]._featureFilter.filter(new $n(this.zoom),V,c))continue;const H=w?w.evaluate(V,{},c):void 0,re={id:M,properties:A.properties,type:A.type,sourceLayerIndex:z,index:O,geometry:U?V.geometry:Yt(A,c,h),patterns:{},sortKey:H};g.push(re)}w&&g.sort((A,M)=>A.sortKey-M.sortKey);let T=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Zu,T=h.projection);for(const A of g){const{geometry:M,index:O,sourceLayerIndex:z}=A,U=t[O].feature;this.addFeature(A,M,O,i.availableImages,c,T,i.brightness),i.featureIndex.insert(U,M,O,z,this.index)}}update(t,i,c,h,p,g,w){this.programConfigurations.updatePaintArrays(t,i,p,c,h,g,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,o_.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,ig.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,i,c,h,p,g,w){for(const T of i)for(const A of T){const M=A.x,O=A.y;if(M<0||M>=zt||O<0||O>=zt)continue;if(g){const V=g.projectTilePoint(M,O,p),H=g.upVector(p,M,O),re=this.globeExtVertexArray;er(re,V,H),er(re,V,H),er(re,V,H),er(re,V,H)}const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),U=z.vertexLength;Bt(this.layoutVertexArray,M,O,-1,-1),Bt(this.layoutVertexArray,M,O,1,-1),Bt(this.layoutVertexArray,M,O,1,1),Bt(this.layoutVertexArray,M,O,-1,1),this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+2,U+3),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},h,p,w)}}function hr(a,t){for(let i=0;i<a.length;i++)if(Wn(t,a[i]))return!0;for(let i=0;i<t.length;i++)if(Wn(a,t[i]))return!0;return!!qn(a,t)}function Or(a,t,i){return!!Wn(a,t)||!!Rr(t,a,i)}function rn(a,t){if(a.length===1)return yn(t,a[0]);for(let i=0;i<t.length;i++){const c=t[i];for(let h=0;h<c.length;h++)if(Wn(a,c[h]))return!0}for(let i=0;i<a.length;i++)if(yn(t,a[i]))return!0;for(let i=0;i<t.length;i++)if(qn(a,t[i]))return!0;return!1}function Gn(a,t,i){if(a.length>1){if(qn(a,t))return!0;for(let c=0;c<t.length;c++)if(Rr(t[c],a,i))return!0}for(let c=0;c<a.length;c++)if(Rr(a[c],t,i))return!0;return!1}function qn(a,t){if(a.length===0||t.length===0)return!1;for(let i=0;i<a.length-1;i++){const c=a[i],h=a[i+1];for(let p=0;p<t.length-1;p++)if(Hr(c,h,t[p],t[p+1]))return!0}return!1}function Hr(a,t,i,c){return Jn(a,i,c)!==Jn(t,i,c)&&Jn(a,t,i)!==Jn(a,t,c)}function Li(a,t,i){return(a.x-i.x)*(t.y-i.y)-(a.y-i.y)*(t.x-i.x)}function _i(a,t,i,c){const h=Li(a,t,c),p=Li(a,t,i);if(Math.sign(h)===Math.sign(p))return;const g=Li(i,c,a),w=g+p-h;return Math.sign(g)!==Math.sign(w)?[g/(g-w),p/(p-h)]:void 0}function Rr(a,t,i){const c=i*i;if(t.length===1)return a.distSqr(t[0])<c;for(let h=1;h<t.length;h++)if(_n(a,t[h-1],t[h])<c)return!0;return!1}function _n(a,t,i){const c=t.distSqr(i);if(c===0)return a.distSqr(t);const h=((a.x-t.x)*(i.x-t.x)+(a.y-t.y)*(i.y-t.y))/c;return a.distSqr(h<0?t:h>1?i:i.sub(t)._mult(h)._add(t))}function yn(a,t){let i,c,h,p=!1;for(let g=0;g<a.length;g++){i=a[g];for(let w=0,T=i.length-1;w<i.length;T=w++)c=i[w],h=i[T],c.y>t.y!=h.y>t.y&&t.x<(h.x-c.x)*(t.y-c.y)/(h.y-c.y)+c.x&&(p=!p)}return p}function Wn(a,t){let i=!1;for(let c=0,h=a.length-1;c<a.length;h=c++){const p=a[c],g=a[h];p.y>t.y!=g.y>t.y&&t.x<(g.x-p.x)*(t.y-p.y)/(g.y-p.y)+p.x&&(i=!i)}return i}function no(a,t,i,c,h){for(const g of a)if(t<=g.x&&i<=g.y&&c>=g.x&&h>=g.y)return!0;const p=[new Dt(t,i),new Dt(t,h),new Dt(c,h),new Dt(c,i)];if(a.length>2){for(const g of p)if(Wn(a,g))return!0}for(let g=0;g<a.length-1;g++)if(zi(a[g],a[g+1],p))return!0;return!1}function zi(a,t,i){const c=i[0],h=i[2];if(a.x<c.x&&t.x<c.x||a.x>h.x&&t.x>h.x||a.y<c.y&&t.y<c.y||a.y>h.y&&t.y>h.y)return!1;const p=Jn(a,t,i[0]);return p!==Jn(a,t,i[1])||p!==Jn(a,t,i[2])||p!==Jn(a,t,i[3])}function Gi(a,t,i,c,h,p){let g=t.y-a.y,w=a.x-t.x;if(p=p||0){const T=g*g+w*w;if(T===0)return!0;const A=Math.sqrt(T);g/=A,w/=A}return!((i.x-a.x)*g+(i.y-a.y)*w-p<0||(c.x-a.x)*g+(c.y-a.y)*w-p<0||(h.x-a.x)*g+(h.y-a.y)*w-p<0)}function Ti(a,t,i,c,h,p,g){return!(Gi(a,t,c,h,p,g)||Gi(t,i,c,h,p,g)||Gi(i,a,c,h,p,g)||Gi(c,h,a,t,i,g)||Gi(h,p,a,t,i,g)||Gi(p,c,a,t,i,g))}function Zr(a,t,i){const c=t.paint.get(a).value;return c.kind==="constant"?c.value:i.programConfigurations.get(t.id).getMaxValue(a)}function di(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function In(a,t,i,c,h){if(!t[0]&&!t[1])return a;const p=Dt.convert(t)._mult(h);i==="viewport"&&p._rotate(-c);const g=[];for(let w=0;w<a.length;w++)g.push(a[w].sub(p));return g}function Yn(a,t,i,c){const h=Dt.convert(a)._mult(c);return t==="viewport"&&h._rotate(-i),h}let Fn,ri;function To(a,t,i){var c=2*Math.PI*6378137/256/Math.pow(2,i);return[a*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}qt(Wt,"CircleBucket",{omit:["layers"]});class fn{constructor(t,i,c){this.z=t,this.x=i,this.y=c,this.key=Qo(0,t,t,i,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i){const c=function(p,g,w){var T=To(256*p,256*(g=Math.pow(2,w)-g-1),w),A=To(256*(p+1),256*(g+1),w);return T[0]+","+T[1]+","+A[0]+","+A[1]}(this.x,this.y,this.z),h=function(p,g,w){let T,A="";for(let M=p;M>0;M--)T=1<<M-1,A+=(g&T?1:0)+(w&T?2:0);return A}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jo{constructor(t,i){this.wrap=t,this.canonical=i,this.key=Qo(t,i.z,i.z,i.x,i.y)}}class Zi{constructor(t,i,c,h,p){this.overscaledZ=t,this.wrap=i,this.canonical=new fn(c,+h,+p),this.key=i===0&&t===c?this.canonical.key:Qo(i,t,c,h,p)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const i=this.canonical.z-t;return t>this.canonical.z?new Zi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zi(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i=!0){if(this.overscaledZ===t&&i)return this.key;if(t>this.canonical.z)return Qo(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-t;return Qo(this.wrap*+i,t,t,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new Zi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,c=2*this.canonical.x,h=2*this.canonical.y;return[new Zi(i,this.wrap,i,c,h),new Zi(i,this.wrap,i,c+1,h),new Zi(i,this.wrap,i,c,h+1),new Zi(i,this.wrap,i,c+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Zi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Zi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jo(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Qo(a,t,i,c,h){const p=1<<Math.min(i,22);let g=p*(h%p)+c%p;return a&&i<22&&(g+=p*p*((a<0?-2*a-1:2*a)%(1<<2*(22-i)))),16*(32*g+i)+(t-i)}const Qs=[a=>{let t=a.canonical.x-1,i=a.wrap;return t<0&&(t=(1<<a.canonical.z)-1,i--),new Zi(a.overscaledZ,i,a.canonical.z,t,a.canonical.y)},a=>{let t=a.canonical.x+1,i=a.wrap;return t===1<<a.canonical.z&&(t=0,i++),new Zi(a.overscaledZ,i,a.canonical.z,t,a.canonical.y)},a=>new Zi(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new Zi(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];qt(fn,"CanonicalTileID"),qt(Zi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Rl=On([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:za}=Rl,Os=On([{name:"a_pos_3",components:3,type:"Int16"}]);var Mo=On([{name:"a_pos",type:"Int16",components:2}]);class Ds{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,c){const h=Fr(i,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1])/h;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,!0}}class el{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,c){const h=kr(i,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/h;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,c[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(t,i,c){if(function(U,V){var H=U[0],re=U[1],ne=U[2],de=V[0],ue=V[1],X=V[2];return Math.abs(H-de)<=D*Math.max(1,Math.abs(H),Math.abs(de))&&Math.abs(re-ue)<=D*Math.max(1,Math.abs(re),Math.abs(ue))&&Math.abs(ne-X)<=D*Math.max(1,Math.abs(ne),Math.abs(X))}(this.pos,t)||i===0)return c[0]=c[1]=c[2]=0,!1;const[h,p,g]=this.dir,w=this.pos[0]-t[0],T=this.pos[1]-t[1],A=this.pos[2]-t[2],M=h*h+p*p+g*g,O=2*(w*h+T*p+A*g),z=O*O-4*M*(w*w+T*T+A*A-i*i);if(z<0){const U=Math.max(-O/2,0),V=w+h*U,H=T+p*U,re=A+g*U,ne=Math.hypot(V,H,re);return c[0]=V*i/ne,c[1]=H*i/ne,c[2]=re*i/ne,!1}{const U=(-O-Math.sqrt(z))/(2*M);if(U<0){const V=Math.hypot(w,T,A);return c[0]=w*i/V,c[1]=T*i/V,c[2]=A*i/V,!1}return c[0]=w+h*U,c[1]=T+p*U,c[2]=A+g*U,!0}}}class ds{constructor(t,i,c,h,p){this.TL=t,this.TR=i,this.BR=c,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(t,i,c){const h=[-1,1,1],p=[1,1,1],g=[1,-1,1],w=[-1,-1,1],T=Nt(h,h,t),A=Nt(p,p,t),M=Nt(g,g,t),O=Nt(w,w,t);return new ds(T,A,M,O,i/c)}}function Ll(a,t,i){let c=1/0,h=-1/0;const p=[];for(const g of a){We(p,g,t);const w=kr(p,i);c=Math.min(c,w),h=Math.max(h,w)}return[c,h]}function zl(a,t){let i=!0;for(let c=0;c<a.planes.length;c++){const h=a.planes[c];let p=0;for(let g=0;g<t.length;g++)p+=kr(h,t[g])+h[3]>=0;if(p===0)return 0;p!==t.length&&(i=!1)}return i?2:1}function Yu(a,t){for(const i of a.projections){const c=Ll(t,a.points[0],i.axis);if(i.projection[1]<c[0]||i.projection[0]>c[1])return 0}return 1}function Jh(a,t){let i=0;const c=[0,0,0,0];for(let g=0;g<a.length;g++)c[0]=a[g][0],c[1]=a[g][1],c[2]=a[g][2],c[3]=1,(h=c)[0]*(p=t)[0]+h[1]*p[1]+h[2]*p[2]+h[3]*p[3]>=0&&i++;var h,p;return i}class Ku{constructor(t,i){this.points=t||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=yi.fromPoints(this.points),this.projections=[],this.frustumEdges=[We([],this.points[2],this.points[3]),We([],this.points[0],this.points[3]),We([],this.points[4],this.points[0]),We([],this.points[5],this.points[1]),We([],this.points[6],this.points[2]),We([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const h=[0,-c[2],c[1]],p=[c[2],0,-c[0]];this.projections.push({axis:h,projection:Ll(this.points,this.points[0],h)}),this.projections.push({axis:p,projection:Ll(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(t,i,c,h){const p=Math.pow(2,c),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const M=Oi([],A,t),O=1/M[3]/i*p;return(z=M)[0]=(U=M)[0]*(V=[O,O,h?1/M[3]:O,O])[0],z[1]=U[1]*V[1],z[2]=U[2]*V[2],z[3]=U[3]*V[3],z;var z,U,V}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const M=Sr([],Vr([],We([],g[A[0]],g[A[1]]),We([],g[A[2]],g[A[1]]))),O=-kr(M,g[A[1]]);return M.concat(O)}),T=[];for(let A=0;A<g.length;A++)T.push([g[A][0],g[A][1],g[A][2]]);return new Ku(T,w)}intersectsPrecise(t,i,c){for(let h=0;h<i.length;h++)if(!Jh(t,i[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!Jh(t,this.planes[h]))return 0;for(const h of c)for(const p of this.frustumEdges){const g=Vr([],h,p),w=Dr(g);if(w===0)continue;Ft(g,g,1/w);const T=Ll(this.points,this.points[0],g),A=Ll(t,this.points[0],g);if(T[0]>A[1]||A[0]>T[1])return 0}return 1}containsPoint(t){for(const i of this.planes){const c=i[3];if(kr([i[0],i[1],i[2]],t)+c<0)return!1}return!0}}class yi{static fromPoints(t){const i=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const h of t)lr(i,i,h),br(c,c,h);return new yi(i,c)}static fromTileIdAndHeight(t,i,c){const h=1<<t.canonical.z,p=t.canonical.x,g=t.canonical.y;return new yi([p/h,g/h,i],[(p+1)/h,(g+1)/h,c])}static applyTransform(t,i){const c=t.getCorners();for(let h=0;h<c.length;++h)Nt(c[h],c[h],i);return yi.fromPoints(c)}static applyTransformFast(t,i){const c=[i[12],i[13],i[14]],h=[...c];for(let p=0;p<3;p++)for(let g=0;g<3;g++){const w=i[4*g+p],T=w*t.min[g],A=w*t.max[g];c[p]+=Math.min(T,A),h[p]+=Math.max(T,A)}return new yi(c,h)}static projectAabbCorners(t,i){const c=t.getCorners();for(let h=0;h<c.length;++h)Nt(c[h],c[h],i);return c}constructor(t,i){this.min=t,this.max=i,this.center=Ft([],Ar([],this.min,this.max),.5)}quadrant(t){const i=[t%2==0,t<2],c=dr(this.min),h=dr(this.max);for(let p=0;p<i.length;p++)c[p]=i[p]?this.min[p]:this.center[p],h[p]=i[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new yi(c,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,i=this.max;return[[t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],[t[0],t[1],i[2]],[i[0],t[1],i[2]],[i[0],i[1],i[2]],[t[0],i[1],i[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?zl(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?zl(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,i){return i||this.intersects(t)?Yu(t,this.getCorners()):0}intersectsPreciseFlat(t,i){return i||this.intersectsFlat(t)?Yu(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let i=0;i<3;++i)if(this.min[i]>t.max[i]||t.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t.min[i]),this.max[i]=Math.max(this.max[i],t.max[i])}encapsulatePoint(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t[i]),this.max[i]=Math.max(this.max[i],t[i])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}function nu(a){return a*x/Y}qt(yi,"Aabb");const im=[new yi([j,j,j],[B,B,B]),new yi([j,j,j],[0,0,B]),new yi([0,j,j],[B,0,B]),new yi([j,0,j],[0,B,B]),new yi([0,0,j],[B,B,B])];function s_(a,t,i,c=!0){const h=Ft([],a._camera.position,a.worldSize),p=[t,i,1,1];Oi(p,p,a.pixelMatrixInverse),en(p,p,1/p[3]);const g=Sr([],We([],p,h)),w=a.globeMatrix,T=[w[12],w[13],w[14]],A=We([],T,h),M=Dr(A),O=Sr([],A),z=a.worldSize/(2*Math.PI),U=kr(O,g),V=Math.asin(z/M);if(V<Math.acos(U)){if(!c)return null;const Ne=[],$e=[];Ft(Ne,g,M/U),Sr($e,We($e,Ne,A)),Sr(g,Ar(g,A,Ft(g,$e,Math.tan(V)*M)))}const H=[];new el(h,g).closestPointOnSphere(T,z,H);const re=Sr([],fo(w,0)),ne=Sr([],fo(w,1)),de=Sr([],fo(w,2)),ue=kr(re,H),X=kr(ne,H),se=kr(de,H),he=ae(Math.asin(-X/z));let _e=ae(Math.atan2(ue,se));_e=a.center.lng+function(Ne,$e){const at=($e-Ne+180)%360-180;return at<-180?at+360:at}(a.center.lng,_e);const Ce=Te(_e),Re=Fe(we(he),0,1);return new He(Ce,Re)}class Ny{constructor(t,i,c){this.a=We([],t,c),this.b=We([],i,c),this.center=c;const h=Sr([],this.a),p=Sr([],this.b);this.angle=Math.acos(kr(h,p))}}function tp(a,t){if(a.angle===0)return null;let i;return i=a.a[t]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[t]/a.a[t]/Math.sin(a.angle)-1/Math.tan(a.angle)),i<0||i>1?null:function(c,h,p,g){const w=Math.sin(p);return c*(Math.sin((1-g)*p)/w)+h*(Math.sin(g*p)/w)}(a.a[t],a.b[t],a.angle,Fe(i,0,1))+a.center[t]}function tl(a){if(a.z<=1)return im[a.z+2*a.y+a.x];const t=am(om(a));return yi.fromPoints(t)}function iu(a,t,i){return Ft(a,a,1-i),ot(a,a,t,i)}function ag(a,t,i){for(const c of a)Nt(c,c,t),Ft(c,c,i)}function By(a,t,i,c){const h=t/a.worldSize,p=a.globeMatrix;if(i.z<=1){const Re=tl(i).getCorners();return ag(Re,p,h),yi.fromPoints(Re)}const g=om(i,c),w=am(g,x+nu(a._tileCoverLift));ag(w,p,h);const T=Number.MAX_VALUE,A=[-T,-T,-T],M=[T,T,T];if(g.contains(a.center)){for(const $e of w)lr(M,M,$e),br(A,A,$e);A[2]=0;const Re=a.point,Ne=[Re.x*h,Re.y*h,0];return lr(M,M,Ne),br(A,A,Ne),new yi(M,A)}if(a._tileCoverLift>0){for(const Re of w)lr(M,M,Re),br(A,A,Re);return new yi(M,A)}const O=[p[12]*h,p[13]*h,p[14]*h],z=g.getCenter(),U=Fe(a.center.lat,-je,je),V=Fe(z.lat,-je,je),H=Te(a.center.lng),re=we(U);let ne=H-Te(z.lng);const de=re-we(V);ne>.5?ne-=1:ne<-.5&&(ne+=1);let ue=0;Math.abs(ne)>Math.abs(de)?ue=ne>=0?1:3:(ue=de>=0?0:2,ot(O,O,[p[4]*h,p[5]*h,p[6]*h],-Math.sin(Q(de>=0?g.getSouth():g.getNorth()))*x));const X=w[ue],se=w[(ue+1)%4],he=new Ny(X,se,O),_e=[tp(he,0)||X[0],tp(he,1)||X[1],tp(he,2)||X[2]],Ce=ed(a.zoom);if(Ce>0){const Re=function({x:$e,y:at,z:xt},mt,yt,At,tt){const _t=1/(1<<xt);let Je=$e*_t,it=Je+_t,Pt=at*_t,Mt=Pt+_t,sr=0;const Qt=(Je+it)/2-At;return Qt>.5?sr=-1:Qt<-.5&&(sr=1),Je=((Je+sr)*mt-(At*=mt))*yt+At,it=((it+sr)*mt-At)*yt+At,Pt=(Pt*mt-(tt*=mt))*yt+tt,Mt=(Mt*mt-tt)*yt+tt,[[Je,Mt,0],[it,Mt,0],[it,Pt,0],[Je,Pt,0]]}(i,t,a._pixelsPerMercatorPixel,H,re);for(let $e=0;$e<w.length;$e++)iu(w[$e],Re[$e],Ce);const Ne=Ar([],Re[ue],Re[(ue+1)%4]);Ft(Ne,Ne,.5),iu(_e,Ne,Ce)}for(const Re of w)lr(M,M,Re),br(A,A,Re);return M[2]=Math.min(X[2],se[2]),lr(M,M,_e),br(A,A,_e),new yi(M,A)}function om({x:a,y:t,z:i},c=!1){const h=1/(1<<i),p=new K(Ie(a*h),t===(1<<i)-1&&c?-90:Oe((t+1)*h)),g=new K(Ie((a+1)*h),t===0&&c?90:Oe(t*h));return new ce(p,g)}function am(a,t=x){const i=Q(a.getNorth()),c=Q(a.getSouth()),h=Math.cos(i),p=Math.cos(c),g=Math.sin(i),w=Math.sin(c),T=a.getWest(),A=a.getEast();return[G(p,w,T,t),G(p,w,A,t),G(h,g,A,t),G(h,g,T,t)]}function Qh(a,t,i,c){const h=1<<i.z,p=(a/zt+i.x)/h;return J(Oe((t/zt+i.y)/h),Ie(p),c)}function rp({min:a,max:t}){return C/Math.max(t[0]-a[0],t[1]-a[1],t[2]-a[2])}const sm=new Float64Array(16);function lm(a){const t=rp(a),i=pt(sm,[t,t,t]);return ge(i,i,gn([],a.min))}function l_(a){const t=(c=a.min,(i=sm)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=c[0],i[13]=c[1],i[14]=c[2],i[15]=1,i);var i,c;const h=1/rp(a);return ke(t,t,[h,h,h])}function np(a){const t=zt/(2*Math.PI);return a/(2*Math.PI)/t}function jy(a,t){return zt/(512*Math.pow(2,a))*rp(tl(t))}function ip(a,t,i,c,h){const p=np(i),g=[a,t,-i/(2*Math.PI)],w=oe(new Float64Array(16));return ge(w,w,g),ke(w,w,[p,p,p]),et(w,w,Q(-h)),ze(w,w,Q(-c)),w}function ed(a){return Be(S,E,a)}function cm(a,t){const i=J(t.lat,t.lng),c=function(V){const H=J(V._center.lat,V._center.lng);let re=Vr([],vr(0,1,0),H);const ne=Gt([],-V.angle,H);re=Nt(re,re,ne),Gt(ne,-V._pitch,re);const de=Sr([],H);return Ft(de,de,nu(V.cameraToCenterDistance/V.pixelsPerMeter)),Nt(de,de,ne),Ar([],H,de)}(a);return g=(h=zr([],c,i))[0],w=h[1],T=h[2],A=(p=i)[0],M=p[1],O=p[2],U=(z=Math.sqrt(g*g+w*w+T*T)*Math.sqrt(A*A+M*M+O*O))&&kr(h,p)/z,Math.acos(Math.min(Math.max(U,-1),1));var h,p,g,w,T,A,M,O,z,U}function m(a,t){return cm(a,t)>Math.PI/2*1.01}const v=Q(85),P=Math.cos(v),N=Math.sin(v),W=ie(),ee=a=>{const t=[];return a.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function be(a,t,i,c,h,p,g,w,T){if(p&&a.queryGeometry.isAboveHorizon)return!1;p&&(T*=a.pixelToTileUnitsFactor);const A=a.tileID.canonical,M=i.projection.upVectorScale(A,i.center.lat,i.worldSize).metersToTile;for(const O of t)for(const z of O){const U=z.add(w),V=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(U.x,U.y,!0):0,H=i.projection.projectTilePoint(U.x,U.y,A);if(V>0){const ue=i.projection.upVector(A,U.x,U.y);H.x+=ue[0]*M*V,H.y+=ue[1]*M*V,H.z+=ue[2]*M*V}const re=p?U:Ge(H.x,H.y,H.z,c),ne=p?a.tilespaceRays.map(ue=>pr(ue,V)):a.queryGeometry.screenGeometry,de=Oi([],[H.x,H.y,H.z,1],c);if(!g&&p?T*=de[3]/i.cameraToCenterDistance:g&&!p&&(T*=i.cameraToCenterDistance/de[3]),p){const ue=Oe((z.y/zt+A.y)/(1<<A.z));T/=i.projection.pixelsPerMeter(ue,1)/ye(1,ue)}if(Or(ne,re,T))return!0}return!1}function Ge(a,t,i,c){const h=Oi([],[a,t,i,1],c);return new Dt(h[0]/h[3],h[1]/h[3])}const rt=vr(0,0,0),kt=vr(0,0,1);function pr(a,t){const i=Zt();return rt[2]=t,a.intersectsPlane(rt,kt,i),new Dt(i[0],i[1])}class yr extends Wt{}let cr,$r,nn,ln;function Uo(a,{width:t,height:i},c,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*i*c)throw new RangeError("mismatched image size")}else h=new Uint8Array(t*i*c);return a.width=t,a.height=i,a.data=h,a}function wt(a,t,i){const{width:c,height:h}=t;c===a.width&&h===a.height||(ut(a,t,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,c),height:Math.min(a.height,h)},i,null),a.width=c,a.height=h,a.data=t.data)}function ut(a,t,i,c,h,p,g,w){if(h.width===0||h.height===0)return t;if(h.width>a.width||h.height>a.height||i.x>a.width-h.width||i.y>a.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||c.x>t.width-h.width||c.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const T=a.data,A=t.data,M=p===4&&w;for(let O=0;O<h.height;O++){const z=((i.y+O)*a.width+i.x)*p,U=((c.y+O)*t.width+c.x)*p;if(M)for(let V=0;V<h.width;V++){const H=z+V*p+3,re=U+V*p;A[re+0]=255,A[re+1]=255,A[re+2]=255,A[re+3]=T[H]}else if(g)for(let V=0;V<h.width;V++){const H=z+V*p,re=U+V*p,ne=T[H+3],de=new dn(T[H+0]/255*ne,T[H+1]/255*ne,T[H+2]/255*ne,ne).toRenderColor(g).toArray();A[re+0]=de[0],A[re+1]=de[1],A[re+2]=de[2],A[re+3]=de[3]}else for(let V=0;V<h.width*p;V++)A[U+V]=T[z+V]}return t}qt(yr,"HeatmapBucket",{omit:["layers"]});class Tt{constructor(t,i){Uo(this,t,1,i)}resize(t){wt(this,new Tt(t),1)}clone(){return new Tt({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,c,h,p){ut(t,i,c,h,p,1,null)}}class ar{constructor(t,i){Uo(this,t,4,i)}resize(t){wt(this,new ar(t),4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new ar({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,c,h,p,g,w){ut(t,i,c,h,p,4,g,w)}}class pn{constructor(t,i){this.width=t.width,this.height=t.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function En(a){const t={},i=a.resolution||256,c=a.clips?a.clips.length:1,h=a.image||new ar({width:i,height:c}),p=(g,w,T)=>{t[a.evaluationKey]=T;const A=a.expression.evaluate(t);A&&(h.data[g+w+0]=Math.floor(255*A.r/A.a),h.data[g+w+1]=Math.floor(255*A.g/A.a),h.data[g+w+2]=Math.floor(255*A.b/A.a),h.data[g+w+3]=Math.floor(255*A.a))};if(a.clips)for(let g=0,w=0;g<c;++g,w+=4*i)for(let T=0,A=0;T<i;T++,A+=4){const M=T/(i-1),{start:O,end:z}=a.clips[g];p(w,A,O*(1-M)+z*M)}else for(let g=0,w=0;g<i;g++,w+=4)p(0,w,g/(i-1));return h}qt(Tt,"AlphaImage"),qt(ar,"RGBAImage");const Dn=On([{name:"a_pos",components:2,type:"Int16"}],4),Un=On([{name:"a_road_z_offset",components:1,type:"Float32"}],4),wa=On([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Vi=On([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Fl(a,t,i=2){const c=t&&t.length,h=c?t[0]*i:a.length;let p=Uy(a,0,h,i,!0);const g=[];if(!p||p.next===p.prev)return g;let w,T,A;if(c&&(p=function(M,O,z,U){const V=[];for(let H=0,re=O.length;H<re;H++){const ne=Uy(M,O[H]*U,H<re-1?O[H+1]*U:M.length,U,!1);ne===ne.next&&(ne.steiner=!0),V.push(mF(ne))}V.sort(dF);for(let H=0;H<V.length;H++)z=fF(V[H],z);return z}(a,t,p,i)),a.length>80*i){w=1/0,T=1/0;let M=-1/0,O=-1/0;for(let z=i;z<h;z+=i){const U=a[z],V=a[z+1];U<w&&(w=U),V<T&&(T=V),U>M&&(M=U),V>O&&(O=V)}A=Math.max(M-w,O-T),A=A!==0?32767/A:0}return c_(p,g,i,w,T,A,0),g}function Uy(a,t,i,c,h){let p;if(h===function(g,w,T,A){let M=0;for(let O=w,z=T-A;O<T;O+=A)M+=(g[z]-g[O])*(g[O+1]+g[z+1]),z=O;return M}(a,t,i,c)>0)for(let g=t;g<i;g+=c)p=KE(g/c|0,a[g],a[g+1],p);else for(let g=i-c;g>=t;g-=c)p=KE(g/c|0,a[g],a[g+1],p);return p&&sg(p,p.next)&&(d_(p),p=p.next),p}function um(a,t){if(!a)return a;t||(t=a);let i,c=a;do if(i=!1,c.steiner||!sg(c,c.next)&&ea(c.prev,c,c.next)!==0)c=c.next;else{if(d_(c),c=t=c.prev,c===c.next)break;i=!0}while(i||c!==t);return t}function c_(a,t,i,c,h,p,g){if(!a)return;!g&&p&&function(T,A,M,O){let z=T;do z.z===0&&(z.z=Dx(z.x,z.y,A,M,O)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==T);z.prevZ.nextZ=null,z.prevZ=null,function(U){let V,H=1;do{let re,ne=U;U=null;let de=null;for(V=0;ne;){V++;let ue=ne,X=0;for(let he=0;he<H&&(X++,ue=ue.nextZ,ue);he++);let se=H;for(;X>0||se>0&&ue;)X!==0&&(se===0||!ue||ne.z<=ue.z)?(re=ne,ne=ne.nextZ,X--):(re=ue,ue=ue.nextZ,se--),de?de.nextZ=re:U=re,re.prevZ=de,de=re;ne=ue}de.nextZ=null,H*=2}while(V>1)}(z)}(a,c,h,p);let w=a;for(;a.prev!==a.next;){const T=a.prev,A=a.next;if(p?cF(a,c,h,p):lF(a))t.push(T.i,a.i,A.i),d_(a),a=A.next,w=A.next;else if((a=A)===w){g?g===1?c_(a=uF(um(a),t),t,i,c,h,p,2):g===2&&hF(a,t,i,c,h,p):c_(um(a),t,i,c,h,p,1);break}}}function lF(a){const t=a.prev,i=a,c=a.next;if(ea(t,i,c)>=0)return!1;const h=t.x,p=i.x,g=c.x,w=t.y,T=i.y,A=c.y,M=Math.min(h,p,g),O=Math.min(w,T,A),z=Math.max(h,p,g),U=Math.max(w,T,A);let V=c.next;for(;V!==t;){if(V.x>=M&&V.x<=z&&V.y>=O&&V.y<=U&&u_(h,w,p,T,g,A,V.x,V.y)&&ea(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function cF(a,t,i,c){const h=a.prev,p=a,g=a.next;if(ea(h,p,g)>=0)return!1;const w=h.x,T=p.x,A=g.x,M=h.y,O=p.y,z=g.y,U=Math.min(w,T,A),V=Math.min(M,O,z),H=Math.max(w,T,A),re=Math.max(M,O,z),ne=Dx(U,V,t,i,c),de=Dx(H,re,t,i,c);let ue=a.prevZ,X=a.nextZ;for(;ue&&ue.z>=ne&&X&&X.z<=de;){if(ue.x>=U&&ue.x<=H&&ue.y>=V&&ue.y<=re&&ue!==h&&ue!==g&&u_(w,M,T,O,A,z,ue.x,ue.y)&&ea(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,X.x>=U&&X.x<=H&&X.y>=V&&X.y<=re&&X!==h&&X!==g&&u_(w,M,T,O,A,z,X.x,X.y)&&ea(X.prev,X,X.next)>=0))return!1;X=X.nextZ}for(;ue&&ue.z>=ne;){if(ue.x>=U&&ue.x<=H&&ue.y>=V&&ue.y<=re&&ue!==h&&ue!==g&&u_(w,M,T,O,A,z,ue.x,ue.y)&&ea(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;X&&X.z<=de;){if(X.x>=U&&X.x<=H&&X.y>=V&&X.y<=re&&X!==h&&X!==g&&u_(w,M,T,O,A,z,X.x,X.y)&&ea(X.prev,X,X.next)>=0)return!1;X=X.nextZ}return!0}function uF(a,t){let i=a;do{const c=i.prev,h=i.next.next;!sg(c,h)&&XE(c,i,i.next,h)&&h_(c,h)&&h_(h,c)&&(t.push(c.i,i.i,h.i),d_(i),d_(i.next),i=a=h),i=i.next}while(i!==a);return um(i)}function hF(a,t,i,c,h,p){let g=a;do{let w=g.next.next;for(;w!==g.prev;){if(g.i!==w.i&&gF(g,w)){let T=YE(g,w);return g=um(g,g.next),T=um(T,T.next),c_(g,t,i,c,h,p,0),void c_(T,t,i,c,h,p,0)}w=w.next}g=g.next}while(g!==a)}function dF(a,t){let i=a.x-t.x;return i===0&&(i=a.y-t.y,i===0)&&(i=(a.next.y-a.y)/(a.next.x-a.x)-(t.next.y-t.y)/(t.next.x-t.x)),i}function fF(a,t){const i=function(h,p){let g=p;const w=h.x,T=h.y;let A,M=-1/0;if(sg(h,g))return g;do{if(sg(h,g.next))return g.next;if(T<=g.y&&T>=g.next.y&&g.next.y!==g.y){const H=g.x+(T-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(H<=w&&H>M&&(M=H,A=g.x<g.next.x?g:g.next,H===w))return A}g=g.next}while(g!==p);if(!A)return null;const O=A,z=A.x,U=A.y;let V=1/0;g=A;do{if(w>=g.x&&g.x>=z&&w!==g.x&&ZE(T<U?w:M,T,z,U,T<U?M:w,T,g.x,g.y)){const H=Math.abs(T-g.y)/(w-g.x);h_(g,h)&&(H<V||H===V&&(g.x>A.x||g.x===A.x&&pF(A,g)))&&(A=g,V=H)}g=g.next}while(g!==O);return A}(a,t);if(!i)return t;const c=YE(i,a);return um(c,c.next),um(i,i.next)}function pF(a,t){return ea(a.prev,a,t.prev)<0&&ea(t.next,a,a.next)<0}function Dx(a,t,i,c,h){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-i)*h|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function mF(a){let t=a,i=a;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==a);return i}function ZE(a,t,i,c,h,p,g,w){return(h-g)*(t-w)>=(a-g)*(p-w)&&(a-g)*(c-w)>=(i-g)*(t-w)&&(i-g)*(p-w)>=(h-g)*(c-w)}function u_(a,t,i,c,h,p,g,w){return!(a===g&&t===w)&&ZE(a,t,i,c,h,p,g,w)}function gF(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!function(i,c){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==c.i&&h.next.i!==c.i&&XE(h,h.next,i,c))return!0;h=h.next}while(h!==i);return!1}(a,t)&&(h_(a,t)&&h_(t,a)&&function(i,c){let h=i,p=!1;const g=(i.x+c.x)/2,w=(i.y+c.y)/2;do h.y>w!=h.next.y>w&&h.next.y!==h.y&&g<(h.next.x-h.x)*(w-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==i);return p}(a,t)&&(ea(a.prev,a,t.prev)||ea(a,t.prev,t))||sg(a,t)&&ea(a.prev,a,a.next)>0&&ea(t.prev,t,t.next)>0)}function ea(a,t,i){return(t.y-a.y)*(i.x-t.x)-(t.x-a.x)*(i.y-t.y)}function sg(a,t){return a.x===t.x&&a.y===t.y}function XE(a,t,i,c){const h=$y(ea(a,t,i)),p=$y(ea(a,t,c)),g=$y(ea(i,c,a)),w=$y(ea(i,c,t));return h!==p&&g!==w||!(h!==0||!Vy(a,i,t))||!(p!==0||!Vy(a,c,t))||!(g!==0||!Vy(i,a,c))||!(w!==0||!Vy(i,t,c))}function Vy(a,t,i){return t.x<=Math.max(a.x,i.x)&&t.x>=Math.min(a.x,i.x)&&t.y<=Math.max(a.y,i.y)&&t.y>=Math.min(a.y,i.y)}function $y(a){return a>0?1:a<0?-1:0}function h_(a,t){return ea(a.prev,a,a.next)<0?ea(a,t,a.next)>=0&&ea(a,a.prev,t)>=0:ea(a,t,a.prev)<0||ea(a,a.next,t)<0}function YE(a,t){const i=kx(a.i,a.x,a.y),c=kx(t.i,t.x,t.y),h=a.next,p=t.prev;return a.next=t,t.prev=a,i.next=h,h.prev=i,c.next=i,i.prev=c,p.next=c,c.prev=p,c}function KE(a,t,i,c){const h=kx(a,t,i);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function d_(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function kx(a,t,i){return{i:a,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Gy(a,t){const i=a.length;if(i<=1)return[a];const c=[];let h,p;for(let g=0;g<i;g++){const w=Rn(a[g]);w!==0&&(a[g].area=Math.abs(w),p===void 0&&(p=w<0),p===w<0?(h&&c.push(h),h=[a[g]]):h.push(a[g]))}if(h&&c.push(h),t>1)for(let g=0;g<c.length;g++)c[g].length<=t||(Ql(c[g],t,1,c[g].length-1,_F),c[g]=c[g].slice(0,t));return c}function _F(a,t){return t.area-a.area}function JE(a,t,i=1){if(!a)return null;const c=typeof a=="string"?Ma.from(a).getPrimary():a.getPrimary(),h=typeof a=="string"?null:a.getSecondary();for(const p of[c,h]){if(!p)continue;const g=p.id.toString();t.has(g)||t.set(g,[]),p.scaleSelf(i),t.get(g).push(p)}return{primary:c.toString(),secondary:h?h.toString():null}}function Rx(a,t,i,c){const h=c.patternDependencies;let p=!1;for(const g of t){const w=g.paint.get(`${a}-pattern`);w.isConstant()||(p=!0),JE(w.constantOr(null),h,i)&&(p=!0)}return p}function Lx(a,t,i,c,h,p){const g=p.patternDependencies;for(const w of t){const T=w.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let A=T.evaluate({zoom:c},i,{},p.availableImages);A=A&&A.name?A.name:A;const M=JE(A,g,h);if(!M)continue;const{primary:O,secondary:z}=M;O&&(i.patterns[w.id]=[O,z].filter(Boolean))}}return i}var zx,QE,Fx,e2,Nx,t2,r2,qy={};function n2(){if(QE)return zx;QE=1;var a=ki();function t(h,p,g,w,T){this.properties={},this.extent=g,this.type=0,this._pbf=h,this._geometry=-1,this._keys=w,this._values=T,h.readFields(i,this,p)}function i(h,p,g){h==1?p.id=g.readVarint():h==2?function(w,T){for(var A=w.readVarint()+w.pos;w.pos<A;){var M=T._keys[w.readVarint()],O=T._values[w.readVarint()];T.properties[M]=O}}(g,p):h==3?p.type=g.readVarint():h==4&&(p._geometry=g.pos)}function c(h){for(var p,g,w=0,T=0,A=h.length,M=A-1;T<A;M=T++)w+=((g=h[M]).x-(p=h[T]).x)*(p.y+g.y);return w}return zx=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var p,g=h.readVarint()+h.pos,w=1,T=0,A=0,M=0,O=[];h.pos<g;){if(T<=0){var z=h.readVarint();w=7&z,T=z>>3}if(T--,w===1||w===2)A+=h.readSVarint(),M+=h.readSVarint(),w===1&&(p&&O.push(p),p=[]),p.push(new a(A,M));else{if(w!==7)throw new Error("unknown command "+w);p&&p.push(p[0].clone())}}return p&&O.push(p),O},t.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var p=h.readVarint()+h.pos,g=1,w=0,T=0,A=0,M=1/0,O=-1/0,z=1/0,U=-1/0;h.pos<p;){if(w<=0){var V=h.readVarint();g=7&V,w=V>>3}if(w--,g===1||g===2)(T+=h.readSVarint())<M&&(M=T),T>O&&(O=T),(A+=h.readSVarint())<z&&(z=A),A>U&&(U=A);else if(g!==7)throw new Error("unknown command "+g)}return[M,z,O,U]},t.prototype.toGeoJSON=function(h,p,g){var w,T,A=this.extent*Math.pow(2,g),M=this.extent*h,O=this.extent*p,z=this.loadGeometry(),U=t.types[this.type];function V(ne){for(var de=0;de<ne.length;de++){var ue=ne[de];ne[de]=[360*(ue.x+M)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(ue.y+O)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var H=[];for(w=0;w<z.length;w++)H[w]=z[w][0];V(z=H);break;case 2:for(w=0;w<z.length;w++)V(z[w]);break;case 3:for(z=function(ne){var de=ne.length;if(de<=1)return[ne];for(var ue,X,se=[],he=0;he<de;he++){var _e=c(ne[he]);_e!==0&&(X===void 0&&(X=_e<0),X===_e<0?(ue&&se.push(ue),ue=[ne[he]]):ue.push(ne[he]))}return ue&&se.push(ue),se}(z),w=0;w<z.length;w++)for(T=0;T<z[w].length;T++)V(z[w][T])}z.length===1?z=z[0]:U="Multi"+U;var re={type:"Feature",geometry:{type:U,coordinates:z},properties:this.properties};return"id"in this&&(re.id=this.id),re},zx}function i2(){if(e2)return Fx;e2=1;var a=n2();function t(c,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(i,this,h),this.length=this._features.length}function i(c,h,p){c===15?h.version=p.readVarint():c===1?h.name=p.readString():c===5?h.extent=p.readVarint():c===2?h._features.push(p.pos):c===3?h._keys.push(p.readString()):c===4&&h._values.push(function(g){for(var w=null,T=g.readVarint()+g.pos;g.pos<T;){var A=g.readVarint()>>3;w=A===1?g.readString():A===2?g.readFloat():A===3?g.readDouble():A===4?g.readVarint64():A===5?g.readVarint():A===6?g.readSVarint():A===7?g.readBoolean():null}return w}(p))}return Fx=t,t.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var h=this._pbf.readVarint()+this._pbf.pos;return new a(this._pbf,h,this.extent,this._keys,this._values)},Fx}function o2(){return r2||(r2=1,qy.VectorTile=function(){if(t2)return Nx;t2=1;var a=i2();function t(i,c,h){if(i===3){var p=new a(h,h.readVarint()+h.pos);p.length&&(c[p.name]=p)}}return Nx=function(i,c){this.layers=i.readFields(t,{},c)},Nx}(),qy.VectorTileFeature=n2(),qy.VectorTileLayer=i2()),qy}var op=o2();const hm="3d_elevation_id",a2="level";class yF{constructor(){this._valid=!1}reset(t){return this.feature=t,this._valid=!0,this._geometry=t.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(t,i){return this._valid&&t(i(this._geometry)),this}require(t,i,c){return this.get(t,!0,i,c)}optional(t,i,c){return this.get(t,!1,i,c)}success(){return this._valid}get(t,i,c,h){const p=this.feature.properties.hasOwnProperty(t)?+this.feature.properties[t]:void 0;return this._valid&&p!==void 0&&!Number.isNaN(p)?c(h?h(p):p):i&&(this._valid=!1),this}}class s2{constructor(t,i){this.featureFunc=t,this.vertexFunc=i}parseFeature(t,i,c){return this.featureFunc(t,i,c)}parseVertex(t,i,c){return this.vertexFunc(t,i,c)}}const vF=new s2((a,t,i)=>a.reset(t).require(hm,c=>{i.id=c}).optional("fixed_height_relative",c=>{i.constantHeight=c},dm.decodeRelativeHeight).geometry(c=>{i.bounds=c},Tf).success(),(a,t,i)=>a.reset(t).require(hm,c=>{i.id=c}).require("elevation_idx",c=>{i.idx=c}).require("extent",c=>{i.extent=c}).require("height_relative",c=>{i.height=c},dm.decodeRelativeHeight).geometry(c=>{i.position=c},dm.getPoint).success()),xF=new s2((a,t,i)=>a.reset(t).require(hm,c=>{i.id=c}).optional("fixed_height",c=>{i.constantHeight=c},dm.decodeMetricHeight).geometry(c=>{i.bounds=c},Tf).success(),(a,t,i)=>a.reset(t).require(hm,c=>{i.id=c}).require("elevation_idx",c=>{i.idx=c}).require("extent",c=>{i.extent=c}).require("height",c=>{i.height=c},dm.decodeMetricHeight).geometry(c=>{i.position=c},dm.getPoint).success());class dm{static getPoint(t){return js(t[0][0].x,t[0][0].y)}static decodeRelativeHeight(t){return 1e-4*t*5}static decodeMetricHeight(t){return 1e-4*t}static parse(t){const i=[],c=[],h=t.length,p=new yF;for(let w=0;w<h;w++){const T=t.feature(w),A=T.properties.hasOwnProperty("version")?String(T.properties.version):void 0,M=(g=A)?g==="1.0.1"?xF:void 0:vF;if(M===void 0){tn(`Unknown elevation feature version number ${A||"(unknown)"}`);continue}const O=T.properties.hasOwnProperty("type")?T.properties.type:void 0;if(O){if(op.VectorTileFeature.types[T.type]==="Point"&&O==="curve_point"){const z={};M.parseVertex(p,T,z)&&i.push(z)}else if(op.VectorTileFeature.types[T.type]==="Polygon"&&O==="curve_meta"){const z={};M.parseFeature(p,T,z)&&c.push(z)}}}var g;return{vertices:i,features:c}}}class l2{constructor(t,i){this.feature=t,this.metersToTile=i,this.index=0}get(){const t=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,c=i[1],h=-i[0],p=(t.extent+1)*this.metersToTile;return[new Dt(Math.trunc(t.position[0]+c*p),Math.trunc(t.position[1]+h*p)),new Dt(Math.trunc(t.position[0]-c*p),Math.trunc(t.position[1]-h*p))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Bx{constructor(t,i,c,h,p,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=t,this.heightRange={min:c,max:c},this.safeArea=i,this.constantHeight=c,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=p,this.edges=this.edges.filter(w=>{return w.a<this.vertices.length&&w.b<this.vertices.length&&!((T=this.vertices[w.a].position)[0]===(A=this.vertices[w.b].position)[0]&&T[1]===A[1]);var T,A}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const w of this.vertices)this.vertexProps.push({dir:js(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,w.height),this.heightRange.max=Math.max(this.heightRange.max,w.height);for(const w of this.edges){const T=this.vertices[w.a].position,A=this.vertices[w.b].position,M=pa(ho(),A,T),O=zn(M),z=un(ho(),M,1/O);this.edgeProps.push({vec:M,dir:z,len:O});const U=this.vertexProps[w.a].dir,V=this.vertexProps[w.b].dir;fa(U,U,z),fa(V,V,z)}for(const w of this.vertexProps)w.dir[0]===0&&w.dir[1]===0||Cn(w.dir,w.dir);this.tessellate(g)}}pointElevation(t){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(t);if(i==null)return 0;const[c,h]=i;return((p,g,w)=>(1-w)*p+w*g)(this.vertices[this.edges[c].a].height,this.vertices[this.edges[c].b].height,h)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(t){if(this.edges.length===0)return;let i=0,c=Number.POSITIVE_INFINITY,h=0;const p=js(t.x,t.y);for(let g=0;g<this.edges.length;g++){const w=this.edges[g],T=this.edgeProps[g].dir,A=new Ds(p,this.edgeProps[g].dir),M=this.vertices[w.a].position,O=this.vertices[w.b].position,z=ho(),U=ho(),V=A.intersectsPlane(M,this.vertexProps[w.a].dir,z),H=A.intersectsPlane(O,this.vertexProps[w.b].dir,U);if(!V||!H)continue;const re=pa(ho(),U,z),ne=pa(ho(),p,z),de=Fr(re,re),ue=de>0?Fr(ne,re)/de:0,X=Fe(ue,0,1),se=Math.abs((ue-X)*this.edgeProps[g].len),he=pa(ho(),p,M),_e=se+Math.abs(Fr(he,js(T[1],-T[0])));_e<c&&(i=g,c=_e,h=X)}return[i,h]}tessellate(t){for(let i=this.edges.length-1;i>=0;--i){const c=this.edges[i].a,h=this.edges[i].b,{position:p,height:g,extent:w}=this.vertices[c],{position:T,height:A,extent:M}=this.vertices[h],O=this.vertexProps[c].dir,z=this.vertexProps[h].dir,U=vr(p[0]/t,p[1]/t,g),V=vr(T[0]/t,T[1]/t,A),H=vr(O[1],-O[0],0);Ft(H,H,w);const re=vr(z[1],-z[0],0);if(Ft(re,re,M),this.distSqLines(vr(U[0]+.5*H[0],U[1]+.5*H[1],U[2]+.5*H[2]),vr(V[0]-.5*re[0],V[1]-.5*re[1],V[2]-.5*re[2]),vr(U[0]-.5*H[0],U[1]-.5*H[1],U[2]-.5*H[2]),vr(V[0]+.5*re[0],V[1]+.5*re[1],V[2]+.5*re[2]))<=.0025000000000000005)continue;const ne=this.vertices.length,de=fa(ho(),p,T);this.vertices.push({position:un(de,de,.5),height:.5*(g+A),extent:.5*(w+M)});const ue=fa(ho(),O,z);this.vertexProps.push({dir:Cn(ue,ue)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:c,b:ne}),this.edges.push({a:ne,b:h});const X=pa(ho(),this.vertices[ne].position,p),se=zn(X),he={vec:X,dir:un(ho(),X,1/se),len:se};this.edgeProps.push(he),this.edgeProps.push(he)}}distSqLines(t,i,c,h){const p=zr(Zt(),i,t),g=zr(Zt(),h,c),w=zr(Zt(),t,c),T=kr(p,p),A=kr(p,g),M=kr(p,w),O=kr(g,g),z=kr(g,w),U=T*O-A*A;if(U===0){const re=kr(w,g)/kr(g,g);return St(wn(Zt(),c,h,re),t)}const V=(A*z-M*O)/U,H=(T*z-A*M)/U;return St(wn(Zt(),t,i,V),wn(Zt(),c,h,H))}}class jx{static parseFrom(t,i){const c=dm.parse(t);if(!c)return[];let{vertices:h,features:p}=c;const g=1/Ve(i);p.sort((M,O)=>M.id-O.id),h.sort((M,O)=>M.id-O.id||M.idx-O.idx),h=h.filter((M,O,z)=>O===z.findIndex(U=>U.id===M.id&&U.idx===M.idx));const w=new Array;let T=0;const A=h.length;for(const M of p){if(M.constantHeight){w.push(new Bx(M.id,M.bounds,M.constantHeight));continue}for(;T!==A&&h[T].id<M.id;)T++;if(T===A||h[T].id!==M.id)continue;const O=new Array,z=new Array,U=T;for(;T!==A&&h[T].id===M.id;){const V=h[T];if(O.push({position:V.position,height:V.height,extent:V.extent}),T!==U&&h[T-1].idx===V.idx-1){const H=T-U;z.push({a:H-1,b:H})}T++}w.push(new Bx(M.id,M.bounds,void 0,O,z,g))}return w}static getElevationFeature(t,i){if(!i)return;const c=+t.properties[hm];return Number.isNaN(c)?void 0:i.find(h=>h.id===c)}}class c2{constructor(t,i){this.zScale=1,this.xOffset=0,this.yOffset=0,t.equals(i)||(this.zScale=Math.pow(2,i.z-t.z),this.xOffset=(t.x*this.zScale-i.x)*zt,this.yOffset=(t.y*this.zScale-i.y)*zt)}constantElevation(t,i){if(t.constantHeight!=null)return this.computeBiasedHeight(t.constantHeight,i)}pointElevation(t,i,c){const h=this.constantElevation(i,c);return h??(t.x=t.x*this.zScale+this.xOffset,t.y=t.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(t),c))}computeBiasedHeight(t,i){return i<=0?t:t+i*Be(0,i,t>=0?t:Math.abs(.5*t))}}qt(Bx,"ElevationFeature");class u2{constructor(){this.polygons=new Map}add(t,...i){this.polygons.has(t)?this.polygons.get(t).push(...i):this.polygons.set(t,i)}merge(t){for(const[i,c]of t.polygons)this.add(i,...c)}}class fm{constructor(){this.portals=[]}static evaluate(t){if(t.length===0)return new fm;let i=[];for(const A of t)i.push(...A.portals);if(i.length===0)return new fm;const c=(A,M)=>A<=0&&M<=0||A>=zt&&M>=zt;for(const A of i){const M=A.va,O=A.vb;(c(M.x,O.x)||c(M.y,O.y))&&(A.type="border")}const h=i.filter(A=>A.type!=="unevaluated"),p=i.filter(A=>A.type==="unevaluated");if(p.length===0)return new fm;p.sort((A,M)=>A.hash===M.hash?A.isTunnel===M.isTunnel?0:A.isTunnel?-1:1:A.hash<M.hash?1:-1),i=h.concat(p);let g=h.length,w=g,T=g;do if(w++,w===i.length||i[g].hash!==i[w].hash){if(w-g==2){T<g&&(i[T]=i[g],i[g]=null);const A=i[T],M=i[w-1];A.type=A.isTunnel!==M.isTunnel?"tunnel":"polygon",A.connection={a:A.connection.a,b:M.connection.a},T++}g=w}while(g!==i.length);return i.splice(T),i.sort((A,M)=>A.hash<M.hash?1:-1),{portals:i}}}qt(fm,"ElevationPortalGraph"),qt(u2,"ElevationPolygons");class bF{constructor(t,i,c){this.outPositions=t,this.outNormals=i,this.outIndices=c,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(t,i,c){let h=t[2];c!=null&&(h*=c);const p=this.getVec3Bits(t)<<96n|this.getVec3Bits(i),g=this.vertexLookup.get(p);if(g!=null)return g;const w=this.outPositions.length;this.vertexLookup.set(p,w);const T=Math.trunc(16384*i[0]),A=Math.trunc(16384*i[1]),M=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(t[0],t[1],h),this.outNormals.emplaceBack(T,A,M),w}addVertices(t,i,...c){const h=[];for(const p of c){const g=this.addVertex(p,t,i);h.push(g)}return h}addTriangles(t,i,c){if(i&&c){const h=c.length===1,p=vr(0,0,0);for(let g=0;g<t.length;g+=3){const w=i[t[g+0]],T=i[t[g+1]],A=i[t[g+2]],M=h?c[0]:c[t[g+1]],O=h?c[0]:c[t[g+2]],z=this.addVertex(vr(w.x,w.y,h?c[0]:c[t[g+0]]),p),U=this.addVertex(vr(T.x,T.y,M),p),V=this.addVertex(vr(A.x,A.y,O),p);this.outIndices.emplaceBack(z,U,V)}}else for(let h=0;h<t.length;h+=3)this.outIndices.emplaceBack(t[h+0],t[h+1],t[h+2])}addQuad(t,i){const c=this.addVertices(i,void 0,...t.map(T=>vr(T.coord.x,T.coord.y,T.height))),[h,p,g,w]=c;this.addTriangles([h,p,g,g,w,h])}getBits(t){return this.view.setFloat32(0,t),BigInt(this.view.getUint32(0))}getVec3Bits(t){return this.getBits(t[0])<<64n|this.getBits(t[1])<<32n|this.getBits(t[2])}}class Nl{constructor(t){this.unevaluatedPortals=new fm,this.portalPolygons=new u2,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Vd,this.vertexNormals=new Hh,this.indexArray=new to,this.tileToMeters=Ve(t)}addVertices(t,i){const c=this.unevalVertices.length;for(let h=0;h<t.length;h++)this.unevalVertices.push(t[h]),this.unevalHeights.push(i[h]);return c}addTriangles(t,i,c){const h=c?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of t)h.push(p+i)}addRenderableRing(t,i,c,h,p){const g=[new Dt(p.min.x,p.min.y),new Dt(p.max.x,p.min.y),new Dt(p.max.x,p.max.y),new Dt(p.min.x,p.max.y)];for(let w=0;w<c-1;w++){const T=i+w,A=T+1,M=this.unevalVertices[T],O=this.unevalVertices[A];if(!(M.x>=p.min.x&&M.x<=p.max.x&&M.y>=p.min.y&&M.y<=p.max.y||O.x>=p.min.x&&O.x<=p.max.x&&O.y>=p.min.y&&O.y<=p.max.y||zi(M,O,g))||this.isOnBorder(M.x,O.x)||this.isOnBorder(M.y,O.y))continue;const z=Nl.computeEdgeHash(this.unevalVertices[T],this.unevalVertices[A]);let U,V=this.vertexHashLookup.get(Nl.computePosHash(M));V!=null?U=V.next:(V=this.vertexHashLookup.get(Nl.computePosHash(O)),U=V!=null?V.prev:z),this.unevalEdges.push({polygonIdx:t,a:T,b:A,hash:z,portalHash:U,isTunnel:h,type:"unevaluated"})}}addPortalCandidates(t,i,c,h,p){if(i.length===0)return;this.portalPolygons.add(t,{geometry:i,zLevel:p});const g=i[0];this.vertexHashLookup.clear();let w=Nl.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let T=0;T<g.length-1;T++){const A=g[T+0],M=g[T+1],O=js(M.x-A.x,M.y-A.y),z=zn(O);if(z===0)continue;let U="unevaluated";const V=h.pointElevation(A),H=h.pointElevation(M);Math.abs(V)<.01&&Math.abs(H)<.01?U="entrance":(this.isOnBorder(A.x,M.x)||this.isOnBorder(A.y,M.y))&&(U="border");const re=Nl.computeEdgeHash(A,M);this.unevaluatedPortals.portals.push({connection:{a:t,b:void 0},va:A,vb:M,vab:O,length:z,hash:re,isTunnel:c,type:U});const ne=Nl.computePosHash(A);this.vertexHashLookup.set(ne,{prev:w,next:re}),w=re}}construct(t){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),c=O=>{O.primitiveLength=this.indexArray.length-O.primitiveOffset},h=new bF(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(t.portals,this.unevalEdges);const p=i(),g=i(),w=i(),T=(O,z)=>{O.sort((V,H)=>V.type===z&&H.type!==z?-1:V.type!==z&&H.type===z?1:0);const U=O.findIndex(V=>V.type!==z);return U>=0?U:O.length};let A=0;this.unevalEdges.length>0&&(A=T(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},this.tileToMeters));const M=i();if(this.unevalEdges.length>0){const O=this.unevalEdges.splice(A),z=T(O,"tunnel")+A;this.unevalEdges.push(...O),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},{min:A,max:z})}c(w),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),c(M),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),c(g),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),c(p),this.maskSegments=Si.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.depthSegments=Si.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableSegments=Si.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.shadowCasterSegments=Si.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}upload(t){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=t.createVertexBuffer(this.vertexPositions,wa.members),this.vertexBufferNormal=t.createVertexBuffer(this.vertexNormals,Vi.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(t,i,c,h,p){const g=new Map;for(let w=h;w<p;w++){const T=c[w],A=T.a,M=T.b,O=Nl.computePosHash(t[A]),z=Nl.computePosHash(t[M]);g.has(O)||g.set(O,{}),g.has(z)||g.set(z,{});const U=g.get(O),V=g.get(z);i[A]<=0&&i[M]<=0||(U.to=M,V.from=A)}return g}constructBridgeStructures(t,i,c,h,p,g){const w=this.computeVertexConnections(i,c,h,p.min,p.max),T=1/g,A=.5*T,M=z=>vr(i[z].x,i[z].y,c[z]*T),O=z=>{const U=w.get(Nl.computePosHash(i[z])),V=U.from,H=U.to;if(!V||!H)return;const re=M(V),ne=M(z),de=M(H),ue=vr(0,0,0);if(!Kt(re,ne)){const se=We(Zt(),ne,re);Ar(ue,ue,Sr(se,se))}if(!Kt(de,ne)){const se=We(Zt(),de,ne);Ar(ue,ue,Sr(se,se))}const X=jr(ue);return X>0?Ft(ue,ue,1/X):void 0};for(let z=p.min;z<p.max;z++){const U=h[z],V=this.prepareEdgePoints(i,c,U,(It,Lr)=>It>Lr);if(V==null)continue;const H=V[0],re=V[1],ne=vr(H.coord.x,H.coord.y,T*H.height),de=vr(re.coord.x,re.coord.y,T*re.height);if(Kt(ne,de))continue;const ue=We(Zt(),de,ne);Sr(ue,ue);const X=It=>Sr(It,It),se=O(U.a)||ue,he=O(U.b)||ue,_e=X(vr(se[1],-se[0],0)),Ce=X(vr(he[1],-he[0],0)),Re=X(Vr(Zt(),_e,se)),Ne=X(Vr(Zt(),Ce,he)),$e=Zt(),at=[Ar(Zt(),ne,Ft($e,We($e,_e,Re),A)),Ar(Zt(),ne,Ft($e,Ar($e,_e,Re),A)),Ar(Zt(),ne,Ft($e,Re,A)),ne],xt=[Ar(Zt(),de,Ft($e,We($e,Ce,Ne),A)),Ar(Zt(),de,Ft($e,Ar($e,Ce,Ne),A)),Ar(Zt(),de,Ft($e,Ne,A)),de],[mt,yt]=t.addVertices(_e,g,at[0],at[1]),[At,tt]=t.addVertices(Ce,g,xt[0],xt[1]);t.addTriangles([mt,yt,At,yt,tt,At]);const[_t,Je]=t.addVertices(Re,g,at[1],at[2]),[it,Pt]=t.addVertices(Ne,g,xt[1],xt[2]);t.addTriangles([_t,Je,it,Je,Pt,it]);const[Mt,sr]=t.addVertices(gn(_e,_e),g,at[2],at[3]),[Qt,jt]=t.addVertices(gn(Ce,Ce),g,xt[2],xt[3]);t.addTriangles([Mt,sr,Qt,sr,jt,Qt])}}constructTunnelStructures(t,i,c,h,p,g){const w=T=>Sr(T,T);for(let T=p.min;T<p.max;T++){const A=this.prepareEdgePoints(i,c,h[T],(U,V)=>U<V);if(A==null)continue;const[M,O]=A,z=w(vr(O.coord.y-M.coord.y,-(O.coord.x-M.coord.x),0));t.addQuad([M,O,{coord:O.coord,height:h[T].isTunnel?-.1:0},{coord:M.coord,height:h[T].isTunnel?-.1:0}],z)}for(let T=g.min;T<g.max;T++){const A=h[T],M=i[A.a],O=i[A.b],z=w(vr(O.y-M.y,-(O.x-M.x),0));t.addQuad([{coord:O,height:0},{coord:M,height:0},{coord:M,height:c[A.a]+4},{coord:O,height:c[A.b]+4}],z),t.addQuad([{coord:M,height:0},{coord:O,height:0},{coord:O,height:c[A.b]+4},{coord:M,height:c[A.a]+4}],z)}}prepareEdgePoints(t,i,c,h){let p=i[c.a],g=i[c.b];const w=h(p,0),T=h(g,0);if(w&&T)return[{coord:t[c.a],height:p},{coord:t[c.b],height:g}];if(!w&&!T)return;const A=t[c.a].clone(),M=t[c.b].clone();if(w){if(!T){const O=g/(g-p);M.x=xr(M.x,A.x,O),M.y=xr(M.y,A.y,O),g=xr(g,p,O)}}else{const O=p/(p-g);A.x=xr(A.x,M.x,O),A.y=xr(A.y,M.y,O),p=xr(p,g,O)}return[{coord:A,height:p},{coord:M,height:g}]}prepareEdges(t,i){if(i.length===0)return;i.sort((w,T)=>w.hash===T.hash?T.polygonIdx-w.polygonIdx:T.hash>w.hash?1:-1);let c=0,h=0,p=0,g=i[c].polygonIdx;do h++,(h===i.length||i[c].hash!==i[h].hash)&&((h-c==1||i[h-1].polygonIdx!==g)&&(p<c&&(i[p]=i[c],i[c]=null),i[p].type="none",p++),c=h,c!==i.length&&(g=i[c].polygonIdx));while(c!==i.length);if(i.splice(p),i.length!==0&&t.length!==0){i.sort((A,M)=>A.portalHash<M.portalHash?1:-1);let w=0,T=0;for(;w!==i.length&&T!==t.length;){const A=i[w],M=t[T];A.portalHash>M.hash?w++:M.hash>A.portalHash?T++:(A.type=M.type,w++)}}}isOnBorder(t,i){return t<=0&&i<=0||t>=zt&&i>=zt}static computeEdgeHash(t,i){return(t.y===i.y&&t.x>i.x||t.y>i.y)&&([t,i]=[i,t]),BigInt(Nl.computePosHash(t))<<32n|BigInt(Nl.computePosHash(i))}static computePosHash(t){return((65535&t.x)<<16|65535&t.y)>>>0}}var h2,d2={exports:{}},f2=(h2||(h2=1,function(a,t){(function(i){function c(me,ve){return me>ve?1:me<ve?-1:0}var h=function(me,ve){me===void 0&&(me=c),ve===void 0&&(ve=!1),this._compare=me,this._root=null,this._size=0,this._noDuplicates=!!ve},p={size:{configurable:!0}};function g(me,ve,lt,Rt,$t){var Ut=$t-Rt;if(Ut>0){var or=Rt+Math.floor(Ut/2),Ir={key:ve[or],data:lt[or],parent:me};return Ir.left=g(Ir,ve,lt,Rt,or),Ir.right=g(Ir,ve,lt,or+1,$t),Ir}return null}function w(me,ve,lt,Rt,$t){if(!(lt>=Rt)){for(var Ut=me[lt+Rt>>1],or=lt-1,Ir=Rt+1;;){do or++;while($t(me[or],Ut)<0);do Ir--;while($t(me[Ir],Ut)>0);if(or>=Ir)break;var vn=me[or];me[or]=me[Ir],me[Ir]=vn,vn=ve[or],ve[or]=ve[Ir],ve[Ir]=vn}w(me,ve,lt,Ir,$t),w(me,ve,Ir+1,Rt,$t)}}h.prototype.rotateLeft=function(me){var ve=me.right;ve&&(me.right=ve.left,ve.left&&(ve.left.parent=me),ve.parent=me.parent),me.parent?me===me.parent.left?me.parent.left=ve:me.parent.right=ve:this._root=ve,ve&&(ve.left=me),me.parent=ve},h.prototype.rotateRight=function(me){var ve=me.left;ve&&(me.left=ve.right,ve.right&&(ve.right.parent=me),ve.parent=me.parent),me.parent?me===me.parent.left?me.parent.left=ve:me.parent.right=ve:this._root=ve,ve&&(ve.right=me),me.parent=ve},h.prototype._splay=function(me){for(;me.parent;){var ve=me.parent;ve.parent?ve.left===me&&ve.parent.left===ve?(this.rotateRight(ve.parent),this.rotateRight(ve)):ve.right===me&&ve.parent.right===ve?(this.rotateLeft(ve.parent),this.rotateLeft(ve)):ve.left===me&&ve.parent.right===ve?(this.rotateRight(ve),this.rotateLeft(ve)):(this.rotateLeft(ve),this.rotateRight(ve)):ve.left===me?this.rotateRight(ve):this.rotateLeft(ve)}},h.prototype.splay=function(me){for(var ve,lt,Rt,$t,Ut;me.parent;)(lt=(ve=me.parent).parent)&&lt.parent?((Rt=lt.parent).left===lt?Rt.left=me:Rt.right=me,me.parent=Rt):(me.parent=null,this._root=me),$t=me.left,Ut=me.right,me===ve.left?(lt&&(lt.left===ve?(ve.right?(lt.left=ve.right,lt.left.parent=lt):lt.left=null,ve.right=lt,lt.parent=ve):($t?(lt.right=$t,$t.parent=lt):lt.right=null,me.left=lt,lt.parent=me)),Ut?(ve.left=Ut,Ut.parent=ve):ve.left=null,me.right=ve,ve.parent=me):(lt&&(lt.right===ve?(ve.left?(lt.right=ve.left,lt.right.parent=lt):lt.right=null,ve.left=lt,lt.parent=ve):(Ut?(lt.left=Ut,Ut.parent=lt):lt.left=null,me.right=lt,lt.parent=me)),$t?(ve.right=$t,$t.parent=ve):ve.right=null,me.left=ve,ve.parent=me)},h.prototype.replace=function(me,ve){me.parent?me===me.parent.left?me.parent.left=ve:me.parent.right=ve:this._root=ve,ve&&(ve.parent=me.parent)},h.prototype.minNode=function(me){if(me===void 0&&(me=this._root),me)for(;me.left;)me=me.left;return me},h.prototype.maxNode=function(me){if(me===void 0&&(me=this._root),me)for(;me.right;)me=me.right;return me},h.prototype.insert=function(me,ve){var lt=this._root,Rt=null,$t=this._compare;if(this._noDuplicates)for(;lt;){if(Rt=lt,$t(lt.key,me)===0)return;lt=$t(lt.key,me)<0?lt.right:lt.left}else for(;lt;)Rt=lt,lt=$t(lt.key,me)<0?lt.right:lt.left;return lt={key:me,data:ve,left:null,right:null,parent:Rt},Rt?$t(Rt.key,lt.key)<0?Rt.right=lt:Rt.left=lt:this._root=lt,this.splay(lt),this._size++,lt},h.prototype.find=function(me){for(var ve=this._root,lt=this._compare;ve;){var Rt=lt(ve.key,me);if(Rt<0)ve=ve.right;else{if(!(Rt>0))return ve;ve=ve.left}}return null},h.prototype.contains=function(me){for(var ve=this._root,lt=this._compare;ve;){var Rt=lt(me,ve.key);if(Rt===0)return!0;ve=Rt<0?ve.left:ve.right}return!1},h.prototype.remove=function(me){var ve=this.find(me);if(!ve)return!1;if(this.splay(ve),ve.left)if(ve.right){var lt=this.minNode(ve.right);lt.parent!==ve&&(this.replace(lt,lt.right),lt.right=ve.right,lt.right.parent=lt),this.replace(ve,lt),lt.left=ve.left,lt.left.parent=lt}else this.replace(ve,ve.left);else this.replace(ve,ve.right);return this._size--,!0},h.prototype.removeNode=function(me){if(!me)return!1;if(this.splay(me),me.left)if(me.right){var ve=this.minNode(me.right);ve.parent!==me&&(this.replace(ve,ve.right),ve.right=me.right,ve.right.parent=ve),this.replace(me,ve),ve.left=me.left,ve.left.parent=ve}else this.replace(me,me.left);else this.replace(me,me.right);return this._size--,!0},h.prototype.erase=function(me){var ve=this.find(me);if(ve){this.splay(ve);var lt=ve.left,Rt=ve.right,$t=null;lt&&(lt.parent=null,$t=this.maxNode(lt),this.splay($t),this._root=$t),Rt&&(lt?$t.right=Rt:this._root=Rt,Rt.parent=$t),this._size--}},h.prototype.pop=function(){var me=this._root,ve=null;if(me){for(;me.left;)me=me.left;ve={key:me.key,data:me.data},this.remove(me.key)}return ve},h.prototype.next=function(me){var ve=me;if(ve)if(ve.right)for(ve=ve.right;ve&&ve.left;)ve=ve.left;else for(ve=me.parent;ve&&ve.right===me;)me=ve,ve=ve.parent;return ve},h.prototype.prev=function(me){var ve=me;if(ve)if(ve.left)for(ve=ve.left;ve&&ve.right;)ve=ve.right;else for(ve=me.parent;ve&&ve.left===me;)me=ve,ve=ve.parent;return ve},h.prototype.forEach=function(me){for(var ve=this._root,lt=[],Rt=!1,$t=0;!Rt;)ve?(lt.push(ve),ve=ve.left):lt.length>0?(me(ve=lt.pop(),$t++),ve=ve.right):Rt=!0;return this},h.prototype.range=function(me,ve,lt,Rt){for(var $t=[],Ut=this._compare,or=this._root;$t.length!==0||or;)if(or)$t.push(or),or=or.left;else{if(Ut((or=$t.pop()).key,ve)>0)break;if(Ut(or.key,me)>=0&&lt.call(Rt,or))return this;or=or.right}return this},h.prototype.keys=function(){for(var me=this._root,ve=[],lt=[],Rt=!1;!Rt;)me?(ve.push(me),me=me.left):ve.length>0?(me=ve.pop(),lt.push(me.key),me=me.right):Rt=!0;return lt},h.prototype.values=function(){for(var me=this._root,ve=[],lt=[],Rt=!1;!Rt;)me?(ve.push(me),me=me.left):ve.length>0?(me=ve.pop(),lt.push(me.data),me=me.right):Rt=!0;return lt},h.prototype.at=function(me){for(var ve=this._root,lt=[],Rt=!1,$t=0;!Rt;)if(ve)lt.push(ve),ve=ve.left;else if(lt.length>0){if(ve=lt.pop(),$t===me)return ve;$t++,ve=ve.right}else Rt=!0;return null},h.prototype.load=function(me,ve,lt){if(me===void 0&&(me=[]),ve===void 0&&(ve=[]),lt===void 0&&(lt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Rt=me.length;return lt&&w(me,ve,0,Rt-1,this._compare),this._root=g(null,me,ve,0,Rt),this._size=Rt,this},h.prototype.min=function(){var me=this.minNode(this._root);return me?me.key:null},h.prototype.max=function(){var me=this.maxNode(this._root);return me?me.key:null},h.prototype.isEmpty=function(){return this._root===null},p.size.get=function(){return this._size},h.createTree=function(me,ve,lt,Rt,$t){return new h(lt,$t).load(me,ve,Rt)},Object.defineProperties(h.prototype,p);var T=0,A=1,M=2,O=3,z=0,U=1,V=2,H=3;function re(me,ve,lt){ve===null?(me.inOut=!1,me.otherInOut=!0):(me.isSubject===ve.isSubject?(me.inOut=!ve.inOut,me.otherInOut=ve.otherInOut):(me.inOut=!ve.otherInOut,me.otherInOut=ve.isVertical()?!ve.inOut:ve.inOut),ve&&(me.prevInResult=!ne(ve,lt)||ve.isVertical()?ve.prevInResult:ve));var Rt=ne(me,lt);me.resultTransition=Rt?function($t,Ut){var or,Ir=!$t.inOut,vn=!$t.otherInOut;switch(Ut){case z:or=Ir&&vn;break;case U:or=Ir||vn;break;case H:or=Ir^vn;break;case V:or=$t.isSubject?Ir&&!vn:vn&&!Ir}return or?1:-1}(me,lt):0}function ne(me,ve){switch(me.type){case T:switch(ve){case z:return!me.otherInOut;case U:return me.otherInOut;case V:return me.isSubject&&me.otherInOut||!me.isSubject&&!me.otherInOut;case H:return!0}break;case M:return ve===z||ve===U;case O:return ve===V;case A:return!1}return!1}var de=function(me,ve,lt,Rt,$t){this.left=ve,this.point=me,this.otherEvent=lt,this.isSubject=Rt,this.type=$t||T,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ue={inResult:{configurable:!0}};function X(me,ve){return me[0]===ve[0]&&me[1]===ve[1]}de.prototype.isBelow=function(me){var ve=this.point,lt=this.otherEvent.point;return this.left?(ve[0]-me[0])*(lt[1]-me[1])-(lt[0]-me[0])*(ve[1]-me[1])>0:(lt[0]-me[0])*(ve[1]-me[1])-(ve[0]-me[0])*(lt[1]-me[1])>0},de.prototype.isAbove=function(me){return!this.isBelow(me)},de.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ue.inResult.get=function(){return this.resultTransition!==0},de.prototype.clone=function(){var me=new de(this.point,this.left,this.otherEvent,this.isSubject,this.type);return me.contourId=this.contourId,me.resultTransition=this.resultTransition,me.prevInResult=this.prevInResult,me.isExteriorRing=this.isExteriorRing,me.inOut=this.inOut,me.otherInOut=this.otherInOut,me},Object.defineProperties(de.prototype,ue);var se=11102230246251565e-32,he=134217729,_e=(3+8*se)*se;function Ce(me,ve,lt,Rt,$t){var Ut,or,Ir,vn,xn=ve[0],Jr=Rt[0],Kn=0,fi=0;Jr>xn==Jr>-xn?(Ut=xn,xn=ve[++Kn]):(Ut=Jr,Jr=Rt[++fi]);var bn=0;if(Kn<me&&fi<lt)for(Jr>xn==Jr>-xn?(Ir=Ut-((or=xn+Ut)-xn),xn=ve[++Kn]):(Ir=Ut-((or=Jr+Ut)-Jr),Jr=Rt[++fi]),Ut=or,Ir!==0&&($t[bn++]=Ir);Kn<me&&fi<lt;)Jr>xn==Jr>-xn?(Ir=Ut-((or=Ut+xn)-(vn=or-Ut))+(xn-vn),xn=ve[++Kn]):(Ir=Ut-((or=Ut+Jr)-(vn=or-Ut))+(Jr-vn),Jr=Rt[++fi]),Ut=or,Ir!==0&&($t[bn++]=Ir);for(;Kn<me;)Ir=Ut-((or=Ut+xn)-(vn=or-Ut))+(xn-vn),xn=ve[++Kn],Ut=or,Ir!==0&&($t[bn++]=Ir);for(;fi<lt;)Ir=Ut-((or=Ut+Jr)-(vn=or-Ut))+(Jr-vn),Jr=Rt[++fi],Ut=or,Ir!==0&&($t[bn++]=Ir);return Ut===0&&bn!==0||($t[bn++]=Ut),bn}function Re(me){return new Float64Array(me)}var Ne=33306690738754716e-32,$e=22204460492503146e-32,at=11093356479670487e-47,xt=Re(4),mt=Re(8),yt=Re(12),At=Re(16),tt=Re(4);function _t(me,ve,lt){var Rt=function($t,Ut,or,Ir,vn,xn){var Jr=(Ut-xn)*(or-vn),Kn=($t-vn)*(Ir-xn),fi=Jr-Kn;if(Jr===0||Kn===0||Jr>0!=Kn>0)return fi;var bn=Math.abs(Jr+Kn);return Math.abs(fi)>=Ne*bn?fi:-function(Ni,xi,Hn,Xi,Ei,pi,bi){var ei,an,ni,Bi,Er,kn,Ai,qi,Pi,Eo,si,go,ks,Sa,da,Rs,nd,Ao,Vo=Ni-Ei,Ta=Hn-Ei,Ga=xi-pi,Fa=Xi-pi;xt[0]=(da=(qi=Vo-(Ai=(kn=he*Vo)-(kn-Vo)))*(Eo=Fa-(Pi=(kn=he*Fa)-(kn-Fa)))-((Sa=Vo*Fa)-Ai*Pi-qi*Pi-Ai*Eo))-((si=da-(nd=(qi=Ga-(Ai=(kn=he*Ga)-(kn-Ga)))*(Eo=Ta-(Pi=(kn=he*Ta)-(kn-Ta)))-((Rs=Ga*Ta)-Ai*Pi-qi*Pi-Ai*Eo)))+(Er=da-si))+(Er-nd),xt[1]=(ks=Sa-((go=Sa+si)-(Er=go-Sa))+(si-Er))-((si=ks-Rs)+(Er=ks-si))+(Er-Rs),xt[2]=go-((Ao=go+si)-(Er=Ao-go))+(si-Er),xt[3]=Ao;var dp=function(FJ,yP){for(var vP=yP[0],G1=1;G1<4;G1++)vP+=yP[G1];return vP}(0,xt),U_=$e*bi;if(dp>=U_||-dp>=U_||(ei=Ni-(Vo+(Er=Ni-Vo))+(Er-Ei),ni=Hn-(Ta+(Er=Hn-Ta))+(Er-Ei),an=xi-(Ga+(Er=xi-Ga))+(Er-pi),Bi=Xi-(Fa+(Er=Xi-Fa))+(Er-pi),ei===0&&an===0&&ni===0&&Bi===0)||(U_=at*bi+_e*Math.abs(dp),(dp+=Vo*Bi+Fa*ei-(Ga*ni+Ta*an))>=U_||-dp>=U_))return dp;tt[0]=(da=(qi=ei-(Ai=(kn=he*ei)-(kn-ei)))*(Eo=Fa-(Pi=(kn=he*Fa)-(kn-Fa)))-((Sa=ei*Fa)-Ai*Pi-qi*Pi-Ai*Eo))-((si=da-(nd=(qi=an-(Ai=(kn=he*an)-(kn-an)))*(Eo=Ta-(Pi=(kn=he*Ta)-(kn-Ta)))-((Rs=an*Ta)-Ai*Pi-qi*Pi-Ai*Eo)))+(Er=da-si))+(Er-nd),tt[1]=(ks=Sa-((go=Sa+si)-(Er=go-Sa))+(si-Er))-((si=ks-Rs)+(Er=ks-si))+(Er-Rs),tt[2]=go-((Ao=go+si)-(Er=Ao-go))+(si-Er),tt[3]=Ao;var ij=Ce(4,xt,4,tt,mt);tt[0]=(da=(qi=Vo-(Ai=(kn=he*Vo)-(kn-Vo)))*(Eo=Bi-(Pi=(kn=he*Bi)-(kn-Bi)))-((Sa=Vo*Bi)-Ai*Pi-qi*Pi-Ai*Eo))-((si=da-(nd=(qi=Ga-(Ai=(kn=he*Ga)-(kn-Ga)))*(Eo=ni-(Pi=(kn=he*ni)-(kn-ni)))-((Rs=Ga*ni)-Ai*Pi-qi*Pi-Ai*Eo)))+(Er=da-si))+(Er-nd),tt[1]=(ks=Sa-((go=Sa+si)-(Er=go-Sa))+(si-Er))-((si=ks-Rs)+(Er=ks-si))+(Er-Rs),tt[2]=go-((Ao=go+si)-(Er=Ao-go))+(si-Er),tt[3]=Ao;var oj=Ce(ij,mt,4,tt,yt);tt[0]=(da=(qi=ei-(Ai=(kn=he*ei)-(kn-ei)))*(Eo=Bi-(Pi=(kn=he*Bi)-(kn-Bi)))-((Sa=ei*Bi)-Ai*Pi-qi*Pi-Ai*Eo))-((si=da-(nd=(qi=an-(Ai=(kn=he*an)-(kn-an)))*(Eo=ni-(Pi=(kn=he*ni)-(kn-ni)))-((Rs=an*ni)-Ai*Pi-qi*Pi-Ai*Eo)))+(Er=da-si))+(Er-nd),tt[1]=(ks=Sa-((go=Sa+si)-(Er=go-Sa))+(si-Er))-((si=ks-Rs)+(Er=ks-si))+(Er-Rs),tt[2]=go-((Ao=go+si)-(Er=Ao-go))+(si-Er),tt[3]=Ao;var aj=Ce(oj,yt,4,tt,At);return At[aj-1]}($t,Ut,or,Ir,vn,xn,bn)}(me[0],me[1],ve[0],ve[1],lt[0],lt[1]);return Rt>0?-1:Rt<0?1:0}function Je(me,ve){var lt=me.point,Rt=ve.point;return lt[0]>Rt[0]?1:lt[0]<Rt[0]?-1:lt[1]!==Rt[1]?lt[1]>Rt[1]?1:-1:function($t,Ut,or,Ir){return $t.left!==Ut.left?$t.left?1:-1:_t(or,$t.otherEvent.point,Ut.otherEvent.point)!==0?$t.isBelow(Ut.otherEvent.point)?-1:1:!$t.isSubject&&Ut.isSubject?1:-1}(me,ve,lt)}function it(me,ve,lt){var Rt=new de(ve,!1,me,me.isSubject),$t=new de(ve,!0,me.otherEvent,me.isSubject);return X(me.point,me.otherEvent.point)&&console.warn("what is that, a collapsed segment?",me),Rt.contourId=$t.contourId=me.contourId,Je($t,me.otherEvent)>0&&(me.otherEvent.left=!0,$t.left=!1),me.otherEvent.otherEvent=$t,me.otherEvent=Rt,lt.push($t),lt.push(Rt),lt}function Pt(me,ve){return me[0]*ve[1]-me[1]*ve[0]}function Mt(me,ve){return me[0]*ve[0]+me[1]*ve[1]}function sr(me,ve,lt){var Rt=function(vn,xn,Jr,Kn,fi){var bn=[xn[0]-vn[0],xn[1]-vn[1]],Ni=[Kn[0]-Jr[0],Kn[1]-Jr[1]];function xi(kn,Ai,qi){return[kn[0]+Ai*qi[0],kn[1]+Ai*qi[1]]}var Hn=[Jr[0]-vn[0],Jr[1]-vn[1]],Xi=Pt(bn,Ni),Ei=Xi*Xi,pi=Mt(bn,bn);if(Ei>0){var bi=Pt(Hn,Ni)/Xi;if(bi<0||bi>1)return null;var ei=Pt(Hn,bn)/Xi;return ei<0||ei>1?null:bi===0||bi===1?[xi(vn,bi,bn)]:ei===0||ei===1?[xi(Jr,ei,Ni)]:[xi(vn,bi,bn)]}if((Ei=(Xi=Pt(Hn,bn))*Xi)>0)return null;var an=Mt(bn,Hn)/pi,ni=an+Mt(bn,Ni)/pi,Bi=Math.min(an,ni),Er=Math.max(an,ni);return Bi<=1&&Er>=0?Bi===1?[xi(vn,Bi>0?Bi:0,bn)]:Er===0?[xi(vn,Er<1?Er:1,bn)]:[xi(vn,Bi>0?Bi:0,bn),xi(vn,Er<1?Er:1,bn)]:null}(me.point,me.otherEvent.point,ve.point,ve.otherEvent.point),$t=Rt?Rt.length:0;if($t===0||$t===1&&(X(me.point,ve.point)||X(me.otherEvent.point,ve.otherEvent.point))||$t===2&&me.isSubject===ve.isSubject)return 0;if($t===1)return X(me.point,Rt[0])||X(me.otherEvent.point,Rt[0])||it(me,Rt[0],lt),X(ve.point,Rt[0])||X(ve.otherEvent.point,Rt[0])||it(ve,Rt[0],lt),1;var Ut=[],or=!1,Ir=!1;return X(me.point,ve.point)?or=!0:Je(me,ve)===1?Ut.push(ve,me):Ut.push(me,ve),X(me.otherEvent.point,ve.otherEvent.point)?Ir=!0:Je(me.otherEvent,ve.otherEvent)===1?Ut.push(ve.otherEvent,me.otherEvent):Ut.push(me.otherEvent,ve.otherEvent),or&&Ir||or?(ve.type=A,me.type=ve.inOut===me.inOut?M:O,or&&!Ir&&it(Ut[1].otherEvent,Ut[0].point,lt),2):Ir?(it(Ut[0],Ut[1].point,lt),3):Ut[0]!==Ut[3].otherEvent?(it(Ut[0],Ut[1].point,lt),it(Ut[1],Ut[2].point,lt),3):(it(Ut[0],Ut[1].point,lt),it(Ut[3].otherEvent,Ut[2].point,lt),3)}function Qt(me,ve){if(me===ve)return 0;if(_t(me.point,me.otherEvent.point,ve.point)!==0||_t(me.point,me.otherEvent.point,ve.otherEvent.point)!==0)return X(me.point,ve.point)?me.isBelow(ve.otherEvent.point)?-1:1:me.point[0]===ve.point[0]?me.point[1]<ve.point[1]?-1:1:Je(me,ve)===1?ve.isAbove(me.point)?-1:1:me.isBelow(ve.point)?-1:1;if(me.isSubject!==ve.isSubject)return me.isSubject?-1:1;var lt=me.point,Rt=ve.point;return lt[0]===Rt[0]&&lt[1]===Rt[1]?(lt=me.otherEvent.point)[0]===(Rt=ve.otherEvent.point)[0]&&lt[1]===Rt[1]?0:me.contourId>ve.contourId?1:-1:Je(me,ve)===1?1:-1}var jt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function It(me,ve,lt,Rt){var $t,Ut=me+1,or=ve[me].point,Ir=ve.length;for(Ut<Ir&&($t=ve[Ut].point);Ut<Ir&&$t[0]===or[0]&&$t[1]===or[1];){if(!lt[Ut])return Ut;++Ut<Ir&&($t=ve[Ut].point)}for(Ut=me-1;lt[Ut]&&Ut>Rt;)Ut--;return Ut}jt.prototype.isExterior=function(){return this.holeOf==null};var Lr=nr,rr=nr;function nr(me,ve){if(!(this instanceof nr))return new nr(me,ve);if(this.data=me||[],this.length=this.data.length,this.compare=ve||Cr,this.length>0)for(var lt=(this.length>>1)-1;lt>=0;lt--)this._down(lt)}function Cr(me,ve){return me<ve?-1:me>ve?1:0}nr.prototype={push:function(me){this.data.push(me),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var me=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),me}},peek:function(){return this.data[0]},_up:function(me){for(var ve=this.data,lt=this.compare,Rt=ve[me];me>0;){var $t=me-1>>1,Ut=ve[$t];if(lt(Rt,Ut)>=0)break;ve[me]=Ut,me=$t}ve[me]=Rt},_down:function(me){for(var ve=this.data,lt=this.compare,Rt=this.length>>1,$t=ve[me];me<Rt;){var Ut=1+(me<<1),or=Ut+1,Ir=ve[Ut];if(or<this.length&&lt(ve[or],Ir)<0&&(Ut=or,Ir=ve[or]),lt(Ir,$t)>=0)break;ve[me]=Ir,me=Ut}ve[me]=$t}},Lr.default=rr;var Gr=Math.max,Xr=Math.min,cn=0;function on(me,ve,lt,Rt,$t,Ut){var or,Ir,vn,xn,Jr,Kn;for(or=0,Ir=me.length-1;or<Ir;or++)if(xn=me[or+1],Jr=new de(vn=me[or],!1,void 0,ve),Kn=new de(xn,!1,Jr,ve),Jr.otherEvent=Kn,vn[0]!==xn[0]||vn[1]!==xn[1]){Jr.contourId=Kn.contourId=lt,Ut||(Jr.isExteriorRing=!1,Kn.isExteriorRing=!1),Je(Jr,Kn)>0?Kn.left=!0:Jr.left=!0;var fi=vn[0],bn=vn[1];$t[0]=Xr($t[0],fi),$t[1]=Xr($t[1],bn),$t[2]=Gr($t[2],fi),$t[3]=Gr($t[3],bn),Rt.push(Jr),Rt.push(Kn)}}var Kr=[];function ai(me,ve,lt){typeof me[0][0][0]=="number"&&(me=[me]),typeof ve[0][0][0]=="number"&&(ve=[ve]);var Rt=function(bn,Ni,xi){var Hn=null;return bn.length*Ni.length==0&&(xi===z?Hn=Kr:xi===V?Hn=bn:xi!==U&&xi!==H||(Hn=bn.length===0?Ni:bn)),Hn}(me,ve,lt);if(Rt)return Rt===Kr?null:Rt;var $t=[1/0,1/0,-1/0,-1/0],Ut=[1/0,1/0,-1/0,-1/0],or=function(bn,Ni,xi,Hn,Xi){var Ei,pi,bi,ei,an,ni,Bi=new Lr(null,Je);for(bi=0,ei=bn.length;bi<ei;bi++)for(an=0,ni=(Ei=bn[bi]).length;an<ni;an++)(pi=an===0)&&cn++,on(Ei[an],!0,cn,Bi,xi,pi);for(bi=0,ei=Ni.length;bi<ei;bi++)for(an=0,ni=(Ei=Ni[bi]).length;an<ni;an++)pi=an===0,Xi===V&&(pi=!1),pi&&cn++,on(Ei[an],!1,cn,Bi,Hn,pi);return Bi}(me,ve,$t,Ut,lt);if(Rt=function(bn,Ni,xi,Hn,Xi){var Ei=null;return(xi[0]>Hn[2]||Hn[0]>xi[2]||xi[1]>Hn[3]||Hn[1]>xi[3])&&(Xi===z?Ei=Kr:Xi===V?Ei=bn:Xi!==U&&Xi!==H||(Ei=bn.concat(Ni))),Ei}(me,ve,$t,Ut,lt))return Rt===Kr?null:Rt;for(var Ir=function(bn){var Ni,xi,Hn=function(bi){var ei,an,ni,Bi,Er=[];for(an=0,ni=bi.length;an<ni;an++)((ei=bi[an]).left&&ei.inResult||!ei.left&&ei.otherEvent.inResult)&&Er.push(ei);for(var kn=!1;!kn;)for(kn=!0,an=0,ni=Er.length;an<ni;an++)an+1<ni&&Je(Er[an],Er[an+1])===1&&(Bi=Er[an],Er[an]=Er[an+1],Er[an+1]=Bi,kn=!1);for(an=0,ni=Er.length;an<ni;an++)(ei=Er[an]).otherPos=an;for(an=0,ni=Er.length;an<ni;an++)(ei=Er[an]).left||(Bi=ei.otherPos,ei.otherPos=ei.otherEvent.otherPos,ei.otherEvent.otherPos=Bi);return Er}(bn),Xi={},Ei=[],pi=function(){if(!Xi[Ni]){var bi=Ei.length,ei=function(Er,kn,Ai){var qi=new jt;if(Er.prevInResult!=null){var Pi=Er.prevInResult,Eo=Pi.outputContourId;if(Pi.resultTransition>0){var si=kn[Eo];if(si.holeOf!=null){var go=si.holeOf;kn[go].holeIds.push(Ai),qi.holeOf=go,qi.depth=kn[Eo].depth}else kn[Eo].holeIds.push(Ai),qi.holeOf=Eo,qi.depth=kn[Eo].depth+1}else qi.holeOf=null,qi.depth=kn[Eo].depth}else qi.holeOf=null,qi.depth=0;return qi}(Hn[Ni],Ei,bi),an=function(Er){Xi[Er]=!0,Er<Hn.length&&Hn[Er]&&(Hn[Er].outputContourId=bi)},ni=Ni,Bi=Ni;for(ei.points.push(Hn[Ni].point);an(ni),an(ni=Hn[ni].otherPos),ei.points.push(Hn[ni].point),!((ni=It(ni,Hn,Xi,Bi))==Bi||ni>=Hn.length)&&Hn[ni];);Ei.push(ei)}};for(Ni=0,xi=Hn.length;Ni<xi;Ni++)pi();return Ei}(function(bn,Ni,xi,Hn,Xi,Ei){for(var pi,bi,ei,an=new h(Qt),ni=[],Bi=Math.min(Hn[2],Xi[2]);bn.length!==0;){var Er=bn.pop();if(ni.push(Er),Ei===z&&Er.point[0]>Bi||Ei===V&&Er.point[0]>Hn[2])break;if(Er.left){bi=pi=an.insert(Er),pi=pi!==(ei=an.minNode())?an.prev(pi):null,bi=an.next(bi);var kn=pi?pi.key:null;if(re(Er,kn,Ei),bi&&sr(Er,bi.key,bn)===2&&(re(Er,kn,Ei),re(bi.key,Er,Ei)),pi&&sr(pi.key,Er,bn)===2){var Ai=pi;re(kn,(Ai=Ai!==ei?an.prev(Ai):null)?Ai.key:null,Ei),re(Er,kn,Ei)}}else bi=pi=an.find(Er=Er.otherEvent),pi&&bi&&(pi=pi!==ei?an.prev(pi):null,bi=an.next(bi),an.remove(Er),bi&&pi&&sr(pi.key,bi.key,bn))}return ni}(or,0,0,$t,Ut,lt)),vn=[],xn=0;xn<Ir.length;xn++){var Jr=Ir[xn];if(Jr.isExterior()){for(var Kn=[Jr.points],fi=0;fi<Jr.holeIds.length;fi++)Kn.push(Ir[Jr.holeIds[fi]].points);vn.push(Kn)}}return vn}var vi={UNION:U,DIFFERENCE:V,INTERSECTION:z,XOR:H};i.diff=function(me,ve){return ai(me,ve,V)},i.intersection=function(me,ve){return ai(me,ve,z)},i.operations=vi,i.union=function(me,ve){return ai(me,ve,U)},i.xor=function(me,ve){return ai(me,ve,H)},Object.defineProperty(i,"__esModule",{value:!0})})(t)}(0,d2.exports)),d2.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Wy(a,t,i,c){const h=[],p=c===0?(g,w,T,A,M,O)=>{g.push(new Dt(O,T+(O-w)/(A-w)*(M-T)))}:(g,w,T,A,M,O)=>{g.push(new Dt(w+(O-T)/(M-T)*(A-w),O))};for(const g of a){const w=[];for(const T of g){if(T.length<=2)continue;const A=[];for(let z=0;z<T.length-1;z++){const U=T[z].x,V=T[z].y,H=T[z+1].x,re=T[z+1].y,ne=c===0?U:V,de=c===0?H:re;ne<t?de>t&&p(A,U,V,H,re,t):ne>i?de<i&&p(A,U,V,H,re,i):A.push(T[z]),de<t&&ne>=t&&p(A,U,V,H,re,t),de>i&&ne<=i&&p(A,U,V,H,re,i)}let M=T[T.length-1];const O=c===0?M.x:M.y;O>=t&&O<=i&&A.push(M),A.length&&(M=A[A.length-1],A[0].x===M.x&&A[0].y===M.y||A.push(A[0]),w.push(A))}w.length&&h.push(w)}return h}function wF(a,t){const i=Ux(a),c=Ux([t]),h=f2.intersection(i,c);return h==null?[]:p2(h)}function SF(a,t){let c=Ux(a,65536);for(;t.valid();t.next()){const[h,p]=t.get(),g=h.x*65536,w=h.y*65536,T=p.x*65536,A=p.y*65536,M=T-g,O=A-w,z=Math.hypot(M,O),U=Math.trunc(O/z*3),V=-Math.trunc(M/z*3);c=f2.diff(c,[[[g,w],[T,A],[T+U,A+V],[g+U,w+V],[g,w]]])}return p2(c,1/65536)}function Ux(a,t=1){return[a.map(i=>i.map(c=>[c.x*t,c.y*t]))]}function p2(a,t=1){return a.map(i=>i.map((c,h)=>{const p=c.map(g=>new Dt(g[0]*t,g[1]*t).round());return h>0&&p.reverse(),p}))}class Vx{constructor(t,i){this.layoutVertexArray=new Cl,this.indexArray=new to,this.lineIndexArray=new Ks,this.triangleSegments=new Si,this.lineSegments=new Si,this.programConfigurations=new gc(t.layers,{zoom:t.zoom,lut:t.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Wh)}update(t,i,c,h,p,g,w){this.programConfigurations.updatePaintArrays(t,i,p,c,h,g,w)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Dn.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.lineIndexBuffer=t.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,Un.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(t,i,c,h,p,g){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,c,h,p,g)}}class $x{constructor(t){this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new Vx(t,!1),this.elevationBufferData=new Vx(t,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(t,i){}populate(t,i,c,h){this.hasPattern=Rx("fill",this.layers,this.pixelRatio,i);const p=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:w,id:T,index:A,sourceLayerIndex:M}of t){const O=this.layers[0]._featureFilter.needGeometry,z=tr(w,O);if(!this.layers[0]._featureFilter.filter(new $n(this.zoom),z,c))continue;const U=p?p.evaluate(z,{},c,i.availableImages):void 0,V={id:T,properties:w.properties,type:w.type,sourceLayerIndex:M,index:A,geometry:O?z.geometry:Yt(w,c,h),patterns:{},sortKey:U};g.push(V)}p&&g.sort((w,T)=>w.sortKey-T.sortKey);for(const w of g){const{geometry:T,index:A,sourceLayerIndex:M}=w;if(this.hasPattern){const O=Lx("fill",this.layers,w,this.zoom,this.pixelRatio,i);this.patternFeatures.push(O)}else this.addFeature(w,T,A,c,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(t[A].feature,T,A,M,this.index)}}update(t,i,c,h,p,g,w){this.bufferData.update(t,i,c,h,p,g,w),this.elevationBufferData.update(t,i,c,h,p,g,w)}addFeatures(t,i,c,h,p,g){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,i,c,h,g,t.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(t){this.bufferData.upload(t),this.elevationBufferData.upload(t),this.elevatedStructures&&this.elevatedStructures.upload(t)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(t,i,c,h,p,g=[],w,T){const A=Gy(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(t,A,h,c,T):this.addGeometry(A,this.bufferData),this.bufferData.populatePaintArrays(t,c,p,g,h,w),this.elevationBufferData.populatePaintArrays(t,c,p,g,h,w)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(t){this.elevatedStructures&&this.elevatedStructures.construct(t)}addElevatedRoadFeature(t,i,c,h,p){const g=new Array,w=jx.getElevationFeature(t,p);if(w){{const T=this.clipPolygonsToTile(i,1);T.length>0&&g.push({polygons:T,elevationFeature:w,elevationTileID:c})}for(const T of g)if(T.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Nl(T.elevationTileID));const M=T.elevationFeature.isTunnel();let O=0;t.properties.hasOwnProperty(a2)&&(O=+t.properties[a2]);for(const z of T.polygons)this.elevatedStructures.addPortalCandidates(T.elevationFeature.id,z,M,T.elevationFeature,O)}T.elevationFeature.constantHeight==null&&(T.polygons=this.prepareElevatedPolygons(T.polygons,T.elevationFeature,T.elevationTileID));const A=new c2(c,T.elevationTileID);this.addElevatedGeometry(T.polygons,A,T.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h)}}else this.addGeometry(i,this.bufferData)}addElevatedGeometry(t,i,c,h,p){const g={elevation:c,elevationSampler:i,bias:h,index:p},[w,T]=this.addGeometry(t,this.elevationBufferData,g);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:w,max:T}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,w),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,T))}addGeometry(t,i,c){let h=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,g=null;c&&(g=c.elevationSampler.constantElevation(c.elevation,c.bias),g!=null&&(h=g,p=g));const w=(T,A,M)=>{if(c!=null)if(A.push(T),g!=null)i.elevatedLayoutVertexArray.emplaceBack(g),M.push(g);else{const O=c.elevationSampler.pointElevation(T,c.elevation,c.bias);i.elevatedLayoutVertexArray.emplaceBack(O),M.push(O),h=Math.min(h,O),p=Math.max(p,O)}};for(const T of t){let A=0;for(const ue of T)A+=ue.length;const M=i.triangleSegments.prepareSegment(A,i.layoutVertexArray,i.indexArray),O=M.vertexLength,z=[],U=[],V=[],H=[],re=[],ne=i.layoutVertexArray.length;for(const ue of T){if(ue.length===0)continue;ue!==T[0]&&U.push(z.length/2);const X=i.lineSegments.prepareSegment(ue.length,i.layoutVertexArray,i.lineIndexArray),se=X.vertexLength;c&&re.push(i.layoutVertexArray.length-ne),w(ue[0],V,H),i.layoutVertexArray.emplaceBack(ue[0].x,ue[0].y),i.lineIndexArray.emplaceBack(se+ue.length-1,se),z.push(ue[0].x),z.push(ue[0].y);for(let he=1;he<ue.length;he++)w(ue[he],V,H),i.layoutVertexArray.emplaceBack(ue[he].x,ue[he].y),i.lineIndexArray.emplaceBack(se+he-1,se+he),z.push(ue[he].x),z.push(ue[he].y);X.vertexLength+=ue.length,X.primitiveLength+=ue.length}const de=Fl(z,U);for(let ue=0;ue<de.length;ue+=3)i.indexArray.emplaceBack(O+de[ue],O+de[ue+1],O+de[ue+2]);if(de.length>0&&c&&this.elevationMode==="hd-road-base"){const ue=c.elevation.isTunnel(),X=c.elevation.safeArea,se=this.elevatedStructures.addVertices(V,H);this.elevatedStructures.addTriangles(de,se,ue);const he=re.length;if(he>0){for(let _e=0;_e<he-1;_e++)this.elevatedStructures.addRenderableRing(c.index,re[_e]+se,re[_e+1]-re[_e],ue,X);this.elevatedStructures.addRenderableRing(c.index,re[he-1]+se,V.length-re[he-1],ue,X)}}M.vertexLength+=A,M.primitiveLength+=de.length/3}return[h,p]}prepareElevatedPolygons(t,i,c){const h=1/Ve(c),p=[];for(const g of t){const w=SF(g,new l2(i,h));p.push(...w)}return p}clipPolygonsToTile(t,i){const c=-i,h=-i,p=zt+i,g=zt+i;let w=0;const T=[],A=[];for(;w<t.length;w++){const z=t[w],U=Tf(z);(U.min.x>=c&&U.max.x<=p&&U.min.y>=h&&U.max.y<=g?T:A).push(z)}if(T.length===t.length)return t;const M=[new Dt(c,h),new Dt(p,h),new Dt(p,g),new Dt(c,g),new Dt(c,h)],O=T;for(const z of A)O.push(...wF(z,M));return O}}let m2,g2,_2,y2;qt($x,"FillBucket",{omit:["layers","patternFeatures"]}),qt(Vx,"FillBufferData"),qt(Nl,"ElevatedStructures");class Gx{constructor(t,i,c,h){if(this.triangleCount=i.length/3,this.min=new Dt(0,0),this.max=new Dt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;const[p,g]=[t[0].clone(),t[0].clone()];for(let O=1;O<t.length;++O){const z=t[O];p.x=Math.min(p.x,z.x),p.y=Math.min(p.y,z.y),g.x=Math.max(g.x,z.x),g.y=Math.max(g.y,z.y)}if(h){const O=Math.ceil(Math.max(g.x-p.x,g.y-p.y)/h);c=Math.max(c,O)}if(c===0)return;this.min=p,this.max=g;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const T=Math.max(w.x,w.y)/c;this.cellsX=Math.max(1,Math.ceil(w.x/T)),this.cellsY=Math.max(1,Math.ceil(w.y/T)),this.xScale=1/T,this.yScale=1/T;const A=[];for(let O=0;O<this.triangleCount;O++){const z=t[i[3*O+0]].sub(this.min),U=t[i[3*O+1]].sub(this.min),V=t[i[3*O+2]].sub(this.min),H=td(Math.floor(Math.min(z.x,U.x,V.x)),this.xScale,this.cellsX),re=td(Math.floor(Math.max(z.x,U.x,V.x)),this.xScale,this.cellsX),ne=td(Math.floor(Math.min(z.y,U.y,V.y)),this.yScale,this.cellsY),de=td(Math.floor(Math.max(z.y,U.y,V.y)),this.yScale,this.cellsY),ue=new Dt(0,0),X=new Dt(0,0),se=new Dt(0,0),he=new Dt(0,0);for(let _e=ne;_e<=de;++_e){ue.y=X.y=_e*T,se.y=he.y=(_e+1)*T;for(let Ce=H;Ce<=re;++Ce)ue.x=se.x=Ce*T,X.x=he.x=(Ce+1)*T,(Ti(z,U,V,ue,X,he)||Ti(z,U,V,ue,he,se))&&A.push({cellIdx:_e*this.cellsX+Ce,triIdx:O})}}if(A.length===0)return;A.sort((O,z)=>O.cellIdx-z.cellIdx||O.triIdx-z.triIdx);let M=0;for(;M<A.length;){const O=A[M].cellIdx,z={start:this.payload.length,len:0};for(;M<A.length&&A[M].cellIdx===O;)++z.len,this.payload.push(A[M++].triIdx);this.cells[O]=z}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,i){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const c=td(t.x-this.min.x,this.xScale,this.cellsX),h=td(t.y-this.min.y,this.yScale,this.cellsY),p=this.cells[h*this.cellsX+c];if(p){this._lazyInitLookup();for(let g=0;g<p.len;g++){const w=this.payload[p.start+g],T=Math.floor(w/8),A=1<<w%8;if(!(this.lookup[T]&A)&&(this.lookup[T]|=A,i.push(w),i.length===this.triangleCount))return}}}query(t,i,c){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>i.x||t.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const h=td(t.x-this.min.x,this.xScale,this.cellsX),p=td(i.x-this.min.x,this.xScale,this.cellsX),g=td(t.y-this.min.y,this.yScale,this.cellsY),w=td(i.y-this.min.y,this.yScale,this.cellsY);for(let T=g;T<=w;T++)for(let A=h;A<=p;A++){const M=this.cells[T*this.cellsX+A];if(M)for(let O=0;O<M.len;O++){const z=this.payload[M.start+O],U=Math.floor(z/8),V=1<<z%8;if(!(this.lookup[U]&V)&&(this.lookup[U]|=V,c.push(z),c.length===this.triangleCount))return}}}}function td(a,t,i){return Math.max(0,Math.min(i-1,Math.floor(a*t)))}qt(Gx,"TriangleGridIndex");class v2{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(t,i){for(const c of this.footprints)i.push({footprint:c,id:t})}populate(t,i,c,h){const p=[];for(const{feature:g,id:w,index:T,sourceLayerIndex:A}of t){const M=this.layers[0]._featureFilter.needGeometry,O=tr(g,M);if(!this.layers[0]._featureFilter.filter(new $n(this.zoom),O,c))continue;const z={id:w,properties:g.properties,type:g.type,sourceLayerIndex:A,index:T,geometry:M?O.geometry:Yt(g,c,h),patterns:{}};p.push(z)}for(const g of p){const{geometry:w,index:T,sourceLayerIndex:A}=g;this.addFeature(g,w,T,c,{},i.availableImages,i.brightness),i.featureIndex.insert(t[T].feature,w,T,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,i,c,h,p,g,w){}destroy(){}addFeature(t,i,c,h,p,g=[],w){for(const T of Gy(i,2)){const A=[],M=[],O=[],z=new Dt(1/0,1/0),U=new Dt(-1/0,-1/0);for(const re of T)if(re.length!==0){re!==T[0]&&O.push(M.length/2);for(let ne=0;ne<re.length;ne++)M.push(re[ne].x),M.push(re[ne].y),A.push(re[ne]),z.x=Math.min(z.x,re[ne].x),z.y=Math.min(z.y,re[ne].y),U.x=Math.max(U.x,re[ne].x),U.y=Math.max(U.y,re[ne].y)}const V=Fl(M,O),H=new Gx(A,V,8,256);this.footprints.push({vertices:A,indices:V,grid:H,min:z,max:U})}}}qt(v2,"ClipBucket",{omit:["layers"]});const TF=On([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),EF=On([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),AF=On([{name:"a_centroid_pos",components:2,type:"Uint16"}]),IF=On([{name:"a_join_normal_inside",components:3,type:"Int16"}]),PF=On([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),CF=On([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:MF}=TF,Hy=Number.MAX_SAFE_INTEGER;function x2(a,t,i,c){return a.order<t||a.order===Hy||!(a.clipMask&i)||function(h,p){return p.length!==0&&p.find(g=>g===h)===void 0}(c,a.clipScope)}function Zy(a,t){return a.x-t.x||a.y-t.y}function b2(a,t){return Zy(a.min,t.min)===0&&Zy(a.max,t.max)===0}function qx(a,t){return!(a.min.x>t.max.x||a.max.x<t.min.x||a.min.y>t.max.y||a.max.y<t.min.y)}function Wx(a,t){if(a.length!==t.length)return!1;for(let i=0;i<a.length;i++)if(a[i].sourceId!==t[i].sourceId||!b2(a[i],t[i])||a[i].order!==t[i].order||a[i].clipMask!==t[i].clipMask||!mi(a[i].clipScope,t[i].clipScope))return!1;return!0}function w2(a,t,i){const c=1/zt,h=1/(1<<i.canonical.z),p=(t.x*c+i.canonical.x)*h+i.wrap,g=(t.y*c+i.canonical.y)*h;return{min:new Dt((a.x*c+i.canonical.x)*h+i.wrap,(a.y*c+i.canonical.y)*h),max:new Dt(p,g)}}function OF(a,t,i){const c=1<<i.canonical.z,h=((t.x-i.wrap)*c-i.canonical.x)*zt,p=(t.y*c-i.canonical.y)*zt;return{min:new Dt(((a.x-i.wrap)*c-i.canonical.x)*zt,(a.y*c-i.canonical.y)*zt),max:new Dt(h,p)}}function S2(a,t,i,c,h,p,g){const w=a.indices,T=a.vertices,A=[];for(let M=c;M<c+h;M+=3){const O=t[i[M+0]+p],z=t[i[M+1]+p],U=t[i[M+2]+p],V=Math.min(O.x,z.x,U.x),H=Math.max(O.x,z.x,U.x),re=Math.min(O.y,z.y,U.y),ne=Math.max(O.y,z.y,U.y);A.length=0,a.grid.query(new Dt(V,re),new Dt(H,ne),A);for(let de=0;de<A.length;de++){const ue=A[de];if(Ti(T[w[3*ue+0]],T[w[3*ue+1]],T[w[3*ue+2]],O,z,U,g))return!0}}return!1}function T2(a,t,i,c){if(!a||!i)return!1;let h=a.vertices;if(!t.canonical.equals(c.canonical)||t.wrap!==c.wrap){if(i.vertices.length<a.vertices.length)return T2(i,c,a,t);const p=t.canonical,g=c.canonical,w=Math.pow(2,g.z-p.z);h=a.vertices.map(T=>new Dt((T.x+p.x*zt)*w-g.x*zt,(T.y+p.y*zt)*w-g.y*zt))}return S2(i,h,a.indices,0,a.indices.length,0,0)}function E2(a,t,i,c){const h=Math.pow(2,c.z-i.z);return new Dt((a+i.x*zt)*h-c.x*zt,(t+i.y*zt)*h-c.y*zt)}function A2(a,t){const i=[];t.grid.queryPoint(a,i);const c=t.indices,h=t.vertices;for(let p=0;p<i.length;p++){const g=i[p];if(Wn([h[c[3*g+0]],h[c[3*g+1]],h[c[3*g+2]]],a))return!0}return!1}const Hx=[new Dt(0,0),new Dt(zt,0),new Dt(zt,zt),new Dt(0,zt)];function I2(a,t){const i=[];let c=[];if(!t||a.length<2)return[a];if(a.length===2)return zi(a[0],a[1],Hx)?[a]:[];for(let h=0;h<a.length+2;h++){const p=a[h%a.length],g=a[(h+1)%a.length],w=zi(h===0?a[a.length-1]:a[(h-1)%a.length],p,Hx),T=zi(p,g,Hx),A=w||T;A&&c.push(p),A&&T||c.length>0&&(c.length>1&&i.push(c),c=[])}return c.length>1&&i.push(c),i}const Zx=op.VectorTileFeature.types,DF=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],kF=["fill-extrusion-flood-light-ground-radius"],RF=Math.pow(2,13),LF=Math.pow(2,15)-1,P2=new Dt(0,1),ap=2147483648;function f_(a,t,i,c,h,p,g,w){a.emplaceBack((t<<1)+g,(i<<1)+p,(Math.floor(c*RF)<<1)+h,Math.round(w))}function p_(a,t,i){a.emplaceBack(t.x*zt,t.y*zt,i?1:0)}function Xy(a,t,i,c,h,p){a.emplaceBack(t.x,t.y,(i.x<<1)+c,(i.y<<1)+h,p)}function m_(a,t,i){a.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class C2{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class M2{constructor(){this.centroidXY=new Dt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Dt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Dt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Dt(this.max.x-this.min.x,this.max.y-this.min.y)}}class O2{constructor(){this.acc=new Dt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,i){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=i.x,t.min.y=t.max.y=i.y)}appendEdge(t,i,c){this.accCount++,this.acc._add(i);let h=!!this.borders;i.x<t.min.x?(t.min.x=i.x,h=!0):i.x>t.max.x&&(t.max.x=i.x,h=!0),i.y<t.min.y?(t.min.y=i.y,h=!0):i.y>t.max.y&&(t.max.y=i.y,h=!0),((i.x===0||i.x===zt)&&i.x===c.x)!=((i.y===0||i.y===zt)&&i.y===c.y)&&this.processBorderOverlap(i,c),h&&this.checkBorderIntersection(i,c)}checkBorderIntersection(t,i){i.x<0!=t.x<0&&this.addBorderIntersection(0,xr(i.y,t.y,(0-i.x)/(t.x-i.x))),i.x>zt!=t.x>zt&&this.addBorderIntersection(1,xr(i.y,t.y,(zt-i.x)/(t.x-i.x))),i.y<0!=t.y<0&&this.addBorderIntersection(2,xr(i.x,t.x,(0-i.y)/(t.y-i.y))),i.y>zt!=t.y>zt&&this.addBorderIntersection(3,xr(i.x,t.x,(zt-i.y)/(t.y-i.y)))}addBorderIntersection(t,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[t];i<c[0]&&(c[0]=i),i>c[1]&&(c[1]=i)}processBorderOverlap(t,i){if(t.x===i.x){if(t.y===i.y)return;const c=t.x===0?0:1;this.addBorderIntersection(c,i.y),this.addBorderIntersection(c,t.y)}else{const c=t.y===0?2:3;this.addBorderIntersection(c,i.x),this.addBorderIntersection(c,t.x)}}centroid(){return this.accCount===0?new Dt(0,0):new Dt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,i)=>t+ +(i[0]!==Number.MAX_VALUE),0):0}}function D2(a,t){const i=a.add(t)._unit(),c=Fe(a.x*i.x+a.y*i.y,-1,1);var h,p,g;return h=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(h)))/4*LF*((p=a).x*(g=t).y-p.y*g.x<0?-1:1)}const zF=[a=>a.x<0,a=>a.x>zt,a=>a.y<0,a=>a.y>zt];function FF(a,t,i,c){const h=[4];if(c===0)return h;i._mult(c);const p=a.sub(i),g=t.sub(i),w=[a,t,p,g];for(let T=0;T<4;T++)for(const A of w)if(zF[T](A)){h.push(T);break}return h}class k2{constructor(t){this.vertexArray=new Kp,this.indexArray=new to,this.programConfigurations=new gc(t.layers,{zoom:t.zoom,lut:t.lut},i=>kF.includes(i)),this._segments=new Si,this.hiddenByLandmarkVertexArray=new Yd,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Si}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,i,c,h=!1){const p=t.length;if(p>2){let g=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let T;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const A=t[0],M=t[1];T=D2(A.sub(t[p-1])._perp()._unit(),M.sub(A)._perp()._unit())}for(let A=0;A<p;A++){const M=A===p-1?0:A+1,O=t[A],z=t[M],U=t[M===p-1?0:M+1],V=z.sub(O)._perp()._unit(),H=D2(V,U.sub(z)._perp()._unit()),re=T,ne=H;if(Xx(O,z,i)||h&&z2(O,i)&&z2(z,i)){T=H;continue}const de=w.vertexLength;Xy(this.vertexArray,O,z,1,1,re),Xy(this.vertexArray,O,z,1,0,re),Xy(this.vertexArray,O,z,0,1,ne),Xy(this.vertexArray,O,z,0,0,ne),w.vertexLength+=4;const ue=FF(O,z,V,c);for(const X of ue)this._segmentToGroundQuads[g].push({id:de,region:X}),this._segmentToRegionTriCounts[g][X]+=2,w.primitiveLength+=2;T=H}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),i=t.length;for(let c=0;c<i;c++)this._segmentToGroundQuads[c].sort((h,p)=>h.region-p.region);for(let c=0;c<i;c++){const h=this._segmentToGroundQuads[c],p=t[c],g=this._segmentToRegionTriCounts[c];g.reduce((T,A)=>T+A,0);let w=0;for(let T=0;T<=4;T++){const A=g[T];if(A!==0){let M=this.regionSegments[T];M||(M=this.regionSegments[T]=new Si);const O={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+w,vertexLength:p.vertexLength,primitiveLength:A};M.get().push(O)}w+=A}for(let T=0;T<h.length;T++){const A=h[T].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,i,c,h,p,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,i,c,h,p,g)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,EF.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,i,c,h,p,g,w){this.hasData()&&this.programConfigurations.updatePaintArrays(t,i,c,h,p,g,w)}updateHiddenByLandmark(t){if(!this.hasData())return;const i=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;const c=t.flags&ap?1:0;for(let h=t.groundVertexArrayOffset;h<i;++h)this.hiddenByLandmarkVertexArray.emplace(h,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,PF.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const i=this.regionSegments[t];i&&i.destroy()}}}}class Yy{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.pixelRatio=t.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new to,this.footprintVertices=new Cl,this.footprintSegments=[],this.layoutVertexArray=new Kc,this.centroidVertexArray=new rm,this.wallVertexArray=new Jd,this.indexArray=new to,this.programConfigurations=new gc(t.layers,{zoom:t.zoom,lut:t.lut},i=>DF.includes(i)),this.segments=new Si,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new k2(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(t,i){}populate(t,i,c,h){this.features=[],this.hasPattern=Rx("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ve(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:g,index:w,sourceLayerIndex:T}of t){const A=this.layers[0]._featureFilter.needGeometry,M=tr(p,A);if(!this.layers[0]._featureFilter.filter(new $n(this.zoom),M,c))continue;const O={id:g,sourceLayerIndex:T,index:w,geometry:A?M.geometry:Yt(p,c,h),properties:p.properties,type:p.type,patterns:{}},z=this.layoutVertexArray.length,U=Zx[O.type]==="Polygon";if(this.hasPattern)this.features.push(Lx("fill-extrusion",this.layers,O,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const V of O.geometry)for(const H of I2(V,U))this.addFeature(O,[H],w,c,{},i.availableImages,h,i.brightness);else this.addFeature(O,O.geometry,w,c,{},i.availableImages,h,i.brightness);i.featureIndex.insert(p,O.geometry,w,T,this.index,z)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,i,c,h,p,g){for(const w of this.features){const T=Zx[w.type]==="Polygon",{geometry:A}=w;if(this.wallMode)for(const M of A)for(const O of I2(M,T))this.addFeature(w,[O],w.index,i,c,h,p,g);else this.addFeature(w,A,w.index,i,c,h,p,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,i,c,h,p,g,w){this.programConfigurations.updatePaintArrays(t,i,p,c,h,g,w),this.groundEffect.update(t,i,p,c,h,g,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,MF),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,IF.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,CF.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,AF.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,c,h,p,g,w,T){const A=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,M=[new Dt(0,0),new Dt(zt,zt)],O=w.projection,z=O.name==="globe",U=this.wallMode||Zx[t.type]==="Polygon",V=new O2;V.centroidDataIndex=this.centroidData.length;const H=new M2,re=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},h)<=0,ne=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},h);let de;if(H.height=ne,H.vertexArrayOffset=this.layoutVertexArray.length,H.groundVertexArrayOffset=this.groundEffect.vertexArray.length,z&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Zu),this.wallMode){if(z)return void tn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;de=function(Ne){const $e=Ne[0].x===Ne[Ne.length-1].x&&Ne[0].y===Ne[Ne.length-1].y;(function(jt){let It=0;const Lr=jt.length;for(let rr=0;rr<Lr;rr++)It+=(jt[(rr+1)%Lr].x-jt[rr].x)*(jt[(rr+1)%Lr].y+jt[rr].y);return It>=0})(Ne)||(Ne=Ne.reverse());const xt={geometry:[],joinNormals:[],indices:[]},mt=[],yt=[],At=[];let tt=Ne.length;for(;tt>=2&&Ne[tt-1].equals(Ne[tt-2]);)tt--;if(tt<($e?3:2))return xt;let _t,Je,it,Pt,Mt,sr=0;for(;sr<tt-1&&Ne[sr].equals(Ne[sr+1]);)sr++;$e&&(_t=Ne[tt-2],Mt=Ne[sr].sub(_t)._unit()._perp());for(let jt=sr;jt<tt;jt++){if(it=jt===tt-1?$e?Ne[sr+1]:void 0:Ne[jt+1],it&&Ne[jt].equals(it))continue;Mt&&(Pt=Mt),_t&&(Je=_t),_t=Ne[jt],Mt=it?it.sub(_t)._unit()._perp():Pt,Pt=Pt||Mt;let It=Pt.add(Mt);It.x===0&&It.y===0||It._unit();const Lr=It.x*Mt.x+It.y*Mt.y,rr=Lr!==0?1/Lr:1/0,nr=Pt.x*Mt.y-Pt.y*Mt.x>0;let Cr="miter";const Gr=2;Cr==="miter"&&rr>Gr&&(Cr="bevel"),Cr==="bevel"&&(rr>100&&(Cr="flipbevel"),rr<Gr&&(Cr="miter"));const Xr=(cn,on,Kr,ai)=>{const vi=new Dt(cn.x,cn.y),me=new Dt(cn.x,cn.y);vi.x+=on.x*ai,vi.y+=on.y*ai,me.x-=on.x*Math.max(Kr,1),me.y-=on.y*Math.max(Kr,1),At.push(on),mt.push(vi),yt.push(me)};if(Cr==="miter")It._mult(rr),Xr(_t,It,0,0);else if(Cr==="flipbevel")It=Mt.mult(-1),Xr(_t,It,0,0),Xr(_t,It.mult(-1),0,0);else{const cn=-Math.sqrt(rr*rr-1),on=nr?cn:0,Kr=nr?0:cn;Je&&Xr(_t,Pt,on,Kr),it&&Xr(_t,Mt,on,Kr)}}xt.geometry=[...mt,...yt.reverse(),mt[0]],xt.joinNormals=[...At,...At.reverse(),At[At.length-1]];const Qt=xt.geometry.length-1;for(let jt=0;jt<Qt/2;jt++)if(jt+1<Qt/2){let It=jt,Lr=jt+1,rr=Qt-1-jt,nr=Qt-2-jt;It=It===0?Qt-1:It-1,Lr=Lr===0?Qt-1:Lr-1,rr=rr===0?Qt-1:rr-1,nr=nr===0?Qt-1:nr-1,xt.indices.push(rr),xt.indices.push(Lr),xt.indices.push(It),xt.indices.push(rr),xt.indices.push(nr),xt.indices.push(Lr)}return xt}(i[0]),i=[de.geometry]}const ue=(Ne,$e)=>Ne<($e.length-1)/2||Ne===$e.length-1,X=this.wallMode?[i]:Gy(i,500);for(let Ne=X.length-1;Ne>=0;Ne--){const $e=X[Ne];($e.length===0||(se=$e[0]).every(at=>at.x<=0)||se.every(at=>at.x>=zt)||se.every(at=>at.y<=0)||se.every(at=>at.y>=zt))&&X.splice(Ne,1)}var se;let he;if(z)he=j2(X,M,h);else{he=[];for(const Ne of X)he.push({polygon:Ne,bounds:M})}const _e=U?this.edgeRadius:0,Ce=_e>0&&this.zoom<17,Re=(Ne,$e)=>{if(Ne.length===0)return!1;const at=Ne[Ne.length-1];return $e.x===at.x&&$e.y===at.y};for(const{polygon:Ne,bounds:$e}of he){let at=0,xt=0;for(const tt of Ne)U&&!tt[0].equals(tt[tt.length-1])&&tt.push(tt[0]),xt+=U?tt.length-1:tt.length;const mt=this.segments.prepareSegment((U?5:4)*xt,this.layoutVertexArray,this.indexArray);H.footprintSegIdx<0&&(H.footprintSegIdx=this.footprintSegments.length),H.polygonSegIdx<0&&(H.polygonSegIdx=this.polygonSegments.length);const yt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},At=new C2;if(At.vertexOffset=this.footprintVertices.length,At.indexOffset=3*this.footprintIndices.length,At.ringIndices=[],U){const tt=[],_t=[];at=mt.vertexLength;for(let it=0;it<Ne.length;it++){const Pt=Ne[it];Pt.length&&it!==0&&_t.push(tt.length/2);const Mt=[];let sr,Qt;sr=Pt[1].sub(Pt[0])._perp()._unit(),At.ringIndices.push(Pt.length-1);for(let jt=1;jt<Pt.length;jt++){const It=Pt[jt],Lr=Pt[jt===Pt.length-1?1:jt+1],rr=It.clone();if(_e){Qt=Lr.sub(It)._perp()._unit();const nr=sr.add(Qt)._unit(),Cr=_e*Math.min(4,1/(sr.x*nr.x+sr.y*nr.y));rr.x+=Cr*nr.x,rr.y+=Cr*nr.y,rr.x=Math.round(rr.x),rr.y=Math.round(rr.y),sr=Qt}if(!re||_e!==0&&!Ce||Re(Mt,rr)||Mt.push(rr),f_(this.layoutVertexArray,rr.x,rr.y,0,0,1,1,0),this.wallMode){const nr=ue(jt,Pt);p_(this.wallVertexArray,de.joinNormals[jt],!nr)}mt.vertexLength++,this.footprintVertices.emplaceBack(It.x,It.y),tt.push(It.x,It.y),z&&m_(this.layoutVertexExtArray,O.projectTilePoint(rr.x,rr.y,h),O.upVector(h,rr.x,rr.y))}re&&(_e===0||Ce)&&(Mt.length!==0&&Re(Mt,Mt[0])&&Mt.pop(),this.groundEffect.addData(Mt,$e,A))}const Je=this.wallMode?de.indices:Fl(tt,_t);for(let it=0;it<Je.length;it+=3)this.footprintIndices.emplaceBack(At.vertexOffset+Je[it+0],At.vertexOffset+Je[it+1],At.vertexOffset+Je[it+2]),this.indexArray.emplaceBack(at+Je[it],at+Je[it+2],at+Je[it+1]),mt.primitiveLength++;At.indexCount+=Je.length,At.vertexCount+=this.footprintVertices.length-At.vertexOffset}for(let tt=0;tt<Ne.length;tt++){const _t=Ne[tt];V.startRing(H,_t[0]);let Je=_t.length>4&&F2(_t[_t.length-2],_t[0],_t[1]),it=_e?NF(_t[_t.length-2],_t[0],_t[1],_e):0;const Pt=[];let Mt,sr,Qt;sr=_t[1].sub(_t[0])._perp()._unit();let jt=!0;for(let It=1,Lr=0;It<_t.length;It++){let rr=_t[It-1],nr=_t[It];const Cr=_t[It===_t.length-1?1:It+1];if(V.appendEdge(H,nr,rr),Xx(nr,rr,$e)){_e&&(sr=Cr.sub(nr)._perp()._unit(),jt=!jt);continue}const Gr=nr.sub(rr)._perp(),Xr=Gr.x/(Math.abs(Gr.x)+Math.abs(Gr.y)),cn=Gr.y>0?1:0,on=rr.dist(nr);if(Lr+on>32768&&(Lr=0),_e){Qt=Cr.sub(nr)._perp()._unit();let me=L2(rr,nr,Cr,R2(sr,Qt),_e);isNaN(me)&&(me=0);const ve=nr.sub(rr)._unit();rr=rr.add(ve.mult(it))._round(),nr=nr.add(ve.mult(-me))._round(),it=me,sr=Qt,re&&this.zoom>=17&&(Re(Pt,rr)||Pt.push(rr),Re(Pt,nr)||Pt.push(nr))}const Kr=mt.vertexLength,ai=_t.length>4&&F2(rr,nr,Cr);let vi=N2(Lr,Je,jt);if(f_(this.layoutVertexArray,rr.x,rr.y,Xr,cn,0,0,vi),f_(this.layoutVertexArray,rr.x,rr.y,Xr,cn,0,1,vi),this.wallMode){const me=ue(It-1,_t),ve=de.joinNormals[It-1];p_(this.wallVertexArray,ve,me),p_(this.wallVertexArray,ve,me)}if(Lr+=on,vi=N2(Lr,ai,!jt),Je=ai,f_(this.layoutVertexArray,nr.x,nr.y,Xr,cn,0,0,vi),f_(this.layoutVertexArray,nr.x,nr.y,Xr,cn,0,1,vi),this.wallMode){const me=ue(It,_t),ve=de.joinNormals[It];p_(this.wallVertexArray,ve,me),p_(this.wallVertexArray,ve,me)}if(mt.vertexLength+=4,this.indexArray.emplaceBack(Kr+0,Kr+1,Kr+2),this.indexArray.emplaceBack(Kr+1,Kr+3,Kr+2),mt.primitiveLength+=2,_e){const me=at+(It===1?_t.length-2:It-2),ve=It===1?at:me+1;if(this.indexArray.emplaceBack(Kr+1,me,Kr+3),this.indexArray.emplaceBack(me,ve,Kr+3),mt.primitiveLength+=2,Mt===void 0&&(Mt=Kr),!Xx(Cr,_t[It],$e)){const lt=It===_t.length-1?Mt:mt.vertexLength;this.indexArray.emplaceBack(Kr+2,Kr+3,lt),this.indexArray.emplaceBack(Kr+3,lt+1,lt),this.indexArray.emplaceBack(Kr+3,ve,lt+1),mt.primitiveLength+=3}jt=!jt}if(z){const me=this.layoutVertexExtArray,ve=O.projectTilePoint(rr.x,rr.y,h),lt=O.projectTilePoint(nr.x,nr.y,h),Rt=O.upVector(h,rr.x,rr.y),$t=O.upVector(h,nr.x,nr.y);m_(me,ve,Rt),m_(me,ve,Rt),m_(me,lt,$t),m_(me,lt,$t)}}U&&(at+=_t.length-1),re&&_e&&this.zoom>=17&&(Pt.length!==0&&Re(Pt,Pt[0])&&Pt.pop(),this.groundEffect.addData(Pt,$e,A,_e>0))}this.footprintSegments.push(At),yt.triangleCount=this.indexArray.length-yt.triangleArrayOffset,this.polygonSegments.push(yt),++H.footprintSegLen,++H.polygonSegLen}if(H.vertexCount=this.layoutVertexArray.length-H.vertexArrayOffset,H.groundVertexCount=this.groundEffect.vertexArray.length-H.groundVertexArrayOffset,H.vertexCount!==0){if(H.centroidXY=V.borders?P2:this.encodeCentroid(V,H),this.centroidData.push(H),V.borders){this.featuresOnBorder.push(V);const Ne=this.featuresOnBorder.length-1;for(let $e=0;$e<V.borders.length;$e++)V.borders[$e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[$e].push(Ne)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,p,g,h,T),this.groundEffect.addPaintPropertiesData(t,c,p,g,h,T),this.maxHeight=Math.max(this.maxHeight,ne)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((i,c)=>this.featuresOnBorder[i].borders[t][0]-this.featuresOnBorder[c].borders[t][0])}splitToSubtiles(){const t=[];for(let w=0;w<this.centroidData.length;w++){const T=this.centroidData[w],A=+(T.min.y+T.max.y>zt),M=2*A+(+(T.min.x+T.max.x>zt)^A);for(let O=0;O<T.polygonSegLen;O++){const z=T.polygonSegIdx+O;t.push({centroidIdx:w,subtile:M,polygonSegmentIdx:z,triangleSegmentIdx:this.polygonSegments[z].triangleSegIdx})}}const i=new to;t.sort((w,T)=>w.triangleSegmentIdx===T.triangleSegmentIdx?w.subtile-T.subtile:w.triangleSegmentIdx-T.triangleSegmentIdx);let c=0,h=0,p=0;for(const w of t){if(w.triangleSegmentIdx!==c)break;p++}const g=t.length;for(;h!==t.length;){c=t[h].triangleSegmentIdx;let w=0,T=h,A=h;for(let M=T;M<p&&t[M].subtile===w;M++)A++;for(;T!==p;){const M=t[T];w=M.subtile;const O=this.centroidData[M.centroidIdx].min.clone(),z=this.centroidData[M.centroidIdx].max.clone(),U={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let V=T;V<A;V++){const H=t[V],re=this.polygonSegments[H.polygonSegmentIdx],ne=this.centroidData[H.centroidIdx].min,de=this.centroidData[H.centroidIdx].max,ue=this.indexArray.uint16;for(let X=re.triangleArrayOffset;X<re.triangleArrayOffset+re.triangleCount;X++)i.emplaceBack(ue[3*X],ue[3*X+1],ue[3*X+2]);U.primitiveLength+=re.triangleCount,O.x=Math.min(O.x,ne.x),O.y=Math.min(O.y,ne.y),z.x=Math.max(z.x,de.x),z.y=Math.max(z.y,de.y)}U.primitiveLength>0&&this.triangleSubSegments.push({segment:U,min:O,max:z}),T=A;for(let V=T;V<p&&t[V].subtile===t[T].subtile;V++)A++}h=p;for(let M=h;M<g&&t[M].triangleSegmentIdx===t[h].triangleSegmentIdx;M++)p++}i._trim(),this.indexArray=i}getVisibleSegments(t,i,c){const h=new Si;if(this.wallMode){for(const H of this.triangleSubSegments)h.segments.push(H.segment);return h}let p=0,g=0;const w=1<<t.canonical.z;if(i){const H=i.getMinMaxForTile(t);H&&(p=H.min,g=H.max)}g+=this.maxHeight;const T=t.toUnwrapped();let A;const M=[T.canonical.x/w+T.wrap,T.canonical.y/w],O=[(T.canonical.x+1)/w+T.wrap,(T.canonical.y+1)/w],z=(H,re,ne)=>[H[0]*(1-ne[0])+re[0]*ne[0],H[1]*(1-ne[1])+re[1]*ne[1]],U=[],V=[];for(const H of this.triangleSubSegments){U[0]=H.min.x/zt,U[1]=H.min.y/zt,V[0]=H.max.x/zt,V[1]=H.max.y/zt;const re=z(M,O,U),ne=z(M,O,V);if(new yi([re[0],re[1],p],[ne[0],ne[1],g]).intersectsPrecise(c)===0){A&&(h.segments.push(A),A=void 0);continue}const de=H.segment;A&&A.vertexOffset!==de.vertexOffset&&(h.segments.push(A),A=void 0),A?(A.vertexLength+=de.vertexLength,A.primitiveLength+=de.primitiveLength):A={vertexOffset:de.vertexOffset,primitiveLength:de.primitiveLength,vertexLength:de.vertexLength,primitiveOffset:de.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&h.segments.push(A),h}encodeCentroid(t,i){const c=t.centroid(),h=i.span(),p=Math.min(7,Math.round(h.x*this.tileToMeter/10)),g=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new Dt(Fe(c.x,1,zt-1)<<3|p,Fe(c.y,1,zt-1)<<3|g)}encodeBorderCentroid(t){if(!t.borders)return new Dt(0,0);const i=t.borders,c=Number.MAX_VALUE;if(i[0][0]!==c||i[1][0]!==c){const h=i[0][0]!==c?0:1;return new Dt(6|(i[0][0]!==c?0:65528),(i[h][0]+i[h][1])/2<<3|6)}{const h=i[2][0]!==c?2:3;return new Dt((i[h][0]+i[h][1])/2<<3|6,6|(i[2][0]!==c?0:65528))}}showCentroid(t){const i=this.centroidData[t.centroidDataIndex];i.flags&=ap,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const i=t.vertexArrayOffset,c=t.vertexCount+t.vertexArrayOffset,h=t.flags&ap?P2:t.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==h.y||p!==h.x){for(let g=i;g<c;++g)this.centroidVertexArray.emplace(g,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,i,c){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(t.toUnwrapped());if(Wx(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const p=[];for(const g of this.activeReplacements){if(g.order<c)continue;const w=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-t.canonical.z));for(const T of this.centroidData)if(!(T.flags&ap||g.min.x>T.max.x||T.min.x>g.max.x||g.min.y>T.max.y||T.min.y>g.max.y))for(let A=0;A<T.footprintSegLen;A++){const M=this.footprintSegments[T.footprintSegIdx+A];if(p.length=0,BF(this.footprintVertices,M.vertexOffset,M.vertexCount,g.footprintTileId.canonical,t.canonical,p),S2(g.footprint,p,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-w)){T.flags|=ap;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,i,c){let h=!1;for(let p=0;p<c.footprintSegLen;p++){const g=this.footprintSegments[c.footprintSegIdx+p];let w=0;for(const T of g.ringIndices){for(let A=w,M=T+w-1;A<T+w;M=A++){const O=this.footprintVertices.int16[2*(A+g.vertexOffset)+0],z=this.footprintVertices.int16[2*(A+g.vertexOffset)+1],U=this.footprintVertices.int16[2*(M+g.vertexOffset)+1];z>i!=U>i&&t<(this.footprintVertices.int16[2*(M+g.vertexOffset)+0]-O)*(i-z)/(U-z)+O&&(h=!h)}w=T}}return h}getHeightAtTileCoord(t,i){let c=Number.NEGATIVE_INFINITY,h=!0;const p=4*(t+zt)*zt+(i+zt);if(this.partLookup.hasOwnProperty(p)){const g=this.partLookup[p];return g?{height:g.height,hidden:!!(g.flags&ap)}:void 0}for(const g of this.centroidData)t>g.max.x||g.min.x>t||i>g.max.y||g.min.y>i||this.footprintContainsPoint(t,i,g)&&g&&g.height>c&&(c=g.height,this.partLookup[p]=g,h=!!(g.flags&ap));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:h};this.partLookup[p]=void 0}}function R2(a,t){const i=a.add(t)._unit();return a.x*i.x+a.y*i.y}function NF(a,t,i,c){const h=t.sub(a)._perp()._unit(),p=i.sub(t)._perp()._unit();return L2(a,t,i,R2(h,p),c)}function L2(a,t,i,c,h){const p=Math.sqrt(1-c*c);return Math.min(a.dist(t)/3,t.dist(i)/3,h*p/c)}function Xx(a,t,i){return a.x<i[0].x&&t.x<i[0].x||a.x>i[1].x&&t.x>i[1].x||a.y<i[0].y&&t.y<i[0].y||a.y>i[1].y&&t.y>i[1].y}function z2(a,t){return a.x<t[0].x||a.x>t[1].x||a.y<t[0].y||a.y>t[1].y}function F2(a,t,i){if(a.x<0||a.x>=zt||t.x<0||t.x>=zt||i.x<0||i.x>=zt)return!1;const c=i.sub(t),h=c.perp(),p=a.sub(t);return(c.x*p.x+c.y*p.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function N2(a,t,i){const c=t?2|a:-3&a;return i?1|c:-2&c}function B2(){const a=Math.PI/32,t=Math.tan(a),i=Y;return i*Math.sqrt(1+2*t*t)-i}function j2(a,t,i){const c=1<<i.z,h=Ie(i.x/c),p=Ie((i.x+1)/c),g=Oe(i.y/c),w=Oe((i.y+1)/c);return function(T,A,M,O,z=0,U){const V=[];if(!T.length||!M||!O)return V;const H=(he,_e)=>{for(const Ce of he)V.push({polygon:Ce,bounds:_e})},re=Math.ceil(Math.log2(M)),ne=Math.ceil(Math.log2(O)),de=re-ne,ue=[];for(let he=0;he<Math.abs(de);he++)ue.push(de>0?0:1);for(let he=0;he<Math.min(re,ne);he++)ue.push(0),ue.push(1);let X=T;if(X=Wy(X,A[0].y-z,A[1].y+z,1),X=Wy(X,A[0].x-z,A[1].x+z,0),!X.length)return V;const se=[];for(ue.length?se.push({polygons:X,bounds:A,depth:0}):H(X,A);se.length;){const he=se.pop(),_e=he.depth,Ce=ue[_e],Re=he.bounds[0],Ne=he.bounds[1],$e=Ce===0?Re.x:Re.y,at=Ce===0?Ne.x:Ne.y,xt=U?U(Ce,$e,at):.5*($e+at),mt=Wy(he.polygons,$e-z,xt+z,Ce),yt=Wy(he.polygons,xt-z,at+z,Ce);if(mt.length){const At=[Re,new Dt(Ce===0?xt:Ne.x,Ce===1?xt:Ne.y)];ue.length>_e+1?se.push({polygons:mt,bounds:At,depth:_e+1}):H(mt,At)}if(yt.length){const At=[new Dt(Ce===0?xt:Re.x,Ce===1?xt:Re.y),Ne];ue.length>_e+1?se.push({polygons:yt,bounds:At,depth:_e+1}):H(yt,At)}}return V}(a,t,Math.ceil((p-h)/11.25),Math.ceil((g-w)/11.25),1,(T,A,M)=>{if(T===0)return .5*(A+M);{const O=Oe((i.y+A/zt)/c);return(we(.5*(Oe((i.y+M/zt)/c)+O))*c-i.y)*zt}})}function BF(a,t,i,c,h,p){const g=Math.pow(2,c.z-h.z);for(let w=0;w<i;w++){let T=a.int16[2*(w+t)+0],A=a.int16[2*(w+t)+1];T=(T+h.x*zt)*g-c.x*zt,A=(A+h.y*zt)*g-c.y*zt,p.push(new Dt(T,A))}}let U2,V2;qt(Yy,"FillExtrusionBucket",{omit:["layers","features"]}),qt(M2,"PartData"),qt(C2,"FootprintSegment"),qt(O2,"BorderCentroidData"),qt(k2,"GroundEffect");class pm extends Dt{constructor(t,i,c){super(t,i),this.z=c}}class $2 extends pm{constructor(t,i,c,h){super(t,i,c),this.w=h}}function G2(a,t,i,c){const h=i==="x"?"y":"x",p=(c-a[i])/(t[i]-a[i]);a[h]=Math.round(a[h]+(t[h]-a[h])*p),a[i]=c,a.hasOwnProperty("z")&&(a.z=xr(a.z,t.z,p)),a.hasOwnProperty("w")&&(a.w=xr(a.w,t.w,p))}function q2(a,t,i,c){const h=i,p=c;for(const g of["x","y"]){let w=a,T=t;w[g]>=T[g]&&(w=t,T=a),w[g]<h&&T[g]>h&&G2(w,T,g,h),w[g]<p&&T[g]>p&&G2(T,w,g,p)}}function Ky(a,t,i,c,h,p){const g=[];for(let w=0;w<a.length;w++){const T=a[w];let A;const M=g.length;let O=0;for(let z=0;z<T.length-1;z++){let U=T[z],V=T[z+1],H=0;const re=O;let ne,de;p&&(H=Math.hypot(V.x-U.x,V.y-U.y),O+=H,ne=U,de=V),U.x<t&&V.x<t||(U.x<t?U=new Dt(t,U.y+(t-U.x)/(V.x-U.x)*(V.y-U.y))._round():V.x<t&&(V=new Dt(t,U.y+(t-U.x)/(V.x-U.x)*(V.y-U.y))._round()),U.y<i&&V.y<i||(U.y<i?U=new Dt(U.x+(i-U.y)/(V.y-U.y)*(V.x-U.x),i)._round():V.y<i&&(V=new Dt(U.x+(i-U.y)/(V.y-U.y)*(V.x-U.x),i)._round()),U.x>=c&&V.x>=c||(U.x>=c?U=new Dt(c,U.y+(c-U.x)/(V.x-U.x)*(V.y-U.y))._round():V.x>=c&&(V=new Dt(c,U.y+(c-U.x)/(V.x-U.x)*(V.y-U.y))._round()),U.y>=h&&V.y>=h||(U.y>=h?U=new Dt(U.x+(h-U.y)/(V.y-U.y)*(V.x-U.x),h)._round():V.y>=h&&(V=new Dt(U.x+(h-U.y)/(V.y-U.y)*(V.x-U.x),h)._round()),A&&U.equals(A[A.length-1])||(A=[U],g.push(A),p&&p.push({progress:{min:re+W2(ne,de,U)*H,max:1},parentIndex:w,prevPoint:ne,nextPoint:de})),A.push(V),p&&(p[p.length-1].progress.max=re+W2(ne,de,V)*H,p[p.length-1].nextPoint=de)))))}if(p&&O>0)for(let z=M;z<g.length;z++)p[z].progress.min/=O,p[z].progress.max/=O}return g}function jF(a,t,i,c,h){if(a.length<2)return void c.push(a);const p=[];for(;t.valid();){const[A,M]=t.get();for(let O=0;O<a.length-1;O++){const z=a[O],U=a[O+1],V=_i(z,U,A,M);if(V){const[H]=V,re=new Dt(xr(z.x,U.x,H),xr(z.y,U.y,H));p.push({t:O+H,distance:0,point:re})}}t.next()}if(p.length===0)return void c.push(a);p.sort((A,M)=>A.t-M.t);let g=0,w=0,T=[];for(c.push(T);g!==a.length;){if(w===p.length){for(;g!==a.length;)T.length!==0&&T[T.length-1].equals(a[g])||T.push(a[g]),g++;break}p[w].t<=g?(T.length!==0&&T[T.length-1].equals(p[w].point)||T.push(p[w].point),Math.trunc(p[w].t),w++):(T.length!==0&&T[T.length-1].equals(a[g])||T.push(a[g]),g++)}}function W2(a,t,i){return a.x!==t.x?(i.x-a.x)/(t.x-a.x):a.y!==t.y?(i.y-a.y)/(t.y-a.y):0}function g_(a,t){return a.x*t.x+a.y*t.y}function H2(a,t){if(a.length===1){let i=0;const c=t[i++];let h;for(;!h||c.equals(h);)if(h=t[i++],!h)return 1/0;for(;i<t.length;i++){const p=t[i],g=a[0],w=h.sub(c),T=p.sub(c),A=g.sub(c),M=g_(w,w),O=g_(w,T),z=g_(T,T),U=g_(A,w),V=g_(A,T),H=M*z-O*O,re=(z*U-O*V)/H,ne=(M*V-O*U)/H,de=c.z*(1-re-ne)+h.z*re+p.z*ne;if(isFinite(de))return de}return 1/0}{let i=1/0;for(const c of t)i=Math.min(i,c.z);return i}}function Z2(a,t,i,c,h,p,g,w){const T=g*h.getElevationAt(a,t,!0,!0),A=p[0]!==0,M=A?p[1]===0?g*(p[0]/7-450):g*function(O,z,U){const V=Math.floor(z[0]/8),H=Math.floor(z[1]/8),re=10*(z[0]-8*V),ne=10*(z[1]-8*H),de=O.getElevationAt(V,H,!0,!0),ue=O.getMeterToDEM(U),X=Math.floor(.5*(re*ue-1)),se=Math.floor(.5*(ne*ue-1)),he=O.tileCoordToPixel(V,H),_e=2*X+1,Ce=2*se+1,Re=function(yt,At,tt,_t,Je){return[yt.getElevationAtPixel(At,tt,!0),yt.getElevationAtPixel(At+Je,tt,!0),yt.getElevationAtPixel(At,tt+Je,!0),yt.getElevationAtPixel(At+_t,tt+Je,!0)]}(O,he.x-X,he.y-se,_e,Ce),Ne=Math.abs(Re[0]-Re[1]),$e=Math.abs(Re[2]-Re[3]),at=Math.abs(Re[0]-Re[2])+Math.abs(Re[1]-Re[3]),xt=Math.min(.25,.5*ue*(Ne+$e)/_e),mt=Math.min(.25,.5*ue*at/Ce);return de+Math.max(xt*re,mt*ne)}(h,p,w):T;return{base:T+(i===0?-1:i),top:A?Math.max(M+c,T+i+2):T+c}}const UF=On([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),VF=On([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:$F}=UF,GF=On([{name:"a_packed",components:3,type:"Float32"}]),{members:qF}=GF,WF=On([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:HF}=WF;class X2{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.image=new Tt({width:t,height:i}),this.positions={},this.uploaded=!1}getDash(t,i){const c=this.getKey(t,i);return this.positions[c]}trim(){const t=this.width,i=this.height=Ot(this.nextRow);this.image.resize({width:t,height:i})}getKey(t,i){return t.join(",")+i}getDashRanges(t,i,c){const h=[];let p=t.length%2==1?-t[t.length-1]*c:0,g=t[0]*c,w=!0;h.push({left:p,right:g,isDash:w,zeroLength:t[0]===0});let T=t[0];for(let A=1;A<t.length;A++){w=!w;const M=t[A];p=T*c,T+=M,g=T*c,h.push({left:p,right:g,isDash:w,zeroLength:M===0})}return h}addRoundDash(t,i,c){const h=i/2;for(let p=-c;p<=c;p++){const g=this.width*(this.nextRow+c+p);let w=0,T=t[w];for(let A=0;A<this.width;A++){A/T.right>1&&(T=t[++w]);const M=Math.abs(A-T.left),O=Math.abs(A-T.right),z=Math.min(M,O);let U;const V=p/c*(h+1);if(T.isDash){const H=h-Math.abs(V);U=Math.sqrt(z*z+H*H)}else U=h-Math.sqrt(z*z+V*V);this.image.data[g+A]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(t,i){for(let T=t.length-1;T>=0;--T){const A=t[T],M=t[T+1];A.zeroLength?t.splice(T,1):M&&M.isDash===A.isDash&&(M.left=A.left,t.splice(T,1))}const c=t[0],h=t[t.length-1];c.isDash===h.isDash&&(c.left=h.left-this.width,h.right=c.right+this.width);const p=this.width*this.nextRow;let g=0,w=t[g];for(let T=0;T<this.width;T++){T/w.right>1&&(w=t[++g]);const A=Math.abs(T-w.left),M=Math.abs(T-w.right),O=Math.min(A,M);this.image.data[p+T]=Math.max(0,Math.min(255,(w.isDash?O:-O)+i+128))}}addDash(t,i){const c=this.getKey(t,i);if(this.positions[c])return this.positions[c];const h=i==="round",p=h?7:0,g=2*p+1;if(this.nextRow+g>this.height)return tn("LineAtlas out of space"),null;t.length===0&&t.push(1);let w=0;for(let M=0;M<t.length;M++)t[M]<0&&(tn("Negative value is found in line dasharray, replacing values with 0"),t[M]=0),w+=t[M];if(w!==0){const M=this.width/w,O=this.getDashRanges(t,this.width,M);h?this.addRoundDash(O,M,p):this.addRegularDash(O,i==="square"?.5*M:0)}const T=this.nextRow+p;this.nextRow+=g;const A={tl:[T,p],br:[w,0]};return this.positions[c]=A,A}}qt(X2,"LineAtlas");const ZF=op.VectorTileFeature.types,XF=Math.cos(Math.PI/180*37.5),YF=Math.cos(Math.PI/180*5);class Yx{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.pixelRatio=t.pixelRatio,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new jf,this.layoutVertexArray2=new Ys,this.patternVertexArray=new Ys,this.indexArray=new to,this.programConfigurations=new gc(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new Si,this.maxLineLength=0,this.zOffsetVertexArray=new Ys,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=t.tessellationStep?t.tessellationStep:zt/64}updateFootprints(t,i){}populate(t,i,c,h){this.hasPattern=Rx("line",this.layers,this.pixelRatio,i);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ve(c);const g=this.layers[0].layout.get("line-elevation-reference");if(g==="hd-road-markup")this.elevationType="road";else{const z=this.layers[0].layout.get("line-z-offset"),U=z.isConstant()&&!z.constantOr(0);this.elevationType=g!=="sea"&&g!=="ground"&&U?"none":"offset",this.elevationType==="offset"&&g==="none"&&tn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const w=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&w!==void 0;const T=[];for(const{feature:z,id:U,index:V,sourceLayerIndex:H}of t){const re=this.layers[0]._featureFilter.needGeometry,ne=tr(z,re);if(!this.layers[0]._featureFilter.filter(new $n(this.zoom),ne,c))continue;const de=p?p.evaluate(ne,{},c):void 0,ue={id:U,properties:z.properties,type:z.type,sourceLayerIndex:H,index:V,geometry:re?ne.geometry:Yt(z,c,h),patterns:{},sortKey:de};T.push(ue)}p&&T.sort((z,U)=>z.sortKey-U.sortKey);const{lineAtlas:A,featureIndex:M}=i,O=this.addConstantDashes(A);for(const z of T){const{geometry:U,index:V,sourceLayerIndex:H}=z;if(O&&this.addFeatureDashes(z,A),this.hasPattern){const re=Lx("line",this.layers,z,this.zoom,this.pixelRatio,i);this.patternFeatures.push(re)}else this.addFeature(z,U,V,c,A.positions,i.availableImages,i.brightness,i.elevationFeatures);M.insert(t[V].feature,U,V,H,this.index)}}addConstantDashes(t){let i=!1;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")i=!0;else{const g=p.value,w=h.value;if(!w)continue;t.addDash(w,g)}}return i}addFeatureDashes(t,i){const c=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if(p.kind==="constant"&&g.kind==="constant")continue;let w,T;if(p.kind==="constant"){if(w=p.value,!w)continue}else w=p.evaluate({zoom:c},t);T=g.kind==="constant"?g.value:g.evaluate({zoom:c},t),i.addDash(w,T),t.patterns[h.id]=[i.getKey(w,T)]}}update(t,i,c,h,p,g,w){this.programConfigurations.updatePaintArrays(t,i,p,c,h,g,w)}addFeatures(t,i,c,h,p,g){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,i,c,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,qF)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,HF)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,VF.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,$F),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,c,h,p,g,w,T){const A=this.layers[0].layout,M=A.get("line-join").evaluate(t,{}),O=A.get("line-cap").evaluate(t,{}),z=A.get("line-miter-limit"),U=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t,this.zOffsetValue=A.get("line-z-offset").value;const V=this.layers[0].paint.get("line-width").value;if(V.kind!=="constant"&&V.isLineProgressConstant===!1&&(this.variableWidthValue=V),this.elevationType==="road"){const H=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(t,i,h,T,M,O,z,U)){const[re,ne]=this.clipRuntimeLinesToTile(i,1);for(let de=0;de<re.length;de++){const ue=re[de],X=ne[de],se={progress:{min:X.progress.min,max:X.progress.max},nextDir:this.computeSegNextDir(X,ue),prevDir:this.computeSegPrevDir(X,ue)};this.addLine(ue,t,h,M,O,z,U,se)}this.fillNonElevatedRoadSegment(H)}}else for(const H of i)this.addLine(H,t,h,M,O,z,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,p,g,h,w)}computeSegNextDir(t,i){return t.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(t,i){return i[1].sub(t.prevPoint).unit()}clipLinesToTile(t,i){return Ky(t,-i,-i,zt+i,zt+i)}clipRuntimeLinesToTile(t,i){const c=[];return[Ky(t,-i,-i,zt+i,zt+i,c),c]}addElevatedRoadFeature(t,i,c,h,p,g,w,T){const A=[],M=jx.getElevationFeature(t,h);if(M){const O=this.clipLinesToTile(i,1),z=this.prepareElevatedLines(O,M,c);for(const U of z)A.push({geometry:U,elevation:M,elevationTileID:c,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(A.length===0)return!1;for(const O of A){const z=this.layoutVertexArray.length;this.addLine(O.geometry,t,c,p,g,w,T);const U=new c2(c,O.elevationTileID);if(O.elevation)for(let V=z;V<this.layoutVertexArray.length;V++){const H=new Dt(this.layoutVertexArray.int16[6*V]>>1,this.layoutVertexArray.int16[6*V+1]>>1),re=U.pointElevation(H,O.elevation,.05);this.updateHeightRange(re),this.zOffsetVertexArray.emplaceBack(re,0,0)}else this.fillNonElevatedRoadSegment(z)}return!0}prepareElevatedLines(t,i,c){if(i.constantHeight!=null)return t;const h=[],p=1/Ve(c);for(const g of t)jF(g,new l2(i,p),0,h);return h}fillNonElevatedRoadSegment(t){for(let i=t;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(t){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,t),this.heightRange.max=Math.max(this.heightRange.max,t)):this.heightRange={min:t,max:t}}addLine(t,i,c,h,p,g,w,T){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const A=h==="none";this.patternJoinNone=this.hasPattern&&A,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const M=T&&T.progress.min>0,O=T&&T.progress.max<1;if(this.lineClips){let Ce={min:this.lineClips.start,max:this.lineClips.end},Re=1;if(T){const at=this.lineClips.end-this.lineClips.start;Ce=function(xt,mt,yt){return{min:Ro(xt.min,mt,yt),max:Ro(xt.max,mt,yt)}}(T.progress,{min:0,max:1},Ce),at>0&&(Re=(Ce.max-Ce.min)/at)}const Ne=+i.properties.mapbox_clip_feature_len,$e=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Ne)||Number.isNaN($e)){for(let xt=0;xt<t.length-1;xt++)this.totalDistance+=t[xt].dist(t[xt+1]);const at=this.totalDistance/(Ce.max-Ce.min);this.totalFeatureLength=Number.isFinite(at)?at:0,this.lineClips.start=Ce.min,this.lineClips.end=Ce.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ne,this.distance=$e*Re,this.lineClips.start=Ce.min,this.lineClips.end=Ce.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const z=ZF[i.type]==="Polygon";let U=t.length;for(;U>=2&&t[U-1].equals(t[U-2]);)U--;let V=0;for(;V<U-1&&t[V].equals(t[V+1]);)V++;if(U<(z?3:2))return;h==="bevel"&&(g=1.05);const H=this.segments.prepareSegment(10*U,this.layoutVertexArray,this.indexArray);let re,ne,de,ue,X,se,he,_e;T&&T.prevDir&&(se=T.prevDir.perp()),T&&T.nextDir&&(he=T.nextDir.perp()),this.e1=this.e2=-1,z&&(re=t[U-2],X=t[V].sub(re)._unit()._perp());for(let Ce=V;Ce<U;Ce++){if(de=Ce===U-1?z?t[V+1]:void 0:t[Ce+1],de&&t[Ce].equals(de))continue;X&&(ue=X),re&&(ne=re),re=t[Ce],_e=this.evaluateLineProgressFeatures(ne?ne.dist(re):0),X=de?de.sub(re)._unit()._perp():ue,ue=ue||X;const Re=ne&&de;let Ne=Re?h:z||A?"butt":p;const $e=ue.x*X.x+ue.y*X.y;if(A){const Je=function(it){if(it.patternJoinNone){const Pt=it.segmentPoints.length/2,Mt=it.lineSoFar-it.segmentStart;for(let sr=0;sr<Pt;++sr){const Qt=it.segmentPoints[2*sr+1],jt=Math.round(it.segmentPoints[2*sr])+.5+.25*Qt;it.patternVertexArray.emplaceBack(jt,Mt,it.segmentStart),it.patternVertexArray.emplaceBack(jt,Mt,it.segmentStart)}it.segmentPoints.length=0}it.e1=it.e2=-1};if(Re&&$e<YF){this.updateDistance(ne,re),this.addCurrentVertex(re,ue,1,1,H,_e),Je(this),this.addCurrentVertex(re,X,-1,-1,H,_e);continue}if(ne){if(!de){this.updateDistance(ne,re),this.addCurrentVertex(re,ue,1,1,H,_e),Je(this);continue}Ne="miter"}}let at=ue.add(X);at.x===0&&at.y===0||at._unit();const xt=at.x*X.x+at.y*X.y,mt=xt!==0?1/xt:1/0,yt=2*Math.sqrt(2-2*xt),At=xt<XF&&ne&&de,tt=ue.x*X.y-ue.y*X.x>0,_t=this.overscaling<=16?15*zt/(512*this.overscaling):0;if(Re&&Ne==="round"){if(mt<w)Ne="miter";else if(mt<=2){const Je=Kx(re,-10,zt+10);Ne=this.elevationType==="offset"&&(Je||this.hasCrossSlope)?"miter":"fakeround"}}if(Ne==="miter"&&mt>g&&(Ne="bevel"),Ne==="bevel"&&(mt>2&&(Ne="flipbevel"),mt<g&&(Ne="miter")),ne&&!(Ne==="miter"&&At)&&this.updateDistance(ne,re),Ne==="miter")if(At){const Je=re.dist(ne);if(Je>2*_t){const Pt=re.sub(re.sub(ne)._mult(_t/Je)._round());this.updateDistance(ne,Pt),this.addCurrentVertex(Pt,ue,0,0,H,_e),ne=Pt}this.updateDistance(ne,re),at._mult(mt),this.addCurrentVertex(re,at,0,0,H,_e);const it=re.dist(de);if(it>2*_t){const Pt=re.add(de.sub(re)._mult(_t/it)._round());this.updateDistance(re,Pt),this.addCurrentVertex(Pt,X,0,0,H,_e),re=Pt}}else at._mult(mt),this.addCurrentVertex(re,at,0,0,H,_e);else if(Ne==="flipbevel"){if(mt>100)at=X.mult(-1);else{const Je=mt*ue.add(X).mag()/ue.sub(X).mag();at._perp()._mult(Je*(tt?-1:1))}this.addCurrentVertex(re,at,0,0,H,_e),this.addCurrentVertex(re,at.mult(-1),0,0,H,_e)}else if(Ne==="bevel"||Ne==="fakeround"){_e!=null&&ne&&this.addCurrentVertex(re,he||ue,-1,-1,H,_e);const Je=re.dist(ne)<=2*_t&&Ne!=="bevel",it=at.mult(tt?1:-1);it._mult(mt);const Pt=X.mult(tt?-1:1),Mt=ue.mult(tt?-1:1),sr=this.evaluateLineProgressFeatures(this.distance);if(_e==null&&(this.addHalfVertex(re,it.x,it.y,!1,!tt,0,H,sr),Je||this.addHalfVertex(re,it.x+2*Mt.x,it.y+2*Mt.y,!1,tt,0,H,sr)),Ne==="fakeround"){const Qt=Math.round(180*yt/Math.PI/20);this.addHalfVertex(re,Mt.x,Mt.y,!1,tt,0,H,sr);for(let jt=0;jt<Qt;jt++){let It=jt/Qt;if(It!==.5){const rr=It-.5;It+=It*rr*(It-1)*((1.0904+$e*($e*(3.55645-1.43519*$e)-3.2452))*rr*rr+(.848013+$e*(.215638*$e-1.06021)))}const Lr=Pt.sub(Mt)._mult(It)._add(Mt)._unit();this.addHalfVertex(re,Lr.x,Lr.y,!1,tt,0,H,sr)}this.addHalfVertex(re,Pt.x,Pt.y,!1,tt,0,H,sr)}Je||_e!=null||this.addHalfVertex(re,it.x+2*Pt.x,it.y+2*Pt.y,!1,tt,0,H,sr),_e!=null&&de&&this.addCurrentVertex(re,se||X,1,1,H,_e)}else if(Ne==="butt")this.addCurrentVertex(re,at,0,0,H,_e);else if(Ne==="square"){if(!ne){const Je=M?0:-1;this.addCurrentVertex(re,at,Je,Je,H,_e)}if(this.addCurrentVertex(re,at,0,0,H,_e),ne){const Je=O?0:1;this.addCurrentVertex(re,at,Je,Je,H,_e)}}else if(Ne==="round"){if(ne){const Je=!Re&&he?he:ue;this.addCurrentVertex(re,Je,0,0,H,_e),!Re&&O||this.addCurrentVertex(re,Je,1,1,H,_e,!0)}if(de){const Je=!Re&&se?se:X;!Re&&M||this.addCurrentVertex(re,Je,-1,-1,H,_e,!0),this.addCurrentVertex(re,Je,0,0,H,_e)}}}}addVerticesTo(t,i,c,h,p,g,w,T,A,M){const O=(i.w-t.w)/this.tessellationStep|0;let z=0;const U=this.scaledDistance;if(O>1){this.lineSoFar=t.w;const H=(i.x-t.x)/O,re=(i.y-t.y)/O,ne=(i.z-t.z)/O,de=(i.w-t.w)/O;for(let ue=1;ue<O;++ue){t.x+=H,t.y+=re,t.z+=ne,this.lineSoFar+=de,z+=de;const X=this.evaluateLineProgressFeatures(this.prevDistance+z);this.scaledDistance=(this.prevDistance+z)/this.totalDistance,this.addHalfVertex(t,c,h,M,!1,w,A,X),this.addHalfVertex(t,p,g,M,!0,-T,A,X)}}this.lineSoFar=i.w,this.scaledDistance=U;const V=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,c,h,M,!1,w,A,V),this.addHalfVertex(i,p,g,M,!0,-T,A,V)}evaluateLineProgressFeatures(t){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):tn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(t,i,c,h,p,g,w=!1){const T=i.x+i.y*c,A=i.y-i.x*c,M=i.y*h-i.x,O=-i.y-i.x*h;if(g!=null){const z=this.elevationType==="offset",U=-10,V=zt+10,H=g.zOffset,re=new $2(t.x,t.y,H,this.lineSoFar),ne=!!z&&Kx(t,U,V),de=this.lineSoFar,ue=this.distance;if(this.currentVertex)if(ne){const X=this.currentVertexIsOutside,se=this.currentVertex,he=new $2(t.x,t.y,H,this.lineSoFar);if(q2(se,he,U,V),!Kx(he,U,V)){if(X){this.e1=this.e2=-1,this.distance-=se.dist(re),this.lineSoFar=se.w;const _e=this.evaluateLineProgressFeatures(se.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(se,T,A,w,!1,c,p,_e),this.addHalfVertex(se,M,O,w,!0,-h,p,_e),this.prevDistance=this.distance}this.distance=this.prevDistance+se.dist(he),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(se,he,T,A,M,O,c,h,p,w),this.distance=ue,this.scaledDistance=this.distance/this.totalDistance}}else{const X=this.currentVertex;if(this.currentVertexIsOutside){q2(X,re,U,V),this.e1=this.e2=-1,this.distance-=X.dist(re),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=X.w;const se=this.evaluateLineProgressFeatures(X.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(X,T,A,w,!1,c,p,se),this.addHalfVertex(X,M,O,w,!0,-h,p,se),this.prevDistance=this.distance,this.distance=ue,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(X,re,T,A,M,O,c,h,p,w)}else ne||(this.addHalfVertex(t,T,A,w,!1,c,p,g),this.addHalfVertex(t,M,O,w,!0,-h,p,g));this.currentVertex=re,this.currentVertexIsOutside=ne,this.lineSoFar=de}else this.addHalfVertex(t,T,A,w,!1,c,p,g),this.addHalfVertex(t,M,O,w,!0,-h,p,g)}addHalfVertex({x:t,y:i},c,h,p,g,w,T,A){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(i<<1)+(g?1:0),Math.round(63*c)+128,Math.round(63*h)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const O=xr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,O)}const M=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),T.primitiveLength++),g?this.e2=M:this.e1=M,A!=null&&this.zOffsetVertexArray.emplaceBack(A.zOffset,A.variableWidth,A.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,i){this.prevDistance=this.distance,this.distance+=t.dist(i),this.updateScaledDistance()}}function Kx(a,t,i){return a.x<t||a.x>i||a.y<t||a.y>i}let Y2,K2;function J2(a,t,i){return t*(zt/(a.tileSize*Math.pow(2,i-a.tileID.overscaledZ)))}qt(Yx,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Q2=(a,t,i)=>(1-i)*a+i*t;function eA(a,t){return 1/J2(a,1,t.tileZoom)}function tA(a,t,i,c){return a.translatePosMatrix(c||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const rA=a=>{const t=[];nA(a)&&t.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const i=a.paint.get("line-trim-offset");i[0]===0&&i[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");const c=a.layout.get("line-join").constantOr("miter")==="none",h=!!a.paint.get("line-pattern").constantOr(1);return c&&h&&t.push("LINE_JOIN_NONE"),t};function nA(a){const t=a.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}let Jx;const iA=()=>Jx||(Jx={layout:Y2||(Y2=new Ri({"line-cap":new Xt(qe.layout_line["line-cap"]),"line-join":new Xt(qe.layout_line["line-join"]),"line-miter-limit":new Ct(qe.layout_line["line-miter-limit"]),"line-round-limit":new Ct(qe.layout_line["line-round-limit"]),"line-sort-key":new Xt(qe.layout_line["line-sort-key"]),"line-z-offset":new Xt(qe.layout_line["line-z-offset"]),"line-elevation-reference":new Ct(qe.layout_line["line-elevation-reference"]),"line-cross-slope":new Ct(qe.layout_line["line-cross-slope"]),visibility:new Ct(qe.layout_line.visibility),"line-width-unit":new Ct(qe.layout_line["line-width-unit"])})),paint:K2||(K2=new Ri({"line-opacity":new Xt(qe.paint_line["line-opacity"]),"line-color":new Xt(qe.paint_line["line-color"]),"line-translate":new Ct(qe.paint_line["line-translate"]),"line-translate-anchor":new Ct(qe.paint_line["line-translate-anchor"]),"line-width":new Xt(qe.paint_line["line-width"]),"line-gap-width":new Xt(qe.paint_line["line-gap-width"]),"line-offset":new Xt(qe.paint_line["line-offset"]),"line-blur":new Xt(qe.paint_line["line-blur"]),"line-dasharray":new Xt(qe.paint_line["line-dasharray"]),"line-pattern":new Xt(qe.paint_line["line-pattern"]),"line-pattern-cross-fade":new Ct(qe.paint_line["line-pattern-cross-fade"]),"line-gradient":new So(qe.paint_line["line-gradient"]),"line-trim-offset":new Ct(qe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ct(qe.paint_line["line-trim-fade-range"]),"line-trim-color":new Ct(qe.paint_line["line-trim-color"]),"line-emissive-strength":new Ct(qe.paint_line["line-emissive-strength"]),"line-border-width":new Xt(qe.paint_line["line-border-width"]),"line-border-color":new Xt(qe.paint_line["line-border-color"]),"line-occlusion-opacity":new Ct(qe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},Jx);class KF extends Xt{possiblyEvaluate(t,i){return i=new $n(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(t,i)}evaluate(t,i,c,h){return i=Ze({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(t,i,c,h)}}let __;function oA(a,t){return t>0?t+2*a:a}const JF=On([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),QF=On([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),eN=On([{name:"a_projected_pos",components:4,type:"Float32"}],4);On([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tN=On([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),rN=On([{name:"a_texb",components:2,type:"Uint16"}]),nN=On([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),iN=On([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);On([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const aA=On([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),oN=On([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);On([{name:"triangle",components:3,type:"Uint16"}]),On([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),On([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),On([{type:"Float32",name:"offsetX"}]),On([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ia=24;function aN(a,t,i){return a.sections.forEach(c=>{c.text=function(h,p,g){const w=p.layout.get("text-transform").evaluate(g,{});return w==="uppercase"?h=h.toLocaleUpperCase():w==="lowercase"&&(h=h.toLocaleLowerCase()),Ua.applyArabicShaping&&(h=Ua.applyArabicShaping(h)),h}(c.text,t,i)}),a}const y_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function sN(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}function lN(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}var sA,Qx,lA,e1={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function cN(){return sA||(sA=1,e1.read=function(a,t,i,c,h){var p,g,w=8*h-c-1,T=(1<<w)-1,A=T>>1,M=-7,O=i?h-1:0,z=i?-1:1,U=a[t+O];for(O+=z,p=U&(1<<-M)-1,U>>=-M,M+=w;M>0;p=256*p+a[t+O],O+=z,M-=8);for(g=p&(1<<-M)-1,p>>=-M,M+=c;M>0;g=256*g+a[t+O],O+=z,M-=8);if(p===0)p=1-A;else{if(p===T)return g?NaN:1/0*(U?-1:1);g+=Math.pow(2,c),p-=A}return(U?-1:1)*g*Math.pow(2,p-c)},e1.write=function(a,t,i,c,h,p){var g,w,T,A=8*p-h-1,M=(1<<A)-1,O=M>>1,z=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=c?0:p-1,V=c?1:-1,H=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(w=isNaN(t)?1:0,g=M):(g=Math.floor(Math.log(t)/Math.LN2),t*(T=Math.pow(2,-g))<1&&(g--,T*=2),(t+=g+O>=1?z/T:z*Math.pow(2,1-O))*T>=2&&(g++,T/=2),g+O>=M?(w=0,g=M):g+O>=1?(w=(t*T-1)*Math.pow(2,h),g+=O):(w=t*Math.pow(2,O-1)*Math.pow(2,h),g=0));h>=8;a[i+U]=255&w,U+=V,w/=256,h-=8);for(g=g<<h|w,A+=h;A>0;a[i+U]=255&g,U+=V,g/=256,A-=8);a[i+U-V]|=128*H}),e1}function cA(){if(lA)return Qx;lA=1,Qx=t;var a=cN();function t(X){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(X)?X:new Uint8Array(X||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var i=4294967296,c=1/i,h=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function p(X){return X.type===t.Bytes?X.readVarint()+X.pos:X.pos+1}function g(X,se,he){return he?4294967296*se+(X>>>0):4294967296*(se>>>0)+(X>>>0)}function w(X,se,he){var _e=se<=16383?1:se<=2097151?2:se<=268435455?3:Math.floor(Math.log(se)/(7*Math.LN2));he.realloc(_e);for(var Ce=he.pos-1;Ce>=X;Ce--)he.buf[Ce+_e]=he.buf[Ce]}function T(X,se){for(var he=0;he<X.length;he++)se.writeVarint(X[he])}function A(X,se){for(var he=0;he<X.length;he++)se.writeSVarint(X[he])}function M(X,se){for(var he=0;he<X.length;he++)se.writeFloat(X[he])}function O(X,se){for(var he=0;he<X.length;he++)se.writeDouble(X[he])}function z(X,se){for(var he=0;he<X.length;he++)se.writeBoolean(X[he])}function U(X,se){for(var he=0;he<X.length;he++)se.writeFixed32(X[he])}function V(X,se){for(var he=0;he<X.length;he++)se.writeSFixed32(X[he])}function H(X,se){for(var he=0;he<X.length;he++)se.writeFixed64(X[he])}function re(X,se){for(var he=0;he<X.length;he++)se.writeSFixed64(X[he])}function ne(X,se){return(X[se]|X[se+1]<<8|X[se+2]<<16)+16777216*X[se+3]}function de(X,se,he){X[he]=se,X[he+1]=se>>>8,X[he+2]=se>>>16,X[he+3]=se>>>24}function ue(X,se){return(X[se]|X[se+1]<<8|X[se+2]<<16)+(X[se+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(X,se,he){for(he=he||this.length;this.pos<he;){var _e=this.readVarint(),Ce=_e>>3,Re=this.pos;this.type=7&_e,X(Ce,se,this),this.pos===Re&&this.skip(_e)}return se},readMessage:function(X,se){return this.readFields(X,se,this.readVarint()+this.pos)},readFixed32:function(){var X=ne(this.buf,this.pos);return this.pos+=4,X},readSFixed32:function(){var X=ue(this.buf,this.pos);return this.pos+=4,X},readFixed64:function(){var X=ne(this.buf,this.pos)+ne(this.buf,this.pos+4)*i;return this.pos+=8,X},readSFixed64:function(){var X=ne(this.buf,this.pos)+ue(this.buf,this.pos+4)*i;return this.pos+=8,X},readFloat:function(){var X=a.read(this.buf,this.pos,!0,23,4);return this.pos+=4,X},readDouble:function(){var X=a.read(this.buf,this.pos,!0,52,8);return this.pos+=8,X},readVarint:function(X){var se,he,_e=this.buf;return se=127&(he=_e[this.pos++]),he<128?se:(se|=(127&(he=_e[this.pos++]))<<7,he<128?se:(se|=(127&(he=_e[this.pos++]))<<14,he<128?se:(se|=(127&(he=_e[this.pos++]))<<21,he<128?se:function(Ce,Re,Ne){var $e,at,xt=Ne.buf;if($e=(112&(at=xt[Ne.pos++]))>>4,at<128||($e|=(127&(at=xt[Ne.pos++]))<<3,at<128)||($e|=(127&(at=xt[Ne.pos++]))<<10,at<128)||($e|=(127&(at=xt[Ne.pos++]))<<17,at<128)||($e|=(127&(at=xt[Ne.pos++]))<<24,at<128)||($e|=(1&(at=xt[Ne.pos++]))<<31,at<128))return g(Ce,$e,Re);throw new Error("Expected varint not more than 10 bytes")}(se|=(15&(he=_e[this.pos]))<<28,X,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var X=this.readVarint();return X%2==1?(X+1)/-2:X/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var X=this.readVarint()+this.pos,se=this.pos;return this.pos=X,X-se>=12&&h?function(he,_e,Ce){return h.decode(he.subarray(_e,Ce))}(this.buf,se,X):function(he,_e,Ce){for(var Re="",Ne=_e;Ne<Ce;){var $e,at,xt,mt=he[Ne],yt=null,At=mt>239?4:mt>223?3:mt>191?2:1;if(Ne+At>Ce)break;At===1?mt<128&&(yt=mt):At===2?(192&($e=he[Ne+1]))==128&&(yt=(31&mt)<<6|63&$e)<=127&&(yt=null):At===3?(at=he[Ne+2],(192&($e=he[Ne+1]))==128&&(192&at)==128&&((yt=(15&mt)<<12|(63&$e)<<6|63&at)<=2047||yt>=55296&&yt<=57343)&&(yt=null)):At===4&&(at=he[Ne+2],xt=he[Ne+3],(192&($e=he[Ne+1]))==128&&(192&at)==128&&(192&xt)==128&&((yt=(15&mt)<<18|(63&$e)<<12|(63&at)<<6|63&xt)<=65535||yt>=1114112)&&(yt=null)),yt===null?(yt=65533,At=1):yt>65535&&(yt-=65536,Re+=String.fromCharCode(yt>>>10&1023|55296),yt=56320|1023&yt),Re+=String.fromCharCode(yt),Ne+=At}return Re}(this.buf,se,X)},readBytes:function(){var X=this.readVarint()+this.pos,se=this.buf.subarray(this.pos,X);return this.pos=X,se},readPackedVarint:function(X,se){if(this.type!==t.Bytes)return X.push(this.readVarint(se));var he=p(this);for(X=X||[];this.pos<he;)X.push(this.readVarint(se));return X},readPackedSVarint:function(X){if(this.type!==t.Bytes)return X.push(this.readSVarint());var se=p(this);for(X=X||[];this.pos<se;)X.push(this.readSVarint());return X},readPackedBoolean:function(X){if(this.type!==t.Bytes)return X.push(this.readBoolean());var se=p(this);for(X=X||[];this.pos<se;)X.push(this.readBoolean());return X},readPackedFloat:function(X){if(this.type!==t.Bytes)return X.push(this.readFloat());var se=p(this);for(X=X||[];this.pos<se;)X.push(this.readFloat());return X},readPackedDouble:function(X){if(this.type!==t.Bytes)return X.push(this.readDouble());var se=p(this);for(X=X||[];this.pos<se;)X.push(this.readDouble());return X},readPackedFixed32:function(X){if(this.type!==t.Bytes)return X.push(this.readFixed32());var se=p(this);for(X=X||[];this.pos<se;)X.push(this.readFixed32());return X},readPackedSFixed32:function(X){if(this.type!==t.Bytes)return X.push(this.readSFixed32());var se=p(this);for(X=X||[];this.pos<se;)X.push(this.readSFixed32());return X},readPackedFixed64:function(X){if(this.type!==t.Bytes)return X.push(this.readFixed64());var se=p(this);for(X=X||[];this.pos<se;)X.push(this.readFixed64());return X},readPackedSFixed64:function(X){if(this.type!==t.Bytes)return X.push(this.readSFixed64());var se=p(this);for(X=X||[];this.pos<se;)X.push(this.readSFixed64());return X},skip:function(X){var se=7&X;if(se===t.Varint)for(;this.buf[this.pos++]>127;);else if(se===t.Bytes)this.pos=this.readVarint()+this.pos;else if(se===t.Fixed32)this.pos+=4;else{if(se!==t.Fixed64)throw new Error("Unimplemented type: "+se);this.pos+=8}},writeTag:function(X,se){this.writeVarint(X<<3|se)},realloc:function(X){for(var se=this.length||16;se<this.pos+X;)se*=2;if(se!==this.length){var he=new Uint8Array(se);he.set(this.buf),this.buf=he,this.length=se}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(X){this.realloc(4),de(this.buf,X,this.pos),this.pos+=4},writeSFixed32:function(X){this.realloc(4),de(this.buf,X,this.pos),this.pos+=4},writeFixed64:function(X){this.realloc(8),de(this.buf,-1&X,this.pos),de(this.buf,Math.floor(X*c),this.pos+4),this.pos+=8},writeSFixed64:function(X){this.realloc(8),de(this.buf,-1&X,this.pos),de(this.buf,Math.floor(X*c),this.pos+4),this.pos+=8},writeVarint:function(X){(X=+X||0)>268435455||X<0?function(se,he){var _e,Ce;if(se>=0?(_e=se%4294967296|0,Ce=se/4294967296|0):(Ce=~(-se/4294967296),4294967295^(_e=~(-se%4294967296))?_e=_e+1|0:(_e=0,Ce=Ce+1|0)),se>=18446744073709552e3||se<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");he.realloc(10),function(Re,Ne,$e){$e.buf[$e.pos++]=127&Re|128,Re>>>=7,$e.buf[$e.pos++]=127&Re|128,Re>>>=7,$e.buf[$e.pos++]=127&Re|128,Re>>>=7,$e.buf[$e.pos++]=127&Re|128,$e.buf[$e.pos]=127&(Re>>>=7)}(_e,0,he),function(Re,Ne){var $e=(7&Re)<<4;Ne.buf[Ne.pos++]|=$e|((Re>>>=3)?128:0),Re&&(Ne.buf[Ne.pos++]=127&Re|((Re>>>=7)?128:0),Re&&(Ne.buf[Ne.pos++]=127&Re|((Re>>>=7)?128:0),Re&&(Ne.buf[Ne.pos++]=127&Re|((Re>>>=7)?128:0),Re&&(Ne.buf[Ne.pos++]=127&Re|((Re>>>=7)?128:0),Re&&(Ne.buf[Ne.pos++]=127&Re)))))}(Ce,he)}(X,this):(this.realloc(4),this.buf[this.pos++]=127&X|(X>127?128:0),X<=127||(this.buf[this.pos++]=127&(X>>>=7)|(X>127?128:0),X<=127||(this.buf[this.pos++]=127&(X>>>=7)|(X>127?128:0),X<=127||(this.buf[this.pos++]=X>>>7&127))))},writeSVarint:function(X){this.writeVarint(X<0?2*-X-1:2*X)},writeBoolean:function(X){this.writeVarint(!!X)},writeString:function(X){X=String(X),this.realloc(4*X.length),this.pos++;var se=this.pos;this.pos=function(_e,Ce,Re){for(var Ne,$e,at=0;at<Ce.length;at++){if((Ne=Ce.charCodeAt(at))>55295&&Ne<57344){if(!$e){Ne>56319||at+1===Ce.length?(_e[Re++]=239,_e[Re++]=191,_e[Re++]=189):$e=Ne;continue}if(Ne<56320){_e[Re++]=239,_e[Re++]=191,_e[Re++]=189,$e=Ne;continue}Ne=$e-55296<<10|Ne-56320|65536,$e=null}else $e&&(_e[Re++]=239,_e[Re++]=191,_e[Re++]=189,$e=null);Ne<128?_e[Re++]=Ne:(Ne<2048?_e[Re++]=Ne>>6|192:(Ne<65536?_e[Re++]=Ne>>12|224:(_e[Re++]=Ne>>18|240,_e[Re++]=Ne>>12&63|128),_e[Re++]=Ne>>6&63|128),_e[Re++]=63&Ne|128)}return Re}(this.buf,X,this.pos);var he=this.pos-se;he>=128&&w(se,he,this),this.pos=se-1,this.writeVarint(he),this.pos+=he},writeFloat:function(X){this.realloc(4),a.write(this.buf,X,this.pos,!0,23,4),this.pos+=4},writeDouble:function(X){this.realloc(8),a.write(this.buf,X,this.pos,!0,52,8),this.pos+=8},writeBytes:function(X){var se=X.length;this.writeVarint(se),this.realloc(se);for(var he=0;he<se;he++)this.buf[this.pos++]=X[he]},writeRawMessage:function(X,se){this.pos++;var he=this.pos;X(se,this);var _e=this.pos-he;_e>=128&&w(he,_e,this),this.pos=he-1,this.writeVarint(_e),this.pos+=_e},writeMessage:function(X,se,he){this.writeTag(X,t.Bytes),this.writeRawMessage(se,he)},writePackedVarint:function(X,se){se.length&&this.writeMessage(X,T,se)},writePackedSVarint:function(X,se){se.length&&this.writeMessage(X,A,se)},writePackedBoolean:function(X,se){se.length&&this.writeMessage(X,z,se)},writePackedFloat:function(X,se){se.length&&this.writeMessage(X,M,se)},writePackedDouble:function(X,se){se.length&&this.writeMessage(X,O,se)},writePackedFixed32:function(X,se){se.length&&this.writeMessage(X,U,se)},writePackedSFixed32:function(X,se){se.length&&this.writeMessage(X,V,se)},writePackedFixed64:function(X,se){se.length&&this.writeMessage(X,H,se)},writePackedSFixed64:function(X,se){se.length&&this.writeMessage(X,re,se)},writeBytesField:function(X,se){this.writeTag(X,t.Bytes),this.writeBytes(se)},writeFixed32Field:function(X,se){this.writeTag(X,t.Fixed32),this.writeFixed32(se)},writeSFixed32Field:function(X,se){this.writeTag(X,t.Fixed32),this.writeSFixed32(se)},writeFixed64Field:function(X,se){this.writeTag(X,t.Fixed64),this.writeFixed64(se)},writeSFixed64Field:function(X,se){this.writeTag(X,t.Fixed64),this.writeSFixed64(se)},writeVarintField:function(X,se){this.writeTag(X,t.Varint),this.writeVarint(se)},writeSVarintField:function(X,se){this.writeTag(X,t.Varint),this.writeSVarint(se)},writeStringField:function(X,se){this.writeTag(X,t.Bytes),this.writeString(se)},writeFloatField:function(X,se){this.writeTag(X,t.Fixed32),this.writeFloat(se)},writeDoubleField:function(X,se){this.writeTag(X,t.Fixed64),this.writeDouble(se)},writeBooleanField:function(X,se){this.writeVarintField(X,!!se)}},Qx}var Jy=Bn(cA());const t1=3;function uN(a,t,i){t.glyphs=[],a===1&&i.readMessage(hN,t)}function hN(a,t,i){if(a===3){const{id:c,bitmap:h,width:p,height:g,left:w,top:T,advance:A}=i.readMessage(dN,{});t.glyphs.push({id:c,bitmap:new Tt({width:p+2*t1,height:g+2*t1},h),metrics:{width:p,height:g,left:w,top:T,advance:A}})}else a===4?t.ascender=i.readSVarint():a===5&&(t.descender=i.readSVarint())}function dN(a,t,i){a===1?t.id=i.readVarint():a===2?t.bitmap=i.readBytes():a===3?t.width=i.readVarint():a===4?t.height=i.readVarint():a===5?t.left=i.readSVarint():a===6?t.top=i.readSVarint():a===7&&(t.advance=i.readVarint())}const uA=t1,rl={horizontal:1,vertical:2,horizontalOnly:3};class v_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(t,i){const c=new v_;return c.scale=t||1,c.fontStack=i,c}static forImage(t){const i=new v_;return i.image=t,i}}class lg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i,c){const h=new lg;for(let p=0;p<t.sections.length;p++){const g=t.sections[p];g.image?h.addImageSection(g,c):h.addTextSection(g,i)}return h}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(i,c){let h="";for(let p=0;p<i.length;p++){const g=i.charCodeAt(p+1)||null,w=i.charCodeAt(p-1)||null;h+=!c&&(g&&dc(g)&&!y_[i[p+1]]||w&&dc(w)&&!y_[i[p-1]])||!y_[i[p]]?i[p]:y_[i[p]]}return h}(this.text,t)}trim(){let t=0;for(let c=0;c<this.text.length&&Qy[this.text.charCodeAt(c)];c++)t++;let i=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&Qy[this.text.charCodeAt(c)];c--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const c=new lg;return c.text=this.text.substring(t,i),c.sectionIndex=this.sectionIndex.slice(t,i),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(v_.forText(t.scale,t.fontStack||i));const c=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(c)}addImageSection(t,i){const c=t.image?t.image.getPrimary():null;if(!c)return void tn("Can't add FormattedSection with an empty image.");c.scaleSelf(i);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(v_.forImage(c)),this.sectionIndex.push(this.sections.length-1)):tn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function r1(a,t,i,c,h,p,g,w,T,A,M,O,z,U,V,H=1){const re=lg.fromFeature(a,h,H);O===rl.vertical&&re.verticalizePunctuation(z);let ne=[];const de=function(_e,Ce,Re,Ne,$e,at){if(!_e)return[];const xt=[],mt=function(_t,Je,it,Pt,Mt,sr){let Qt=0;for(let jt=0;jt<_t.length();jt++){const It=_t.getSection(jt);Qt+=hA(_t.getCodePoint(jt),It,Pt,Mt,Je,sr)}return Qt/Math.max(1,Math.ceil(Qt/it))}(_e,Ce,Re,Ne,$e,at),yt=_e.text.indexOf("")>=0;let At=0;for(let _t=0;_t<_e.length();_t++){const Je=_e.getSection(_t),it=_e.getCodePoint(_t);if(Qy[it]||(At+=hA(it,Je,Ne,$e,Ce,at)),_t<_e.length()-1){const Pt=!((tt=it)<11904||!(_r["Bopomofo Extended"](tt)||_r.Bopomofo(tt)||_r["CJK Compatibility Forms"](tt)||_r["CJK Compatibility Ideographs"](tt)||_r["CJK Compatibility"](tt)||_r["CJK Radicals Supplement"](tt)||_r["CJK Strokes"](tt)||_r["CJK Symbols and Punctuation"](tt)||_r["CJK Unified Ideographs Extension A"](tt)||_r["CJK Unified Ideographs"](tt)||_r["Enclosed CJK Letters and Months"](tt)||_r["Halfwidth and Fullwidth Forms"](tt)||_r.Hiragana(tt)||_r["Ideographic Description Characters"](tt)||_r["Kangxi Radicals"](tt)||_r["Katakana Phonetic Extensions"](tt)||_r.Katakana(tt)||_r["Vertical Forms"](tt)||_r["Yi Radicals"](tt)||_r["Yi Syllables"](tt)));(fN[it]||Pt||Je.image)&&xt.push(fA(_t+1,At,mt,xt,pN(it,_e.getCodePoint(_t+1),Pt&&yt),!1))}}var tt;return pA(fA(_e.length(),At,mt,xt,0,!0))}(re,A,p,t,c,U),{processBidirectionalText:ue,processStyledBidirectionalText:X}=Ua;if(ue&&re.sections.length===1){const _e=ue(re.toString(),de);for(const Ce of _e){const Re=new lg;Re.text=Ce,Re.sections=re.sections;for(let Ne=0;Ne<Ce.length;Ne++)Re.sectionIndex.push(0);ne.push(Re)}}else if(X){const _e=X(re.text,re.sectionIndex,de);for(const Ce of _e){const Re=new lg;Re.text=Ce[0],Re.sectionIndex=Ce[1],Re.sections=re.sections,ne.push(Re)}}else ne=function(_e,Ce){const Re=[],Ne=_e.text;let $e=0;for(const at of Ce)Re.push(_e.substring($e,at)),$e=at;return $e<Ne.length&&Re.push(_e.substring($e,Ne.length)),Re}(re,de);const se=[],he={positionedLines:se,text:re.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(_e,Ce,Re,Ne,$e,at,xt,mt,yt,At,tt,_t){let Je=0,it=0,Pt=0;const Mt=mt==="right"?1:mt==="left"?0:.5;let sr=!1;for(const nr of $e){const Cr=nr.getSections();for(const Gr of Cr){if(Gr.image)continue;const Xr=Ce[Gr.fontStack];if(Xr&&(sr=Xr.ascender!==void 0&&Xr.descender!==void 0,!sr))break}if(!sr)break}let Qt=0;for(const nr of $e){nr.trim();const Cr=nr.getMaxScale(),Gr=(Cr-1)*ia,Xr={positionedGlyphs:[],lineOffset:0};_e.positionedLines[Qt]=Xr;const cn=Xr.positionedGlyphs;let on=0;if(!nr.length()){it+=at,++Qt;continue}let Kr=0,ai=0;for(let me=0;me<nr.length();me++){const ve=nr.getSection(me),lt=nr.getSectionIndex(me),Rt=nr.getCodePoint(me);let $t=ve.scale,Ut=null,or=null,Ir=null,vn=ia,xn=0;yt===rl.vertical&&((jt=Rt)===12312||jt===12313||jt===12316||jt===12540||jt===12448)&&(yt=rl.horizontal);const Jr=!(yt===rl.horizontal||!tt&&!cs(Rt)||tt&&(Qy[Rt]||Rf(Rt)));if(ve.image){const Kn=Ne.get(ve.image.toString());if(!Kn)continue;Ir=ve.image,_e.iconsInText=_e.iconsInText||!0,or=Kn.paddedRect;const fi=Kn.displaySize;$t=$t*ia/_t,Ut={width:fi[0],height:fi[1],left:0,top:-uA,advance:Jr?fi[1]:fi[0],localGlyph:!1},xn=sr?-Ut.height*$t:Cr*ia-17-fi[1]*$t,vn=Ut.advance;const bn=(Jr?fi[0]:fi[1])*$t-ia*Cr;bn>0&&bn>on&&(on=bn)}else{const Kn=Re[ve.fontStack];if(!Kn)continue;Kn[Rt]&&(or=Kn[Rt]);const fi=Ce[ve.fontStack];if(!fi)continue;const bn=fi.glyphs[Rt];if(!bn)continue;if(Ut=bn.metrics,vn=Rt!==8203?ia:0,sr){const Ni=fi.ascender!==void 0?Math.abs(fi.ascender):0,xi=fi.descender!==void 0?Math.abs(fi.descender):0,Hn=(Ni+xi)*$t;Kr<Hn&&(Kr=Hn,ai=(Ni-xi)/2*$t),xn=-Ni*$t}else xn=(Cr-$t)*ia-17}Jr?(_e.verticalizable=!0,cn.push({glyph:Rt,image:Ir,x:Je,y:it+xn,vertical:Jr,scale:$t,localGlyph:Ut.localGlyph,fontStack:ve.fontStack,sectionIndex:lt,metrics:Ut,rect:or}),Je+=vn*$t+At):(cn.push({glyph:Rt,image:Ir,x:Je,y:it+xn,vertical:Jr,scale:$t,localGlyph:Ut.localGlyph,fontStack:ve.fontStack,sectionIndex:lt,metrics:Ut,rect:or}),Je+=Ut.advance*$t+At)}cn.length!==0&&(Pt=Math.max(Je-At,Pt),sr?mA(cn,Mt,on,ai,at*Cr/2):mA(cn,Mt,on,0,at/2)),Je=0;const vi=at*Cr+on;Xr.lineOffset=Math.max(on,Gr),it+=vi,++Qt}var jt;const It=it,{horizontalAlign:Lr,verticalAlign:rr}=n1(xt);(function(nr,Cr,Gr,Xr,cn,on){const Kr=(Cr-Gr)*cn,ai=-on*Xr;for(const vi of nr)for(const me of vi.positionedGlyphs)me.x+=Kr,me.y+=ai})(_e.positionedLines,Mt,Lr,rr,Pt,It),_e.top+=-rr*It,_e.bottom=_e.top+It,_e.left+=-Lr*Pt,_e.right=_e.left+Pt,_e.hasBaseline=sr}(he,t,i,c,ne,g,w,T,O,A,z,V),!function(_e){for(const Ce of _e)if(Ce.positionedGlyphs.length!==0)return!1;return!0}(se))return he}const Qy={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},fN={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hA(a,t,i,c,h,p){if(t.image){const g=c.get(t.image.toString());return g?g.displaySize[0]*t.scale*ia/p+h:0}{const g=i[t.fontStack],w=g&&g.glyphs[a];return w?w.metrics.advance*t.scale+h:0}}function dA(a,t,i,c){const h=Math.pow(a-t,2);return c?a<t?h/2:2*h:h+Math.abs(i)*i}function pN(a,t,i){let c=0;return a===10&&(c-=1e4),i&&(c+=150),a!==40&&a!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function fA(a,t,i,c,h,p){let g=null,w=dA(t,i,h,p);for(const T of c){const A=dA(t-T.x,i,h,p)+T.badness;A<=w&&(g=T,w=A)}return{index:a,x:t,priorBreak:g,badness:w}}function pA(a){return a?pA(a.priorBreak).concat(a.index):[]}function n1(a){let t=.5,i=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function mA(a,t,i,c,h){if(!(t||i||c||h))return;const p=a.length-1,g=a[p],w=(g.x+g.metrics.advance*g.scale)*t;for(let T=0;T<=p;T++)a[T].x-=w,a[T].y+=i+c+h}function gA(a){return a.imagePrimary!==void 0&&a.top!==void 0&&a.bottom!==void 0&&a.left!==void 0&&a.right!==void 0}function mN(a,t,i,c){const{horizontalAlign:h,verticalAlign:p}=n1(c),g=i[0]-a.displaySize[0]*h,w=i[1]-a.displaySize[1]*p;return{imagePrimary:a,imageSecondary:t,top:w,bottom:w+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function _A(a,t,i,c,h,p){const g=a.imagePrimary;let w;if(g.content){const re=g.content,ne=g.pixelRatio||1;w=[re[0]/ne,re[1]/ne,g.displaySize[0]-re[2]/ne,g.displaySize[1]-re[3]/ne]}const T=t.left*p,A=t.right*p;let M,O,z,U;i==="width"||i==="both"?(U=h[0]+T-c[3],O=h[0]+A+c[1]):(U=h[0]+(T+A-g.displaySize[0])/2,O=U+g.displaySize[0]);const V=t.top*p,H=t.bottom*p;return i==="height"||i==="both"?(M=h[1]+V-c[0],z=h[1]+H+c[2]):(M=h[1]+(V+H-g.displaySize[1])/2,z=M+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:M,right:O,bottom:z,left:U,collisionPadding:w}}function yA(a){return!a.imagePrimary.stretchX}function vA(a){return!a.imagePrimary.stretchY}function xA(a){return{width:a.right-a.left,height:a.bottom-a.top}}const rd=128;function bA(a,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new $n(a+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:h}=i;let p=0;for(;p<c.length&&c[p]<=a;)p++;p=Math.max(0,p-1);let g=p;for(;g<c.length&&c[g]<a+1;)g++;g=Math.min(c.length-1,g);const w=c[p],T=c[g];return i.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:h}:{kind:"camera",minZoom:w,maxZoom:T,minSize:i.evaluate(new $n(w)),maxSize:i.evaluate(new $n(T)),interpolationType:h}}}function i1(a,{uSize:t,uSizeT:i},{lowerSize:c,upperSize:h}){return a.kind==="source"?c/rd:a.kind==="composite"?xr(c/rd,h/rd,i):t}function x_(a,t,i=1){let c=0,h=0;if(a.kind==="constant")h=a.layoutSize*i;else if(a.kind!=="source"){const{interpolationType:p,minZoom:g,maxZoom:w}=a,T=p?Fe(wo.interpolationFactor(p,t,g,w),0,1):0;a.kind==="camera"?h=xr(a.minSize,a.maxSize,T)*i:c=T*i}return{uSizeT:c,uSize:h}}class ef extends Dt{constructor(t,i,c,h,p){super(t,i),this.angle=h,this.z=c,p!==void 0&&(this.segment=p)}clone(){return new ef(this.x,this.y,this.z,this.angle,this.segment)}}function wA(a,t,i,c,h){if(t.segment===void 0)return!0;let p=t,g=t.segment+1,w=0;for(;w>-i/2;){if(g--,g<0)return!1;w-=a[g].dist(p),p=a[g]}w+=a[g].dist(a[g+1]),g++;const T=[];let A=0;for(;w<i/2;){const M=a[g],O=a[g+1];if(!O)return!1;let z=a[g-1].angleTo(M)-M.angleTo(O);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:z}),A+=z;w-T[0].distance>c;)A-=T.shift().angleDelta;if(A>h)return!1;g++,w+=M.dist(O)}return!0}function SA(a){let t=0;for(let i=0;i<a.length-1;i++)t+=a[i].dist(a[i+1]);return t}function TA(a,t,i){return a?.6*t*i:0}function EA(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function gN(a,t,i,c,h,p){const g=TA(i,h,p),w=EA(i,c)*p;let T=0;const A=SA(a)/2;for(let M=0;M<a.length-1;M++){const O=a[M],z=a[M+1],U=O.dist(z);if(T+U>A){const V=(A-T)/U,H=xr(O.x,z.x,V),re=xr(O.y,z.y,V),ne=new ef(H,re,0,z.angleTo(O),M);return!g||wA(a,ne,w,g,t)?ne:void 0}T+=U}}function _N(a,t,i,c,h,p,g,w,T){const A=TA(c,p,g),M=EA(c,h),O=M*g,z=a[0].x===0||a[0].x===T||a[0].y===0||a[0].y===T;return t-O<t/4&&(t=O+t/4),AA(a,z?t/2*w%t:(M/2+2*p)*g*w%t,t,A,i,O,z,!1,T)}function AA(a,t,i,c,h,p,g,w,T){const A=p/2,M=SA(a);let O=0,z=t-i,U=[];for(let V=0;V<a.length-1;V++){const H=a[V],re=a[V+1],ne=H.dist(re),de=re.angleTo(H);for(;z+i<O+ne;){z+=i;const ue=(z-O)/ne,X=xr(H.x,re.x,ue),se=xr(H.y,re.y,ue);if(X>=0&&X<T&&se>=0&&se<T&&z-A>=0&&z+A<=M){const he=new ef(X,se,0,de,V);c&&!wA(a,he,p,c,h)||U.push(he)}}O+=ne}return w||U.length||g||(U=AA(a,O/2,i,c,h,p,g,!0,T)),U}function IA(a){let t=0,i=0;for(const g of a)t+=g.w*g.h,i=Math.max(i,g.w);a.sort((g,w)=>w.h-g.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let h=0,p=0;for(const g of a)for(let w=c.length-1;w>=0;w--){const T=c[w];if(!(g.w>T.w||g.h>T.h)){if(g.x=T.x,g.y=T.y,p=Math.max(p,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===T.w&&g.h===T.h){const A=c.pop();w<c.length&&(c[w]=A)}else g.h===T.h?(T.x+=g.w,T.w-=g.w):g.w===T.w?(T.y+=g.h,T.h-=g.h):(c.push({x:T.x+g.w,y:T.y,w:T.w-g.w,h:g.h}),T.y+=g.h,T.h-=g.h);break}}return{w:h,h:p,fill:t/(h*p)||0}}qt(ef,"Anchor");const mm=1;class b_{static getImagePositionScale(t,i,c){if(i&&t&&t.options&&t.options.transform){const h=t.options.transform;return{x:h.a,y:h.d}}return{x:c,y:c}}constructor(t,i,c,h){this.paddedRect=t;const{pixelRatio:p,version:g,stretchX:w,stretchY:T,content:A,sdf:M,usvg:O}=i;this.pixelRatio=p,this.stretchX=w,this.stretchY=T,this.content=A,this.version=g,this.padding=c,this.sdf=M,this.scale=b_.getImagePositionScale(h,O,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function o1(a,t,i){const c=vs.parse(a),h=function(p,g,w=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*w[0])+2*g,h:(p.data?p.data.height:p.height*w[1])+2*g}}(t,i,[c.options.transform.a,c.options.transform.d]);return{bin:h,imagePosition:new b_(h,t,i,c),imageVariant:c}}class PA{constructor(t,i,c){const h=new Map,p=new Map;this.haveRenderCallbacks=[];const g=[];this.addImages(t,h,mm,g),this.addImages(i,p,2,g);const{w,h:T}=IA(g),A=new ar({width:w||1,height:T||1});for(const[M,O]of t.entries()){const z=h.get(M).paddedRect;ar.copy(O.data,A,{x:0,y:0},{x:z.x+mm,y:z.y+mm},O.data,c,O.sdf)}for(const[M,O]of i.entries()){const z=p.get(M),U=z.paddedRect;let V=z.padding;const H=U.x+V,re=U.y+V,ne=O.data.width,de=O.data.height;V=V>1?V-1:V,ar.copy(O.data,A,{x:0,y:0},{x:H,y:re},O.data,c),ar.copy(O.data,A,{x:0,y:de-V},{x:H,y:re-V},{width:ne,height:V},c),ar.copy(O.data,A,{x:0,y:0},{x:H,y:re+de},{width:ne,height:V},c),ar.copy(O.data,A,{x:ne-V,y:0},{x:H-V,y:re},{width:V,height:de},c),ar.copy(O.data,A,{x:0,y:0},{x:H+ne,y:re},{width:V,height:de},c),ar.copy(O.data,A,{x:ne-V,y:de-V},{x:H-V,y:re-V},{width:V,height:V},c),ar.copy(O.data,A,{x:0,y:de-V},{x:H+ne,y:re-V},{width:V,height:V},c),ar.copy(O.data,A,{x:0,y:0},{x:H+ne,y:re+de},{width:V,height:V},c),ar.copy(O.data,A,{x:ne-V,y:0},{x:H-V,y:re+de},{width:V,height:V},c)}this.lut=c,this.image=A,this.iconPositions=h,this.patternPositions=p}addImages(t,i,c,h){for(const[p,g]of t.entries()){const{bin:w,imagePosition:T,imageVariant:A}=o1(p,g,c);i.set(p,T),h.push(w),g.hasRenderCallback&&this.haveRenderCallbacks.push(A.id)}}patchUpdatedImages(t,i,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>t.hasImage(h,c)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const h of t.getUpdatedImages(c)){for(const p of this.iconPositions.keys()){const g=vs.parse(p);if(Ca.isEqual(g.id,h)){const w=t.getImage(h,c);this.patchUpdatedImage(this.iconPositions.get(p),w,i)}}for(const p of this.patternPositions.keys()){const g=vs.parse(p);if(Ca.isEqual(g.id,h)){const w=t.getImage(h,c);this.patchUpdatedImage(this.patternPositions.get(p),w,i)}}}}patchUpdatedImage(t,i,c){if(!t||!i||t.version===i.version)return;t.version=i.version;const[h,p]=t.tl,g=t.sdf;if(this.lut||g){const w={width:i.data.width,height:i.data.height},T=new ar(w);ar.copy(i.data,T,{x:0,y:0},{x:0,y:0},w,this.lut,g),c.update(T,{position:{x:h,y:p}})}else c.update(i.data,{position:{x:h,y:p}})}}qt(b_,"ImagePosition"),qt(PA,"ImageAtlas");const w_=1e20;function CA(a,t,i,c,h,p,g,w,T){for(let A=t;A<t+c;A++)MA(a,i*p+A,p,h,g,w,T);for(let A=i;A<i+h;A++)MA(a,A*p+t,1,c,g,w,T)}function MA(a,t,i,c,h,p,g){p[0]=0,g[0]=-w_,g[1]=w_,h[0]=a[t];for(let w=1,T=0,A=0;w<c;w++){h[w]=a[t+w*i];const M=w*w;do{const O=p[T];A=(h[w]-h[O]+M-O*O)/(w-O)/2}while(A<=g[T]&&--T>-1);T++,p[T]=w,g[T]=A,g[T+1]=w_}for(let w=0,T=0;w<c;w++){for(;g[T+1]<w;)T++;const A=p[T],M=w-A;a[t+w*i]=h[A]+M*M}}const Ju=2,a1={none:0,ideographs:1,all:2};class cg{constructor(t,i,c){this.requestManager=t,this.localGlyphMode=i,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,i){this.urls[i]=t}getGlyphs(t,i,c){const h=[],p=this.urls[i]||Wi.GLYPHS_URL;for(const g in t)for(const w of t[g])h.push({stack:g,id:w});ht(h,({stack:g,id:w},T)=>{let A=this.entries[g];A||(A=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=A.glyphs[w];if(M!==void 0)return void T(null,{stack:g,id:w,glyph:M});if(M=this._tinySDF(A,g,w),M)return A.glyphs[w]=M,void T(null,{stack:g,id:w,glyph:M});const O=Math.floor(w/256);if(256*O>65535)return tn("glyphs > 65535 not supported"),void T(null,{stack:g,id:w,glyph:M});if(A.ranges[O])return void T(null,{stack:g,id:w,glyph:M});let z=A.requests[O];z||(z=A.requests[O]=[],cg.loadGlyphRange(g,O,p,this.requestManager,(U,V)=>{if(V){A.ascender=V.ascender,A.descender=V.descender;for(const H in V.glyphs)this._doesCharSupportLocalGlyph(+H)||(A.glyphs[+H]=V.glyphs[+H]);A.ranges[O]=!0}for(const H of z)H(U,V);delete A.requests[O]})),z.push((U,V)=>{U?T(U):V&&T(null,{stack:g,id:w,glyph:V.glyphs[w]||null})})},(g,w)=>{if(g)c(g);else if(w){const T={};for(const{stack:A,id:M,glyph:O}of w)T[A]===void 0&&(T[A]={}),T[A].glyphs===void 0&&(T[A].glyphs={}),T[A].glyphs[M]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics},T[A].ascender=this.entries[A].ascender,T[A].descender=this.entries[A].descender;c(null,T)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==a1.none&&(this.localGlyphMode===a1.all?!!this.localFontFamily:!!this.localFontFamily&&(_r["CJK Unified Ideographs"](t)||_r["Hangul Syllables"](t)||_r.Hiragana(t)||_r.Katakana(t)||_r["CJK Symbols and Punctuation"](t)||_r["CJK Unified Ideographs Extension A"](t)||_r["CJK Unified Ideographs Extension B"](t)||_r.Osage(t)))}_tinySDF(t,i,c){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(c))return;let p=t.tinySDF;if(!p){let H="400";/bold/i.test(i)?H="900":/medium/i.test(i)?H="500":/light/i.test(i)&&(H="200"),p=t.tinySDF=new cg.TinySDF({fontFamily:h,fontWeight:H,fontSize:24*Ju,buffer:3*Ju,radius:8*Ju}),p.fontWeight=H}if(this.localGlyphs[p.fontWeight][c])return this.localGlyphs[p.fontWeight][c];const g=String.fromCodePoint(c),{data:w,width:T,height:A,glyphWidth:M,glyphHeight:O,glyphLeft:z,glyphTop:U,glyphAdvance:V}=p.draw(g);return this.localGlyphs[p.fontWeight][c]={id:c,bitmap:new Tt({width:T,height:A},w),metrics:{width:M/Ju,height:O/Ju,left:z/Ju,top:U/Ju-27,advance:V/Ju,localGlyph:!0}}}}cg.loadGlyphRange=function(a,t,i,c,h){const p=256*t,g=p+255,w=c.transformRequest(c.normalizeGlyphsURL(i).replace("{fontstack}",a).replace("{range}",`${p}-${g}`),Mc.Glyphs);hl(w,(T,A)=>{if(T)h(T);else if(A){const M={},O=function(z){return new Jy(z).readFields(uN,{})}(A);for(const z of O.glyphs)M[z.id]=z;h(null,{glyphs:M,ascender:O.ascender,descender:O.descender})}})},cg.TinySDF=class{constructor({fontSize:a=24,buffer:t=3,radius:i=8,cutoff:c=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=i;const w=this.size=a+4*t,T=this._createCanvas(w),A=this.ctx=T.getContext("2d",{willReadFrequently:!0});A.font=`${g} ${p} ${a}px ${h}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(a){const t=document.createElement("canvas");return t.width=t.height=a,t}draw(a){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:c,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(a),g=Math.ceil(i),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),T=Math.min(this.size-this.buffer,g+Math.ceil(c)),A=w+2*this.buffer,M=T+2*this.buffer,O=Math.max(A*M,0),z=new Uint8ClampedArray(O),U={data:z,width:A,height:M,glyphWidth:w,glyphHeight:T,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(w===0||T===0)return U;const{ctx:V,buffer:H,gridInner:re,gridOuter:ne}=this;V.clearRect(H,H,w,T),V.fillText(a,H,H+g);const de=V.getImageData(H,H,w,T);ne.fill(w_,0,O),re.fill(0,0,O);for(let ue=0;ue<T;ue++)for(let X=0;X<w;X++){const se=de.data[4*(ue*w+X)+3]/255;if(se===0)continue;const he=(ue+H)*A+X+H;if(se===1)ne[he]=0,re[he]=w_;else{const _e=.5-se;ne[he]=_e>0?_e*_e:0,re[he]=_e<0?_e*_e:0}}CA(ne,0,0,A,M,A,this.f,this.v,this.z),CA(re,H,H,w,T,A,this.f,this.v,this.z);for(let ue=0;ue<O;ue++){const X=Math.sqrt(ne[ue])-Math.sqrt(re[ue]);z[ue]=Math.round(255-255*(X/this.radius+this.cutoff))}return U}};const sp=mm;function OA(a,t){return a+t[1]-t[0]}function DA(a,t,i,c,h=1){const p=[],g=a.imagePrimary,w=g.pixelRatio,T=g.paddedRect.w-2*sp,A=g.paddedRect.h-2*sp,M=(a.right-a.left)*h,O=(a.bottom-a.top)*h,z=g.stretchX||[[0,T]],U=g.stretchY||[[0,A]],V=z.reduce(OA,0),H=U.reduce(OA,0),re=T-V,ne=A-H;let de=0,ue=V,X=0,se=H,he=0,_e=re,Ce=0,Re=ne;if(g.content&&c){const $e=g.content;de=ev(z,0,$e[0]),X=ev(U,0,$e[1]),ue=ev(z,$e[0],$e[2]),se=ev(U,$e[1],$e[3]),he=$e[0]-de,Ce=$e[1]-X,_e=$e[2]-$e[0]-ue,Re=$e[3]-$e[1]-se}const Ne=($e,at,xt,mt)=>{const yt=tv($e.stretch-de,ue,M,a.left*h),At=rv($e.fixed-he,_e,$e.stretch,V),tt=tv(at.stretch-X,se,O,a.top*h),_t=rv(at.fixed-Ce,Re,at.stretch,H),Je=tv(xt.stretch-de,ue,M,a.left*h),it=rv(xt.fixed-he,_e,xt.stretch,V),Pt=tv(mt.stretch-X,se,O,a.top*h),Mt=rv(mt.fixed-Ce,Re,mt.stretch,H),sr=new Dt(yt,tt),Qt=new Dt(Je,tt),jt=new Dt(Je,Pt),It=new Dt(yt,Pt),Lr=new Dt(At/w,_t/w),rr=new Dt(it/w,Mt/w),nr=t*Math.PI/180;if(nr){const Kr=Math.sin(nr),ai=Math.cos(nr),vi=[ai,-Kr,Kr,ai];sr._matMult(vi),Qt._matMult(vi),It._matMult(vi),jt._matMult(vi)}const Cr=$e.stretch+$e.fixed,Gr=xt.stretch+xt.fixed,Xr=at.stretch+at.fixed,cn=mt.stretch+mt.fixed,on=a.imageSecondary;return{tl:sr,tr:Qt,bl:It,br:jt,texPrimary:{x:g.paddedRect.x+sp+Cr,y:g.paddedRect.y+sp+Xr,w:Gr-Cr,h:cn-Xr},texSecondary:on?{x:on.paddedRect.x+sp+Cr,y:on.paddedRect.y+sp+Xr,w:Gr-Cr,h:cn-Xr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Lr,pixelOffsetBR:rr,minFontScaleX:_e/w/M,minFontScaleY:Re/w/O,isSDF:i}};if(c&&(g.stretchX||g.stretchY)){const $e=kA(z,re,V),at=kA(U,ne,H);for(let xt=0;xt<$e.length-1;xt++){const mt=$e[xt],yt=$e[xt+1];for(let At=0;At<at.length-1;At++)p.push(Ne(mt,at[At],yt,at[At+1]))}}else p.push(Ne({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:A+1}));return p}function ev(a,t,i){let c=0;for(const h of a)c+=Math.max(t,Math.min(i,h[1]))-Math.max(t,Math.min(i,h[0]));return c}function kA(a,t,i){const c=[{fixed:-sp,stretch:0}];for(const[h,p]of a){const g=c[c.length-1];c.push({fixed:h-g.stretch,stretch:g.stretch}),c.push({fixed:h-g.stretch,stretch:g.stretch+(p-h)})}return c.push({fixed:t+sp,stretch:i}),c}function tv(a,t,i,c){return a/t*i+c}function rv(a,t,i,c){return a-t*i/c}function yN(a,t,i,c){const h=t+a.positionedLines[c].lineOffset;return c===0?i+h/2:i+(h+(t+a.positionedLines[c-1].lineOffset))/2}function vN(a,t=1,i=!1){let c=1/0,h=1/0,p=-1/0,g=-1/0;const w=a[0];for(let U=0;U<w.length;U++){const V=w[U];(!U||V.x<c)&&(c=V.x),(!U||V.y<h)&&(h=V.y),(!U||V.x>p)&&(p=V.x),(!U||V.y>g)&&(g=V.y)}const T=Math.min(p-c,g-h);let A=T/2;const M=new Sd([],xN);if(T===0)return new Dt(c,h);for(let U=c;U<p;U+=T)for(let V=h;V<g;V+=T)M.push(new ug(U+A,V+A,A,a));let O=function(U){let V=0,H=0,re=0;const ne=U[0];for(let de=0,ue=ne.length,X=ue-1;de<ue;X=de++){const se=ne[de],he=ne[X],_e=se.x*he.y-he.x*se.y;H+=(se.x+he.x)*_e,re+=(se.y+he.y)*_e,V+=3*_e}return new ug(H/V,re/V,0,U)}(a),z=M.length;for(;M.length;){const U=M.pop();(U.d>O.d||!O.d)&&(O=U,i&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,z)),U.max-O.d<=t||(A=U.h/2,M.push(new ug(U.p.x-A,U.p.y-A,A,a)),M.push(new ug(U.p.x+A,U.p.y-A,A,a)),M.push(new ug(U.p.x-A,U.p.y+A,A,a)),M.push(new ug(U.p.x+A,U.p.y+A,A,a)),z+=4)}return i&&(console.log(`num probes: ${z}`),console.log(`best distance: ${O.d}`)),O.p}function xN(a,t){return t.max-a.max}class ug{constructor(t,i,c,h){this.p=new Dt(t,i),this.h=c,this.d=function(p,g){let w=!1,T=1/0;for(let A=0;A<g.length;A++){const M=g[A];for(let O=0,z=M.length,U=z-1;O<z;U=O++){const V=M[O],H=M[U];V.y>p.y!=H.y>p.y&&p.x<(H.x-V.x)*(p.y-V.y)/(H.y-V.y)+V.x&&(w=!w),T=Math.min(T,_n(p,V,H))}}return(w?1:-1)*Math.sqrt(T)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const bN=Object.keys,s1=Number.POSITIVE_INFINITY,wN=Math.sqrt(2);function RA(a,[t,i]){let c=0,h=0;if(i===s1){t<0&&(t=0);const p=t/wN;switch(a){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-t;break;case"top":h=t-7}switch(a){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=t;break;case"right":c=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),a){case"top-right":case"top-left":case"top":h=i-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-i}switch(a){case"top-right":case"bottom-right":case"right":c=-t;break;case"top-left":case"bottom-left":case"left":c=t}}return[c,h]}function nv(a,t,i,c,h,p,g,w,T){if(!t||!t.usvg)return;const A=xA(c),M=xA(h),O=p!=="both"&&p!=="width"||!yA(c)?1:Math.max(1,M.width/A.width),z=p!=="both"&&p!=="height"||!vA(c)?1:Math.max(1,M.height/A.height);i.scaleSelf(O,z);const U=i.toString();g.set(U,i),w.set(U,t);const{imagePosition:V}=o1(U,t,mm);T.set(U,V)}function LA(a,t,i,c,h,p,g,w){if(!a)return;const T=function(A,M,O,z,U){if(A.kind==="camera")return A.maxSize;if(A.kind==="composite"){const V=M.possiblyEvaluate(new $n(A.maxZoom),O).evaluate(U,{},O),H=M.possiblyEvaluate(new $n(A.minZoom),O).evaluate(U,{},O);return Math.max(V,H)}return M.possiblyEvaluate(new $n(z)).evaluate(U,{},O)}(t,i,c,h,p);return a.scaleSelf(T*w*g)}function zA(a,t,i,c,h,p,g,w){return{iconPrimary:LA(a.getPrimary(),t,i,c,h,p,g,w),iconSecondary:LA(a.getSecondary(),t,i,c,h,p,g,w)}}function FA(a,t,i,c){if(!a)return;const h=t.get(i.toString());if(a.imagePrimary=h,c){const p=t.get(c.toString());a.imageSecondary=p}}function SN(a,t){for(const i in a.horizontal)NA(a.horizontal[i],t);NA(a.vertical,t)}function NA(a,t){if(a){for(const i of a.positionedLines)for(const c of i.positionedGlyphs)if(c.image!==null){const h=c.image.toString();c.rect=t.get(h).paddedRect}}}function l1(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function TN(a,t,i,c,h,p,g,w,T){const A=c1(p.horizontal)||p.vertical,M=i.get("icon-text-fit-padding").evaluate(c,{},h);let O,z=t;return t&&T!=="none"&&(a.allowVerticalPlacement&&p.vertical&&(O=_A(t,p.vertical,T,M,w,g)),A&&(z=_A(t,A,T,M,w,g))),{defaultShapedIcon:z,verticallyShapedIcon:O}}function EN(a,t,i,c,h,p,g,w,T,A,M,O,z,U,V,H,re,ne,de,ue){let X=g.textMaxSize.evaluate(t,{},z);X===void 0?X=w*g.textScaleFactor:X*=g.textScaleFactor;const se=a.layers[0].layout,he=c1(i.horizontal)||i.vertical,_e=U.name==="globe",Ce=ia,Re=a.tilePixelRatio*X/Ce,Ne=(At=a.overscaling,a.zoom>18&&At>2&&(At>>=1),Math.max(zt/(512*At),1)*se.get("symbol-spacing")),$e=se.get("text-padding")*a.tilePixelRatio,at=se.get("icon-padding")*a.tilePixelRatio,xt=Q(se.get("text-max-angle")),mt=se.get("icon-rotation-alignment")==="map"&&ue!=="point",yt=Ne/2;var At;a.hasAnyIconTextFit===!1&&re!=="none"&&(a.hasAnyIconTextFit=!0);const tt=t.properties?+t.properties[hm]:null,_t=tt&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(tt):65535,Je=(it,Pt,Mt)=>{if(Pt.x<0||Pt.x>=zt||Pt.y<0||Pt.y>=zt)return;let sr=null;if(_e){const{x:Qt,y:jt,z:It}=U.projectTilePoint(Pt.x,Pt.y,Mt);sr={anchor:new ef(Qt,jt,It,0,void 0),up:U.upVector(Mt,Pt.x,Pt.y)}}(function(Qt,jt,It,Lr,rr,nr,Cr,Gr,Xr,cn,on,Kr,ai,vi,me,ve,lt,Rt,$t,Ut,or,Ir,vn,xn,Jr,Kn,fi,bn,Ni){const xi=Qt.addToLineVertexArray(jt,Lr);let Hn,Xi,Ei,pi,bi,ei,an,ni=0,Bi=0,Er=0,kn=0,Ai=-1,qi=-1;const Pi={};let Eo=aa("");const si=It?It.anchor:jt,go=bn!=="none";let ks=0,Sa=0;if(Xr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Ao=Xr.layout.get("text-offset").evaluate(or,{},Jr);ks=Ao[0]*ia,Sa=Ao[1]*ia}else ks=Xr.layout.get("text-radial-offset").evaluate(or,{},Jr)*ia,Sa=s1;if(Qt.allowVerticalPlacement&&rr.vertical){const Ao=rr.vertical;if(me)ei=u1(Ao),Gr&&(an=u1(Gr));else{const Vo=Xr.layout.get("text-rotate").evaluate(or,{},Jr)+90;Ei=iv(cn,si,jt,on,Kr,ai,Ao,vi,Vo,ve),Gr&&(pi=iv(cn,si,jt,on,Kr,ai,Gr,Rt,Vo))}}if(nr){const Ao=Qt.iconSizeData,Vo=Xr.layout.get("icon-rotate").evaluate(or,{},Jr),Ta=DA(nr,Vo,vn,go,Ir.iconScaleFactor),Ga=Gr?DA(Gr,Vo,vn,go,Ir.iconScaleFactor):void 0;Xi=iv(cn,si,jt,on,Kr,ai,nr,Rt,Vo,null),ni=4*Ta.length;let Fa=null;Ao.kind==="source"?(Fa=[rd*Xr.layout.get("icon-size").evaluate(or,{},Jr)*Ir.iconScaleFactor],Fa[0]>lp&&tn(`${Qt.layerIds[0]}: Value for "icon-size" is >= ${S_}. Reduce your "icon-size".`)):Ao.kind==="composite"&&(Fa=[rd*Ir.compositeIconSizes[0].evaluate(or,{},Jr)*Ir.iconScaleFactor,rd*Ir.compositeIconSizes[1].evaluate(or,{},Jr)*Ir.iconScaleFactor],(Fa[0]>lp||Fa[1]>lp)&&tn(`${Qt.layerIds[0]}: Value for "icon-size" is >= ${S_}. Reduce your "icon-size".`)),Qt.addSymbols(Qt.icon,Ta,Fa,Ut,$t,or,void 0,It,jt,xi.lineStartIndex,xi.lineLength,-1,xn,Jr,Kn,fi),Ai=Qt.icon.placedSymbolArray.length-1,Ga&&(Bi=4*Ga.length,Qt.addSymbols(Qt.icon,Ga,Fa,Ut,$t,or,rl.vertical,It,jt,xi.lineStartIndex,xi.lineLength,-1,xn,Jr,Kn,fi),qi=Qt.icon.placedSymbolArray.length-1)}for(const Ao in rr.horizontal){const Vo=Ao,Ta=rr.horizontal[Vo];Hn||(Eo=aa(Ta.text),me?bi=u1(Ta):Hn=iv(cn,si,jt,on,Kr,ai,Ta,vi,Xr.layout.get("text-rotate").evaluate(or,{},Jr),ve));const Ga=Ta.positionedLines.length===1;if(Er+=BA(Qt,It,jt,Ta,Cr,Xr,me,or,ve,xi,rr.vertical?rl.horizontal:rl.horizontalOnly,Ga?bN(rr.horizontal):[Vo],Pi,Ai,Ir,xn,Jr,Kn),Ga)break}rr.vertical&&(kn+=BA(Qt,It,jt,rr.vertical,Cr,Xr,me,or,ve,xi,rl.vertical,["vertical"],Pi,qi,Ir,xn,Jr,Kn));let da=-1;const Rs=(Ao,Vo)=>Ao?Math.max(Ao,Vo):Vo;da=Rs(bi,da),da=Rs(ei,da),da=Rs(an,da);const nd=da>-1?1:0;Qt.glyphOffsetArray.length>=65535&&tn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),or.sortKey!==void 0&&Qt.addToSortKeyRanges(Qt.symbolInstances.length,or.sortKey),Qt.symbolInstances.emplaceBack(jt.x,jt.y,si.x,si.y,si.z,Pi.right>=0?Pi.right:-1,Pi.center>=0?Pi.center:-1,Pi.left>=0?Pi.left:-1,Pi.vertical>=0?Pi.vertical:-1,Ai,qi,Eo,Hn!==void 0?Hn:Qt.collisionBoxArray.length,Hn!==void 0?Hn+1:Qt.collisionBoxArray.length,Ei!==void 0?Ei:Qt.collisionBoxArray.length,Ei!==void 0?Ei+1:Qt.collisionBoxArray.length,Xi!==void 0?Xi:Qt.collisionBoxArray.length,Xi!==void 0?Xi+1:Qt.collisionBoxArray.length,pi||Qt.collisionBoxArray.length,pi?pi+1:Qt.collisionBoxArray.length,on,Er,kn,ni,Bi,nd,0,ks,Sa,da,0,go?1:0,Ni)})(a,Pt,sr,it,i,c,p,h,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,$e,de,A,0,at,mt,ne,t,g,M,O,z,V,H,re,_t)};if(ue==="line")for(const it of Ky(t.geometry,0,0,zt,zt)){const Pt=_N(it,Ne,xt,i.vertical||he,c,Ce,Re,a.overscaling,zt);for(const Mt of Pt)he&&AN(a,he.text,yt,Mt)||Je(it,Mt,z)}else if(ue==="line-center"){for(const it of t.geometry)if(it.length>1){const Pt=gN(it,xt,i.vertical||he,c,Ce,Re);Pt&&Je(it,Pt,z)}}else if(t.type==="Polygon")for(const it of Gy(t.geometry,0)){const Pt=vN(it,16);Je(it[0],new ef(Pt.x,Pt.y,0,0,void 0),z)}else if(t.type==="LineString")for(const it of t.geometry)Je(it,new ef(it[0].x,it[0].y,0,0,void 0),z);else if(t.type==="Point")for(const it of t.geometry)for(const Pt of it)Je([Pt],new ef(Pt.x,Pt.y,0,0,void 0),z)}const S_=255,lp=S_*rd;function BA(a,t,i,c,h,p,g,w,T,A,M,O,z,U,V,H,re,ne){const de=function(se,he,_e,Ce,Re,Ne,$e,at){const xt=[];if(he.positionedLines.length===0)return xt;const mt=Ce.layout.get("text-rotate").evaluate(Ne,{})*Math.PI/180,yt=function(it){const Pt=it[0],Mt=it[1],sr=Pt*Mt;return sr>0?[Pt,-Mt]:sr<0?[-Pt,Mt]:Pt===0?[Mt,Pt]:[Mt,-Pt]}(_e);let At=Math.abs(he.top-he.bottom);for(const it of he.positionedLines)At-=it.lineOffset;const tt=he.positionedLines.length,_t=At/tt;let Je=he.top-_e[1];for(let it=0;it<tt;++it){const Pt=he.positionedLines[it];Je=yN(he,_t,Je,it);for(const Mt of Pt.positionedGlyphs){if(!Mt.rect)continue;const sr=Mt.rect||{};let Qt=uA+1,jt=!0,It=1,Lr=0;if(Mt.image){const or=$e.get(Mt.image.toString());if(!or)continue;if(or.sdf){tn("SDF images are not supported in formatted text and will be ignored.");continue}jt=!1,It=or.pixelRatio,Qt=mm/It}const rr=(Re||at)&&Mt.vertical,nr=Mt.metrics.advance*Mt.scale/2,Cr=Mt.metrics,Gr=Mt.rect;if(Gr===null)continue;at&&he.verticalizable&&(Lr=Mt.image?nr-Mt.metrics.width*Mt.scale/2:0);const Xr=Re?[Mt.x+nr,Mt.y]:[0,0];let cn=[0,0],on=[0,0],Kr=!1;Re||(rr?(on=[Mt.x+nr+yt[0],Mt.y+yt[1]-Lr],Kr=!0):cn=[Mt.x+nr+_e[0],Mt.y+_e[1]-Lr]);const ai=Gr.w*Mt.scale/(It*(Mt.localGlyph?Ju:1)),vi=Gr.h*Mt.scale/(It*(Mt.localGlyph?Ju:1));let me,ve,lt,Rt;if(rr){const or=Mt.y-Je,Ir=new Dt(-nr,nr-or),vn=-Math.PI/2,xn=new Dt(...on);me=new Dt(-nr+cn[0],cn[1]),me._rotateAround(vn,Ir)._add(xn),me.x+=-or+nr,me.y-=(Cr.left-Qt)*Mt.scale;const Jr=Mt.image?Cr.advance*Mt.scale:ia*Mt.scale,Kn=String.fromCodePoint(Mt.glyph);sN(Kn)?me.x+=(1-Qt)*Mt.scale:lN(Kn)?me.x+=Jr-Cr.height*Mt.scale+(-Qt-1)*Mt.scale:me.x+=Mt.image||Cr.width+2*Qt===Gr.w&&Cr.height+2*Qt===Gr.h?(Jr-vi)/2:(Jr-(Cr.height+2*Qt)*Mt.scale)/2,ve=new Dt(me.x,me.y-ai),lt=new Dt(me.x+vi,me.y),Rt=new Dt(me.x+vi,me.y-ai)}else{const or=(Cr.left-Qt)*Mt.scale-nr+cn[0],Ir=(-Cr.top-Qt)*Mt.scale+cn[1],vn=or+ai,xn=Ir+vi;me=new Dt(or,Ir),ve=new Dt(vn,Ir),lt=new Dt(or,xn),Rt=new Dt(vn,xn)}if(mt){let or;or=Re?new Dt(0,0):Kr?new Dt(yt[0],yt[1]):new Dt(_e[0],_e[1]),me._rotateAround(mt,or),ve._rotateAround(mt,or),lt._rotateAround(mt,or),Rt._rotateAround(mt,or)}const $t=new Dt(0,0),Ut=new Dt(0,0);xt.push({tl:me,tr:ve,bl:lt,br:Rt,texPrimary:sr,texSecondary:void 0,writingMode:he.writingMode,glyphOffset:Xr,sectionIndex:Mt.sectionIndex,isSDF:jt,pixelOffsetTL:$t,pixelOffsetBR:Ut,minFontScaleX:0,minFontScaleY:0})}}return xt}(0,c,T,p,g,w,h,a.allowVerticalPlacement),ue=a.textSizeData;let X=null;ue.kind==="source"?(X=[rd*p.layout.get("text-size").evaluate(w,{},re)*V.textScaleFactor],X[0]>lp&&tn(`${a.layerIds[0]}: Value for "text-size" is >= ${S_}. Reduce your "text-size".`)):ue.kind==="composite"&&(X=[rd*V.compositeTextSizes[0].evaluate(w,{},re)*V.textScaleFactor,rd*V.compositeTextSizes[1].evaluate(w,{},re)*V.textScaleFactor],(X[0]>lp||X[1]>lp)&&tn(`${a.layerIds[0]}: Value for "text-size" is >= ${S_}. Reduce your "text-size".`)),a.addSymbols(a.text,de,X,T,g,w,M,t,i,A.lineStartIndex,A.lineLength,U,H,re,ne,!1);for(const se of O)z[se]=a.text.placedSymbolArray.length-1;return 4*de.length}function c1(a){for(const t in a)return a[t];return null}function iv(a,t,i,c,h,p,g,w,T,A){let M=g.top,O=g.bottom,z=g.left,U=g.right;if(gA(g)&&g.collisionPadding){const V=g.collisionPadding;z-=V[0],M-=V[1],U+=V[2],O+=V[3]}if(T){const V=new Dt(z,M),H=new Dt(U,M),re=new Dt(z,O),ne=new Dt(U,O),de=Q(T);let ue=new Dt(0,0);A&&(ue=new Dt(A[0],A[1])),V._rotateAround(de,ue),H._rotateAround(de,ue),re._rotateAround(de,ue),ne._rotateAround(de,ue),z=Math.min(V.x,H.x,re.x,ne.x),U=Math.max(V.x,H.x,re.x,ne.x),M=Math.min(V.y,H.y,re.y,ne.y),O=Math.max(V.y,H.y,re.y,ne.y)}return a.emplaceBack(t.x,t.y,t.z,i.x,i.y,z,M,U,O,w,c,h,p),a.length-1}function u1(a){gA(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const t=a.bottom-a.top;return t>0?Math.max(10,t):null}function AN(a,t,i,c){const h=a.compareText;if(t in h){const p=h[t];for(let g=p.length-1;g>=0;g--)if(c.dist(p[g])<i)return!0}else h[t]=[];return h[t].push(c),!1}function jA(a,t){const i=a.fovAboveCenter,c=a.elevation?a.elevation.getMinElevationBelowMSL()*t:0,h=(a._camera.position[2]*a.worldSize-c)/Math.cos(a._pitch),p=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-a._pitch-i,.01));let g=Math.sin(a._pitch)*p+h;const w=h*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let T=Math.max(a.zoom-17,0);a.isOrthographic&&(T/=10),g*=1+T}return Math.min(1.01*g,w)}function T_(a,t){if(!t.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:t};const i=Math.pow(2,-a.z),c=a.x*i,h=(a.x+1)*i,p=a.y*i,g=(a.y+1)*i,w=Ie(c),T=Ie(h),A=Oe(p),M=Oe(g),O=t.project(w,A),z=t.project(T,A),U=t.project(T,M),V=t.project(w,M);let H=Math.min(O.x,z.x,U.x,V.x),re=Math.min(O.y,z.y,U.y,V.y),ne=Math.max(O.x,z.x,U.x,V.x),de=Math.max(O.y,z.y,U.y,V.y);const ue=i/16;function X(he,_e,Ce,Re,Ne,$e){const at=(Ce+Ne)/2,xt=(Re+$e)/2,mt=t.project(Ie(at),Oe(xt)),yt=Math.max(0,H-mt.x,re-mt.y,mt.x-ne,mt.y-de);H=Math.min(H,mt.x),ne=Math.max(ne,mt.x),re=Math.min(re,mt.y),de=Math.max(de,mt.y),yt>ue&&(X(he,mt,Ce,Re,at,xt),X(mt,_e,at,xt,Ne,$e))}X(O,z,c,p,h,p),X(z,U,h,p,h,g),X(U,V,h,g,c,g),X(V,O,c,g,c,p),H-=ue,re-=ue,ne+=ue,de+=ue;const se=1/Math.max(ne-H,de-re);return{scale:se,x:H*se,y:re*se,x2:ne*se,y2:de*se,projection:t}}function UA(a,{x:t,y:i},c=0){return new Dt(((t-c)*a.scale-a.x)*zt,(i*a.scale-a.y)*zt)}const IN=oe(new Float32Array(16));class cp{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,i){return{x:0,y:0,z:0}}unproject(t,i){return new K(0,0)}projectTilePoint(t,i,c){return{x:t,y:i,z:0}}locationPoint(t,i,c,h=!0){return t._coordinatePoint(t.locationCoordinate(i,c),h)}pixelsPerMeter(t,i){return ye(1,t)*i}pixelSpaceConversion(t,i,c){return 1}farthestPixelDistance(t){return jA(t,t.pixelsPerMeter)}pointCoordinate(t,i,c,h){const p=t.horizonLineFromTop(!1),g=new Dt(i,Math.max(p,c));return t.rayIntersectionCoordinate(t.pointRayIntersection(g,h))}pointCoordinate3D(t,i,c){const h=new Dt(i,c);if(t.elevation)return t.elevation.pointCoordinate(h);{const p=this.pointCoordinate(t,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(t,i){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,i.x,i.y);const c=t.horizonLineFromTop();return i.y<c}createInversionMatrix(t,i){return IN}createTileMatrix(t,i,c){let h,p,g;const w=c.canonical,T=oe(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=T_(w,this);h=1,p=A.x+c.wrap*A.scale,g=A.y,ke(T,T,[h/A.scale,h/A.scale,t.pixelsPerMeter/i])}else h=i/t.zoomScale(w.z),p=(w.x+Math.pow(2,w.z)*c.wrap)*h,g=w.y*h;return ge(T,T,[p,g,0]),ke(T,T,[h/zt,h/zt,1]),T}upVector(t,i,c){return[0,0,1]}upVectorScale(t,i,c){return{metersToTile:1}}}class PN extends cp{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[i,c]=this.parallels=t.parallels||[29.5,45.5],h=Math.sin(Q(i));this.n=(h+Math.sin(Q(c)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(t,i){const{n:c,c:h,r0:p}=this,g=Q(t-this.center[0]),w=Q(i),T=Math.sqrt(h-2*c*Math.sin(w))/c;return{x:T*Math.sin(g*c),y:T*Math.cos(g*c)-p,z:0}}unproject(t,i){const{n:c,c:h,r0:p}=this,g=p+i;let w=Math.atan2(t,Math.abs(g))*Math.sign(g);g*c<0&&(w-=Math.PI*Math.sign(t)*Math.sign(g));const T=Q(this.center[0])*c;w=Ye(w,-Math.PI-T,Math.PI-T);const A=Fe(ae(w/c)+this.center[0],-180,180),M=Math.asin(Fe((h-(t*t+g*g)*c*c)/(2*c),-1,1)),O=Fe(ae(M),-je,je);return new K(A,O)}}const E_=1.340264,A_=-.081106,I_=893e-6,P_=.003796,ov=Math.sqrt(3)/2;class CN extends cp{project(t,i){i=i/180*Math.PI,t=t/180*Math.PI;const c=Math.asin(ov*Math.sin(i)),h=c*c,p=h*h*h;return{x:.5*(t*Math.cos(c)/(ov*(E_+3*A_*h+p*(7*I_+9*P_*h)))/Math.PI+.5),y:1-.5*(c*(E_+A_*h+p*(I_+P_*h))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let c=i=(2*(1-i)-1)*Math.PI,h=c*c,p=h*h*h;for(let M,O,z,U=0;U<12&&(O=c*(E_+A_*h+p*(I_+P_*h))-i,z=E_+3*A_*h+p*(7*I_+9*P_*h),M=O/z,c=Fe(c-M,-Math.PI/3,Math.PI/3),h=c*c,p=h*h*h,!(Math.abs(M)<1e-12));++U);const g=ov*t*(E_+3*A_*h+p*(7*I_+9*P_*h))/Math.cos(c),w=Math.asin(Math.sin(c)/ov),T=Fe(180*g/Math.PI,-180,180),A=Fe(180*w/Math.PI,-je,je);return new K(T,A)}}class MN extends cp{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){return{x:.5+t/360,y:.5-i/360,z:0}}unproject(t,i){const c=360*(t-.5),h=Fe(360*(.5-i),-je,je);return new K(c,h)}}const hg=Math.PI/2;function av(a){return Math.tan((hg+a)/2)}class ON extends cp{constructor(t){super(t),this.center=t.center||[0,30];const[i,c]=this.parallels=t.parallels||[30,30];let h=Q(i),p=Q(c);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const g=Math.cos(h),w=av(h);this.n=h===p?Math.sin(h):Math.log(g/Math.cos(p))/Math.log(av(p)/w),this.f=g*Math.pow(av(h),this.n)/this.n}project(t,i){i=Q(i),this.southernCenter&&(i=-i),t=Q(t-this.center[0]);const c=1e-6,{n:h,f:p}=this;p>0?i<-hg+c&&(i=-hg+c):i>hg-c&&(i=hg-c);const g=p/Math.pow(av(i),h);let w=g*Math.sin(h*t),T=p-g*Math.cos(h*t);return w=.5*(w/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:w,y:this.southernCenter?T:1-T,z:0}}unproject(t,i){t=(2*t-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:c,f:h}=this,p=h-i,g=Math.sign(p),w=Math.sign(c)*Math.sqrt(t*t+p*p);let T=Math.atan2(t,Math.abs(p))*g;p*c<0&&(T-=Math.PI*Math.sign(t)*g);const A=Fe(ae(T/c)+this.center[0],-180,180),M=Fe(ae(2*Math.atan(Math.pow(h/w,1/c))-hg),-je,je);return new K(A,this.southernCenter?-M:M)}}class VA extends cp{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,i){return{x:Te(t),y:we(i),z:0}}unproject(t,i){const c=Ie(t),h=Oe(i);return new K(c,h)}}const $A=Q(je);class DN extends cp{project(t,i){const c=(i=Q(i))*i,h=c*c;return{x:.5*((t=Q(t))*(.8707-.131979*c+h*(h*(.003971*c-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+c*(.015085+h*(.028874*c-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let c=i=(2*(1-i)-1)*Math.PI,h=25,p=0,g=c*c;do{g=c*c;const A=g*g;p=(c*(1.007226+g*(.015085+A*(.028874*g-.044475-.005916*A)))-i)/(1.007226+g*(.045255+A*(.259866*g-.311325-.005916*11*A))),c=Fe(c-p,-$A,$A)}while(Math.abs(p)>1e-6&&--h>0);g=c*c;const w=Fe(ae(t/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),T=ae(c);return new K(w,T)}}const GA=Q(je);class kN extends cp{project(t,i){i=Q(i),t=Q(t);const c=Math.cos(i),h=2/Math.PI,p=Math.acos(c*Math.cos(t/2)),g=Math.sin(p)/p,w=.5*(t*h+2*c*Math.sin(t/2)/g)||0,T=.5*(i+Math.sin(i)/g)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(t,i){let c=t=(2*t-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,p=25;const g=1e-6;let w=0,T=0;do{const A=Math.cos(h),M=Math.sin(h),O=2*M*A,z=M*M,U=A*A,V=Math.cos(c/2),H=Math.sin(c/2),re=2*V*H,ne=H*H,de=1-U*V*V,ue=de?1/de:0,X=de?Math.acos(A*V)*Math.sqrt(1/de):0,se=.5*(2*X*A*H+2*c/Math.PI)-t,he=.5*(X*M+h)-i,_e=.5*ue*(U*ne+X*A*V*z)+1/Math.PI,Ce=ue*(re*O/4-X*M*H),Re=.125*ue*(O*H-X*M*U*re),Ne=.5*ue*(z*V+X*ne*A)+.5,$e=Ce*Re-Ne*_e;w=(he*Ce-se*Ne)/$e,T=(se*Re-he*_e)/$e,c=Fe(c-w,-Math.PI,Math.PI),h=Fe(h-T,-GA,GA)}while((Math.abs(w)>g||Math.abs(T)>g)&&--p>0);return new K(ae(c),ae(h))}}class qA extends cp{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Q(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){const{scale:c,cosPhi:h}=this;return{x:Q(t)*h*c+.5,y:-Math.sin(Q(i))/h*c+.5,z:0}}unproject(t,i){const{scale:c,cosPhi:h}=this,p=-(i-.5)/c,g=Fe(ae((t-.5)/c)/h,-180,180),w=Math.asin(Fe(p*h,-1,1)),T=Fe(ae(w),-je,je);return new K(g,T)}}class RN extends VA{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,c){const h=Qh(t,i,c);return Nt(h,h,lm(tl(c))),{x:h[0],y:h[1],z:h[2]}}locationPoint(t,i,c){const h=J(i.lat,i.lng),p=Sr([],h),g=c?t._centerAltitude+c:t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude;ot(h,h,p,ye(1,0)*zt*g);const w=oe(new Float64Array(16));return xe(w,t.pixelMatrix,t.globeMatrix),Nt(h,h,w),new Dt(h[0],h[1])}pixelsPerMeter(t,i){return ye(1,0)*i}pixelSpaceConversion(t,i,c){const h=ye(1,t)*i,p=xr(ye(1,45)*i,h,c);return this.pixelsPerMeter(t,i)/p}createTileMatrix(t,i,c){const h=l_(tl(c.canonical));return xe(new Float64Array(16),t.globeMatrix,h)}createInversionMatrix(t,i){const{center:c}=t,h=lm(tl(i));return ze(h,h,Q(c.lng)),et(h,h,Q(c.lat)),ke(h,h,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(t,i,c,h){return s_(t,i,c,!0)||new He(0,0)}pointCoordinate3D(t,i,c){const h=this.pointCoordinate(t,i,c,0);return[h.x,h.y,h.z]}isPointAboveHorizon(t,i){return!s_(t,i.x,i.y,!1)}farthestPixelDistance(t){const i=function(h,p){const g=h.cameraToCenterDistance,w=h._centerAltitude*p,T=h._camera,A=h._camera.forward(),M=Ar([],Ft([],A,-g),[0,0,w]),O=h.worldSize/(2*Math.PI),z=[0,0,-O],U=h.width/h.height,V=Math.tan(h.fovAboveCenter),H=Ft([],T.up(),V),re=Ft([],T.right(),V*U),ne=Sr([],Ar([],Ar([],A,H),re)),de=[];let ue;if(new el(M,ne).closestPointOnSphere(z,O,de)){const X=Ar([],de,z),se=We([],X,M);ue=Math.cos(h.fovAboveCenter)*Dr(se)}else{const X=We([],M,z),se=We([],z,M);Sr(se,se);const he=Dr(X)-O;ue=Math.sqrt(he*(he+2*O));const _e=Math.acos(ue/(O+he))-Math.acos(kr(A,se));ue*=Math.cos(_e)}return 1.01*ue}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),c=ed(t.zoom);if(c>0){const h=jA(t,ye(1,t.center.lat)*t.worldSize),p=t.worldSize/(2*Math.PI),g=Math.max(t.width,t.height)/t.worldSize*Math.PI;return xr(i,h+p*(1-Math.cos(g)),Math.pow(c,10))}return i}upVector(t,i,c){return Qh(i,c,t,1)}upVectorScale(t){return{metersToTile:nu(rp(tl(t)))}}}function WA(a){const t=a.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(a.name){case"mercator":return new VA(a);case"equirectangular":return new MN(a);case"naturalEarth":return new DN(a);case"equalEarth":return new CN(a);case"winkelTripel":return new kN(a);case"albers":return i?new qA(a):new PN(a);case"lambertConformalConic":return i?new qA(a):new ON(a);case"globe":return new RN(a)}throw new Error(`Invalid projection name: ${a.name}`)}const LN=op.VectorTileFeature.types,zN=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sv(a,t,i,c,h,p,g,w,T,A,M,O,z){const U=w?Math.min(lp,Math.round(w[0])):0,V=w?Math.min(lp,Math.round(w[1])):0;a.emplaceBack(t,i,Math.round(32*c),Math.round(32*h),p,g,(U<<1)+(T?1:0),V,16*A,16*M,256*O,256*z)}function lv(a,t,i){a.emplaceBack(t,i)}function cv(a,t,i,c,h,p,g){a.emplaceBack(t,i,c,h,p,g)}function uv(a,t,i,c,h){a.emplaceBack(t,i,c,h),a.emplaceBack(t,i,c,h),a.emplaceBack(t,i,c,h),a.emplaceBack(t,i,c,h)}function FN(a){for(const t of a.sections)if(eg(t.text))return!0;return!1}class h1{constructor(t){this.layoutVertexArray=new Zh,this.indexArray=new to,this.programConfigurations=t,this.segments=new Si,this.dynamicLayoutVertexArray=new Bo,this.opacityVertexArray=new $d,this.placedSymbolArray=new qf,this.iconTransitioningVertexArray=new Ks,this.globeExtVertexArray=new La,this.zOffsetVertexArray=new Wh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,i,c,h,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,JF.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,eN.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,zN,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,rN.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,QF.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,tN.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}qt(h1,"SymbolBuffers");class d1{constructor(t,i,c){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new c,this.segments=new Si,this.collisionVertexArray=new qd,this.collisionVertexArrayExt=new Bo}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,nN.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,iN.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}qt(d1,"CollisionBuffers");class hv{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.lut=t.lut,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=oe([]),this.placementViewportMatrix=oe([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bA(this.zoom,i["text-size"]),this.iconSizeData=bA(this.zoom,i["icon-size"]);const c=this.layers[0].layout,h=c.get("symbol-sort-key"),p=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(g=>rl[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new h1(new gc(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("text")||t.startsWith("symbol"))),this.icon=new h1(new gc(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("icon")||t.startsWith("symbol"))),this.glyphOffsetArray=new Hf,this.lineVertexArray=new tm,this.symbolInstances=new Wf}calculateGlyphDependencies(t,i,c,h,p){for(const g of t){const w=g.codePointAt(0);if(w===void 0)break;if(i[w]=!0,h&&p&&w<=65535){const T=y_[g];T&&(i[T.charCodeAt(0)]=!0)}}}updateFootprints(t,i){}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const c=i.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!Wx(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(t,i,c,h){const p=this.layers[0],g=p.layout,w=this.projection.name==="globe",T=g.get("text-font"),A=g.get("text-field"),M=g.get("icon-image"),[O,z]=g.get("icon-size-scale-range"),U=Fe(i.scaleFactor||1,O,z),V=(A.value.kind!=="constant"||A.value.value instanceof _a&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),H=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,re=g.get("symbol-sort-key");if(this.features=[],!V&&!H)return;const ne=i.iconDependencies,de=i.glyphDependencies,ue=i.availableImages,X=new $n(this.zoom);for(const{feature:se,id:he,index:_e,sourceLayerIndex:Ce}of t){const Re=p._featureFilter.needGeometry,Ne=tr(se,Re);if(!p._featureFilter.filter(X,Ne,c))continue;if(Re||(Ne.geometry=Yt(se,c,h)),w&&se.type!==1&&c.z<=5){const yt=Ne.geometry,At=.98078528056,tt=(_t,Je)=>kr(Qh(_t.x,_t.y,c,1),Qh(Je.x,Je.y,c,1))<At;for(let _t=0;_t<yt.length;_t++)yt[_t]=gt(yt[_t],tt)}let $e,at;if(V){const yt=p.getValueAndResolveTokens("text-field",Ne,c,ue),At=_a.factory(yt);FN(At)&&(this.hasRTLText=!0),(!this.hasRTLText||Hi()==="unavailable"||this.hasRTLText&&Ua.isParsed())&&($e=aN(At,p,Ne))}if(H){const yt=p.getValueAndResolveTokens("icon-image",Ne,c,ue);at=typeof yt=="string"?Ma.build(yt):yt}if(!$e&&!at)continue;const xt=this.sortFeaturesByKey?re.evaluate(Ne,{},c):void 0,mt={id:he,text:$e,icon:at,index:_e,sourceLayerIndex:Ce,geometry:Ne.geometry,properties:se.properties,type:LN[se.type],sortKey:xt};if(this.features.push(mt),at){const yt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:At,iconSecondary:tt}=zA(at,this.iconSizeData,yt["icon-size"],c,this.zoom,mt,this.pixelRatio,U),_t=At.id.toString();if(ne.has(_t)?ne.get(_t).push(At):ne.set(_t,[At]),tt){const Je=tt.id.toString();ne.has(Je)?ne.get(Je).push(tt):ne.set(Je,[tt])}}if($e){const yt=T.evaluate(Ne,{},c).join(","),At=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(rl.vertical)>=0;for(const tt of $e.sections)if(tt.image){const _t=tt.image.getPrimary().scaleSelf(this.pixelRatio),Je=_t.id.toString(),it=ne.get(Je)||[];it.push(_t),ne.set(Je,it)}else{const _t=El($e.toString()),Je=tt.fontStack||yt,it=de[Je]=de[Je]||{};this.calculateGlyphDependencies(tt.text,it,At,this.allowVerticalPlacement,_t)}}}if(g.get("symbol-placement")==="line"&&(this.features=function(se){const he={},_e={},Ce=[];let Re=0;function Ne(mt){Ce.push(se[mt]),Re++}function $e(mt,yt,At){const tt=_e[mt];return delete _e[mt],_e[yt]=tt,Ce[tt].geometry[0].pop(),Ce[tt].geometry[0]=Ce[tt].geometry[0].concat(At[0]),tt}function at(mt,yt,At){const tt=he[yt];return delete he[yt],he[mt]=tt,Ce[tt].geometry[0].shift(),Ce[tt].geometry[0]=At[0].concat(Ce[tt].geometry[0]),tt}function xt(mt,yt,At){const tt=At?yt[0][yt[0].length-1]:yt[0][0];return`${mt}:${tt.x}:${tt.y}`}for(let mt=0;mt<se.length;mt++){const yt=se[mt],At=yt.geometry,tt=yt.text?yt.text.toString():null;if(!tt){Ne(mt);continue}const _t=xt(tt,At),Je=xt(tt,At,!0);if(_t in _e&&Je in he&&_e[_t]!==he[Je]){const it=at(_t,Je,At),Pt=$e(_t,Je,Ce[it].geometry);delete he[_t],delete _e[Je],_e[xt(tt,Ce[Pt].geometry,!0)]=Pt,Ce[it].geometry=null}else _t in _e?$e(_t,Je,At):Je in he?at(_t,Je,At):(Ne(mt),he[_t]=Re-1,_e[Je]=Re-1)}return Ce.filter(mt=>mt.geometry)}(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const se of i.elevationFeatures)this.elevationFeatureIdToIndex.set(se.id,this.elevationFeatures.length),this.elevationFeatures.push(se)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((se,he)=>se.sortKey-he.sortKey)}update(t,i,c,h,p,g,w){this.text.programConfigurations.updatePaintArrays(t,i,p,c,h,g,w),this.icon.programConfigurations.updatePaintArrays(t,i,p,c,h,g,w)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let t=!1;for(let i=0;i<this.symbolInstances.length;i++){const c=this.symbolInstances.get(i);if(c.elevationFeatureIndex===65535)continue;const h=this.elevationFeatures[c.elevationFeatureIndex];if(h){const p=.05+h.pointElevation(new Dt(c.tileAnchorX,c.tileAnchorY));c.zOffset!==p&&(t=!0,c.zOffset=p)}}t&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const t=(p,g,w)=>{c+=g,c>p.length&&p.resize(c);for(let T=-g;T<0;T++)p.emplace(T+c,w)},i=(p,g,w)=>{h+=g,h>p.length&&p.resize(h);for(let T=-g;T<0;T++)p.emplace(T+h,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,h=0;for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:T,numIconVertices:A}=g,M=g.zOffset,O=A>0;if((w>0||T>0)&&(t(this.text.zOffsetVertexArray,w,M),t(this.text.zOffsetVertexArray,T,M)),O){const{placedIconSymbolIndex:z,verticalPlacedIconSymbolIndex:U}=g;z>=0&&i(this.icon.zOffsetVertexArray,A,M),U>=0&&i(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=WA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const c=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:h,y:p}of i)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,i,c,h,p,g,w,T,A,M,O,z,U,V,H,re){const ne=t.indexArray,de=t.layoutVertexArray,ue=t.globeExtVertexArray,X=t.segments.prepareSegment(4*i.length,de,ne,this.canOverlap?g.sortKey:void 0),se=this.glyphOffsetArray.length,he=X.vertexLength,_e=this.allowVerticalPlacement&&w===rl.vertical?Math.PI/2:0,Ce=g.text&&g.text.sections;for(let Ne=0;Ne<i.length;Ne++){const{tl:$e,tr:at,bl:xt,br:mt,texPrimary:yt,texSecondary:At,pixelOffsetTL:tt,pixelOffsetBR:_t,minFontScaleX:Je,minFontScaleY:it,glyphOffset:Pt,isSDF:Mt,sectionIndex:sr}=i[Ne],Qt=X.vertexLength,jt=Pt[1];if(sv(de,A.x,A.y,$e.x,jt+$e.y,yt.x,yt.y,c,Mt,tt.x,tt.y,Je,it),sv(de,A.x,A.y,at.x,jt+at.y,yt.x+yt.w,yt.y,c,Mt,_t.x,tt.y,Je,it),sv(de,A.x,A.y,xt.x,jt+xt.y,yt.x,yt.y+yt.h,c,Mt,tt.x,_t.y,Je,it),sv(de,A.x,A.y,mt.x,jt+mt.y,yt.x+yt.w,yt.y+yt.h,c,Mt,_t.x,_t.y,Je,it),T){const{x:It,y:Lr,z:rr}=T.anchor,[nr,Cr,Gr]=T.up;cv(ue,It,Lr,rr,nr,Cr,Gr),cv(ue,It,Lr,rr,nr,Cr,Gr),cv(ue,It,Lr,rr,nr,Cr,Gr),cv(ue,It,Lr,rr,nr,Cr,Gr),uv(t.dynamicLayoutVertexArray,It,Lr,rr,_e)}else uv(t.dynamicLayoutVertexArray,A.x,A.y,A.z,_e);if(re){const It=At||yt;lv(t.iconTransitioningVertexArray,It.x,It.y),lv(t.iconTransitioningVertexArray,It.x+It.w,It.y),lv(t.iconTransitioningVertexArray,It.x,It.y+It.h),lv(t.iconTransitioningVertexArray,It.x+It.w,It.y+It.h)}ne.emplaceBack(Qt,Qt+1,Qt+2),ne.emplaceBack(Qt+1,Qt+2,Qt+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Pt[0]),Ne!==i.length-1&&sr===i[Ne+1].sectionIndex||t.programConfigurations.populatePaintArrays(de.length,g,g.index,{},U,V,H,Ce&&Ce[sr])}const Re=T?T.anchor:A;t.placedSymbolArray.emplaceBack(Re.x,Re.y,Re.z,A.x,A.y,se,this.glyphOffsetArray.length-se,he,M,O,A.segment,c?c[0]:0,c?c[1]:0,h[0],h[1],w,0,0,0,z,0)}_commitLayoutVertex(t,i,c,h,p,g,w){t.emplaceBack(i,c,h,p,g,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(t,i,c,h,p,g,w){const T=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),A=T.vertexLength,M=w.tileAnchorX,O=w.tileAnchorY;for(let U=0;U<4;U++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,i,t.padding,w.zOffset),this._commitLayoutVertex(c.layoutVertexArray,h,p,g,M,O,new Dt(t.x1,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,p,g,M,O,new Dt(t.x2,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,p,g,M,O,new Dt(t.x2,t.y2)),this._commitLayoutVertex(c.layoutVertexArray,h,p,g,M,O,new Dt(t.x1,t.y2)),T.vertexLength+=4;const z=c.indexArray;z.emplaceBack(A,A+1),z.emplaceBack(A+1,A+2),z.emplaceBack(A+2,A+3),z.emplaceBack(A+3,A),T.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,c,h,p,g){for(let w=h;w<p;w++){const T=c.get(w),A=this.getSymbolInstanceTextSize(t,g,i,w);this._addCollisionDebugVertices(T,A,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(t,i,c,h,p,g){for(let w=h;w<p;w++){const T=c.get(w),A=this.getSymbolInstanceIconSize(t,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(T,A,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,g)}}generateCollisionDebugBuffers(t,i,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new d1(Gd,aA.members,Ks),this.iconCollisionBox=new d1(Gd,aA.members,Ks);const h=x_(this.iconSizeData,t),p=x_(this.textSizeData,t,c);for(let g=0;g<this.symbolInstances.length;g++){const w=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(p,t,i,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(p,t,i,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(h,t,i,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(h,t,i,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(t,i,c,h){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),g=i1(this.textSizeData,t,p)/ia;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,i,c){const h=this.icon.placedSymbolArray.get(c),p=i1(this.iconSizeData,t,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(t,i,c,h){t.emplaceBack(i,-c,-c,h),t.emplaceBack(i,c,-c,h),t.emplaceBack(i,c,c,h),t.emplaceBack(i,-c,c,h)}_updateTextDebugCollisionBoxes(t,i,c,h,p,g,w){for(let T=h;T<p;T++){const A=c.get(T),M=this.getSymbolInstanceTextSize(t,g,i,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,A.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(t,i,c,h,p,g,w){for(let T=h;T<p;T++){const A=c.get(T),M=this.getSymbolInstanceIconSize(t,i,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,A.padding,g.zOffset)}}updateCollisionDebugBuffers(t,i,c,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=x_(this.iconSizeData,t,h),g=x_(this.textSizeData,t,c);for(let w=0;w<this.symbolInstances.length;w++){const T=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(g,t,i,T.textBoxStartIndex,T.textBoxEndIndex,T,c),this._updateTextDebugCollisionBoxes(g,t,i,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,c),this._updateIconDebugCollisionBoxes(p,t,i,T.iconBoxStartIndex,T.iconBoxEndIndex,T,h),this._updateIconDebugCollisionBoxes(p,t,i,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,i,c,h,p,g,w,T,A){const M={};if(i<c){const{x1:O,y1:z,x2:U,y2:V,padding:H,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:X,featureIndex:se}=t.get(i);M.textBox={x1:O,y1:z,x2:U,y2:V,padding:H,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:X},M.textFeatureIndex=se}if(h<p){const{x1:O,y1:z,x2:U,y2:V,padding:H,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:X,featureIndex:se}=t.get(h);M.verticalTextBox={x1:O,y1:z,x2:U,y2:V,padding:H,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:X},M.verticalTextFeatureIndex=se}if(g<w){const{x1:O,y1:z,x2:U,y2:V,padding:H,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:X,featureIndex:se}=t.get(g);M.iconBox={x1:O,y1:z,x2:U,y2:V,padding:H,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:X},M.iconFeatureIndex=se}if(T<A){const{x1:O,y1:z,x2:U,y2:V,padding:H,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:X,featureIndex:se}=t.get(T);M.verticalIconBox={x1:O,y1:z,x2:U,y2:V,padding:H,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:X},M.verticalIconFeatureIndex=se}return M}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const c=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,i){const c=t.placedSymbolArray.get(i),h=c.vertexStartIndex+4*c.numGlyphs;for(let p=c.vertexStartIndex;p<h;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),c=Math.cos(t),h=[],p=[],g=[];for(let w=0;w<this.symbolInstances.length;++w){g.push(w);const T=this.symbolInstances.get(w);h.push(0|Math.round(i*T.tileAnchorX+c*T.tileAnchorY)),p.push(T.featureIndex)}return g.sort((w,T)=>h[w]-h[T]||p[T]-p[w]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,i){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===i?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const c=this.symbolInstances.get(i);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:A}=c;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let HA,ZA,f1;qt(hv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),hv.addDynamicAttributes=uv;class XA{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Kl,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qt(XA,"FormatSectionOverride",{omit:["defaultValue"]});const p1=()=>f1||(f1={layout:HA||(HA=new Ri({"symbol-placement":new Ct(qe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ct(qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ct(qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Xt(qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ct(qe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ct(qe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Ct(qe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Ct(qe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ct(qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ct(qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ct(qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Xt(qe.layout_symbol["icon-size"]),"icon-size-scale-range":new Ct(qe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Xt(qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xt(qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Xt(qe.layout_symbol["icon-image"]),"icon-rotate":new Xt(qe.layout_symbol["icon-rotate"]),"icon-padding":new Ct(qe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ct(qe.layout_symbol["icon-keep-upright"]),"icon-offset":new Xt(qe.layout_symbol["icon-offset"]),"icon-anchor":new Xt(qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ct(qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ct(qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ct(qe.layout_symbol["text-rotation-alignment"]),"text-field":new Xt(qe.layout_symbol["text-field"]),"text-font":new Xt(qe.layout_symbol["text-font"]),"text-size":new Xt(qe.layout_symbol["text-size"]),"text-size-scale-range":new Ct(qe.layout_symbol["text-size-scale-range"]),"text-max-width":new Xt(qe.layout_symbol["text-max-width"]),"text-line-height":new Xt(qe.layout_symbol["text-line-height"]),"text-letter-spacing":new Xt(qe.layout_symbol["text-letter-spacing"]),"text-justify":new Xt(qe.layout_symbol["text-justify"]),"text-radial-offset":new Xt(qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ct(qe.layout_symbol["text-variable-anchor"]),"text-anchor":new Xt(qe.layout_symbol["text-anchor"]),"text-max-angle":new Ct(qe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ct(qe.layout_symbol["text-writing-mode"]),"text-rotate":new Xt(qe.layout_symbol["text-rotate"]),"text-padding":new Ct(qe.layout_symbol["text-padding"]),"text-keep-upright":new Ct(qe.layout_symbol["text-keep-upright"]),"text-transform":new Xt(qe.layout_symbol["text-transform"]),"text-offset":new Xt(qe.layout_symbol["text-offset"]),"text-allow-overlap":new Ct(qe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ct(qe.layout_symbol["text-ignore-placement"]),"text-optional":new Ct(qe.layout_symbol["text-optional"]),visibility:new Ct(qe.layout_symbol.visibility)})),paint:ZA||(ZA=new Ri({"icon-opacity":new Xt(qe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Xt(qe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Xt(qe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Xt(qe.paint_symbol["text-emissive-strength"]),"icon-color":new Xt(qe.paint_symbol["icon-color"]),"icon-halo-color":new Xt(qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Xt(qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Xt(qe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ct(qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ct(qe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ct(qe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Xt(qe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Xt(qe.paint_symbol["text-occlusion-opacity"]),"text-color":new Xt(qe.paint_symbol["text-color"],{runtimeType:sa,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Xt(qe.paint_symbol["text-halo-color"]),"text-halo-width":new Xt(qe.paint_symbol["text-halo-width"]),"text-halo-blur":new Xt(qe.paint_symbol["text-halo-blur"]),"text-translate":new Ct(qe.paint_symbol["text-translate"]),"text-translate-anchor":new Ct(qe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ct(qe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ct(qe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ct(qe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ct(qe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Xt(qe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},f1);class dv extends na{constructor(t,i,c,h){super(t,p1(),i,c,h),this._colorAdjustmentMatrix=oe([]),this.hasInitialOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}recalculate(t,i){super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const h=[];for(const p of c)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,i,c,h){return this._saturation===t&&this._contrast===i&&this._brightnessMin===c&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(p,g,w,T){p=eo(p),g=ko(g);const A=ie(),M=p/3,O=1-2*M,z=[O,M,M,0,M,O,M,0,M,M,O,0,0,0,0,1],U=.5-.5*g,V=T-w;return xe(A,[V,0,0,0,0,V,0,0,0,0,V,0,w,w,w,1],[g,0,0,0,0,g,0,0,0,0,g,0,U,U,U,1]),xe(A,A,z),A}(t,i,c,h),this._saturation=t,this._contrast=i,this._brightnessMin=c,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,i,c,h){const p=this.layout.get(t).evaluate(i,{},c,h),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Nu(g.value)||!p?p:function(w,T){return T.replace(/{([^{}]+)}/g,(A,M)=>M in w?String(w[M]):"")}(i.properties,p)}createBucket(t){return new hv(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of p1().paint.overridableProperties){if(!dv.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),c=new XA(i),h=new Fu(c,i.property.specification,this.scope,this.options);let p=null;p=i.value.kind==="constant"||i.value.kind==="source"?new Gc("source",h):new Zs("composite",h,i.value.zoomStops,i.value.interpolationType),this.paint._values[t]=new fc(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,c){return!(!this.layout||i.isDataDriven()||c.isDataDriven())&&dv.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const c=t.get("text-field"),h=p1().paint.properties[i];let p=!1;const g=w=>{for(const T of w)if(h.overrides&&h.overrides.hasOverride(T))return void(p=!0)};if(c.value.kind==="constant"&&c.value.value instanceof _a)g(c.value.value.sections);else if(c.value.kind==="source"){const w=A=>{p||(A instanceof Yr&&bo(A.value)===gd?g(A.value.sections):A instanceof Iu?g(A.sections):A.eachChild(w))},T=c.value;T._styleExpression&&w(T._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,i,c){return{config:new kl(this,{zoom:i,lut:c}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let YA,KA,JA,QA;var m1=On([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function g1(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function _1(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class y1{constructor(t,i,c,h){this.context=t,this.format=c,this.useMipmap=h&&h.useMipmap,this.texture=t.gl.createTexture(),this.update(i,{premultiply:h&&h.premultiply})}update(t,i){const c=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,h=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:p}=this,{gl:g}=p,{x:w,y:T}=i&&i.position?i.position:{x:0,y:0},A=w+c,M=T+h;!this.size||this.size[0]===A&&this.size[1]===M||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!i||i.premultiply!==!1));const O=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&A>0&&M>0){const z=this.useMipmap?Math.floor(Math.log2(Math.max(A,M)))+1:1;g.texStorage2D(g.TEXTURE_2D,z,this.format,A,M),this.size=[A,M]}if(this.size)if(O)g.texSubImage2D(g.TEXTURE_2D,0,w,T,g1(this.format),_1(this.format),t);else{const z=t.data;z&&g.texSubImage2D(g.TEXTURE_2D,0,w,T,c,h,g1(this.format),_1(this.format),z)}this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(t,i,c=!1){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),t!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!c?t===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),i!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(t,i,c,h){const{context:p}=this,{gl:g}=p;g.bindTexture(g.TEXTURE_2D,this.texture),i!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,i),this.magFilter=i),t!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?t===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),c!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,c),this.wrapS=c),h!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class fv{constructor(t,i){this.context=t,this.texture=i}bind(t,i){const{context:c}=this,{gl:h}=c;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,t),this.minFilter=t),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}}function pv(a,t,i,c,h,p,g,w){const T=[a,t,1,i,c,1,h,p,1],A=[g,w,1],M=q([],T),[O,z,U]=Qr(A,A,M);return Z(T,T,[O,0,0,0,z,0,0,0,U])}function eI(a,t,i,c,h,p,g,w){const T=function(A,M,O,z,U,V,H,re){const ne=pv(0,0,1,0,1,1,0,1),de=pv(A,M,O,z,U,V,H,re);return Z(de,de,q([],ne))}(a,t,i,c,h,p,g,w);return[T[2]/T[8]/zt,T[5]/T[8]/zt]}function mv(a){return[a[0],Math.min(Math.max(a[1],-je),je)]}class tI extends ml{constructor(t,i,c,h){super(),this.id=t,this.dispatcher=c,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=i,this._dirty=!1}load(t,i){if(this._loaded=i||!1,this.fire(new fl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=dh(this.map._requestManager.transformRequest(this.url,Mc.Image),(c,h)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new bf(c)):h&&(this.image=h instanceof HTMLImageElement?Ja.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new fv(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new fl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof fv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=t[0][1],c=t[0][1];for(const p of t)p[1]>c&&(c=p[1]),p[1]<i&&(i=p[1]);const h=(c+i)/2;if(h>je?this.onNorthPole=!0:h<-je&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=t.map(He.fromLngLat);this.tileID=function(g){let w=1/0,T=1/0,A=-1/0,M=-1/0;for(const H of g)w=Math.min(w,H.x),T=Math.min(T,H.y),A=Math.max(A,H.x),M=Math.max(M,H.y);const O=Math.max(A-w,M-T),z=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),U=Math.pow(2,z);let V=Math.floor((w+A)/2*U);return V>1&&(V-=1),new fn(z,V,Math.floor((T+M)/2*U))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new fl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const ne in this.tiles){const de=this.tiles[ne];de.state!=="loaded"&&(de.state="loaded",de.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=T_(new fn(0,0,0),this.map.transform.projection),c=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ne){const de=ne[1].x-ne[0].x,ue=ne[1].y-ne[0].y,X=ne[2].x-ne[1].x,se=ne[2].y-ne[1].y,he=ne[3].x-ne[2].x,_e=ne[3].y-ne[2].y,Ce=ne[0].x-ne[3].x,Re=ne[0].y-ne[3].y,Ne=de*se-X*ue,$e=X*_e-he*se,at=he*Re-Ce*_e,xt=Ce*ue-de*Re;return Ne>0&&$e>0&&at>0&&xt>0||Ne<0&&$e<0&&at<0&&xt<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=T_(this.tileID,this.map.transform.projection),[p,g,w,T]=this.coordinates.map(ne=>{const de=h.projection.project(ne[0],ne[1]);return UA(h,de)._round()});this.perspectiveTransform=eI(p.x,p.y,g.x,g.y,w.x,w.y,T.x,T.y);const A=this._boundsArray=new Kc;A.emplaceBack(p.x,p.y,0,0),A.emplaceBack(g.x,g.y,zt,0),A.emplaceBack(T.x,T.y,0,zt),A.emplaceBack(w.x,w.y,zt,zt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(A,m1.members),this.boundsSegments=Si.simpleSegment(0,0,4,2);const M=[],O=[mv((z=this.coordinates)[0]),mv(z[1]),mv(z[2]),mv(z[3])];var z;const[U,V,H,re]=function(ne){let de=ne[0][0],ue=de,X=ne[0][1],se=X;for(let he=1;he<ne.length;he++)ne[he][0]<de?de=ne[he][0]:ne[he][0]>ue&&(ue=ne[he][0]),ne[he][1]<X?X=ne[he][1]:ne[he][1]>se&&(se=ne[he][1]);return[de,X,ue-de,se-X]}(O);{const ne=new Kc,[de,ue,X,se]=function(tt){let _t=tt[0].x,Je=_t,it=tt[0].y,Pt=it;for(let Mt=1;Mt<tt.length;Mt++)tt[Mt].x<_t?_t=tt[Mt].x:tt[Mt].x>Je&&(Je=tt[Mt].x),tt[Mt].y<it?it=tt[Mt].y:tt[Mt].y>Pt&&(Pt=tt[Mt].y);return[_t,it,Je-_t,Pt-it]}(c),he=tt=>[(tt.x-de)/X,(tt.y-ue)/se],[_e,Ce,Re,Ne]=c.map(he),$e=function(tt,_t,Je,it,Pt,Mt,sr,Qt){const jt=pv(0,0,1,0,1,1,0,1);return Z(jt,jt,q([],pv(tt,_t,Je,it,Pt,Mt,sr,Qt)))}(_e[0],_e[1],Ce[0],Ce[1],Re[0],Re[1],Ne[0],Ne[1]);this.elevatedGlobePerspectiveTransform=eI(_e[0],_e[1],Ce[0],Ce[1],Re[0],Re[1],Ne[0],Ne[1]);const at=(tt,_t)=>{M.push(tt.lng);const Je=Math.round((tt.lng-U)/H*zt),it=Math.round((tt.lat-V)/re*zt),Pt=he(_t),Mt=Qr([],[Pt[0],Pt[1],1],$e),sr=Math.round(Mt[0]/Mt[2]*zt),Qt=Math.round(Mt[1]/Mt[2]*zt);ne.emplaceBack(Je,it,sr,Qt)},xt=c[3].x-c[0].x,mt=c[3].y-c[0].y,yt=c[2].x-c[1].x,At=c[2].y-c[1].y;for(let tt=0;tt<65;tt++){const _t=tt/64,Je=[c[0].x+_t*xt,c[0].y+_t*mt],it=[c[1].x+_t*yt,c[1].y+_t*At],Pt=it[0]-Je[0],Mt=it[1]-Je[1];for(let sr=0;sr<65;sr++){const Qt=sr/64,jt={x:Je[0]+Pt*Qt,y:Je[1]+Mt*Qt};at(i.projection.unproject(jt.x,jt.y),jt)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(ne,m1.members)}{this.maxLongitudeTriangleSize=0;let ne=[],de=new to;const ue=(X,se,he)=>{de.emplaceBack(X,se,he);const _e=M[X],Ce=M[se],Re=M[he],Ne=Math.min(Math.min(_e,Ce),Re),$e=Math.max(Math.max(_e,Ce),Re)-Ne;$e>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=$e),ne.push(Ne+$e/2)};for(let X=0;X<64;X++)for(let se=0;se<64;se++){const he=65*X+se,_e=he+1,Ce=he+65,Re=Ce+1;ue(he,Ce,_e),ue(_e,Ce,Re)}[ne,de]=function(X,se){const he=Array.from({length:X.length},(Re,Ne)=>Ne);he.sort((Re,Ne)=>X[Re]-X[Ne]);const _e=[],Ce=new to;for(let Re=0;Re<he.length;Re++){const Ne=he[Re];_e.push(X[Ne]);const $e=3*Ne,at=$e+1;Ce.emplaceBack(se.uint16[$e],se.uint16[at],se.uint16[at+1])}return[_e,Ce]}(ne,de),this.elevatedGlobeTrianglesCenterLongitudes=ne,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(de)}this.elevatedGlobeSegments=Si.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,H/zt,0,re/zt,0,0,V,U,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const i=this.map.painter.context,c=i.gl;!this._dirty||this.texture instanceof fv||(this.texture?this.texture.update(this.image):(this.texture=new y1(i,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(i)}loadTile(t,i){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},i(null)):(t.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let h=(p=t+180)+360*Math.round((c[0]-p)/360);var p;const g=new Si,w=(O,z)=>{g.segments.push({vertexOffset:0,primitiveOffset:O,vertexLength:i.segments[0].vertexLength,primitiveLength:z,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-h)<=T){const O=sl(c,0,c.length,h+T);return O===c.length||w(O,Ho(c,O+1,c.length,h+360-T)-O),g}h<c[0]&&(h+=360);const A=Ho(c,0,c.length,h-T);if(A===c.length)return w(0,c.length),g;w(0,A-0);const M=sl(c,A+1,c.length,h+T);return M!==c.length&&w(M,c.length-M),g}}const NN=(Math.pow(256,2)-1)/16907520;class rI extends na{constructor(t,i,c,h){super(t,{layout:JA||(JA=new Ri({visibility:new Ct(qe.layout_raster.visibility)})),paint:QA||(QA=new Ri({"raster-opacity":new Ct(qe.paint_raster["raster-opacity"]),"raster-color":new So(qe.paint_raster["raster-color"]),"raster-color-mix":new Ct(qe.paint_raster["raster-color-mix"]),"raster-color-range":new Ct(qe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ct(qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ct(qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ct(qe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ct(qe.paint_raster["raster-saturation"]),"raster-contrast":new Ct(qe.paint_raster["raster-contrast"]),"raster-resampling":new Ct(qe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ct(qe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ct(qe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ct(qe.paint_raster["raster-array-band"]),"raster-elevation":new Ct(qe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},i,c,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof tI&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[c,h]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(h)||c===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=En({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,h])}}let nI,iI,oI,aI,sI;class lI extends na{constructor(t,i,c,h){super(t,{layout:nI||(nI=new Ri({visibility:new Ct(qe["layout_raster-particle"].visibility)})),paint:iI||(iI=new Ri({"raster-particle-array-band":new Ct(qe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ct(qe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new So(qe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ct(qe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ct(qe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ct(qe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ct(qe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ct(qe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},i,c,h),this._updateColorRamp(),this.lastInvalidatedAt=Ja.now()}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=En({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ja.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class BN extends na{constructor(t,i){super(t,{},i,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(t){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function v1(a,t,i){const c=[0,0,1],h=ii([]);return $i(h,h,i?-Q(a)+Math.PI:Q(a)),ti(h,h,-Q(t)),Tn(c,c,h),Sr(c,c)}function cI(a,t){const i=gv(a.projection,a.zoom,a.width,a.height),c=function(p,g,w,T,A){const M=new K(w.lng-180*up,w.lat),O=new K(w.lng+180*up,w.lat),z=p.project(M.lng,M.lat),U=p.project(O.lng,O.lat),V=-Math.atan2(U.y-z.y,U.x-z.x),H=He.fromLngLat(w);H.y=Fe(H.y,-1+up,1-up);const re=H.toLngLat(),ne=p.project(re.lng,re.lat),de=He.fromLngLat(re);de.x+=up;const ue=de.toLngLat(),X=p.project(ue.lng,ue.lat),se=hI(X.x-ne.x,X.y-ne.y,V),he=He.fromLngLat(re);he.y+=up;const _e=he.toLngLat(),Ce=p.project(_e.lng,_e.lat),Re=hI(Ce.x-ne.x,Ce.y-ne.y,V),Ne=Math.abs(se.x)/Math.abs(Re.y),$e=oe([]);nt($e,$e,-V*(1-(A?0:T)));const at=oe([]);return ke(at,at,[1,1-(1-Ne)*T,1]),at[4]=-Re.x/Re.y*T,nt(at,at,V),xe(at,$e,at),at}(a.projection,0,a.center,i,t),h=uI(a);return ke(c,c,[h,h,1]),c}function uI(a){const t=a.projection,i=gv(a.projection,a.zoom,a.width,a.height),c=x1(t,a.center),h=x1(t,K.convert(t.center));return Math.pow(2,c*i+(1-i)*h)}function gv(a,t,i,c,h=1/0){const p=a.range;if(!p)return 0;const g=Math.min(h,Math.max(i,c)),w=Math.log(g/1024)/Math.LN2;return Be(p[0]+w,p[1]+w,t)}const up=1/4e4;function x1(a,t){const i=Fe(t.lat,-je,je),c=new K(t.lng-180*up,i),h=new K(t.lng+180*up,i),p=a.project(c.lng,i),g=a.project(h.lng,i),w=He.fromLngLat(c),T=He.fromLngLat(h),A=g.x-p.x,M=g.y-p.y,O=T.x-w.x,z=T.y-w.y,U=Math.sqrt((O*O+z*z)/(A*A+M*M));return Math.log(U)/Math.LN2}function hI(a,t,i){const c=Math.cos(i),h=Math.sin(i);return{x:a*c-t*h,y:a*h+t*c}}function dI(a,t,i){oe(a),nt(a,a,Q(t[2])),et(a,a,Q(t[0])),ze(a,a,Q(t[1])),ke(a,a,i),xe(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function _v(a,t,i,c,h,p,g,w){const T=[i[0]-t[0],i[1]-t[1],0],A=[c[0]-t[0],c[1]-t[1],0];if(Dr(T)<1e-12||Dr(A)<1e-12)return ii(a);const M=Vr([],T,A);Sr(M,M),zr(A,c,t),T[2]=(p-h)*w,A[2]=(g-h)*w;const O=T;return Vr(O,T,A),Sr(O,O),ta(a,M,O)}function b1(a,t,i=!1){const c=ed(t.zoom),h=function(p,g,w){const T=g.worldSize,A=[p[12],p[13],p[14]],M=Oe(A[1]/T),O=Ie(A[0]/T),z=oe([]),U=ye(1,M)*T,V=ye(1,0)*T*ct(M,g.zoom),H=1/np(T);let re=V*H;if(w){const X=gv(g.projection,g.zoom,g.width,g.height,1024);re=H*g.projection.pixelSpaceConversion(g.center.lat,T,X)}const ne=J(M,O);Ar(ne,ne,Ft([],Sr([],ne),U*re*A[2]));const de=function(X){const se=[X[0],X[1],X[2]];let he=[0,1,0];const _e=Vr([],he,se);return Vr(he,se,_e),Ur(he)===0&&(he=[0,1,0],Vr(_e,se,he)),Sr(_e,_e),Sr(he,he),Sr(se,se),[_e[0],_e[1],_e[2],0,he[0],he[1],he[2],0,se[0],se[1],se[2],0,X[0],X[1],X[2],1]}(ne);ke(z,z,[re,re,re*U]),ge(z,z,[-A[0],-A[1],-A[2]]);const ue=xe([],g.globeMatrix,de);return xe(ue,ue,z),xe(ue,ue,p),ue}(a,t,i);if(c>0){const p=function(g,w){const T=w.worldSize,A=ye(1,0)*T*ct(w.center.lat,w.zoom)/np(T),M=ye(1,w.center.lat)*T,O=oe([]);return ze(O,O,Q(w.center.lng)),et(O,O,Q(w.center.lat)),ge(O,O,[0,0,x]),ke(O,O,[A,A,A*M]),ge(O,O,[w.point.x-.5*T,w.point.y-.5*T,0]),xe(O,O,g),xe(O,w.globeMatrix,O)}(a,t);return function(g,w,T){const A=(V,H,re)=>{const ne=Dr(V),de=Dr(H),ue=iu(V,H,re);return Ft(ue,ue,1/Dr(ue)*xr(ne,de,re))},M=A([g[0],g[1],g[2]],[w[0],w[1],w[2]],T),O=A([g[4],g[5],g[6]],[w[4],w[5],w[6]],T),z=A([g[8],g[9],g[10]],[w[8],w[9],w[10]],T),U=iu([g[12],g[13],g[14]],[w[12],w[13],w[14]],T);return[M[0],M[1],M[2],0,O[0],O[1],O[2],0,z[0],z[1],z[2],0,U[0],U[1],U[2],1]}(h,p,c)}return h}function fI(a,t,i,c){const h=yi.projectAabbCorners(c,i);let p=Number.MAX_VALUE,g=-1;for(let A=0;A<h.length;++A){const M=h[A];M[0]=(.5*M[0]+.5)*t.width,M[1]=(.5-.5*M[1])*t.height,M[2]<p&&(g=A,p=M[2])}const w=A=>new Dt(h[A][0],h[A][1]);let T;switch(g){case 0:case 6:T=[w(1),w(5),w(4),w(7),w(3),w(2),w(1)];break;case 1:case 7:T=[w(0),w(4),w(5),w(6),w(2),w(3),w(0)];break;case 3:case 5:T=[w(1),w(0),w(4),w(7),w(6),w(2),w(1)];break;default:T=[w(1),w(5),w(6),w(7),w(3),w(0),w(1)]}if(hr(a,T))return p}const jN=On([{name:"a_pos_3f",components:3,type:"Float32"}]),UN=On([{name:"a_color_3f",components:3,type:"Float32"}]),VN=On([{name:"a_color_4f",components:4,type:"Float32"}]),$N=On([{name:"a_uv_2f",components:2,type:"Float32"}]),GN=On([{name:"a_normal_3f",components:3,type:"Float32"}]),qN=On([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),WN=On([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),pI={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class yv{constructor(t,i,c,h){this.message=(t?`${t}: `:"")+c,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function w1(a,t){const i=a.indexOf("://")===-1;try{return new URL(a,i&&t?"http://example.com":void 0),!0}catch{return!1}}class mI{constructor(t,i){this.feature=t,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class gI{constructor(){this.instancedDataArray=new Xo,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class S1{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=t.styleDefinedModelURLs}updateFootprints(t,i){}populate(t,i,c,h){this.tileToMeter=Ve(c);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:w,index:T,sourceLayerIndex:A}of t){const M=w??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),O=tr(g,p);if(!this.layers[0]._featureFilter.filter(new $n(this.zoom),O,c))continue;const z={id:M,sourceLayerIndex:A,index:T,geometry:p?O.geometry:Yt(g,c,h),properties:g.properties,type:g.type,patterns:{}},U=this.addFeature(z,z.geometry,O);U&&i.featureIndex.insert(g,z.geometry,T,A,this.index,this.instancesPerModel[U].instancedDataArray.length,zt/32)}this.lookup=null}update(t,i,c,h){for(const p in this.instancesPerModel){const g=this.instancesPerModel[p];for(const w in t)g.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(g.features[g.idToFeaturesIndex[w]],t[w],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const i in this.instancesPerModel){const c=this.instancesPerModel[i];for(const h of c.features){const p=this.layers[0],g=h.feature,w=this.canonical,T=p.paint.get("model-rotation").evaluate(g,{},w),A=p.paint.get("model-scale").evaluate(g,{},w),M=p.paint.get("model-translation").evaluate(g,{},w);Kt(h.rotation,T)&&Kt(h.scale,A)&&Kt(h.translation,M)||(this.evaluate(h,h.featureStates,c,!0),t=!0)}}return t}updateReplacement(t,i,c,h){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const p=i.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(Wx(this.activeReplacements,p))return!1;this.activeReplacements=p;let g=!1;for(const w in this.instancesPerModel){const T=this.instancesPerModel[w],A=T.instancedDataArray;for(const M of T.features){const O=M.instancedDataOffset,z=M.instancedDataCount;for(let U=0;U<z;U++){const V=16*(U+O);let H=A.float32[V+0];const re=H>zt;H=re?H-zt:H;const ne=Math.floor(H),de=A.float32[V+1];let ue=!1;for(const X of this.activeReplacements)if(!x2(X,c,pI.Model,h)&&!(X.min.x>ne||ne>X.max.x||X.min.y>de||de>X.max.y)&&(ue=A2(E2(ne,de,t.canonical,X.footprintTileId.canonical),X.footprint),ue))break;A.float32[V]=ue?H+zt:H,g=g||ue!==re}}}return g}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const i in this.instancesPerModel){const c=this.instancesPerModel[i];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=t.createVertexBuffer(c.instancedDataArray,qN.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const c=this.instancesPerModel[i];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(t&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)t.removeModel(i,"",!0)}addFeature(t,i,c){const h=this.layers[0],p=h.layout.get("model-id").evaluate(c,{},this.canonical);if(!p)return tn(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),p;(w1(p,!1)||this.styleDefinedModelURLs[p]!==void 0)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new gI);const g=this.instancesPerModel[p],w=g.instancedDataArray,T=new mI(c,w.length);for(const A of i)for(const M of A){if(M.x<0||M.x>=zt||M.y<0||M.y>=zt)continue;const O=(this.lookupDim-1)/zt,z=this.lookupDim*(M.y*O|0)+M.x*O|0;if(this.lookup){if(this.lookup[z]!==0)continue;this.lookup[z]=1}this.instanceCount++;const U=w.length;w.resize(U+1),g.instancesEvaluatedElevation.push(0),w.float32[16*U]=M.x,w.float32[16*U+1]=M.y}return T.instancedDataCount=g.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(t.id&&(g.idToFeaturesIndex[t.id]=g.features.length),g.features.push(T),this.evaluate(T,{},g,!1)),p}getModelUris(){return this.modelUris}evaluate(t,i,c,h){const p=this.layers[0],g=t.feature,w=this.canonical,T=t.rotation=p.paint.get("model-rotation").evaluate(g,i,w),A=t.scale=p.paint.get("model-scale").evaluate(g,i,w),M=t.translation=p.paint.get("model-translation").evaluate(g,i,w),O=p.paint.get("model-color").evaluate(g,i,w);O.a=p.paint.get("model-color-mix-intensity").evaluate(g,i,w);const z=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),dI(z,T,A);const U=Math.round(100*O.a)+O.b/1.05;for(let V=0;V<t.instancedDataCount;++V){const H=t.instancedDataOffset+V,re=16*H,ne=c.instancedDataArray.float32;let de=0;h&&(de=ne[re+6]-c.instancesEvaluatedElevation[H]);const ue=0|ne[re+1];ne[re]=(0|ne[re])+O.r/1.05,ne[re+1]=ue+O.g/1.05,ne[re+2]=U,ne[re+3]=1/(w.z>10?this.tileToMeter:Ve(w,ue)),ne[re+4]=M[0],ne[re+5]=M[1],ne[re+6]=M[2]+de,ne[re+7]=z[0],ne[re+8]=z[1],ne[re+9]=z[2],ne[re+10]=z[4],ne[re+11]=z[5],ne[re+12]=z[6],ne[re+13]=z[8],ne[re+14]=z[9],ne[re+15]=z[10],c.instancesEvaluatedElevation[H]=M[2]}}}let _I,yI;qt(S1,"ModelBucket",{omit:["layers"]}),qt(gI,"PerModelAttributes"),qt(mI,"ModelFeature");const gm=64,dg={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function vI(a,t,i,c,h,p,g,w,T,A=!1){const M=i.zoom,O=i.project(c),z=ct(c.lat,M),U=1/z;oe(a),ge(a,a,[O.x+g[0]*U,O.y+g[1]*U,g[2]]);let V=1,H=1;const re=i.worldSize;if(A){if(i.projection.name==="mercator"){let X=0;i.elevation&&(X=i.elevation.getAtPointOrZero(new He(O.x/re,O.y/re),0));const se=Oi([],[O.x,O.y,X,1],i.projMatrix)[3]/i.cameraToCenterDistance;V=se,H=se*ct(i.center.lat,M)}else if(i.projection.name==="globe"){const X=b1(a,i),se=[0,0,0,1];Oi(se,se,xe([],i.projMatrix,X));const he=se[3]/i.cameraToCenterDistance,_e=ed(M),Ce=i.projection.pixelsPerMeter(c.lat,re)*ct(c.lat,M),Re=i.projection.pixelsPerMeter(i.center.lat,re)*ct(i.center.lat,M);V=he/xr(Ce,st(i.center.lat),_e),H=he*z/Ce,V*=Re,H*=Re}}else V=U;ke(a,a,[V,V,H]);const ne=[...a],de=t.orientation,ue=[];if(dI(ue,[de[0]+h[0],de[1]+h[1],de[2]+h[2]],p),xe(a,ne,ue),w&&i.elevation){let X=0;const se=[];if(T&&i.elevation){X=function(_e,Ce,Re,Ne,$e){const at=Ce.elevation;if(!at)return 0;const xt=yi.projectAabbCorners(Re,Ne),mt=ye(1,$e.lat)*Ce.worldSize,yt=function(It,Lr){const rr=[0,0,1],nr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Cr of nr){const Gr=It[Cr.corners[0]],Xr=It[Cr.corners[1]],cn=It[Cr.corners[2]],on=[Xr[0]-Gr[0],Xr[1]-Gr[1],Lr*(Xr[2]-Gr[2])],Kr=Vr(on,on,[cn[0]-Gr[0],cn[1]-Gr[1],Lr*(cn[2]-Gr[2])]);Sr(Kr,Kr),Cr.dotProductWithUp=kr(Kr,rr)}return nr.sort((Cr,Gr)=>Cr.dotProductWithUp-Gr.dotProductWithUp),nr[0].corners}(xt,mt),At=xt[yt[0]],tt=xt[yt[1]],_t=xt[yt[2]],Je=xt[yt[3]],it=at.getAtPointOrZero(new He(At[0]/Ce.worldSize,At[1]/Ce.worldSize),0),Pt=at.getAtPointOrZero(new He(tt[0]/Ce.worldSize,tt[1]/Ce.worldSize),0),Mt=at.getAtPointOrZero(new He(_t[0]/Ce.worldSize,_t[1]/Ce.worldSize),0),sr=at.getAtPointOrZero(new He(Je[0]/Ce.worldSize,Je[1]/Ce.worldSize),0),Qt=(it+sr)/2,jt=(Pt+Mt)/2;return Qt>jt?Pt<Mt?_v(_e,tt,Je,At,Pt,sr,it,mt):_v(_e,_t,At,Je,Mt,it,sr,mt):it<sr?_v(_e,At,tt,_t,it,Pt,Mt,mt):_v(_e,Je,_t,tt,sr,Mt,Pt,mt),Math.max(Qt,jt)}(se,i,t.aabb,a,c);const he=xe([],ir([],se),ue);xe(a,ne,he)}else X=i.elevation.getAtPointOrZero(new He(O.x/re,O.y/re),0);X!==0&&(a[14]+=X)}}function C_(a,t,i=!1){a.uploaded||(a.gfxTexture=new y1(t,a.image,i?t.gl.R8:t.gl.RGBA8,{useMipmap:a.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function HN(a,t,i){a.indexBuffer=t.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=t.createVertexBuffer(a.vertexArray,jN.members,!1,!0),a.normalArray&&(a.normalBuffer=t.createVertexBuffer(a.normalArray,GN.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=t.createVertexBuffer(a.texcoordArray,$N.members,!1,!0)),a.colorArray&&(a.colorBuffer=t.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?UN:VN).members,!1,!0)),a.featureArray&&(a.pbrBuffer=t.createVertexBuffer(a.featureArray,WN.members,!0)),a.segments=Si.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const c=a.material;c.pbrMetallicRoughness.baseColorTexture&&C_(c.pbrMetallicRoughness.baseColorTexture,t),c.pbrMetallicRoughness.metallicRoughnessTexture&&C_(c.pbrMetallicRoughness.metallicRoughnessTexture,t),c.normalTexture&&C_(c.normalTexture,t),c.occlusionTexture&&C_(c.occlusionTexture,t,i),c.emissionTexture&&C_(c.emissionTexture,t)}function T1(a,t,i){if(a.meshes)for(const c of a.meshes)HN(c,t,i);if(a.children)for(const c of a.children)T1(c,t,i)}function vv(a){if(a.meshes)for(const t of a.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(a.children)for(const t of a.children)vv(t)}function E1(a){if(a.meshes)for(const i of a.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((t=i.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(a.children)for(const i of a.children)E1(i)}class fg{constructor(t,i,c){this._demTile=t,this._dem=this._demTile.dem,this._scale=i,this._offset=c}static create(t,i,c){const h=c||t.findDEMTileFor(i);if(!h||!h.dem)return;const p=h.dem,g=h.tileID,w=1<<i.canonical.z-g.canonical.z;return new fg(h,p.dim/zt/w,[(i.canonical.x/w-g.canonical.x)*p.dim,(i.canonical.y/w-g.canonical.y)*p.dim])}tileCoordToPixel(t,i){const c=i*this._scale+this._offset[1],h=Math.floor(t*this._scale+this._offset[0]),p=Math.floor(c);return new Dt(h,p)}getElevationAt(t,i,c,h){const p=t*this._scale+this._offset[0],g=i*this._scale+this._offset[1],w=Math.floor(p),T=Math.floor(g),A=this._dem;return h=!!h,c?xr(xr(A.get(w,T,h),A.get(w,T+1,h),g-T),xr(A.get(w+1,T,h),A.get(w+1,T+1,h),g-T),p-w):A.get(w,T,h)}getElevationAtPixel(t,i,c){return this._dem.get(t,i,!!c)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*ye(1,t)*this._dem.stride}}const A1=new Float32Array(262144),_m=new Uint8Array(262144);function xI(a){let t=0;if(a.meshes)for(const i of a.meshes)t=Math.max(t,i.aabb.max[2]);if(a.children)for(const i of a.children)t=Math.max(t,xI(i));return t}function bI(a,t,i){if(a.meshes)for(const c of a.meshes){if(c.aabb.min[0]===1/0)continue;const h=yi.applyTransform(c.aabb,a.matrix);i.insert(t,h.min[0],h.min[1],h.max[0],h.max[1])}if(a.children)for(const c of a.children)bI(c,t,i)}const wI=["","wall","door","roof","window","lamp","logo"];class SI{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:xI(t)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const i=new yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==t&&(c.transformedAabb=yi.applyTransformFast(c.aabb,this.node.matrix),i.encapsulate(c.transformedAabb)),t++;this.aabb=i}return this.aabb}}class xv{constructor(t,i,c,h,p,g,w){this.id=c,this.layers=t,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=dg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=dg.HasMapboxMeshFeatures),p&&(this.modelTraits|=dg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const T of i)this.nodesInfo.push(new SI(T)),bI(T,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(t,i){for(const c of this.getNodesInfo()){const h=c.node;h.footprint&&i.push({footprint:h.footprint,id:t})}}update(t){const i=Object.keys(t).length!==0;if(i&&!this.stateDependentLayers.length)return;const c=i?this.stateDependentLayers:this.layers;if(!mi(t,this.states))for(const h of c)this.evaluate(h,t);this.states=structuredClone(t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const c of i){const h=c.node;this.uploaded?this.updatePbrBuffer(h):T1(h,t,!0)}for(const c of i)vv(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let i=!1;if(!t.meshes)return i;for(const c of t.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),i=!0);return i}needsReEvaluation(t,i,c){const h=t.transform.projectionOptions,p=t.style.getBrightness(),g=this.brightness!==p;if(!this.uploaded||this.dirty||h.name!==this.projection.name||M_(c.paint.get("model-color").value,g)||M_(c.paint.get("model-color-mix-intensity").value,g)||M_(c.paint.get("model-roughness").value,g)||M_(c.paint.get("model-emissive-strength").value,g)||M_(c.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=h,this.brightness=p;const w=this.getNodesInfo();for(const T of w)T.state=null;return!0}return!1}evaluateScale(t,i){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const c=this.getNodesInfo(),h=this.id.canonical;for(const p of c){const g=p.feature;p.evaluatedScale=i.paint.get("model-scale").evaluate(g,{},h)}}evaluate(t,i){const c=this.getNodesInfo();for(const h of c){if(!h.node.meshes)continue;const p=h.feature,g=i&&i[p.id];if(mi(g,h.state))continue;h.state=structuredClone(g);const w=h.node.meshes&&h.node.meshes[0].featureData,T=h.evaluatedColor[2],A=h.evaluatedRMEA[2],M=this.id.canonical;if(h.hasTranslucentParts=!1,w){for(let O=0;O<wI.length;O++){const z=wI[O];z.length&&(p.properties.part=z);const U=t.paint.get("model-color").evaluate(p,g,M).toRenderColor(null),V=t.paint.get("model-color-mix-intensity").evaluate(p,g,M);h.evaluatedColor[O]=[U.r,U.g,U.b,V],h.evaluatedRMEA[O][0]=t.paint.get("model-roughness").evaluate(p,g,M),h.evaluatedRMEA[O][2]=t.paint.get("model-emissive-strength").evaluate(p,g,M),h.evaluatedRMEA[O][3]=U.a,h.emissionHeightBasedParams[O]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,g,M),!h.hasTranslucentParts&&U.a<1&&(h.hasTranslucentParts=!0)}delete p.properties.part,XN(h,T!==h.evaluatedColor[2]||A!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(p,g,M);h.evaluatedScale=t.paint.get("model-scale").evaluate(p,g,M),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,i,c,h){const p=t.findDEMTileFor(c);if(p&&(p.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const g=fg.create(t,c,p);if(!g)return;this.modelTraits&dg.HasMapboxMeshFeatures&&this.updateDEM(t,g,c,h);for(const w of this.getNodesInfo()){const T=w.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const A=T.footprint.vertices;let M=g.getElevationAt(A[0].x,A[0].y,!0,!0);for(let O=1;O<A.length;O++)M=Math.min(M,g.getElevationAt(A[O].x,A[O].y,!0,!0));T.elevation=M}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=i}}updateDEM(t,i,c,h){let p=i._dem._modifiedForSources[h];if(p===void 0&&(i._dem._modifiedForSources[h]=[],p=i._dem._modifiedForSources[h]),p.includes(c.canonical))return;const g=i._dem.dim;p.push(c.canonical);let w=!1;for(const T of this.getNodesInfo()){const A=T.node;if(!A.footprint||!A.footprint.grid)continue;const M=A.footprint.grid,O=i.tileCoordToPixel(M.min.x,M.min.y),z=i.tileCoordToPixel(M.max.x,M.max.y),U=Math.min(Math.min(g-z.y,O.x),Math.min(O.y,g-z.x));if(U<0)continue;const V=Fe(U,2,5);let H=Math.max(0,O.x-V),re=Math.max(0,O.y-V),ne=Math.min(z.x+V,g-1),de=Math.min(z.y+V,g-1);for(let he=re;he<=de;++he)for(let _e=H;_e<=ne;++_e)_m[he*g+_e]=255;let ue=0,X=0;for(let he=0;he<M.cellsY;++he)for(let _e=0;_e<M.cellsX;++_e){if(!M.cells[he*M.cellsX+_e])continue;const Ce=i.tileCoordToPixel(M.min.x+_e/M.xScale,M.min.y+he/M.yScale),Re=i.tileCoordToPixel(M.min.x+(_e+1)/M.xScale,M.min.y+(he+1)/M.yScale);for(let Ne=Ce.y;Ne<=Math.min(Re.y+1,g-1);++Ne)for(let $e=Ce.x;$e<=Math.min(Re.x+1,g-1);++$e)_m[Ne*g+$e]===255&&(_m[Ne*g+$e]=0,ue+=i.getElevationAtPixel($e,Ne),X++)}const se=ue/X;H=Math.max(1,O.x-V),re=Math.max(1,O.y-V),ne=Math.min(z.x+V,g-2),de=Math.min(z.y+V,g-2),w=!0;for(let he=re;he<=de;++he)for(let _e=H;_e<=ne;++_e)_m[he*g+_e]===0&&(A1[he*g+_e]=i._dem.set(_e,he,se));for(let he=1;he<V;++he){H=Math.max(1,O.x-he),re=Math.max(1,O.y-he),ne=Math.min(z.x+he,g-2),de=Math.min(z.y+he,g-2);for(let _e=re;_e<=de;++_e)for(let Ce=H;Ce<=ne;++Ce){const Re=_e*g+Ce;if(_m[Re]===255){let Ne=0,$e=0,at=-1,xt=-1;for(let mt=-1;mt<=1;++mt)for(let yt=-1;yt<=1;++yt){const At=(_e+mt)*g+Ce+yt;if(_m[At]>=he)continue;const tt=A1[At],_t=Math.abs(tt);_t>$e&&(Ne=tt,$e=_t,at=yt,xt=mt)}if($e>.1){const mt=1-(he+.5*Math.abs(at*xt))/V;let yt=i._dem.get(Ce,_e)+Ne*mt;const At=i._dem.get(Ce+at,_e+xt),tt=i._dem.get(Ce-at,_e-xt,!0);(yt-At)*(yt-tt)>0&&(yt=(At+tt)/2),A1[Re]=i._dem.set(Ce,_e,yt),_m[Re]=he}}}}}w&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Ja.now())}setFilter(t){this.filter=t?qu(t):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(t=>this.filter.filter(new $n(this.id.overscaledZ),t.feature,this.id.canonical)):this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const i of t)vv(i.node),E1(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const c=i.getReplacementRegionsForTile(t.toUnwrapped()),h=this.getNodesInfo();for(let p=0;p<this.nodesInfo.length;p++){const g=h[p].node;h[p].hiddenByReplacement=!!g.footprint&&!c.find(w=>w.footprint===g.footprint)}}getHeightAtTileCoord(t,i){const c=this.getNodesInfo(),h=[],p=[0,0,0],g=oe([]);for(let w=0;w<this.nodesInfo.length;w++){const T=c[w],A=T.node.meshes[0],M=A.transformedAabb;if(t<M.min[0]||i<M.min[1]||t>M.max[0]||i>M.max[1])continue;if(T.node.hidden===!0)return{height:1/0,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};le(g,T.node.matrix),p[0]=t,p[1]=i,Nt(p,p,g);const O=(p[0]-A.aabb.min[0])/(A.aabb.max[0]-A.aabb.min[0])*gm|0,z=Math.min(63,(p[1]-A.aabb.min[1])/(A.aabb.max[1]-A.aabb.min[1])*gm|0)*gm+Math.min(63,O),U=A.heightmap[z];if(!(U<0&&T.node.footprint))return T.hiddenByReplacement?void 0:{height:U,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};if(T.node.footprint.grid.query(new Dt(t,i),new Dt(t,i),h),h.length>0)return{height:void 0,maxHeight:T.feature.properties.height,hidden:T.hiddenByReplacement,verticalScale:T.evaluatedScale[2]}}}}function M_(a,t){return a instanceof Gc&&!a.isLightConstant&&t}function ZN(a,t,i,c,h,p,g,w){let T=(61440&t|(61440&t)>>4)>>8,A=(3840&t|(3840&t)>>4)>>4,M=240&t|(240&t)>>4;i[3]>0&&(T=xr(T,255*i[0],i[3]),A=xr(A,255*i[1],i[3]),M=xr(M,255*i[2],i[3]));const O=T<<8|A,z=M<<8|Math.floor(255*c[3]),U=function(he){const _e=Fe(he,0,2);return Math.min(Math.round(.5*_e*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],V=Fe(h[0],0,1),H=Fe(h[1],0,1),re=Fe(h[2],0,1),ne=Fe(h[3],0,1);let de,ue,X,se;if(V!==H&&g!==p&&H!==V){const he=g-p;ue=1/(he*(H-V)),X=-(p+he*V)/(he*(H-V));const _e=Fe(h[4],-1,1);se=Math.pow(10,_e),de=255*re<<8|255*ne}else de=65535,ue=0,X=1,se=1;if(a.emplaceBack(O,z,U,de,ue,X,se),w){const he=w.length;w.clear();for(let _e=0;_e<he;_e++)w.emplaceBack(O,z,U,de,ue,X,se)}}function XN(a,t,i){const c=a.node;let h=0;const p=i&dg.HasMeshoptCompression;for(const g of c.meshes){if(c.lights&&c.lightMeshIndex===h||!g.featureData)continue;g.featureArray=new Yo,g.featureArray.reserve(g.featureData.length);let w=t;for(const T of g.featureData){const A=p?65535&T:T>>16&65535,M=p?T>>16&65535:65535&T,O=(15&M)<8?15&M:0,z=a.evaluatedRMEA[O],U=a.evaluatedColor[O],V=a.emissionHeightBasedParams[O];let H;if(w&&O===2&&c.lights&&(H=new Yo,H.resize(10*c.lights.length)),ZN(g.featureArray,A,U,z,V,g.aabb.min[2],g.aabb.max[2],H),H&&w){w=!1;const re=c.meshes[c.lightMeshIndex];re.featureArray=H,re.featureArray._trim()}}g.featureArray._trim(),h++}}function TI(a,t,i,c){const h=1<<a.z;t.lat=Oe((c/zt+a.y)/h),t.lng=Ie((i/zt+a.x)/h)}qt(xv,"Tiled3dModelBucket",{omit:["layers"]}),qt(SI,"Tiled3dModelFeature");const YN={circle:class extends na{constructor(a,t,i,c){super(a,{layout:Fn||(Fn=new Ri({"circle-sort-key":new Xt(qe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Ct(qe.layout_circle["circle-elevation-reference"]),visibility:new Ct(qe.layout_circle.visibility)})),paint:ri||(ri=new Ri({"circle-radius":new Xt(qe.paint_circle["circle-radius"]),"circle-color":new Xt(qe.paint_circle["circle-color"]),"circle-blur":new Xt(qe.paint_circle["circle-blur"]),"circle-opacity":new Xt(qe.paint_circle["circle-opacity"]),"circle-translate":new Ct(qe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ct(qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ct(qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ct(qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Xt(qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Xt(qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Xt(qe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ct(qe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,c)}createBucket(a){return new Wt(a)}queryRadius(a){const t=a;return Zr("circle-radius",this,t)+Zr("circle-stroke-width",this,t)+di(this.paint.get("circle-translate"))}queryIntersectsFeature(a,t,i,c,h,p,g,w){const T=Yn(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,a.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return be(a,c,p,g,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,t,i){const c=ee(this);return{config:new kl(this,{zoom:t,lut:i}),defines:c,overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends na{createBucket(a){return new yr(a)}constructor(a,t,i,c){super(a,{layout:cr||(cr=new Ri({visibility:new Ct(qe.layout_heatmap.visibility)})),paint:$r||($r=new Ri({"heatmap-radius":new Xt(qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Xt(qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ct(qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new So(qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ct(qe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=En({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Zr("heatmap-radius",this,a)}queryIntersectsFeature(a,t,i,c,h,p,g,w){const T=this.paint.get("heatmap-radius").evaluate(t,i);return be(a,c,p,g,w,!0,!0,new Dt(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,t,i){return a==="heatmap"?{config:new kl(this,{zoom:t,lut:i}),overrideFog:!1}:{}}},hillshade:class extends na{constructor(a,t,i,c){super(a,{layout:nn||(nn=new Ri({visibility:new Ct(qe.layout_hillshade.visibility)})),paint:ln||(ln=new Ri({"hillshade-illumination-direction":new Ct(qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ct(qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ct(qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ct(qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ct(qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ct(qe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ct(qe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,t,i){return{overrideFog:!1}}},fill:class extends na{constructor(a,t,i,c){super(a,{layout:m2||(m2=new Ri({"fill-sort-key":new Xt(qe.layout_fill["fill-sort-key"]),visibility:new Ct(qe.layout_fill.visibility),"fill-elevation-reference":new Ct(qe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Xt(qe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:g2||(g2=new Ri({"fill-antialias":new Ct(qe.paint_fill["fill-antialias"]),"fill-opacity":new Xt(qe.paint_fill["fill-opacity"]),"fill-color":new Xt(qe.paint_fill["fill-color"]),"fill-outline-color":new Xt(qe.paint_fill["fill-outline-color"]),"fill-translate":new Ct(qe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ct(qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xt(qe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Ct(qe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Ct(qe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Xt(qe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Xt(qe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Xt(qe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,c)}getProgramIds(){const a=this.paint.get("fill-pattern"),t=a&&a.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(a,t,i){return{config:new kl(this,{zoom:t,lut:i}),overrideFog:!1}}recalculate(a,t){super.recalculate(a,t);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new $x(a)}queryRadius(){return di(this.paint.get("fill-translate"))}queryIntersectsFeature(a,t,i,c,h,p){return!a.queryGeometry.isAboveHorizon&&rn(In(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,a.pixelToTileUnitsFactor),c)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const t=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?t&&!a:t}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends na{constructor(a,t,i,c){super(a,{layout:U2||(U2=new Ri({visibility:new Ct(qe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ct(qe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:V2||(V2=new Ri({"fill-extrusion-opacity":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ct(qe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Yy(a)}queryRadius(){return di(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,t,i,c,h,p,g,w,T){const A=Yn(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,a.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(t,i),O=this.paint.get("fill-extrusion-base").evaluate(t,i),z=[0,0],U=w&&p.elevation,V=p.elevation?p.elevation.exaggeration():1,H=a.tile.getBucket(this);if(U&&H instanceof Yy){const X=H.centroidVertexArray,se=T+1;se<X.length&&(z[0]=X.geta_centroid_pos0(se),z[1]=X.geta_centroid_pos1(se))}if(z[0]===0&&z[1]===1)return!1;p.projection.name==="globe"&&(c=j2([c],[new Dt(0,0),new Dt(zt,zt)],a.tileID.canonical).map(X=>X.polygon).flat());const re=U?w:null,[ne,de]=function(X,se,he,_e,Ce,Re,Ne,$e,at,xt,mt){return X.projection.name==="globe"?function(yt,At,tt,_t,Je,it,Pt,Mt,sr,Qt,jt){const It=[],Lr=[],rr=yt.projection.upVectorScale(jt,yt.center.lat,yt.worldSize).metersToTile,nr=[0,0,0,1],Cr=[0,0,0,1],Gr=(cn,on,Kr,ai)=>{cn[0]=on,cn[1]=Kr,cn[2]=ai,cn[3]=1},Xr=B2();tt>0&&(tt+=Xr),_t+=Xr;for(const cn of At){const on=[],Kr=[];for(const ai of cn){const vi=ai.x+Je.x,me=ai.y+Je.y,ve=yt.projection.projectTilePoint(vi,me,jt),lt=yt.projection.upVector(jt,ai.x,ai.y);let Rt=tt,$t=_t;if(Pt){const Ut=Z2(vi,me,tt,_t,Pt,Mt,sr,Qt);Rt+=Ut.base,$t+=Ut.top}tt!==0?Gr(nr,ve.x+lt[0]*rr*Rt,ve.y+lt[1]*rr*Rt,ve.z+lt[2]*rr*Rt):Gr(nr,ve.x,ve.y,ve.z),Gr(Cr,ve.x+lt[0]*rr*$t,ve.y+lt[1]*rr*$t,ve.z+lt[2]*rr*$t),Nt(nr,nr,it),Nt(Cr,Cr,it),on.push(new pm(nr[0],nr[1],nr[2])),Kr.push(new pm(Cr[0],Cr[1],Cr[2]))}It.push(on),Lr.push(Kr)}return[It,Lr]}(X,se,he,_e,Ce,Re,Ne,$e,at,xt,mt):Ne?function(yt,At,tt,_t,Je,it,Pt,Mt,sr){const Qt=[],jt=[],It=[0,0,0,1];for(const Lr of yt){const rr=[],nr=[];for(const Cr of Lr){const Gr=Cr.x+_t.x,Xr=Cr.y+_t.y,cn=Z2(Gr,Xr,At,tt,it,Pt,Mt,sr);It[0]=Gr,It[1]=Xr,It[2]=cn.base,It[3]=1,Oi(It,It,Je),It[3]=Math.max(It[3],1e-5);const on=new pm(It[0]/It[3],It[1]/It[3],It[2]/It[3]);It[0]=Gr,It[1]=Xr,It[2]=cn.top,It[3]=1,Oi(It,It,Je),It[3]=Math.max(It[3],1e-5);const Kr=new pm(It[0]/It[3],It[1]/It[3],It[2]/It[3]);rr.push(on),nr.push(Kr)}Qt.push(rr),jt.push(nr)}return[Qt,jt]}(se,he,_e,Ce,Re,Ne,$e,at,xt):function(yt,At,tt,_t,Je){const it=[],Pt=[],Mt=Je[8]*At,sr=Je[9]*At,Qt=Je[10]*At,jt=Je[11]*At,It=Je[8]*tt,Lr=Je[9]*tt,rr=Je[10]*tt,nr=Je[11]*tt;for(const Cr of yt){const Gr=[],Xr=[];for(const cn of Cr){const on=cn.x+_t.x,Kr=cn.y+_t.y,ai=Je[0]*on+Je[4]*Kr+Je[12],vi=Je[1]*on+Je[5]*Kr+Je[13],me=Je[2]*on+Je[6]*Kr+Je[14],ve=Je[3]*on+Je[7]*Kr+Je[15],lt=ai+Mt,Rt=vi+sr,$t=me+Qt,Ut=Math.max(ve+jt,1e-5),or=ai+It,Ir=vi+Lr,vn=me+rr,xn=Math.max(ve+nr,1e-5);Gr.push(new pm(lt/Ut,Rt/Ut,$t/Ut)),Xr.push(new pm(or/xn,Ir/xn,vn/xn))}it.push(Gr),Pt.push(Xr)}return[it,Pt]}(se,he,_e,Ce,Re)}(p,c,O,M,A,g,re,z,V,p.center.lat,a.tileID.canonical),ue=a.queryGeometry;return function(X,se,he){let _e=1/0;rn(he,se)&&(_e=H2(he,se[0]));for(let Ce=0;Ce<se.length;Ce++){const Re=se[Ce],Ne=X[Ce];for(let $e=0;$e<Re.length-1;$e++){const at=Re[$e],xt=[at,Re[$e+1],Ne[$e+1],Ne[$e],at];hr(he,xt)&&(_e=Math.min(_e,H2(he,xt)))}}return _e!==1/0&&_e}(ne,de,ue.isPointQuery()?ue.screenBounds:ue.screenGeometry)}},line:class extends na{constructor(a,t,i,c){const h=iA();super(a,h,t,i,c),h.layout&&(this.layout=new Xs(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Du,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,t){super.recalculate(a,t),this.paint._values["line-floorwidth"]=(()=>{if(__)return __;const i=iA();return __=new KF(i.paint.properties["line-width"].specification),__.useIntegerZoom=!0,__})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Yx(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,t,i){const c=rA(this);return{config:new kl(this,{zoom:t,lut:i}),defines:c,overrideFog:!1}}queryRadius(a){const t=a,i=oA(Zr("line-width",this,t),Zr("line-gap-width",this,t)),c=Zr("line-offset",this,t);return i/2+Math.abs(c)+di(this.paint.get("line-translate"))}queryIntersectsFeature(a,t,i,c,h,p){if(a.queryGeometry.isAboveHorizon)return!1;const g=In(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,a.pixelToTileUnitsFactor),w=a.pixelToTileUnitsFactor/2*oA(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),T=this.paint.get("line-offset").evaluate(t,i);return T&&(c=function(A,M){const O=[],z=new Dt(0,0);for(let U=0;U<A.length;U++){const V=A[U],H=[];for(let re=0;re<V.length;re++){const ne=V[re],de=V[re+1],ue=re===0?z:ne.sub(V[re-1])._unit()._perp(),X=re===V.length-1?z:de.sub(ne)._unit()._perp(),se=ue._add(X)._unit();se._mult(1/(se.x*X.x+se.y*X.y)),H.push(se._mult(M)._add(ne))}O.push(H)}return O}(c,T*a.pixelToTileUnitsFactor)),function(A,M,O){for(let z=0;z<M.length;z++){const U=M[z];if(A.length>=3){for(let V=0;V<U.length;V++)if(Wn(A,U[V]))return!0}if(Gn(A,U,O))return!0}return!1}(g,c,w)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:dv,background:class extends na{constructor(a,t,i,c){super(a,{layout:YA||(YA=new Ri({visibility:new Ct(qe.layout_background.visibility)})),paint:KA||(KA=new Ri({"background-pitch-alignment":new Ct(qe.paint_background["background-pitch-alignment"]),"background-color":new Ct(qe.paint_background["background-color"]),"background-pattern":new Ct(qe.paint_background["background-pattern"]),"background-opacity":new Ct(qe.paint_background["background-opacity"]),"background-emissive-strength":new Ct(qe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,t,i){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:rI,"raster-particle":lI,sky:class extends na{constructor(a,t,i,c){super(a,{layout:oI||(oI=new Ri({visibility:new Ct(qe.layout_sky.visibility)})),paint:aI||(aI=new Ri({"sky-type":new Ct(qe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ct(qe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ct(qe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ct(qe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ct(qe.paint_sky["sky-gradient-radius"]),"sky-gradient":new So(qe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ct(qe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ct(qe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ct(qe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=En({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(a,t){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),h=!c,p=a.style.light,g=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&tn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?v1(g.azimuthal,90-g.polar,t):v1(c[0],90-c[1],t)}const i=this.paint.get("sky-gradient-center");return v1(i[0],90-i[1],t)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends na{constructor(a,t,i,c){super(a,{paint:sI||(sI=new Ri({}))},t,null)}},model:class extends na{constructor(a,t,i,c){super(a,{layout:_I||(_I=new Ri({visibility:new Ct(qe.layout_model.visibility),"model-id":new Xt(qe.layout_model["model-id"])})),paint:yI||(yI=new Ri({"model-opacity":new Xt(qe.paint_model["model-opacity"]),"model-rotation":new Xt(qe.paint_model["model-rotation"]),"model-scale":new Xt(qe.paint_model["model-scale"]),"model-translation":new Xt(qe.paint_model["model-translation"]),"model-color":new Xt(qe.paint_model["model-color"]),"model-color-mix-intensity":new Xt(qe.paint_model["model-color-mix-intensity"]),"model-type":new Ct(qe.paint_model["model-type"]),"model-cast-shadows":new Ct(qe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ct(qe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ct(qe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Xt(qe.paint_model["model-emissive-strength"]),"model-roughness":new Xt(qe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Xt(qe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ct(qe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ct(qe.paint_model["model-front-cutoff"]),"model-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new S1(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof xv?zt-1:0}queryIntersectsFeature(a,t,i,c,h,p){if(!this.modelManager)return!1;const g=this.modelManager,w=a.tile.getBucket(this);if(!(w&&w instanceof S1))return!1;for(const T in w.instancesPerModel){const A=w.instancesPerModel[T],M=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(A.idToFeaturesIndex.hasOwnProperty(M)){const O=A.features[A.idToFeaturesIndex[M]],z=g.getModel(T,this.scope);if(!z)return!1;let U=ie();const V=new K(0,0),H=w.canonical;let re=Number.MAX_VALUE;for(let ne=0;ne<O.instancedDataCount;++ne){const de=16*(O.instancedDataOffset+ne),ue=A.instancedDataArray.float32,X=[ue[de+4],ue[de+5],ue[de+6]];TI(H,V,ue[de],0|ue[de+1]),vI(U,z,p,V,O.rotation,O.scale,X,!1,!1,!1),p.projection.name==="globe"&&(U=b1(U,p));const se=xe([],p.projMatrix,U),he=a.queryGeometry,_e=fI(he.isPointQuery()?he.screenBounds:he.screenGeometry,p,se,z.aabb);_e!=null&&(re=Math.min(_e,re))}return re!==Number.MAX_VALUE&&re}}return!1}_handleOverridablePaintPropertyUpdate(a,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const t=this._transitionablePaint._values[a];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof Zs}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends na{constructor(a,t,i,c){super(a,{layout:_2||(_2=new Ri({"clip-layer-types":new Ct(qe.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ct(qe.layout_clip["clip-layer-scope"])})),paint:y2||(y2=new Ri({}))},t,i,c)}recalculate(a,t){super.recalculate(a,t)}createBucket(a){return new v2(a)}is3D(a){return!0}}};class KN{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class JN{constructor(){this.tasks={},this.taskQueue=[],gr(["process"],this),this.invoker=new KN(this.process),this.nextId=0}add(t,i){const c=this.nextId++,h=function({type:p,isSymbolTile:g,zoom:w}){return w=w||0,p==="message"?0:p!=="maybePrepare"||g?p!=="parseTile"||g?p==="parseTile"&&g?300-w:p==="maybePrepare"&&g?400-w:500:200-w:100-w}(i);if(h===0){try{t()}finally{}return null}return this.tasks[c]={fn:t,metadata:i,priority:h,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const i=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let t=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<i&&(i=p.priority,t=h)}if(t===null)return null;const c=this.taskQueue[t];return this.taskQueue.splice(t,1),c}remove(){this.invoker.remove()}}class EI{constructor(t,i,c){this.target=t,this.parent=i,this.mapId=c,this.callbacks={},this.cancelCallbacks={},gr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new JN}send(t,i,c,h,p=!1,g){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=g,this.callbacks[w]=c);const T=new Set;return this.target.postMessage({id:w,type:t,hasCallback:!!c,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:Tl(i,T)},T),{cancel:()=>{c&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(t){const i=t.data;if(!i)return;const c=i.id;if(c&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[c];delete this.cancelCallbacks[c],h&&h.cancel()}else if(i.mustQueue||li(self)){const h=this.callbacks[c],p=this.scheduler.add(()=>this.processTask(c,i),h&&h.metadata||{type:"message"});p&&(this.cancelCallbacks[c]=p)}else this.processTask(c,i)}processTask(t,i){if(delete this.cancelCallbacks[t],i.type==="<response>"){const c=this.callbacks[t];delete this.callbacks[t],c&&(i.error?c(hc(i.error)):c(null,hc(i.data)))}else{const c=new Set,h=i.hasCallback?(g,w)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:g?Tl(g):null,data:Tl(w,c)},c)}:()=>{},p=hc(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,p,h);else if(this.parent.getWorkerSource){const g=i.type.split("."),{source:w,scope:T}=p;this.parent.getWorkerSource(i.sourceMapId,g[0],w,T)[g[1]](p,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var O_={workerUrl:"",workerClass:null,workerParams:void 0};const I1="mapboxgl_preloaded_worker_pool";class ym{constructor(){this.active={}}acquire(t,i=ym.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(O_.workerClass!=null?new O_.workerClass:new self.Worker(O_.workerUrl,O_.workerParams));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[I1]}numActive(){return Object.keys(this.active).length}}ym.workerCount=2;class pg{constructor(t,i,c="Worker",h=ym.workerCount){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=Vt();const p=this.workerPool.acquire(this.id,h);for(let g=0;g<p.length;g++){const w=new pg.Actor(p[g],i,this.id);w.name=`${c} ${g}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,i,c){ht(this.actors,(h,p)=>{h.send(t,i,p)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}let D_,P1;function bv(){return D_||(D_=new ym),D_}pg.Actor=EI;const C1=new dn(0,0,0),M1={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},O1={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},wv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},QN={PAINT_ORDER_FILL_AND_STROKE:1},k_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},AI={MASK_TYPE_LUMINANCE:1};function eB(a,t,i){a===1&&t.icons.push(function(c,h){return function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:g}=p;if(g.content_area){const{content_area:w}=g;w.top==null&&(w.top=w.left),w.width==null&&(w.width=p.usvg_tree.width),w.height==null&&(w.height=w.width)}return g.stretch_x&&g.stretch_x.length&&II(g,"x"),g.stretch_y&&g.stretch_y.length&&II(g,"y"),p}(c.readFields(tB,{name:void 0},h))}(i,i.readVarint()+i.pos))}function II(a,t){const i=[],c=a[`stretch_${t}`];let h=null;for(let p=0;p<c.length;p++)h===null?h=i.length===0?c[0]:i[i.length-1][1]+c[p]:(i.push([h,h+c[p]]),h=null);a[`stretch_${t}_areas`]=i}function tB(a,t,i){a===1?t.name=i.readString():a===2?t.metadata=function(c,h){return c.readFields(rB,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)}(i,i.readVarint()+i.pos):a===3&&(t.usvg_tree=function(c,h){return c.readFields(oB,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)}(i,i.readVarint()+i.pos),t.data="usvg_tree")}function rB(a,t,i){a===1?t.stretch_x=i.readPackedVarint():a===2?t.stretch_y=i.readPackedVarint():a===3?t.content_area=function(c,h){return c.readFields(nB,{left:0},h)}(i,i.readVarint()+i.pos):a===4&&t.variables.push(function(c,h){return c.readFields(iB,{name:void 0},h)}(i,i.readVarint()+i.pos))}function nB(a,t,i){a===1?t.left=i.readVarint():a===2?t.width=i.readVarint():a===3?t.top=i.readVarint():a===4&&(t.height=i.readVarint())}function iB(a,t,i){a===1?t.name=i.readString():a===2&&(t.rgb_color=Ev(i.readVarint()),t.value="rgb_color")}function oB(a,t,i){a===1?t.width=t.height=i.readVarint():a===2?t.height=i.readVarint():a===3?t.children.push(Sv(i,i.readVarint()+i.pos)):a===4?t.linear_gradients.push(function(c,h){return c.readFields(dB,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)}(i,i.readVarint()+i.pos)):a===5?t.radial_gradients.push(function(c,h){return c.readFields(pB,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)}(i,i.readVarint()+i.pos)):a===7?t.clip_paths.push(function(c,h){return c.readFields(mB,{children:[]},h)}(i,i.readVarint()+i.pos)):a===8&&t.masks.push(function(c,h){const p=c.readFields(gB,{left:0,width:20,mask_type:AI.MASK_TYPE_LUMINANCE,children:[]},h);return p.height==null&&(p.height=p.width),p.top==null&&(p.top=p.left),p}(i,i.readVarint()+i.pos))}function Sv(a,t){return a.readFields(aB,{},t)}function aB(a,t,i){a===1?(t.group=function(c,h){return c.readFields(sB,{opacity:255,children:[]},h)}(i,i.readVarint()+i.pos),t.node="group"):a===2&&(t.path=function(c,h){return c.readFields(cB,{paint_order:1,commands:[],step:1,diffs:[],rule:M1.PATH_RULE_NON_ZERO},h)}(i,i.readVarint()+i.pos),t.node="path")}function sB(a,t,i){a===1?t.transform=Tv(i,i.readVarint()+i.pos):a===2?t.opacity=i.readVarint():a===5?t.clip_path_idx=i.readVarint():a===6?t.mask_idx=i.readVarint():a===7&&t.children.push(Sv(i,i.readVarint()+i.pos))}function Tv(a,t){return a.readFields(lB,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function lB(a,t,i){a===1?t.sx=i.readFloat():a===2?t.ky=i.readFloat():a===3?t.kx=i.readFloat():a===4?t.sy=i.readFloat():a===5?t.tx=i.readFloat():a===6&&(t.ty=i.readFloat())}function cB(a,t,i){a===1?t.fill=function(c,h){return c.readFields(uB,{rgb_color:C1,paint:"rgb_color",opacity:255},h)}(i,i.readVarint()+i.pos):a===2?t.stroke=function(c,h){return c.readFields(hB,{rgb_color:C1,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)}(i,i.readVarint()+i.pos):a===3?t.paint_order=i.readVarint():a===5?i.readPackedVarint(t.commands):a===6?t.step=i.readFloat():a===7?i.readPackedSVarint(t.diffs):a===8&&(t.rule=i.readVarint())}function uB(a,t,i){a===1?(t.rgb_color=Ev(i.readVarint()),t.paint="rgb_color"):a===2?(t.linear_gradient_idx=i.readVarint(),t.paint="linear_gradient_idx"):a===3?(t.radial_gradient_idx=i.readVarint(),t.paint="radial_gradient_idx"):a===5&&(t.opacity=i.readVarint())}function Ev(a){return new dn((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function hB(a,t,i){a===1?(t.rgb_color=Ev(i.readVarint()),t.paint="rgb_color"):a===2?(t.linear_gradient_idx=i.readVarint(),t.paint="linear_gradient_idx"):a===3?(t.radial_gradient_idx=i.readVarint(),t.paint="radial_gradient_idx"):a===5?i.readPackedFloat(t.dasharray):a===6?t.dashoffset=i.readFloat():a===7?t.miterlimit=i.readFloat():a===8?t.opacity=i.readVarint():a===9?t.width=i.readFloat():a===10?t.linecap=i.readVarint():a===11&&(t.linejoin=i.readVarint())}function dB(a,t,i){a===1?t.transform=Tv(i,i.readVarint()+i.pos):a===2?t.spread_method=i.readVarint():a===3?t.stops.push(PI(i,i.readVarint()+i.pos)):a===4?t.x1=i.readFloat():a===5?t.y1=i.readFloat():a===6?t.x2=i.readFloat():a===7&&(t.y2=i.readFloat())}function PI(a,t){return a.readFields(fB,{offset:0,opacity:255,rgb_color:C1},t)}function fB(a,t,i){a===1?t.offset=i.readFloat():a===2?t.opacity=i.readVarint():a===3&&(t.rgb_color=Ev(i.readVarint()))}function pB(a,t,i){a===1?t.transform=Tv(i,i.readVarint()+i.pos):a===2?t.spread_method=i.readVarint():a===3?t.stops.push(PI(i,i.readVarint()+i.pos)):a===4?t.cx=i.readFloat():a===5?t.cy=i.readFloat():a===6?t.r=i.readFloat():a===7?t.fx=i.readFloat():a===8?t.fy=i.readFloat():a===9&&(t.fr=i.readFloat())}function mB(a,t,i){a===1?t.transform=Tv(i,i.readVarint()+i.pos):a===2?t.clip_path_idx=i.readVarint():a===3&&t.children.push(Sv(i,i.readVarint()+i.pos))}function gB(a,t,i){a===1?t.left=t.top=i.readFloat():a===2?t.width=t.height=i.readFloat():a===3?t.top=i.readFloat():a===4?t.height=i.readFloat():a===5?t.mask_type=i.readVarint():a===6?t.mask_idx=i.readVarint():a===7&&t.children.push(Sv(i,i.readVarint()+i.pos))}class _B{static calculate(t={},i=[]){const c=new Map,h=new Map;if(Object.keys(t).length===0)return c;i.forEach(p=>{h.set(p.name,p.rgb_color||new dn(0,0,0))});for(const[p,g]of Object.entries(t))h.has(p)?c.set(h.get(p).toStringPremultipliedAlpha(),g):console.warn(`Ignoring unknown image variable "${p}"`);return c}}function mg(a,t=255,i){const c=t/255,h=a.toStringPremultipliedAlpha(),p=i.has(h)?i.get(h).clone():a.clone();return p.a*=c,p.toString()}function R_(a,t){if(!Cp()){const i=document.createElement("canvas");return i.width=a,i.height=t,i}return new OffscreenCanvas(a,t)}function yB(a,t){const i=_B.calculate(t.params,a.metadata?a.metadata.variables:[]),c=a.usvg_tree,h=c.width,p=c.height,g=t.transform?t.transform:new DOMMatrix,w=Math.max(1,Math.round(h*g.a)),T=Math.max(1,Math.round(p*g.d)),A=new DOMMatrix([w/h,0,0,T/p,0,0]),M=R_(w,T).getContext("2d");return D1(M,A,c,c,i),M.getImageData(0,0,w,T)}function D1(a,t,i,c,h){for(const p of c.children)CI(a,t,i,p,h)}function CI(a,t,i,c,h){c.group?(a.save(),function(p,g,w,T,A){const M=T.mask_idx!=null?w.masks[T.mask_idx]:null,O=T.clip_path_idx!=null?w.clip_paths[T.clip_path_idx]:null;if(T.transform&&(g=Av(T.transform).preMultiplySelf(g)),!function(V,H,re){return V.opacity!==255||H||re}(T,O!=null,M!=null))return void D1(p,g,w,T,A);const z=R_(p.canvas.width,p.canvas.height),U=z.getContext("2d");D1(U,g,w,T,A),O&&zI(U,g,w,O),M&&FI(U,g,w,M,A),p.globalAlpha=T.opacity/255,p.drawImage(z,0,0)}(a,t,i,c.group,h),a.restore()):c.path&&(a.save(),function(p,g,w,T,A){const M=NI(T);p.setTransform(g),T.paint_order===QN.PAINT_ORDER_FILL_AND_STROKE?(MI(p,w,T,M,A),DI(p,w,T,M,A)):(DI(p,w,T,M,A),MI(p,w,T,M,A))}(a,t,i,c.path,h),a.restore())}function MI(a,t,i,c,h){const p=i.fill;if(!p)return;const g=p.opacity/255;switch(p.paint){case"rgb_color":a.fillStyle=mg(p.rgb_color,p.opacity,h);break;case"linear_gradient_idx":a.fillStyle=kI(a,t.linear_gradients[p.linear_gradient_idx],g,h);break;case"radial_gradient_idx":a.fillStyle=RI(a,t.radial_gradients[p.radial_gradient_idx],g,h)}a.fill(c,OI(i))}function OI(a){return a.rule===M1.PATH_RULE_NON_ZERO?"nonzero":a.rule===M1.PATH_RULE_EVEN_ODD?"evenodd":void 0}function DI(a,t,i,c,h){const p=i.stroke;if(!p)return;a.lineWidth=p.width,a.miterLimit=p.miterlimit,a.setLineDash(p.dasharray),a.lineDashOffset=p.dashoffset;const g=p.opacity/255;switch(p.paint){case"rgb_color":a.strokeStyle=mg(p.rgb_color,p.opacity,h);break;case"linear_gradient_idx":a.strokeStyle=kI(a,t.linear_gradients[p.linear_gradient_idx],g,h);break;case"radial_gradient_idx":a.strokeStyle=RI(a,t.radial_gradients[p.radial_gradient_idx],g,h)}switch(p.linejoin){case wv.LINE_JOIN_MITER_CLIP:case wv.LINE_JOIN_MITER:a.lineJoin="miter";break;case wv.LINE_JOIN_ROUND:a.lineJoin="round";break;case wv.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(p.linecap){case O1.LINE_CAP_BUTT:a.lineCap="butt";break;case O1.LINE_CAP_ROUND:a.lineCap="round";break;case O1.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(c)}function kI(a,t,i,c){if(t.stops.length===1){const z=t.stops[0];return mg(z.rgb_color,z.opacity*i,c)}const h=Av(t.transform),{x1:p,y1:g,x2:w,y2:T}=t,A=h.transformPoint(new DOMPoint(p,g)),M=h.transformPoint(new DOMPoint(w,T)),O=a.createLinearGradient(A.x,A.y,M.x,M.y);for(const z of t.stops)O.addColorStop(z.offset,mg(z.rgb_color,z.opacity*i,c));return O}function RI(a,t,i,c){if(t.stops.length===1){const z=t.stops[0];return mg(z.rgb_color,z.opacity*i,c)}const h=Av(t.transform),{fx:p,fy:g,cx:w,cy:T}=t,A=h.transformPoint(new DOMPoint(p,g)),M=h.transformPoint(new DOMPoint(w,T)),O=a.createRadialGradient(A.x,A.y,0,M.x,M.y,t.r*((h.a+h.d)/2));for(const z of t.stops)O.addColorStop(z.offset,mg(z.rgb_color,z.opacity*i,c));return O}function LI(a,t,i,c){const h=c.transform?Av(c.transform).preMultiplySelf(t):t,p=R_(a.canvas.width,a.canvas.height),g=p.getContext("2d");for(const T of c.children)if(T.group)LI(g,h,i,T.group);else if(T.path){const A=T.path,M=new Path2D;M.addPath(NI(A),h),g.fill(M,OI(A))}const w=c.clip_path_idx!=null?i.clip_paths[c.clip_path_idx]:null;w&&zI(g,h,i,w),a.globalCompositeOperation="source-over",a.drawImage(p,0,0)}function zI(a,t,i,c){const h=R_(a.canvas.width,a.canvas.height);LI(h.getContext("2d"),t,i,c),a.globalCompositeOperation="destination-in",a.drawImage(h,0,0)}function FI(a,t,i,c,h){if(c.children.length===0)return;const p=c.mask_idx!=null?i.masks[c.mask_idx]:null;p&&FI(a,t,i,p,h);const g=a.canvas.width,w=a.canvas.height,T=R_(g,w),A=T.getContext("2d"),M=c.width,O=c.height,z=c.left,U=c.top,V=new Path2D,H=new Path2D;H.rect(z,U,M,O),V.addPath(H,t),A.clip(V);for(const de of c.children)CI(A,t,i,de,h);const re=A.getImageData(0,0,g,w),ne=re.data;if(c.mask_type===AI.MASK_TYPE_LUMINANCE)for(let de=0;de<ne.length;de+=4)ne[de+3]=ne[de+3]/255*(.2126*ne[de]+.7152*ne[de+1]+.0722*ne[de+2]);A.putImageData(re,0,0),a.globalCompositeOperation="destination-in",a.drawImage(T,0,0)}function Av(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function NI(a){const t=new Path2D,i=a.step;let c=a.diffs[0]*i,h=a.diffs[1]*i;t.moveTo(c,h);for(let p=0,g=2;p<a.commands.length;p++)switch(a.commands[p]){case k_.PATH_COMMAND_MOVE:c+=a.diffs[g++]*i,h+=a.diffs[g++]*i,t.moveTo(c,h);break;case k_.PATH_COMMAND_LINE:c+=a.diffs[g++]*i,h+=a.diffs[g++]*i,t.lineTo(c,h);break;case k_.PATH_COMMAND_QUAD:{const w=c+a.diffs[g++]*i,T=h+a.diffs[g++]*i;c=w+a.diffs[g++]*i,h=T+a.diffs[g++]*i,t.quadraticCurveTo(w,T,c,h);break}case k_.PATH_COMMAND_CUBIC:{const w=c+a.diffs[g++]*i,T=h+a.diffs[g++]*i,A=w+a.diffs[g++]*i,M=T+a.diffs[g++]*i;c=A+a.diffs[g++]*i,h=M+a.diffs[g++]*i,t.bezierCurveTo(w,T,A,M,c,h);break}case k_.PATH_COMMAND_CLOSE:t.closePath()}return t}class Iv{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const i=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,i),i}put(t,i){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,i)}delete(t){this.cache.delete(t)}}qt(Iv,"LRUCache");class k1{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(t){return new ar(t,t.data)}getFromCache(t,i,c){return this.cacheMap.has(c)||this.cacheMap.set(c,new Iv(150)),this.cacheMap.get(c).get(Pl(t.toString(),i))}setInCache(t,i,c,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new Iv(150));const p=this.cacheDependenciesMap.get(h),g=Pl(t.id.toString(),c);p.get(g)||p.set(g,new Set);const w=this.cacheMap.get(h),T=t.toString();p.get(g).add(T),w.put(Pl(t.toString(),c),i)}removeImagesFromCacheByIds(t,i,c=0){if(!this.cacheMap.has(c)||!this.cacheDependenciesMap.has(c))return;const h=this.cacheMap.get(c),p=this.cacheDependenciesMap.get(c);for(const g of t){const w=Pl(g.toString(),i);if(p.has(w)){for(const T of p.get(w))h.delete(T);p.delete(w)}}}rasterize(t,i,c,h,p=yB){const g=this.getFromCache(t,c,h);if(g)return g.clone();const w=p(i.icon,t.options),T=k1._getImage(w);return this.setInCache(t,T,c,h),T.clone()}}class BI{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,i){const c=this.toIdx(t,i);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(t,i){return this.leaves[this.toIdx(t,i)]}toIdx(t,i){return i*this.size+t}}function jI(a,t,i,c){let h=0,p=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(c[g])<1e-15){if(i[g]<a[g]||i[g]>t[g])return null}else{const w=1/c[g];let T=(a[g]-i[g])*w,A=(t[g]-i[g])*w;if(T>A){const M=T;T=A,A=M}if(T>h&&(h=T),A<p&&(p=A),h>p)return null}return h}function UI(a,t,i,c,h,p,g,w,T,A,M){const O=c-a,z=h-t,U=p-i,V=g-a,H=w-t,re=T-i,ne=M[1]*re-M[2]*H,de=M[2]*V-M[0]*re,ue=M[0]*H-M[1]*V,X=O*ne+z*de+U*ue;if(Math.abs(X)<1e-15)return null;const se=1/X,he=A[0]-a,_e=A[1]-t,Ce=A[2]-i,Re=(he*ne+_e*de+Ce*ue)*se;if(Re<0||Re>1)return null;const Ne=_e*U-Ce*z,$e=Ce*O-he*U,at=he*z-_e*O,xt=(M[0]*Ne+M[1]*$e+M[2]*at)*se;return xt<0||Re+xt>1?null:(V*Ne+H*$e+re*at)*se}function VI(a,t,i){return(a-t)/(i-t)}function $I(a,t,i,c,h,p,g,w,T){const A=1<<i,M=p-c,O=g-h,z=(a+1)/A*M+c,U=(t+0)/A*O+h,V=(t+1)/A*O+h;w[0]=(a+0)/A*M+c,w[1]=U,T[0]=z,T[1]=V}class GI{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(p){const g=Math.ceil(Math.log2(p.dim/8)),w=[];let T=Math.ceil(Math.pow(2,g));const A=1/T,M=(U,V,H,re,ne)=>{const de=re?1:0,ue=(U+1)*H-de,X=V*H,se=(V+1)*H-de;ne[0]=U*H,ne[1]=X,ne[2]=ue,ne[3]=se};let O=new BI(T);const z=[];for(let U=0;U<T*T;U++){M(U%T,Math.floor(U/T),A,!1,z);const V=hp(z[0],z[1],p),H=hp(z[2],z[1],p),re=hp(z[2],z[3],p),ne=hp(z[0],z[3],p);O.minimums.push(Math.min(V,H,re,ne)),O.maximums.push(Math.max(V,H,re,ne)),O.leaves.push(1)}for(w.push(O),T/=2;T>=1;T/=2){const U=w[w.length-1];O=new BI(T);for(let V=0;V<T*T;V++){M(V%T,Math.floor(V/T),2,!0,z);const H=U.getElevation(z[0],z[1]),re=U.getElevation(z[2],z[1]),ne=U.getElevation(z[2],z[3]),de=U.getElevation(z[0],z[3]),ue=U.isLeaf(z[0],z[1]),X=U.isLeaf(z[2],z[1]),se=U.isLeaf(z[2],z[3]),he=U.isLeaf(z[0],z[3]),_e=Math.min(H.min,re.min,ne.min,de.min),Ce=Math.max(H.max,re.max,ne.max,de.max),Re=ue&&X&&se&&he;O.maximums.push(Ce),O.minimums.push(_e),O.leaves.push(Ce-_e<=5&&Re?1:0)}w.push(O)}return w}(this.dem),c=i.length-1,h=i[c];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,c,0)}raycastRoot(t,i,c,h,p,g,w=1){return jI([t,i,-100],[c,h,this.maximums[0]*w],p,g)}raycast(t,i,c,h,p,g,w=1){if(!this.nodeCount)return null;const T=this.raycastRoot(t,i,c,h,p,g,w);if(T==null)return null;const A=[],M=[],O=[],z=[],U=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;U.length>0;){const{idx:V,t:H,nodex:re,nodey:ne,depth:de}=U.pop();if(this.leaves[V]){$I(re,ne,de,t,i,c,h,O,z);const X=1<<de,se=(re+0)/X,he=(re+1)/X,_e=(ne+0)/X,Ce=(ne+1)/X,Re=hp(se,_e,this.dem)*w,Ne=hp(he,_e,this.dem)*w,$e=hp(he,Ce,this.dem)*w,at=hp(se,Ce,this.dem)*w,xt=UI(O[0],O[1],Re,z[0],O[1],Ne,z[0],z[1],$e,p,g),mt=UI(z[0],z[1],$e,O[0],z[1],at,O[0],O[1],Re,p,g),yt=Math.min(xt!==null?xt:Number.MAX_VALUE,mt!==null?mt:Number.MAX_VALUE);if(yt!==Number.MAX_VALUE)return yt;{const At=ot([],p,g,H);if(qI(Re,Ne,at,$e,VI(At[0],O[0],z[0]),VI(At[1],O[1],z[1]))>=At[2])return H}continue}let ue=0;for(let X=0;X<this._siblingOffset.length;X++){$I((re<<1)+this._siblingOffset[X][0],(ne<<1)+this._siblingOffset[X][1],de+1,t,i,c,h,O,z),O[2]=-100,z[2]=this.maximums[this.childOffsets[V]+X]*w;const se=jI(O,z,p,g);if(se!=null){const he=se;A[X]=he;let _e=!1;for(let Ce=0;Ce<ue&&!_e;Ce++)he>=A[M[Ce]]&&(M.splice(Ce,0,X),_e=!0);_e||(M[ue]=X),ue++}}for(let X=0;X<ue;X++){const se=M[X];U.push({idx:this.childOffsets[V]+se,t:A[se],nodex:(re<<1)+this._siblingOffset[se][0],nodey:(ne<<1)+this._siblingOffset[se][1],depth:de+1})}}return null}_addNode(t,i,c){return this.minimums.push(t),this.maximums.push(i),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(t,i,c,h,p){if(t[h].isLeaf(i,c)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const g=h-1,w=t[g];let T=0,A=0;for(let M=0;M<this._siblingOffset.length;M++){const O=2*i+this._siblingOffset[M][0],z=2*c+this._siblingOffset[M][1],U=w.getElevation(O,z),V=w.isLeaf(O,z),H=this._addNode(U.min,U.max,V);V&&(T|=1<<M),A||(A=H)}for(let M=0;M<this._siblingOffset.length;M++)T&1<<M||this._construct(t,2*i+this._siblingOffset[M][0],2*c+this._siblingOffset[M][1],g,A+M)}}function qI(a,t,i,c,h,p){return xr(xr(a,i,p),xr(t,c,p),h)}function hp(a,t,i){const c=i.dim,h=Fe(a*c-.5,0,c-1),p=Fe(t*c-.5,0,c-1),g=Math.floor(h),w=Math.floor(p),T=Math.min(g+1,c-1),A=Math.min(w+1,c-1);return qI(i.get(g,w),i.get(T,w),i.get(g,A),i.get(T,A),h-g,p-w)}const vB={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function xB(a,t,i){return(256*a*256+256*t+i)/10-1e4}function bB(a,t,i){return 256*a+t+i/256-32768}class Pv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,i,c,h=!1){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void tn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const p=this.dim=i.height-2,g=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let T=0;T<p;T++)g[this._idx(-1,T)]=g[this._idx(0,T)],g[this._idx(p,T)]=g[this._idx(p-1,T)],g[this._idx(T,-1)]=g[this._idx(T,0)],g[this._idx(T,p)]=g[this._idx(T,p-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(p,-1)]=g[this._idx(p-1,0)],g[this._idx(-1,p)]=g[this._idx(0,p-1)],g[this._idx(p,p)]=g[this._idx(p-1,p-1)]}const w=c==="terrarium"?bB:xB;for(let T=0;T<g.length;++T){const A=4*T;this.floatView[T]=w(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=Ja.now()}_buildQuadTree(){this._tree=new GI(this)}get(t,i,c=!1){c&&(t=Fe(t,-1,this.dim),i=Fe(i,-1,this.dim));const h=this._idx(t,i);return this.floatView[h]}set(t,i,c){const h=this._idx(t,i),p=this.floatView[h];return this.floatView[h]=c,c-p}static getUnpackVector(t){return vB[t]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}static pack(t,i){const c=[0,0,0,0],h=Pv.getUnpackVector(i);let p=Math.floor((t+h[3])/h[2]);return c[2]=p%256,p=Math.floor(p/256),c[1]=p%256,p=Math.floor(p/256),c[0]=p,c}getPixels(){return new pn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,i,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,p=i*this.dim+this.dim,g=c*this.dim,w=c*this.dim+this.dim;switch(i){case-1:h=p-1;break;case 1:p=h+1}switch(c){case-1:g=w-1;break;case 1:w=g+1}const T=-i*this.dim,A=-c*this.dim;for(let M=g;M<w;M++)for(let O=h;O<p;O++){const z=4*this._idx(O,M),U=4*this._idx(O+T,M+A);this.pixels[z+0]=t.pixels[U+0],this.pixels[z+1]=t.pixels[U+1],this.pixels[z+2]=t.pixels[U+2],this.pixels[z+3]=t.pixels[U+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function wB(a,t,i){a===1?t.headerLength=i.readFixed32():a===2?t.x=i.readVarint():a===3?t.y=i.readVarint():a===4?t.z=i.readVarint():a===5&&t.layers.push(function(c,h){return c.readFields(IB,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)}(i,i.readVarint()+i.pos))}function SB(a,t,i){a===1?(t.delta_filter=function(c,h){return c.readFields(TB,{blockSize:0},h)}(i,i.readVarint()+i.pos),t.filter="delta_filter"):a===2?(i.readVarint(),t.filter="zigzag_filter"):a===3?(i.readVarint(),t.filter="bitshuffle_filter"):a===4&&(i.readVarint(),t.filter="byteshuffle_filter")}function TB(a,t,i){a===1&&(t.blockSize=i.readVarint())}function EB(a,t,i){a===1?(i.readVarint(),t.codec="gzip_data"):a===2?(i.readVarint(),t.codec="jpeg_image"):a===3?(i.readVarint(),t.codec="webp_image"):a===4&&(i.readVarint(),t.codec="png_image")}function AB(a,t,i){let c=0,h=0;a===1?t.firstByte=i.readFixed64():a===2?t.lastByte=i.readFixed64():a===3?t.filters.push(function(p,g){return p.readFields(SB,{},g)}(i,i.readVarint()+i.pos)):a===4?t.codec=function(p,g){return p.readFields(EB,{},g)}(i,i.readVarint()+i.pos):a===5?h=i.readFloat():a===6?c=i.readFloat():a===7?t.bands.push(i.readString()):a===8?t.offset=i.readDouble():a===9&&(t.scale=i.readDouble()),t.offset===0&&(t.offset=h),t.scale===0&&(t.scale=c)}function IB(a,t,i){a===1?t.version=i.readVarint():a===2?t.name=i.readString():a===3?t.units=i.readString():a===4?t.tileSize=i.readVarint():a===5?t.buffer=i.readVarint():a===6?t.pixelFormat=i.readVarint():a===7&&t.dataIndex.push(function(c,h){return c.readFields(AB,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)}(i,i.readVarint()+i.pos))}function PB(a,t,i){if(a===2)(function(c,h,p){c.readFields(CB,p,h)})(i,i.readVarint()+i.pos,t);else if(a===3)throw new Error("Not implemented")}function CB(a,t,i){if(a===1){let c=0;const h=i.readVarint()+i.pos;for(;i.pos<h;)t[c++]=i.readVarint()}}function MB(a,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let i=t[3];for(let c=2;c>=1;c--){const h=c===1?1:0,p=c===2?1:0;for(let g=0;g<t[0];g++){const w=t[1]*g;for(let T=h;T<t[1];T++){const A=t[2]*(T+w);for(let M=p;M<t[2];M++){const O=t[3]*(M+A);for(let z=0;z<t[3];z++){const U=O+z;a[U]+=a[U-i]}}}}i*=t[c]}return a}function OB(a){for(let t=0,i=a.length;t<i;t++)a[t]=a[t]>>>1^-(1&a[t]);return a}function DB(a,t){switch(t){case"uint32":return a;case"uint16":for(let i=0;i<a.length;i+=2){const c=a[i],h=a[i+1];a[i]=(240&c)>>4|(61440&c)>>8|(240&h)<<4|61440&h,a[i+1]=15&c|(3840&c)>>4|(15&h)<<8|(3840&h)<<4}return a;case"uint8":for(let i=0;i<a.length;i+=4){const c=a[i],h=a[i+1],p=a[i+2],g=a[i+3];a[i+0]=(192&c)>>6|(192&h)>>4|(192&p)>>2|192&g,a[i+1]=(48&c)>>4|(48&h)>>2|48&p|(48&g)<<2,a[i+2]=(12&c)>>2|12&h|(12&p)<<2|(12&g)<<4,a[i+3]=3&c|(3&h)<<2|(3&p)<<4|(3&g)<<6}return a;default:throw new Error(`Invalid pixel format, "${t}"`)}}qt(Pv,"DEMData"),qt(GI,"DemMinMaxQuadTree",{omit:["dem"]});var _c=Uint8Array,L_=Uint16Array,kB=Int32Array,WI=new _c([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),HI=new _c([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),RB=new _c([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ZI=function(a,t){for(var i=new L_(31),c=0;c<31;++c)i[c]=t+=1<<a[c-1];var h=new kB(i[30]);for(c=1;c<30;++c)for(var p=i[c];p<i[c+1];++p)h[p]=p-i[c]<<5|c;return{b:i,r:h}},XI=ZI(WI,2),YI=XI.b,LB=XI.r;YI[28]=258,LB[258]=28;for(var zB=ZI(HI,0).b,KI=new L_(32768),Oo=0;Oo<32768;++Oo){var gg=(43690&Oo)>>1|(21845&Oo)<<1;KI[Oo]=((65280&(gg=(61680&(gg=(52428&gg)>>2|(13107&gg)<<2))>>4|(3855&gg)<<4))>>8|(255&gg)<<8)>>1}var z_=function(a,t,i){for(var c=a.length,h=0,p=new L_(t);h<c;++h)a[h]&&++p[a[h]-1];var g,w=new L_(t);for(h=1;h<t;++h)w[h]=w[h-1]+p[h-1]<<1;g=new L_(1<<t);var T=15-t;for(h=0;h<c;++h)if(a[h])for(var A=h<<4|a[h],M=t-a[h],O=w[a[h]-1]++<<M,z=O|(1<<M)-1;O<=z;++O)g[KI[O]>>T]=A;return g},F_=new _c(288);for(Oo=0;Oo<144;++Oo)F_[Oo]=8;for(Oo=144;Oo<256;++Oo)F_[Oo]=9;for(Oo=256;Oo<280;++Oo)F_[Oo]=7;for(Oo=280;Oo<288;++Oo)F_[Oo]=8;var JI=new _c(32);for(Oo=0;Oo<32;++Oo)JI[Oo]=5;var FB=z_(F_,9),NB=z_(JI,5),R1=function(a){for(var t=a[0],i=1;i<a.length;++i)a[i]>t&&(t=a[i]);return t},Qu=function(a,t,i){var c=t/8|0;return(a[c]|a[c+1]<<8)>>(7&t)&i},L1=function(a,t){var i=t/8|0;return(a[i]|a[i+1]<<8|a[i+2]<<16)>>(7&t)},BB=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],eh=function(a,t,i){var c=new Error(t||BB[a]);if(c.code=a,Error.captureStackTrace&&Error.captureStackTrace(c,eh),!i)throw c;return c},jB=new _c(0),UB=typeof TextDecoder<"u"&&new TextDecoder;try{UB.decode(jB,{stream:!0})}catch{}const VB={gzip_data:"gzip"};class ou extends Error{constructor(t){super(t),this.name="MRTError"}}const $B={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},QI={uint32:1,uint16:2,uint8:4},GB={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let z1;class Cv{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const i=this.layers[t];if(!i)throw new ou(`Layer '${t}' not found`);return i}getHeaderLength(t){const i=new Uint8Array(t),c=new DataView(t);if(i[0]!==13)throw new ou("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(t){const i=new Uint8Array(t),c=this.getHeaderLength(t);if(i.length<c)throw new ou(`Expected header with length >= ${c} but got buffer of length ${i.length}`);const h=function(p,g){return p.readFields(wB,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new z1(i.subarray(0,c)));if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new ou(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const p of h.layers)this.layers[p.name]=new eP(p,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const i=[],c=this.getLayer(t.layerName);for(let h of t.blockIndices){const p=c.dataIndex[h],g=p.firstByte-t.firstByte,w=p.lastByte-t.firstByte;if(c._blocksInProgress.has(h))continue;const T={layerName:c.name,firstByte:g,lastByte:w,pixelFormat:c.pixelFormat,blockIndex:h,blockShape:[p.bands.length].concat(c.bandShape),buffer:c.buffer,codec:p.codec.codec,filters:p.filters.map(A=>A.filter)};c._blocksInProgress.add(h),i.push(T)}return new tP(i,()=>{i.forEach(h=>c._blocksInProgress.delete(h.blockIndex))},(h,p)=>{if(i.forEach(g=>c._blocksInProgress.delete(g.blockIndex)),h)throw h;p.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class eP{constructor({version:t,name:i,units:c,tileSize:h,pixelFormat:p,buffer:g,dataIndex:w},T){if(this.version=t,this.version!==1)throw new ou(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=i,this.units=c,this.tileSize=h,this.buffer=g,this.pixelFormat=$B[p],this.dataIndex=w,this.bandShape=[h+2*g,h+2*g,QI[this.pixelFormat]],this._decodedBlocks=new Iv(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return QI[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:t})=>t).flat()}processDecodedData(t){const i=t.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,t.data)}getBlockForBand(t){let i=0;switch(typeof t){case"string":for(const[c,h]of this.dataIndex.entries()){for(const[p,g]of h.bands.entries())if(g===t)return{bandIndex:i+p,blockIndex:c,blockBandIndex:p};i+=h.bands.length}break;case"number":for(const[c,h]of this.dataIndex.entries()){if(t>=i&&t<i+h.bands.length)return{bandIndex:t,blockIndex:c,blockBandIndex:t-i};i+=h.bands.length}break;default:throw new ou(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(t){let i=1/0,c=-1/0;const h=[],p=new Set;for(const g of t){const{blockIndex:w}=this.getBlockForBand(g);if(w<0)throw new ou(`Invalid band: ${JSON.stringify(g)}`);const T=this.dataIndex[w];h.includes(w)||h.push(w),p.add(w),i=Math.min(i,T.firstByte),c=Math.max(c,T.lastByte)}if(p.size>this.cacheSize)throw new ou(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:c,blockIndices:h}}hasBand(t){const{blockIndex:i}=this.getBlockForBand(t);return i>=0}hasDataForBand(t){const{blockIndex:i}=this.getBlockForBand(t);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(t){const{blockIndex:i,blockBandIndex:c}=this.getBlockForBand(t);if(i<0)throw new ou(`Band not found: ${JSON.stringify(t)}`);const h=this._decodedBlocks.get(i.toString());if(!h)throw new ou(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[i],g=this.bandShape.reduce((A,M)=>A*M,1),w=c*g,T=h.subarray(w,w+g);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}Cv.setPbf=function(a){z1=a};class tP{constructor(t,i,c){this.tasks=t,this._onCancel=i,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,i){this._finalized||(this._onComplete(t,i),this._finalized=!0)}}Cv.performDecoding=function(a,t){const i=new Uint8Array(a);return Promise.all(t.tasks.map(c=>{const{layerName:h,firstByte:p,lastByte:g,pixelFormat:w,blockShape:T,blockIndex:A,filters:M,codec:O}=c,z=i.subarray(p,g+1),U=new Uint32Array(T[0]*T[1]*T[2]);let V;if(O!=="gzip_data")throw new ou(`Unhandled codec: ${O}`);return V=function(H,re){if(!globalThis.DecompressionStream&&re==="gzip_data")return Promise.resolve(((X=function(_e){_e[0]==31&&_e[1]==139&&_e[2]==8||eh(6,"invalid gzip data");var Ce=_e[3],Re=10;4&Ce&&(Re+=2+(_e[10]|_e[11]<<8));for(var Ne=(Ce>>3&1)+(Ce>>4&1);Ne>0;Ne-=!_e[Re++]);return Re+(2&Ce)}(ue=H))+8>ue.length&&eh(6,"invalid gzip data"),function(_e,Ce,Re,Ne){var $e=_e.length;if(!$e||Ce.f&&!Ce.l)return Re||new _c(0);var at=!Re,xt=at||Ce.i!=2,mt=Ce.i;at&&(Re=new _c(3*$e));var yt,At,tt=function(Xi){var Ei=Re.length;if(Xi>Ei){var pi=new _c(Math.max(2*Ei,Xi));pi.set(Re),Re=pi}},_t=Ce.f||0,Je=Ce.p||0,it=Ce.b||0,Pt=Ce.l,Mt=Ce.d,sr=Ce.m,Qt=Ce.n,jt=8*$e;do{if(!Pt){_t=Qu(_e,Je,1);var It=Qu(_e,Je+1,3);if(Je+=3,!It){var Lr=_e[(me=4+((Je+7)/8|0))-4]|_e[me-3]<<8,rr=me+Lr;if(rr>$e){mt&&eh(0);break}xt&&tt(it+Lr),Re.set(_e.subarray(me,rr),it),Ce.b=it+=Lr,Ce.p=Je=8*rr,Ce.f=_t;continue}if(It==1)Pt=FB,Mt=NB,sr=9,Qt=5;else if(It==2){var nr=Qu(_e,Je,31)+257,Cr=Qu(_e,Je+10,15)+4,Gr=nr+Qu(_e,Je+5,31)+1;Je+=14;for(var Xr=new _c(Gr),cn=new _c(19),on=0;on<Cr;++on)cn[RB[on]]=Qu(_e,Je+3*on,7);Je+=3*Cr;var Kr=R1(cn),ai=(1<<Kr)-1,vi=z_(cn,Kr);for(on=0;on<Gr;){var me,ve=vi[Qu(_e,Je,ai)];if(Je+=15&ve,(me=ve>>4)<16)Xr[on++]=me;else{var lt=0,Rt=0;for(me==16?(Rt=3+Qu(_e,Je,3),Je+=2,lt=Xr[on-1]):me==17?(Rt=3+Qu(_e,Je,7),Je+=3):me==18&&(Rt=11+Qu(_e,Je,127),Je+=7);Rt--;)Xr[on++]=lt}}var $t=Xr.subarray(0,nr),Ut=Xr.subarray(nr);sr=R1($t),Qt=R1(Ut),Pt=z_($t,sr),Mt=z_(Ut,Qt)}else eh(1);if(Je>jt){mt&&eh(0);break}}xt&&tt(it+131072);for(var or=(1<<sr)-1,Ir=(1<<Qt)-1,vn=Je;;vn=Je){var xn=(lt=Pt[L1(_e,Je)&or])>>4;if((Je+=15&lt)>jt){mt&&eh(0);break}if(lt||eh(2),xn<256)Re[it++]=xn;else{if(xn==256){vn=Je,Pt=null;break}var Jr=xn-254;xn>264&&(Jr=Qu(_e,Je,(1<<(bn=WI[on=xn-257]))-1)+YI[on],Je+=bn);var Kn=Mt[L1(_e,Je)&Ir],fi=Kn>>4;if(Kn||eh(3),Je+=15&Kn,Ut=zB[fi],fi>3){var bn=HI[fi];Ut+=L1(_e,Je)&(1<<bn)-1,Je+=bn}if(Je>jt){mt&&eh(0);break}xt&&tt(it+131072);var Ni=it+Jr;if(it<Ut){var xi=0-Ut,Hn=Math.min(Ut,Ni);for(xi+it<0&&eh(3);it<Hn;++it)Re[it]=(void 0)[xi+it]}for(;it<Ni;++it)Re[it]=Re[it-Ut]}}Ce.l=Pt,Ce.p=vn,Ce.b=it,Ce.f=_t,Pt&&(_t=1,Ce.m=sr,Ce.d=Mt,Ce.n=Qt)}while(!_t);return it!=Re.length&&at?(yt=Re,((At=it)==null||At>yt.length)&&(At=yt.length),new _c(yt.subarray(0,At))):Re.subarray(0,it)}(ue.subarray(X,-8),{i:2},new _c(((ne=ue)[(de=ne.length)-4]|ne[de-3]<<8|ne[de-2]<<16|ne[de-1]<<24)>>>0))));var ne,de,ue,X;const se=VB[re];if(!se)throw new Error(`Unhandled codec: ${re}`);const he=new globalThis.DecompressionStream(se);return new Response(new Blob([H]).stream().pipeThrough(he)).arrayBuffer().then(_e=>new Uint8Array(_e))}(z,O).then(H=>(function(re,ne){re.readFields(PB,ne)}(new z1(H),U),new GB[w](U.buffer))),V.then(H=>{for(let re=M.length-1;re>=0;re--)switch(M[re]){case"delta_filter":MB(H,T);break;case"zigzag_filter":OB(H);break;case"bitshuffle_filter":DB(H,w);break;default:throw new ou(`Unhandled filter "${M[re]}"`)}return{layerName:h,blockIndex:A,data:H}}).catch(H=>{throw H})}))},qt(tP,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),qt(Cv,"MapboxRasterTile"),qt(eP,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let N_,F1,th,_g,N1,yg=null;function rP(){return li(self)&&self.worker.dracoUrl?self.worker.dracoUrl:F1||Wi.DRACO_URL}function nP(){if(li(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(_g)return _g;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return _g=WebAssembly.validate(a)?Wi.MESHOPT_SIMD_URL:Wi.MESHOPT_URL,_g}const Mv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},qB={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},B_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function iP(a,t,i){const c=i.json.bufferViews.length,h=i.buffers.length;t.bufferView=c,i.json.bufferViews[c]={buffer:h,byteLength:a.byteLength},i.buffers[h]=a}const B1="KHR_draco_mesh_compression";function WB(a,t){const i=a.extensions&&a.extensions[B1];if(!i)return;const c=new th.Decoder,h=lP(t,i.bufferView),p=new th.Mesh;if(!c.DecodeArrayToMesh(h,h.byteLength,p))throw new Error("Failed to decode Draco mesh");const g=t.json.accessors[a.indices],w=Mv[g.componentType],T=g.count*w.BYTES_PER_ELEMENT,A=th._malloc(T);w===Uint16Array?c.GetTrianglesUInt16Array(p,T,A):c.GetTrianglesUInt32Array(p,T,A),iP(th.memory.buffer.slice(A,A+T),g,t),th._free(A);for(const M of Object.keys(i.attributes)){const O=c.GetAttributeByUniqueId(p,i.attributes[M]),z=t.json.accessors[a.attributes[M]],U=qB[z.componentType],V=z.count*B_[z.type]*Mv[z.componentType].BYTES_PER_ELEMENT,H=th._malloc(V);c.GetAttributeDataArrayForAllPoints(p,O,th[U],V,H),iP(th.memory.buffer.slice(H,H+V),z,t),th._free(H)}c.destroy(),p.destroy(),delete a.extensions[B1]}const Ov="EXT_meshopt_compression";function HB(a,t){if(!a.extensions||!a.extensions[Ov])return;const i=a.extensions[Ov],c=new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),h=new Uint8Array(i.count*i.byteStride);N1.decodeGltfBuffer(h,i.count,i.byteStride,c,i.mode,i.filter),a.buffer=t.buffers.length,a.byteOffset=0,t.buffers[a.buffer]=h.buffer,delete a.extensions[Ov]}const oP=1179937895,aP=new TextDecoder("utf8");function sP(a,t){return new URL(a,t).href}function ZB(a,t,i,c){return fetch(sP(a.uri,c)).then(h=>h.arrayBuffer()).then(h=>{t.buffers[i]=h})}function lP(a,t){const i=a.json.bufferViews[t];return new Uint8Array(a.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function XB(a,t,i,c){if(a.uri){const h=sP(a.uri,c);return fetch(h).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{t.images[i]=p})}if(a.bufferView!==void 0){const h=lP(t,a.bufferView),p=new Blob([h],{type:a.mimeType});return createImageBitmap(p).then(g=>{t.images[i]=g})}}function cP(a,t=0,i){const c={json:null,images:[],buffers:[]};if(new Uint32Array(a,t,1)[0]===oP){const M=new Uint32Array(a,t);let O=2;const z=(M[O++]>>2)-3,U=M[O++]>>2;if(O++,c.json=JSON.parse(aP.decode(M.subarray(O,O+U))),O+=U,O<z){const V=M[O++];O++;const H=t+(O<<2);c.buffers[0]=a.slice(H,H+V)}}else c.json=JSON.parse(aP.decode(new Uint8Array(a,t)));const{buffers:h,images:p,meshes:g,extensionsUsed:w,bufferViews:T}=c.json;let A=Promise.resolve();if(h){const M=[];for(let O=0;O<h.length;O++){const z=h[O];z.uri?M.push(ZB(z,c,O,i)):c.buffers[O]||(c.buffers[O]=null)}A=Promise.all(M)}return A.then(()=>{const M=[],O=w&&w.includes(B1),z=w&&w.includes(Ov);if(O&&M.push(function(){if(!th)return N_??(N_=function(U){let V,H=null;function re(){V=new Uint8Array(H.buffer)}function ne(){throw new Error("Unexpected Draco error.")}const de={a:{a:ne,d:function(ue,X,se){return V.copyWithin(ue,X,X+se)},c:function(ue){const X=V.length,se=Math.max(ue>>>0,Math.ceil(1.2*X)),he=Math.ceil((se-X)/65536);try{return H.grow(he),re(),!0}catch{return!1}},b:ne}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(U,de):U.then(ue=>ue.arrayBuffer()).then(ue=>WebAssembly.instantiate(ue,de))).then(ue=>{const{Rb:X,Qb:se,P:he,T:_e,X:Ce,Ja:Re,La:Ne,Qa:$e,Va:at,Wa:xt,eb:mt,jb:yt,f:At,e:tt,yb:_t,zb:Je,Ab:it,Bb:Pt,Db:Mt,Gb:sr}=ue.instance.exports;H=tt;const Qt=(()=>{let jt=0,It=0,Lr=0,rr=0;return nr=>{Lr&&(X(rr),X(jt),It+=Lr,Lr=jt=0),jt||(It+=128,jt=se(It));const Cr=nr.length+7&-8;let Gr=jt;Cr>=It&&(Lr=Cr,Gr=rr=se(Cr));for(let Xr=0;Xr<nr.length;Xr++)V[Gr+Xr]=nr[Xr];return Gr}})();return re(),At(),{memory:tt,_free:X,_malloc:se,Mesh:class{constructor(){this.ptr=he()}destroy(){_e(this.ptr)}},Decoder:class{constructor(){this.ptr=Re()}destroy(){yt(this.ptr)}DecodeArrayToMesh(jt,It,Lr){const rr=Qt(jt),nr=Ne(this.ptr,rr,It,Lr.ptr);return!!Ce(nr)}GetAttributeByUniqueId(jt,It){return{ptr:$e(this.ptr,jt.ptr,It)}}GetTrianglesUInt16Array(jt,It,Lr){at(this.ptr,jt.ptr,It,Lr)}GetTrianglesUInt32Array(jt,It,Lr){xt(this.ptr,jt.ptr,It,Lr)}GetAttributeDataArrayForAllPoints(jt,It,Lr,rr,nr){mt(this.ptr,jt.ptr,It.ptr,Lr,rr,nr)}},DT_INT8:_t(),DT_UINT8:Je(),DT_INT16:it(),DT_UINT16:Pt(),DT_UINT32:Mt(),DT_FLOAT32:sr()}})}(fetch(rP())),N_.then(U=>{th=U,N_=void 0}))}()),z&&M.push(function(){if(N1)return;const U=function(V){let H;const re=WebAssembly.instantiateStreaming(V,{}).then(ue=>{H=ue.instance,H.exports.__wasm_call_ctors()}),ne={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},de={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:re,supported:!0,decodeGltfBuffer(ue,X,se,he,_e,Ce){(function(Re,Ne,$e,at,xt,mt,yt){const At=Re.exports.sbrk,tt=at+3&-4,_t=At(tt*xt),Je=At(mt.length),it=new Uint8Array(Re.exports.memory.buffer);it.set(mt,Je);const Pt=Ne(_t,at,xt,Je,mt.length);if(Pt===0&&yt&&yt(_t,tt,xt),$e.set(it.subarray(_t,_t+at*xt)),At(_t-At(0)),Pt!==0)throw new Error(`Malformed buffer data: ${Pt}`)})(H,H.exports[de[_e]],ue,X,se,he,H.exports[ne[Ce]])}}}(fetch(nP()));return U.ready.then(()=>{N1=U})}()),p)for(let U=0;U<p.length;U++)M.push(XB(p[U],c,U,i));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(O&&g)for(const{primitives:U}of g)for(const V of U)WB(V,c);if(z&&g&&T)for(const U of T)HB(U,c);return c})})}function vm(a,t){const i=a.json.bufferViews[t.bufferView],c=Mv[t.componentType];return new c(a.buffers[i.buffer],(t.byteOffset||0)+(i.byteOffset||0),t.count*(i.byteStride&&i.byteStride!==B_[t.type]*c.BYTES_PER_ELEMENT?i.byteStride/c.BYTES_PER_ELEMENT:B_[t.type]))}function j1(a,t,i,c){const h=Mv[t.componentType],p=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),g=a.json.bufferViews[t.bufferView],w=g.byteStride?g.byteStride/h.BYTES_PER_ELEMENT:B_[t.type],T=i.float32,A=T.length/i.capacity;for(let M=0,O=0;M<t.count*w;M+=w,O+=A)for(let z=0;z<A;z++)T[O+z]=c[M+z]*p;i._trim()}function YB(a,t,i){const c=a.indices,h=a.attributes,p={};p.indexArray=new to;const g=t.json.accessors[c],w=g.count/3;p.indexArray.reserve(w);const T=vm(t,g);for(let z=0;z<w;z++)p.indexArray.emplaceBack(T[3*z],T[3*z+1],T[3*z+2]);p.indexArray._trim(),p.vertexArray=new Ys;const A=t.json.accessors[h.POSITION];p.vertexArray.reserve(A.count);const M=vm(t,A);for(let z=0;z<A.count;z++)p.vertexArray.emplaceBack(M[3*z],M[3*z+1],M[3*z+2]);if(p.vertexArray._trim(),p.aabb=new yi(A.min,A.max),p.centroid=function(z,U){const V=[0,0,0],H=z.length;if(H>0){for(let re=0;re<H;re++){const ne=3*z[re];V[0]+=U[ne],V[1]+=U[ne+1],V[2]+=U[ne+2]}V[0]/=H,V[1]/=H,V[2]/=H}return V}(T,M),h.COLOR_0!==void 0){const z=t.json.accessors[h.COLOR_0],U=B_[z.type],V=vm(t,z);p.colorArray=U===3?new Ys:new Bo,p.colorArray.resize(z.count),j1(t,z,p.colorArray,V)}if(h.NORMAL!==void 0){p.normalArray=new Ys;const z=t.json.accessors[h.NORMAL];p.normalArray.resize(z.count);const U=vm(t,z);j1(t,z,p.normalArray,U)}if(h.TEXCOORD_0!==void 0&&i.length>0){p.texcoordArray=new Qc;const z=t.json.accessors[h.TEXCOORD_0];p.texcoordArray.resize(z.count);const U=vm(t,z);j1(t,z,p.texcoordArray,U)}if(h._FEATURE_ID_RGBA4444!==void 0){const z=t.json.accessors[h._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=vm(t,z))}h._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(vm(t,t.json.accessors[h._FEATURE_RGBA4444]).buffer));const O=a.material;return p.material=function(z,U){const{emissiveFactor:V=[0,0,0],alphaMode:H="OPAQUE",alphaCutoff:re=.5,normalTexture:ne,occlusionTexture:de,emissiveTexture:ue,doubleSided:X}=z,{baseColorFactor:se=[1,1,1,1],metallicFactor:he=1,roughnessFactor:_e=1,baseColorTexture:Ce,metallicRoughnessTexture:Re}=z.pbrMetallicRoughness||{},Ne=de?U[de.index]:void 0;if(de&&de.extensions&&de.extensions.KHR_texture_transform&&Ne){const $e=de.extensions.KHR_texture_transform;Ne.offsetScale=[$e.offset[0],$e.offset[1],$e.scale[0],$e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new dn(...se),metallicFactor:he,roughnessFactor:_e,baseColorTexture:Ce?U[Ce.index]:void 0,metallicRoughnessTexture:Re?U[Re.index]:void 0},doubleSided:X,emissiveFactor:V,alphaMode:H,alphaCutoff:re,normalTexture:ne?U[ne.index]:void 0,occlusionTexture:Ne,emissionTexture:ue?U[ue.index]:void 0,defined:z.defined===void 0}}(O!==void 0?t.json.materials[O]:{defined:!1},i),p}function uP(a,t,i){const{matrix:c,rotation:h,translation:p,scale:g,mesh:w,extras:T,children:A}=a,M={};if(M.matrix=c||function(O,z,U,V){var H=z[0],re=z[1],ne=z[2],de=z[3],ue=H+H,X=re+re,se=ne+ne,he=H*ue,_e=H*X,Ce=H*se,Re=re*X,Ne=re*se,$e=ne*se,at=de*ue,xt=de*X,mt=de*se,yt=V[0],At=V[1],tt=V[2];return O[0]=(1-(Re+$e))*yt,O[1]=(_e+mt)*yt,O[2]=(Ce-xt)*yt,O[3]=0,O[4]=(_e-mt)*At,O[5]=(1-(he+$e))*At,O[6]=(Ne+at)*At,O[7]=0,O[8]=(Ce+xt)*tt,O[9]=(Ne-at)*tt,O[10]=(1-(he+Re))*tt,O[11]=0,O[12]=U[0],O[13]=U[1],O[14]=U[2],O[15]=1,O}([],h||[0,0,0,1],p||[0,0,0],g||[1,1,1]),w!==void 0){M.meshes=i[w];const O=M.anchor=[0,0];for(const z of M.meshes){const{min:U,max:V}=z.aabb;O[0]+=U[0]+V[0],O[1]+=U[1]+V[1]}O[0]=Math.floor(O[0]/M.meshes.length/2),O[1]=Math.floor(O[1]/M.meshes.length/2)}if(T&&(T.id&&(M.id=T.id),T.lights&&(M.lights=function(O){if(!O.length)return[];const z=function(ne){const de=atob(ne),ue=new Uint8Array(de.length);for(let X=0;X<de.length;X++)ue[X]=de.codePointAt(X);return ue}(O),U=[],V=z.length/24,H=new Uint16Array(z.buffer),re=new Float32Array(z.buffer);for(let ne=0;ne<V;ne++){const de=H[2*ne*6]/30,ue=H[2*ne*6+1]/30,X=H[2*ne*6+10]/100,se=re[6*ne+1],he=re[6*ne+2],_e=re[6*ne+3],Ce=re[6*ne+4],Re=_e-se,Ne=Ce-he,$e=Math.hypot(Re,Ne);U.push({pos:[se+.5*Re,he+.5*Ne,ue],normal:[Ne/$e,-Re/$e,0],width:$e,height:de,depth:X,points:[se,he,_e,Ce]})}return U}(T.lights))),A){const O=[];for(const z of A)O.push(uP(t.json.nodes[z],t,i));M.children=O}return M}function KB(a){if(a.vertices.length===0||a.indices.length===0)return null;const t=new Gx(a.vertices,a.indices,8,256),[i,c]=[t.min.clone(),t.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:t,min:i,max:c}}function JB(a){if(!a.extras||!a.extras.ground)return null;const t=a.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const i=t[0];if(!i||!Array.isArray(i)||i.length===0)return null;const c=[];for(const g of i){if(!Array.isArray(g)||g.length!==2)continue;const w=g[0],T=g[1];typeof w=="number"&&typeof T=="number"&&c.push(new Dt(w,T))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let h=0;for(let g=0;g<c.length;g++){const w=c[g],T=c[(g+1)%c.length],A=c[(g+2)%c.length];h+=(w.x-T.x)*(A.y-T.y)-(A.x-T.x)*(w.y-T.y)}h>0&&c.reverse();const p=Fl(c.flatMap(g=>[g.x,g.y]),[]);return p.length===0?null:{vertices:c,indices:p}}function QB(a,t){const i=[],c=[];let h=0;const p=[];for(const g of a){h=i.length;const w=g.vertexArray.float32,T=g.indexArray.uint16;for(let A=0;A<g.vertexArray.length;A++)p[0]=w[3*A+0],p[1]=w[3*A+1],p[2]=w[3*A+2],Nt(p,p,t),i.push(new Dt(p[0],p[1]));for(let A=0;A<3*g.indexArray.length;A++)c.push(T[A]+h)}if(c.length%3!=0)return null;for(let g=0;g<c.length;g+=3){const w=i[c[g+0]],T=i[c[g+1]],A=i[c[g+2]];(w.x-T.x)*(A.y-T.y)-(A.x-T.x)*(w.y-T.y)>0&&([c[g+1],c[g+2]]=[c[g+2],c[g+1]])}return{vertices:i,indices:c}}function hP(a){const t=function(T,A){const M=[],O=WebGL2RenderingContext;if(T.json.textures)for(const z of T.json.textures){const U={magFilter:O.LINEAR,minFilter:O.NEAREST,wrapS:O.REPEAT,wrapT:O.REPEAT};z.sampler!==void 0&&Object.assign(U,T.json.samplers[z.sampler]),M.push({image:A[z.source],sampler:U,uploaded:!1})}return M}(a,a.images),i=function(T,A){const M=[];for(const O of T.json.meshes){const z=[];for(const U of O.primitives)z.push(YB(U,T,A));M.push(z)}return M}(a,t),{scenes:c,scene:h,nodes:p}=a.json,g=c?c[h||0].nodes:p,w=[];for(const T of g)w.push(uP(p[T],a,i));return function(T,A,M){const O={},z=new Set;for(let U=0;U<T.length;U++){const V=M[A[U]];if(!V.extras)continue;const H=V.extras["mapbox:footprint:version"],re=V.extras["mapbox:footprint:id"];(H||re)&&z.add(U),H==="1.0.0"&&re&&(O[re]=U)}for(let U=0;U<T.length;U++){if(z.has(U))continue;const V=T[U],H=M[A[U]];if(!H.extras)continue;let re=null;V.id in O&&(re=QB(T[O[V.id]].meshes,V.matrix)),re||(re=JB(H)),re&&(V.footprint=KB(re))}if(z.size>0){const U=Array.from(z.values()).sort((V,H)=>V-H);for(let V=U.length-1;V>=0;V--)T.splice(U[V],1)}}(w,g,a.json.nodes),w}function ej(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const t=a.vertexArray.float32,i=a.aabb.min[0]-1,c=a.aabb.min[1]-1,h=gm/(a.aabb.max[0]-i+2),p=gm/(a.aabb.max[1]-c+2);for(let g=0;g<t.length;g+=3){const w=t[g+2],T=(t[g+0]-i)*h|0,A=(t[g+1]-c)*p|0;w>a.heightmap[A*gm+T]&&(a.heightmap[A*gm+T]=w)}}function tj(a,t){const i={};i.indexArray=new to,i.indexArray.reserve(4*a.length),i.vertexArray=new Ys,i.vertexArray.reserve(10*a.length),i.colorArray=new Bo,i.vertexArray.reserve(10*a.length);let c=0;for(const g of a){const w=Math.min(10,Math.max(4,1.3*g.height))*t,T=[-g.normal[1],g.normal[0],0],A=Math.min(.29,.1*g.width/g.depth),M=g.width-2*g.depth*t*(A+.01),O=ot([],g.pos,T,M/2),z=ot([],g.pos,T,-M/2),U=[O[0],O[1],O[2]+g.height],V=[z[0],z[1],z[2]+g.height],H=ot([],g.normal,T,A);Ft(H,H,w);const re=ot([],g.normal,T,-A);Ft(re,re,w),Ar(H,O,H),Ar(re,z,re),O[2]+=.1,z[2]+=.1,i.vertexArray.emplaceBack(H[0],H[1],H[2]),i.vertexArray.emplaceBack(re[0],re[1],re[2]),i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(z[0],z[1],z[2]),i.vertexArray.emplaceBack(U[0],U[1],U[2]),i.vertexArray.emplaceBack(V[0],V[1],V[2]),i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(z[0],z[1],z[2]),i.vertexArray.emplaceBack(H[0],H[1],H[2]),i.vertexArray.emplaceBack(re[0],re[1],re[2]);const ne=M/w/2;i.colorArray.emplaceBack(-ne-A,-1,ne,.8),i.colorArray.emplaceBack(ne+A,-1,ne,.8),i.colorArray.emplaceBack(-ne,0,ne,1.3),i.colorArray.emplaceBack(ne,0,ne,1.3),i.colorArray.emplaceBack(ne+A,-.8,ne,.7),i.colorArray.emplaceBack(ne+A,-.8,ne,.7),i.colorArray.emplaceBack(0,0,ne,1.3),i.colorArray.emplaceBack(0,0,ne,1.3),i.colorArray.emplaceBack(ne+A,-1.2,ne,.8),i.colorArray.emplaceBack(ne+A,-1.2,ne,.8),i.indexArray.emplaceBack(6+c,4+c,8+c),i.indexArray.emplaceBack(7+c,9+c,5+c),i.indexArray.emplaceBack(0+c,1+c,2+c),i.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}const h={defined:!0,emissiveFactor:[0,0,0]},p={};return p.baseColorFactor=dn.white,h.pbrMetallicRoughness=p,i.material=h,i.aabb=new yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class dP{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const c=t[i];this._stringToNumber[c]=i,this._numberToString[i]=c}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const rj=["id","tile","layer","source","sourceLayer","state"];class vg{constructor(t,i,c,h,p){this.type="Feature",this._vectorTileFeature=t,this._z=i,this._x=c,this._y=h,this.properties=t.properties,this.id=p}clone(){const t=new vg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state=Object.assign({},this.state)),this.layer&&(t.layer=Object.assign({},this.layer)),this.source&&(t.source=this.source),this.sourceLayer&&(t.sourceLayer=this.sourceLayer),t}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of rj)this[i]!==void 0&&(t[i]=this[i]);return t}}class fP{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Hc(zt,16,0),this.featureIndexArray=new Xf,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,i,c,h,p,g=0,w=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,h,p,g);const A=this.grid;for(let M=0;M<i.length;M++){const O=i[M],z=[1/0,1/0,-1/0,-1/0];for(let U=0;U<O.length;U++){const V=O[U];z[0]=Math.min(z[0],V.x),z[1]=Math.min(z[1],V.y),z[2]=Math.max(z[2],V.x),z[3]=Math.max(z[3],V.y)}w!==0&&(z[0]-=w,z[1]-=w,z[2]+=w,z[3]+=w),z[0]<zt&&z[1]<zt&&z[2]>=0&&z[3]>=0&&A.insert(T,z[0],z[1],z[2],z[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new op.VectorTile(new Jy(this.rawTileData)).layers,this.sourceLayerCoder=new dP(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,i){const{tilespaceGeometry:c,transform:h,tileTransform:p,pixelPosMatrix:g,availableImages:w}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const T=c.bufferedTilespaceBounds,A=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(U,V,H,re)=>no(c.bufferedTilespaceGeometry,U,V,H,re));A.sort(nj);let M=null;h.elevation&&A.length>0&&(M=fg.create(h.elevation,this.tileID));const O={};let z;for(let U=0;U<A.length;U++){const V=A[U];if(V===z)continue;z=V;const H=this.featureIndexArray.get(V);let re=null;this.is3DTile?this.loadMatchingModelFeature(O,H,t,c,h):this.loadMatchingFeature(O,H,t,w,(ne,de,ue,X=0)=>(re||(re=Yt(ne,this.tileID.canonical,p)),de.queryIntersectsFeature(c,ne,ue,re,this.z,h,g,M,X)))}return O}loadMatchingFeature(t,i,c,h,p){const{featureIndex:g,bucketIndex:w,sourceLayerIndex:T,layoutVertexArrayOffset:A}=i,M=this.bucketLayerIDs[w],O=c.layers,z=Object.keys(O);if(z.length&&!function(ne,de){for(let ue=0;ue<ne.length;ue++)if(de.indexOf(ne[ue])>=0)return!0;return!1}(z,M))return;const U=c.sourceCache,V=this.sourceLayerCoder.decode(T),H=this.vtLayers[V].feature(g),re=this.getId(H,V);for(let ne=0;ne<M.length;ne++){const de=M[ne];if(!O[de])continue;const{styleLayer:ue,targets:X}=O[de];let se={};re!==void 0&&(se=U.getFeatureState(ue.sourceLayer,re));const he=!p||p(H,ue,se,A);if(!he)continue;const _e=new vg(H,this.z,this.x,this.y,re);_e.tile=this.tileID.canonical,_e.state=se;let Ce=this.serializedLayersCache.get(de);Ce||(Ce=ue.serialize(),Ce.id=de,this.serializedLayersCache.set(de,Ce)),_e.source=Ce.source,_e.sourceLayer=Ce["source-layer"],_e.layer=Ze({},Ce),_e.layer.paint=pP(Ce.paint,ue.paint,H,se,h),_e.layer.layout=pP(Ce.layout,ue.layout,H,se,h);let Re=!1;for(const Ne of X){this.updateFeatureProperties(_e,Ne);const{filter:$e}=Ne;if($e){if(H.properties=_e.properties,$e.needGeometry){const at=tr(H,!0);if(!$e.filter(new $n(this.tileID.overscaledZ),at,this.tileID.canonical))continue}else if(!$e.filter(new $n(this.tileID.overscaledZ),H))continue}Re=!0,Ne.targetId&&this.addFeatureVariant(_e,Ne)}Re&&this.appendToResult(t,de,g,_e,he)}}loadMatchingModelFeature(t,i,c,h,p){const g=this.bucketLayerIDs[0][0],w=c.layers;if(!w[g])return;const{styleLayer:T,targets:A}=w[g];if(T.type!=="model")return;const M=h.tile,O=i.featureIndex,z=M.getBucket(T);if(!(z&&z instanceof xv))return;const U=function(Ce,Re,Ne,$e){const at=Ce.getNodesInfo()[Re];if(at.hiddenByReplacement||!at.node.meshes)return;let xt=Number.MAX_VALUE;const mt=at.node,yt=Ne.tile,At=$e.calculatePosMatrix(yt.tileID.toUnwrapped(),$e.worldSize),tt=at.evaluatedScale;let _t=0;$e.elevation&&mt.elevation&&(_t=mt.elevation*$e.elevation.exaggeration()),ge(At,At,[(mt.anchor?mt.anchor[0]:0)*(tt[0]-1),(mt.anchor?mt.anchor[1]:0)*(tt[1]-1),_t]),ke(At,At,tt);const Je=Ne.queryGeometry,it=Je.isPointQuery()?Je.screenBounds:Je.screenGeometry,Pt=function(sr){const Qt=xe([],At,sr.matrix);xe(Qt,$e.expandedFarZProjMatrix,Qt);for(let jt=0;jt<sr.meshes.length;++jt){const It=sr.meshes[jt];if(jt===sr.lightMeshIndex)continue;const Lr=fI(it,$e,Qt,It.aabb);Lr!=null&&(xt=Math.min(Lr,xt))}if(sr.children)for(const jt of sr.children)Pt(jt)};if(Pt(mt),xt===Number.MAX_VALUE)return;const Mt=new K(0,0);return TI(yt.tileID.canonical,Mt,at.node.anchor[0],at.node.anchor[1]),{intersectionZ:xt,position:Mt,feature:at.feature}}(z,O,h,p);if(!U)return;const{z:V,x:H,y:re}=M.tileID.canonical,{feature:ne,intersectionZ:de,position:ue}=U;let X={};ne.id!==void 0&&(X=c.sourceCache.getFeatureState(T.sourceLayer,ne.id));const se=new vg({},V,H,re,ne.id);se.tile=this.tileID.canonical,se.state=X,se.properties=ne.properties,se.geometry={type:"Point",coordinates:[ue.lng,ue.lat]};let he=this.serializedLayersCache.get(g);he||(he=T.serialize(),he.id=g,this.serializedLayersCache.set(g,he)),se.source=he.source,se.sourceLayer=he["source-layer"],se.layer=Ze({},he);let _e=!1;for(const Ce of A){this.updateFeatureProperties(se,Ce);const{filter:Re}=Ce;if(Re){if(ne.properties=se.properties,Re.needGeometry){if(!Re.filter(new $n(this.tileID.overscaledZ),ne,this.tileID.canonical))continue}else if(!Re.filter(new $n(this.tileID.overscaledZ),ne))continue}_e=!0,Ce.targetId&&this.addFeatureVariant(se,Ce)}_e&&this.appendToResult(t,g,O,se,de)}updateFeatureProperties(t,i,c){if(i.properties){const h={};for(const p in i.properties){const g=i.properties[p].evaluate({zoom:this.z},t._vectorTileFeature,t.state,t.tile,c);g!=null&&(h[p]=g)}t.properties=h}}addFeatureVariant(t,i,c){const h={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(h.properties=t.properties),t.variants=t.variants||{},t.variants[i.targetId]=t.variants[i.targetId]||[],t.variants[i.targetId].push(h)}appendToResult(t,i,c,h,p){let g=t[i];g===void 0&&(g=t[i]=[]),g.push({featureIndex:c,feature:h,intersectionZ:p})}lookupSymbolFeatures(t,i,c,h,p){const g={};this.loadVTLayers();for(const w of t)this.loadMatchingFeature(g,{bucketIndex:i,sourceLayerIndex:c,featureIndex:w,layoutVertexArrayOffset:0},h,p);return g}loadFeature(t){const{featureIndex:i,sourceLayerIndex:c}=t;this.loadVTLayers();const h=this.sourceLayerCoder.decode(c),p=this.vtFeatures[h];if(p[i])return p[i];const g=this.vtLayers[h].feature(i);return p[i]=g,g}hasLayer(t){for(const i of this.bucketLayerIDs)for(const c of i)if(t===c)return!0;return!1}getId(t,i){let c=t.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const p=Bu(h);if(p.result!=="success"){const g=p.value.map(w=>`${w.key}: ${w.message}`).join(", ");return void tn(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=p.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Jl),c=this.promoteIdExpression.evaluate({zoom:0},t)}else c=t.properties[h];typeof c=="boolean"&&(c=Number(c))}return c}}function pP(a,t,i,c,h){return wr(a,(p,g)=>{const w=t instanceof Xs?t.get(g):null;return w&&w.evaluate?w.evaluate(i,c,void 0,h):w})}function nj(a,t){return t-a}qt(fP,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const mP=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class U1{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,c]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=c>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=mP[15&c];if(!p)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new U1(w,g,p,t)}constructor(t,i=64,c=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const p=mP.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-w%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${c}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+T,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+w+T),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+T,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=i,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return V1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,c,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:w}=this,T=[0,p.length-1,0],A=[];for(;T.length;){const M=T.pop()||0,O=T.pop()||0,z=T.pop()||0;if(O-z<=w){for(let re=z;re<=O;re++){const ne=g[2*re],de=g[2*re+1];ne>=t&&ne<=c&&de>=i&&de<=h&&A.push(p[re])}continue}const U=z+O>>1,V=g[2*U],H=g[2*U+1];V>=t&&V<=c&&H>=i&&H<=h&&A.push(p[U]),(M===0?t<=V:i<=H)&&(T.push(z),T.push(U-1),T.push(1-M)),(M===0?c>=V:h>=H)&&(T.push(U+1),T.push(O),T.push(1-M))}return A}within(t,i,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:g}=this,w=[0,h.length-1,0],T=[],A=c*c;for(;w.length;){const M=w.pop()||0,O=w.pop()||0,z=w.pop()||0;if(O-z<=g){for(let re=z;re<=O;re++)_P(p[2*re],p[2*re+1],t,i)<=A&&T.push(h[re]);continue}const U=z+O>>1,V=p[2*U],H=p[2*U+1];_P(V,H,t,i)<=A&&T.push(h[U]),(M===0?t-c<=V:i-c<=H)&&(w.push(z),w.push(U-1),w.push(1-M)),(M===0?t+c>=V:i+c>=H)&&(w.push(U+1),w.push(O),w.push(1-M))}return T}}function V1(a,t,i,c,h,p){if(h-c<=i)return;const g=c+h>>1;gP(a,t,g,c,h,p),V1(a,t,i,c,g-1,1-p),V1(a,t,i,g+1,h,1-p)}function gP(a,t,i,c,h,p){for(;h>c;){if(h-c>600){const A=h-c+1,M=i-c+1,O=Math.log(A),z=.5*Math.exp(2*O/3),U=.5*Math.sqrt(O*z*(A-z)/A)*(M-A/2<0?-1:1);gP(a,t,i,Math.max(c,Math.floor(i-M*z/A+U)),Math.min(h,Math.floor(i+(A-M)*z/A+U)),p)}const g=t[2*i+p];let w=c,T=h;for(j_(a,t,c,i),t[2*h+p]>g&&j_(a,t,c,h);w<T;){for(j_(a,t,w,T),w++,T--;t[2*w+p]<g;)w++;for(;t[2*T+p]>g;)T--}t[2*c+p]===g?j_(a,t,c,T):(T++,j_(a,t,T,h)),T<=i&&(c=T+1),i<=T&&(h=T-1)}}function j_(a,t,i,c){$1(a,i,c),$1(t,2*i,2*c),$1(t,2*i+1,2*c+1)}function $1(a,t,i){const c=a[t];a[t]=a[i],a[i]=c}function _P(a,t,i,c){const h=a-i,p=t-c;return h*h+p*p}o.$=ca,o.A=fl,o.B=vs,o.C=Pl,o.D=pg,o.E=ml,o.F=2,o.G=b_,o.H=IA,o.I=Ca,o.J=class extends yv{},o.K=Pr,o.L=Tu,o.M=us,o.N=Rd,o.O=Qi,o.P=Dt,o.Q=Df,o.R=Mc,o.S=Nu,o.T=y1,o.U=hs,o.V=yv,o.W=jh,o.X=Bu,o.Y=Ch,o.Z=Vc,o._=Uc,o.a=function(a){return Wi.API_CDN_URL_REGEX.test(a)},o.a$=Vt,o.a0=_h,o.a1=Ra,o.a2=Nh,o.a3=Es,o.a4=function(a){const t=a.value;let i=[];if(!t)return i;const c=Pr(t);return c!=="string"?(i=i.concat([new yv(a.key,t,`string expected, "${c}" found`)]),i):(w1(t,!0)||(i=i.concat([new yv(a.key,t,`invalid url "${t}"`)])),i)},o.a5=qe,o.a6=Xc,o.a7=Ri,o.a8=Ct,o.a9=class{constructor(a){this.specification=a}possiblyEvaluate(a,t){return hn(a.expression.evaluate(t))}interpolate(a,t,i){return{x:xr(a.x,t.x,i),y:xr(a.y,t.y,i),z:xr(a.z,t.z,i),azimuthal:xr(a.azimuthal,t.azimuthal,i),polar:xr(a.polar,t.polar,i)}}},o.aA=Oi,o.aB=Wn,o.aC=ft,o.aD=Fe,o.aE=x,o.aF=function(a,t){const i={};for(let c=0;c<t.length;c++){const h=t[c];h in a&&(i[h]=a[h])}return i},o.aG=ce,o.aH=we,o.aI=class{constructor(a){this.entries={},this.scheduler=a}request(a,t,i,c){const h=this.entries[a]=this.entries[a]||{callbacks:[]};if(h.result){const[p,g]=h.result;return this.scheduler?this.scheduler.add(()=>{c(p,g)},t):c(p,g),()=>{}}return h.callbacks.push(c),h.cancel||(h.cancel=i((p,g)=>{h.result=[p,g];for(const w of h.callbacks)this.scheduler?this.scheduler.add(()=>{w(p,g)},t):w(p,g);setTimeout(()=>delete this.entries[a],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==c),h.callbacks.length||(h.cancel(),delete this.entries[a]))}}},o.aJ=function(a,t,i){const c=JSON.stringify(a.request);return a.data&&(this.deduped.entries[c]={result:[null,a.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},h=>{const p=hl(a.request,(g,w,T,A)=>{g?h(g):w&&h(null,{vectorTile:i?void 0:new op.VectorTile(new Jy(w)),rawData:w,cacheControl:T,expires:A})});return()=>{p.cancel(),h()}},t)},o.aK=function(a){uh++,uh>Qa&&(a.getActor().send("enforceCacheSizeLimit",Xl),uh=0)},o.aL=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},o.aM=Zi,o.aN=rI,o.aO=lI,o.aP=tI,o.aQ=function(a,t){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let c=0;c<a.length;c++){const h=document.createElement("source");Yg(a[c])||(i.crossOrigin="Anonymous"),h.src=a[c],i.appendChild(h)}return{cancel:()=>{}}},o.aR=fv,o.aS=function(a){return fetch(a).then(t=>t.arrayBuffer()).then(t=>cP(t,0,a))},o.aT=hP,o.aU=class{constructor(a,t,i,c){this.id=a,this.position=t!=null?new K(t[0],t[1]):new K(0,0),this.orientation=i??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,t){if(xe(a.matrix,t,a.matrix),a.meshes)for(const i of a.meshes){const c=yi.applyTransformFast(i.aabb,a.matrix);this.aabb.encapsulate(c)}if(a.children)for(const i of a.children)this._applyTransformations(i,a.matrix)}computeBoundsAndApplyParent(){const a=oe([]);for(const t of this.nodes)this._applyTransformations(t,a)}computeModelMatrix(a,t,i,c,h,p,g=!1){vI(this.matrix,this,a.transform,this.position,t,i,c,h,p,g)}upload(a){if(!this.uploaded){for(const t of this.nodes)T1(t,a);for(const t of this.nodes)vv(t);this.uploaded=!0}}destroy(){for(const a of this.nodes)E1(a)}},o.aV=gr,o.aW=T_,o.aX=Ie,o.aY=Oe,o.aZ=Kc,o.a_=to,o.aa=$n,o.ab=Zs,o.ac=He,o.ad=Nt,o.ae=Dr,o.af=Be,o.ag=Xs,o.ah=ed,o.ai=xr,o.aj=zt,o.ak=yh,o.al=Q,o.am=dn,o.an=class{constructor(a){this.specification=a}possiblyEvaluate(a,t){return function([i,c]){const h=hn([1,i,c]);return{x:h.x,y:h.y,z:h.z}}(a.expression.evaluate(t))}interpolate(a,t,i){return{x:xr(a.x,t.x,i),y:xr(a.y,t.y,i),z:xr(a.z,t.z,i)}}},o.ao=function(a,t,i=0,c=!0){const h=new Dt(i,i),p=a.sub(h),g=t.add(h),w=[p,new Dt(g.x,p.y),g,new Dt(p.x,g.y)];return c&&w.push(p.clone()),w},o.ap=function(a,t){const i=[];for(let c=0;c<a.length;c++){const h=Ye(c-1,-1,a.length-1),p=Ye(c+1,-1,a.length-1),g=a[c],w=a[p],T=a[h].sub(g).unit(),A=w.sub(g).unit(),M=A.angleWithSep(T.x,T.y),O=T.add(A).unit().mult(-1*t/Math.sin(M/2));i.push(g.add(O))}return i},o.aq=UA,o.ar=no,o.as=function(a,t,i=0){return vr(((t.x-i)*a.scale-a.x)*zt,(t.y*a.scale-a.y)*zt,Xe(t.z,t.y))},o.at=We,o.au=Sr,o.av=el,o.aw=J2,o.ax=function(a){let t=1/0,i=1/0,c=-1/0,h=-1/0;for(const p of a)t=Math.min(t,p.x),i=Math.min(i,p.y),c=Math.max(c,p.x),h=Math.max(h,p.y);return{min:new Dt(t,i),max:new Dt(c,h)}},o.ay=Te,o.az=xe,o.b=function(a){return Wi.API_FONTS_REGEX.test(a)},o.b$=Ft,o.b0=Kd,o.b1=hv,o.b2=function(){Ua.isLoading()||Ua.isLoaded()||Hi()!=="deferred"||Nd()},o.b3=qu,o.b4=tr,o.b5=vg,o.b6=ji,o.b7=Yx,o.b8=$x,o.b9=Yt,o.bA=function(a,t){const{x:i,y:c}=a.point,h=ip(i,c,a.worldSize/a._pixelsPerMercatorPixel,0,0);return xe(h,h,l_(tl(t)))},o.bB=L,o.bC=function(a){return a[0]=0,a[1]=0,a[2]=0,a},o.bD=function(a,t){return Math.hypot(t[0]-a[0],t[1]-a[1],t[2]-a[2])},o.bE=kr,o.bF=ot,o.bG=Vr,o.bH=x_,o.bI=rl,o.bJ=i1,o.bK=function(a,t,i,c,h){const p=5*t+2;a.float32[p+0]=i,a.float32[p+1]=c,a.float32[p+2]=h},o.bL=uv,o.bM=Ky,o.bN=hr,o.bO=ia,o.bP=x2,o.bQ=pI,o.bR=E2,o.bS=A2,o.bT=l1,o.bU=RA,o.bV=n1,o.bW=U1,o.bX=Ye,o.bY=ii,o.bZ=function(a,t,i){i*=.5;var c=t[0],h=t[1],p=t[2],g=t[3],w=Math.sin(i),T=Math.cos(i);return a[0]=c*T+h*w,a[1]=h*T-c*w,a[2]=p*T+g*w,a[3]=g*T-p*w,a},o.b_=ti,o.ba=Cl,o.bb=Xd,o.bc=Mo,o.bd=Si,o.be=Fl,o.bf=m1,o.bg=function(a,t){const i=ed(t.zoom);if(i===0)return tl(a);const c=om(a),h=am(c),p=Te(c.getWest())*t.worldSize,g=Te(c.getEast())*t.worldSize,w=we(c.getNorth())*t.worldSize,T=we(c.getSouth())*t.worldSize,A=[p,w,0],M=[g,w,0],O=[p,T,0],z=[g,T,0],U=le([],t.globeMatrix);return Nt(A,A,U),Nt(M,M,U),Nt(O,O,U),Nt(z,z,U),h[0]=iu(h[0],O,i),h[1]=iu(h[1],z,i),h[2]=iu(h[2],M,i),h[3]=iu(h[3],A,i),yi.fromPoints(h)},o.bh=lm,o.bi=le,o.bj=Qh,o.bk=iu,o.bl=Ud,o.bm=Os,o.bn=pt,o.bo=ge,o.bp=Cv,o.bq=Jy,o.br=hl,o.bs=function(a,t){const i=[];for(const c in a)c in t||i.push(c);return i},o.bt=ht,o.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bv=mi,o.bw=function(a){var t=new k(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},o.bx=oe,o.by=nt,o.bz=ie,o.c=_u,o.c$=function(a){return a({pluginStatus:Fo,pluginURL:Al}),Vh.on("pluginStateChange",a),a},o.c0=jr,o.c1=fo,o.c2=function(a,t){return a[0]=-t[0],a[1]=-t[1],a[2]=-t[2],a[3]=t[3],a},o.c3=ir,o.c4=function(a,t,i,c,h){var p,g=1/Math.tan(t/2);return a[0]=g/i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=g,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,h!=null&&h!==1/0?(a[10]=(h+c)*(p=1/(c-h)),a[14]=2*h*c*p):(a[10]=-1,a[14]=-2*c),a},o.c5=function(a,t,i,c,h,p,g){var w=1/(t-i),T=1/(c-h),A=1/(p-g);return a[0]=-2*w,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*A,a[11]=0,a[12]=(t+i)*w,a[13]=(h+c)*T,a[14]=(g+p)*A,a[15]=1,a},o.c6=ye,o.c7=function(a,t,i){a[4*t+0]=i[0],a[4*t+1]=i[1],a[4*t+2]=i[2],a[4*t+3]=i[3]},o.c8=Ol,o.c9=Js,o.cA=gv,o.cB=Br,o.cC=cI,o.cD=function(a){const t=cI(a,!0);return L([],[t[0],t[1],t[4],t[5]])},o.cE=ke,o.cF=ds,o.cG=et,o.cH=function(a){const{x:t,y:i}=a.point,{lng:c,lat:h}=a._center;return ip(t,i,a.worldSize,c,h)},o.cI=qr,o.cJ=ae,o.cK=Qo,o.cL=S,o.cM=function(a,t,i){let c=0;for(let h=0;h<2;++h)a[h]>0&&(c+=(a[h]-0)*(a[h]-0)),t[h]<0&&(c+=(0-t[h])*(0-t[h]));return c},o.cN=45,o.cO=wf,o.cP=Ee,o.cQ=Jo,o.cR=function(a,t,i){const c=Math.sqrt(a*a+t*t+i*i),h=c>0?Math.acos(i/c)*Qe:0;let p=a!==0||t!==0?Math.atan2(-t,-a)*Qe+90:0;return p<0&&(p+=360),[c,p,h]},o.cS=vr,o.cT=Ve,o.cU=Ar,o.cV=yi,o.cW=hn,o.cX=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},o.cY=zr,o.cZ=w1,o.c_=function(a,t){return a.readFields(eB,{icons:[]},t)},o.ca=eu,o.cb=ro,o.cc=Ko,o.cd=K,o.ce=WA,o.cf=function(){var a=new k(4);return k!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},o.cg=function(a,t,i){var c=t[0],h=t[1],p=t[2],g=t[3],w=Math.sin(i),T=Math.cos(i);return a[0]=c*T+p*w,a[1]=h*T+g*w,a[2]=c*-w+p*T,a[3]=h*-w+g*T,a},o.ch=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]&&a[3]===t[3]},o.ci=Kt,o.cj=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},o.ck=oa,o.cl=Tn,o.cm=jo,o.cn=Ku,o.co=uI,o.cp=fn,o.cq=By,o.cr=function(a,t,i,c,h,p,g,w,T){if(T.name==="globe")return By(a,t,new fn(i,c,h),!1);const A=T_({z:i,x:c,y:h},T);return new yi([(p+A.x/A.scale)*t,t*(A.y/A.scale),g],[(p+A.x2/A.scale)*t,t*(A.y2/A.scale),w])},o.cs=function(a,t,i){return a[0]=Math.min(t[0],i[0]),a[1]=Math.min(t[1],i[1]),a[2]=Math.min(t[2],i[2]),a[3]=Math.min(t[3],i[3]),a},o.ct=function(a,t,i){return a[0]=Math.max(t[0],i[0]),a[1]=Math.max(t[1],i[1]),a[2]=Math.max(t[2],i[2]),a[3]=Math.max(t[3],i[3]),a},o.cu=function(a){const t=Math.round((a+45+360)%360/90)%4;return Se[t]},o.cv=je,o.cw=en,o.cx=E,o.cy=function(a){const t=oe(new Float64Array(16));xe(t,a.pixelMatrix,a.globeMatrix);const i=[0,j,0],c=[0,B,0];return Nt(i,i,t),Nt(c,c,t),[i[0]>0&&i[0]<=a.width&&i[1]>0&&i[1]<=a.height&&!m(a,new K(a.center.lat,90)),c[0]>0&&c[0]<=a.width&&c[1]>0&&c[1]<=a.height&&!m(a,new K(a.center.lat,-90))]},o.cz=function(a,t){const{scale:i}=a.tileTransform,c=i*zt/(a.tileSize*Math.pow(2,t.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return function(h,p,g){var w=p[1],T=p[2],A=p[3],M=g[0],O=g[1];return h[0]=p[0]*M,h[1]=w*M,h[2]=T*O,h[3]=A*O,h}(new Float32Array(4),t.inverseAdjustmentMatrix,[c,c])},o.d=function(a){return Wi.API_TILEJSON_REGEX.test(a)},o.d$=Gf,o.d0=bv,o.d1=cg,o.d2=a1,o.d3=Mn,o.d4=Is,o.d5=ma,o.d6=aa,o.d7=Nr,o.d8=function(a){const t=a.indexOf($h);return t>=0?a.slice(0,t):a},o.d9=function(a){return a.indexOf($h)>=0},o.dA=jy,o.dB=eo,o.dC=ko,o.dD=256,o.dE=function(a,t){const i=[0,0,0];return Nt(i,i,lm(tl(t.canonical))),Nt(i,i,a),i},o.dF=a=>({u_camera_to_center_distance:new ro(a),u_extrude_scale:new Ps(a),u_device_pixel_ratio:new ro(a),u_matrix:new Ol(a),u_inv_rot_matrix:new Ol(a),u_merc_center:new Js(a),u_tile_id:new eu(a),u_zoom_transition:new ro(a),u_up_dir:new eu(a),u_emissive_strength:new ro(a)}),o.dG=a=>({u_matrix:new Ol(a),u_pixels_to_tile_units:new Ps(a),u_device_pixel_ratio:new ro(a),u_width_scale:new ro(a),u_floor_width_scale:new ro(a),u_units_to_pixels:new Js(a),u_dash_image:new Ko(a),u_gradient_image:new Ko(a),u_image_height:new ro(a),u_texsize:new Js(a),u_tile_units_to_pixels:new ro(a),u_alpha_discard_threshold:new ro(a),u_trim_offset:new Js(a),u_trim_fade_range:new Js(a),u_trim_color:new Jo(a),u_emissive_strength:new ro(a),u_zbias_factor:new ro(a),u_tile_to_meter:new ro(a),u_ground_shadow_factor:new eu(a)}),o.dH=a=>({u_matrix:new Ol(a),u_texsize:new Js(a),u_pixels_to_tile_units:new Ps(a),u_device_pixel_ratio:new ro(a),u_width_scale:new ro(a),u_floor_width_scale:new ro(a),u_image:new Ko(a),u_units_to_pixels:new Js(a),u_tile_units_to_pixels:new ro(a),u_alpha_discard_threshold:new ro(a),u_trim_offset:new Js(a),u_trim_fade_range:new Js(a),u_trim_color:new Jo(a),u_emissive_strength:new ro(a),u_zbias_factor:new ro(a),u_tile_to_meter:new ro(a),u_ground_shadow_factor:new eu(a),u_pattern_transition:new ro(a)}),o.dI=Xh,o.dJ=oN,o.dK=ee,o.dL=(a,t,i,c,h,p)=>{const g=a.transform,w=g.projection.name==="globe";let T;if(p.paint.get("circle-pitch-alignment")==="map")if(w){const M=jy(g.zoom,t.canonical)*g._pixelsPerMercatorPixel;T=Float32Array.from([M,0,0,M])}else T=g.calculatePixelsToTileUnitsMatrix(i);else T=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(g.projection),u_matrix:a.translatePosMatrix(t.projMatrix,i,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ja.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:W,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(w){A.u_inv_rot_matrix=c,A.u_merc_center=h,A.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],A.u_zoom_transition=ed(g.zoom);const M=h[0]*zt,O=h[1]*zt;A.u_up_dir=g.projection.upVector(new fn(0,0,0),M,O)}return A},o.dM=rA,o.dN=Ma,o.dO=(a,t,i,c,h,p,g,w,T,A)=>{const M=a.transform,O=M.pitch<15?Q2(.07,.7,Fe((14-M.zoom)/5,0,1)):.07,z=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:tA(a,t,i,c),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:h,u_width_scale:p,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:eA(t,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(z?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:O,u_tile_to_meter:Ve(t.tileID.canonical,0),u_ground_shadow_factor:T,u_pattern_transition:A}},o.dP=(a,t,i,c,h,p,g,w,T,A)=>{const M=a.transform,O=M.calculatePixelsToTileUnitsMatrix(t),z=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",U=M.pitch<15?Q2(.07,.7,Fe((14-M.zoom)/5,0,1)):.07;return{u_matrix:tA(a,t,i,c),u_pixels_to_tile_units:O,u_device_pixel_ratio:p,u_width_scale:g,u_floor_width_scale:w,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:nA(i)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:eA(t,a.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(z?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:U,u_tile_to_meter:Ve(t.tileID.canonical,0),u_ground_shadow_factor:A}},o.dQ=Ot,o.dR=En,o.dS=Xe,o.dT=B2,o.dU=Qs,o.dV=Yy,o.dW=ap,o.dX=450,o.dY=7,o.dZ=NN,o.d_=On,o.da=function(a){const t=a.lastIndexOf($h);return t>=0?a.slice(t+1):""},o.db=function(a){const t=[],i=a.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},o.dc=function(a,t,i,c){return a.type==="custom"?new BN(a,t):new YN[a.type](a,t,i,c)},o.dd=Mr,o.de=function(a){const t=a.indexOf($h);return t>=0?a.slice(t+1):""},o.df=class extends vg{constructor(a,t){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},o.dg=Vh,o.dh=xu,o.di=og,o.dj=class extends $a{constructor(a){super(a),this.current=Qf}set(a,t,i){if(this.fetchUniformLocation(a,t)){for(let c=0;c<9;c++)if(i[c]!==this.current[c]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.dk=De,o.dl=function(a,t,i){const c=ed(i.zoom),h=a.style.map._antialias,p=a.terrain&&a.terrain.exaggeration()>0;return c===0&&!h&&!p},o.dm=function(a){const t=a.pixelsPerMeter,i=t/ye(1,a.center.lat),c=oe(new Float64Array(16));return ge(c,c,[a.point.x,a.point.y,0]),ke(c,c,[i,i,t]),Float32Array.from(c)},o.dn=om,o.dp=function(a){const t=je-5;a=Fe(a,-t,t)/t*90;const i=Math.pow(Math.abs(Math.sin(Q(a))),3);return Math.round(i*(F.length-1))},o.dq=function(a,t,i,c){const h=t.getNorth(),p=t.getSouth(),g=t.getWest(),w=t.getEast(),T=1<<a.z,A=w-g,M=h-p,O=A/R,z=-M/F[i],U=[0,O,0,z,0,0,h,g,0];if(a.z>0){const V=180/c;Z(U,U,[V/A+1,0,0,0,V/M+1,0,-.5*V/O,.5*V/z,1])}return U[2]=T,U[5]=a.x,U[8]=a.y,U},o.dr=tl,o.ds=function(a,t,i){const c=oe(new Float64Array(16)),h=(t/(1<<a)-.5)*Math.PI*2;return ze(c,i.globeMatrix,h),Float32Array.from(c)},o.dt=class{isDataAvailableAtPoint(a){const t=this._source();if(this.isUsingMockSource()||!t||a.y<0||a.y>1)return!1;const i=t.getSource().maxzoom,c=1<<i,h=Math.floor(a.x),p=Math.floor((a.x-h)*c),g=Math.floor(a.y*c),w=this.findDEMTileFor(new Zi(i,h,i,p,g));return!(!w||!w.dem)}getAtPointOrZero(a,t=0){return this.getAtPoint(a,t)||0}getAtPoint(a,t,i=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const c=this._source();if(!c||a.y<0||a.y>1)return t;const h=c.getSource().maxzoom,p=1<<h,g=Math.floor(a.x),w=a.x-g,T=new Zi(h,g,h,Math.floor(w*p),Math.floor(a.y*p)),A=this.findDEMTileFor(T);if(!A||!A.dem)return t;const M=A.dem,O=1<<A.tileID.canonical.z,z=(w*O-A.tileID.canonical.x)*M.dim,U=(a.y*O-A.tileID.canonical.y)*M.dim,V=Math.floor(z),H=Math.floor(U);return(i?this.exaggeration():1)*xr(xr(M.get(V,H),M.get(V,H+1),U-H),xr(M.get(V+1,H),M.get(V+1,H+1),U-H),z-V)}getAtTileOffset(a,t,i){const c=1<<a.canonical.z;return this.getAtPointOrZero(new He(a.wrap+(a.canonical.x+t/zt)/c,(a.canonical.y+i/zt)/c))}getAtTileOffsetFunc(a,t,i,c){return h=>{const p=this.getAtTileOffset(a,h.x,h.y),g=c.upVector(a.canonical,h.x,h.y);return Ft(g,g,p*c.upVectorScale(a.canonical,t,i).metersToTile),g}}getForTilePoints(a,t,i,c){if(this.isUsingMockSource())return!1;const h=fg.create(this,a,c);return!!h&&(t.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],i)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(a);if(!t||!t.dem)return null;const i=t.dem.tree,c=t.tileID,h=1<<a.canonical.z-c.canonical.z;let p=a.canonical.x/h-c.canonical.x,g=a.canonical.y/h-c.canonical.y,w=0;for(let T=0;T<a.canonical.z-c.canonical.z&&!i.leaves[w];T++){p*=2,g*=2;const A=2*Math.floor(g)+Math.floor(p);w=i.childOffsets[w]+A,p%=1,g%=1}return{min:this.exaggeration()*i.minimums[w],max:this.exaggeration()*i.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let t=!1,i=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const h of a){const p=this.getMinMaxForTile(h.tileID);p&&(i=Math.min(i,p.min),c=Math.max(c,p.max),t=!0)}return t?{min:i,max:c}:null}},o.du=pn,o.dv=nu,o.dw=function(a,t){return[Math.pow(a[0],2.2)*t,Math.pow(a[1],2.2)*t,Math.pow(a[2],2.2)*t]},o.dx=$,o.dy=function(a,t){var i=Math.sin(t),c=Math.cos(t);return a[0]=c,a[1]=i,a[2]=0,a[3]=-i,a[4]=c,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},o.dz=Qr,o.e=Wi,o.e$=dP,o.e0=256,o.e1=l_,o.e2=Ys,o.e3=ze,o.e4=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[4],a[4]=t[5],a[5]=t[6],a[6]=t[8],a[7]=t[9],a[8]=t[10],a},o.e5=Jc,o.e6=Yh,o.e7=function(a,t,i,c,h){return Fe((a-t)/(i-t)*(h-c)+c,c,h)},o.e8=$i,o.e9=function(a,t){var i=t[0],c=t[1],h=t[2],p=t[3],g=t[4],w=t[5],T=t[6],A=t[7],M=t[8],O=M*g-w*A,z=-M*p+w*T,U=A*p-g*T,V=i*O+c*z+h*U;return V?(a[0]=O*(V=1/V),a[1]=(-M*c+h*A)*V,a[2]=(w*c-h*g)*V,a[3]=z*V,a[4]=(M*i-h*T)*V,a[5]=(-w*i+h*p)*V,a[6]=U*V,a[7]=(-A*i+c*T)*V,a[8]=(g*i-c*p)*V,a):null},o.eA=function(a,t,i){return a[0]=t[0]/i[0],a[1]=t[1]/i[1],a[2]=t[2]/i[2],a},o.eB=fr,o.eC=J,o.eD=Ur,o.eE=function(a,t,i,c){return a[0]=t,a[1]=i,a[2]=c,a},o.eF=function([a,t,i]){const c=Math.hypot(a,t,i),h=Math.atan2(a,i),p=.5*Math.PI-Math.acos(-t/c);return new K(ae(h),ae(p))},o.eG=uo,o.eH=x1,o.eI=function(a){const t=a.navigator?a.navigator.userAgent:null;return!!function(i){if(oo==null){const c=i.navigator?i.navigator.userAgent:null;oo=!!i.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return oo}(a)&&!(!t||!(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.eJ=function(a,t){Xl=a,Qa=t},o.eK=m,o.eL=cm,o.eM=function(a){const t=[0,0,0],i=oe(new Float64Array(16));return xe(i,a.pixelMatrix,a.globeMatrix),Nt(t,t,i),new Dt(t[0],t[1])},o.eN=function(a,t,i=!1){if(Fo===Vu||Fo===As||Fo===$u)throw new Error("setRTLTextPlugin cannot be called multiple times.");Al=Ja.resolveURL(a),Fo=Vu,Gu=t,Fd(),i||Nd()},o.eO=Hi,o.eP=function(){bv().acquire(I1)},o.eQ=function(){const a=D_;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(I1),D_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.eR=ym,o.eS=function(a){const t=pd();if(!t)return;const i=t.delete(Pa);a&&i.then(()=>a()).catch(a)},o.eT=O_,o.eU=rP,o.eV=function(a){F1=Ja.resolveURL(a),yg||(yg=new pg(bv(),new ml)),yg.broadcast("setDracoUrl",F1)},o.eW=nP,o.eX=function(a){_g=Ja.resolveURL(a),yg||(yg=new pg(bv(),new ml)),yg.broadcast("setMeshoptUrl",_g)},o.eY=qt,o.eZ=Tt,o.e_=Ju,o.ea=as,o.eb=gn,o.ec=ct,o.ed=class{constructor(a,t,i,c){this.context=a,this.format=c,this.size=i,this.texture=a.gl.createTexture();const[h,p,g]=this.size,{gl:w}=a;w.bindTexture(w.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),w.texImage3D(w.TEXTURE_3D,0,this.format,h,p,g,0,g1(this.format),_1(this.format),t.data)}bind(a,t){const{context:i}=this,{gl:c}=i;c.bindTexture(c.TEXTURE_3D,this.texture),a!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,a),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,a),this.minFilter=a),t!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,t),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},o.ee=function(a,t){if(a===t){var i=t[1],c=t[2],h=t[3],p=t[6],g=t[7],w=t[11];a[1]=t[4],a[2]=t[8],a[3]=t[12],a[4]=i,a[6]=t[9],a[7]=t[13],a[8]=c,a[9]=p,a[11]=t[14],a[12]=h,a[13]=g,a[14]=w}else a[0]=t[0],a[1]=t[4],a[2]=t[8],a[3]=t[12],a[4]=t[1],a[5]=t[5],a[6]=t[9],a[7]=t[13],a[8]=t[2],a[9]=t[6],a[10]=t[10],a[11]=t[14],a[12]=t[3],a[13]=t[7],a[14]=t[11],a[15]=t[15];return a},o.ef=b1,o.eg=Zt,o.eh=[1,1,1],o.ei=function(a,t,i,c){var h=new k(4);return h[0]=a,h[1]=t,h[2]=i,h[3]=c,h},o.ej=mr,o.ek=function(a,t,i,c){var h=t[0],p=t[1],g=t[2],w=t[3];return a[0]=h+c*(i[0]-h),a[1]=p+c*(i[1]-p),a[2]=g+c*(i[2]-g),a[3]=w+c*(i[3]-w),a},o.el=fg,o.em=dg,o.en=Ks,o.eo=Qc,o.ep=function(a,t,i,c,h,p,g,w,T,A,M,O,z,U,V,H){var re=new k(16);return re[0]=a,re[1]=t,re[2]=i,re[3]=c,re[4]=h,re[5]=p,re[6]=g,re[7]=w,re[8]=T,re[9]=A,re[10]=M,re[11]=O,re[12]=z,re[13]=U,re[14]=V,re[15]=H,re},o.eq=Y,o.er=Zd,o.es=Vf,o.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Dt(1/0,1/0),max:new Dt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,t=!1){const i=w2(new Dt(0,0),new Dt(zt,zt),a),c=[];if(t&&!qx(i,this._globalClipBounds))return c;for(const h of this._activeRegions){if(h.hiddenByOverlap||!qx(i,h))continue;const p=OF(h.min,h.max,a);c.push({min:p.min,max:p.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return c}setSources(a){this._setSources(a.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const i=[];for(const c of t.cache.getVisibleCoordinates()){const h=t.cache.getTile(c).buckets[t.layer];h&&h.updateFootprints(c.toUnwrapped(),i)}return i},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope})))}_addSource(a){const t=a.getFootprints();if(t.length===0)return;const i=a.getOrder(),c=a.getClipMask(),h=a.getClipScope();for(const p of t){if(!p.footprint)continue;const g=w2(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:i,clipMask:c,clipScope:h})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((t,i)=>t.priority-i.priority||Zy(t.min,i.min)||Zy(t.max,i.max)||t.order-i.order||t.clipMask-i.clipMask||function(c,h){const p=(g,w)=>g+w;return c.length-h.length||c.reduce(p,"").localeCompare(h.reduce(p,""))}(t.clipScope,i.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let t=0;for(;!a&&t!==this._activeRegions.length;){const i=this._activeRegions[t],c=this._prevRegions[t];a=i.priority!==c.priority||!b2(i,c)||i.order!==c.order||i.clipMask!==c.clipMask||!mi(i.clipScope,c.clipScope),++t}}if(a){++this._updateTime;for(const i of this._activeRegions)i.order!==Hy&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const t=i=>{const c=this._activeRegions;if(i>=c.length)return i;const h=c[i].priority;for(;i<c.length&&c[i].priority===h;)++i;return i};if(this._sourceIds.length>1){let i=0,c=t(i);for(;i!==c;){let h=i;const p=i;for(;h!==c;){const g=this._activeRegions[h];g.hiddenByOverlap=!1;for(let w=0;w<p;w++){const T=this._activeRegions[w];if(!T.hiddenByOverlap&&g.order===Hy&&qx(g,T)&&(g.hiddenByOverlap=T2(g.footprint,g.tileId,T.footprint,T.tileId),g.hiddenByOverlap))break}++h}i=c,c=t(i)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=a.length-1;t>=0;t--)this._addSource(a[t]);this._computeReplacement()}},o.eu=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,t){const i=new Cl,c=new to,h=[],p=a+1+2,g=t[0]+1,w=t[0]+1+(1+t.length),T=(A,M,O)=>{let z=A===p-1?A-2:A===0?A:A-1;return z+=O?24575:0,[z,M]};for(let A=0;A<p;++A)i.emplaceBack(...T(A,0,!0));for(let A=0;A<g;++A)for(let M=0;M<p;++M)i.emplaceBack(...T(M,A,(M===0||M===p-1)&&!0));for(let A=0;A<t.length;++A){const M=t[A];for(let O=0;O<p;++O)i.emplaceBack(...T(O,M,!0))}for(let A=0;A<t.length;++A){const M=c.length,O=t[A]+1+2,z=new to;for(let H=0;H<O-1;H++){const re=H===O-2,ne=re?p*(w-t.length+A-H):p;for(let de=0;de<p-1;de++){const ue=H*p+de;H===0||re||de===0||de===p-2?(z.emplaceBack(ue+1,ue,ue+ne),z.emplaceBack(ue+ne,ue+ne+1,ue+1)):(c.emplaceBack(ue+1,ue,ue+ne),c.emplaceBack(ue+ne,ue+ne+1,ue+1))}}const U=Si.simpleSegment(0,M,i.length,c.length-M);for(let H=0;H<z.uint16.length;H+=3)c.emplaceBack(z.uint16[H],z.uint16[H+1],z.uint16[H+2]);const V=Si.simpleSegment(0,M,i.length,c.length-M);h.push({withoutSkirts:U,withSkirts:V})}return{vertices:i,indices:c,segments:h}}_createGrid(a){const t=this._fillGridMeshWithLods(R,F);this._gridSegments=t.segments,this._gridBuffer=a.createVertexBuffer(t.vertices,Mo.members),this._gridIndexBuffer=a.createIndexBuffer(t.indices,!0)}_createPoles(a){const t=new to;for(let g=0;g<=R;g++)t.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=a.createIndexBuffer(t,!0);const i=new Jc,c=new Jc,h=new Jc,p=new Jc;this._poleSegments=[];for(let g=0,w=0;g<S;g++){const T=360/(1<<g);i.emplaceBack(0,-x,0,.5,0),c.emplaceBack(0,-x,0,.5,1),h.emplaceBack(0,-x,0,.5,.5),p.emplaceBack(0,-x,0,.5,.5);for(let A=0;A<=R;A++){let M=A/R,O=0;const z=xr(0,T,M),[U,V,H]=G(P,N,z,x);i.emplaceBack(U,V,H,M,O),c.emplaceBack(U,V,H,M,1-O);const re=Q(z);M=.5+.5*Math.sin(re),O=.5+.5*Math.cos(re),h.emplaceBack(U,V,H,M,O),p.emplaceBack(U,V,H,M,1-O)}this._poleSegments.push(Si.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(i,za,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(c,za,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(h,za,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(p,za,!1)}getGridBuffers(a,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},o.ev=Hy,o.ew=Pe,o.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.ey=Le,o.ez=Et,o.f=function(a){return a.indexOf("mapbox:")===0},o.f0=fP,o.f1=X2,o.f2=hm,o.f3="hd_road_elevation",o.f4=jx,o.f5=wr,o.f6=fm,o.f7=o1,o.f8=mm,o.f9=function(a,t,i,c,h,p,g,w=1,T,A){a.createArrays(),a.tilePixelRatio=zt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const M=a.layers[0].layout,O=a.layers[0]._unevaluatedLayout._values,z={};z.scaleFactor=w,z.textSizeScaleRange=M.get("text-size-scale-range"),z.iconSizeScaleRange=M.get("icon-size-scale-range");const[U,V]=z.textSizeScaleRange,[H,re]=z.iconSizeScaleRange;z.textScaleFactor=Fe(z.scaleFactor,U,V),z.iconScaleFactor=Fe(z.scaleFactor,H,re);const ne=O["text-size"],de=O["icon-size"];if(a.textSizeData.kind==="composite"){const{minZoom:Ce,maxZoom:Re}=a.textSizeData;z.compositeTextSizes=[ne.possiblyEvaluate(new $n(Ce),p),ne.possiblyEvaluate(new $n(Re),p)]}if(a.iconSizeData.kind==="composite"){const{minZoom:Ce,maxZoom:Re}=a.iconSizeData;z.compositeIconSizes=[de.possiblyEvaluate(new $n(Ce),p),de.possiblyEvaluate(new $n(Re),p)]}z.layoutTextSize=ne.possiblyEvaluate(new $n(g+1),p),z.layoutIconSize=de.possiblyEvaluate(new $n(g+1),p),z.textMaxSize=ne.possiblyEvaluate(new $n(18),p);const ue=M.get("symbol-placement"),X=M.get("text-rotation-alignment")==="map"&&ue!=="point",se=M.get("text-size");let he=!1;const _e=[];for(const Ce of a.features){const Re=M.get("text-font").evaluate(Ce,{},p).join(","),Ne=se.evaluate(Ce,{},p)*z.textScaleFactor,$e=z.layoutTextSize.evaluate(Ce,{},p)*z.textScaleFactor,at=z.layoutIconSize.evaluate(Ce,{},p)*z.iconScaleFactor,xt={horizontal:{},vertical:void 0},mt=Ce.text;let yt,At=[0,0];if(mt){const nr=mt.toString(),Cr=M.get("text-letter-spacing").evaluate(Ce,{},p)*ia,Gr=M.get("text-line-height").evaluate(Ce,{},p)*ia,Xr=Wp(nr)?Cr:0,cn=M.get("text-anchor").evaluate(Ce,{},p),on=M.get("text-variable-anchor");if(!on){const ve=M.get("text-radial-offset").evaluate(Ce,{},p);if(ve)At=RA(cn,[ve*ia,s1]);else{const lt=M.get("text-offset").evaluate(Ce,{},p);At=[lt[0]*ia,lt[1]*ia]}}let Kr=X?"center":M.get("text-justify").evaluate(Ce,{},p);const ai=ue==="point",vi=ai?M.get("text-max-width").evaluate(Ce,{},p)*ia:1/0,me=ve=>{a.allowVerticalPlacement&&El(nr)&&(xt.vertical=r1(mt,t,i,h,Re,vi,Gr,cn,ve,Xr,At,rl.vertical,!0,$e,Ne,T))};if(!X&&on){const ve=Kr==="auto"?on.map(Rt=>l1(Rt)):[Kr];let lt=!1;for(let Rt=0;Rt<ve.length;Rt++){const $t=ve[Rt];if(!xt.horizontal[$t])if(lt)xt.horizontal[$t]=xt.horizontal[0];else{const Ut=r1(mt,t,i,h,Re,vi,Gr,"center",$t,Xr,At,rl.horizontal,!1,$e,Ne,T);Ut&&(xt.horizontal[$t]=Ut,lt=Ut.positionedLines.length===1)}}me("left")}else{if(Kr==="auto"&&(Kr=l1(cn)),ai||M.get("text-writing-mode").indexOf("horizontal")>=0||!El(nr)){const ve=r1(mt,t,i,h,Re,vi,Gr,cn,Kr,Xr,At,rl.horizontal,!1,$e,Ne,T);ve&&(xt.horizontal[Kr]=ve)}me(ai?"left":Kr)}}let tt,_t,Je,it,Pt,Mt,sr,Qt=!1;if(Ce.icon&&Ce.icon.hasPrimary()){const nr=zA(Ce.icon,a.iconSizeData,O["icon-size"],p,a.zoom,Ce,T,z.iconScaleFactor);tt=nr.iconPrimary,Je=nr.iconSecondary;const Cr=tt.toString();if(_t=c.get(Cr),_t&&(Pt=M.get("icon-offset").evaluate(Ce,{},p),Mt=M.get("icon-anchor").evaluate(Ce,{},p),sr=M.get("icon-text-fit").evaluate(Ce,{},p),yt=mN(h.get(Cr),Je?h.get(Je.toString()):void 0,Pt,Mt),Qt=_t.sdf,a.sdfIcons===void 0?a.sdfIcons=_t.sdf:a.sdfIcons!==_t.sdf&&tn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_t.pixelRatio!==a.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0)),Je){const Gr=Je.toString();it=c.get(Gr)}}he=he||!(!Ce.icon||!Ce.icon.hasSecondary());const jt=c1(xt.horizontal)||xt.vertical;a.iconsInText||(a.iconsInText=!!jt&&jt.iconsInText);const It=$e*z.textScaleFactor/ia,{defaultShapedIcon:Lr,verticallyShapedIcon:rr}=TN(a,yt,M,Ce,p,xt,It,Pt,sr);sr!=="none"&&yt&&(yA(yt)||vA(yt))&&(nv(0,_t,tt,yt,Lr,sr,A,c,h),nv(0,it,Je,yt,Lr,sr,A,c,h),rr&&(nv(0,_t,tt,yt,rr,sr,A,c,h),nv(0,it,Je,yt,rr,sr,A,c,h))),yt=Lr,_e.push({feature:Ce,shapedTextOrientations:xt,shapedText:jt,shapedIcon:yt,iconPrimary:tt,iconSecondary:Je,iconOffset:Pt,iconAnchor:Mt,verticallyShapedIcon:rr,layoutTextSize:$e,layoutIconSize:at,textOffset:At,isSDFIcon:Qt,iconTextFit:sr})}return{featureData:_e,sizes:z,hasAnySecondaryIcon:he,textAlongLine:X,symbolPlacement:ue}},o.fa=PA,o.fb=function(a,t,i,c,h,p,g,w,T,A){const{featureData:M,hasAnySecondaryIcon:O,sizes:z,textAlongLine:U,symbolPlacement:V}=t;for(const H of M){const{shapedIcon:re,verticallyShapedIcon:ne,feature:de,shapedTextOrientations:ue,shapedText:X,layoutTextSize:se,textOffset:he,isSDFIcon:_e,iconPrimary:Ce,iconSecondary:Re,iconTextFit:Ne,iconOffset:$e}=H;FA(re,A.iconPositions,Ce,Re),FA(ne,A.iconPositions,Ce,Re),SN(ue,A.iconPositions),(X||re)&&EN(a,de,ue,re,ne,T,z,se,0,he,_e,c,h,g,w,O,Ne,$e,U,V)}i&&a.generateCollisionDebugBuffers(p,a.collisionBoxArray,z.textScaleFactor)},o.fc=op,o.fd=Pv,o.fe=ki,o.ff=o2,o.fg=cA,o.fh=Bn,o.fi=function(a){let t=0;if(new Uint32Array(a,0,1)[0]!==oP){const i=new Uint32Array(a,0,7),[,,c,h,p,g]=i;t=i.byteLength+h+p+g+p,(c!==a.byteLength||t>=a.byteLength)&&tn("Invalid b3dm header information.")}return cP(a,t)},o.fj=function(a,t){const i=hP(a);for(const c of i){for(const h of c.meshes)ej(h);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(tj(c.lights,t)))}return i},o.fk=xv,o.fl=li,o.fm=EI,o.fn=Ua,o.fo=function(a){ul(),es!=null&&es.then(t=>{t.keys().then(i=>{for(let c=0;c<i.length-a;c++)t.delete(i[c]).catch(h=>tn(h.message))}).catch(i=>tn(i.message))}).catch(t=>tn(t.message))},o.g=function(a,t){return xu(Ze(a,{method:"GET"}),t)},o.h=ll,o.i=function(a){return Wi.API_STYLE_REGEX.test(a)&&!_u(a)},o.j=function(a){return decodeURIComponent(atob(a).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.k=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(t,i)=>String.fromCharCode(+("0x"+i))))},o.l=Ze,o.m=vf,o.n=function(a,t){return xu(Ze(a,{type:"json"}),t)},o.o=dh,o.p=function(a,t){return xu(Ze(a,{method:"POST"}),t)},o.q=Ja,o.r=ar,o.s=function(a){try{const t=self[a];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=Cp,o.u=function(){return function a(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()},o.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},o.w=tn,o.x=function(){return P1||(P1=new ym),P1},o.y=k1,o.z=bf}),b(["./shared"],function(o){function D(Qe){const Q=Qe?Qe.url.toString():void 0;return Q?performance.getEntriesByName(Q):[]}function k(Qe){if(typeof Qe=="number"||typeof Qe=="boolean"||typeof Qe=="string"||Qe==null)return JSON.stringify(Qe);if(Array.isArray(Qe)){let ae="[";for(const Se of Qe)ae+=`${k(Se)},`;return`${ae}]`}let Q="{";for(const ae of Object.keys(Qe).sort())Q+=`${ae}:${k(Qe[ae])},`;return`${Q}}`}function L(Qe){let Q="";for(const ae of o.bu)(Qe.type!=="model"||ae!=="minzoom"&&ae!=="maxzoom")&&(Q+=`/${k(Qe[ae])}`);return Q}class ${constructor(Q){this.keyCache={},this._layers={},this._layerConfigs={},Q&&this.replace(Q)}replace(Q,ae){this._layerConfigs={},this._layers={},this.update(Q,[],ae)}update(Q,ae,Se){this._options=Se;for(const Pe of Q)this._layerConfigs[Pe.id]=Pe,(this._layers[Pe.id]=o.dc(Pe,this.scope,null,this._options)).compileFilter(Se),this.keyCache[Pe.id]&&delete this.keyCache[Pe.id];for(const Pe of ae)delete this.keyCache[Pe],delete this._layerConfigs[Pe],delete this._layers[Pe];this.familiesBySource={};const De=function(Pe,Le){const Fe={};for(let Ye=0;Ye<Pe.length;Ye++){const ht=Pe[Ye];let Ze=Le&&Le[ht.id];Ze||(ht.type==="symbol"?Ze=ht.id:(Ze=L(ht),ht.type==="line"&&ht.paint&&function Vt(Ot){return typeof Ot=="string"&&Ot==="line-progress"||(Array.isArray(Ot)?Ot.some(Vt):!(!Ot||typeof Ot!="object")&&Object.values(Ot).some(Vt))}(ht.paint["line-width"])&&(Ze+=`/${k(ht.paint["line-width"])}`))),Le&&(Le[ht.id]=Ze);let Lt=Fe[Ze];Lt||(Lt=Fe[Ze]=[]),Lt.push(ht)}const Be=[];for(const Ye in Fe)Be.push(Fe[Ye]);return Be}(Object.values(this._layerConfigs),this.keyCache);for(const Pe of De){const Le=Pe.map(Lt=>this._layers[Lt.id]),Fe=Le[0];if(Fe.visibility==="none")continue;const Be=Fe.source||"";let Ye=this.familiesBySource[Be];Ye||(Ye=this.familiesBySource[Be]={});const ht=Fe.sourceLayer||"_geojsonTileLayer";let Ze=Ye[ht];Ze||(Ze=Ye[ht]=[]),Ze.push(Le)}}}const q=1*o.e_;class Z{constructor(Q){const ae={},Se=[];for(const Fe in Q){const Be=Q[Fe],Ye=ae[Fe]={};for(const ht in Be.glyphs){const Ze=Be.glyphs[+ht];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;const Lt=Ze.metrics.localGlyph?q:1,Vt={x:0,y:0,w:Ze.bitmap.width+2*Lt,h:Ze.bitmap.height+2*Lt};Se.push(Vt),Ye[ht]=Vt}}const{w:De,h:Pe}=o.H(Se),Le=new o.eZ({width:De||1,height:Pe||1});for(const Fe in Q){const Be=Q[Fe];for(const Ye in Be.glyphs){const ht=Be.glyphs[+Ye];if(!ht||ht.bitmap.width===0||ht.bitmap.height===0)continue;const Ze=ae[Fe][Ye],Lt=ht.metrics.localGlyph?q:1;o.eZ.copy(ht.bitmap,Le,{x:0,y:0},{x:Ze.x+Lt,y:Ze.y+Lt},ht.bitmap)}}this.image=Le,this.positions=ae}}o.eY(Z,"GlyphAtlas");class ie{constructor(Q){this.tileID=new o.aM(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.tileZoom=Q.tileZoom,this.uid=Q.uid,this.zoom=Q.zoom,this.lut=Q.lut,this.canonical=Q.tileID.canonical,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.scope=Q.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.request&&Q.request.collectResourceTiming,this.promoteId=Q.promoteId,this.isSymbolTile=Q.isSymbolTile,this.tileTransform=o.aW(Q.tileID.canonical,Q.projection),this.projection=Q.projection,this.worldview=Q.worldview,this.localizableLayerIds=Q.localizableLayerIds,this.brightness=Q.brightness,this.extraShadowCaster=!!Q.extraShadowCaster,this.tessellationStep=Q.tessellationStep,this.scaleFactor=Q.scaleFactor}parse(Q,ae,Se,De,Pe,Le){this.status="parsing",this.data=Q,this.collisionBoxArray=new o.b0;const Fe=new o.e$(Object.keys(Q.layers).sort()),Be=new o.f0(this.tileID,this.promoteId);Be.bucketLayerIDs=[];const Ye={},ht=new o.f1(256,256),Ze={featureIndex:Be,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:ht,availableImages:Se,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Lt=ae.familiesBySource[this.source];for(const Rn in Lt){const hn=Q.layers[Rn];if(!hn)continue;let li=!1,ji=!1,oo=!1;for(const ko of Lt[Rn])ko[0].type==="symbol"?li=!0:ji=!0,ko[0].is3D()&&ko[0].type!=="model"&&(oo=!0);if(this.extraShadowCaster&&!oo||this.isSymbolTile===!0&&!li||this.isSymbolTile===!1&&!ji)continue;hn.version===1&&o.w(`Vector tile source "${this.source}" layer "${Rn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fo=Fe.encode(Rn),Ho=[];let sl=!1;for(let ko=0,eo=0;ko<hn.length;ko++){const Ro=hn.feature(ko),Wi=Be.getId(Ro,Rn);if(this.localizableLayerIds&&this.localizableLayerIds.has(Rn)){const ll=Ro.properties?Ro.properties.worldview:null;if(this.worldview&&typeof ll=="string")if(ll==="all")Ro.properties.$localized=!0;else{if(!ll.split(",").includes(this.worldview))continue;Ro.properties.$localized=!0,Ro.properties.worldview=this.worldview}}!sl&&Ro.properties&&Ro.properties.hasOwnProperty(o.f2)&&(sl=!0),Ho.push({feature:Ro,id:Wi,index:eo,sourceLayerIndex:fo}),eo++}sl&&!Ze.elevationFeatures&&Q.layers.hasOwnProperty(o.f3)&&(Ze.elevationFeatures=o.f4.parseFrom(Q.layers[o.f3],this.canonical));for(const ko of Lt[Rn]){const eo=ko[0];(!this.extraShadowCaster||eo.is3D()&&eo.type!=="model")&&(this.isSymbolTile!==void 0&&eo.type==="symbol"!==this.isSymbolTile||eo.minzoom&&this.zoom<Math.floor(eo.minzoom)||eo.maxzoom&&this.zoom>=eo.maxzoom||eo.visibility!=="none"&&(oe(ko,this.zoom,Ze.brightness,Se),(Ye[eo.id]=eo.createBucket({index:Be.bucketLayerIDs.length,layers:ko,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fo,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:De})).populate(Ho,Ze,this.tileID.canonical,this.tileTransform),Be.bucketLayerIDs.push(ko.map(Ro=>o.C(Ro.id,Ro.scope)))))}}let Vt,Ot,gr,wr,Mr,Nr;ht.trim();const ui={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},tn=()=>{if(Vt)return this.status="done",Le(Vt);if(this.extraShadowCaster)this.status="done",Le(null,{buckets:Object.values(Ye).filter(Rn=>!Rn.isEmpty()),featureIndex:Be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ze.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ot&&gr&&wr){const Rn=new Z(Ot),hn=new Map;for(const[oo,fo]of gr.entries()){const{imagePosition:Ho}=o.f7(oo,fo,o.f8);hn.set(oo,Ho)}const li={};for(const oo in Ye){const fo=Ye[oo];fo instanceof o.b1&&(oe(fo.layers,this.zoom,Ze.brightness,Se),li[oo]=o.f9(fo,Ot,Rn.positions,gr,hn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Mr))}const ji={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Pe,gr,Mr,()=>{ji.iconsPending=!1,Jn(li,Rn,ji)}),this.rasterizeIfNeeded(Pe,wr,Nr,()=>{ji.patternsPending=!1,Jn(li,Rn,ji)})}},Jn=(Rn,hn,li,ji)=>{if(li.iconsPending||li.patternsPending)return;const oo=new o.fa(gr,wr,this.lut);for(const fo in Ye){const Ho=Ye[fo];if(fo in Rn)o.fb(Ho,Rn[fo],this.showCollisionBoxes,Se,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,gr,oo);else if(Ho.hasPattern&&(Ho instanceof o.b7||Ho instanceof o.b8||Ho instanceof o.dV)){oe(Ho.layers,this.zoom,Ze.brightness,Se);const sl=Object.fromEntries(oo.patternPositions);Ho.addFeatures(Ze,this.tileID.canonical,sl,Se,this.tileTransform,this.brightness)}}this.status="done",Le(null,{buckets:Object.values(Ye).filter(fo=>!fo.isEmpty()),featureIndex:Be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:hn.image,lineAtlas:ht,imageAtlas:oo,brightness:Ze.brightness})};if(!this.extraShadowCaster){const Rn=o.f5(Ze.glyphDependencies,ji=>Object.keys(ji).map(Number));Object.keys(Rn).length?Pe.send("getGlyphs",{uid:this.uid,stacks:Rn,scope:this.scope},(ji,oo)=>{Vt||(Vt=ji,Ot=oo,tn())},void 0,!1,ui):Ot={};const hn=Array.from(Ze.iconDependencies.keys()).map(ji=>o.I.parse(ji));hn.length?Pe.send("getImages",{images:hn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ji,oo)=>{Vt||(Vt=ji,gr=new Map,Mr=this.updateImageMapAndGetImageTaskQueue(gr,oo,Ze.iconDependencies),tn())},void 0,!1,ui):(gr=new Map,Mr=new Map);const li=Array.from(Ze.patternDependencies.keys()).map(ji=>o.I.parse(ji));li.length?Pe.send("getImages",{images:li,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ji,oo)=>{Vt||(Vt=ji,wr=new Map,Nr=this.updateImageMapAndGetImageTaskQueue(wr,oo,Ze.patternDependencies),tn())},void 0,!1,ui):(wr=new Map,Nr=new Map)}if(Ze.elevationFeatures&&Ze.elevationFeatures.length>0){const Rn=[];for(const li of Object.values(Ye))if(li instanceof o.b8){const ji=li.getUnevaluatedPortalGraph();ji&&Rn.push(ji)}const hn=o.f6.evaluate(Rn);for(const li of Object.values(Ye))li instanceof o.b8&&li.setEvaluatedPortalGraph(hn)}tn()}rasterizeIfNeeded(Q,ae,Se,De){Array.from(ae.values()).some(Pe=>Pe.usvg)?this.rasterize(Q,ae,Se,De):De()}updateImageMapAndGetImageTaskQueue(Q,ae,Se){const De=new Map;for(const Pe of ae.keys()){const Le=Se.get(Pe)||[];for(const Fe of Le){const Be=Fe.toString(),Ye=ae.get(Fe.id.toString());Ye.usvg?De.has(Be)||(De.set(Be,Fe),Q.set(Be,Object.assign({},Ye))):Q.set(Be,Ye)}}return De}rasterize(Q,ae,Se,De){this.rasterizeTask=Q.send("rasterizeImages",{scope:this.scope,tasks:Se},(Pe,Le)=>{if(!Pe)for(const[Fe,Be]of Le.entries()){const Ye=Object.assign(ae.get(Fe),{data:Be});ae.set(Fe,Ye)}De()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function oe(Qe,Q,ae,Se){const De=new o.aa(Q,{brightness:ae});for(const Pe of Qe)Pe.recalculate(De,Se)}class le extends o.E{constructor(Q,ae,Se,De,Pe,Le,Fe){super(),this.actor=Q,this.layerIndex=ae,this.availableImages=Se,this.availableModels=De,this.loadVectorData=Le||o.aJ,this.loading={},this.loaded={},this.deduped=new o.aI(Q.scheduler),this.isSpriteLoaded=Pe,this.scheduler=Q.scheduler,this.brightness=Fe}loadTile(Q,ae){const Se=Q.uid,De=Q&&Q.request,Pe=De&&De.collectResourceTiming,Le=this.loading[Se]=new ie(Q);Le.abort=this.loadVectorData(Q,(Fe,Be)=>{const Ye=!this.loading[Se];if(delete this.loading[Se],Le.cancelRasterize(),Ye||Fe||!Be)return Le.status="done",Ye||(this.loaded[Se]=Le),ae(Fe);const ht=Be.rawData,Ze={};Be.expires&&(Ze.expires=Be.expires),Be.cacheControl&&(Ze.cacheControl=Be.cacheControl),Le.vectorTile=Be.vectorTile||new o.fc.VectorTile(new o.bq(ht));const Lt=()=>{Le.parse(Le.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Vt,Ot)=>{if(Vt||!Ot)return ae(Vt);const gr={};if(Pe){const wr=D(De);wr.length>0&&(gr.resourceTiming=JSON.parse(JSON.stringify(wr)))}ae(null,o.l({rawTileData:ht.slice(0)},Ot,Ze,gr))})};this.isSpriteLoaded?Lt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Lt,{type:"parseTile",isSymbolTile:Q.isSymbolTile,zoom:Q.tileZoom}):Lt()}),this.loaded=this.loaded||{},this.loaded[Se]=Le})}reloadTile(Q,ae){const Se=this.loaded,De=Q.uid;if(Se&&Se[De]){const Pe=Se[De];Pe.scaleFactor=Q.scaleFactor,Pe.showCollisionBoxes=Q.showCollisionBoxes,Pe.projection=Q.projection,Pe.brightness=Q.brightness,Pe.tileTransform=o.aW(Q.tileID.canonical,Q.projection),Pe.extraShadowCaster=Q.extraShadowCaster,Pe.lut=Q.lut;const Le=(Fe,Be)=>{const Ye=Pe.reloadCallback;Ye&&(delete Pe.reloadCallback,Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ye)),ae(Fe,Be)};Pe.status==="parsing"?Pe.reloadCallback=Le:Pe.status==="done"&&(Pe.vectorTile?Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Le):Le())}else ae(null,void 0)}abortTile(Q,ae){const Se=Q.uid,De=this.loading[Se];De&&(De.abort&&De.abort(),delete this.loading[Se]),ae()}removeTile(Q,ae){const Se=this.loaded,De=Q.uid;Se&&Se[De]&&delete Se[De],ae()}}class xe{loadTile(Q,ae){const{uid:Se,encoding:De,rawImageData:Pe,padding:Le}=Q,Fe=ImageBitmap&&Pe instanceof ImageBitmap?this.getImageData(Pe,Le):Pe;ae(null,new o.fd(Se,Fe,De,Le<1))}reloadTile(Q,ae){ae(null,null)}abortTile(Q,ae){ae()}removeTile(Q,ae){ae()}getImageData(Q,ae){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Q.width,Q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Q.width,this.offscreenCanvas.height=Q.height,this.offscreenCanvasContext.drawImage(Q,0,0,Q.width,Q.height);const Se=this.offscreenCanvasContext.getImageData(-ae,-ae,Q.width+2*ae,Q.height+2*ae);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Se}}o.bp.setPbf(o.bq);class ge{constructor(Q){this._mrt=new o.bp(Q.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Q.uid,this.tileID=Q.tileID,this.source=Q.source}parse(Q,ae){const Se=this._mrt;this.status="parsing",this._entireBuffer=Q;try{Se.parseHeader(Q),this._isHeaderLoaded=!0;const De=[];for(const Pe in Se.layers){const Le=Se.getLayer(Pe),Fe=Le.getDataRange(Le.getBandList()),Be=Se.createDecodingTask(Fe),Ye=Q.slice(Fe.firstByte,Fe.lastByte+1),ht=o.bp.performDecoding(Ye,Be).then(Ze=>Be.complete(null,Ze)).catch(Ze=>Be.complete(Ze,null));De.push(ht)}Promise.allSettled(De).then(()=>ae(null,Se)).catch(Pe=>ae(Pe))}catch(De){ae(De)}}}class ke{constructor(Q){this.actor=Q,this.loading={},this.loaded={}}loadTile(Q,ae){const Se=Q.uid,De=Q.request,Pe=this.loading[Se]=new ge(Q),{cancel:Le}=o.br(De,(Fe,Be,Ye,ht)=>{const Ze=!this.loading[Se];if(delete this.loading[Se],Ze||Fe||!Be)return Pe.status="done",Ze||(this.loaded[Se]=Pe),ae(Fe);Pe.parse(Be,(Lt,Vt)=>{if(Lt||!Vt)return ae(Lt);ae(null,Vt,Ye,ht)}),this.loaded[Se]=Pe});Pe.abort=Le}reloadTile(Q,ae){ae(null,void 0)}abortTile(Q,ae){const Se=Q.uid,De=this.loading[Se];De&&(De.abort&&De.abort(),delete this.loading[Se]),ae()}removeTile(Q,ae){const Se=Q.uid;this.loaded[Se]&&delete this.loaded[Se],ae()}decodeRasterArray(Q,ae){o.bp.performDecoding(Q.buffer,Q.task).then(Se=>ae(null,Se)).catch(Se=>ae(Se))}}const et=o.fc.VectorTileFeature.prototype.toGeoJSON;class ze{constructor(Q){this._feature=Q,this.extent=o.aj,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))}loadGeometry(){if(this._feature.type===1){const Q=[];for(const ae of this._feature.geometry)Q.push([new o.P(ae[0],ae[1])]);return Q}{const Q=[];for(const ae of this._feature.geometry){const Se=[];for(const De of ae)Se.push(new o.P(De[0],De[1]));Q.push(Se)}return Q}}toGeoJSON(Q,ae,Se){return et.call(this,Q,ae,Se)}}class nt{constructor(Q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.aj,this.length=Q.length,this._features=Q}feature(Q){return new ze(this._features[Q])}}const pt=64/4096,Gt=128;class ir{constructor(){this.features=new Map}clear(){this.features.clear()}load(Q=[],ae){for(const Se of Q){const De=Se.id;if(De==null)continue;let Pe=this.features.get(De);Pe&&this.updateCache(Pe,ae),Se.geometry?(Pe=Zt(Se),this.updateCache(Pe,ae),this.features.set(De,Pe)):this.features.delete(De),this.updateCache(Pe,ae)}}updateCache(Q,ae){for(const{canonical:Se,uid:De}of Object.values(ae)){const{z:Pe,x:Le,y:Fe}=Se;Br(Q,Math.pow(2,Pe),Le,Fe)&&delete ae[De]}}getTile(Q,ae,Se){const De=Math.pow(2,Q),Pe=[];for(const Le of this.features.values())Br(Le,De,ae,Se)&&Pe.push(Ar(Le,De,ae,Se));return{features:Pe}}getFeatures(){return[...this.features.values()]}}function Br({minX:Qe,minY:Q,maxX:ae,maxY:Se},De,Pe,Le){return Qe<(Pe+1+pt)/De&&Q<(Le+1+pt)/De&&ae>(Pe-pt)/De&&Se>(Le-pt)/De}function Zt(Qe){const{id:Q,geometry:ae,properties:Se}=Qe;if(!ae)return;if(ae.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:De,coordinates:Pe}=ae,Le={id:Q,type:1,geometry:[],tags:Se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Fe=Le.geometry;if(De==="Point")dr(Pe,Fe,Le);else if(De==="MultiPoint")for(const Be of Pe)dr(Be,Fe,Le);else if(De==="LineString")Le.type=2,Dr(Pe,Fe,Le);else if(De==="MultiLineString")Le.type=2,vr(Pe,Fe,Le);else if(De==="Polygon")Le.type=3,vr(Pe,Fe,Le,!0);else{if(De!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Le.type=3;for(const Be of Pe)vr(Be,Fe,Le,!0)}return Le}function dr([Qe,Q],ae,Se){const De=o.ay(Qe);let Pe=o.aH(Q);Pe=Pe<0?0:Pe>1?1:Pe,ae.push(De,Pe),Se.minX=Math.min(Se.minX,De),Se.minY=Math.min(Se.minY,Pe),Se.maxX=Math.max(Se.maxX,De),Se.maxY=Math.max(Se.maxY,Pe)}function Dr(Qe,Q,ae,Se=!1,De=!1){const Pe=[];for(const Le of Qe)dr(Le,Pe,ae);Q.push(Pe),Se&&function(Le,Fe){let Be=0;for(let Ye=0,ht=Le.length,Ze=ht-2;Ye<ht;Ze=Ye,Ye+=2)Be+=(Le[Ye]-Le[Ze])*(Le[Ye+1]+Le[Ze+1]);if(Be>0===Fe)for(let Ye=0,ht=Le.length;Ye<ht/2;Ye+=2){const Ze=Le[Ye],Lt=Le[Ye+1];Le[Ye]=Le[ht-2-Ye],Le[Ye+1]=Le[ht-1-Ye],Le[ht-2-Ye]=Ze,Le[ht-1-Ye]=Lt}}(Pe,De)}function vr(Qe,Q,ae,Se=!1){for(let De=0;De<Qe.length;De++)Dr(Qe[De],Q,ae,Se,De===0)}function Ar(Qe,Q,ae,Se){const{id:De,type:Pe,geometry:Le,tags:Fe}=Qe,Be=[];if(Pe===1)(function(Ye,ht,Ze,Lt,Vt){for(let Ot=0;Ot<Ye.length;Ot+=2){const gr=Math.round(o.aj*(Ye[Ot+0]*ht-Ze)),wr=Math.round(o.aj*(Ye[Ot+1]*ht-Lt));Vt.push([gr,wr])}})(Le,Q,ae,Se,Be);else for(const Ye of Le)zr(Ye,Q,ae,Se,Be);return{id:De,type:Pe,geometry:Be,tags:Fe}}function zr(Qe,Q,ae,Se,De){const Pe=-Gt,Le=o.aj+Gt;let Fe;for(let Be=0;Be<Qe.length-2;Be+=2){let Ye=Math.round(o.aj*(Qe[Be+0]*Q-ae)),ht=Math.round(o.aj*(Qe[Be+1]*Q-Se)),Ze=Math.round(o.aj*(Qe[Be+2]*Q-ae)),Lt=Math.round(o.aj*(Qe[Be+3]*Q-Se));const Vt=Ze-Ye,Ot=Lt-ht;Ye<Pe&&Ze<Pe||(Ye<Pe?(ht+=Math.round(Ot*((Pe-Ye)/Vt)),Ye=Pe):Ze<Pe&&(Lt=ht+Math.round(Ot*((Pe-Ye)/Vt)),Ze=Pe),ht<Pe&&Lt<Pe||(ht<Pe?(Ye+=Math.round(Vt*((Pe-ht)/Ot)),ht=Pe):Lt<Pe&&(Ze=Ye+Math.round(Vt*((Pe-ht)/Ot)),Lt=Pe),Ye>=Le&&Ze>=Le||(Ye>=Le?(ht+=Math.round(Ot*((Le-Ye)/Vt)),Ye=Le):Ze>=Le&&(Lt=ht+Math.round(Ot*((Le-Ye)/Vt)),Ze=Le),ht>=Le&&Lt>=Le||(ht>=Le?(Ye+=Math.round(Vt*((Le-ht)/Ot)),ht=Le):Lt>=Le&&(Ze=Ye+Math.round(Vt*((Le-ht)/Ot)),Lt=Le),Fe&&Ye===Fe[Fe.length-1][0]&&ht===Fe[Fe.length-1][1]||(Fe=[[Ye,ht]],De.push(Fe)),Fe.push([Ze,Lt])))))}}var qr,lr,br,Ft={exports:{}},ot=function(){if(br)return Ft.exports;br=1;var Qe=o.fg(),Q=function(){if(lr)return qr;lr=1;var ht=o.fe(),Ze=o.ff().VectorTileFeature;function Lt(Ot,gr){this.options=gr||{},this.features=Ot,this.length=Ot.length}function Vt(Ot,gr){this.id=typeof Ot.id=="number"?Ot.id:void 0,this.type=Ot.type,this.rawGeometry=Ot.type===1?[Ot.geometry]:Ot.geometry,this.properties=Ot.tags,this.extent=gr||4096}return qr=Lt,Lt.prototype.feature=function(Ot){return new Vt(this.features[Ot],this.options.extent)},Vt.prototype.loadGeometry=function(){var Ot=this.rawGeometry;this.geometry=[];for(var gr=0;gr<Ot.length;gr++){for(var wr=Ot[gr],Mr=[],Nr=0;Nr<wr.length;Nr++)Mr.push(new ht(wr[Nr][0],wr[Nr][1]));this.geometry.push(Mr)}return this.geometry},Vt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ot=this.geometry,gr=1/0,wr=-1/0,Mr=1/0,Nr=-1/0,ui=0;ui<Ot.length;ui++)for(var tn=Ot[ui],Jn=0;Jn<tn.length;Jn++){var Rn=tn[Jn];gr=Math.min(gr,Rn.x),wr=Math.max(wr,Rn.x),Mr=Math.min(Mr,Rn.y),Nr=Math.max(Nr,Rn.y)}return[gr,Mr,wr,Nr]},Vt.prototype.toGeoJSON=Ze.prototype.toGeoJSON,qr}();function ae(ht){var Ze=new Qe;return function(Lt,Vt){for(var Ot in Lt.layers)Vt.writeMessage(3,Se,Lt.layers[Ot])}(ht,Ze),Ze.finish()}function Se(ht,Ze){var Lt;Ze.writeVarintField(15,ht.version||1),Ze.writeStringField(1,ht.name||""),Ze.writeVarintField(5,ht.extent||4096);var Vt={keys:[],values:[],keycache:{},valuecache:{}};for(Lt=0;Lt<ht.length;Lt++)Vt.feature=ht.feature(Lt),Ze.writeMessage(2,De,Vt);var Ot=Vt.keys;for(Lt=0;Lt<Ot.length;Lt++)Ze.writeStringField(3,Ot[Lt]);var gr=Vt.values;for(Lt=0;Lt<gr.length;Lt++)Ze.writeMessage(4,Ye,gr[Lt])}function De(ht,Ze){var Lt=ht.feature;Lt.id!==void 0&&Ze.writeVarintField(1,Lt.id),Ze.writeMessage(2,Pe,ht),Ze.writeVarintField(3,Lt.type),Ze.writeMessage(4,Be,Lt)}function Pe(ht,Ze){var Lt=ht.feature,Vt=ht.keys,Ot=ht.values,gr=ht.keycache,wr=ht.valuecache;for(var Mr in Lt.properties){var Nr=Lt.properties[Mr],ui=gr[Mr];if(Nr!==null){ui===void 0&&(Vt.push(Mr),gr[Mr]=ui=Vt.length-1),Ze.writeVarint(ui);var tn=typeof Nr;tn!=="string"&&tn!=="boolean"&&tn!=="number"&&(Nr=JSON.stringify(Nr));var Jn=tn+":"+Nr,Rn=wr[Jn];Rn===void 0&&(Ot.push(Nr),wr[Jn]=Rn=Ot.length-1),Ze.writeVarint(Rn)}}}function Le(ht,Ze){return(Ze<<3)+(7&ht)}function Fe(ht){return ht<<1^ht>>31}function Be(ht,Ze){for(var Lt=ht.loadGeometry(),Vt=ht.type,Ot=0,gr=0,wr=Lt.length,Mr=0;Mr<wr;Mr++){var Nr=Lt[Mr],ui=1;Vt===1&&(ui=Nr.length),Ze.writeVarint(Le(1,ui));for(var tn=Vt===3?Nr.length-1:Nr.length,Jn=0;Jn<tn;Jn++){Jn===1&&Vt!==1&&Ze.writeVarint(Le(2,tn-1));var Rn=Nr[Jn].x-Ot,hn=Nr[Jn].y-gr;Ze.writeVarint(Fe(Rn)),Ze.writeVarint(Fe(hn)),Ot+=Rn,gr+=hn}Vt===3&&Ze.writeVarint(Le(7,1))}}function Ye(ht,Ze){var Lt=typeof ht;Lt==="string"?Ze.writeStringField(1,ht):Lt==="boolean"?Ze.writeBooleanField(7,ht):Lt==="number"&&(ht%1!=0?Ze.writeDoubleField(3,ht):ht<0?Ze.writeSVarintField(6,ht):Ze.writeVarintField(5,ht))}return Ft.exports=ae,Ft.exports.fromVectorTileJs=ae,Ft.exports.fromGeojsonVt=function(ht,Ze){Ze=Ze||{};var Lt={};for(var Vt in ht)Lt[Vt]=new Q(ht[Vt].features,Ze),Lt[Vt].name=Vt,Lt[Vt].version=Ze.version,Lt[Vt].extent=Ze.extent;return ae({layers:Lt})},Ft.exports.GeoJSONWrapper=Q,Ft.exports}(),St=o.fh(ot);const Ur={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Qe=>Qe},gn=Math.fround||(Sr=new Float32Array(1),Qe=>(Sr[0]=+Qe,Sr[0]));var Sr;const kr=3,Vr=5,wn=6;class Nt{constructor(Q){this.options=Object.assign(Object.create(Ur),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){const{log:ae,minZoom:Se,maxZoom:De}=this.options;ae&&console.time("total time");const Pe=`prepare ${Q.length} points`;ae&&console.time(Pe),this.points=Q;const Le=[];for(let Be=0;Be<Q.length;Be++){const Ye=Q[Be];if(!Ye.geometry)continue;const[ht,Ze]=Ye.geometry.coordinates,Lt=gn(Kt(ht)),Vt=gn(We(Ze));Le.push(Lt,Vt,1/0,Be,-1,1),this.options.reduce&&Le.push(0)}let Fe=this.trees[De+1]=this._createTree(Le);ae&&console.timeEnd(Pe);for(let Be=De;Be>=Se;Be--){const Ye=+Date.now();Fe=this.trees[Be]=this._createTree(this._cluster(Fe,Be)),ae&&console.log("z%d: %d clusters in %dms",Be,Fe.numItems,+Date.now()-Ye)}return ae&&console.timeEnd("total time"),this}getClusters(Q,ae){let Se=((Q[0]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,Q[1]));let Pe=Q[2]===180?180:((Q[2]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)Se=-180,Pe=180;else if(Se>Pe){const Ze=this.getClusters([Se,De,180,Le],ae),Lt=this.getClusters([-180,De,Pe,Le],ae);return Ze.concat(Lt)}const Fe=this.trees[this._limitZoom(ae)],Be=Fe.range(Kt(Se),We(Le),Kt(Pe),We(De)),Ye=Fe.data,ht=[];for(const Ze of Be){const Lt=this.stride*Ze;ht.push(Ye[Lt+Vr]>1?Qr(Ye,Lt,this.clusterProps):this.points[Ye[Lt+kr]])}return ht}getChildren(Q){const ae=this._getOriginId(Q),Se=this._getOriginZoom(Q),De="No cluster with the specified id.",Pe=this.trees[Se];if(!Pe)throw new Error(De);const Le=Pe.data;if(ae*this.stride>=Le.length)throw new Error(De);const Fe=this.options.radius/(this.options.extent*Math.pow(2,Se-1)),Be=Pe.within(Le[ae*this.stride],Le[ae*this.stride+1],Fe),Ye=[];for(const ht of Be){const Ze=ht*this.stride;Le[Ze+4]===Q&&Ye.push(Le[Ze+Vr]>1?Qr(Le,Ze,this.clusterProps):this.points[Le[Ze+kr]])}if(Ye.length===0)throw new Error(De);return Ye}getLeaves(Q,ae,Se){const De=[];return this._appendLeaves(De,Q,ae=ae||10,Se=Se||0,0),De}getTile(Q,ae,Se){const De=this.trees[this._limitZoom(Q)],Pe=Math.pow(2,Q),{extent:Le,radius:Fe}=this.options,Be=Fe/Le,Ye=(Se-Be)/Pe,ht=(Se+1+Be)/Pe,Ze={features:[]};return this._addTileFeatures(De.range((ae-Be)/Pe,Ye,(ae+1+Be)/Pe,ht),De.data,ae,Se,Pe,Ze),ae===0&&this._addTileFeatures(De.range(1-Be/Pe,Ye,1,ht),De.data,Pe,Se,Pe,Ze),ae===Pe-1&&this._addTileFeatures(De.range(0,Ye,Be/Pe,ht),De.data,-1,Se,Pe,Ze),Ze.features.length?Ze:null}getClusterExpansionZoom(Q){let ae=this._getOriginZoom(Q)-1;for(;ae<=this.options.maxZoom;){const Se=this.getChildren(Q);if(ae++,Se.length!==1)break;Q=Se[0].properties.cluster_id}return ae}_appendLeaves(Q,ae,Se,De,Pe){const Le=this.getChildren(ae);for(const Fe of Le){const Be=Fe.properties;if(Be&&Be.cluster?Pe+Be.point_count<=De?Pe+=Be.point_count:Pe=this._appendLeaves(Q,Be.cluster_id,Se,De,Pe):Pe<De?Pe++:Q.push(Fe),Q.length===Se)break}return Pe}_createTree(Q){const ae=new o.bW(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Se=0;Se<Q.length;Se+=this.stride)ae.add(Q[Se],Q[Se+1]);return ae.finish(),ae.data=Q,ae}_addTileFeatures(Q,ae,Se,De,Pe,Le){for(const Fe of Q){const Be=Fe*this.stride,Ye=ae[Be+Vr]>1;let ht,Ze,Lt;if(Ye)ht=Tn(ae,Be,this.clusterProps),Ze=ae[Be],Lt=ae[Be+1];else{const gr=this.points[ae[Be+kr]];ht=gr.properties;const[wr,Mr]=gr.geometry.coordinates;Ze=Kt(wr),Lt=We(Mr)}const Vt={type:1,geometry:[[Math.round(this.options.extent*(Ze*Pe-Se)),Math.round(this.options.extent*(Lt*Pe-De))]],tags:ht};let Ot;Ot=Ye||this.options.generateId?ae[Be+kr]:this.points[ae[Be+kr]].id,Ot!==void 0&&(Vt.id=Ot),Le.features.push(Vt)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,ae){const{radius:Se,extent:De,reduce:Pe,minPoints:Le}=this.options,Fe=Se/(De*Math.pow(2,ae)),Be=Q.data,Ye=[],ht=this.stride;for(let Ze=0;Ze<Be.length;Ze+=ht){if(Be[Ze+2]<=ae)continue;Be[Ze+2]=ae;const Lt=Be[Ze],Vt=Be[Ze+1],Ot=Q.within(Be[Ze],Be[Ze+1],Fe),gr=Be[Ze+Vr];let wr=gr;for(const Mr of Ot){const Nr=Mr*ht;Be[Nr+2]>ae&&(wr+=Be[Nr+Vr])}if(wr>gr&&wr>=Le){let Mr,Nr=Lt*gr,ui=Vt*gr,tn=-1;const Jn=(Ze/ht<<5)+(ae+1)+this.points.length;for(const Rn of Ot){const hn=Rn*ht;if(Be[hn+2]<=ae)continue;Be[hn+2]=ae;const li=Be[hn+Vr];Nr+=Be[hn]*li,ui+=Be[hn+1]*li,Be[hn+4]=Jn,Pe&&(Mr||(Mr=this._map(Be,Ze,!0),tn=this.clusterProps.length,this.clusterProps.push(Mr)),Pe(Mr,this._map(Be,hn)))}Be[Ze+4]=Jn,Ye.push(Nr/wr,ui/wr,1/0,Jn,-1,wr),Pe&&Ye.push(tn)}else{for(let Mr=0;Mr<ht;Mr++)Ye.push(Be[Ze+Mr]);if(wr>1)for(const Mr of Ot){const Nr=Mr*ht;if(!(Be[Nr+2]<=ae)){Be[Nr+2]=ae;for(let ui=0;ui<ht;ui++)Ye.push(Be[Nr+ui])}}}}return Ye}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,ae,Se){if(Q[ae+Vr]>1){const Le=this.clusterProps[Q[ae+wn]];return Se?Object.assign({},Le):Le}const De=this.points[Q[ae+kr]].properties,Pe=this.options.map(De);return Se&&Pe===De?Object.assign({},Pe):Pe}}function Qr(Qe,Q,ae){return{type:"Feature",id:Qe[Q+kr],properties:Tn(Qe,Q,ae),geometry:{type:"Point",coordinates:[(Se=Qe[Q],360*(Se-.5)),fr(Qe[Q+1])]}};var Se}function Tn(Qe,Q,ae){const Se=Qe[Q+Vr],De=Se>=1e4?`${Math.round(Se/1e3)}k`:Se>=1e3?Math.round(Se/100)/10+"k":Se,Pe=Qe[Q+wn],Le=Pe===-1?{}:Object.assign({},ae[Pe]);return Object.assign(Le,{cluster:!0,cluster_id:Qe[Q+kr],point_count:Se,point_count_abbreviated:De})}function Kt(Qe){return Qe/360+.5}function We(Qe){const Q=Math.sin(Qe*Math.PI/180),ae=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ae<0?0:ae>1?1:ae}function fr(Qe){const Q=(180-360*Qe)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function jr(Qe,Q,ae,Se){let De=Se;const Pe=Q+(ae-Q>>1);let Le,Fe=ae-Q;const Be=Qe[Q],Ye=Qe[Q+1],ht=Qe[ae],Ze=Qe[ae+1];for(let Lt=Q+3;Lt<ae;Lt+=3){const Vt=mr(Qe[Lt],Qe[Lt+1],Be,Ye,ht,Ze);if(Vt>De)Le=Lt,De=Vt;else if(Vt===De){const Ot=Math.abs(Lt-Pe);Ot<Fe&&(Le=Lt,Fe=Ot)}}De>Se&&(Le-Q>3&&jr(Qe,Q,Le,Se),Qe[Le+2]=De,ae-Le>3&&jr(Qe,Le,ae,Se))}function mr(Qe,Q,ae,Se,De,Pe){let Le=De-ae,Fe=Pe-Se;if(Le!==0||Fe!==0){const Be=((Qe-ae)*Le+(Q-Se)*Fe)/(Le*Le+Fe*Fe);Be>1?(ae=De,Se=Pe):Be>0&&(ae+=Le*Be,Se+=Fe*Be)}return Le=Qe-ae,Fe=Q-Se,Le*Le+Fe*Fe}function en(Qe,Q,ae,Se){const De={id:Qe??null,type:Q,geometry:ae,tags:Se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")uo(De,ae);else if(Q==="Polygon")uo(De,ae[0]);else if(Q==="MultiLineString")for(const Pe of ae)uo(De,Pe);else if(Q==="MultiPolygon")for(const Pe of ae)uo(De,Pe[0]);return De}function uo(Qe,Q){for(let ae=0;ae<Q.length;ae+=3)Qe.minX=Math.min(Qe.minX,Q[ae]),Qe.minY=Math.min(Qe.minY,Q[ae+1]),Qe.maxX=Math.max(Qe.maxX,Q[ae]),Qe.maxY=Math.max(Qe.maxY,Q[ae+1])}function Oi(Qe,Q,ae,Se){if(!Q.geometry)return;const De=Q.geometry.coordinates;if(De&&De.length===0)return;const Pe=Q.geometry.type,Le=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2);let Fe=[],Be=Q.id;if(ae.promoteId?Be=Q.properties[ae.promoteId]:ae.generateId&&(Be=Se||0),Pe==="Point")Di(De,Fe);else if(Pe==="MultiPoint")for(const Ye of De)Di(Ye,Fe);else if(Pe==="LineString")ii(De,Fe,Le,!1);else if(Pe==="MultiLineString"){if(ae.lineMetrics){for(const Ye of De)Fe=[],ii(Ye,Fe,Le,!1),Qe.push(en(Be,"LineString",Fe,Q.properties));return}ti(De,Fe,Le,!1)}else if(Pe==="Polygon")ti(De,Fe,Le,!0);else{if(Pe!=="MultiPolygon"){if(Pe==="GeometryCollection"){for(const Ye of Q.geometry.geometries)Oi(Qe,{id:Be,geometry:Ye,properties:Q.properties},ae,Se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ye of De){const ht=[];ti(Ye,ht,Le,!0),Fe.push(ht)}}Qe.push(en(Be,Pe,Fe,Q.properties))}function Di(Qe,Q){Q.push($i(Qe[0]),Zn(Qe[1]),0)}function ii(Qe,Q,ae,Se){let De,Pe,Le=0;for(let Be=0;Be<Qe.length;Be++){const Ye=$i(Qe[Be][0]),ht=Zn(Qe[Be][1]);Q.push(Ye,ht,0),Be>0&&(Le+=Se?(De*ht-Ye*Pe)/2:Math.sqrt(Math.pow(Ye-De,2)+Math.pow(ht-Pe,2))),De=Ye,Pe=ht}const Fe=Q.length-3;Q[2]=1,jr(Q,0,Fe,ae),Q[Fe+2]=1,Q.size=Math.abs(Le),Q.start=0,Q.end=Q.size}function ti(Qe,Q,ae,Se){for(let De=0;De<Qe.length;De++){const Pe=[];ii(Qe[De],Pe,ae,Se),Q.push(Pe)}}function $i(Qe){return Qe/360+.5}function Zn(Qe){const Q=Math.sin(Qe*Math.PI/180),ae=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ae<0?0:ae>1?1:ae}function Ii(Qe,Q,ae,Se,De,Pe,Le,Fe){if(Se/=Q,Pe>=(ae/=Q)&&Le<Se)return Qe;if(Le<ae||Pe>=Se)return null;const Be=[];for(const Ye of Qe){const ht=Ye.geometry;let Ze=Ye.type;const Lt=De===0?Ye.minX:Ye.minY,Vt=De===0?Ye.maxX:Ye.maxY;if(Lt>=ae&&Vt<Se){Be.push(Ye);continue}if(Vt<ae||Lt>=Se)continue;let Ot=[];if(Ze==="Point"||Ze==="MultiPoint")ci(ht,Ot,ae,Se,De);else if(Ze==="LineString")Co(ht,Ot,ae,Se,De,!1,Fe.lineMetrics);else if(Ze==="MultiLineString")oa(ht,Ot,ae,Se,De,!1);else if(Ze==="Polygon")oa(ht,Ot,ae,Se,De,!0);else if(Ze==="MultiPolygon")for(const gr of ht){const wr=[];oa(gr,wr,ae,Se,De,!0),wr.length&&Ot.push(wr)}if(Ot.length){if(Fe.lineMetrics&&Ze==="LineString"){for(const gr of Ot)Be.push(en(Ye.id,Ze,gr,Ye.tags));continue}Ze!=="LineString"&&Ze!=="MultiLineString"||(Ot.length===1?(Ze="LineString",Ot=Ot[0]):Ze="MultiLineString"),Ze!=="Point"&&Ze!=="MultiPoint"||(Ze=Ot.length===3?"Point":"MultiPoint"),Be.push(en(Ye.id,Ze,Ot,Ye.tags))}}return Be.length?Be:null}function ci(Qe,Q,ae,Se,De){for(let Pe=0;Pe<Qe.length;Pe+=3){const Le=Qe[Pe+De];Le>=ae&&Le<=Se&&ta(Q,Qe[Pe],Qe[Pe+1],Qe[Pe+2])}}function Co(Qe,Q,ae,Se,De,Pe,Le){let Fe=Ka(Qe);const Be=De===0?ho:js;let Ye,ht,Ze=Qe.start;for(let wr=0;wr<Qe.length-3;wr+=3){const Mr=Qe[wr],Nr=Qe[wr+1],ui=Qe[wr+2],tn=Qe[wr+3],Jn=Qe[wr+4],Rn=De===0?Mr:Nr,hn=De===0?tn:Jn;let li=!1;Le&&(Ye=Math.sqrt(Math.pow(Mr-tn,2)+Math.pow(Nr-Jn,2))),Rn<ae?hn>ae&&(ht=Be(Fe,Mr,Nr,tn,Jn,ae),Le&&(Fe.start=Ze+Ye*ht)):Rn>Se?hn<Se&&(ht=Be(Fe,Mr,Nr,tn,Jn,Se),Le&&(Fe.start=Ze+Ye*ht)):ta(Fe,Mr,Nr,ui),hn<ae&&Rn>=ae&&(ht=Be(Fe,Mr,Nr,tn,Jn,ae),li=!0),hn>Se&&Rn<=Se&&(ht=Be(Fe,Mr,Nr,tn,Jn,Se),li=!0),!Pe&&li&&(Le&&(Fe.end=Ze+Ye*ht),Q.push(Fe),Fe=Ka(Qe)),Le&&(Ze+=Ye)}let Lt=Qe.length-3;const Vt=Qe[Lt],Ot=Qe[Lt+1],gr=De===0?Vt:Ot;gr>=ae&&gr<=Se&&ta(Fe,Vt,Ot,Qe[Lt+2]),Lt=Fe.length-3,Pe&&Lt>=3&&(Fe[Lt]!==Fe[0]||Fe[Lt+1]!==Fe[1])&&ta(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&Q.push(Fe)}function Ka(Qe){const Q=[];return Q.size=Qe.size,Q.start=Qe.start,Q.end=Qe.end,Q}function oa(Qe,Q,ae,Se,De,Pe){for(const Le of Qe)Co(Le,Q,ae,Se,De,Pe,!1)}function ta(Qe,Q,ae,Se){Qe.push(Q,ae,Se)}function ho(Qe,Q,ae,Se,De,Pe){const Le=(Pe-Q)/(Se-Q);return ta(Qe,Pe,ae+(De-ae)*Le,1),Le}function js(Qe,Q,ae,Se,De,Pe){const Le=(Pe-ae)/(De-ae);return ta(Qe,Q+(Se-Q)*Le,Pe,1),Le}function fa(Qe,Q){const ae=[];for(let Se=0;Se<Qe.length;Se++){const De=Qe[Se],Pe=De.type;let Le;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")Le=pa(De.geometry,Q);else if(Pe==="MultiLineString"||Pe==="Polygon"){Le=[];for(const Fe of De.geometry)Le.push(pa(Fe,Q))}else if(Pe==="MultiPolygon"){Le=[];for(const Fe of De.geometry){const Be=[];for(const Ye of Fe)Be.push(pa(Ye,Q));Le.push(Be)}}ae.push(en(De.id,Pe,Le,De.tags))}return ae}function pa(Qe,Q){const ae=[];ae.size=Qe.size,Qe.start!==void 0&&(ae.start=Qe.start,ae.end=Qe.end);for(let Se=0;Se<Qe.length;Se+=3)ae.push(Qe[Se]+Q,Qe[Se+1],Qe[Se+2]);return ae}function un(Qe,Q){if(Qe.transformed)return Qe;const ae=1<<Qe.z,Se=Qe.x,De=Qe.y;for(const Pe of Qe.features){const Le=Pe.geometry,Fe=Pe.type;if(Pe.geometry=[],Fe===1)for(let Be=0;Be<Le.length;Be+=2)Pe.geometry.push(zn(Le[Be],Le[Be+1],Q,ae,Se,De));else for(let Be=0;Be<Le.length;Be++){const Ye=[];for(let ht=0;ht<Le[Be].length;ht+=2)Ye.push(zn(Le[Be][ht],Le[Be][ht+1],Q,ae,Se,De));Pe.geometry.push(Ye)}}return Qe.transformed=!0,Qe}function zn(Qe,Q,ae,Se,De,Pe){return[Math.round(ae*(Qe*Se-De)),Math.round(ae*(Q*Se-Pe))]}function Cn(Qe,Q,ae,Se,De){const Pe=Q===De.maxZoom?0:De.tolerance/((1<<Q)*De.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:Qe.length,source:null,x:ae,y:Se,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Fe of Qe)Fr(Le,Fe,Pe,De);return Le}function Fr(Qe,Q,ae,Se){const De=Q.geometry,Pe=Q.type,Le=[];if(Qe.minX=Math.min(Qe.minX,Q.minX),Qe.minY=Math.min(Qe.minY,Q.minY),Qe.maxX=Math.max(Qe.maxX,Q.maxX),Qe.maxY=Math.max(Qe.maxY,Q.maxY),Pe==="Point"||Pe==="MultiPoint")for(let Fe=0;Fe<De.length;Fe+=3)Le.push(De[Fe],De[Fe+1]),Qe.numPoints++,Qe.numSimplified++;else if(Pe==="LineString")Bn(Le,De,Qe,ae,!1,!1);else if(Pe==="MultiLineString"||Pe==="Polygon")for(let Fe=0;Fe<De.length;Fe++)Bn(Le,De[Fe],Qe,ae,Pe==="Polygon",Fe===0);else if(Pe==="MultiPolygon")for(let Fe=0;Fe<De.length;Fe++){const Be=De[Fe];for(let Ye=0;Ye<Be.length;Ye++)Bn(Le,Be[Ye],Qe,ae,!0,Ye===0)}if(Le.length){let Fe=Q.tags||null;if(Pe==="LineString"&&Se.lineMetrics){Fe={};for(const Ye in Q.tags)Fe[Ye]=Q.tags[Ye];Fe.mapbox_clip_start=De.start/De.size,Fe.mapbox_clip_end=De.end/De.size}const Be={geometry:Le,type:Pe==="Polygon"||Pe==="MultiPolygon"?3:Pe==="LineString"||Pe==="MultiLineString"?2:1,tags:Fe};Q.id!==null&&(Be.id=Q.id),Qe.features.push(Be)}}function Bn(Qe,Q,ae,Se,De,Pe){const Le=Se*Se;if(Se>0&&Q.size<(De?Le:Se))return void(ae.numPoints+=Q.length/3);const Fe=[];for(let Be=0;Be<Q.length;Be+=3)(Se===0||Q[Be+2]>Le)&&(ae.numSimplified++,Fe.push(Q[Be],Q[Be+1])),ae.numPoints++;De&&function(Be,Ye){let ht=0;for(let Ze=0,Lt=Be.length,Vt=Lt-2;Ze<Lt;Vt=Ze,Ze+=2)ht+=(Be[Ze]-Be[Vt])*(Be[Ze+1]+Be[Vt+1]);if(ht>0===Ye)for(let Ze=0,Lt=Be.length;Ze<Lt/2;Ze+=2){const Vt=Be[Ze],Ot=Be[Ze+1];Be[Ze]=Be[Lt-2-Ze],Be[Ze+1]=Be[Lt-1-Ze],Be[Lt-2-Ze]=Vt,Be[Lt-1-Ze]=Ot}}(Fe,Pe),Qe.push(Fe)}const oi={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class An{constructor(Q,ae){const Se=(ae=this.options=function(Pe,Le){for(const Fe in Le)Pe[Fe]=Le[Fe];return Pe}(Object.create(oi),ae)).debug;if(Se&&console.time("preprocess data"),ae.maxZoom<0||ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ae.promoteId&&ae.generateId)throw new Error("promoteId and generateId cannot be used together.");let De=function(Pe,Le){const Fe=[];if(Pe.type==="FeatureCollection")for(let Be=0;Be<Pe.features.length;Be++)Oi(Fe,Pe.features[Be],Le,Be);else Oi(Fe,Pe.type==="Feature"?Pe:{geometry:Pe},Le);return Fe}(Q,ae);this.tiles={},this.tileCoords=[],Se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ae.indexMaxZoom,ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),De=function(Pe,Le){const Fe=Le.buffer/Le.extent;let Be=Pe;const Ye=Ii(Pe,1,-1-Fe,Fe,0,-1,2,Le),ht=Ii(Pe,1,1-Fe,2+Fe,0,-1,2,Le);return(Ye||ht)&&(Be=Ii(Pe,1,-Fe,1+Fe,0,-1,2,Le)||[],Ye&&(Be=fa(Ye,1).concat(Be)),ht&&(Be=Be.concat(fa(ht,-1)))),Be}(De,ae),De.length&&this.splitTile(De,0,0,0),Se&&(De.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Q,ae,Se,De,Pe,Le,Fe){const Be=[Q,ae,Se,De],Ye=this.options,ht=Ye.debug;for(;Be.length;){De=Be.pop(),Se=Be.pop(),ae=Be.pop(),Q=Be.pop();const Ze=1<<ae,Lt=Nn(ae,Se,De);let Vt=this.tiles[Lt];if(!Vt&&(ht>1&&console.time("creation"),Vt=this.tiles[Lt]=Cn(Q,ae,Se,De,Ye),this.tileCoords.push({z:ae,x:Se,y:De}),ht)){ht>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ae,Se,De,Vt.numFeatures,Vt.numPoints,Vt.numSimplified),console.timeEnd("creation"));const li=`z${ae}`;this.stats[li]=(this.stats[li]||0)+1,this.total++}if(Vt.source=Q,Pe==null){if(ae===Ye.indexMaxZoom||Vt.numPoints<=Ye.indexMaxPoints)continue}else{if(ae===Ye.maxZoom||ae===Pe)continue;if(Pe!=null){const li=Pe-ae;if(Se!==Le>>li||De!==Fe>>li)continue}}if(Vt.source=null,Q.length===0)continue;ht>1&&console.time("clipping");const Ot=.5*Ye.buffer/Ye.extent,gr=.5-Ot,wr=.5+Ot,Mr=1+Ot;let Nr=null,ui=null,tn=null,Jn=null,Rn=Ii(Q,Ze,Se-Ot,Se+wr,0,Vt.minX,Vt.maxX,Ye),hn=Ii(Q,Ze,Se+gr,Se+Mr,0,Vt.minX,Vt.maxX,Ye);Q=null,Rn&&(Nr=Ii(Rn,Ze,De-Ot,De+wr,1,Vt.minY,Vt.maxY,Ye),ui=Ii(Rn,Ze,De+gr,De+Mr,1,Vt.minY,Vt.maxY,Ye),Rn=null),hn&&(tn=Ii(hn,Ze,De-Ot,De+wr,1,Vt.minY,Vt.maxY,Ye),Jn=Ii(hn,Ze,De+gr,De+Mr,1,Vt.minY,Vt.maxY,Ye),hn=null),ht>1&&console.timeEnd("clipping"),Be.push(Nr||[],ae+1,2*Se,2*De),Be.push(ui||[],ae+1,2*Se,2*De+1),Be.push(tn||[],ae+1,2*Se+1,2*De),Be.push(Jn||[],ae+1,2*Se+1,2*De+1)}}getTile(Q,ae,Se){Q=+Q,ae=+ae,Se=+Se;const De=this.options,{extent:Pe,debug:Le}=De;if(Q<0||Q>24)return null;const Fe=1<<Q,Be=Nn(Q,ae=ae+Fe&Fe-1,Se);if(this.tiles[Be])return un(this.tiles[Be],Pe);Le>1&&console.log("drilling down to z%d-%d-%d",Q,ae,Se);let Ye,ht=Q,Ze=ae,Lt=Se;for(;!Ye&&ht>0;)ht--,Ze>>=1,Lt>>=1,Ye=this.tiles[Nn(ht,Ze,Lt)];return Ye&&Ye.source?(Le>1&&(console.log("found parent tile z%d-%d-%d",ht,Ze,Lt),console.time("drilling down")),this.splitTile(Ye.source,ht,Ze,Lt,Q,ae,Se),Le>1&&console.timeEnd("drilling down"),this.tiles[Be]?un(this.tiles[Be],Pe):null):null}}function Nn(Qe,Q,ae){return 32*((1<<Qe)*ae+Q)+Qe}function Xn(Qe,Q){const ae=Qe.tileID.canonical;if(!this._geoJSONIndex)return void Q(null,null);const Se=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!Se)return void Q(null,null);const De=new nt(Se.features);let Pe=St(De);Pe.byteOffset===0&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),Q(null,{vectorTile:De,rawData:Pe.buffer})}class ki extends le{constructor(Q,ae,Se,De,Pe,Le,Fe){super(Q,ae,Se,De,Pe,Xn,Fe),Le&&(this.loadGeoJSON=Le),this._dynamicIndex=new ir}loadData(Q,ae){const Se=Q&&Q.request,De=Se&&Se.collectResourceTiming;this.loadGeoJSON(Q,(Pe,Le)=>{if(Pe||!Le)return ae(Pe);if(typeof Le!="object")return ae(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));{try{if(Q.filter){const Be=o.X(Q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(Ye=>`${Ye.key}: ${Ye.message}`).join(", "));Le.features=Le.features.filter(Ye=>Be.value.evaluate({zoom:0},Ye))}Q.dynamic?(Le.type==="Feature"&&(Le={type:"FeatureCollection",features:[Le]}),Q.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Le.features,this.loaded),Q.cluster&&(Le.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Q.cluster?new Nt(function({superclusterOptions:Be,clusterProperties:Ye}){if(!Ye||!Be)return Be;const ht={},Ze={},Lt={accumulated:null,zoom:0},Vt={properties:null},Ot=Object.keys(Ye);for(const gr of Ot){const[wr,Mr]=Ye[gr],Nr=o.X(Mr),ui=o.X(typeof wr=="string"?[wr,["accumulated"],["get",gr]]:wr);ht[gr]=Nr.value,Ze[gr]=ui.value}return Be.map=gr=>{Vt.properties=gr;const wr={};for(const Mr of Ot)wr[Mr]=ht[Mr].evaluate(Lt,Vt);return wr},Be.reduce=(gr,wr)=>{Vt.properties=wr;for(const Mr of Ot)Lt.accumulated=gr[Mr],gr[Mr]=Ze[Mr].evaluate(Lt,Vt)},Be}(Q)).load(Le.features):Q.dynamic?this._dynamicIndex:function(Be,Ye){return new An(Be,Ye)}(Le,Q.geojsonVtOptions)}catch(Be){return ae(Be)}const Fe={};if(De){const Be=D(Se);Be&&(Fe.resourceTiming={},Fe.resourceTiming[Q.source]=JSON.parse(JSON.stringify(Be)))}ae(null,Fe)}})}reloadTile(Q,ae){const Se=this.loaded;return Se&&Se[Q.uid]?Q.partial?ae(null,void 0):super.reloadTile(Q,ae):this.loadTile(Q,ae)}loadGeoJSON(Q,ae){if(Q.request)o.n(Q.request,ae);else{if(typeof Q.data!="string")return ae(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));try{return ae(null,JSON.parse(Q.data))}catch{return ae(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Q,ae){try{ae(null,this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId))}catch(Se){ae(Se)}}getClusterChildren(Q,ae){try{ae(null,this._geoJSONIndex.getChildren(Q.clusterId))}catch(Se){ae(Se)}}getClusterLeaves(Q,ae){try{ae(null,this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset))}catch(Se){ae(Se)}}}class Dt{constructor(Q,ae){this.tileID=new o.aM(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.tileZoom=Q.tileZoom,this.uid=Q.uid,this.zoom=Q.zoom,this.canonical=Q.tileID.canonical,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Q.projection,this.brightness=ae}parse(Q,ae,Se,De){this.status="parsing";const Pe=new o.aM(Se.tileID.overscaledZ,Se.tileID.wrap,Se.tileID.canonical.z,Se.tileID.canonical.x,Se.tileID.canonical.y),Le=[],Fe=ae.familiesBySource[Se.source],Be=new o.f0(Pe,Se.promoteId);Be.bucketLayerIDs=[],Be.is3DTile=!0,o.fi(Q).then(Ye=>{if(!Ye)return De(new Error("Could not parse tile"));const ht=o.fj(Ye,1/o.cT(Se.tileID.canonical)),Ze=Ye.json.extensionsUsed&&Ye.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ye.json.asset.extras&&Ye.json.asset.extras.MAPBOX_mesh_features,Lt=Ye.json.extensionsUsed&&Ye.json.extensionsUsed.includes("EXT_meshopt_compression"),Vt=new o.aa(this.zoom,{brightness:this.brightness});for(const Ot in Fe)for(const gr of Fe[Ot]){const wr=gr[0];Be.bucketLayerIDs.push(gr.map(Nr=>o.C(Nr.id,Nr.scope))),wr.recalculate(Vt,[]);const Mr=new o.fk(gr,ht,Pe,Ze,Lt,this.brightness,Be);Ze||(Mr.needsUpload=!0),Le.push(Mr),Mr.evaluate(wr)}this.status="done",De(null,{buckets:Le,featureIndex:Be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ye=>De(new Error(Ye.message)))}}class mi{constructor(Q,ae,Se,De,Pe,Le,Fe){this.actor=Q,this.layerIndex=ae,this.availableImages=Se,this.availableModels=De,this.brightness=Fe,this.loading={},this.loaded={}}loadTile(Q,ae){const Se=Q.uid,De=this.loading[Se]=new Dt(Q,this.brightness);o.br(Q.request,(Pe,Le)=>{const Fe=!this.loading[Se];return delete this.loading[Se],Fe||Pe?(De.status="done",Fe||(this.loaded[Se]=De),ae(Pe)):Le&&Le.byteLength!==0?void De.parse(Le,this.layerIndex,Q,(Be,Ye)=>{De.status="done",this.loaded=this.loaded||{},this.loaded[Se]=De,Be||!Ye?ae(Be):ae(null,Ye)}):(De.status="done",this.loaded[Se]=De,ae())})}reloadTile(Q,ae){const Se=this.loaded,De=Q.uid;if(Se&&Se[De]){const Pe=Se[De];Pe.projection=Q.projection,Pe.brightness=Q.brightness;const Le=(Fe,Be)=>{Pe.reloadCallback&&(delete Pe.reloadCallback,this.loadTile(Q,ae)),ae(Fe,Be)};Pe.status==="parsing"?Pe.reloadCallback=Le:Pe.status==="done"&&this.loadTile(Q,ae)}}abortTile(Q,ae){const Se=Q.uid;this.loading[Se]&&delete this.loading[Se],ae()}removeTile(Q,ae){const Se=this.loaded,De=Q.uid;Se&&Se[De]&&delete Se[De],ae()}}class Ki{constructor(Q){this.self=Q,this.actor=new o.fm(Q,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.y,this.projections={},this.defaultProjection=o.ce({name:"mercator"}),this.workerSourceTypes={vector:le,geojson:ki,"raster-dem":xe,"raster-array":ke,"batched-model":mi},this.workerSources={},this.self.registerWorkerSource=(ae,Se)=>{if(this.workerSourceTypes[ae])throw new Error(`Worker source with name "${ae}" already registered.`);this.workerSourceTypes[ae]=Se},this.self.registerRTLTextPlugin=ae=>{if(o.fn.isParsed())throw new Error("RTL text plugin already registered.");o.fn.applyArabicShaping=ae.applyArabicShaping,o.fn.processBidirectionalText=ae.processBidirectionalText,o.fn.processStyledBidirectionalText=ae.processStyledBidirectionalText}}clearCaches(Q,ae,Se){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.availableModels[Q],delete this.workerSources[Q],Se()}checkIfReady(Q,ae,Se){Se()}setReferrer(Q,ae){this.referrer=ae}spriteLoaded(Q,ae){this.isSpriteLoaded[Q]||(this.isSpriteLoaded[Q]={});const{scope:Se,isLoaded:De}=ae;if(this.isSpriteLoaded[Q][Se]=De,this.workerSources[Q]&&this.workerSources[Q][Se])for(const Pe in this.workerSources[Q][Se]){const Le=this.workerSources[Q][Se][Pe];for(const Fe in Le){const Be=Le[Fe];Be instanceof le&&(Be.isSpriteLoaded=De,Be.fire(new o.A("isSpriteLoaded")))}}}setImages(Q,ae,Se){this.availableImages[Q]||(this.availableImages[Q]={});const{scope:De,images:Pe}=ae;if(this.availableImages[Q][De]=Pe,this.workerSources[Q]&&this.workerSources[Q][De]){for(const Le in this.workerSources[Q][De]){const Fe=this.workerSources[Q][De][Le];for(const Be in Fe)Fe[Be].availableImages=Pe}Se()}else Se()}setModels(Q,{scope:ae,models:Se},De){if(this.availableModels[Q]||(this.availableModels[Q]={}),this.availableModels[Q][ae]=Se,this.workerSources[Q]&&this.workerSources[Q][ae]){for(const Pe in this.workerSources[Q][ae]){const Le=this.workerSources[Q][ae][Pe];for(const Fe in Le)Le[Fe].availableModels=Se}De()}else De()}setProjection(Q,ae){this.projections[Q]=o.ce(ae)}setBrightness(Q,ae,Se){this.brightness=ae,Se()}setLayers(Q,ae,Se){this.getLayerIndex(Q,ae.scope).replace(ae.layers,ae.options),Se()}updateLayers(Q,ae,Se){this.getLayerIndex(Q,ae.scope).update(ae.layers,ae.removedIds,ae.options),Se()}loadTile(Q,ae,Se){ae.projection=this.projections[Q]||this.defaultProjection,this.getWorkerSource(Q,ae.type,ae.source,ae.scope).loadTile(ae,Se)}decodeRasterArray(Q,ae,Se){this.getWorkerSource(Q,ae.type,ae.source,ae.scope).decodeRasterArray(ae,Se)}reloadTile(Q,ae,Se){ae.projection=this.projections[Q]||this.defaultProjection,this.getWorkerSource(Q,ae.type,ae.source,ae.scope).reloadTile(ae,Se)}abortTile(Q,ae,Se){this.getWorkerSource(Q,ae.type,ae.source,ae.scope).abortTile(ae,Se)}removeTile(Q,ae,Se){this.getWorkerSource(Q,ae.type,ae.source,ae.scope).removeTile(ae,Se)}removeSource(Q,ae,Se){if(!(this.workerSources[Q]&&this.workerSources[Q][ae.scope]&&this.workerSources[Q][ae.scope][ae.type]&&this.workerSources[Q][ae.scope][ae.type][ae.source]))return;const De=this.workerSources[Q][ae.scope][ae.type][ae.source];delete this.workerSources[Q][ae.scope][ae.type][ae.source],De.removeSource!==void 0?De.removeSource(ae,Se):Se()}loadWorkerSource(Q,ae,Se){try{this.self.importScripts(ae.url),Se()}catch(De){Se(De.toString())}}syncRTLPluginState(Q,ae,Se){try{o.fn.setState(ae);const De=o.fn.getPluginURL();if(o.fn.isLoaded()&&!o.fn.isParsed()&&De!=null){this.self.importScripts(De);const Pe=o.fn.isParsed();Se(Pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${De}`),Pe)}}catch(De){Se(De.toString())}}setDracoUrl(Q,ae){this.dracoUrl=ae}getAvailableImages(Q,ae){this.availableImages[Q]||(this.availableImages[Q]={});let Se=this.availableImages[Q][ae];return Se||(Se=[]),Se}getAvailableModels(Q,ae){this.availableModels[Q]||(this.availableModels[Q]={});let Se=this.availableModels[Q][ae];return Se||(Se={}),Se}getLayerIndex(Q,ae){this.layerIndexes[Q]||(this.layerIndexes[Q]={});let Se=this.layerIndexes[Q][ae];return Se||(Se=this.layerIndexes[Q][ae]=new $,Se.scope=ae),Se}getWorkerSource(Q,ae,Se,De){const Pe=this.workerSources;return Pe[Q]||(Pe[Q]={}),Pe[Q][De]||(Pe[Q][De]={}),Pe[Q][De][ae]||(Pe[Q][De][ae]={}),this.isSpriteLoaded[Q]||(this.isSpriteLoaded[Q]={}),Pe[Q][De][ae][Se]||(Pe[Q][De][ae][Se]=new this.workerSourceTypes[ae]({send:(Le,Fe,Be,Ye,ht,Ze)=>this.actor.send(Le,Fe,Be,Q,ht,Ze),scheduler:this.actor.scheduler},this.getLayerIndex(Q,De),this.getAvailableImages(Q,De),this.getAvailableModels(Q,De),this.isSpriteLoaded[Q][De],void 0,this.brightness)),Pe[Q][De][ae][Se]}rasterizeImagesWorker(Q,ae,Se){const De=new Map;for(const[Pe,{image:Le,imageVariant:Fe}]of ae.tasks.entries()){const Be=this.imageRasterizer.rasterize(Fe,Le,ae.scope,Q);De.set(Pe,Be)}Se(void 0,De)}removeRasterizedImages(Q,ae,Se){this.imageRasterizer.removeImagesFromCacheByIds(ae.imageIds,ae.scope,Q),Se()}enforceCacheSizeLimit(Q,ae){o.fo(ae)}getWorkerPerformanceMetrics(Q,ae,Se){Se(void 0,void 0)}}return o.fl(self)&&(self.worker=new Ki(self)),Ki}),b(["./shared"],function(o){var D="3.12.0";const k={create:"create",load:"load",fullLoad:"fullLoad"},L={mark(d){performance.mark(d)},measure(d,r,s){performance.measure(d,r,s)}};function $(d){const r=d.name.split("?")[0];return o.a(r)&&r.includes("mapbox-gl.js")?"javascript":o.a(r)&&r.includes("mapbox-gl.css")?"css":o.b(r)?"fontRange":o.c(r)?"sprite":o.i(r)?"style":o.d(r)?"tilejson":"other"}var q,Z={},ie=function(){if(q)return Z;function d(f){return!r(f)}function r(f){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,S,E=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(E);try{S=new Worker(C),x=!0}catch{x=!1}return S&&S.terminate(),URL.revokeObjectURL(C),x}()?function(){var x=document.createElement("canvas");x.width=x.height=1;var S=x.getContext("2d");if(!S)return!1;var E=S.getImageData(0,0,1,1);return E&&E.width===x.width}()?(s[_=f&&f.failIfMajorPerformanceCaveat]===void 0&&(s[_]=function(x){var S,E=function(C){var R=document.createElement("canvas"),F=Object.create(d.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=C,R.getContext("webgl2",F)}(x);if(!E)return!1;try{S=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!S||E.isContextLost())&&(E.shaderSource(S,"void main() {}"),E.compileShader(S),E.getShaderParameter(S,E.COMPILE_STATUS)===!0)}(_)),s[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}q=1,Z.supported=d,Z.notSupportedReason=r;var s={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Z}();function oe(d,r,s){const f=document.createElement(d);return r!=null&&(f.className=r),s&&s.appendChild(f),f}function le(d,r,s){const f=document.createElementNS("http://www.w3.org/2000/svg",d);for(const _ of Object.keys(r))f.setAttributeNS(null,_,String(r[_]));return s&&s.appendChild(f),f}const xe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ge=xe&&xe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ke;function et(){xe&&ge&&(ke=xe[ge],xe[ge]="none")}function ze(){xe&&ge&&(xe[ge]=ke)}function nt(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",nt,!0)}function pt(){window.addEventListener("click",nt,!0),window.setTimeout(()=>{window.removeEventListener("click",nt,!0)},0)}function Gt(d,r){const s=d.getBoundingClientRect();return Zt(d,s,r)}function ir(d,r){const s=d.getBoundingClientRect(),f=[];for(let _=0;_<r.length;_++)f.push(Zt(d,s,r[_]));return f}function Br(d){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&d.button===2&&d.ctrlKey?0:d.button}function Zt(d,r,s){const f=d.offsetWidth===r.width?1:d.offsetWidth/r.width;return new o.P((s.clientX-r.left)*f,(s.clientY-r.top)*f)}const dr="01",Dr="NO_ACCESS_TOKEN";class vr{constructor(r,s,f){this._transformRequestFn=r,this._customAccessToken=s,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){const r=function(){let s="";for(let f=0;f<10;f++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",dr,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,s){return this._transformRequestFn&&this._transformRequestFn(r,s)||{url:r}}normalizeStyleURL(r,s){if(!o.f(r))return r;const f=zr(r);return f.params.push(`sdk=js-${D}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||s)}normalizeGlyphsURL(r,s){if(!o.f(r))return r;const f=zr(r);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||s)}normalizeModelURL(r,s){if(!o.f(r))return r;const f=zr(r);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||s)}normalizeSourceURL(r,s,f,_){if(!o.f(r))return r;const x=zr(r);return x.path=`/v4/${x.authority}.json`,x.params.push("secure"),f&&x.params.push(`language=${f}`),_&&x.params.push(`worldview=${_}`),this._makeAPIURL(x,this._customAccessToken||s)}normalizeIconsetURL(r,s){const f=zr(r);return o.f(r)?(f.path=`/styles/v1${f.path}/iconset.pbf`,this._makeAPIURL(f,this._customAccessToken||s)):qr(f)}normalizeSpriteURL(r,s,f,_){const x=zr(r);return o.f(r)?(x.path=`/styles/v1${x.path}/sprite${s}${f}`,this._makeAPIURL(x,this._customAccessToken||_)):(x.path+=`${s}${f}`,qr(x))}normalizeTileURL(r,s,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!o.f(r))return r;const _=zr(r);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||f&&_.authority!=="raster"&&f===512?"@2x":""}${o.m.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${o.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${o.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${o.e.TILE_URL_VERSION}${_.path}`);const x=this._customAccessToken||function(S){for(const E of S){const C=E.match(/^access_token=(.*)$/);if(C)return C[1]}return null}(_.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,x)}canonicalizeTileURL(r,s){const f=zr(r);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return r;let _="mapbox://";f.path.match(/^\/raster\/v1\//)?_+=`raster/${f.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${f.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${f.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let x=f.params;return s&&(x=x.filter(S=>!S.match(/^access_token=/))),x.length&&(_+=`?${x.join("&")}`),_}canonicalizeTileset(r,s){const f=!!s&&o.f(s),_=[];for(const x of r.tiles||[])o.h(x)?_.push(this.canonicalizeTileURL(x,f)):_.push(x);return _}_makeAPIURL(r,s){const f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=zr(o.e.API_URL);if(r.protocol=_.protocol,r.authority=_.authority,r.protocol==="http"){const x=r.params.indexOf("secure");x>=0&&r.params.splice(x,1)}if(_.path!=="/"&&(r.path=`${_.path}${r.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return qr(r);if(s=s||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return r.params=r.params.filter(x=>x.indexOf("access_token")===-1),r.params.push(`access_token=${s||""}`),qr(r)}}const Ar=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function zr(d){const r=d.match(Ar);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function qr(d){const r=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${r}`}const lr="mapbox.eventData";function br(d){if(!d)return null;const r=d.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(o.j(r[1]))}catch{return null}}class Ft{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const s=br(o.e.ACCESS_TOKEN);let f="";return f=s&&s.u?o.k(s.u):o.e.ACCESS_TOKEN||"",r?`${lr}.${r}:${f}`:`${lr}:${f}`}fetchEventData(){const r=o.s("localStorage"),s=this.getStorageKey(),f=this.getStorageKey("uuid");if(r)try{const _=localStorage.getItem(s);_&&(this.eventData=JSON.parse(_));const x=localStorage.getItem(f);x&&(this.anonId=x)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const r=o.s("localStorage"),s=this.getStorageKey(),f=this.getStorageKey("uuid"),_=this.anonId;if(r&&_)try{localStorage.setItem(f,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,s,f,_){if(!o.e.EVENTS_URL)return;const x=zr(o.e.EVENTS_URL);x.params.push(`access_token=${_||o.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(r).toISOString()},E=s?o.l(S,s):S,C={url:qr(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([E])};this.pendingRequest=o.p(C,R=>{this.pendingRequest=null,f(R),this.saveEventData(),this.processRequests(_)})}queueRequest(r,s){this.queue.push(r),this.processRequests(s)}}const ot=new class extends Ft{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,r){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some(s=>o.f(s)||o.h(s))&&this.queueRequest(Date.now(),r)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=br(o.e.ACCESS_TOKEN),s=r?r.u:o.e.ACCESS_TOKEN;let f=s!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),f=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),S=new Date(_),E=(_-this.eventData.lastSuccess)/864e5;f=f||E>=1||E<-1||x.getDate()!==S.getDate()}else f=!0;f?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:D,skuId:dr,"enabled.telemetry":!1,userId:this.anonId},x=>{x||(this.eventData.lastSuccess=_,this.eventData.tokenU=s)},d):this.processRequests()}},St=ot.postTurnstileEvent.bind(ot),Ur=new class extends Ft{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,r,s,f){this.skuToken=r,this.errorCb=f,o.e.EVENTS_URL&&(s||o.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},s):this.errorCb(new Error(Dr)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:s}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:D,skuId:dr,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):r&&(this.success[r]=!0)},d))}remove(){this.errorCb=null}},gn=Ur.postMapLoadEvent.bind(Ur),Sr=new class extends Ft{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let r=this.mapInstanceIdMap.get(d);return r||(r=o.u(),this.mapInstanceIdMap.set(d,r)),r}getEventId(d){const r=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,r+1),r}postStyleLoadEvent(d,r){const{map:s,style:f,importedStyles:_}=r;if(!o.e.EVENTS_URL||!d&&!o.e.ACCESS_TOKEN)return;const x=this.getMapInstanceId(s),S={mapInstanceId:x,eventId:this.getEventId(x),style:f};_.length&&(S.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:S},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,payload:s}=this.queue.shift();this.postEvent(r,s,()=>{},d)}},kr=Sr.postStyleLoadEvent.bind(Sr),Vr=new class extends Ft{constructor(){super("gljs.performance")}postPerformanceEvent(d,r){o.e.EVENTS_URL&&(d||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:s}=this.queue.shift(),f=function(_){const x=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),E=function(G){const J={};if(G){for(const Y in G)if(Y!=="other")for(const te of G[Y]){const K=`${Y}ResolveRangeMin`,ce=`${Y}ResolveRangeMax`,fe=`${Y}RequestCount`,pe=`${Y}RequestCachedCount`;J[K]=Math.min(J[K]||1/0,te.startTime),J[ce]=Math.max(J[ce]||-1/0,te.responseEnd);const Ee=Te=>{J[Te]===void 0&&(J[Te]=0),++J[Te]};te.transferSize!==void 0&&te.transferSize===0&&Ee(pe),Ee(fe)}}return J}(function(G,J){const Y={};if(G)for(const te of G){const K=J(te);Y[K]===void 0&&(Y[K]=[]),Y[K].push(te)}return Y}(x,$)),C=window.devicePixelRatio,R=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=R?R.effectiveType:void 0,j={counters:[],metadata:[],attributes:[]},B=(G,J,Y)=>{Y!=null&&G.push({name:J,value:Y.toString()})};for(const G in E)B(j.counters,G,E[G]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(B(j.counters,"interactionRangeMin",_.interactionRange[0]),B(j.counters,"interactionRangeMax",_.interactionRange[1])),S)for(const G of Object.keys(k)){const J=k[G],Y=S.find(te=>te.name===J);Y&&B(j.counters,J,Y.startTime)}return B(j.counters,"visibilityHidden",_.visibilityHidden),B(j.attributes,"style",function(G){if(G)for(const J of G){const Y=J.name.split("?")[0];if(o.i(Y)){const te=Y.split("/").slice(-2);if(te.length===2)return`mapbox://styles/${te[0]}/${te[1]}`}}}(x)),B(j.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),B(j.attributes,"fogEnabled",_.fogEnabled?"true":"false"),B(j.attributes,"projection",_.projection),B(j.attributes,"zoom",_.zoom),B(j.metadata,"devicePixelRatio",C),B(j.metadata,"connectionEffectiveType",F),B(j.metadata,"navigatorUserAgent",navigator.userAgent),B(j.metadata,"screenWidth",window.screen.width),B(j.metadata,"screenHeight",window.screen.height),B(j.metadata,"windowWidth",window.innerWidth),B(j.metadata,"windowHeight",window.innerHeight),B(j.metadata,"mapWidth",_.width/C),B(j.metadata,"mapHeight",_.height/C),B(j.metadata,"webglRenderer",_.renderer),B(j.metadata,"webglVendor",_.vendor),B(j.metadata,"sdkVersion",D),B(j.metadata,"sdkIdentifier","mapbox-gl-js"),j}(s);for(const _ of f.metadata);for(const _ of f.counters);for(const _ of f.attributes);this.postEvent(r,f,()=>{},d)}},wn=Vr.postPerformanceEvent.bind(Vr),Nt=new class extends Ft{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,r,s,f){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const _=zr(o.e.API_URL+o.e.SESSION_PATH);_.params.push(`sku=${r||""}`),_.params.push(`access_token=${f||o.e.ACCESS_TOKEN||""}`);const x={url:qr(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(x,S=>{this.pendingRequest=null,s(S),this.saveEventData(),this.processRequests(f)})}getSessionAPI(d,r,s,f){this.skuToken=r,this.errorCb=f,o.e.SESSION_PATH&&o.e.API_URL&&(s||o.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},s):this.errorCb(new Error(Dr)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:s}=this.queue.shift();r&&this.success[r]||this.getSession(s,this.skuToken,f=>{f?this.errorCb(f):r&&(this.success[r]=!0)},d)}remove(){this.errorCb=null}},Qr=Nt.getSessionAPI.bind(Nt),Tn=new Set;function Kt(d,r){r?Tn.add(d):Tn.delete(d)}class We{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,s){this._updatedSourceCaches[r]=s,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const s=r.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(r.id),this.setDirty()}removeLayer(r){const s=r.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][r.id]=r,this._updatedLayers[s].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const s in this._updatedLayers)r[s]=r[s]||{},r[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)r[s]=r[s]||{},r[s].removedIds=Object.keys(this._removedLayers[s]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(r){return this._updatedImages[r]?Array.from(this._updatedImages[r].values()):[]}updateImage(r,s){this._updatedImages[s]=this._updatedImages[s]||new Set,this._updatedImages[s].add(o.I.toString(r)),this.setDirty()}resetUpdatedImages(r){this._updatedImages[r]&&this._updatedImages[r].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function fr(d){const{userImage:r}=d;return!!(r&&r.render&&r.render())&&(d.data.replace(new Uint8Array(r.data.buffer)),!0)}class jr extends o.E{constructor(r){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=r,r!=="raster"&&o.t()&&(this.imageRasterizerDispatcher=new o.D(o.x(),this,"Image Rasterizer Worker",1))}addScope(r){this.loaded.set(r,!1),this.imageProviders.set(r,new Map),this.images.set(r,new Map),this.updatedImages.set(r,new Set),this.callbackDispatchedThisFrame.set(r,new Set),this.patterns.set(r,new Map),this.atlasImage.set(r,new o.r({width:1,height:1}))}removeScope(r){this.loaded.delete(r),this.imageProviders.delete(r),this.images.delete(r),this.updatedImages.delete(r),this.callbackDispatchedThisFrame.delete(r),this.patterns.delete(r),this.atlasImage.delete(r);const s=this.atlasTexture.get(r);s&&(s.destroy(),this.atlasTexture.delete(r))}addImageProvider(r,s){this.imageProviders.has(s)||this.imageProviders.set(s,new Map),this.imageProviders.get(s).set(r.id,r)}removeImageProvider(r,s){this.imageProviders.has(s)&&this.imageProviders.get(s).delete(r)}getPendingImageProviders(){const r=[];for(const s of this.imageProviders.values())for(const f of s.values())f.hasPendingRequests()&&r.push(f);return r}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.y),this._imageRasterizer}isLoaded(){for(const r of this.loaded.keys())if(!this.loaded.get(r))return!1;return!0}setLoaded(r,s){if(this.loaded.get(s)!==r&&(this.loaded.set(s,r),r)){for(const{ids:f,callback:_}of this.requestors)this._notify(f,s,_);this.requestors=[]}}hasImage(r,s){return!!this.getImage(r,s)}getImage(r,s){return this.images.get(s).get(r.toString())}addImage(r,s,f){this._validate(r,f)&&this.images.get(s).set(r.toString(),f)}_validate(r,s){let f=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.z(new Error(`Image "${r.name}" has invalid "stretchX" value`))),f=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.z(new Error(`Image "${r.name}" has invalid "stretchY" value`))),f=!1),this._validateContent(s.content,s)||(this.fire(new o.z(new Error(`Image "${r.name}" has invalid "content" value`))),f=!1),f}_validateStretch(r,s){if(!r)return!0;let f=0;for(const _ of r){if(_[0]<f||_[1]<_[0]||s<_[1])return!1;f=_[1]}return!0}_validateContent(r,s){return r?r.length!==4||!s.usvg&&(r[0]<0||s.data.width<r[0]||r[1]<0||s.data.height<r[1]||r[2]<0||s.data.width<r[2]||r[3]<0||s.data.height<r[3])?!1:!(r[2]<r[0]||r[3]<r[1]):!0}updateImage(r,s,f){const _=this.images.get(s).get(r.toString());f.version=_.version+1,this.images.get(s).set(r.toString(),f),this.updatedImages.get(s).add(r),this.removeFromImageRasterizerCache(r,s)}clearUpdatedImages(r){this.updatedImages.get(r).clear()}removeFromImageRasterizerCache(r,s){this.spriteFormat!=="raster"&&(o.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[r],scope:s}):this.imageRasterizer.removeImagesFromCacheByIds([r],s))}removeImage(r,s){const f=this.images.get(s),_=f.get(r.toString());f.delete(r.toString()),this.patterns.get(s).delete(r.toString()),this.removeFromImageRasterizerCache(r,s),_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(r){return Array.from(this.images.get(r).keys()).map(s=>o.I.from(s))}getImages(r,s,f){const _=[],x=[],S=this.imageProviders.get(s);for(const F of r){if(!F.iconsetId){_.push(F);continue}const j=S.get(F.iconsetId);j&&(this.getImage(F,s)?x.push(F):j.addPendingRequest(F))}if(_.length===0)return void this._notify(x,s,f);let E=!0;const C=!!this.loaded.get(s),R=this.images.get(s);if(!C)for(const F of _)R.has(F.toString())||(E=!1);C||E?this._notify(_,s,f):this.requestors.push({ids:_,scope:s,callback:f})}rasterizeImages(r,s){const f=new Map,{tasks:_,scope:x}=r;for(const[S,E]of _.entries()){const C=this.getImage(E.id,x);C&&f.set(S,{image:C,imageVariant:E})}this._rasterizeImages(x,f,s)}_rasterizeImages(r,s,f){if(o.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:s,scope:r},f);else{const _=new Map;for(const[x,{image:S,imageVariant:E}]of s.entries())_.set(x,this.imageRasterizer.rasterize(E,S,r,0));f(void 0,_)}}getUpdatedImages(r){return this.updatedImages.get(r)||new Set}_notify(r,s,f){const _=this.images.get(s),x=new Map;for(const S of r){if(!_.get(S.toString())){if(S.iconsetId)continue;this.fire(new o.A("styleimagemissing",{id:S.name}))}const E=_.get(S.toString());if(!E){o.w(`Image "${S.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const C={data:E.usvg?null:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,usvg:E.usvg,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)};E.usvg&&Object.assign(C,{width:E.icon.usvg_tree.width,height:E.icon.usvg_tree.height}),x.set(o.I.toString(S),C)}f(null,x)}getPixelSize(r){const{width:s,height:f}=this.atlasImage.get(r);return{width:s,height:f}}getPattern(r,s,f){const _=r.toString(),x=this.patterns.get(s),S=x.get(_),E=this.getImage(r,s);if(!E)return null;if(S){if(S.position.version===E.version)return S.position;S.position.version=E.version}else{if(E.usvg&&!E.data){const C=this.getPatternInFlightId(_,s);if(this.patternsInFlight.has(C))return null;this.patternsInFlight.add(C);const R=new o.B(r).scaleSelf(o.q.devicePixelRatio),F=new Map([[R.toString(),{image:E,imageVariant:R}]]);return this._rasterizeImages(s,F,(j,B)=>this.storePatternImage(R,s,E,f,B)),null}this.storePattern(r,s,E)}return this._updatePatternAtlas(s,f),x.get(_).position}getPatternInFlightId(r,s){return o.C(r,s)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(r,s,f,_,x){const S=r.toString(),E=x?x.get(S):void 0;E&&(f.data=E,this.storePattern(r.id,s,f),this._updatePatternAtlas(s,_),this.patternsInFlight.delete(this.getPatternInFlightId(r.id.toString(),s)))}storePattern(r,s,f){const _={w:f.data.width+2*o.F,h:f.data.height+2*o.F,x:0,y:0},x=new o.G(_,f,o.F);this.patterns.get(s).set(r.toString(),{bin:_,position:x})}bind(r,s){const f=r.gl;let _=this.atlasTexture.get(s);_?this.dirty&&(_.update(this.atlasImage.get(s)),this.dirty=!1):(_=new o.T(r,this.atlasImage.get(s),f.RGBA8),this.atlasTexture.set(s,_)),_.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(r,s){const f=this.patterns.get(r),_=Array.from(f.values()).map(({bin:R})=>R),{w:x,h:S}=o.H(_),E=this.atlasImage.get(r);E.resize({width:x||1,height:S||1});const C=this.images.get(r);for(const[R,{bin:F,position:j}]of f.entries()){let B=j.padding;const G=F.x+B,J=F.y+B,Y=C.get(R).data,te=Y.width,K=Y.height;B=B>1?B-1:B,o.r.copy(Y,E,{x:0,y:0},{x:G,y:J},{width:te,height:K},s),o.r.copy(Y,E,{x:0,y:K-B},{x:G,y:J-B},{width:te,height:B},s),o.r.copy(Y,E,{x:0,y:0},{x:G,y:J+K},{width:te,height:B},s),o.r.copy(Y,E,{x:te-B,y:0},{x:G-B,y:J},{width:B,height:K},s),o.r.copy(Y,E,{x:0,y:0},{x:G+te,y:J},{width:B,height:K},s),o.r.copy(Y,E,{x:te-B,y:K-B},{x:G-B,y:J-B},{width:B,height:B},s),o.r.copy(Y,E,{x:0,y:K-B},{x:G+te,y:J-B},{width:B,height:B},s),o.r.copy(Y,E,{x:0,y:0},{x:G+te,y:J+K},{width:B,height:B},s),o.r.copy(Y,E,{x:te-B,y:0},{x:G-B,y:J+K},{width:B,height:B},s)}this.dirty=!0}beginFrame(){for(const r of this.images.keys())this.callbackDispatchedThisFrame.set(r,new Set)}dispatchRenderCallbacks(r,s){const f=this.images.get(s);for(const _ of r){if(this.callbackDispatchedThisFrame.get(s).has(_.toString()))continue;this.callbackDispatchedThisFrame.get(s).add(_.toString());const x=f.get(_.toString());fr(x)&&this.updateImage(_,s,x)}}}function mr(d){const r=d.key,s=d.value,f=d.valueSpec||{},_=d.objectElementValidators||{},x=d.style,S=d.styleSpec;let E=[];const C=o.K(s);if(C!=="object")return[new o.V(r,s,`object expected, ${C} found`)];for(const R in s){const F=R.split(".")[0];let j;_[F]?j=_[F]:f[F]?j=Fr:_["*"]?j=_["*"]:f["*"]&&(j=Fr),j?E=E.concat(j({key:(r&&`${r}.`)+R,value:s[R],valueSpec:f[F]||f["*"],style:x,styleSpec:S,object:s,objectKey:R},s)):E.push(new o.J(r,s[R],`unknown property "${R}"`))}for(const R in f)_[R]||f[R].required&&f[R].default===void 0&&s[R]===void 0&&E.push(new o.V(r,s,`missing required property "${R}"`));return E}function en(d){const r=d.value,s=d.valueSpec,f=d.style,_=d.styleSpec,x=d.key,S=d.arrayElementValidator||Fr;if(o.K(r)!=="array")return[new o.V(x,r,`array expected, ${o.K(r)} found`)];if(s.length&&r.length!==s.length)return[new o.V(x,r,`array length ${s.length} expected, length ${r.length} found`)];if(s["min-length"]&&r.length<s["min-length"])return[new o.V(x,r,`array length at least ${s["min-length"]} expected, length ${r.length} found`)];let E={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};_.$version<7&&(E.function=s.function),o.K(s.value)==="object"&&(E=s.value);let C=[];for(let R=0;R<r.length;R++)C=C.concat(S({array:r,arrayIndex:R,value:r[R],valueSpec:E,style:f,styleSpec:_,key:`${x}[${R}]`},!0));return C}function uo(d){const r=d.key,s=d.value,f=d.valueSpec;let _=o.K(s);if(_==="number"&&s!=s&&(_="NaN"),_!=="number")return[new o.V(r,s,`number expected, ${_} found`)];if("minimum"in f){let x=f.minimum;if(o.K(f.minimum)==="array"&&(x=f.minimum[d.arrayIndex]),s<x)return[new o.V(r,s,`${s} is less than the minimum value ${x}`)]}if("maximum"in f){let x=f.maximum;if(o.K(f.maximum)==="array"&&(x=f.maximum[d.arrayIndex]),s>x)return[new o.V(r,s,`${s} is greater than the maximum value ${x}`)]}return[]}function Oi(d){const r=d.valueSpec,s=o.M(d.value.type);let f,_,x,S={};const E=s!=="categorical"&&d.value.property===void 0,C=!E,R=o.K(d.value.stops)==="array"&&o.K(d.value.stops[0])==="array"&&o.K(d.value.stops[0][0])==="object",F=mr({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(G){if(s==="identity")return[new o.V(G.key,G.value,'identity function may not have a "stops" property')];let J=[];const Y=G.value;return J=J.concat(en({key:G.key,value:Y,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:j})),o.K(Y)==="array"&&Y.length===0&&J.push(new o.V(G.key,Y,"array must have at least one stop")),J},default:function(G){return Fr({key:G.key,value:G.value,valueSpec:r,style:G.style,styleSpec:G.styleSpec})}}});return s==="identity"&&E&&F.push(new o.V(d.key,d.value,'missing required property "property"')),s==="identity"||d.value.stops||F.push(new o.V(d.key,d.value,'missing required property "stops"')),s==="exponential"&&d.valueSpec.expression&&!o.N(d.valueSpec)&&F.push(new o.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(C&&!o.O(d.valueSpec)?F.push(new o.V(d.key,d.value,"property functions not supported")):E&&!o.Q(d.valueSpec)&&F.push(new o.V(d.key,d.value,"zoom functions not supported"))),s!=="categorical"&&!R||d.value.property!==void 0||F.push(new o.V(d.key,d.value,'"property" property is required')),F;function j(G){let J=[];const Y=G.value,te=G.key;if(o.K(Y)!=="array")return[new o.V(te,Y,`array expected, ${o.K(Y)} found`)];if(Y.length!==2)return[new o.V(te,Y,`array length 2 expected, length ${Y.length} found`)];if(R){if(o.K(Y[0])!=="object")return[new o.V(te,Y,`object expected, ${o.K(Y[0])} found`)];if(Y[0].zoom===void 0)return[new o.V(te,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new o.V(te,Y,"object stop key must have value")];const K=o.M(Y[0].zoom);if(typeof K!="number")return[new o.V(te,Y[0].zoom,"stop zoom values must be numbers")];if(x&&x>K)return[new o.V(te,Y[0].zoom,"stop zoom values must appear in ascending order")];K!==x&&(x=K,_=void 0,S={}),J=J.concat(mr({key:`${te}[0]`,value:Y[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:uo,value:B}}))}else J=J.concat(B({key:`${te}[0]`,value:Y[0],style:G.style,styleSpec:G.styleSpec},Y));return o.S(o.U(Y[1]))?J.concat([new o.V(`${te}[1]`,Y[1],"expressions are not allowed in function stops.")]):J.concat(Fr({key:`${te}[1]`,value:Y[1],valueSpec:r,style:G.style,styleSpec:G.styleSpec}))}function B(G,J){const Y=o.K(G.value),te=o.M(G.value),K=G.value!==null?G.value:J;if(f){if(Y!==f)return[new o.V(G.key,K,`${Y} stop domain type must match previous stop domain type ${f}`)]}else f=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean"&&typeof te!="number"&&typeof te!="string"&&typeof te!="boolean")return[new o.V(G.key,K,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&s!=="categorical"){let ce=`number expected, ${Y} found`;return o.O(r)&&s===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(G.key,K,ce)]}return s!=="categorical"||Y!=="number"||typeof te=="number"&&isFinite(te)&&Math.floor(te)===te?s!=="categorical"&&Y==="number"&&typeof te=="number"&&typeof _=="number"&&_!==void 0&&te<_?[new o.V(G.key,K,"stop domain values must appear in ascending order")]:(_=te,s==="categorical"&&te in S?[new o.V(G.key,K,"stop domain values must be unique")]:(S[te]=!0,[])):[new o.V(G.key,K,`integer expected, found ${String(te)}`)]}}function Di(d){const r=(d.expressionContext==="property"?o.W:o.X)(o.U(d.value),d.valueSpec);if(r.result==="error")return r.value.map(f=>new o.V(`${d.key}${f.key}`,d.value,f.message));const s=r.value.expression||r.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!s.outputDefined())return[new o.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!o.Y(s))return[new o.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return ii(s,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!o.Z(s,["zoom","feature-state"]))return[new o.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!o._(s))return[new o.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ii(d,r){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const _ of r.valueSpec.expression.parameters)s.delete(_);if(s.size===0)return[];const f=[];return d instanceof o.$&&s.has(d.name)?[new o.V(r.key,r.value,`["${d.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(d.eachChild(_=>{f.push(...ii(_,r))}),f)}function ti(d){const r=d.key,s=d.value,f=d.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(o.M(s))===-1&&_.push(new o.V(r,s,`expected one of [${f.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(f.values).indexOf(o.M(s))===-1&&_.push(new o.V(r,s,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(s)} found`)),_}function $i(d){return o.a1(o.U(d.value))?Di(o.L({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):Zn(d)}function Zn(d){const r=d.value,s=d.key;if(o.K(r)!=="array")return[new o.V(s,r,`array expected, ${o.K(r)} found`)];const f=d.styleSpec;let _,x=[];if(r.length<1)return[new o.V(s,r,"filter array must have at least 1 element")];switch(x=x.concat(ti({key:`${s}[0]`,value:r[0],valueSpec:f.filter_operator,style:d.style,styleSpec:d.styleSpec})),o.M(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&o.M(r[1])==="$type"&&x.push(new o.V(s,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&x.push(new o.V(s,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(_=o.K(r[1]),_!=="string"&&x.push(new o.V(`${s}[1]`,r[1],`string expected, ${_} found`)));for(let S=2;S<r.length;S++)_=o.K(r[S]),o.M(r[1])==="$type"?x=x.concat(ti({key:`${s}[${S}]`,value:r[S],valueSpec:f.geometry_type,style:d.style,styleSpec:d.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&x.push(new o.V(`${s}[${S}]`,r[S],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let S=1;S<r.length;S++)x=x.concat(Zn({key:`${s}[${S}]`,value:r[S],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":_=o.K(r[1]),r.length!==2?x.push(new o.V(s,r,`filter array for "${r[0]}" operator must have 2 elements`)):_!=="string"&&x.push(new o.V(`${s}[1]`,r[1],`string expected, ${_} found`))}return x}function Ii(d,r){const s=d.key,f=d.style,_=d.layer,x=d.styleSpec,S=d.value,E=d.objectKey,C=x[`${r}_${d.layerType}`];if(!C)return[];const R=E.match(/^(.*)-use-theme$/);if(r==="paint"&&R&&C[R[1]])return o.S(S)?[].concat(Fr({key:d.key,value:S,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:f,styleSpec:x,expressionContext:"property",propertyType:r,propertyKey:E})):Fr({key:s,value:S,valueSpec:{type:"string"},style:f,styleSpec:x});const F=E.match(/^(.*)-transition$/);if(r==="paint"&&F&&C[F[1]]&&C[F[1]].transition)return Fr({key:s,value:S,valueSpec:x.transition,style:f,styleSpec:x});const j=d.valueSpec||C[E];if(!j)return[new o.J(s,S,`unknown property "${E}"`)];let B;if(o.K(S)==="string"&&o.O(j)&&!j.tokens&&(B=/^{([^}]+)}$/.exec(S))){const J=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new o.V(s,S,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${J}.`)]}const G=[];if(d.layerType==="symbol")E!=="text-field"||!f||f.glyphs||f.imports||G.push(new o.V(s,S,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&o.a2(o.U(S))&&o.M(S.type)==="identity"&&G.push(new o.V(s,S,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&r==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&o.O(j)&&(o.a3(j)||o.Q(j))){const J=o.W(o.U(S),j),Y=J.value.expression||J.value._styleExpression.expression;Y&&!o.Z(Y,["measure-light"])&&(E==="model-emissive-strength"&&o._(Y)&&o.Y(Y)||G.push(new o.V(s,S,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return G.concat(Fr({key:d.key,value:S,valueSpec:j,style:f,styleSpec:x,expressionContext:"property",propertyType:r,propertyKey:E}))}function ci(d){return Ii(d,"paint")}function Co(d){return Ii(d,"layout")}function Ka(d){let r=[];const s=d.value,f=d.key,_=d.style,x=d.styleSpec;s.type||s.ref||r.push(new o.V(f,s,'either "type" or "ref" is required'));let S=o.M(s.type);const E=o.M(s.ref);if(s.id){const C=o.M(s.id);for(let R=0;R<d.arrayIndex;R++){const F=_.layers[R];o.M(F.id)===C&&r.push(new o.V(f,s.id,`duplicate layer id "${s.id}", previously used at line ${F.id.__line__}`))}}if("ref"in s){let C;["type","source","source-layer","filter","layout"].forEach(R=>{R in s&&r.push(new o.V(f,s[R],`"${R}" is prohibited for ref layers`))}),_.layers.forEach(R=>{o.M(R.id)===E&&(C=R)}),C?C.ref?r.push(new o.V(f,s.ref,"ref cannot reference another ref layer")):S=o.M(C.type):typeof E=="string"&&r.push(new o.V(f,s.ref,`ref layer "${E}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(s.source){const C=_.sources&&_.sources[s.source],R=C&&o.M(C.type);C?R==="vector"&&S==="raster"?r.push(new o.V(f,s.source,`layer "${s.id}" requires a raster source`)):R==="raster"&&S!=="raster"?r.push(new o.V(f,s.source,`layer "${s.id}" requires a vector source`)):R!=="vector"||s["source-layer"]?R==="raster-dem"&&S!=="hillshade"?r.push(new o.V(f,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="raster-array"||["raster","raster-particle"].includes(S)?S==="line"&&s.paint&&(s.paint["line-gradient"]||s.paint["line-trim-offset"])&&R==="geojson"&&!C.lineMetrics?r.push(new o.V(f,s,`layer "${s.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):S==="raster-particle"&&R!=="raster-array"&&r.push(new o.V(f,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):r.push(new o.V(f,s.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new o.V(f,s,`layer "${s.id}" must specify a "source-layer"`)):r.push(new o.V(f,s.source,`source "${s.source}" not found`))}else r.push(new o.V(f,s,'missing required property "source"'));return r=r.concat(mr({key:f,value:s,valueSpec:x.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Fr({key:`${f}.type`,value:s.type,valueSpec:x.layer.type,style:d.style,styleSpec:d.styleSpec,object:s,objectKey:"type"}),filter:C=>$i(o.L({layerType:S},C)),layout:C=>mr({layer:s,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":R=>Co(o.L({layerType:S},R))}}),paint:C=>mr({layer:s,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":R=>ci(o.L({layerType:S,layer:s},R))}})}})),r}function oa(d){const r=d.value,s=d.key,f=o.K(r);return f!=="string"?[new o.V(s,r,`string expected, ${f} found`)]:[]}const ta={promoteId:function d({key:r,value:s}){if(o.K(s)==="string")return oa({key:r,value:s});if(Array.isArray(s)){const f=[],_=o.U(s),x=o.X(_);return x.result==="error"&&x.value.forEach(S=>{f.push(new o.V(`${r}${S.key}`,null,`${S.message}`))}),o.Z(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||f.push(new o.V(`${r}`,null,"promoteId expression should be only feature dependent")),f}{const f=[];for(const _ in s)f.push(...d({key:`${r}.${_}`,value:s[_]}));return f}}};function ho(d){const r=d.value,s=d.key,f=d.styleSpec,_=d.style;if(!r.type)return[new o.V(s,r,'"type" is required')];const x=o.M(r.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(r.url||r.tiles||S.push(new o.J(s,r,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(mr({key:s,value:r,valueSpec:f[`source_${x.replace("-","_")}`],style:d.style,styleSpec:f,objectElementValidators:ta})),S;case"geojson":if(S=mr({key:s,value:r,valueSpec:f.source_geojson,style:_,styleSpec:f,objectElementValidators:ta}),r.cluster)for(const E in r.clusterProperties){const[C,R]=r.clusterProperties[E],F=typeof C=="string"?[C,["accumulated"],["get",E]]:C;S.push(...Di({key:`${s}.${E}.map`,value:R,expressionContext:"cluster-map"})),S.push(...Di({key:`${s}.${E}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return S;case"video":return mr({key:s,value:r,valueSpec:f.source_video,style:_,styleSpec:f});case"image":return mr({key:s,value:r,valueSpec:f.source_image,style:_,styleSpec:f});case"canvas":return[new o.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ti({key:`${s}.type`,value:r.type,valueSpec:{values:js(f)}})}}function js(d){return d.source.reduce((r,s)=>{const f=d[s];return f.type.type==="enum"&&(r=r.concat(Object.keys(f.type.values))),r},[])}function fa(d){const r=d.value,s=d.styleSpec,f=s.light,_=d.style;let x=[];const S=o.K(r);if(r===void 0)return x;if(S!=="object")return x=x.concat([new o.V("light",r,`object expected, ${S} found`)]),x;for(const E in r){const C=E.match(/^(.*)-transition$/),R=E.match(/^(.*)-use-theme$/);x=x.concat(R&&f[R[1]]?Fr({key:E,value:r[E],valueSpec:{type:"string"},style:_,styleSpec:s}):C&&f[C[1]]&&f[C[1]].transition?Fr({key:E,value:r[E],valueSpec:s.transition,style:_,styleSpec:s}):f[E]?Fr({key:E,value:r[E],valueSpec:f[E],style:_,styleSpec:s}):[new o.V(E,r[E],`unknown property "${E}"`)])}return x}function pa(d){const r=d.value;let s=[];if(!r)return s;const f=o.K(r);if(f!=="object")return s=s.concat([new o.V("light-3d",r,`object expected, ${f} found`)]),s;const _=d.styleSpec,x=_["light-3d"],S=d.key,E=d.style,C=d.style.lights;for(const j of["type","id"])if(!(j in r))return s=s.concat([new o.V("light-3d",r,`missing property ${j} on light`)]),s;if(r.type&&C)for(let j=0;j<d.arrayIndex;j++){const B=o.M(r.type),G=C[j];o.M(G.type)===B&&s.push(new o.V(S,r.id,`duplicate light type "${r.type}", previously defined at line ${G.id.__line__}`))}const R=`properties_light_${r.type}`;if(!(R in _))return s=s.concat([new o.V("light-3d",r,`Invalid light type ${r.type}`)]),s;const F=_[R];for(const j in r)if(j==="properties"){const B=r[j],G=o.K(B);if(G!=="object")return s=s.concat([new o.V("properties",B,`object expected, ${G} found`)]),s;for(const J in B)s=s.concat(F[J]?Fr({key:J,value:B[J],valueSpec:F[J],style:E,styleSpec:_}):[new o.J(d.key,B[J],`unknown property "${J}"`)])}else{const B=j.match(/^(.*)-transition$/),G=j.match(/^(.*)-use-theme$/);s=s.concat(G&&x[G[1]]?Fr({key:j,value:r[j],valueSpec:{type:"string"},style:E,styleSpec:_}):B&&x[B[1]]&&x[B[1]].transition?Fr({key:j,value:r[j],valueSpec:_.transition,style:E,styleSpec:_}):x[j]?Fr({key:j,value:r[j],valueSpec:x[j],style:E,styleSpec:_}):[new o.J(j,r[j],`unknown property "${j}"`)])}return s}function un(d){const r=d.value,s=d.key,f=d.style,_=d.styleSpec,x=_.terrain;let S=[];const E=o.K(r);if(r===void 0||E==="null")return S;if(E!=="object")return S=S.concat([new o.V("terrain",r,`object expected, ${E} found`)]),S;for(const C in r){const R=C.match(/^(.*)-transition$/),F=C.match(/^(.*)-use-theme$/);S=S.concat(F&&x[F[1]]?Fr({key:C,value:r[C],valueSpec:{type:"string"},style:f,styleSpec:_}):R&&x[R[1]]&&x[R[1]].transition?Fr({key:C,value:r[C],valueSpec:_.transition,style:f,styleSpec:_}):x[C]?Fr({key:C,value:r[C],valueSpec:x[C],style:f,styleSpec:_}):[new o.J(C,r[C],`unknown property "${C}"`)])}if(r.source){const C=f.sources&&f.sources[r.source],R=C&&o.M(C.type);C?R!=="raster-dem"&&S.push(new o.V(s,r.source,`terrain cannot be used with a source of type ${String(R)}, it only be used with a "raster-dem" source type`)):S.push(new o.V(s,r.source,`source "${r.source}" not found`))}else S.push(new o.V(s,r,'terrain is missing required property "source"'));return S}function zn(d){const r=d.value,s=d.style,f=d.styleSpec,_=f.fog;let x=[];const S=o.K(r);if(r===void 0)return x;if(S!=="object")return x=x.concat([new o.V("fog",r,`object expected, ${S} found`)]),x;for(const E in r){const C=E.match(/^(.*)-transition$/),R=E.match(/^(.*)-use-theme$/);x=x.concat(R&&_[R[1]]?Fr({key:E,value:r[E],valueSpec:{type:"string"},style:s,styleSpec:f}):C&&_[C[1]]&&_[C[1]].transition?Fr({key:E,value:r[E],valueSpec:f.transition,style:s,styleSpec:f}):_[E]?Fr({key:E,value:r[E],valueSpec:_[E],style:s,styleSpec:f}):[new o.J(E,r[E],`unknown property "${E}"`)])}return x}const Cn={"*":()=>[],array:en,boolean:function(d){const r=d.value,s=d.key,f=o.K(r);return f!=="boolean"?[new o.V(s,r,`boolean expected, ${f} found`)]:[]},number:uo,color:function(d){const r=d.key,s=d.value,f=o.K(s);return f!=="string"?[new o.V(r,s,`color expected, ${f} found`)]:o.a0.parseCSSColor(s)===null?[new o.V(r,s,`color expected, "${s}" found`)]:[]},enum:ti,filter:$i,function:Oi,layer:Ka,object:mr,source:ho,model:o.a4,light:fa,"light-3d":pa,terrain:un,fog:zn,string:oa,formatted:function(d){return oa(d).length===0?[]:Di(d)},resolvedImage:function(d){return oa(d).length===0?[]:Di(d)},projection:function(d){const r=d.value,s=d.styleSpec,f=s.projection,_=d.style;let x=[];const S=o.K(r);if(S==="object")for(const E in r)x=x.concat(Fr({key:E,value:r[E],valueSpec:f[E],style:_,styleSpec:s}));else S!=="string"&&(x=x.concat([new o.V("projection",r,`object or string expected, ${S} found`)]));return x},import:function(d){const{value:r,styleSpec:s}=d,{data:f,..._}=r;Object.defineProperty(_,"__line__",{value:r.__line__,enumerable:!1});let x=mr(o.L({},d,{value:_,valueSpec:s.import}));return o.M(_.id)===""&&x.push(new o.V(`${d.key}.id`,_,"import id can't be an empty string")),f&&(x=x.concat(oi(f,s,{key:`${d.key}.data`}))),x},iconset:function(d){const r=d.value,s=d.key,f=d.styleSpec,_=d.style;if(!r.type)return[new o.V(s,r,'"type" is required')];const x=o.M(r.type);let S=[];if(S=S.concat(mr({key:s,value:r,valueSpec:f[`iconset_${x}`],style:_,styleSpec:f})),x==="source"&&r.source){const E=_.sources&&_.sources[r.source],C=E&&o.M(E.type);E?C!=="raster-array"&&S.push(new o.V(s,r.source,`iconset cannot be used with a source of type ${String(C)}, it only be used with a "raster-array" source type`)):S.push(new o.V(s,r.source,`source "${r.source}" not found`))}return S}};function Fr(d,r=!1){const s=d.value,f=d.valueSpec,_=d.styleSpec;if(f.expression&&o.a2(o.M(s)))return Oi(d);if(f.expression&&o.S(o.U(s)))return Di(d);if(f.type&&Cn[f.type]){const x=Cn[f.type](d);return r===!0&&x.length>0&&o.K(d.value)==="array"?Di(d):x}return mr(o.L({},d,{valueSpec:f.type?_[f.type]:f}))}function Bn(d){const r=d.value,s=d.key,f=oa(d);return f.length||(r.indexOf("{fontstack}")===-1&&f.push(new o.V(s,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&f.push(new o.V(s,r,'"glyphs" url must include a "{range}" token'))),f}function oi(d,r=o.a5,s={}){return Fr({key:s.key||"",value:d,valueSpec:r.$root,styleSpec:r,style:d,objectElementValidators:{glyphs:Bn,"*":()=>[]}})}function An(d,r=o.a5){return Le(oi(d,r))}const Nn=d=>Le(ho(d)),Xn=d=>Le(fa(d)),ki=d=>Le(pa(d)),Dt=d=>Le(un(d)),mi=d=>Le(zn(d)),Ki=d=>Le(function(r){const s=r.value,f=r.style,_=r.styleSpec,x=_.snow;let S=[];const E=o.K(s);if(s===void 0)return S;if(E!=="object")return S=S.concat([new o.V("snow",s,`object expected, ${E} found`)]),S;for(const C in s){const R=C.match(/^(.*)-transition$/);S=S.concat(R&&x[R[1]]&&x[R[1]].transition?Fr({key:C,value:s[C],valueSpec:_.transition,style:f,styleSpec:_}):x[C]?Fr({key:C,value:s[C],valueSpec:x[C],style:f,styleSpec:_}):[new o.J(C,s[C],`unknown property "${C}"`)])}return S}(d)),Qe=d=>Le(function(r){const s=r.value,f=r.style,_=r.styleSpec,x=_.rain;let S=[];const E=o.K(s);if(s===void 0)return S;if(E!=="object")return S=S.concat([new o.V("rain",s,`object expected, ${E} found`)]),S;for(const C in s){const R=C.match(/^(.*)-transition$/);S=S.concat(R&&x[R[1]]&&x[R[1]].transition?Fr({key:C,value:s[C],valueSpec:_.transition,style:f,styleSpec:_}):x[C]?Fr({key:C,value:s[C],valueSpec:x[C],style:f,styleSpec:_}):[new o.J(C,s[C],`unknown property "${C}"`)])}return S}(d)),Q=d=>Le(Ka(d)),ae=d=>Le($i(d)),Se=d=>Le(ci(d)),De=d=>Le(Co(d)),Pe=d=>Le(o.a4(d));function Le(d){return d.slice().sort((r,s)=>r.line&&s.line?r.line-s.line:0)}function Fe(d,r){let s=!1;if(r&&r.length)for(const f of r)f instanceof o.J?o.w(f.message):(d.fire(new o.z(new Error(f.message))),s=!0);return s}let Be;class Ye extends o.E{constructor(r,s="flat"){super(),this._transitionable=new o.a6(Be||(Be=new o.a7({anchor:new o.a8(o.a5.light.anchor),position:new o.a9(o.a5.light.position),color:new o.a8(o.a5.light.color),intensity:new o.a8(o.a5.light.intensity)}))),this.setLight(r,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,s,f={}){this._validate(Xn,r,f)||(this._transitionable.setTransitionOrValue(r),this.id=s)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,s,f){return(!f||f.validate!==!1)&&Fe(this,r.call(An,o.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let ht=class extends o.E{constructor(d,r,s,f){super(),this.scope=s,this._transitionable=new o.a6(new o.a7({source:new o.a8(o.a5.terrain.source),exaggeration:new o.a8(o.a5.terrain.exaggeration)}),s,f),this._transitionable.setTransitionOrValue(d,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(d,r){this._transitionable.setTransitionOrValue(d,r)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new o.aa(d)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const d=this._transitionable._values.exaggeration;if(!d)return null;const r=d.value.expression;if(!r)return null;let s=-1,f=-1,_=1;for(const x of r.zoomStops)_=r.evaluate(new o.aa(x)),_>.01?(s=x,f=-1):f=x;return _<.01&&s>0&&f>s?[s,f]:null}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof o.ab}};const Ze=45,Lt=65,Vt=.05;function Ot(d,r,s,f){const _=o.af(Ze,Lt,s),[x,S]=gr(d,f);let E=1-Math.min(1,Math.exp((r-x)/(S-x)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*_*d.alpha}function gr(d,r){const s=.5/Math.tan(.5*r);return[d.range[0]+s,d.range[1]+s]}function wr(d,r,s,f,_){const x=o.ad([],[r,s,f],_.mercatorFogMatrix);return Ot(d,o.ae(x),_.pitch,_._fov)}function Mr(d,r,s,f,_,x,S){const E=[[s,f,0],[_,f,0],[_,x,0],[s,x,0]];let C=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(const F of E){const j=o.ad([],F,r),B=o.ae(j);C=Math.min(C,B),R=Math.max(R,B)}return[Ot(d,C,S.pitch,S._fov),Ot(d,R,S.pitch,S._fov)]}class Nr extends o.E{constructor(r,s,f,_){super();const x=new o.a7({range:new o.a8(o.a5.fog.range),color:new o.a8(o.a5.fog.color),"color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.a8(o.a5.fog["high-color"]),"high-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.a8(o.a5.fog["space-color"]),"space-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.a8(o.a5.fog["horizon-blend"]),"star-intensity":new o.a8(o.a5.fog["star-intensity"]),"vertical-range":new o.a8(o.a5.fog["vertical-range"])});this._transitionable=new o.a6(x,f,new Map(_)),this.set(r,_),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new o.ag(x),this.scope=f}get state(){const r=this._transform,s=r.projection.name==="globe",f=o.ah(r.zoom),_=this.properties.get("range"),x=[.5,3];return{range:s?[o.ai(x[0],_[0],f),o.ai(x[1],_[1],f)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,s,f={}){if(this._validate(mi,r,f))return;const _=o.l({},r);for(const x of Object.keys(o.a5.fog))_[x]===void 0&&(_[x]=o.a5.fog[x].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.af(Ze,Lt,r))*s.a}getOpacityAtLatLng(r,s){return this._transform.projection.supportsFog?function(f,_,x){const S=o.ac.fromLngLat(_),E=x.elevation?x.elevation.getAtPointOrZero(S):0;return wr(f,S.x,S.y,E,x)}(this.state,r,s):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(r.toUnwrapped());return Mr(this.state,s,0,0,o.aj,o.aj,this._transform)}getOpacityForBounds(r,s,f,_,x){return this._transform.projection.supportsFog?Mr(this.state,r,s,f,_,x,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?gr(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const f of s){const _=r.points[f];let x;if(_[2]>=0)x=_;else{const S=r.points[f-4];x=o.ak(S,_,S[2]/(S[2]-_[2]))}if(wr(this.state,x[0],x[1],0,this._transform)>=Vt)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,s,f){return(!f||f.validate!==!1)&&Fe(this,r.call(An,o.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let ui,tn,Jn,Rn,hn=class extends o.E{constructor(d,r,s,f){super();const _=ui||(ui=new o.a7({density:new o.a8(o.a5.snow.density),intensity:new o.a8(o.a5.snow.intensity),color:new o.a8(o.a5.snow.color),opacity:new o.a8(o.a5.snow.opacity),vignette:new o.a8(o.a5.snow.vignette),"vignette-color":new o.a8(o.a5.snow["vignette-color"]),"center-thinning":new o.a8(o.a5.snow["center-thinning"]),direction:new o.a8(o.a5.snow.direction),"flake-size":new o.a8(o.a5.snow["flake-size"])}));this._transitionable=new o.a6(_,s,new Map(f)),this.set(d,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(_),this.scope=s}get state(){const d=this.properties.get("opacity"),r=this.properties.get("color"),s=this.properties.get("direction"),f=o.al(s[0]),_=-Math.max(o.al(s[1]),.01),x=[Math.cos(f)*Math.cos(_),Math.sin(f)*Math.cos(_),Math.sin(_)],S=this.properties.get("vignette"),E=this.properties.get("vignette-color");return E.a=S,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(r.r,r.g,r.b,r.a*d),direction:x,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(d,r,s={}){if(this._validate(Ki,d,s))return;const f=o.l({},d);for(const _ of Object.keys(o.a5.snow))f[_]===void 0&&(f[_]=o.a5.snow[_].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,r,s){return(!s||s.validate!==!1)&&Fe(this,d.call(An,o.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}},li=class extends o.E{constructor(d,r,s,f){super();const _=tn||(tn=new o.a7({density:new o.a8(o.a5.rain.density),intensity:new o.a8(o.a5.rain.intensity),color:new o.a8(o.a5.rain.color),opacity:new o.a8(o.a5.rain.opacity),vignette:new o.a8(o.a5.rain.vignette),"vignette-color":new o.a8(o.a5.rain["vignette-color"]),"center-thinning":new o.a8(o.a5.rain["center-thinning"]),direction:new o.a8(o.a5.rain.direction),"droplet-size":new o.a8(o.a5.rain["droplet-size"]),"distortion-strength":new o.a8(o.a5.rain["distortion-strength"])}));this._transitionable=new o.a6(_,s,new Map(f)),this.set(d,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(_),this.scope=s}get state(){const d=this.properties.get("opacity"),r=this.properties.get("color"),s=this.properties.get("direction"),f=o.al(s[0]),_=-Math.max(o.al(s[1]),.01),x=[Math.cos(f)*Math.cos(_),Math.sin(f)*Math.cos(_),Math.sin(_)],S=this.properties.get("vignette-color");return S.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(r.r,r.g,r.b,r.a*d),direction:x,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(d,r,s={}){if(this._validate(Qe,d,s))return;const f=o.l({},d);for(const _ of Object.keys(o.a5.rain))f[_]===void 0&&(f[_]=o.a5.rain[_].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,r,s){return(!s||s.validate!==!1)&&Fe(this,d.call(An,o.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}};class ji extends o.E{constructor(r,s,f,_){super(),this.scope=f,this._options=r,this.properties=new o.ag(s),this._transitionable=new o.a6(s,f,new Map(_)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,s){this._options=r,this._transitionable.setTransitionOrValue(r.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class oo{constructor(r,s,f,_){this.screenBounds=r,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(r,s){let f,_;if(r instanceof o.P||typeof r[0]=="number"){const x=o.P.convert(r);f=[x],_=s.isPointAboveHorizon(x)}else{const x=o.P.convert(r[0]),S=o.P.convert(r[1]),E=x.add(S)._div(2);f=[x,S],_=o.ao(x,S).every(C=>s.isPointAboveHorizon(C))&&s.isPointAboveHorizon(E)}return new oo(f,s.getCameraPoint(),_,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const s=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],_=o.ao(s,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(_[3]=this.cameraPoint)),o.ap(_,r)}bufferedCameraGeometryGlobe(r){const s=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],_=o.ao(s,f,r),x=this.cameraPoint.clone();switch(3*((x.y>s.y)+(x.y>f.y))+((x.x>s.x)+(x.x>f.x))){case 0:_[0]=x,_[4]=x.clone();break;case 1:_.splice(1,0,x);break;case 2:_[1]=x;break;case 3:_.splice(4,0,x);break;case 5:_.splice(2,0,x);break;case 6:_[3]=x;break;case 7:_.splice(3,0,x);break;case 8:_[2]=x}return _}containsTile(r,s,f,_=0){const x=r.queryPadding/s._pixelsPerMercatorPixel+1,S=f?this._bufferedCameraMercator(x,s):this._bufferedScreenMercator(x,s);let E=r.tileID.wrap+(S.unwrapped?_:0);const C=S.polygon.map(te=>o.aq(r.tileTransform,te,E));if(!o.ar(C,0,0,o.aj,o.aj))return;E=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const R=this.screenGeometryMercator.polygon.map(te=>o.as(r.tileTransform,te,E)),F=R.map(te=>new o.P(te[0],te[1])),j=s.getFreeCameraOptions().position||new o.ac(0,0,0),B=o.as(r.tileTransform,j,E),G=R.map(te=>{const K=o.at(te,te,B);return o.au(K,K),new o.av(B,K)}),J=o.aw(r,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:G,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(Y=o.ax(C),Y.min.x=o.aD(Y.min.x,0,o.aj),Y.min.y=o.aD(Y.min.y,0,o.aj),Y.max.x=o.aD(Y.max.x,0,o.aj),Y.max.y=o.aD(Y.max.y,0,o.aj),Y),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:J};var Y}_bufferedScreenMercator(r,s){const f=sl(r);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let _;return _=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),s):{polygon:this.bufferedScreenGeometry(r).map(x=>s.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(r,s){const f=sl(r);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let _;return _=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),s):{polygon:this.bufferedCameraGeometry(r).map(x=>s.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[f]=_,_}}_projectAndResample(r,s){const f=function(x,S){const E=o.az([],S.pixelMatrix,S.globeMatrix),C=[0,-o.aE,0,1],R=[0,o.aE,0,1],F=[0,0,0,1];o.aA(C,C,E),o.aA(R,R,E),o.aA(F,F,E);const j=new o.P(C[0]/C[3],C[1]/C[3]),B=new o.P(R[0]/R[3],R[1]/R[3]),G=o.aB(x,j)&&C[3]<F[3],J=o.aB(x,B)&&R[3]<F[3];if(!G&&!J)return null;const Y=function(we,ye,Ie){for(let Oe=1;Oe<we.length;Oe++){const Xe=Ho(ye.pointCoordinate3D(we[Oe-1]).x),je=Ho(ye.pointCoordinate3D(we[Oe]).x);if(Ie<0){if(Xe<je)return{idx:Oe,t:-Xe/(je-1-Xe)}}else if(je<Xe)return{idx:Oe,t:(1-Xe)/(je+1-Xe)}}return null}(x,S,G?-1:1);if(!Y)return null;const{idx:te,t:K}=Y;let ce=te>1?fo(x.slice(0,te),S):[],fe=te<x.length?fo(x.slice(te),S):[];ce=ce.map(we=>new o.P(Ho(we.x),we.y)),fe=fe.map(we=>new o.P(Ho(we.x),we.y));const pe=[...ce];pe.length===0&&pe.push(fe[fe.length-1]);const Ee=o.ai(pe[pe.length-1].y,(fe.length===0?ce[0]:fe[0]).y,K);let Te;return Te=G?[new o.P(0,Ee),new o.P(0,0),new o.P(1,0),new o.P(1,Ee)]:[new o.P(1,Ee),new o.P(1,1),new o.P(0,1),new o.P(0,Ee)],pe.push(...Te),fe.length===0?pe.push(ce[0]):pe.push(...fe),{polygon:pe.map(we=>new o.ac(we.x,we.y)),unwrapped:!1}}(r,s);if(f)return f;const _=function(x,S){let E=!1,C=-1/0,R=0;for(let j=0;j<x.length-1;j++)x[j].x>C&&(C=x[j].x,R=j);for(let j=0;j<x.length-1;j++){const B=(R+j)%(x.length-1),G=x[B],J=x[B+1];Math.abs(G.x-J.x)>.5&&(G.x<J.x?(G.x+=1,B===0&&(x[x.length-1].x+=1)):(J.x+=1,B+1===x.length-1&&(x[0].x+=1)),E=!0)}const F=o.ay(S.center.lng);return E&&F<Math.abs(F-1)&&x.forEach(j=>{j.x-=1}),{polygon:x,unwrapped:E}}(fo(r,s).map(x=>new o.P(Ho(x.x),x.y)),s);return{polygon:_.polygon.map(x=>new o.ac(x.x,x.y)),unwrapped:_.unwrapped}}}function fo(d,r){return o.aC(d,s=>{const f=r.pointCoordinate3D(s);s.x=f.x,s.y=f.y},1/256)}function Ho(d){return d<0?1+d%1:d%1}function sl(d){return 100*d|0}function ko(d,r,s,f,_){const x=function(E,C){if(E)return _(E);if(C){if(d.url&&C.tiles&&d.tiles&&delete d.tiles,C.variants){if(!Array.isArray(C.variants))return _(new Error("variants must be an array"));for(const F of C.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return _(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){C=o.l(C,F);break}}}const R=o.aF(o.l({},C,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);R.tiles=r.canonicalizeTileset(R,d.url),_(null,R)}},S=function(E,C,R){if(!E)return null;if(!C&&!R)return E;R=R||E.worldview_default;const F=Object.values(E.language||{});if(F.length===0)return null;const j=Object.values(E.worldview||{});if(j.length===0)return null;const B=F.every(J=>J===C),G=j.every(J=>J===R);return B&&G?E:C in(E.language_options||{})||R in(E.worldview_options||{})?null:E.language_options&&E.worldview_options?E:null}(d.data,s,f);return S?o.q.frame(()=>x(null,S)):d.url?o.n(r.transformRequest(r.normalizeSourceURL(d.url,null,s,f),o.R.Source),x):o.q.frame(()=>{const{data:E,...C}=d;x(null,C)})}function eo(d,r){const s=Math.pow(2,r.z),f=Math.floor(o.ay(d.getWest())*s),_=Math.floor(o.aH(d.getNorth())*s),x=Math.ceil(o.ay(d.getEast())*s),S=Math.ceil(o.aH(d.getSouth())*s);return r.x>=f&&r.x<x&&r.y>=_&&r.y<S}class Ro{constructor(r,s,f){this.bounds=r?o.aG.convert(this.validateBounds(r)):null,this.minzoom=s||0,this.maxzoom=f||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}addExtraBounds(r){if(r){this.extraBounds||(this.extraBounds=[]);for(const s of r)this.extraBounds.push(o.aG.convert(this.validateBounds(s)))}}contains(r){if(r.z>this.maxzoom||r.z<this.minzoom||this.bounds&&!eo(this.bounds,r))return!1;if(!this.extraBounds)return!0;for(const s of this.extraBounds)if(eo(s,r))return!0;return!1}static fromTileJSON(r){if(!r.bounds&&!r.extra_bounds)return null;const s=new Ro(r.bounds,r.minzoom,r.maxzoom);return s.addExtraBounds(r.extra_bounds),s}}class Wi extends o.E{constructor(r,s,f,_){if(super(),this.id=r,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.l(this,o.aF(s,["url","scheme","tileSize","promoteId"])),this._options=o.l({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new o.aI}load(r){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=ko(this._options,this.map._requestManager,s,f,(_,x)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),f&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new o.z(_));else if(x){if(o.l(this,x),this.hasWorldviews=!!x.worldview_options,x.worldview_default&&(this.worldviewDefault=x.worldview_default),x.vector_layers){this.vectorLayers=x.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const S of x.vector_layers)this.vectorLayerIds.push(S.id),x.worldview&&x.worldview[S.source]&&this.localizableLayerIds.add(S.id)}this.tileBounds=Ro.fromTileJSON(x),St(x.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}r&&r(_)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return o.l({},this._options)}loadTile(r,s){const f=r.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(f),x=this.map._requestManager.transformRequest(_,o.R.Tile),S=this.map.style?this.map.style.getLut(this.scope):null,E=S?{image:S.image.clone()}:null,C={request:x,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,lut:E,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&o.f(f)&&(C.worldview=this.map.getWorldview()||this.worldviewDefault,C.localizableLayerIds=this.localizableLayerIds),C.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=s:r.request=r.actor.send("reloadTile",C,R.bind(this));else if(r.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",C,R.bind(this),void 0,!0);else{const F=o.aJ.call({deduped:this._deduped},C,(j,B)=>{j||!B?R.call(this,j):(C.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},r.actor&&r.actor.send("loadTile",C,R.bind(this),void 0,!0))},!0);r.request={cancel:F}}function R(F,j){return delete r.request,r.aborted?s(null):F&&F.status!==404?s(F):(j&&j.resourceTiming&&(r.resourceTiming=j.resourceTiming),this.map._refreshExpiredTiles&&j&&r.setExpiryData(j),r.loadVectorData(j,this.map.painter),o.aK(this.dispatcher),s(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,s){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ll extends o.E{constructor(r,s,f,_){super(),this.id=r,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.l({type:"raster"},s),o.l(this,o.aF(s,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"})),this._tileJSONRequest=ko(this._options,this.map._requestManager,null,null,(s,f)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new o.z(s)):f&&(o.l(this,f),f.raster_layers&&(this.rasterLayers=f.raster_layers,this.rasterLayerIds=this.rasterLayers.map(_=>_.id)),this.tileBounds=Ro.fromTileJSON(f),St(f.tiles),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),r&&r(s)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return o.l({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,s){const f=o.q.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);r.request=o.o(this.map._requestManager.transformRequest(_,o.R.Tile),(x,S,E,C)=>(delete r.request,r.aborted?(r.state="unloaded",s(null)):x?(r.state="errored",s(x)):S?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:E,expires:C}),r.setTexture(S,this.map.painter),r.state="loaded",o.aK(this.dispatcher),void s(null)):s(null)))}abortTile(r,s){r.request&&(r.request.cancel(),delete r.request),s&&s()}unloadTile(r,s){r.texture&&r.texture instanceof o.T?(r.destroy(!0),r.texture&&r.texture instanceof o.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class _u extends ll{constructor(r,s,f,_){super(r,s,f,_),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=o.l({type:"raster-array"},s)}triggerRepaint(r){const s=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);s&&s.enabled&&f&&s._clearRenderCacheForTile(f.id,r.tileID),this.map.triggerRepaint()}loadTile(r,s){const f=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,o.R.Tile),x={request:_,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};r.source=this.id,r.scope=this.scope,r.requestParams=_,r.actor||(r.actor=this.dispatcher.getActor());const S=(E,C,R,F)=>{if(delete r.request,r.aborted)return r.state="unloaded",s(null);if(E)return E.name==="AbortError"?void 0:(r.state="errored",s(E));if(this.map._refreshExpiredTiles&&C&&r.setExpiryData({cacheControl:R,expires:F}),this.partial)r.state="empty";else{if(!C)return s(null);r.state="loaded",r._isHeaderLoaded=!0,r._mrt=C}s(null)};r.request=this.partial?r.fetchHeader(void 0,S.bind(this)):r.actor.send("loadTile",x,S.bind(this),void 0,!0)}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,s){const f=r.texture;f&&f instanceof o.T?(r.destroy(!0),this.map.painter.saveTileTexture(f)):(r.destroy(),r.flushQueues(),r._isHeaderLoaded=!1,delete r._mrt,delete r.textureDescriptor),r.fbo&&(r.fbo.destroy(),delete r.fbo),delete r.request,delete r.requestParams,delete r.neighboringTiles,r.state="unloaded"}prepareTile(r,s,f){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(s,f,(_,x)=>{if(_)return r.state="errored",this.fire(new o.z(_)),void this.triggerRepaint(r);x&&(r._isHeaderLoaded=!0,r.setTexture(x,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:x})=>x===r),f=s&&s.fields,_=f&&f.bands&&f.bands;return _?_[0]:0}getTextureDescriptor(r,s,f){if(!r)return;const _=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let x=null;s instanceof o.aN?x=s.paint.get("raster-array-band"):s instanceof o.aO&&(x=s.paint.get("raster-particle-array-band"));const S=x||this.getInitialBand(_);if(S!=null)if(r.textureDescriptor){if(!r.updateNeeded(_,S)||f)return Object.assign({},r.textureDescriptor,{texture:r.texture})}else this.prepareTile(r,_,S)}getImages(r,s){const f=new Map;for(const _ of r)for(const x of s){const[S,E]=x.split("/"),C=_.getLayer(S);if(!C||!C.hasBand(E)||!C.hasDataForBand(E))continue;const{bytes:R,tileSize:F,buffer:j}=C.getBandView(E),B=F+2*j,G={data:new o.r({width:B,height:B},R),pixelRatio:2,sdf:!1,usvg:!1,version:0};f.set(x,G)}return f}}const dd={vector:Wi,raster:ll,"raster-dem":class extends ll{constructor(d,r,s,f){super(d,r,s,f),this.type="raster-dem",this.maxzoom=22,this._options=o.l({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(d,r){const s=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,x){_&&(d.state="errored",r(_)),x&&(d.dem=x,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",r(null))}d.request=o.o(this.map._requestManager.transformRequest(s,o.R.Tile),(function(_,x,S,E){if(delete d.request,d.aborted)d.state="unloaded",r(null);else if(_)d.state="errored",r(_);else if(x){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:S,expires:E});const C=ImageBitmap&&x instanceof ImageBitmap&&o.t(),R=1-(x.width-o.aL(x.width))/2;R<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const F=C?x:o.q.getImageData(x,R),j={uid:d.uid,tileID:d.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:R};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadTile",j,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const r=d.canonical,s=Math.pow(2,r.z),f=(r.x-1+s)%s,_=r.x===0?d.wrap-1:d.wrap,x=(r.x+1+s)%s,S=r.x+1===s?d.wrap+1:d.wrap,E={};return E[new o.aM(d.overscaledZ,_,r.z,f,r.y).key]={backfilled:!1},E[new o.aM(d.overscaledZ,S,r.z,x,r.y).key]={backfilled:!1},r.y>0&&(E[new o.aM(d.overscaledZ,_,r.z,f,r.y-1).key]={backfilled:!1},E[new o.aM(d.overscaledZ,d.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},E[new o.aM(d.overscaledZ,S,r.z,x,r.y-1).key]={backfilled:!1}),r.y+1<s&&(E[new o.aM(d.overscaledZ,_,r.z,f,r.y+1).key]={backfilled:!1},E[new o.aM(d.overscaledZ,d.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},E[new o.aM(d.overscaledZ,S,r.z,x,r.y+1).key]={backfilled:!1}),E}},"raster-array":_u,geojson:class extends o.E{constructor(d,r,s,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(f),this._data=r.data,this._options=o.l({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const _=o.aj/this.tileSize;this.workerOptions=o.l({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*_,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*_,extent:o.aj,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.aj,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new o.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new o.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const r=new Map;for(const s of this._data.features)r.set(s.id,s);for(const s of d.features)r.set(s.id,s);this._data.features=[...r.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},r),this}getClusterChildren(d,r){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},r),this}getClusterLeaves(d,r,s,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:r,offset:s},f),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.A("dataloading",{dataType:"source"})),this._loaded=!1;const r=o.l({append:d},this.workerOptions);r.scope=this.scope;const s=this._data;typeof s=="string"?(r.request=this.map._requestManager.transformRequest(o.q.resolveURL(s),o.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(f,_)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new o.z(f));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new o.A("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const d=o.C(this.id,this.scope);this.map.style.clearSource(d),this._updateWorkerData()}loadTile(d,r){const s=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const f=this.map.style?this.map.style.getLut(this.scope):null,_=f?{image:f.image.clone()}:null,x=this._partialReload,S={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:d.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:x};d.request=this.actor.send(s,S,(E,C)=>x&&!C?(d.state="loaded",r(null)):(delete d.request,d.destroy(),d.aborted?r(null):E?r(E):(d.loadVectorData(C,this.map.painter,s==="reloadTile"),r(null))),void 0,s==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,r){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aP{constructor(d,r,s,f){super(d,r,s,f),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const r of d.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.R.Source).url);o.aQ(this.urls,(r,s)=>{this._loaded=!0,r?this.fire(new o.z(r)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const r=this.video.seekable;d<r.start(0)||d>r.end(0)?this.fire(new o.z(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,r=d.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(d,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aP,model:class extends o.E{constructor(d,r,s,f){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){const d=[];for(const r in this._options.models){const s=this._options.models[r],f=o.aS(this.map._requestManager.transformRequest(s.uri,o.R.Model).url).then(_=>{if(!_)return;const x=o.aT(_),S=new o.aU(r,s.position,s.orientation,x);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(_=>{this.fire(new o.z(new Error(`Could not load model ${r} from ${s.uri}: ${_.message}`)))});d.push(f)}Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this._loaded=!0,this.fire(new o.z(new Error(`Could not load models: ${r.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,r){}serialize(){return this._options}},"batched-model":class extends o.E{constructor(d,r,s,f){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(d){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=ko(this._options,this.map._requestManager,r,s,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new o.z(f))):_&&(o.l(this,_),_.bounds&&(this.tileBounds=new Ro(_.bounds,this.minzoom,this.maxzoom)),St(_.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),d&&d(f)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,r){const s=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(s,o.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.q.devicePixelRatio,promoteId:this.promoteId};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=r;else{if(d.buckets){const x=Object.values(d.buckets);for(const S of x)S.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",f,_.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",f,_.bind(this),void 0,!0);function _(x,S){return d.aborted?r(null):x&&x.status!==404?r(x):(this.map._refreshExpiredTiles&&S&&d.setExpiryData(S),d.loadModelData(S,this.map.painter),d.state="loaded",void r(null))}}serialize(){return o.l({},this._options)}},canvas:class extends o.aP{constructor(d,r,s,f){super(d,r,s,f),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(x=>typeof x!="number"))||this.fire(new o.z(new o.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.z(new o.V(`sources.${d}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.z(new o.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.z(new o.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.z(new o.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof o.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends o.E{constructor(d,r,s,f){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=r,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ro(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.l(this,o.aF(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:r,y:s,z:f}=d.canonical;return this._implementation.hasTile({x:r,y:s,z:f})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,r){const{x:s,y:f,z:_}=d.tileID.canonical,x=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:s,y:f,z:_},{signal:x.signal})).then((function(S){return delete d.request,d.aborted?(d.state="unloaded",r(null)):S===void 0?(d.state="errored",r(null)):S===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",r(null)):function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement}(S)?(this.loadTileData(d,S),d.state="loaded",void r(null)):(d.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.name!=="AbortError"&&(d.state="errored",r(S))}),d.request.cancel=()=>x.abort()}loadTileData(d,r){d.setTexture(r,this.map.painter)}unloadTile(d,r){if(d.texture&&d.texture instanceof o.T?(d.destroy(!0),d.texture&&d.texture instanceof o.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:s,y:f,z:_}=d.tileID.canonical;this._implementation.unloadTile({x:s,y:f,z:_})}r&&r()}abortTile(d,r){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){const d=o.C(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}}},Hl=function(d,r,s,f){const _=new dd[r.type](d,r,s,f);if(_.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${_.id}`);return o.aV(["load","abort","unload","serialize","prepare"],_),_};function yu(d,r,s=""){return`${s}:${r.id||""}:${r.layer.id}:${function(f){if("layerId"in f)return`layer:${f.layerId}`;{const{featuresetId:_,importId:x}=f;return`featureset:${_}${x?`:import:${x}`:""}`}}(d.target)}`}function Zl(d,r,s,f=""){if(d.uniqueFeatureID){const _=yu(d,r,f);if(s.has(_))return!0;s.add(_)}return!1}function cl(d,r,s,f,_=!1){const x=r.sourceCache.transform,S=r.sourceCache.tilesIn(d,r.has3DLayers,_);S.sort(Ja);const E=[];for(const C of S){const R=C.tile.queryRenderedFeatures(r,C,s,f,x,_);Object.keys(R).length&&E.push({wrappedTileID:C.tile.tileID.wrapped().key,queryResults:R})}return E.length===0?{}:function(C){const R={},F={};for(const j of C){const B=j.queryResults,G=j.wrappedTileID,J=F[G]=F[G]||{};for(const Y in B){const te=B[Y],K=J[Y]=J[Y]||{},ce=R[Y]=R[Y]||[];for(const fe of te)K[fe.featureIndex]||(K[fe.featureIndex]=!0,ce.push(fe))}}return R}(E)}function fd(d,r,s,f,_){const x={},S=f.queryRenderedSymbols(d),E=[];for(const C of Object.keys(S).map(Number))E.push(_[C]);E.sort(Ja);for(const C of E){const R=C.featureIndex.lookupSymbolFeatures(S[C.bucketInstanceId],C.bucketIndex,C.sourceLayerIndex,r,s);for(const F in R){const j=x[F]=x[F]||[],B=R[F];B.sort((G,J)=>{const Y=C.featureSortOrder;if(Y){const te=Y.indexOf(G.featureIndex);return Y.indexOf(J.featureIndex)-te}return J.featureIndex-G.featureIndex});for(const G of B)j.push(G)}}return x}function Cp(d,r){const s=d.getRenderableIds().map(x=>d.getTileByID(x)),f=[],_={};for(let x=0;x<s.length;x++){const S=s[x],E=S.tileID.canonical.key;_[E]||(_[E]=!0,S.querySourceFeatures(f,r))}return f}function Ja(d,r){const s=d.tileID,f=r.tileID;return s.overscaledZ-f.overscaledZ||s.canonical.y-f.canonical.y||s.wrap-f.wrap||s.canonical.x-f.canonical.x}function yf(d,r){const s={};if(!r)return s;for(const f of d){const _=f.layerIds.map(x=>r.getLayer(x)).filter(Boolean);if(_.length!==0){f.layers=_,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(x=>_.filter(S=>S.id===x)[0]));for(const x of _)s[x.fqid]=f}}return s}const ma=32,Pa=33,Xl=new Uint16Array(8184);for(let d=0;d<2046;d++){let r=d+2,s=0,f=0,_=0,x=0,S=0,E=0;for(1&r?_=x=S=ma:s=f=E=ma;(r>>=1)>1;){const R=s+_>>1,F=f+x>>1;1&r?(_=s,x=f,s=S,f=E):(s=_,f=x,_=S,x=E),S=R,E=F}const C=4*d;Xl[C+0]=s,Xl[C+1]=f,Xl[C+2]=_,Xl[C+3]=x}const Qa=new Uint16Array(2178),hi=new Uint8Array(1089),es=new Uint16Array(1089);function ch(d){return d===0?-.03125:d===32?.03125:0}const pd={type:2,extent:o.aj,loadGeometry:()=>[[new o.P(0,0),new o.P(o.aj+1,0),new o.P(o.aj+1,o.aj+1),new o.P(0,o.aj+1),new o.P(0,0)]]};class ul{constructor(r,s,f,_,x){this.tileID=r,this.uid=o.a$(),this.uses=0,this.tileSize=s,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection)}registerFadeDuration(r){const s=r+this.timeAdded;s<o.q.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,s,f){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=yf(r.buckets,s.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof o.b1){if(this.hasSymbolBuckets=!0,!f)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof o.b1&&x.hasRTLText){this.hasRTLText=!0,o.b2();break}}this.queryPadding=0;for(const _ in this.buckets){const x=this.buckets[_],S=s.style.getOwnLayer(_);if(!S)continue;const E=S.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,E)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new o.b0}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(r,s,f){r&&(r.resourceTiming&&(this.resourceTiming=r.resourceTiming),this.buckets=Object.assign({},this.buckets,yf(r.buckets,s.style)),r.featureIndex&&(this.latestFeatureIndex=r.featureIndex))}getBucket(r){return this.buckets[r.fqid]}upload(r){for(const _ in this.buckets){const x=this.buckets[_];x.uploadPending()&&x.upload(r)}const s=r.gl,f=this.imageAtlas;f&&!f.uploaded&&(this.imageAtlasTexture=new o.T(r,f.image,s.RGBA8,{useMipmap:!!f.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(r,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(r,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(r,s,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,f),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=s.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(s,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}queryRenderedFeatures(r,s,f,_,x,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const E=function(C,R){const F=o.bn([],[.5*C.width,.5*-C.height,1]);return o.bo(F,F,[1,-1,0]),o.az(F,F,C.calculateProjMatrix(R.toUnwrapped())),Float32Array.from(F)}(x,this.tileID);return this.latestFeatureIndex.query(r,{tilespaceGeometry:s,pixelPosMatrix:E,transform:_,availableImages:f,tileTransform:this.tileTransform})}querySourceFeatures(r,s){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const _=f.loadVTLayers(),x=s?s.sourceLayer:"",S=_._geojsonTileLayer||_[x];if(!S)return;const E=o.b3(s&&s.filter),{z:C,x:R,y:F}=this.tileID.canonical,j={z:C,x:R,y:F};for(let B=0;B<S.length;B++){const G=S.feature(B);if(E.needGeometry){const te=o.b4(G,!0);if(!E.filter(new o.aa(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!E.filter(new o.aa(this.tileID.overscaledZ),G))continue;const J=f.getId(G,x),Y=new o.b5(G,C,R,F,J);Y.tile=j,r.push(Y)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(r){const s=this.expirationTime;if(r.cacheControl){const f=o.b6(r.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const f=Date.now();let _=!1;if(this.expirationTime>f)_=!1;else if(s)if(this.expirationTime<s)_=!0;else{const x=this.expirationTime-s;x?this.expirationTime=f+Math.max(x,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(r){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&r&&this.updateBuckets(r)}updateBuckets(r,s){if(!this.latestFeatureIndex||!r.style)return;const f=this.latestFeatureIndex.loadVTLayers(),_=r.style.listImages(),x=r.style.getBrightness();for(const S in this.buckets){if(!r.style.hasLayer(S))continue;const E=this.buckets[S],C=E.layers[0],R=C.sourceLayer||"_geojsonTileLayer",F=f[R],j=r.style.getLayerSourceCache(C);let B={};j&&(B=j._state.getState(R,void 0));const G=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},J=Object.keys(B).length>0&&!s;J&&!E.stateDependentLayers.length&&!s||E.update(B,F,_,G,J?E.stateDependentLayers:E.layers,s,x),(E instanceof o.b7||E instanceof o.b8)&&r._terrain&&r._terrain.enabled&&j&&E.uploadPending()&&r._terrain._clearRenderCacheForTile(j.id,this.tileID);const Y=r&&r.style&&r.style.getOwnLayer(S);Y&&(this.queryPadding=Math.max(this.queryPadding,Y.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=o.q.now()+r}setTexture(r,s){const f=s.context,_=f.gl;this.texture=this.texture||s.getTileTexture(r.width),this.texture&&this.texture instanceof o.T?this.texture.update(r):(this.texture=new o.T(f,r,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(r,s){const f={};for(const _ of s)f[_]=!0;this.dependencies[r]=f}hasDependency(r,s){for(const f of r){const _=this.dependencies[f];if(_){for(const x of s)if(_[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const f=o.b9(pd,this.tileID.canonical,this.tileTransform)[0],_=new o.ba,x=new o.bb;for(let S=0;S<f.length;S++){const{x:E,y:C}=f[S];_.emplaceBack(E,C),x.emplaceBack(S)}x.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(x),this._tileDebugBuffer=r.createVertexBuffer(_,o.bc.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,_.length,x.length)}_makeTileBoundsBuffers(r,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const f=o.b9(pd,this.tileID.canonical,this.tileTransform)[0];let _,x;if(this.isRaster){const S=function(E,C){const R=o.aW(E,C),F=Math.pow(2,E.z);for(let te=0;te<Pa;te++)for(let K=0;K<Pa;K++){const ce=o.aX((E.x+(K+ch(K))/ma)/F),fe=o.aY((E.y+(te+ch(te))/ma)/F),pe=C.project(ce,fe),Ee=te*Pa+K;Qa[2*Ee+0]=Math.round((pe.x*R.scale-R.x)*o.aj),Qa[2*Ee+1]=Math.round((pe.y*R.scale-R.y)*o.aj)}hi.fill(0),es.fill(0);for(let te=2045;te>=0;te--){const K=4*te,ce=Xl[K+0],fe=Xl[K+1],pe=Xl[K+2],Ee=Xl[K+3],Te=ce+pe>>1,we=fe+Ee>>1,ye=Te+we-fe,Ie=we+ce-Te,Oe=fe*Pa+ce,Xe=Ee*Pa+pe,je=we*Pa+Te,st=Math.hypot((Qa[2*Oe+0]+Qa[2*Xe+0])/2-Qa[2*je+0],(Qa[2*Oe+1]+Qa[2*Xe+1])/2-Qa[2*je+1])>=16;hi[je]=hi[je]||(st?1:0),te<1022&&(hi[je]=hi[je]||hi[(fe+Ie>>1)*Pa+(ce+ye>>1)]||hi[(Ee+Ie>>1)*Pa+(pe+ye>>1)])}const j=new o.aZ,B=new o.a_;let G=0;function J(te,K){const ce=K*Pa+te;return es[ce]===0&&(j.emplaceBack(Qa[2*ce+0],Qa[2*ce+1],te*o.aj/ma,K*o.aj/ma),es[ce]=++G),es[ce]-1}function Y(te,K,ce,fe,pe,Ee){const Te=te+ce>>1,we=K+fe>>1;if(Math.abs(te-pe)+Math.abs(K-Ee)>1&&hi[we*Pa+Te])Y(pe,Ee,te,K,Te,we),Y(ce,fe,pe,Ee,Te,we);else{const ye=J(te,K),Ie=J(ce,fe),Oe=J(pe,Ee);B.emplaceBack(ye,Ie,Oe)}}return Y(0,0,ma,ma,ma,0),Y(ma,ma,0,0,0,ma),{vertices:j,indices:B}}(this.tileID.canonical,s);_=S.vertices,x=S.indices}else{_=new o.aZ,x=new o.a_;for(const{x:E,y:C}of f)_.emplaceBack(E,C,0,0);const S=o.be(_.int16.subarray(0,4*_.length),void 0,4);for(let E=0;E<S.length;E+=3)x.emplaceBack(S[E],S[E+1],S[E+2])}this._tileBoundsBuffer=r.createVertexBuffer(_,o.bf.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(x),this._tileBoundsSegments=o.bd.simpleSegment(0,0,_.length,x.length)}_makeGlobeTileDebugBuffers(r,s){const f=s.projection;if(!f||f.name!=="globe"||s.freezeTileCoverage)return;const _=this.tileID.canonical,x=o.bg(_,s),S=o.bh(x),E=o.ah(s.zoom);let C;E>0&&(C=o.bi(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,_,s,S,C,E),this._makeGlobeTileDebugTextBuffer(r,_,s,S,C,E)}_globePoint(r,s,f,_,x,S,E){let C=o.bj(r,s,f);if(S){const R=1<<f.z,F=o.ay(_.center.lng),j=o.aH(_.center.lat),B=(f.x+.5)/R-F;let G=0;B>.5?G=-1:B<-.5&&(G=1);let J=(r/o.aj+f.x)/R+G,Y=(s/o.aj+f.y)/R;J=(J-F)*_._pixelsPerMercatorPixel+F,Y=(Y-j)*_._pixelsPerMercatorPixel+j;const te=[J*_.worldSize,Y*_.worldSize,0];o.ad(te,te,S),C=o.bk(C,te,E)}return o.ad(C,C,x)}_makeGlobeTileDebugBorderBuffer(r,s,f,_,x,S){const E=new o.ba,C=new o.bb,R=new o.bl,F=(B,G,J,Y,te)=>{const K=(J-B)/(te-1),ce=(Y-G)/(te-1),fe=E.length;for(let pe=0;pe<te;pe++){const Ee=B+pe*K,Te=G+pe*ce;E.emplaceBack(Ee,Te);const we=this._globePoint(Ee,Te,s,f,_,x,S);R.emplaceBack(we[0],we[1],we[2]),C.emplaceBack(fe+pe)}},j=o.aj;F(0,0,j,0,16),F(j,0,j,j,16),F(j,j,0,j,16),F(0,j,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(C),this._tileDebugBuffer=r.createVertexBuffer(E,o.bc.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(R,o.bm.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,E.length,C.length)}_makeGlobeTileDebugTextBuffer(r,s,f,_,x,S){const E=o.aj/4,C=new o.ba,R=new o.a_,F=new o.bl,j=25;R.reserve(32),C.reserve(j),F.reserve(j);const B=(G,J)=>j*G+J;for(let G=0;G<j;G++){const J=G*E;for(let Y=0;Y<j;Y++){const te=Y*E;C.emplaceBack(te,J);const K=this._globePoint(te,J,s,f,_,x,S);F.emplaceBack(K[0],K[1],K[2])}}for(let G=0;G<4;G++)for(let J=0;J<4;J++){const Y=B(G,J),te=B(G,J+1),K=B(G+1,J),ce=B(G+1,J+1);R.emplaceBack(Y,te,K),R.emplaceBack(K,te,ce)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(R),this._tileDebugTextBuffer=r.createVertexBuffer(C,o.bc.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(F,o.bm.members),this._tileDebugTextSegments=o.bd.simpleSegment(0,0,j,32)}destroy(r=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bp.setPbf(o.bq);class uh extends ul{constructor(r,s,f,_,x){super(r,s,f,_,x),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(r){return this._mrt&&this._mrt.getLayer(r)}setTexture(r,s){const f=s.context,_=f.gl;this.texture=this.texture||s.getTileTexture(r.width),this.texture&&this.texture instanceof o.T?this.texture.update(r,{premultiply:!1}):this.texture=new o.T(f,r,_.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(r=16384,s){const f=this._mrt=new o.bp(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=o.br(_,(x,S,E,C)=>{if(x)s(x);else try{const R=f.getHeaderLength(S);if(R>r)return void(this.request=this.fetchHeader(R,s));f.parseHeader(S),this._isHeaderLoaded=!0;let F=0;for(const j of Object.values(f.layers))F=Math.max(F,j.dataIndex[j.dataIndex.length-1].lastByte);S.byteLength>=F&&(this.entireBuffer=S),s(null,this.entireBuffer||S,E,C)}catch(R){s(R)}}),this.request}fetchBand(r,s,f){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void f(new Error("Tile header is not ready"));const x=this.actor;if(!x)return void f(new Error("Can't fetch tile band without an actor"));let S;const E=(j,B)=>{S.complete(j,B),j?f(j):(this.updateTextureDescriptor(r,s),f(null,this.textureDescriptor&&this.textureDescriptor.img))},C=(j,B)=>{if(j)return f(j);const G=x.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:B,task:S},E,void 0,!0);this._workQueue.push(()=>{G&&G.cancel(),S.cancel()})},R=_.getLayer(r);if(!R)return void f(new Error(`Unknown sourceLayer "${r}"`));if(R.hasDataForBand(s))return this.updateTextureDescriptor(r,s),void f(null,this.textureDescriptor?this.textureDescriptor.img:null);const F=R.getDataRange([s]);if(S=_.createDecodingTask(F),!S||S.tasks.length)if(this.flushQueues(),this.entireBuffer)C(null,this.entireBuffer.slice(F.firstByte,F.lastByte+1));else{const j=Object.assign({},this.requestParams,{headers:{Range:`bytes=${F.firstByte}-${F.lastByte}`}}),B=o.br(j,C);this._fetchQueue.push(()=>{B.cancel(),S.cancel()})}else f(null)}updateNeeded(r,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==r)&&this.state!=="errored"}updateTextureDescriptor(r,s){if(!this._mrt)return;const f=this._mrt.getLayer(r);if(!f||!f.hasBand(s)||!f.hasDataForBand(s))return;const{bytes:_,tileSize:x,buffer:S,offset:E,scale:C}=f.getBandView(s),R=x+2*S,F=new o.r({width:R,height:R},_),j=this.texture;j&&j instanceof o.T&&j.update(F,{premultiply:!1}),this.textureDescriptor={layer:r,band:s,img:F,buffer:S,offset:E,tileSize:x,format:f.pixelFormat,mix:[C,256*C,65536*C,16777216*C]}}}class vf{constructor(r,s){this.max=r,this.onRemove=s,this.reset()}reset(){for(const r in this.data)for(const s of this.data[r])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(r,s,f){const _=r.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const x={value:s,timeout:void 0};if(f!==void 0&&(x.timeout=setTimeout(()=>{this.remove(r,x)},f)),this.data[_].push(x),this.order.push(_),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const s=this.data[r].shift();return s.timeout&&clearTimeout(s.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),s.value}getByKey(r){const s=this.data[r];return s?s[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,s){if(!this.has(r))return this;const f=r.wrapped().key,_=s===void 0?0:this.data[f].indexOf(s),x=this.data[f][_];return this.data[f].splice(_,1),x.timeout&&clearTimeout(x.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(x.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(r){const s=[];for(const f in this.data)for(const _ of this.data[f])r(_.value)||s.push(_);for(const f of s)this.remove(f.value.tileID,f)}}class vu{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,s,f){const _=String(s);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][_]=this.stateChanges[r][_]||{},o.l(this.stateChanges[r][_],f),this.deletedStates[r]===null){this.deletedStates[r]={};for(const x in this.state[r])x!==_&&(this.deletedStates[r][x]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][_]===null){this.deletedStates[r][_]={};for(const x in this.state[r][_])f[x]||(this.deletedStates[r][_][x]=null)}else for(const x in f)this.deletedStates[r]&&this.deletedStates[r][_]&&this.deletedStates[r][_][x]===null&&delete this.deletedStates[r][_][x]}removeFeatureState(r,s,f){if(this.deletedStates[r]===null)return;const _=String(s);if(this.deletedStates[r]=this.deletedStates[r]||{},f&&s!==void 0)this.deletedStates[r][_]!==null&&(this.deletedStates[r][_]=this.deletedStates[r][_]||{},this.deletedStates[r][_][f]=null);else if(s!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][_])for(f in this.deletedStates[r][_]={},this.stateChanges[r][_])this.deletedStates[r][_][f]=null;else this.deletedStates[r][_]=null;else this.deletedStates[r]=null}getState(r,s){const f=this.state[r]||{},_=this.stateChanges[r]||{},x=this.deletedStates[r];if(x===null)return{};if(s!==void 0){const E=String(s),C=o.l({},f[E],_[E]);if(x){const R=x[s];if(R===null)return{};for(const F in R)delete C[F]}return C}const S=o.l({},f,_);if(x)for(const E in x)delete S[E];return S}initializeTileState(r,s){r.refreshFeatureState(s)}coalesceChanges(r,s){const f={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const x={};for(const S in this.stateChanges[_])this.state[_][S]||(this.state[_][S]={}),o.l(this.state[_][S],this.stateChanges[_][S]),x[S]=this.state[_][S];f[_]=x}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const x={};if(this.deletedStates[_]===null)for(const S in this.state[_])x[S]={},this.state[_][S]={};else for(const S in this.deletedStates[_]){if(this.deletedStates[_][S]===null)this.state[_][S]={};else if(this.state[_][S])for(const E of Object.keys(this.deletedStates[_][S]))delete this.state[_][S][E];x[S]=this.state[_][S]}f[_]=f[_]||{},o.l(f[_],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const _ in r)r[_].refreshFeatureState(s)}}class Zo extends o.E{constructor(r,s,f){super(),this.id=r,this._onlySymbols=f,s.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new vf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new vu,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles)if(!this._tiles[r].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,s){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,s)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r)}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r)}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const f=this._tiles[s];f.upload(r),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(Us).map(r=>r.key)}getRenderableIds(r,s){const f=[];for(const _ in this._tiles)this._isIdRenderable(+_,r,s)&&f.push(this._tiles[_]);return r?f.sort((_,x)=>{const S=_.tileID,E=x.tileID,C=new o.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),R=new o.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-E.overscaledZ||R.y-C.y||R.x-C.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(Us).map(_=>_.key)}hasRenderableParent(r){const s=this.findLoadedParent(r,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(r,s,f){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(s||!this._tiles[r].holdingForFade())&&(f||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,s){const f=this._tiles[r];f&&(f.state!=="loading"&&(f.state=s),this._loadTile(f,this._tileLoaded.bind(this,f,r,s)))}_tileLoaded(r,s,f,_){if(_)if(r.state="errored",_.status!==404)this._source.fire(new o.z(_,{tile:r}));else{if(this._source.fire(new o.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:r})),!(r.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}else r.timeAdded=o.q.now(),f==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(s,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new o.A("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const s=this.getRenderableIds();for(let _=0;_<s.length;_++){const x=s[_];if(r.neighboringTiles&&r.neighboringTiles[x]){const S=this.getTileByID(x);f(r,S),f(S,r)}}function f(_,x){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let S=x.tileID.canonical.x-_.tileID.canonical.x;const E=x.tileID.canonical.y-_.tileID.canonical.y,C=Math.pow(2,_.tileID.canonical.z),R=x.tileID.key;S===0&&E===0||Math.abs(E)>1||(Math.abs(S)>1&&(Math.abs(S+C)===1?S+=C:Math.abs(S-C)===1&&(S-=C)),x.dem&&_.dem&&(_.dem.backfillBorder(x.dem,S,E),_.neighboringTiles&&_.neighboringTiles[R]&&(_.neighboringTiles[R].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,s,f,_){for(const x in this._tiles){let S=this._tiles[x];if(_[x]||!S.hasData()||S.tileID.overscaledZ<=s||S.tileID.overscaledZ>f)continue;let E=S.tileID;for(;S&&S.tileID.overscaledZ>s+1;){const R=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[R.key],S&&S.hasData()&&(E=R)}let C=E;for(;C.overscaledZ>s;)if(C=C.scaledTo(C.overscaledZ-1),r[C.key]){_[E.key]=E;break}}}findLoadedParent(r,s){if(r.key in this._loadedParentTiles){const f=this._loadedParentTiles[r.key];return f&&f.tileID.overscaledZ>=s?f:null}for(let f=r.overscaledZ-1;f>=s;f--){const _=r.scaledTo(f),x=this._getLoadedTile(_);if(x)return x}}_getLoadedTile(r){const s=this._tiles[r.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,s){s=s||this._source.tileSize;const f=Math.ceil(r.width/s)+1,_=Math.ceil(r.height/s)+1,x=Math.floor(f*_*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(E)}handleWrapJump(r){const s=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,s){const f={};for(const _ in this._tiles){const x=this._tiles[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+s),f[x.tileID.key]=x}this._tiles=f;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(r,s,f,_,x){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(r,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const S=this._source.type==="batched-model";let E,C=this._source.maxzoom;const R=this.map&&this.map.painter?this.map.painter._terrain:null;if(R&&R.sourceCache===this&&R.attenuationRange()){const B=R.attenuationRange()[0],G=Math.floor(B)-Math.log2(R.getDemUpscale());C>G&&(C=G)}if(this.used||this.usedForTerrain){if(this._source.tileID)E=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(B=>new o.aM(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y));else if(this.tileCoverLift!==0){const B=r.clone();B.tileCoverLift=this.tileCoverLift,E=B.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.minzoom<=1&&r.projection.name==="globe"&&(E.push(new o.aM(1,0,1,0,0)),E.push(new o.aM(1,0,1,1,0)),E.push(new o.aM(1,0,1,0,1)),E.push(new o.aM(1,0,1,1,1)))}else if(E=r.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.hasTile){const B=this._source.hasTile.bind(this._source);E=E.filter(G=>B(G))}}else E=[];if(E.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Vs(this._source.type)){const B=r.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),G=Math.min(B,this._source.maxzoom);if(S){const J=r.extendTileCover(E,G);for(const Y of J)E.push(Y)}else if(x){const J=r.extendTileCover(E,G,this.transform._camera.forward());for(const Y of J)E.push(Y)}else if(this.castsShadows&&_){const J=r.extendTileCover(E,G,_);for(const Y of J)this._shadowCasterTiles[Y.key]=!0,E.push(Y)}}const F=this._updateRetainedTiles(E);if(Vs(this._source.type)&&E.length!==0){const B={},G={},J=Object.keys(F);for(const te of J){const K=F[te],ce=this._tiles[te];if(!ce||ce.fadeEndTime&&ce.fadeEndTime<=o.q.now())continue;const fe=this.findLoadedParent(K,Math.max(K.overscaledZ-Zo.maxOverzooming,this._source.minzoom));fe&&(this._addTile(fe.tileID),B[fe.tileID.key]=fe.tileID),G[te]=K}const Y=E[E.length-1].overscaledZ;for(const te in this._tiles){const K=this._tiles[te];if(F[te]||!K.hasData())continue;let ce=K.tileID;for(;ce.overscaledZ>Y;){ce=ce.scaledTo(ce.overscaledZ-1);const fe=this._tiles[ce.key];if(fe&&fe.hasData()&&G[ce.key]){F[te]=K.tileID;break}}}for(const te in B)F[te]||(this._coveredTiles[te]=!0,F[te]=B[te])}for(const B in F)this._tiles[B].clearFadeHold();const j=o.bs(this._tiles,F);for(const B of j){const G=this._tiles[B];G.hasSymbolBuckets&&!G.holdingForFade()?G.setHoldDuration(this.map._fadeDuration):G.hasSymbolBuckets&&!G.symbolFadeFinished()||this._removeTile(+B)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const s={};if(r.length===0)return s;const f={},_=r.reduce((R,F)=>Math.min(R,F.overscaledZ),1/0),x=r[0].overscaledZ,S=Math.max(x-Zo.maxOverzooming,this._source.minzoom),E=Math.max(x+Zo.maxUnderzooming,this._source.minzoom),C={};for(const R of r){const F=this._addTile(R);s[R.key]=R,F.hasData()||_<this._source.maxzoom&&(C[R.key]=R)}this._retainLoadedChildren(C,_,E,s);for(const R of r){let F=this._tiles[R.key];if(F.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const B=R.children(this._source.maxzoom)[0],G=this.getTile(B);if(G&&G.hasData()){s[B.key]=B;continue}}else{const B=R.children(this._source.maxzoom);if(s[B[0].key]&&s[B[1].key]&&s[B[2].key]&&s[B[3].key])continue}let j=F.wasRequested();for(let B=R.overscaledZ-1;B>=S;--B){const G=R.scaledTo(B);if(f[G.key]||(f[G.key]=!0,F=this.getTile(G),!F&&j&&(F=this._addTile(G)),F&&(s[G.key]=G,j=F.wasRequested(),F.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const s=[];let f,_=this._tiles[r].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}s.push(_.key);const x=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(x),f)break;_=x}for(const x of s)this._loadedParentTiles[x]=f}}_addTile(r){let s=this._tiles[r.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),s;s=this._cache.getAndRemove(r),s&&(this._setTileReloadTimer(r.key,s),s.tileID=r,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,s)));const f=!!s;if(!f){const _=this.map?this.map.painter:null,x=this._source.tileSize*r.overscaleFactor();s=this._source.type==="raster-array"?new uh(r,x,this.transform.tileZoom,_,this._isRaster):new ul(r,x,this.transform.tileZoom,_,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,r.key,s.state))}return s.uses++,this._tiles[r.key]=s,f||this._source.fire(new o.A("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(r,s){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const f=s.getExpiryTimeout();f&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},f))}_removeTile(r){const s=this._tiles[r];s&&(s.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,s,f){const _=[],x=this.transform;if(!x)return _;const S=x.projection.name==="globe",E=o.ay(x.center.lng);for(const C in this._tiles){const R=this._tiles[C];if(f&&R.clearQueryDebugViz(),R.holdingForFade())continue;let F;if(S){const j=R.tileID.canonical;if(j.z===0){const B=[Math.abs(o.aD(E,...ts(j,-1))-E),Math.abs(o.aD(E,...ts(j,1))-E)];F=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(o.aD(E,...ts(j,-1))-E),Math.abs(o.aD(E,...ts(j,0))-E),Math.abs(o.aD(E,...ts(j,1))-E)];F=[B.indexOf(Math.min(...B))-1]}}else F=[0];for(const j of F){const B=r.containsTile(R,x,s,j);B&&_.push(B)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,s){const f=this.getRenderableIds(r,s).map(x=>this._tiles[x].tileID),_=this.transform.projection.name==="globe";for(const x of f)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=_?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return f}sortCoordinatesByDistance(r){const s=r.slice(),f=this.transform._camera.position,_=this.transform._camera.forward(),x={};for(const S of s){const E=1/(1<<S.canonical.z);x[S.key]=((S.canonical.x+.5)*E+S.wrap-f[0])*_[0]+((S.canonical.y+.5)*E-f[1])*_[1]-f[2]*_[2]}return s.sort((S,E)=>x[S.key]-x[E.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(Vs(this._source.type))for(const r in this._tiles){const s=this._tiles[r];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(r,s,f){this._state.updateState(r=r||"_geojsonTileLayer",s,f)}removeFeatureState(r,s,f){this._state.removeFeatureState(r=r||"_geojsonTileLayer",s,f)}getFeatureState(r,s){return this._state.getState(r=r||"_geojsonTileLayer",s)}setDependencies(r,s,f){const _=this._tiles[r];_&&_.setDependencies(s,f)}reloadTilesForDependencies(r,s){for(const f in this._tiles)this._tiles[f].hasDependency(r,s)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(r,s))}_preloadTiles(r,s){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(r,s))};return void this._source.on("data",C)}const f=new Map,_=Array.isArray(r)?r:[r],x=this.map.painter.terrain,S=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const C of _){const R=C.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of R)f.set(F.key,F);this.usedForTerrain&&C.updateElevation(!1)}const E=Array.from(f.values());o.bt(E,(C,R)=>{const F=new ul(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(F,j=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),R(j,F)})},s)}}function Us(d,r){const s=Math.abs(2*d.wrap)-+(d.wrap<0),f=Math.abs(2*r.wrap)-+(r.wrap<0);return d.overscaledZ-r.overscaledZ||f-s||r.canonical.y-d.canonical.y||r.canonical.x-d.canonical.x}function Vs(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function ts(d,r){const s=1<<d.z;return[d.x/s+r,(d.x+1)/s+r]}Zo.maxOverzooming=10,Zo.maxUnderzooming=3;class hh{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,s=!1;for(const f in this.style._mergedLayers){const _=this.style._mergedLayers[f];if(_.type==="fill-extrusion")this.layers.push({layer:_,visible:r,visibilityChanged:s});else if(_.type==="model"){const x=this.style.getLayerSource(_);x&&x.type==="batched-model"&&this.layers.push({layer:_,visible:r,visibilityChanged:s})}}}onNewFrame(r){this.layersGotHidden=!1;for(const s of this.layers){const f=s.layer;let _=!1;f.type==="fill-extrusion"?_=!f.isHidden(r)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="model"&&(_=!f.isHidden(r)&&f.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&s.visible,s.visible=_}}updateZOffset(r,s){this.currentBuildingBuckets=[];for(const _ of this.layers){const x=_.layer,S=this.style.getLayerSourceCache(x);let E=1;x.type==="fill-extrusion"&&(E=_.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let C=S?S.getTile(s):null;if(!C&&S&&s.canonical.z>S.getSource().minzoom){let R=s.scaledTo(Math.min(S.getSource().maxzoom,s.overscaledZ-1));for(;R.overscaledZ>=S.getSource().minzoom&&(C=S.getTile(R),!C&&R.overscaledZ!==0);)R=R.scaledTo(R.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:C?C.getBucket(x):null,tileID:C?C.tileID:s,verticalScale:E})}r.hasAnyZOffset=!1;let f=!1;for(let _=0;_<r.symbolInstances.length;_++){const x=r.symbolInstances.get(_),S=x.zOffset,E=this._getHeightAtTileOffset(s,x.tileAnchorX,x.tileAnchorY);x.zOffset=E!==Number.NEGATIVE_INFINITY?E:S,f||S===x.zOffset||(f=!0),r.hasAnyZOffset||x.zOffset===0||(r.hasAnyZOffset=!0)}f&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,s,f,_){let x=s,S=f;if(r.canonical.z!==_.canonical.z){const E=_.canonical,C=1/(1<<r.canonical.z-E.z);x=(s+r.canonical.x*o.aj)*C-E.x*o.aj|0,S=(f+r.canonical.y*o.aj)*C-E.y*o.aj|0}return{tileX:x,tileY:S}}_getHeightAtTileOffset(r,s,f){let _,x;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;const{bucket:E,tileID:C,verticalScale:R}=this.currentBuildingBuckets[S];if(!E)continue;const{tileX:F,tileY:j}=this._mapCoordToOverlappingTile(r,s,f,C),B=E.getHeightAtTileCoord(F,j);B&&B.height!==void 0&&(B.hidden?_=B.height:x=Math.max(B.height*R,x||0))}if(x!==void 0)return x;for(let S=0;S<this.layers.length;++S){const E=this.layers[S];if(E.layer.type!=="model"||!E.visible)continue;const{bucket:C,tileID:R}=this.currentBuildingBuckets[S];if(!C)continue;const{tileX:F,tileY:j}=this._mapCoordToOverlappingTile(r,s,f,R),B=C.getHeightAtTileCoord(F,j);if(B&&!B.hidden)return B.height===void 0&&_!==void 0?Math.min(B.maxHeight,_)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Mc(d,r){const s={};for(const f in d)f!=="ref"&&(s[f]=d[f]);return o.bu.forEach(f=>{f in r&&(s[f]=r[f])}),s}function $s(d){d=d.slice();const r=Object.create(null);for(let s=0;s<d.length;s++)r[d[s].id]=d[s];for(let s=0;s<d.length;s++)"ref"in d[s]&&(d[s]=Mc(d[s],r[d[s].ref]));return d}const Mn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function xu(d,r,s){s.push({command:Mn.addSource,args:[d,r[d]]})}function hl(d,r,s){r.push({command:Mn.removeSource,args:[d]}),s[d]=!0}function Yg(d,r,s,f){hl(d,s,f),xu(d,r,s)}function Mp(d,r,s){let f;for(f in d[s])if(d[s].hasOwnProperty(f)&&f!=="data"&&!o.bv(d[s][f],r[s][f]))return!1;for(f in r[s])if(r[s].hasOwnProperty(f)&&f!=="data"&&!o.bv(d[s][f],r[s][f]))return!1;return!0}function dl(d,r,s,f,_,x){let S;for(S in r=r||{},d=d||{})d.hasOwnProperty(S)&&(o.bv(d[S],r[S])||s.push({command:x,args:[f,S,r[S],_]}));for(S in r)r.hasOwnProperty(S)&&!d.hasOwnProperty(S)&&(o.bv(d[S],r[S])||s.push({command:x,args:[f,S,r[S],_]}))}function Yl(d){return d.id}function dh(d,r){return d[r.id]=r,d}class fh{constructor(r,s){this.reset(r,s)}reset(r,s){this.points=r||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.aD(r,0,1);let s=1,f=this._distances[s];const _=r*this.paddedLength+this.padding;for(;f<_&&s<this._distances.length;)f=this._distances[++s];const x=s-1,S=this._distances[x],E=f-S,C=E>0?(_-S)/E:0;return this.points[x].mult(1-C).add(this.points[s].mult(C))}}class bu{constructor(r,s,f){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(r/f),this.yCellCount=Math.ceil(s/f);for(let S=0;S<this.xCellCount*this.yCellCount;S++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=s,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,s,f,_,x){this._forEachCell(s,f,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(s),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(r,s,f,_){this._forEachCell(s-_,f-_,s+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(s),this.circles.push(f),this.circles.push(_)}_insertBoxCell(r,s,f,_,x,S){this.boxCells[x].push(S)}_insertCircleCell(r,s,f,_,x,S){this.circleCells[x].push(S)}_query(r,s,f,_,x,S){if(f<0||r>this.width||_<0||s>this.height)return!x&&[];const E=[];if(r<=0&&s<=0&&this.width<=f&&this.height<=_){if(x)return!0;for(let C=0;C<this.boxKeys.length;C++)E.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const R=this.circles[3*C],F=this.circles[3*C+1],j=this.circles[3*C+2];E.push({key:this.circleKeys[C],x1:R-j,y1:F-j,x2:R+j,y2:F+j})}return S?E.filter(S):E}return this._forEachCell(r,s,f,_,this._queryCell,E,{hitTest:x,seenUids:{box:{},circle:{}}},S),x?E.length>0:E}_queryCircle(r,s,f,_,x){const S=r-f,E=r+f,C=s-f,R=s+f;if(E<0||S>this.width||R<0||C>this.height)return!_&&[];const F=[];return this._forEachCell(S,C,E,R,this._queryCellCircle,F,{hitTest:_,circle:{x:r,y:s,radius:f},seenUids:{box:{},circle:{}}},x),_?F.length>0:F}query(r,s,f,_,x){return this._query(r,s,f,_,!1,x)}hitTest(r,s,f,_,x){return this._query(r,s,f,_,!0,x)}hitTestCircle(r,s,f,_){return this._queryCircle(r,s,f,!0,_)}_queryCell(r,s,f,_,x,S,E,C){const R=E.seenUids,F=this.boxCells[x];if(F!==null){const B=this.bboxes;for(const G of F)if(!R.box[G]){R.box[G]=!0;const J=4*G;if(r<=B[J+2]&&s<=B[J+3]&&f>=B[J+0]&&_>=B[J+1]&&(!C||C(this.boxKeys[G]))){if(E.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[G],x1:B[J],y1:B[J+1],x2:B[J+2],y2:B[J+3]})}}}const j=this.circleCells[x];if(j!==null){const B=this.circles;for(const G of j)if(!R.circle[G]){R.circle[G]=!0;const J=3*G;if(this._circleAndRectCollide(B[J],B[J+1],B[J+2],r,s,f,_)&&(!C||C(this.circleKeys[G]))){if(E.hitTest)return S.push(!0),!0;{const Y=B[J],te=B[J+1],K=B[J+2];S.push({key:this.circleKeys[G],x1:Y-K,y1:te-K,x2:Y+K,y2:te+K})}}}}}_queryCellCircle(r,s,f,_,x,S,E,C){const R=E.circle,F=E.seenUids,j=this.boxCells[x];if(j!==null){const G=this.bboxes;for(const J of j)if(!F.box[J]){F.box[J]=!0;const Y=4*J;if(this._circleAndRectCollide(R.x,R.y,R.radius,G[Y+0],G[Y+1],G[Y+2],G[Y+3])&&(!C||C(this.boxKeys[J])))return S.push(!0),!0}}const B=this.circleCells[x];if(B!==null){const G=this.circles;for(const J of B)if(!F.circle[J]){F.circle[J]=!0;const Y=3*J;if(this._circlesCollide(G[Y],G[Y+1],G[Y+2],R.x,R.y,R.radius)&&(!C||C(this.circleKeys[J])))return S.push(!0),!0}}}_forEachCell(r,s,f,_,x,S,E,C){const R=this._convertToXCellCoord(r),F=this._convertToYCellCoord(s),j=this._convertToXCellCoord(f),B=this._convertToYCellCoord(_);for(let G=R;G<=j;G++)for(let J=F;J<=B;J++)if(x.call(this,r,s,f,_,this.xCellCount*J+G,S,E,C))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,s,f,_,x,S){const E=_-r,C=x-s,R=f+S;return R*R>E*E+C*C}_circleAndRectCollide(r,s,f,_,x,S,E){const C=(S-_)/2,R=Math.abs(r-(_+C));if(R>C+f)return!1;const F=(E-x)/2,j=Math.abs(s-(x+F));if(j>F+f)return!1;if(R<=C||j<=F)return!0;const B=R-C,G=j-F;return B*B+G*G<=f*f}}const ys={unknown:0,flipRequired:1,flipNotRequired:2},Oc=Math.tan(85*Math.PI/180);function ph(d,r,s,f,_,x,S){const E=o.bz();if(s)if(x.name==="globe"){const C=o.bA(_,r);o.az(E,E,C)}else{const C=o.bB([],S);E[0]=C[0],E[1]=C[1],E[4]=C[2],E[5]=C[3],f||o.by(E,E,_.angle)}else o.az(E,_.labelPlaneMatrix,d);return E}function xf(d,r,s,f,_,x,S){const E=ph(d,r,s,f,_,x,S);return x.name==="globe"&&s||(E[2]=E[6]=E[10]=E[14]=0),E}function md(d,r,s,f,_,x,S){if(s){if(x.name==="globe"){const E=ph(d,r,s,f,_,x,S);return o.bi(E,E),o.az(E,d,E),E}{const E=o.bw(d),C=o.bx([]);return C[0]=S[0],C[1]=S[1],C[4]=S[2],C[5]=S[3],o.az(E,E,C),f||o.by(E,E,-_.angle),E}}return _.glCoordMatrix}function aa(d,r,s,f){const _=[d,r,s,1];s?o.aA(_,_,f):Su(_,_,f);const x=_[3];return _[0]/=x,_[1]/=x,_[2]/=x,_}function fl(d,r){return Math.min(.5+d/r*.5,1.5)}function bf(d,r){const s=d[0]/d[3],f=d[1]/d[3];return s>=-r[0]&&s<=r[0]&&f>=-r[1]&&f<=r[1]}function pl(d,r,s,f,_,x,S,E,C,R){const F=s.transform,j=f?d.textSizeData:d.iconSizeData,B=o.bH(j,s.transform.zoom),G=F.projection.name==="globe",J=[256/s.width*2+1,256/s.height*2+1],Y=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;Y.clear();let te=null;G&&(te=f?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const K=d.lineVertexArray,ce=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,fe=s.transform.width/s.transform.height;let pe,Ee=!1;for(let Te=0;Te<ce.length;Te++){const we=ce.get(Te),{numGlyphs:ye,writingMode:Ie}=we;if(Ie!==o.bI.vertical||Ee||pe===o.bI.horizontal||(Ee=!0),pe=Ie,(we.hidden||Ie===o.bI.vertical)&&!Ee){dn(ye,Y);continue}Ee=!1;const Oe=new o.P(we.tileAnchorX,we.tileAnchorY);let{x:Xe,y:je,z:st}=F.projection.projectTilePoint(Oe.x,Oe.y,R.canonical);if(C){const[Yt,tr,Bt]=C(Oe);Xe+=Yt,je+=tr,st+=Bt}const ct=[Xe,je,st,1];if(o.aA(ct,ct,r),!bf(ct,J)){dn(ye,Y);continue}const Et=ct[3],Ve=fl(s.transform.getCameraToCenterDistance(F.projection),Et),He=o.bJ(j,B,we),Ue=S?He/Ve:He*Ve,ft=aa(Xe,je,st,_);if(ft[3]<=0){dn(ye,Y);continue}let Ke={};const gt=o.al(d.layers[0].layout.get("text-max-angle")),dt=Math.cos(gt),vt=S?null:C,bt=Ca(we,Ue,!1,E,r,_,x,d.glyphOffsetArray,K,Y,te,ft,Oe,Ke,fe,vt,F.projection,R,S,dt);Ee=bt.useVertical,vt&&bt.needsFlipping&&(Ke={}),(bt.notEnoughRoom||Ee||bt.needsFlipping&&Ca(we,Ue,!0,E,r,_,x,d.glyphOffsetArray,K,Y,te,ft,Oe,Ke,fe,vt,F.projection,R,S,dt).notEnoughRoom)&&dn(ye,Y)}f?(d.text.dynamicLayoutVertexBuffer.updateData(Y),te&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(te)):(d.icon.dynamicLayoutVertexBuffer.updateData(Y),te&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(te))}function mh(d,r,s,f,_,x,S,E,C,R,F,j,B,G,J,Y,te){const{lineStartIndex:K,glyphStartIndex:ce,segment:fe}=E,pe=ce+E.numGlyphs,Ee=K+E.lineLength,Te=r.getoffsetX(ce),we=r.getoffsetX(pe-1),ye=_h(d*Te,s,f,_,x,S,fe,K,Ee,C,R,F,j,B,!0,G,J,Y,te);if(!ye)return null;const Ie=_h(d*we,s,f,_,x,S,fe,K,Ee,C,R,F,j,B,!0,G,J,Y,te);return Ie?{first:ye,last:Ie}:null}function ml(d,r,s,f){return d===o.bI.horizontal&&Math.abs(f)>Math.abs(s)?{useVertical:!0}:d===o.bI.vertical?f>0?{needsFlipping:!0}:null:r!==ys.unknown&&function(_,x){return _===0||Math.abs(x/_)>Oc}(s,f)?r===ys.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function Ca(d,r,s,f,_,x,S,E,C,R,F,j,B,G,J,Y,te,K,ce,fe){const pe=r/24,Ee=d.lineOffsetX*pe,Te=d.lineOffsetY*pe,{lineStartIndex:we,glyphStartIndex:ye,numGlyphs:Ie,segment:Oe,writingMode:Xe,flipState:je}=d,st=we+d.lineLength,ct=Et=>{if(F){const[ft,Ke,gt]=Et.up,dt=R.length;o.bK(F,dt+0,ft,Ke,gt),o.bK(F,dt+1,ft,Ke,gt),o.bK(F,dt+2,ft,Ke,gt),o.bK(F,dt+3,ft,Ke,gt)}const[Ve,He,Ue]=Et.point;o.bL(R,Ve,He,Ue,Et.angle)};if(Ie>1){const Et=mh(pe,E,Ee,Te,s,j,B,d,C,x,G,Y,!1,te,K,ce,fe);if(!Et)return{notEnoughRoom:!0};if(f&&!s){let[Ve,He,Ue]=Et.first.point,[ft,Ke,gt]=Et.last.point;[Ve,He]=aa(Ve,He,Ue,S),[ft,Ke]=aa(ft,Ke,gt,S);const dt=ml(Xe,je,(ft-Ve)*J,Ke-He);if(d.flipState=dt&&dt.needsFlipping?ys.flipRequired:ys.flipNotRequired,dt)return dt}ct(Et.first);for(let Ve=ye+1;Ve<ye+Ie-1;Ve++){const He=_h(pe*E.getoffsetX(Ve),Ee,Te,s,j,B,Oe,we,st,C,x,G,Y,!1,!1,te,K,ce,fe);if(!He)return R.length-=4*(Ve-ye),{notEnoughRoom:!0};ct(He)}ct(Et.last)}else{if(f&&!s){const Ve=aa(B.x,B.y,0,_),He=we+Oe+1,Ue=new o.P(C.getx(He),C.gety(He)),ft=aa(Ue.x,Ue.y,0,_),Ke=ft[3]>0?ft:wu(B,Ue,Ve,1,_,void 0,te,K.canonical),gt=ml(Xe,je,(Ke[0]-Ve[0])*J,Ke[1]-Ve[1]);if(d.flipState=gt&&gt.needsFlipping?ys.flipRequired:ys.flipNotRequired,gt)return gt}const Et=_h(pe*E.getoffsetX(ye),Ee,Te,s,j,B,Oe,we,st,C,x,G,Y,!1,!1,te,K,ce,fe);if(!Et)return{notEnoughRoom:!0};ct(Et)}return{}}function gh(d,r,s,f,_){const{x,y:S,z:E}=f.projectTilePoint(d.x,d.y,r);if(!_)return aa(x,S,E,s);const[C,R,F]=_(d);return aa(x+C,S+R,E+F,s)}function wu(d,r,s,f,_,x,S,E){const C=gh(d.sub(r)._unit()._add(d),E,_,S,x);return o.at(C,s,C),o.au(C,C),o.bF(C,s,C,f)}function _h(d,r,s,f,_,x,S,E,C,R,F,j,B,G,J,Y,te,K,ce){const fe=f?d-r:d+r;let pe=fe>0?1:-1,Ee=0;f&&(pe*=-1,Ee=Math.PI),pe<0&&(Ee+=Math.PI);let Te=E+S+(pe>0?0:1)|0,we=_,ye=_,Ie=0,Oe=0;const Xe=Math.abs(fe),je=[],st=[];let ct=x,Et=ct,Ve=o.bC([]);const He=()=>wu(Et,ct,ye,Xe-Ie+1,F,B,Y,te.canonical);for(;Ie+Oe<=Xe;){if(Te+=pe,Te<E||Te>=C)return null;if(ye=we,Et=ct,je.push(ye),G&&st.push(Et),ct=new o.P(R.getx(Te),R.gety(Te)),we=j[Te],!we){const Bt=gh(ct,te.canonical,F,Y,B);we=Bt[3]>0?j[Te]=Bt:He()}Ie+=Oe;const Yt=o.at([],we,ye),tr=o.bD(ye,we);if(s&&tr>0&&Oe>0&&o.bE(Ve,Yt)/(Oe*tr)<ce)return null;Oe=tr,Ve=Yt}J&&B&&(j[Te]&&(we=He(),Oe=o.bD(ye,we),Ve=o.at([],we,ye)),j[Te]=we);const Ue=(Xe-Ie)/Oe,ft=ct.sub(Et)._mult(Ue)._add(Et),Ke=o.bF([],ye,Ve,Ue);let gt=[0,0,1],dt=Ve[0],vt=Ve[1];if(K&&(gt=Y.upVector(te.canonical,ft.x,ft.y),gt[0]!==0||gt[1]!==0||gt[2]!==1)){const Yt=[gt[2],0,-gt[0]],tr=o.bG([],gt,Yt);o.au(Yt,Yt),o.au(tr,tr),dt=o.bE(Ve,Yt),vt=o.bE(Ve,tr)}if(s){const Yt=o.bG([],gt,Ve);o.au(Yt,Yt),o.bF(Ke,Ke,Yt,s*pe)}const bt=Ee+Math.atan2(vt,dt);return je.push(Ke),G&&st.push(ft),{point:Ke,angle:bt,path:je,tilePath:st,up:gt}}function dn(d,r){const s=r.length,f=s+4*d;r.resize(f),r.float32.fill(-1/0,4*s,4*f)}function Su(d,r,s){const f=r[0],_=r[1];return d[0]=s[0]*f+s[4]*_+s[12],d[1]=s[1]*f+s[5]*_+s[13],d[3]=s[3]*f+s[7]*_+s[15],d}const xr=100;class yh{constructor(r,s,f=new bu(r.width+200,r.height+200,25),_=new bu(r.width+200,r.height+200,25)){this.transform=r,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+xr,this.screenBottomBoundary=r.height+xr,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=s}placeCollisionBox(r,s,f,_,x,S,E,C){let R=f.projectedAnchorX,F=f.projectedAnchorY,j=f.projectedAnchorZ;const B=f.elevation,G=f.tileID,J=r.getProjection();if(B&&G){const[Te,we,ye]=J.upVector(G.canonical,f.tileAnchorX,f.tileAnchorY),Ie=J.upVectorScale(G.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=Te*B*Ie,F+=we*B*Ie,j+=ye*B*Ie}const Y=this.projectAndGetPerspectiveRatio(E,R,F,j,f.tileID,J.name==="globe"||!!B||this.transform.pitch>0,J),te=S*Y.perspectiveRatio,K=(f.x1*s+_.x-f.padding)*te+Y.point.x,ce=(f.y1*s+_.y-f.padding)*te+Y.point.y,fe=(f.x2*s+_.x+f.padding)*te+Y.point.x,pe=(f.y2*s+_.y+f.padding)*te+Y.point.y,Ee=Y.perspectiveRatio<=.55||Y.occluded;return!this.isInsideGrid(K,ce,fe,pe)||!x&&this.grid.hitTest(K,ce,fe,pe,C)||Ee?{box:[],offscreen:!1,occluded:Y.occluded}:{box:[K,ce,fe,pe],offscreen:this.isOffscreen(K,ce,fe,pe),occluded:!1}}placeCollisionCircles(r,s,f,_,x,S,E,C,R,F,j,B,G,J,Y){const te=[],K=this.transform.elevation,ce=r.getProjection(),fe=K?K.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,ce):null,pe=new o.P(f.tileAnchorX,f.tileAnchorY);let{x:Ee,y:Te,z:we}=ce.projectTilePoint(pe.x,pe.y,Y.canonical);if(fe){const[gt,dt,vt]=fe(pe);Ee+=gt,Te+=dt,we+=vt}const ye=ce.name==="globe",Ie=this.projectAndGetPerspectiveRatio(E,Ee,Te,we,Y,ye||!!K||this.transform.pitch>0,ce),{perspectiveRatio:Oe}=Ie,Xe=(j?S/Oe:S*Oe)/o.bO,je=aa(Ee,Te,we,C),st=f.lineOffsetX*Xe,ct=f.lineOffsetY*Xe,Et=o.al(r.layers[0].layout.get("text-max-angle")),Ve=Math.cos(Et),He=Ie.signedDistanceFromCamera>0?mh(Xe,x,st,ct,!1,je,pe,f,_,C,{},K&&!j?fe:null,j&&!!K,ce,Y,j,Ve):null;let Ue=!1,ft=!1,Ke=!0;if(He&&!Ie.occluded){const gt=.5*G*Oe+J,dt=new o.P(-100,-100),vt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),bt=new fh,{first:Yt,last:tr}=He,Bt=Yt.path.length;let er=[];for(let Or=Bt-1;Or>=1;Or--)er.push(Yt.path[Or]);for(let Or=1;Or<tr.path.length;Or++)er.push(tr.path[Or]);const Wt=2.5*gt;R&&(er=er.map(([Or,rn,Gn],qn)=>(fe&&!ye&&(Gn=fe(qn<Bt-1?Yt.tilePath[Bt-1-qn]:tr.tilePath[qn-Bt+2])[2]),aa(Or,rn,Gn,R))),er.some(Or=>Or[3]<=0)&&(er=[]));let hr=[];if(er.length>0){let Or=1/0,rn=-1/0,Gn=1/0,qn=-1/0;for(const Hr of er)Or=Math.min(Or,Hr[0]),Gn=Math.min(Gn,Hr[1]),rn=Math.max(rn,Hr[0]),qn=Math.max(qn,Hr[1]);rn>=dt.x&&Or<=vt.x&&qn>=dt.y&&Gn<=vt.y&&(hr=[er.map(Hr=>new o.P(Hr[0],Hr[1]))],(Or<dt.x||rn>vt.x||Gn<dt.y||qn>vt.y)&&(hr=o.bM(hr,dt.x,dt.y,vt.x,vt.y)))}for(const Or of hr){bt.reset(Or,.25*gt);let rn=0;rn=bt.length<=.5*gt?1:Math.ceil(bt.paddedLength/Wt)+1;for(let Gn=0;Gn<rn;Gn++){const qn=Gn/Math.max(rn-1,1),Hr=bt.lerp(qn),Li=Hr.x+xr,_i=Hr.y+xr;te.push(Li,_i,gt,0);const Rr=Li-gt,_n=_i-gt,yn=Li+gt,Wn=_i+gt;if(Ke=Ke&&this.isOffscreen(Rr,_n,yn,Wn),ft=ft||this.isInsideGrid(Rr,_n,yn,Wn),!s&&this.grid.hitTestCircle(Li,_i,gt,B)&&(Ue=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Ue,occluded:!1}}}}return{circles:!F&&Ue||!ft?[]:te,offscreen:Ke,collisionDetected:Ue,occluded:Ie.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let f=1/0,_=1/0,x=-1/0,S=-1/0;for(const F of r){const j=new o.P(F.x+xr,F.y+xr);f=Math.min(f,j.x),_=Math.min(_,j.y),x=Math.max(x,j.x),S=Math.max(S,j.y),s.push(j)}const E=this.grid.query(f,_,x,S).concat(this.ignoredGrid.query(f,_,x,S)),C={},R={};for(const F of E){const j=F.key;if(C[j.bucketInstanceId]===void 0&&(C[j.bucketInstanceId]={}),C[j.bucketInstanceId][j.featureIndex])continue;const B=[new o.P(F.x1,F.y1),new o.P(F.x2,F.y1),new o.P(F.x2,F.y2),new o.P(F.x1,F.y2)];o.bN(s,B)&&(C[j.bucketInstanceId][j.featureIndex]=!0,R[j.bucketInstanceId]===void 0&&(R[j.bucketInstanceId]=[]),R[j.bucketInstanceId].push(j.featureIndex))}return R}insertCollisionBox(r,s,f,_,x){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:x},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,s,f,_,x){const S=s?this.ignoredGrid:this.grid,E={bucketInstanceId:f,featureIndex:_,collisionGroupID:x};for(let C=0;C<r.length;C+=4)S.insertCircle(E,r[C],r[C+1],r[C+2])}projectAndGetPerspectiveRatio(r,s,f,_,x,S,E){const C=[s,f,_,1];let R=!1;_||this.transform.pitch>0?(o.aA(C,C,r),this.fogState&&x&&E.name!=="globe"&&(R=function(B,G,J,Y,te,K){const ce=K.calculateFogTileMatrix(te),fe=[G,J,Y];return o.ad(fe,fe,ce),Ot(B,o.ae(fe),K.pitch,K._fov)}(this.fogState,s,f,_,x.toUnwrapped(),this.transform)>.9)):Su(C,C,r);const F=C[3];return{point:new o.P((C[0]/F+1)/2*this.transform.width+xr,(-C[1]/F+1)/2*this.transform.height+xr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/F*.5,1.5),signedDistanceFromCamera:F,occluded:S&&C[2]>F||R}}isOffscreen(r,s,f,_){return f<xr||r>=this.screenRightBoundary||_<xr||s>this.screenBottomBoundary}isInsideGrid(r,s,f,_){return f>=0&&r<this.gridRightBoundary&&_>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const r=o.bx([]);return o.bo(r,r,[-100,-100,0]),r}}function wf(d,r,s){const f=r.createTileMatrix(d,d.worldSize,s.toUnwrapped());return o.az(new Float32Array(16),d.projMatrix,f)}function vh(d,r,s){if(r.projection.name===s.projection.name)return d.projMatrix;const f=s.clone();return f.setProjection(r.projection),wf(f,r.getProjection(),d)}function Tu(d,r,s){return r.name===s.projection.name?d.projMatrix:wf(s,r,d)}class ga{constructor(r,s,f,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?s:-s))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class gl{constructor(r,s,f,_,x,S=!1){this.text=new ga(r?r.text:null,s,f,x),this.icon=new ga(r?r.icon:null,s,_,x),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Kl{constructor(r,s,f,_=!1){this.text=r,this.icon=s,this.skipFade=f,this.clipped=_}}class ur{constructor(){this.invProjMatrix=o.bz(),this.viewportMatrix=o.bz(),this.circles=[]}}class Qn{constructor(r,s,f,_,x){this.bucketInstanceId=r,this.featureIndex=s,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=x}}class Vn{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const s=++this.maxGroupID;this.collisionGroups[r]={ID:s,predicate:f=>f.collisionGroupID===s}}return this.collisionGroups[r]}}function sa(d,r,s,f,_){const{horizontalAlign:x,verticalAlign:S}=o.bV(d),E=-(x-.5)*r,C=-(S-.5)*s,R=o.bU(d,f);return new o.P(E+R[0]*_,C+R[1]*_)}function Dc(d,r,s,f,_){const x=new o.P(d,r);return s&&x._rotate(f?_:-_),x}class jn{constructor(r,s,f,_,x,S){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new yh(this.transform,x),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Vn(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,s,f,_,x=1){const S=f.getBucket(s),E=f.latestFeatureIndex;if(!S||!E||s.fqid!==S.layerIds[0])return;const C=S.layers[0].layout,R=S.layers[0].paint,F=f.collisionBoxArray,j=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),B=f.tileSize/o.aj,G=f.tileID.toUnwrapped();this.transform.setProjection(S.projection);const J=(Y=f.tileID,te=S.getProjection(),K=this.transform,te.name===this.projection?K.calculateProjMatrix(Y.toUnwrapped()):wf(K,te,Y));var Y,te,K;const ce=C.get("text-pitch-alignment")==="map",fe=C.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const pe=s.dynamicFilter(),Ee=s.dynamicFilterNeedsFeature(),Te=this.transform.calculatePixelsToTileUnitsMatrix(f),we=xf(J,f.tileID.canonical,ce,fe,this.transform,S.getProjection(),Te);let ye=null;if(ce){const He=md(J,f.tileID.canonical,ce,fe,this.transform,S.getProjection(),Te);ye=o.az([],this.transform.labelPlaneMatrix,He)}let Ie=null;pe&&f.latestFeatureIndex&&(Ie={unwrappedTileID:G,dynamicFilter:pe,dynamicFilterNeedsFeature:Ee}),this.retainedQueryData[S.bucketInstanceId]=new Qn(S.bucketInstanceId,E,S.sourceLayerIndex,S.index,f.tileID);const[Oe,Xe]=S.layers[0].layout.get("text-size-scale-range"),je=o.aD(x,Oe,Xe),[st,ct]=C.get("icon-size-scale-range"),Et=o.aD(x,st,ct),Ve={bucket:S,layout:C,paint:R,posMatrix:J,textLabelPlaneMatrix:we,labelToScreenMatrix:ye,clippingData:Ie,scale:j,textPixelRatio:B,holdingForFade:f.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:o.bH(S.textSizeData,this.transform.zoom,je),partiallyEvaluatedIconSize:o.bH(S.iconSizeData,this.transform.zoom,Et),collisionGroup:this.collisionGroups.get(S.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(_)for(const He of S.sortKeyRanges){const{sortKey:Ue,symbolInstanceStart:ft,symbolInstanceEnd:Ke}=He;r.push({sortKey:Ue,symbolInstanceStart:ft,symbolInstanceEnd:Ke,parameters:Ve})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Ve})}attemptAnchorPlacement(r,s,f,_,x,S,E,C,R,F,j,B,G,J,Y,te,K,ce){const{textOffset0:fe,textOffset1:pe,crossTileID:Ee}=B,Te=[fe,pe],we=sa(r,f,_,Te,x),ye=this.collisionIndex.placeCollisionBox(J,x,s,Dc(we.x,we.y,S,E,this.transform.angle),j,C,R,F.predicate);if(te){const Ie=J.getSymbolInstanceIconSize(ce,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(J,Ie,te,Dc(we.x,we.y,S,E,this.transform.angle),j,C,R,F.predicate).box.length===0)return}if(ye.box.length>0){let Ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ee]&&this.prevPlacement.placements[Ee]&&this.prevPlacement.placements[Ee].text&&(Ie=this.prevPlacement.variableOffsets[Ee].anchor),this.variableOffsets[Ee]={textOffset:Te,width:f,height:_,anchor:r,textScale:x,prevAnchor:Ie},this.markUsedJustification(J,r,B,Y),J.allowVerticalPlacement&&(this.markUsedOrientation(J,Y,B),this.placedOrientations[Ee]=Y),{shift:we,placedGlyphBoxes:ye}}}placeLayerBucketPart(r,s,f,_,x=1){const{bucket:S,layout:E,paint:C,posMatrix:R,textLabelPlaneMatrix:F,labelToScreenMatrix:j,clippingData:B,textPixelRatio:G,holdingForFade:J,collisionBoxArray:Y,partiallyEvaluatedTextSize:te,partiallyEvaluatedIconSize:K,collisionGroup:ce,latestFeatureIndex:fe}=r.parameters,pe=E.get("text-optional"),Ee=E.get("icon-optional"),Te=E.get("text-allow-overlap"),we=E.get("icon-allow-overlap"),ye=E.get("text-rotation-alignment")==="map",Ie=E.get("text-pitch-alignment")==="map",Oe=C.get("symbol-z-offset"),Xe=E.get("symbol-elevation-reference")==="sea",[je,st]=E.get("text-size-scale-range"),[ct,Et]=E.get("icon-size-scale-range"),Ve=o.aD(x,je,st),He=o.aD(x,ct,Et);this.transform.setProjection(S.projection);let Ue=Te&&(we||!S.hasIconData()||Ee),ft=we&&(Te||!S.hasTextData()||pe);const Ke=!Oe.isConstant();!S.collisionArrays&&Y&&S.deserializeCollisionBoxes(Y),f&&_&&S.updateCollisionDebugBuffers(this.transform.zoom,Y,Ve,He);const gt=(dt,vt,bt)=>{const{crossTileID:Yt,numVerticalGlyphVertices:tr}=dt;let Bt=null;if(B&&B.dynamicFilterNeedsFeature||Ke){const In=this.retainedQueryData[S.bucketInstanceId];Bt=fe.loadFeature({featureIndex:dt.featureIndex,bucketIndex:In.bucketIndex,sourceLayerIndex:In.sourceLayerIndex,layoutVertexArrayOffset:0})}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Bt,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new o.P(dt.tileAnchorX,dt.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[Yt]=new Kl(!1,!1,!1,!0),void s.add(Yt);const er=Oe.evaluate(Bt,{});if(s.has(Yt))return;if(J)return void(this.placements[Yt]=new Kl(!1,!1,!1));let Wt=!1,hr=!1,Or=!0,rn=!1,Gn=!1,qn=null,Hr={box:null,offscreen:null,occluded:null},Li={box:null},_i=null,Rr=null,_n=null,yn=0,Wn=0,no=0;bt.textFeatureIndex?yn=bt.textFeatureIndex:dt.useRuntimeCollisionCircles&&(yn=dt.featureIndex),bt.verticalTextFeatureIndex&&(Wn=bt.verticalTextFeatureIndex);const zi=In=>{In.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const Yn=this.transform.elevation;In.elevation=Xe?er:er+(Yn?Yn.getAtTileOffset(In.tileID,In.tileAnchorX,In.tileAnchorY):0),In.elevation+=dt.zOffset},Gi=bt.textBox;if(Gi){zi(Gi);const In=Fn=>{let ri=o.bI.horizontal;if(S.allowVerticalPlacement&&!Fn&&this.prevPlacement){const To=this.prevPlacement.placedOrientations[Yt];To&&(this.placedOrientations[Yt]=To,ri=To,this.markUsedOrientation(S,ri,dt))}return ri},Yn=(Fn,ri)=>{if(S.allowVerticalPlacement&&tr>0&&bt.verticalTextBox){for(const To of S.writingModes)if(To===o.bI.vertical?(Hr=ri(),Li=Hr):Hr=Fn(),Hr&&Hr.box&&Hr.box.length)break}else Hr=Fn()};if(E.get("text-variable-anchor")){let Fn=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Yt]){const fn=this.prevPlacement.variableOffsets[Yt];Fn.indexOf(fn.anchor)>0&&(Fn=Fn.filter(jo=>jo!==fn.anchor),Fn.unshift(fn.anchor))}const ri=(fn,jo,Zi)=>{const Qo=S.getSymbolInstanceTextSize(te,dt,this.transform.zoom,vt),Qs=(fn.x2-fn.x1)*Qo+2*fn.padding,Rl=(fn.y2-fn.y1)*Qo+2*fn.padding,za=dt.hasIconTextFit&&!we?jo:null;za&&zi(za);let Os={box:[],offscreen:!1,occluded:!1};const Mo=Te?2*Fn.length:Fn.length;for(let Ds=0;Ds<Mo;++Ds){const el=this.attemptAnchorPlacement(Fn[Ds%Fn.length],fn,Qs,Rl,Qo,ye,Ie,G,R,ce,Ds>=Fn.length,dt,vt,S,Zi,za,te,K);if(el&&(Os=el.placedGlyphBoxes,Os&&Os.box&&Os.box.length)){Wt=!0,qn=el.shift;break}}return Os};Yn(()=>ri(Gi,bt.iconBox,o.bI.horizontal),()=>{const fn=bt.verticalTextBox;return fn&&zi(fn),S.allowVerticalPlacement&&!(Hr&&Hr.box&&Hr.box.length)&&tr>0&&fn?ri(fn,bt.verticalIconBox,o.bI.vertical):{box:null,offscreen:null,occluded:null}}),Hr&&(Wt=Hr.box,Or=Hr.offscreen,rn=Hr.occluded);const To=In(!(!Hr||!Hr.box));if(!Wt&&this.prevPlacement){const fn=this.prevPlacement.variableOffsets[Yt];fn&&(this.variableOffsets[Yt]=fn,this.markUsedJustification(S,fn.anchor,dt,To))}}else{const Fn=(ri,To)=>{const fn=S.getSymbolInstanceTextSize(te,dt,this.transform.zoom,vt,x),jo=this.collisionIndex.placeCollisionBox(S,fn,ri,new o.P(0,0),Te,G,R,ce.predicate);return jo&&jo.box&&jo.box.length&&(this.markUsedOrientation(S,To,dt),this.placedOrientations[Yt]=To),jo};Yn(()=>Fn(Gi,o.bI.horizontal),()=>{const ri=bt.verticalTextBox;return S.allowVerticalPlacement&&tr>0&&ri?(zi(ri),Fn(ri,o.bI.vertical)):{box:null,offscreen:null,occluded:null}}),In(!!(Hr&&Hr.box&&Hr.box.length))}}if(_i=Hr,Wt=_i&&_i.box&&_i.box.length>0,Or=_i&&_i.offscreen,rn=_i&&_i.occluded,dt.useRuntimeCollisionCircles){const In=S.text.placedSymbolArray.get(dt.centerJustifiedTextSymbolIndex>=0?dt.centerJustifiedTextSymbolIndex:dt.verticalPlacedTextSymbolIndex),Yn=o.bJ(S.textSizeData,te,In),Fn=E.get("text-padding");Rr=this.collisionIndex.placeCollisionCircles(S,Te,In,S.lineVertexArray,S.glyphOffsetArray,Yn,R,F,j,f,Ie,ce.predicate,dt.collisionCircleDiameter*Yn/o.bO,Fn,this.retainedQueryData[S.bucketInstanceId].tileID),Wt=Te||Rr.circles.length>0&&!Rr.collisionDetected,Or=Or&&Rr.offscreen,rn=Rr.occluded}if(bt.iconFeatureIndex&&(no=bt.iconFeatureIndex),bt.iconBox){const In=Yn=>{zi(Yn);const Fn=dt.hasIconTextFit&&qn?Dc(qn.x,qn.y,ye,Ie,this.transform.angle):new o.P(0,0),ri=S.getSymbolInstanceIconSize(K,this.transform.zoom,dt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,ri,Yn,Fn,we,G,R,ce.predicate)};Li&&Li.box&&Li.box.length&&bt.verticalIconBox?(_n=In(bt.verticalIconBox),hr=_n.box.length>0):(_n=In(bt.iconBox),hr=_n.box.length>0),Or=Or&&_n.offscreen,Gn=_n.occluded}const Ti=pe||dt.numHorizontalGlyphVertices===0&&tr===0,Zr=Ee||dt.numIconVertices===0;if(Ti||Zr?Zr?Ti||(hr=hr&&Wt):Wt=hr&&Wt:hr=Wt=hr&&Wt,Wt&&_i&&_i.box&&this.collisionIndex.insertCollisionBox(_i.box,E.get("text-ignore-placement"),S.bucketInstanceId,Li&&Li.box&&Wn?Wn:yn,ce.ID),hr&&_n&&this.collisionIndex.insertCollisionBox(_n.box,E.get("icon-ignore-placement"),S.bucketInstanceId,no,ce.ID),Rr&&(Wt&&this.collisionIndex.insertCollisionCircles(Rr.circles,E.get("text-ignore-placement"),S.bucketInstanceId,yn,ce.ID),f)){const In=S.bucketInstanceId;let Yn=this.collisionCircleArrays[In];Yn===void 0&&(Yn=this.collisionCircleArrays[In]=new ur);for(let Fn=0;Fn<Rr.circles.length;Fn+=4)Yn.circles.push(Rr.circles[Fn+0]),Yn.circles.push(Rr.circles[Fn+1]),Yn.circles.push(Rr.circles[Fn+2]),Yn.circles.push(Rr.collisionDetected?1:0)}const di=S.projection.name!=="globe";Ue=Ue&&(di||!rn),ft=ft&&(di||!Gn),this.placements[Yt]=new Kl(Wt||Ue,hr||ft,Or||S.justReloaded),s.add(Yt)};if(S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,this.retainedQueryData[S.bucketInstanceId].tileID),S.elevationType==="road"&&S.updateRoadElevation(),S.updateZOffset(),S.sortFeaturesByY){const dt=S.getSortedSymbolIndexes(this.transform.angle);for(let vt=dt.length-1;vt>=0;--vt){const bt=dt[vt];gt(S.symbolInstances.get(bt),bt,S.collisionArrays[bt])}S.hasAnyZOffset&&o.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const dt=S.getSortedIndexesByZOffset();for(let vt=0;vt<dt.length;++vt){const bt=dt[vt];gt(S.symbolInstances.get(bt),bt,S.collisionArrays[bt])}}else for(let dt=r.symbolInstanceStart;dt<r.symbolInstanceEnd;dt++)gt(S.symbolInstances.get(dt),dt,S.collisionArrays[dt]);if(f&&S.bucketInstanceId in this.collisionCircleArrays){const dt=this.collisionCircleArrays[S.bucketInstanceId];o.bi(dt.invProjMatrix,R),dt.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(r,s,f,_){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:C,crossTileID:R}=f,F=o.bT(s),j=_===o.bI.vertical?C:F==="left"?x:F==="center"?S:F==="right"?E:-1;x>=0&&(r.text.placedSymbolArray.get(x).crossTileID=j>=0&&x!==j?0:R),S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=j>=0&&S!==j?0:R),E>=0&&(r.text.placedSymbolArray.get(E).crossTileID=j>=0&&E!==j?0:R),C>=0&&(r.text.placedSymbolArray.get(C).crossTileID=j>=0&&C!==j?0:R)}markUsedOrientation(r,s,f){const _=s===o.bI.horizontal||s===o.bI.horizontalOnly?s:0,x=s===o.bI.vertical?s:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:R}=f,F=r.text.placedSymbolArray;S>=0&&(F.get(S).placedOrientation=_),E>=0&&(F.get(E).placedOrientation=_),C>=0&&(F.get(C).placedOrientation=_),R>=0&&(F.get(R).placedOrientation=x)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let f=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const _=s?s.symbolFadeChange(r):1,x=s?s.opacities:{},S=s?s.variableOffsets:{},E=s?s.placedOrientations:{};for(const C in this.placements){const R=this.placements[C],F=x[C];F?(this.opacities[C]=new gl(F,_,R.text,R.icon,null,R.clipped),f=f||R.text!==F.text.placed||R.icon!==F.icon.placed):(this.opacities[C]=new gl(null,_,R.text,R.icon,R.skipFade,R.clipped),f=f||R.text||R.icon)}for(const C in x){const R=x[C];if(!this.opacities[C]){const F=new gl(R,_,!1,!1);F.isHidden()||(this.opacities[C]=F,f=f||R.text.placed||R.icon.placed)}}for(const C in S)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=S[C]);for(const C in E)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=E[C]);f?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:r)}updateLayerOpacities(r,s,f,_){const x=new Set;for(const S of s){const E=S.getBucket(r);E&&S.latestFeatureIndex&&r.fqid===E.layerIds[0]&&(this.updateBucketOpacities(E,x,S,S.collisionBoxArray,f,_,S.tileID,r.scope),E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,S.tileID),E.elevationType==="road"&&E.updateRoadElevation(),E.updateZOffset())}}updateBucketOpacities(r,s,f,_,x,S,E,C){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const R=r.layers[0].layout,F=r.layers[0].paint,j=!!r.layers[0].dynamicFilter(),B=new gl(null,0,!1,!1,!0),G=R.get("text-allow-overlap"),J=R.get("icon-allow-overlap"),Y=R.get("text-variable-anchor"),te=R.get("text-rotation-alignment")==="map",K=R.get("text-pitch-alignment")==="map",ce=F.get("symbol-z-offset"),fe=R.get("symbol-elevation-reference")==="sea",pe=!ce.isConstant(),Ee=new gl(null,0,G&&(J||!r.hasIconData()||R.get("icon-optional")),J&&(G||!r.hasTextData()||R.get("text-optional")),!0);!r.collisionArrays&&_&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(_);const Te=(ye,Ie,Oe)=>{for(let Xe=0;Xe<Ie/4;Xe++)ye.opacityVertexArray.emplaceBack(Oe)};let we=0;S&&r.updateReplacement(E,S);for(let ye=0;ye<r.symbolInstances.length;ye++){const Ie=r.symbolInstances.get(ye),{numHorizontalGlyphVertices:Oe,numVerticalGlyphVertices:Xe,crossTileID:je,numIconVertices:st,tileAnchorX:ct,tileAnchorY:Et}=Ie;let Ve=null;const He=this.retainedQueryData[r.bucketInstanceId];pe&&Ie&&He&&(Ve=f.latestFeatureIndex.loadFeature({featureIndex:Ie.featureIndex,bucketIndex:He.bucketIndex,sourceLayerIndex:He.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ue=ce.evaluate(Ve,{}),ft=s.has(je);let Ke=this.opacities[je];ft?Ke=B:Ke||(Ke=Ee,this.opacities[je]=Ke),s.add(je);const gt=Oe>0||Xe>0,dt=st>0,vt=this.placedOrientations[je],bt=vt===o.bI.vertical,Yt=vt===o.bI.horizontal||vt===o.bI.horizontalOnly;!gt&&!dt||Ke.isHidden()||we++;let tr=!1;if((gt||dt)&&S)for(const Bt of r.activeReplacements){if(o.bP(Bt,x,o.bQ.Symbol,C)||Bt.min.x>ct||ct>Bt.max.x||Bt.min.y>Et||Et>Bt.max.y)continue;const er=o.bR(ct,Et,E.canonical,Bt.footprintTileId.canonical);if(tr=o.bS(er,Bt.footprint),tr)break}if(gt){const Bt=tr?Rc:kc(Ke.text);Te(r.text,Oe,bt?Rc:Bt),Te(r.text,Xe,Yt?Rc:Bt);const er=Ke.text.isHidden(),{leftJustifiedTextSymbolIndex:Wt,centerJustifiedTextSymbolIndex:hr,rightJustifiedTextSymbolIndex:Or,verticalPlacedTextSymbolIndex:rn}=Ie,Gn=r.text.placedSymbolArray,qn=er||bt?1:0;Wt>=0&&(Gn.get(Wt).hidden=qn),hr>=0&&(Gn.get(hr).hidden=qn),Or>=0&&(Gn.get(Or).hidden=qn),rn>=0&&(Gn.get(rn).hidden=er||Yt?1:0);const Hr=this.variableOffsets[je];Hr&&this.markUsedJustification(r,Hr.anchor,Ie,vt);const Li=this.placedOrientations[je];Li&&(this.markUsedJustification(r,"left",Ie,Li),this.markUsedOrientation(r,Li,Ie))}if(dt){const Bt=tr?Rc:kc(Ke.icon),{placedIconSymbolIndex:er,verticalPlacedIconSymbolIndex:Wt}=Ie,hr=r.icon.placedSymbolArray,Or=Ke.icon.isHidden()?1:0;er>=0&&(Te(r.icon,st,bt?Rc:Bt),hr.get(er).hidden=Or),Wt>=0&&(Te(r.icon,Ie.numVerticalIconVertices,Yt?Rc:Bt),hr.get(Wt).hidden=Or)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Bt=r.collisionArrays[ye];if(Bt){let er=new o.P(0,0),Wt=!0;if(Bt.textBox||Bt.verticalTextBox){if(Y){const Or=this.variableOffsets[je];Or?(er=sa(Or.anchor,Or.width,Or.height,Or.textOffset,Or.textScale),te&&er._rotate(K?this.transform.angle:-this.transform.angle)):Wt=!1}j&&(Wt=!Ke.clipped),Bt.textBox&&Eu(r.textCollisionBox.collisionVertexArray,Ke.text.placed,!Wt||bt,Ue,fe,er.x,er.y),Bt.verticalTextBox&&Eu(r.textCollisionBox.collisionVertexArray,Ke.text.placed,!Wt||Yt,Ue,fe,er.x,er.y)}const hr=Wt&&!!(!Yt&&Bt.verticalIconBox);Bt.iconBox&&Eu(r.iconCollisionBox.collisionVertexArray,Ke.icon.placed,hr,Ue,fe,Ie.hasIconTextFit?er.x:0,Ie.hasIconTextFit?er.y:0),Bt.verticalIconBox&&Eu(r.iconCollisionBox.collisionVertexArray,Ke.icon.placed,!hr,Ue,fe,Ie.hasIconTextFit?er.x:0,Ie.hasIconTextFit?er.y:0)}}}if(r.fullyClipped=we===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=ye.invProjMatrix,r.placementViewportMatrix=ye.viewportMatrix,r.collisionCircleArray=ye.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,s){const f=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*f>r}setStale(){this.stale=!0}}function Eu(d,r,s,f,_,x,S){d.emplaceBack(r?1:0,s?1:0,x||0,S||0,f,_?1:0),d.emplaceBack(r?1:0,s?1:0,x||0,S||0,f,_?1:0),d.emplaceBack(r?1:0,s?1:0,x||0,S||0,f,_?1:0),d.emplaceBack(r?1:0,s?1:0,x||0,S||0,f,_?1:0)}const gd=Math.pow(2,25),_d=Math.pow(2,24),la=Math.pow(2,17),po=Math.pow(2,16),Kg=Math.pow(2,9),yd=Math.pow(2,8),Op=Math.pow(2,1);function kc(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const r=d.placed?1:0,s=Math.floor(127*d.opacity);return s*gd+r*_d+s*la+r*po+s*Kg+r*yd+s*Op+r}const Rc=0;class Sf{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,s,f,_,x,S){const E=this._bucketParts;for(;this._currentTileIndex<r.length;)if(s.getBucketParts(E,_,r[this._currentTileIndex],this._sortAcrossTiles,S),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((C,R)=>C.sortKey-R.sortKey));this._currentPartIndex<E.length;){const C=E[this._currentPartIndex];if(s.placeLayerBucketPart(C,this._seenCrossTileIDs,f,C.symbolInstanceStart===0,S),this._currentPartIndex++,x())return!0}return!1}}class _a{constructor(r,s,f,_,x,S,E,C,R){this.placement=new jn(r,x,S,E,C,R),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(r,s,f,_,x){const S=o.q.now(),E=()=>{const C=o.q.now()-S;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=s[r[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=R)&&(!C.maxzoom||C.maxzoom>R)){const F=C,j=F.layout.get("symbol-z-elevate"),B=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,G=F.layout.get("symbol-z-order"),J=G==="viewport-y"||G==="auto"&&!(G!=="viewport-y"&&B),Y=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),te=J&&Y,K=this._inProgressLayer=this._inProgressLayer||new Sf(F),ce=o.C(C.source,C.scope);if(K.continuePlacement(j||te?_[ce]:f[ce],this.placement,this._showCollisionBoxes,C,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const vs=512/o.aj/2;class Ma{constructor(r,s,f){this.tileID=r,this.bucketInstanceId=f,this.index=new o.bW(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=r.canonical.x*o.aj,x=r.canonical.y*o.aj;for(let S=0;S<s.length;S++){const{key:E,crossTileID:C,tileAnchorX:R,tileAnchorY:F}=s.get(S),j=Math.floor((_+R)*vs),B=Math.floor((x+F)*vs);this.index.add(j,B),this.keys.push(E),this.crossTileIDs.push(C)}this.index.finish()}findMatches(r,s,f){const _=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),x=vs/Math.pow(2,s.canonical.z-this.tileID.canonical.z),S=s.canonical.x*o.aj,E=s.canonical.y*o.aj;for(let C=0;C<r.length;C++){const R=r.get(C);if(R.crossTileID)continue;const{key:F,tileAnchorX:j,tileAnchorY:B}=R,G=Math.floor((S+j)*x),J=Math.floor((E+B)*x),Y=this.index.range(G-_,J-_,G+_,J+_).sort((te,K)=>te-K);for(const te of Y){const K=this.crossTileIDs[te];if(this.keys[te]===F&&!f.has(K)){f.add(K),R.crossTileID=K;break}}}}}class Hm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class xh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const s=Math.round((r-this.lng)/360);if(s!==0)for(const f in this.indexes){const _=this.indexes[f],x={};for(const S in _){const E=_[S];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+s),x[E.tileID.key]=E}this.indexes[f]=x}this.lng=r}addBucket(r,s,f){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let x=0;x<s.symbolInstances.length;x++)s.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const _=this.usedCrossTileIDs[r.overscaledZ];for(const x in this.indexes){const S=this.indexes[x];if(Number(x)>r.overscaledZ)for(const E in S){const C=S[E];C.tileID.isChildOf(r)&&C.findMatches(s.symbolInstances,r,_)}else{const E=S[r.scaledTo(Number(x)).key];E&&E.findMatches(s.symbolInstances,r,_)}}for(let x=0;x<s.symbolInstances.length;x++){const S=s.symbolInstances.get(x);S.crossTileID||(S.crossTileID=f.generate(),_.add(S.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Ma(r,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(r,s){for(const f of s.crossTileIDs)this.usedCrossTileIDs[r].delete(f)}removeStaleBuckets(r){let s=!1;for(const f in this.indexes){const _=this.indexes[f];for(const x in _)r[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[x]),delete _[x],s=!0)}return s}}class bo{constructor(){this.layerIndexes={},this.crossTileIDs=new Hm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,s,f,_){let x=this.layerIndexes[r.fqid];x===void 0&&(x=this.layerIndexes[r.fqid]=new xh);let S=!1;const E={};_.name!=="globe"&&x.handleWrapJump(f);for(const C of s){const R=C.getBucket(r);R&&r.fqid===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(C.tileID,R,this.crossTileIDs)&&(S=!0),E[R.bucketInstanceId]=!0)}return x.removeStaleBuckets(E)&&(S=!0),S}pruneUnusedLayers(r){const s={};r.forEach(f=>{s[f]=!0});for(const f in this.layerIndexes)s[f]||delete this.layerIndexes[f]}}const ya=771;class Yr{constructor(r,s,f,_){this.blendFunction=r,this.blendColor=s,this.mask=f,this.blendEquation=_}}Yr.Replace=[1,0,1,0],Yr.disabled=new Yr(Yr.Replace,o.am.transparent,[!1,!1,!1,!1]),Yr.unblended=new Yr(Yr.Replace,o.am.transparent,[!0,!0,!0,!0]),Yr.alphaBlended=new Yr([1,ya,1,ya],o.am.transparent,[!0,!0,!0,!0]),Yr.alphaBlendedNonPremultiplied=new Yr([770,ya,770,ya],o.am.transparent,[!0,!0,!0,!0]),Yr.multiply=new Yr([774,0,774,0],o.am.transparent,[!0,!0,!0,!0]);class Jt{constructor(r,s,f){this.func=r,this.mask=s,this.range=f}}Jt.ReadOnly=!1,Jt.ReadWrite=!0,Jt.disabled=new Jt(519,Jt.ReadOnly,[0,1]);const Au=7680;class Tr{constructor(r,s,f,_,x,S){this.test=r,this.ref=s,this.mask=f,this.fail=_,this.depthFail=x,this.pass=S}}Tr.disabled=new Tr({func:519,mask:0},0,0,Au,Au,Au);const Iu=1029,Pu=2305;class Pr{constructor(r,s,f){this.enable=r,this.mode=s,this.frontFace=f}}function Dp(d,r){const s=o.c1(d,3);o.c3(d,r),o.c7(d,3,s)}function xs(d,r){const s=o.bY([]);return o.bZ(s,s,-r),o.b_(s,s,-d),s}function kp(d,r){const s=[d[0],d[1],0],f=[r[0],r[1],0];if(o.ae(s)>=1e-15){const S=o.au([],s);o.b$(f,S,o.bE(f,S)),r[0]=f[0],r[1]=f[1]}const _=o.bG([],r,d);if(o.c0(_)<1e-15)return null;const x=Math.atan2(-_[1],_[0]);return xs(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),x)}Pr.disabled=new Pr(!1,Iu,Pu),Pr.backCCW=new Pr(!0,Iu,Pu),Pr.backCW=new Pr(!0,Iu,2304),Pr.frontCW=new Pr(!0,1028,2304),Pr.frontCCW=new Pr(!0,1028,Pu);class Jl{constructor(r,s){this.position=r,this.orientation=s}get position(){return this._position}set position(r){if(r){const s=r instanceof o.ac?r:new o.ac(r[0],r[1],r[2]);this._renderWorldCopies&&(s.x=o.bX(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(r,s){if(this.orientation=null,!this.position)return;const f=this.position,_=this._elevation?this._elevation.getAtPointOrZero(o.ac.fromLngLat(r)):0,x=o.ac.fromLngLat(r,_),S=[x.x-f.x,x.y-f.y,x.z-f.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=kp(S,s)}setPitchBearing(r,s){this.orientation=xs(o.al(r),o.al(-s))}}class ca{constructor(r,s){this._transform=o.bx([]),this.orientation=s,this.position=r}get mercatorPosition(){const r=this.position;return new o.ac(r[0],r[1],r[2])}get position(){const r=o.c1(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var s;r&&o.c7(this._transform,3,[(s=r)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.bY([]),r&&Dp(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,s){this._orientation=xs(r,s),Dp(this._transform,this._orientation)}forward(){const r=o.c1(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.c1(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.c1(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,s){const f=new Float64Array(16);return o.bi(f,this.getWorldToCamera(r,s)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,s,f){const _=this.position;o.b$(_,_,-r);const x=new Float64Array(16);return o.bn(x,[f,f,f]),o.bo(x,x,_),x[10]*=s,x}getWorldToCamera(r,s){const f=new Float64Array(16),_=new Float64Array(4),x=this.position;return o.c2(_,this._orientation),o.b$(x,x,-r),o.c3(f,_),o.bo(f,f,x),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=s,f[9]*=s,f[10]*=s,f[11]*=s,f}getCameraToClipPerspective(r,s,f,_){const x=new Float64Array(16);return o.c4(x,r,s,f,_),x}getCameraToClipOrthographic(r,s,f,_,x,S){const E=new Float64Array(16);return o.c5(E,r,s,f,_,x,S),E}getDistanceToElevation(r,s=!1){const f=r===0?0:o.c6(r,s?o.aY(this.position[1]):this.position[1]),_=this.forward();return(f-this.position[2])/_[2]}clone(){return new ca([...this.position],[...this.orientation])}}const va={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class bh{constructor(r=0,s=0,f=0,_=0){if(isNaN(r)||r<0||isNaN(s)||s<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=s,this.left=f,this.right=_}interpolate(r,s,f){return s.top!=null&&r.top!=null&&(this.top=o.ai(r.top,s.top,f)),s.bottom!=null&&r.bottom!=null&&(this.bottom=o.ai(r.bottom,s.bottom,f)),s.left!=null&&r.left!=null&&(this.left=o.ai(r.left,s.left,f)),s.right!=null&&r.right!=null&&(this.right=o.ai(r.right,s.right,f)),this}getCenter(r,s){const f=o.aD((this.left+r-this.right)/2,0,r),_=o.aD((this.top+s-this.bottom)/2,0,s);return new o.P(f,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new bh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ql=15;class Lc{constructor(r,s,f,_,x,S,E){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=r||0,this._maxZoom=s||22,this._minPitch=f??0,this._maxPitch=_??60,this.setProjection(S),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new o.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new bh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ca,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const r=new Lc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r._allowWorldUnderZoom=this._allowWorldUnderZoom,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Ql}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,s=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(r||f)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return o.aF(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=o.ce(this.projectionOptions);const f=this.getProjection(),_=!o.bv(s,f);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.ce({name:"mercator"});const s=r!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bX(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const s=-r*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=o.cf(),o.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const s=o.aD(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.al(r),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const s=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let _=0,x=0;for(let S=0;S<s.length;S++){const E=new o.P(s[S][0]*this.width,f+s[S][1]*(this.height-f)),C=r.pointCoordinate(E);if(!C)continue;const R=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);_+=C[3]*R,x+=R}return x===0?NaN:_/x}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*s,_=this._mercatorZfromZoom(r),x=this._mercatorZfromZoom(this._maxZoom),S=Math.max(_-f,x);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let f;f=r.z<this._camera.position[2]?[s.x,s.y,s.z]:[r.x,r.y,r.z];const _=o.ae(o.at([],this._camera.position,f));return o.aD(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let s=!1;if(r.orientation&&!o.ch(r.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(r.orientation)),r.position){const f=[r.position.x,r.position.y,r.position.z];o.ci(f,this._camera.position)||(this._setCameraPosition(f),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,s=new Jl;return s.position=new o.ac(r[0],r[1],r[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(r){if(!o.cj(r))return!1;o.ck(r,r);const s=o.cl([],[0,0,-1],r),f=o.cl([],[0,-1,0],r);if(f[2]<0)return!1;const _=kp(s,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(r){const s=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;r[2]=o.aD(r[2],_/f,_/s),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,s,f){this._unmodified=!1,this._edgeInsets.interpolate(r,s,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const s=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(r){const s=[new o.cm(0,r)];if(this.renderWorldCopies){const f=this.pointCoordinate(new o.P(0,0)),_=this.pointCoordinate(new o.P(this.width,0)),x=this.pointCoordinate(new o.P(this.width,this.height)),S=this.pointCoordinate(new o.P(0,this.height)),E=Math.floor(Math.min(f.x,_.x,x.x,S.x)),C=Math.floor(Math.max(f.x,_.x,x.x,S.x)),R=1;for(let F=E-R;F<=C+R;F++)F!==0&&s.push(new o.cm(F,r))}return s}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(r,s,f){let _=[];const x=f!=null,S=!x;if(S&&this.zoom<s||x&&f[0]===0&&f[1]===0)return _;const E=new Set,C=(F,j,B,G,J)=>{const Y=o.cK(j,F,B,G,J);E.has(Y)||(_.push(new o.aM(F,j,B,G,J)),E.add(Y))};for(let F=0;F<r.length;F++){const j=r[F];if(S&&j.canonical.z!==s)continue;const B=j.canonical,G=j.overscaledZ,J=j.wrap,Y=1<<B.z,te=B.x+1<Y,K=B.x>0,ce=B.y+1<Y,fe=B.y>0,pe=j.wrap-(K?0:1),Ee=j.wrap+(te?0:1),Te=K?B.x-1:Y-1,we=te?B.x+1:0;if(x)f[0]<0?(C(G,Ee,B.z,we,B.y),f[1]<0&&ce&&(C(G,J,B.z,B.x,B.y+1),C(G,Ee,B.z,we,B.y+1)),f[1]>0&&fe&&(C(G,J,B.z,B.x,B.y-1),C(G,Ee,B.z,we,B.y-1))):f[0]>0?(C(G,pe,B.z,Te,B.y),f[1]<0&&ce&&(C(G,J,B.z,B.x,B.y+1),C(G,pe,B.z,Te,B.y+1)),f[1]>0&&fe&&(C(G,J,B.z,B.x,B.y-1),C(G,pe,B.z,Te,B.y-1))):f[1]<0&&ce?C(G,J,B.z,B.x,B.y+1):fe&&C(G,J,B.z,B.x,B.y-1);else{const ye=j.visibleQuadrants;1&ye&&(C(G,pe,B.z,Te,B.y),fe&&(C(G,J,B.z,B.x,B.y-1),C(G,pe,B.z,Te,B.y-1))),2&ye&&(C(G,Ee,B.z,we,B.y),fe&&(C(G,J,B.z,B.x,B.y-1),C(G,Ee,B.z,we,B.y-1))),4&ye&&(C(G,pe,B.z,Te,B.y),ce&&(C(G,J,B.z,B.x,B.y+1),C(G,pe,B.z,Te,B.y+1))),8&ye&&(C(G,Ee,B.z,we,B.y),ce&&(C(G,J,B.z,B.x,B.y+1),C(G,Ee,B.z,we,B.y+1)))}}const R=[];for(const F of _)_.some(j=>F.isChildOf(j))||R.push(F);if(_=R.filter(F=>!r.some(j=>!!(F.overscaledZ<s&&j.isChildOf(F))||F.equals(j)||F.isChildOf(j))),S){const F=1<<s,j=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[F*j.x,F*j.y],G=4,J=G*G;_=_.filter(Y=>{const te=Y.canonical.x+.5-B[0],K=Y.canonical.y+.5-B[1];return te*te+K*K<J})}return _}coveringTiles(r){let s=this.coveringZoomLevel(r);const f=s,_=this.elevation&&this.elevation.exaggeration(),x=_&&!r.isTerrainDEM,S=this.projection.name==="mercator";if(r.minzoom!==void 0&&s<r.minzoom)return[];r.maxzoom!==void 0&&s>r.maxzoom&&(s=r.maxzoom);const E=this.locationCoordinate(this.center),C=this.center.lat,R=1<<s,F=[R*E.x,R*E.y,0],j=this.projection.name==="globe",B=!j,G=o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,B),J=j?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=R*o.c6(1,this.center.lat),te=this._camera.position[2]/o.c6(1,this.center.lat),K=[R*J.x,R*J.y,te*(B?1:Y)],ce=j||_,fe=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),pe=this.isLODDisabled(!0)?s:0;let Ee;if(this._elevation&&r.isTerrainDEM)Ee=1e4*this._elevation.exaggeration();else if(this._elevation){const Ue=this._elevation.getMinMaxForVisibleTiles();Ee=Ue?Ue.max:this._centerAltitude}else Ee=this._centerAltitude;const Te=r.isTerrainDEM?-Ee:this._elevation?this._elevation.getMinElevationBelowMSL():0,we=this.projection.isReprojectedInTileSpace?o.co(this):1,ye=Ue=>{const Ke=new o.ac(Ue.x+25e-6,Ue.y,Ue.z),gt=new o.ac(Ue.x,Ue.y+25e-6,Ue.z),dt=Ue.toLngLat(),vt=Ke.toLngLat(),bt=gt.toLngLat(),Yt=this.locationCoordinate(dt),tr=this.locationCoordinate(vt),Bt=this.locationCoordinate(bt),er=Math.hypot(tr.x-Yt.x,tr.y-Yt.y),Wt=Math.hypot(Bt.x-Yt.x,Bt.y-Yt.y);return Math.sqrt(er*Wt)*we/25e-6},Ie=Ue=>{const ft=Ee,Ke=Te;return{aabb:o.cr(this,R,0,0,0,Ue,Ke,ft,this.projection),zoom:0,x:0,y:0,minZ:Ke,maxZ:ft,wrap:Ue,fullyVisible:!1}},Oe=[];let Xe=[];const je=s,st=r.reparseOverscaled?f:s,ct=(te-this._centerAltitude)*Y,Et=Ue=>{if(!this._elevation||!Ue.tileID||!S)return;const ft=this._elevation.getMinMaxForTile(Ue.tileID),Ke=Ue.aabb;ft?(Ke.min[2]=ft.min,Ke.max[2]=ft.max,Ke.center[2]=(Ke.min[2]+Ke.max[2])/2):(Ue.shouldSplit=He(Ue),Ue.shouldSplit||(Ke.min[2]=Ke.max[2]=Ke.center[2]=this._centerAltitude))},Ve=(Ue,ft)=>{if(.707*ft<Ue)return 1;const Ke=ft/Ue;return Ke/(1.4144271570014144+(Math.pow(1.1,Ke-1.4144271570014144+1)-1)/(1.1-1)-1)},He=Ue=>{if(Ue.zoom<pe)return!0;if(Ue.zoom===je)return!1;if(Ue.shouldSplit!=null)return Ue.shouldSplit;const ft=Ue.aabb.distanceX(K),Ke=Ue.aabb.distanceY(K);let gt=ct,dt=1;if(j){gt=Ue.aabb.distanceZ(K);const Wt=Math.pow(2,Ue.zoom),hr=o.aY((Ue.y+1)/Wt),Or=o.aY(Ue.y/Wt),rn=Math.min(Math.max(C,hr),Or),Gn=o.cP(rn)/o.cP(C);if(dt=rn===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Gn/this._mercatorScaleRatio),this.zoom<=o.cL&&Ue.zoom===je-1&&Gn>=.9)return!0}else if(x&&(gt=Ue.aabb.distanceZ(K)*Y),this.projection.isReprojectedInTileSpace&&f<=5){const Wt=Math.pow(2,Ue.zoom),hr=ye(new o.ac((Ue.x+.5)/Wt,(Ue.y+.5)/Wt));dt=hr>.85?1:hr}if(!S){const Wt=Math.sqrt(ft*ft+Ke*Ke+gt*gt);let hr=(1<<je-Ue.zoom)*fe*dt;return hr*=Ve(Math.max(gt,ct),Wt),Wt<hr}let vt=Number.MAX_VALUE,bt=0;const Yt=Ue.aabb.getCorners(),tr=[];for(const Wt of Yt){o.at(tr,Wt,K),j||(x?tr[2]*=Y:tr[2]=ct);const hr=o.bE(tr,this._camera.forward());hr<vt&&(vt=hr,bt=Math.abs(tr[2]))}let Bt=(1<<je-Ue.zoom)*fe*dt;if(Bt*=Ve(Math.max(bt,ct),vt),vt<Bt)return!0;const er=Ue.aabb.closestPoint(F);return er[0]===F[0]&&er[1]===F[1]};if(this.renderWorldCopies)for(let Ue=1;Ue<=3;Ue++)Oe.push(Ie(-Ue)),Oe.push(Ie(Ue));for(Oe.push(Ie(0));Oe.length>0;){const Ue=Oe.pop(),ft=Ue.x,Ke=Ue.y;let gt=Ue.fullyVisible;const dt=()=>this.projection.name==="globe"&&(Ue.y===0||Ue.y===(1<<Ue.zoom)-1);if(!gt){let vt=ce?Ue.aabb.intersects(G):Ue.aabb.intersectsFlat(G);if(vt===0&&dt()){const bt=new o.cp(Ue.zoom,ft,Ke);vt=o.cq(this,R,bt,!0).intersects(G)}if(vt===0)continue;gt=vt===2}if(Ue.zoom!==je&&He(Ue))for(let vt=0;vt<4;vt++){const bt=(ft<<1)+vt%2,Yt=(Ke<<1)+(vt>>1),tr={aabb:S?Ue.aabb.quadrant(vt):o.cr(this,R,Ue.zoom+1,bt,Yt,Ue.wrap,Ue.minZ,Ue.maxZ,this.projection),zoom:Ue.zoom+1,x:bt,y:Yt,wrap:Ue.wrap,fullyVisible:gt,tileID:void 0,shouldSplit:void 0,minZ:Ue.minZ,maxZ:Ue.maxZ};x&&!j&&(tr.tileID=new o.aM(Ue.zoom+1===je?st:Ue.zoom+1,Ue.wrap,Ue.zoom+1,bt,Yt),Et(tr)),Oe.push(tr)}else{const vt=Ue.zoom===je?st:Ue.zoom;if(r.minzoom&&r.minzoom>vt)continue;let bt=0;if(!gt){let er=ce?Ue.aabb.intersectsPrecise(G):Ue.aabb.intersectsPreciseFlat(G);if(er===0&&dt()){const Wt=new o.cp(Ue.zoom,ft,Ke);er=o.cq(this,R,Wt,!0).intersectsPrecise(G)}if(er===0)continue;if(r.calculateQuadrantVisibility)if(G.containsPoint(Ue.aabb.center))bt=15;else for(let Wt=0;Wt<4;Wt++)Ue.aabb.quadrant(Wt).intersects(G)!==0&&(bt|=1<<Wt)}const Yt=F[0]-(.5+ft+(Ue.wrap<<Ue.zoom))*(1<<s-Ue.zoom),tr=F[1]-.5-Ke,Bt=Ue.tileID?Ue.tileID:new o.aM(vt,Ue.wrap,Ue.zoom,ft,Ke);r.calculateQuadrantVisibility&&(Bt.visibleQuadrants=bt),Xe.push({tileID:Bt,distanceSq:Yt*Yt+tr*tr})}}if(this.fogCullDistSq){const Ue=this.fogCullDistSq,ft=this.horizonLineFromTop();Xe=Xe.filter(Ke=>{const gt=[0,0,0,1],dt=[o.aj,o.aj,0,1],vt=this.calculateFogTileMatrix(Ke.tileID.toUnwrapped());o.aA(gt,gt,vt),o.aA(dt,dt,vt);const bt=o.cs([],gt,dt),Yt=o.ct([],gt,dt),tr=o.cM(bt,Yt);if(tr===0)return!0;let Bt=!1;const er=this._elevation;if(er&&tr>Ue&&ft!==0){const Wt=this.calculateProjMatrix(Ke.tileID.toUnwrapped());let hr;r.isTerrainDEM||(hr=er.getMinMaxForTile(Ke.tileID)),hr||(hr={min:Te,max:Ee});const Or=o.cu(this.rotation),rn=[Or[0]*o.aj,Or[1]*o.aj,hr.max];o.ad(rn,rn,Wt),Bt=(1-rn[1])*this.height*.5<ft}return tr<Ue||Bt})}return Xe.sort((Ue,ft)=>Ue.distanceSq-ft.distanceSq).map(Ue=>Ue.tileID)}resize(r,s){this.width=r,this.height=s,this.pixelsToGLUnits=[2/r,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const s=o.aD(r.lat,-o.cv,o.cv),f=this.projection.project(r.lng,s);return new o.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,s){let f,_;const x=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;f=(s.x-x.x)/E,_=(s.y-x.y)/E}else{const E=this.pointCoordinate(s),C=this.pointCoordinate(x);f=E.x-C.x,_=E.y-C.y}const S=this.locationCoordinate(r);this.setLocation(new o.ac(S.x-f,S.y-_))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r,s){return this.projection.locationPoint(this,r,s)}locationPoint3D(r,s){return this.projection.locationPoint(this,r,s,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r,s){return this.coordinateLocation(this.pointCoordinate3D(r,s))}locationCoordinate(r,s){const f=s?o.c6(s,r.lat):void 0,_=this.projection.project(r.lng,r.lat);return new o.ac(_.x,_.y,f)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,s){const f=s??this._centerAltitude,_=[r.x,r.y,0,1],x=[r.x,r.y,1,1];o.aA(_,_,this.pixelMatrixInverse),o.aA(x,x,this.pixelMatrixInverse);const S=x[3];o.cw(_,_,1/_[3]),o.cw(x,x,1/S);const E=_[2],C=x[2];return{p0:_,p1:x,t:E===C?0:(f-E)/(C-E)}}screenPointToMercatorRay(r){const s=[r.x,r.y,0,1],f=[r.x,r.y,1,1];return o.aA(s,s,this.pixelMatrixInverse),o.aA(f,f,this.pixelMatrixInverse),o.cw(s,s,1/s[3]),o.cw(f,f,1/f[3]),s[2]=o.c6(s[2],this._center.lat)*this.worldSize,f[2]=o.c6(f[2],this._center.lat)*this.worldSize,o.cw(s,s,1/this.worldSize),o.cw(f,f,1/this.worldSize),new o.av([s[0],s[1],s[2]],o.au([],o.at([],f,s)))}rayIntersectionCoordinate(r){const{p0:s,p1:f,t:_}=r,x=o.c6(s[2],this._center.lat),S=o.c6(f[2],this._center.lat);return new o.ac(o.ai(s[0],f[0],_)/this.worldSize,o.ai(s[1],f[1],_)/this.worldSize,o.ai(x,S,_))}pointCoordinate(r,s=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,s)}pointCoordinate3D(r,s){if(!this.elevation)return this.pointCoordinate(r,s);let f=this.projection.pointCoordinate3D(this,r.x,r.y);if(f)return new o.ac(f[0],f[1],f[2]);let _=0,x=this.horizonLineFromTop();if(r.y>x)return this.pointCoordinate(r,s);const S=.02*x,E=r.clone();for(let C=0;C<10&&x-_>S;C++){E.y=o.ai(_,x,.66);const R=this.projection.pointCoordinate3D(this,E.x,E.y);R?(x=E.y,f=R):_=E.y}return f?new o.ac(f[0],f[1],f[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=o.cx)return!this.isPointAboveHorizon(r);const s=this.pointCoordinate(r);return s.y>=0&&s.y<=1}_coordinatePoint(r,s){const f=s&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,_=[r.x*this.worldSize,r.y*this.worldSize,f+r.toAltitude(),1];return o.aA(_,_,this.pixelMatrix),_[3]>0?new o.P(_[0]/_[3],_[1]/_[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:s}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,x=this.pointLocation3D(new o.P(s,r)),S=this.pointLocation3D(new o.P(_,r)),E=this.pointLocation3D(new o.P(_,f)),C=this.pointLocation3D(new o.P(s,f));let R=Math.min(x.lng,S.lng,E.lng,C.lng),F=Math.max(x.lng,S.lng,E.lng,C.lng),j=Math.min(x.lat,S.lat,E.lat,C.lat),B=Math.max(x.lat,S.lat,E.lat,C.lat);const G=Math.pow(2,-this.zoom)/16*270,J=this.projection.name==="globe"?1:4,Y=(te,K,ce,fe,pe)=>{const Ee=(te+ce)/2,Te=(K+fe)/2,we=new o.P(Ee,Te),{lng:ye,lat:Ie}=this.pointLocation3D(we),Oe=Math.max(0,R-ye,j-Ie,ye-F,Ie-B);R=Math.min(R,ye),F=Math.max(F,ye),j=Math.min(j,Ie),B=Math.max(B,Ie),(pe<J||Oe>G)&&(Y(te,K,Ee,Te,pe+1),Y(Ee,Te,ce,fe,pe+1))};if(Y(s,r,_,r,1),Y(_,r,_,f,1),Y(_,f,s,f,1),Y(s,f,s,r,1),this.projection.name==="globe"){const[te,K]=o.cy(this);te?(B=90,F=180,R=-180):K&&(j=-90,F=180,R=-180)}return new o.aG(new o.cd(R,j),new o.cd(F,B))}_getBoundsRectangular(r,s){const{top:f,left:_}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,E=new o.P(_,f),C=new o.P(S,f),R=new o.P(S,x),F=new o.P(_,x);let j=this.pointCoordinate(E,r),B=this.pointCoordinate(C,r);const G=this.pointCoordinate(R,s),J=this.pointCoordinate(F,s),Y=(te,K)=>(K.y-te.y)/(K.x-te.x);return j.y>1&&B.y>=0?j=new o.ac((1-J.y)/Y(J,j)+J.x,1):j.y<0&&B.y<=1&&(j=new o.ac(-J.y/Y(J,j)+J.x,0)),B.y>1&&j.y>=0?B=new o.ac((1-G.y)/Y(G,B)+G.x,1):B.y<0&&j.y<=1&&(B=new o.ac(-G.y/Y(G,B)+G.x,0)),new o.aG().extend(this.coordinateLocation(j)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(G))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=r.visibleDemTiles.reduce((f,_)=>{if(_.dem){const x=_.dem.tree;f.min=Math.min(f.min,x.minimums[0]),f.max=Math.max(f.max,x.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*r.exaggeration(),s.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-s*(1-this._horizonShift);return r?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.cv,this.maxLat=o.cv,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.ay(this.minLng)*this.tileSize,this.worldMaxX=o.ay(this.maxLng)*this.tileSize,this.worldMinY=o.aH(this.maxLat)*this.tileSize,this.worldMaxY=o.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,s){return this.projection.createTileMatrix(this,s,r)}calculateDistanceTileData(r){const s=r.key,f=this._distanceTileDataCache;if(f[s])return f[s];const _=r.canonical,x=1/this.height,S=this.cameraWorldSize,E=S/this.zoomScale(_.z),C=(_.x+Math.pow(2,_.z)*r.wrap)*E,R=_.y*E,F=this.point;F.x*=S/this.worldSize,F.y*=S/this.worldSize;const j=this.angle,B=Math.sin(-j),G=-Math.cos(-j);return f[s]={bearing:[B,G],center:[(F.x-C)*x,(F.y-R)*x],scale:E/o.aj*x},f[s]}calculateFogTileMatrix(r){const s=r.key,f=this._fogTileMatrixCache;if(f[s])return f[s];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.az(_,this.worldToFogMatrix,_),f[s]=new Float32Array(_),f[s]}calculateProjMatrix(r,s=!1,f=!1){const _=r.key;let x;if(x=f?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,x[_])return x[_];const S=this.calculatePosMatrix(r,this.worldSize);let E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,o.az(S,E,S),x[_]=new Float32Array(S),x[_]}calculatePixelsToTileUnitsMatrix(r){const s=r.tileID.key,f=this._pixelsToTileUnitsCache;if(f[s])return f[s];const _=o.cz(r,this);return f[s]=_,f[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,s=o.bn([],[r,r,r]);return o.az(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const s=o.c6(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(s),_=this._camera.forward(),x=o.c6(1,this._center.lat);f[2]/=x,_[2]/=x,o.au(_,_);const S=r.raycast(f,_,r.exaggeration());if(S){const E=o.bF([],f,_,S),C=new o.ac(E[0],E[1],o.c6(E[2],o.aY(E[1]))),R=(C.z+o.ae([C.x-f[0],C.y-f[1],C.z-f[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const s=this._elevation,f=o.c6(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),x=s.getAtPointOrZero(new o.ac(..._)),S=this.pixelsPerMeter/this.worldSize*x,E=this._minimumHeightOverTerrain(),C=_[2]-S;if(C<=E)if(C<0||r){const R=this.locationCoordinate(this._center,this._centerAltitude),F=[_[0],_[1],R.z-_[2]],j=o.ae(F);F[2]-=(E-C)/this._pixelsPerMercatorPixel;const B=o.ae(F);if(B===0)return;o.b$(F,F,j/B*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],R.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const B=this.center;return B.lat=o.aD(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(B.lng=o.aD(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const s=this._unmodified,{x:f,y:_}=this.point;let x=0,S=f,E=_;const C=this.width/2,R=this.height/2,F=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(_-R<F&&(E=F+R),_+R>j&&(E=j-R),j-F<this.height&&(x=Math.max(x,this.height/(j-F)),E=(j+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,J=this.worldSize/2-(B+G)/2;S=(f+J+this.worldSize)%this.worldSize-J,S-C<B&&(S=B+C),S+C>G&&(S=G-C),G-B<this.width&&(x=Math.max(x,this.width/(G-B)),S=(G+B)/2)}S===f&&E===_||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(S,E))),x&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,s=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.c6(1,this.center.lat)/o.c6(1,o.cN));const _=o.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?f:1,S=this._camera.getWorldToCamera(this.worldSize,x);let E;const C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-r.x/this.width,C[9]=2*r.y/this.height,this.isOrthographic){let Ie=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Oe=Ie*this.aspect,Xe=-Oe,je=-Ie;Oe-=r.x,Xe-=r.x,Ie+=r.y,je+=r.y,E=this._camera.getCameraToClipOrthographic(Xe,Oe,je,Ie,this._nearZ,this._farZ),((st,ct,Et,Ve)=>{for(let He=0;He<16;He++)st[He]=o.ai(ct[He],Et[He],Ve)})(E,E,C,o.cO(this.pitch>=Ql?1:this.pitch/Ql))}else E=C;const R=o.cB([],C,S);let F=o.cB([],E,S);if(this.projection.isReprojectedInTileSpace){const Ie=this.locationCoordinate(this.center),Oe=o.bx([]);o.bo(Oe,Oe,[Ie.x*this.worldSize,Ie.y*this.worldSize,0]),o.az(Oe,Oe,o.cC(this)),o.bo(Oe,Oe,[-Ie.x*this.worldSize,-Ie.y*this.worldSize,0]),o.az(F,F,Oe),o.az(R,R,Oe),this.inverseAdjustmentMatrix=o.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cE([],F,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=F,this.invProjMatrix=o.bi(new Float64Array(16),this.projMatrix),s){const Ie=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ie[8]=2*-r.x/this.width,Ie[9]=2*r.y/this.height,this.expandedFarZProjMatrix=o.cB([],Ie,S)}else this.expandedFarZProjMatrix=this.projMatrix;const j=o.bi([],E);this.frustumCorners=o.cF.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const B=new Float32Array(16);o.bx(B),o.cE(B,B,[1,-1,1]),o.cG(B,B,this._pitch),o.by(B,B,this.angle);const G=o.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bw(G);const J=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;G[8]=2*-r.x/this.width,G[9]=2*(r.y+J)/this.height,this.skyboxMatrix=o.az(B,G,B);const Y=this.point,te=Y.x,K=Y.y,ce=this.width%2/2,fe=this.height%2/2,pe=Math.cos(this.angle),Ee=Math.sin(this.angle),Te=te-Math.round(te)+pe*ce+Ee*fe,we=K-Math.round(K)+pe*fe+Ee*ce,ye=new Float64Array(F);if(o.bo(ye,ye,[Te>.5?Te-1:Te,we>.5?we-1:we,0]),this.alignedProjMatrix=ye,F=o.bz(),o.cE(F,F,[this.width/2,-this.height/2,1]),o.bo(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=o.bz(),o.cE(F,F,[1,-1,1]),o.bo(F,F,[-1,-1,0]),o.cE(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=o.az(new Float64Array(16),this.labelPlaneMatrix,R),this._calcFogMatrices(),this._distanceTileDataCache={},F=o.bi(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cH(this);const Ie=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.ad(Ie,Ie,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,x=[r,r,s];o.b$(x,x,_),o.b$(f,f,-1),o.cI(f,f,x);const S=o.bz();o.bo(S,S,f),o.cE(S,S,x),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,s,_)}_computeCameraPosition(r){const s=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-r/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*x,_.y/this.worldSize-f[1]*x,r/this.worldSize*this._centerAltitude-f[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],_=r[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(x=Math.min((s-f)/_,1)),this._camera.position=o.bF([],this._camera.position,r,x),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,s=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),x=o.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.al(this._maxPitch)),E=Math.max((r[2]-x)/Math.cos(f),S),C=this._zoomFromMercatorZ(E);o.bF(r,r,s,E),this._pitch=o.aD(f,o.al(this.minPitch),o.al(this.maxPitch)),this.angle=o.bX(_,-Math.PI,Math.PI),this._setZoom(o.aD(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ac(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let s=0,f=o.cx,_=0,x=1/0;for(;f-s>1e-6&&f>s;){const S=s+.5*(f-s),E=this.tileSize*Math.pow(2,S),C=this.getCameraToCenterDistance(this.projection,S,E),R=this.scaleZoom(C/(r*this.tileSize)),F=Math.abs(S-R);F<x&&(x=F,_=S),S<R?s=S:f=S}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,s){const f=Math.min(r.x,s.x),_=Math.max(r.x,s.x),x=Math.min(r.y,s.y),S=Math.max(r.y,s.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new o.P(f,x),new o.P(_,S),new o.P(f,S),new o.P(_,x)],C=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const F of E){const j=this.pointRayIntersection(F);if(j.t<0)return!0;const B=this.rayIntersectionCoordinate(j);if(B.x<C||B.y<0||B.x>R||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(r,s){const f=o.ae(o.at([],this._camera.position,r)),_=this._zoomFromMercatorZ(f)+s;return f-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([s,f,_],x){const S=[s,f,_,1];o.aA(S,S,x);const E=S[3]=Math.max(S[3],1e-6);return S[0]/=E,S[1]/=E,S[2]/=E,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,r))}}getCameraToCenterDistance(r,s=this.zoom,f=this.worldSize){const _=o.cA(r,s,this.width,this.height,1024),x=r.pixelSpaceConversion(this.center.lat,f,_);let S=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(S=o.ai(1,S,o.cO(this.pitch>=Ql?1:this.pitch/Ql))),S}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.az(r,r,this.globeMatrix),r}getFrustum(r){return o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}const Gs=(d,r)=>{if(r>0&&d.terrain&&o.w("Cutoff is currently disabled on terrain"),r<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=d.transform,f=Math.max(Math.abs(s._zoom-(d.minCutoffZoom-1)),1),_=s.isLODDisabled(!1)?o.af(60,45,s.pitch):o.af(30,15,s.pitch),x=s._farZ-s._nearZ,S=r*s.height,E=((1-(C=_))*s.cameraToCenterDistance+C*(s._farZ+S))*f;var C;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(E-s._nearZ)/x,(E-S-s._nearZ)/x]}}},Lo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class vd{constructor(r,s){this.aabb=r,this.lastCascade=s}}class zc{add(r,s){const f=this.receivers[r.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],s.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],s.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],s.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],s.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],s.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],s.max[2])):this.receivers[r.key]=new vd(s,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,s,f){const _=o.cV.fromPoints(r.points);let x=0;for(const S in this.receivers){const E=this.receivers[S];if(!E||!_.intersectsAabb(E.aabb))continue;E.aabb.min=_.closestPoint(E.aabb.min),E.aabb.max=_.closestPoint(E.aabb.max);const C=E.aabb.getCorners();for(let R=0;R<f.length;R++){let F=!0;for(const j of C){const B=[j[0]*s,j[1]*s,j[2]];if(o.ad(B,B,f[R].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){F=!1;break}}if(E.lastCascade=R,x=Math.max(x,R),F)break}}return x+1}}class Jg{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new zc,this._depthMode=new Jt(r.context.gl.LEQUAL,Jt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(Lo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(Lo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),r.tp.registerParameter(Lo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,s){const f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const _=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||_<=0||(this._shadowLayerCount=f.style.order.reduce((J,Y)=>{const te=f.style._mergedLayers[Y];return J+(te.hasShadowPass()&&!te.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const x=f.context,S=Lo.shadowMapResolution,E=Lo.shadowMapResolution;if(this._cascades.length===0||Lo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let J=0;J<Lo.cascadeCount;++J){const Y=f._shadowMapDebug,te=x.gl,K=x.createFramebuffer(S,E,Y,"texture"),ce=new o.T(x,{width:S,height:E,data:null},te.DEPTH_COMPONENT16);if(K.depthAttachment.set(ce.texture),Y){const fe=new o.T(x,{width:S,height:E,data:null},te.RGBA8);K.colorAttachment.set(fe.texture)}this._cascades.push({framebuffer:K,texture:ce,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cn,scale:0})}}this.shadowDirection=xd(s);let C=0;if(r.elevation){const J=r.elevation,Y=[1e4,-1e4];J.visibleDemTiles.filter(te=>te.dem).forEach(te=>{const K=te.dem.tree;Y[0]=Math.min(Y[0],K.minimums[0]),Y[1]=Math.max(Y[1],K.maximums[0])}),Y[0]!==1e4&&(C=(Y[1]-Y[0])*J.exaggeration())}const R=1.5*r.cameraToCenterDistance,F=3*R,j=new Float64Array(16);for(let J=0;J<this._cascades.length;++J){const Y=this._cascades[J];let te=r.height/50,K=1;Lo.cascadeCount===1?K=F:J===0?K=R:(te=R,K=F);const[ce,fe]=Tf(r,this.shadowDirection,te,K,Lo.shadowMapResolution,C);Y.scale=r.scale,Y.matrix=ce,Y.boundingSphereRadius=fe,o.bi(j,Y.matrix),Y.frustum=o.cn.fromInvProjectionMatrix(j,1,0,!0),Y.far=K}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Lo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Lo.shadowMapResolution,this._uniformValues.u_shadowmap_0=va.ShadowMap0,this._uniformValues.u_shadowmap_1=va.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const G=f.transform.elevation;for(const J of this._groundShadowTiles){let Y={min:0,max:0};if(G){const te=G.getMinMaxForTile(J);te&&(Y=te)}this.addShadowReceiver(J.toUnwrapped(),Y.min,Y.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,s){if(!this.enabled)return;const f=this.painter,_=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),_.viewport.set([0,0,Lo.shadowMapResolution,Lo.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){f.currentShadowCascade=x,_.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),_.clear({color:o.am.white,depth:1});for(const S of r.order){const E=r._mergedLayers[S];if(!E.hasShadowPass()||E.isHidden(f.transform.zoom))continue;const C=r.getLayerSourceCache(E),R=C?s[C.id]:void 0;(E.type==="model"||R&&R.length)&&f.renderLayer(f,C,E,R)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const r=this.painter,s=r.style,f=r.context,_=s.directionalLight,x=s.ambientLight;if(!_||!x)return;const S=[],E=Gs(r,r.longestCutoffRange);E.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),S.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&S.push("NORMAL_OFFSET");const C=bs(s,_,x),R=new Jt(f.gl.LEQUAL,Jt.ReadOnly,r.depthRangeFor3D);for(const F of this._groundShadowTiles){const j=F.toUnwrapped(),B=r.isTileAffectedByFog(F),G=r.getOrCreateProgram("groundShadow",{defines:S,overrideFog:B});this.setupShadows(j,G),r.uploadCommonUniforms(f,G,j,null,E);const J={u_matrix:r.transform.calculateProjMatrix(j),u_ground_shadow_factor:C};G.draw(r,f.gl.TRIANGLES,R,Tr.disabled,Yr.multiply,Pr.disabled,J,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,null,r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Yr.unblended:Yr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const s=this.painter.transform,f=s.calculatePosMatrix(r,s.worldSize);return o.az(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(r){return o.az(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,s,f,_=0){if(!this.enabled)return;const x=this.painter.transform,S=this.painter.context,E=S.gl,C=this._uniformValues,R=new Float64Array(16),F=x.calculatePosMatrix(r,x.worldSize);for(let j=0;j<this._cascades.length;j++)o.az(R,this._cascades[j].matrix,F),C[j===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),S.activeTexture.set(E.TEXTURE0+va.ShadowMap0+j),this._cascades[j].texture.bind(E.NEAREST,E.CLAMP_TO_EDGE);if(this.useNormalOffset=!!f,this.useNormalOffset){const j=o.cT(r.canonical),B=2/x.tileSize*o.aj/Lo.shadowMapResolution,G=B*this._cascades[0].boundingSphereRadius,J=B*this._cascades[this._cascades.length-1].boundingSphereRadius,Y=(f==="vector-tile"?1:3)/Math.pow(2,_-r.canonical.z-(1-x.zoom+Math.floor(x.zoom)));C.u_shadow_normal_offset=[j,G*Y,J*Y],C.u_shadow_bias=[6e-5,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(S,C)}setupShadowsFromMatrix(r,s,f=!1){if(!this.enabled)return;const _=this.painter.context,x=_.gl,S=this._uniformValues,E=new Float64Array(16);for(let C=0;C<Lo.cascadeCount;C++)o.az(E,this._cascades[C].matrix,r),S[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),_.activeTexture.set(x.TEXTURE0+va.ShadowMap0+C),this._cascades[C].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);if(this.useNormalOffset=f,f){const C=Lo.normalOffset;S.u_shadow_normal_offset=[1,C,C],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(_,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,s,f,_){if(_[2]>=0)return{};const x=function(C,R,F){const j=F/(1<<C.canonical.z);return new o.cV([C.canonical.x*j+C.wrap*F,C.canonical.y*j+C.wrap*F,0],[(C.canonical.x+1)*j+C.wrap*F,(C.canonical.y+1)*j+C.wrap*F,R])}(r,s,f).getCorners(),S=s/-_[2];_[0]<0?(o.cU(x[0],x[0],[_[0]*S,0,0]),o.cU(x[3],x[3],[_[0]*S,0,0])):_[0]>0&&(o.cU(x[1],x[1],[_[0]*S,0,0]),o.cU(x[2],x[2],[_[0]*S,0,0])),_[1]<0?(o.cU(x[0],x[0],[0,_[1]*S,0]),o.cU(x[1],x[1],[0,_[1]*S,0])):_[1]>0&&(o.cU(x[2],x[2],[0,_[1]*S,0]),o.cU(x[3],x[3],[0,_[1]*S,0]));const E={};return E.vertices=x,E.planes=[_l(x[1],x[0],x[4]),_l(x[2],x[1],x[5]),_l(x[3],x[2],x[6]),_l(x[0],x[3],x[7])],E}addShadowReceiver(r,s,f){this._receivers.add(r,o.cV.fromTileIdAndHeight(r,s,f))}getMaxCascadeForTile(r){const s=this._receivers.get(r);return s&&s.lastCascade?s.lastCascade:0}}function _l(d,r,s){const f=o.at([],s,r),_=o.at([],d,r),x=o.bG([],f,_),S=o.ae(x);return S===0?[0,0,1,0]:(o.b$(x,x,1/S),[x[0],x[1],x[2],-o.bE(x,r)])}function xd(d){const r=d.properties.get("direction"),s=o.cR(r.x,r.y,r.z);s[2]=o.aD(s[2],0,75);const f=o.cW([s[0],s[1],s[2]]);return o.cS(f.x,f.y,f.z)}function bs(d,r,s){const f=r.properties.get("color-use-theme")==="none",_=r.properties.get("color"),x=r.properties.get("intensity"),S=r.properties.get("direction"),E=[S.x,S.y,S.z],C=s.properties.get("color-use-theme")==="none",R=s.properties.get("color"),F=s.properties.get("intensity"),j=Math.max(o.bE([0,0,1],E),0),B=[0,0,0];o.b$(B,R.toRenderColor(C?null:d.getLut(r.scope)).toArray01Linear().slice(0,3),F);const G=[0,0,0];return o.b$(G,_.toRenderColor(f?null:d.getLut(s.scope)).toArray01Linear().slice(0,3),j*x),o.cX([B[0]>0?B[0]/(B[0]+G[0]):0,B[1]>0?B[1]/(B[1]+G[1]):0,B[2]>0?B[2]/(B[2]+G[2]):0])}function Tf(d,r,s,f,_,x){const S=d.zoom,E=d.scale,C=d.worldSize,R=1/C,F=d.aspect,j=Math.sqrt(1+F*F)*Math.tan(.5*d.fovX),B=j*j,G=f-s,J=f+s;let Y,te;B>G/J?(Y=f,te=f*j):(Y=.5*J*(1+B),te=.5*Math.sqrt(G*G+2*(f*f+s*s)*B+J*J*B*B));const K=d.projection.pixelsPerMeter(d.center.lat,C),ce=d._camera.getCameraToWorldMercator(),fe=[0,0,-Y*R];o.ad(fe,fe,ce);let pe=te*R;const Ee=d._edgeInsets;if(!(Ee.left===0&&Ee.top===0&&Ee.right===0&&Ee.bottom===0||Ee.left===Ee.right&&Ee.top===Ee.bottom)){const gt=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?K:1),dt=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,s,f);dt[8]=2*-d.centerOffset.x/d.width,dt[9]=2*d.centerOffset.y/d.height;const vt=new Float64Array(16);o.cB(vt,dt,gt);const bt=new Float64Array(16);o.bi(bt,vt);const Yt=o.cn.fromInvProjectionMatrix(bt,C,S,!0);for(const tr of Yt.points){const Bt=((Te=tr)[0]/=E,Te[1]/=E,Te[2]=o.c6(Te[2],d._center.lat),Te);pe=Math.max(pe,o.c0(o.cY([],fe,Bt)))}}var Te;pe*=_/(_-1);const we=Math.acos(r[2]),ye=Math.atan2(-r[0],-r[1]),Ie=new ca;Ie.position=fe,Ie.setPitchBearing(we,ye);const Oe=Ie.getWorldToCamera(C,K),Xe=pe*C,je=Math.min(d._mercatorZfromZoom(17)*C*-2,-2*Xe),st=Ie.getCameraToClipOrthographic(-Xe,Xe,-Xe,Xe,je,(Xe+x*K)/r[2]),ct=new Float64Array(16);o.az(ct,st,Oe);const Et=o.cS(Math.floor(1e6*fe[0])/1e6*C,Math.floor(1e6*fe[1])/1e6*C,0),Ve=.5*_,He=[0,0,0];o.ad(He,Et,ct),o.b$(He,He,Ve);const Ue=[Math.floor(He[0]),Math.floor(He[1]),Math.floor(He[2])],ft=[0,0,0];o.at(ft,He,Ue),o.b$(ft,ft,-1/Ve);const Ke=new Float64Array(16);return o.bx(Ke),o.bo(Ke,Ke,ft),o.az(ct,Ke,ct),[ct,Xe]}class ec extends o.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(r,s){return o.aS(this.requestManager.transformRequest(s,o.R.Model).url).then(f=>{if(!f)return;const _=o.aT(f),x=new o.aU(r,void 0,void 0,_);return x.computeBoundsAndApplyParent(),x}).catch(f=>{if(f&&f.status===404)return null;this.fire(new o.z(new Error(`Could not load model ${r} from ${s}: ${f.message}`)))})}load(r,s,f={forceReload:!1}){this.models[s]||(this.models[s]={});const _=Object.keys(r),x=[],S=[];for(const E of _){const C=r[E];this.hasURLBeenRequested(C)&&!f.forceReload||(this.modelByURL[C]={modelId:E,scope:s},x.push(this.loadModel(E,C)),S.push(E)),this.models[s][E]||(this.models[s][E]={model:null,numReferences:1})}this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+S.length,Promise.allSettled(x).then(E=>{for(let C=0;C<E.length;C++){const{status:R}=E[C];if(R==="rejected")continue;const{value:F}=E[C];this.models[s][S[C]]||(this.models[s][S[C]]={model:null,numReferences:1}),this.models[s][S[C]].model=F}this.numModelsLoading[s]-=S.length,this.fire(new o.A("data",{dataType:"style"}))}).catch(E=>{this.fire(new o.z(new Error(`Could not load models: ${E.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,s,f={exactIdMatch:!1}){return!!(f.exactIdMatch?this.getModel(r,s):this.getModelByURL(this.modelUris[s][r]))}getModel(r,s){return this.models[s]||(this.models[s]={}),this.models[s][r]?this.models[s][r].model:void 0}getModelByURL(r){if(!r)return null;const s=this.modelByURL[r];return s?this.models[s.scope][s.modelId].model:null}hasModelBeenAdded(r,s){return this.models[s]&&this.models[s][r]!==void 0}getModelURIs(r){return this.modelUris[r]||{}}addModel(r,s,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const _=this.requestManager.normalizeModelURL(s);if((this.hasModel(r,f,{exactIdMatch:!0})||this.hasModelBeenAdded(r,f))&&this.modelUris[f][r]===_)this.models[f][r].numReferences++;else if(this.hasURLBeenRequested(_)){const{scope:x,modelId:S}=this.modelByURL[_];this.models[x][S].numReferences++}else this.modelUris[f][r]=_,this.load({[r]:this.modelUris[f][r]},f)}addModelURLs(r,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const f=this.modelUris[s];for(const _ in r)f[_]=this.requestManager.normalizeModelURL(r[_])}reloadModels(r){this.load(this.modelUris[r],r,{forceReload:!0})}addModelsFromBucket(r,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const f={};for(const _ of r)this.hasModel(_,s,{exactIdMatch:!0})||this.hasURLBeenRequested(_)?this.models[s][_].numReferences++:this.modelUris[s][_]&&!this.hasURLBeenRequested(_)?f[_]=this.modelUris[s][_]:!this.hasURLBeenRequested(_)&&o.cZ(_,!1)&&(this.modelUris[s][_]=this.requestManager.normalizeModelURL(_),f[_]=this.modelUris[s][_]);this.load(f,s)}hasURLBeenRequested(r){return this.modelByURL[r]!==void 0}removeModel(r,s,f=!1){if(this.models[s]&&this.models[s][r]&&(this.models[s][r].numReferences--,this.models[s][r].numReferences===0)){const _=this.modelUris[s][r];f||delete this.modelUris[s][r],delete this.modelByURL[_];const x=this.models[s][r].model;if(!x)return;delete this.models[s][r],x.destroy()}}destroy(){for(const r of Object.keys(this.models))for(const s of Object.keys(this.models[r])){const f=this.models[r][s].model;delete this.models[r][s],f&&f.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,s){this.models[s]||(this.models[s]={});for(const f in this.models[s])this.models[s][f].model&&this.models[s][f].model.upload(r.context)}}const Zm=new o.a7({data:new o.a8(o.a5.colorTheme.data)}),Qg={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Xm(d){return d=d||{},Object.assign(d,Qg)}class Ym extends o.E{constructor(r){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},o.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=r,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(r=>{r.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new o.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=r.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=r.stylesheet.indoor.buildingFeaturesetId,this._scope=r.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:r=>(r.feature&&r.feature.properties.floorplan&&this.selectFloorplan(r.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(r){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(S,E){const[C,R]=S,{center:F,radius:j}=E,[B,G]=F,J=Math.abs(C-B);return Math.sqrt((J>180?360-J:J)**2+(R-G)**2)<=j}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new o.A("floorplangone")));const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},f=new o.P(this._map.transform.width/2,this._map.transform.height/2),_=[new o.P(0,0),new o.P(this._map.transform.width,this._map.transform.height)],x=this._map.queryRenderedFeatures(r?_:f,s);x.length>0&&(this._selectedFloorplan&&x[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=x[0],this._floorplanSelected(!1)))}_floorplanSelected(r){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(x){const[[S,E],[C,R]]=x,F=(C-S+360)%360,j=F>180?360-F:F;return{center:[(S+j/2+360)%360,(E+R)/2],radius:Math.sqrt(j**2+(R-E)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const s=this._floorplanStates[this._indoorData.id].selectedBuilding,f=this._floorplanStates[this._indoorData.id].selectedLevel;let _;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const x of this._indoorData.levels)x.id===this._selectedLevel.id&&(_=x.id);if(this.fire(new o.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:_})),s){const x=this._indoorData.buildings.find(S=>S.id===s);this._buildingSelected(x,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(f){const x=this._indoorData.levels.find(S=>S.id===f);this._updateLevels(x,r)}else r&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(r,s){s&&r&&r.extent&&this._map.fitBounds(r.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=r?r.id:void 0;const f=this._indoorData.levels.filter(_=>r.levels.includes(_.id));this.fire(new o.A("buildingselected",{buildingId:r.id,levels:f}))}_levelSelected(r){if(r==="overview")this._updateLevels(void 0,!0);else{const s=this._indoorData.levels.find(f=>f.id===r);this._updateLevels(s,!0)}this.fire(new o.A("levelselected",{levelId:r==="overview"?void 0:r}))}_updateLevels(r,s){if(!r)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(s&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function f(R){const F=R.indexOf("/floor/");if(F===-1)return R;const j=F+7,B=R.indexOf("/",j);return B===-1?R.slice(j):R.slice(j,B)}this._selectedLevel=r,this._floorplanStates[this._indoorData.id].selectedLevel=r?r.id:void 0;const _=[],x={},S={},E={},C={};for(const R of this._indoorData.levels)if(_.push(R.id),x[R.id]=R.height,S[R.id]=R.base,r){if(this.mergeFloors){const F=f(r.id),j=f(R.id);E[R.id]=j===F?"true":"false"}else E[R.id]=R.id===r.id?"true":"false";C[R.id]=R.base<r.base?"true":"false"}else C[R.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",_]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",E]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",C]),r&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!r.isUnderground),s&&r.extent)){const R=this._map.cameraForBounds(r.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),F=this._map.getZoom(),j=R.zoom?Math.abs(F-R.zoom):0;this._map.fitBounds(r.extent,j>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:F})}}selectFloorplan(r){const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},f=[new o.P(0,0),new o.P(this._map.transform.width,this._map.transform.height)],_=this._map.queryRenderedFeatures(f,s);if(_.length>0){for(const x of _)if(JSON.parse(x.properties["indoor-data"]).floorplanIDs.includes(r)){this._selectedFloorplan=x,this._floorplanSelected(!0);break}}}selectBuilding(r){const s=this._indoorData.buildings.find(f=>f.id===r);this._buildingSelected(s,!0)}selectLevel(r){this._levelSelected(r)}}function e_(d){if(!d.metadata||!d.metadata.content_area)return;const r=o.q.devicePixelRatio,{left:s,top:f,width:_,height:x}=d.metadata.content_area,S=s*r,E=f*r;return[S,E,S+_*r,E+x*r]}function Ef(d){if(d)return d.map(([r,s])=>[r*o.q.devicePixelRatio,s*o.q.devicePixelRatio])}class ws{constructor(r,s,f){this.id=r,this.scope=s,this.sourceCache=f,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(r){this.missingRequests.has(r.name)||this.pendingRequests.has(r.name)||this.pendingRequests.add(r.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const r=new Map;if(!this.sourceCache.loaded())return r;const s=this.sourceCache.getVisibleCoordinates();if(s.length===0)return r;const f=this.sourceCache.getSource();if(!(f instanceof _u))return r;const _=s.map(S=>this.sourceCache.getTile(S)),x=f.getImages(_,Array.from(this.pendingRequests));for(const[S,E]of x)r.set(o.I.from({name:S,iconsetId:this.id}),E),this.pendingRequests.delete(S);for(const S of this.pendingRequests)this.missingRequests.add(S);return this.pendingRequests.clear(),r}}const Ss=(d,r)=>Fe(d,r&&r.filter(s=>s.identifier!=="source.canvas")),Rp=o.aF(Mn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Lp=o.aF(Mn,["setCenter","setZoom","setBearing","setPitch"]),yl=new Set(["background","sky","slot","custom"]),wh={version:8,layers:[],sources:{}},bd={duration:300,delay:0};class Ts extends o.E{constructor(r,s={}){super(),this.map=r,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=o.l({},bd),this._buildingIndex=new hh(this),this.crossTileSymbolIndex=new bo,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new We,this.dispatcher=s.dispatcher?s.dispatcher:new o.D(o.d0(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new jr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new o.d1(r._requestManager,s.localFontFamily?o.d2.all:s.localIdeographFontFamily?o.d2.ideographs:o.d2.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new ec(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:s.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",o.d3());const f=this;this._rtlTextPluginCallback=Ts.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,S)=>{if(o.d4(x),S&&S.every(E=>E))for(const E in f._sourceCaches){const C=f._sourceCaches[E],R=C.getSource().type;R!=="vector"&&R!=="geojson"||C.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const x=this.getOwnSource(_.sourceId);if(x&&x.vectorLayerIds)for(const S in this._layers){const E=this._layers[S];E.source===x.id&&this._validateLayer(E)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(o.f(r))return r;const s=o.d5(r);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${o.d6(JSON.stringify(r))}`}_diffStyle(r,s,f){this.globalId=this._getGlobalId(r);const _=(x,S)=>{try{S(null,this.setState(x,f))}catch(E){S(E,!1)}};if(typeof r=="string"){const x=this.map._requestManager.normalizeStyleURL(r),S=this.map._requestManager.transformRequest(x,o.R.Style);o.n(S,(E,C)=>{E?this.fire(new o.z(E)):C&&_(C,s)})}else typeof r=="object"&&_(r,s)}loadURL(r,s={}){this.fire(new o.A("dataloading",{dataType:"style"}));const f=typeof s.validate=="boolean"?s.validate:!o.f(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,s.accessToken),this.resolvedImports.add(r);const _=this.importsCache.get(r);if(_)return this._load(_,f);const x=this.map._requestManager.transformRequest(r,o.R.Style);this._request=o.n(x,(S,E)=>{if(this._request=null,S)this.fire(new o.z(S));else if(E)return this.importsCache.set(r,E),this._load(E,f)})}loadJSON(r,s={}){this.fire(new o.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=o.q.frame(()=>{this._request=null,this._load(r,s.validate!==!1)})}loadEmpty(){this.fire(new o.A("dataloading",{dataType:"style"})),this._load(wh,!1)}_loadImports(r,s,f){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const x of r){const S=this._createFragmentStyle(x),E=new Promise(F=>{S.once("style.import.load",F),S.once("error",F)}).then(()=>this.mergeAll());if(_.push(E),this.resolvedImports.has(x.url)){S.loadEmpty();continue}const C=x.data||this.importsCache.get(x.url);C?(S.loadJSON(C,{validate:s}),this._isInternalStyle(C)&&(S.globalId=null)):x.url?S.loadURL(x.url,{validate:s}):S.loadEmpty();const R={style:S,id:x.id,config:x.config};if(f){const F=this.fragments.findIndex(({id:j})=>j===f);this.fragments=this.fragments.slice(0,F).concat(R).concat(this.fragments.slice(F))}else this.fragments.push(R)}return Promise.allSettled(_)}getImportGlobalIds(r=this,s=new Set){for(const f of r.fragments)f.style.globalId&&s.add(f.style.globalId),this.getImportGlobalIds(f.style,s);return[...s.values()]}_createFragmentStyle(r){const s=this.scope?o.C(r.id,this.scope):r.id;let f;const _=this._initialConfig&&this._initialConfig[s];(r.config||_)&&(f=o.l({},r.config,_));const x=new Ts(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,colorThemeOverride:r["color-theme"],configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,s){const f=r.indoor?Xm(r.schema):r.schema;if(this._isInternalStyle(r)){const S=o.l({},wh,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(S,s)}if(this.updateConfig(this._config,f),s&&Ss(this,An(r)))return;this._loaded=!0,this.stylesheet=o.d7(r);const _=()=>{for(const R in r.sources)this.addSource(R,r.sources[R],{validate:!1,isInitialLoad:!0});if(r.iconsets)for(const R in r.iconsets)this.addIconset(R,r.iconsets[R]);r.sprite?this._loadIconset(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(r.glyphs);const S=$s(this.stylesheet.layers);if(this._order=S.map(R=>R.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const R=this.stylesheet.lights[0];this.light=new Ye(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ye(this.stylesheet.light)),this._layers={};for(const R of S){const F=o.dc(R,this.scope,this._styleColorTheme.lut,this.options);F.configDependencies.size!==0&&this._configDependentLayers.add(F.fqid),F.setEventedParent(this,{layer:{id:F.id}}),this._layers[F.id]=F;const j=this.getOwnLayerSourceCache(F),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();j&&F.canCastShadows()&&B&&(j.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const E=this.stylesheet.terrain;E&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(E,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.A("data",{dataType:"style"}));const C=this.isRootStyle();r.imports?this._loadImports(r.imports,s).then(()=>{this._reloadImports(),this.fire(new o.A(C?"style.load":"style.import.load"))}).catch(R=>{this.fire(new o.z(new Error("Failed to load imports",R))),this.fire(new o.A(C?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.A(C?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const S=this._evaluateColorThemeData(x);this._loadColorTheme(S).then(()=>{_()}).catch(E=>{o.w(`Couldn't load color theme from the stylesheet: ${E}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}mergeAll(){let r,s,f,_,x,S,E,C,R,F;const j={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(r=B.light),B.stylesheet.lights)for(const G of B.stylesheet.lights)G.type==="ambient"&&B.ambientLight!=null&&(s=B.ambientLight),G.type==="directional"&&B.directionalLight!=null&&(f=B.directionalLight);_=this._prioritizeTerrain(_,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(x=B.fog),B.stylesheet.snow&&B.snow!=null&&(S=B.snow),B.stylesheet.rain&&B.rain!=null&&(E=B.rain),B.stylesheet.camera!=null&&(F=B.stylesheet.camera),B.stylesheet.projection!=null&&(C=B.stylesheet.projection),B.stylesheet.transition!=null&&(R=B.stylesheet.transition),j[B.scope]=B._styleColorTheme}}),this.light=r,this.ambientLight=s,this.directionalLight=f,this.fog=x,this.snow=S,this.rain=E,this._styleColorThemeForScope=j,_===null?delete this.terrain:this.terrain=_,this.camera=F||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=o.l({},bd,R),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){const s=f=>{for(const _ of f.fragments)s(_.style);r(f)};s(this)}_prioritizeTerrain(r,s,f){const _=r&&r.drapeRenderMode===0;return f===null?s&&s.drapeRenderMode===0?s:_?r:null:s!=null&&(!r||_||s&&s.drapeRenderMode===1)?s:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{r=this._prioritizeTerrain(r,s.terrain,s.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(r=s.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},s={},f={};this.forEachFragmentStyle(_=>{for(const x in _._sourceCaches){const S=o.C(x,_.scope);r[S]=_._sourceCaches[x]}for(const x in _._otherSourceCaches){const S=o.C(x,_.scope);s[S]=_._otherSourceCaches[x]}for(const x in _._symbolSourceCaches){const S=o.C(x,_.scope);f[S]=_._symbolSourceCaches[x]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=f}mergeLayers(){const r={},s=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(const S of x._order){const E=x._layers[S];if(E.type==="slot"){const C=o.d8(S);if(r[C])continue;r[C]=[]}E.slot&&r[E.slot]?r[E.slot].push(E):s.push(E)}}),this._mergedOrder=[];const _=(x=[])=>{for(const S of x)if(S.type==="slot"){const E=o.d8(S.id);r[E]&&_(r[E]),this._mergedSlots.push(E)}else{const E=o.C(S.id,S.scope);this._mergedOrder.push(E),f[E]=S,S.is3D(!!this.terrain)&&(this._has3DLayers=!0),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};_(s),this._mergedOrder.sort((x,S)=>{const E=f[x],C=f[S];return E.hasInitialOcclusionOpacityProperties?C.is3D(!!this.terrain)?1:0:E.is3D(!!this.terrain)&&C.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=o.l({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(s,f,_){const x=o.l({},f);for(const E of Object.keys(o.a5.colorTheme))x[E]===void 0&&(x[E]=o.a5.colorTheme[E].default);const S=new o.a6(Zm,s,new Map(_));return S.setTransitionOrValue(x,_),S.untransitioned().possiblyEvaluate(new o.aa(0))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,_)=>{const x="data:image/png;base64,";if(!r||r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let S=r;S.startsWith(x)||(S=x+S);const E=o.I.from("mapbox-reserved-lut"),C=new Image;C.src=S,C.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},C.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void f();this._styleColorTheme.lutLoading=!1;const{width:R,height:F,data:j}=o.q.getImageData(C);if(F>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(R!==F*F)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(E)&&this.removeImage(E),this.addImage(E,{data:new o.r({width:R,height:F},j),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(E,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:r},f()):_(new Error("Missing LUT image."))}})}getLut(r){const s=this._styleColorThemeForScope[r];return s?s.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(s,f,_){let x,S,E;const C=o.q.devicePixelRatio>1?"@2x":"";let R=o.n(f.transformRequest(f.normalizeSpriteURL(s,C,".json"),o.R.SpriteJSON),(B,G)=>{R=null,E||(E=B,x=G,j())}),F=o.o(f.transformRequest(f.normalizeSpriteURL(s,C,".png"),o.R.SpriteImage),(B,G)=>{F=null,E||(E=B,S=G,j())});function j(){if(E)_(E);else if(x&&S){const B=o.q.getImageData(S),G={};for(const J in x){const{width:Y,height:te,x:K,y:ce,sdf:fe,pixelRatio:pe,stretchX:Ee,stretchY:Te,content:we}=x[J],ye=new o.r({width:Y,height:te});o.r.copy(B,ye,{x:K,y:ce},{x:0,y:0},{width:Y,height:te},null),G[J]={data:ye,pixelRatio:pe,sdf:fe,stretchX:Ee,stretchY:Te,content:we,usvg:!1}}_(null,G)}}return{cancel(){R&&(R.cancel(),R=null),F&&(F.cancel(),F=null)}}}(r,this.map._requestManager,(s,f)=>{if(this._spriteRequest=null,s)this.fire(new o.z(s));else if(f){const _=new Map;for(const x in f)_.set(o.I.from(x),f[x]);this.addImages(_)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))})}addIconset(r,s){if(s.type==="sprite")return void this._loadSprite(s.url);const f=this.getOwnSourceCache(s.source);if(!f)return void this.fire(new o.z(new Error(`Source "${s.source}" as specified by iconset "${r}" does not exist and cannot be used as an iconset source`)));const _=f.getSource();if(_.type!=="raster-array")return void this.fire(new o.z(new Error(`Source "${s.source}" as specified by iconset "${r}" is not a "raster-array" source and cannot be used as an iconset source`)));_.partial=!1;const x=new ws(r,this.scope,f);this.imageManager.addImageProvider(x,this.scope)}removeIconset(r){this.imageManager.removeImageProvider(r,this.scope)}_loadIconset(r){if(!o.f(r)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(r);const s=this.map._spriteFormat==="auto";var f,_;this._spriteRequest=(_=(x,S)=>{if(this._spriteRequest=null,x)s?this._loadSprite(r):this.fire(new o.z(x));else if(S){const E=new Map;for(const C in S)E.set(o.I.from(C),S[C]);this.addImages(E)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))},o.br((f=this.map._requestManager).transformRequest(f.normalizeIconsetURL(r),o.R.Iconset),(x,S)=>{if(x)return void _(x);const E={},C=o.c_(new o.bq(S));for(const R of C.icons){const F={version:1,pixelRatio:o.q.devicePixelRatio,content:e_(R),stretchX:R.metadata?Ef(R.metadata.stretch_x_areas):void 0,stretchY:R.metadata?Ef(R.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:R};E[R.name]=F}_(null,E)}))}_validateLayer(r){const s=this.getOwnSource(r.source);if(!s)return;const f=r.sourceLayer;f&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(f)===-1)&&this.fire(new o.z(new Error(`Source layer "${f}" does not exist on source "${s.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,s)=>{const f=this.fragments[s];return f&&f.style&&(r.data=f.style.serialize()),r})}_serializeSources(){const r={};for(const s in this._sourceCaches){const f=this._sourceCaches[s].getSource();r[f.id]||(r[f.id]=f.serialize())}return r}_serializeLayers(r){const s=[];for(const f of r){const _=this._layers[f];_&&_.type!=="custom"&&s.push(_.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(r){return r?this.order:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const s=this.getOwnLayer(r);if(s)return s;this.fire(new o.z(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const s=this.getOwnSource(r);if(s)return s;this.fire(new o.z(new Error(`The source '${r}' does not exist in the map's style.`)))}precompilePrograms(r,s){const f=this.map.painter;if(f)for(let _=r.minzoom||0;_<(r.maxzoom||25.5);_++){const x=r.getProgramIds();if(x)for(const S of x){const E=r.getDefaultProgramParams(S,s.zoom,this._styleColorTheme.lut);E&&(f.style=this,this.fog&&(f._fogVisible=!0,E.overrideFog=!0,f.getOrCreateProgram(S,E)),f._fogVisible=!1,E.overrideFog=!1,f.getOrCreateProgram(S,E),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(E.overrideRtt=!0,f.getOrCreateProgram(S,E)))}}}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const s=this.calculateLightsBrightness();r.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s));const f=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const E=this._changes.getLayerUpdatesByScope();for(const C in E){const{updatedIds:R,removedIds:F}=E[C];(R||F)&&(this._updateWorkerLayers(C,R,F),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this.snow&&this.snow.updateTransitions(r),this.rain&&this.rain.updateTransitions(r),this._changes.reset()}const x={};for(const E in this._mergedSourceCaches){const C=this._mergedSourceCaches[E];x[E]=C.used,C.used=!1,C.tileCoverLift=0}for(const E of this._mergedOrder){const C=this._mergedLayers[E];if(C.recalculate(r,this._availableImages),!C.isHidden(r.zoom)){const R=this.getLayerSourceCache(C);R&&(R.used=!0,R.tileCoverLift=Math.max(R.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(C,r)}):this.precompilePrograms(C,r))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();const S=this.imageManager.getPendingImageProviders();for(const E of S)E.sourceCache.used=!0;for(const E in x){const C=this._mergedSourceCaches[E];x[E]!==C.used&&C.getSource().fire(new o.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.snow&&this.snow.recalculate(r),this.rain&&this.rain.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),f&&this.fire(new o.A("data",{dataType:"style"}))}updateImageProviders(){const r=this.imageManager.getPendingImageProviders();for(const s of r){const f=s.resolvePendingRequests(),_=this.getFragmentStyle(s.scope);_&&_.addImages(f)}}_updateTilesForChangedImages(){const r={};for(const s in this._mergedSourceCaches){const f=this._mergedSourceCaches[s].getSource().scope;r[f]=r[f]||this._changes.getUpdatedImages(f),r[f].length!==0&&this._mergedSourceCaches[s].reloadTilesForDependencies(["icons","patterns"],r[f])}for(const s in r)this._changes.resetUpdatedImages(s)}_updateWorkerLayers(r,s,f){const _=this.getFragmentStyle(r);_&&this.dispatcher.broadcast("updateLayers",{layers:s?_._serializeLayers(s):[],scope:r,removedIds:f||[],options:_.options})}setState(r,s){if(this._checkLoaded(),Ss(this,An(r)))return!1;(r=o.d7(r)).layers=$s(r.layers);const f=function(S,E){if(!S)return[{command:Mn.setStyle,args:[E]}];let C=[];try{if(!o.bv(S.version,E.version))return[{command:Mn.setStyle,args:[E]}];if(o.bv(S.center,E.center)||C.push({command:Mn.setCenter,args:[E.center]}),o.bv(S.zoom,E.zoom)||C.push({command:Mn.setZoom,args:[E.zoom]}),o.bv(S.bearing,E.bearing)||C.push({command:Mn.setBearing,args:[E.bearing]}),o.bv(S.pitch,E.pitch)||C.push({command:Mn.setPitch,args:[E.pitch]}),o.bv(S.sprite,E.sprite)||C.push({command:Mn.setSprite,args:[E.sprite]}),o.bv(S.glyphs,E.glyphs)||C.push({command:Mn.setGlyphs,args:[E.glyphs]}),o.bv(S.imports,E.imports)||function(G=[],J=[],Y){J=J||[];const te=(G=G||[]).map(Yl),K=J.map(Yl),ce=G.reduce(dh,{}),fe=J.reduce(dh,{}),pe=te.slice();let Ee,Te,we,ye;for(Ee=0,Te=0;Ee<te.length;Ee++)we=te[Ee],fe.hasOwnProperty(we)?Te++:(Y.push({command:Mn.removeImport,args:[we]}),pe.splice(pe.indexOf(we,Te),1));for(Ee=0,Te=0;Ee<K.length;Ee++)we=K[K.length-1-Ee],pe[pe.length-1-Ee]!==we&&(ce.hasOwnProperty(we)?(Y.push({command:Mn.removeImport,args:[we]}),pe.splice(pe.lastIndexOf(we,pe.length-Te),1)):Te++,ye=pe[pe.length-Ee],Y.push({command:Mn.addImport,args:[fe[we],ye]}),pe.splice(pe.length-Ee,0,we));for(const Ie of J){const Oe=ce[Ie.id];Oe&&!o.bv(Oe,Ie)&&Y.push({command:Mn.updateImport,args:[Ie.id,Ie]})}}(S.imports,E.imports,C),o.bv(S.transition,E.transition)||C.push({command:Mn.setTransition,args:[E.transition]}),o.bv(S.light,E.light)||C.push({command:Mn.setLight,args:[E.light]}),o.bv(S.fog,E.fog)||C.push({command:Mn.setFog,args:[E.fog]}),o.bv(S.snow,E.snow)||C.push({command:Mn.setSnow,args:[E.snow]}),o.bv(S.rain,E.rain)||C.push({command:Mn.setRain,args:[E.rain]}),o.bv(S.projection,E.projection)||C.push({command:Mn.setProjection,args:[E.projection]}),o.bv(S.lights,E.lights)||C.push({command:Mn.setLights,args:[E.lights]}),o.bv(S.camera,E.camera)||C.push({command:Mn.setCamera,args:[E.camera]}),o.bv(S.iconsets,E.iconsets)||function(G,J,Y){let te;for(te in J=J||{},G=G||{})G.hasOwnProperty(te)&&(J.hasOwnProperty(te)||Y.push({command:Mn.removeIconset,args:[te]}));for(te in J){if(!J.hasOwnProperty(te))continue;const K=J[te];G.hasOwnProperty(te)?o.bv(G[te],K)||(Y.push({command:Mn.removeIconset,args:[te]}),Y.push({command:Mn.addIconset,args:[te,K]})):Y.push({command:Mn.addIconset,args:[te,K]})}}(S.iconsets,E.iconsets,C),!o.bv(S["color-theme"],E["color-theme"]))return[{command:Mn.setStyle,args:[E]}];const R={},F=[];(function(G,J,Y,te){let K;for(K in J=J||{},G=G||{})G.hasOwnProperty(K)&&(J.hasOwnProperty(K)||hl(K,Y,te));for(K in J){if(!J.hasOwnProperty(K))continue;const ce=J[K];G.hasOwnProperty(K)?o.bv(G[K],ce)||(G[K].type==="geojson"&&ce.type==="geojson"&&Mp(G,J,K)?Y.push({command:Mn.setGeoJSONSourceData,args:[K,ce.data]}):Yg(K,J,Y,te)):xu(K,J,Y)}})(S.sources,E.sources,F,R);const j=[];S.layers&&S.layers.forEach(G=>{G.source&&R[G.source]?C.push({command:Mn.removeLayer,args:[G.id]}):j.push(G)});let B=S.terrain;B&&R[B.source]&&(C.push({command:Mn.setTerrain,args:[void 0]}),B=void 0),C=C.concat(F),o.bv(B,E.terrain)||C.push({command:Mn.setTerrain,args:[E.terrain]}),function(G,J,Y){J=J||[];const te=(G=G||[]).map(Yl),K=J.map(Yl),ce=G.reduce(dh,{}),fe=J.reduce(dh,{}),pe=te.slice(),Ee=Object.create(null);let Te,we,ye,Ie,Oe,Xe,je;for(Te=0,we=0;Te<te.length;Te++)ye=te[Te],fe.hasOwnProperty(ye)?we++:(Y.push({command:Mn.removeLayer,args:[ye]}),pe.splice(pe.indexOf(ye,we),1));for(Te=0,we=0;Te<K.length;Te++)ye=K[K.length-1-Te],pe[pe.length-1-Te]!==ye&&(ce.hasOwnProperty(ye)?(Y.push({command:Mn.removeLayer,args:[ye]}),pe.splice(pe.lastIndexOf(ye,pe.length-we),1)):we++,Xe=pe[pe.length-Te],Y.push({command:Mn.addLayer,args:[fe[ye],Xe]}),pe.splice(pe.length-Te,0,ye),Ee[ye]=!0);for(Te=0;Te<K.length;Te++)if(ye=K[Te],Ie=ce[ye],Oe=fe[ye],!Ee[ye]&&!o.bv(Ie,Oe))if(o.bv(Ie.source,Oe.source)&&o.bv(Ie["source-layer"],Oe["source-layer"])&&o.bv(Ie.type,Oe.type)){for(je in dl(Ie.layout,Oe.layout,Y,ye,null,Mn.setLayoutProperty),dl(Ie.paint,Oe.paint,Y,ye,null,Mn.setPaintProperty),o.bv(Ie.slot,Oe.slot)||Y.push({command:Mn.setSlot,args:[ye,Oe.slot]}),o.bv(Ie.filter,Oe.filter)||Y.push({command:Mn.setFilter,args:[ye,Oe.filter]}),o.bv(Ie.minzoom,Oe.minzoom)&&o.bv(Ie.maxzoom,Oe.maxzoom)||Y.push({command:Mn.setLayerZoomRange,args:[ye,Oe.minzoom,Oe.maxzoom]}),Ie)Ie.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&je!=="slot"&&(je.indexOf("paint.")===0?dl(Ie[je],Oe[je],Y,ye,je.slice(6),Mn.setPaintProperty):o.bv(Ie[je],Oe[je])||Y.push({command:Mn.setLayerProperty,args:[ye,je,Oe[je]]}));for(je in Oe)Oe.hasOwnProperty(je)&&!Ie.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&je!=="slot"&&(je.indexOf("paint.")===0?dl(Ie[je],Oe[je],Y,ye,je.slice(6),Mn.setPaintProperty):o.bv(Ie[je],Oe[je])||Y.push({command:Mn.setLayerProperty,args:[ye,je,Oe[je]]}))}else Y.push({command:Mn.removeLayer,args:[ye]}),Xe=pe[pe.lastIndexOf(ye)+1],Y.push({command:Mn.addLayer,args:[Oe,Xe]})}(j,E.layers,C)}catch(R){console.warn("Unable to compute style diff:",R),C=[{command:Mn.setStyle,args:[E]}]}return C}(this.serialize(),r).filter(S=>!(S.command in Lp));if(f.length===0)return!1;const _=f.filter(S=>!(S.command in Rp));if(_.length>0)throw new Error(`Unimplemented: ${_.map(S=>S.command).join(", ")}.`);const x=[];return f.forEach(S=>{x.push(this[S.command](...S.args))}),s&&Promise.all(x).then(s).catch(s),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(r){for(const[s,f]of r.entries()){if(this.getImage(s))return this.fire(new o.z(new Error(`An image with the name "${s.name}" already exists.`)));this.imageManager.addImage(s,this.scope,f),this._changes.updateImage(s,this.scope)}return this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this}addImage(r,s){return this.getImage(r)?this.fire(new o.z(new Error(`An image with the name "${r.name}" already exists.`))):(this.imageManager.addImage(r,this.scope,s),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this)}updateImage(r,s,f=!1){this.imageManager.updateImage(r,this.scope,s),f&&(this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})))}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(r){return this.modelManager.addModelURLs(r,this.scope),this._updateWorkerModels(),this.fire(new o.A("data",{dataType:"style"})),this}addModel(r,s,f={}){return this._checkLoaded(),this._validate(Pe,`models.${r}`,s,null,f)||(this.modelManager.addModel(r,s,this.scope),this.fire(new o.A("data",{dataType:"style"}))),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,s,f={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(Nn,`sources.${r}`,s,null,f))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const _=Hl(r,s,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const x=S=>{const E=(S?"symbol:":"other:")+_.id,C=o.C(E,this.scope),R=this._sourceCaches[E]=new Zo(C,_,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=R,R.onAdd(this.map)};x(!1),s.type!=="vector"&&s.type!=="geojson"||x(!0),_.onAdd&&_.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const s=this.getOwnSource(r);if(!s)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===r)return this.fire(new o.z(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new o.z(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const _=Object.entries(this.stylesheet.iconsets).find(([x,S])=>S.type==="source"&&S.source===r);if(_)return this.fire(new o.z(new Error(`Source "${r}" cannot be removed while iconset "${_[0]}" is using it.`)))}const f=this.getOwnSourceCaches(r);for(const _ of f){const x=o.d8(_.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(_.id),_.fire(new o.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,s){this._checkLoaded(),this.getOwnSource(r).setData(s),this._changes.setDirty()}getOwnSource(r){const s=this.getOwnSourceCache(r);return s&&s.getSource()}getOwnSources(){const r=[];for(const s in this._otherSourceCaches){const f=this.getOwnSourceCache(s);f&&r.push(f.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const s in r){const f=r[s]._tiles;for(const _ in f){const x=f[_];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const _ of r){if(this._validate(ki,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const x=this.ambientLight;x.set(_),x.updateTransitions(s)}else this.ambientLight=new ji(_,Jn||(Jn=new o.a7({color:new o.a8(o.a5.properties_light_ambient.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const x=this.directionalLight;x.set(_),x.updateTransitions(s)}else this.directionalLight=new ji(_,Rn||(Rn=new o.a7({direction:new o.an(o.a5.properties_light_directional.direction),color:new o.a8(o.a5.properties_light_directional.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_directional.intensity),"cast-shadows":new o.a8(o.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new o.a8(o.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.a8(o.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const f=new o.aa(this.z||0,s);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,s=this.ambientLight;if(!r||!s)return;const f=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),_=r.properties.get("color").toRenderColor(null).toArray01(),x=r.properties.get("intensity"),S=r.properties.get("direction"),E=1-o.cR(S.x,S.y,S.z)[2]/90,C=f(_)*x*E,R=s.properties.get("color").toRenderColor(null).toArray01(),F=s.properties.get("intensity"),j=f(R)*F;return Number(((C+j)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(r==null||r===""&&this.isRootStyle())return this;if(o.d9(r)){const s=o.da(r),f=this.fragments.find(({id:x})=>x===s);if(!f)return;const _=o.d8(r);return f.style.getFragmentStyle(_)}{const s=this.fragments.find(({id:f})=>f===r);return s?s.style:void 0}}setFeaturesetSelectors(r){if(!r)return;const s={},f=(_,x="")=>`${_}::${x}`;this._featuresetSelectors={};for(const _ in r){const x=this._featuresetSelectors[_]=[];for(const S of r[_].selectors){if(S.featureNamespace){const C=this.getOwnLayer(S.layer);if(!C){o.w(`Layer is undefined for selector: ${S.layer}`);continue}const R=f(C.source,C.sourceLayer);if(R in s&&s[R]!==S.featureNamespace){o.w(`"featureNamespace ${S.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}s[R]=S.featureNamespace}let E;if(S.properties)for(const C in S.properties){const R=o.X(S.properties[C]);R.result==="success"&&(E=E||{},E[C]=R.value)}x.push({layerId:S.layer,namespace:S.featureNamespace,properties:E,uniqueFeatureID:S._uniqueFeatureID})}}}getFeaturesetDescriptors(r){const s=this.getFragmentStyle(r);if(!s||!s.stylesheet.featuresets)return[];const f=[];for(const _ in s.stylesheet.featuresets)f.push({featuresetId:_,importId:s.scope?s.scope:void 0});return f}getFeaturesetLayers(r,s){const f=this.getFragmentStyle(s),_=f.stylesheet.featuresets;if(!_||!_[r])return this.fire(new o.z(new Error(`The featureset '${r}' does not exist in the map's style and cannot be queried.`))),[];const x=[];for(const S of _[r].selectors){const E=f.getOwnLayer(S.layer);E&&x.push(E)}return x}getConfigProperty(r,s){const f=this.getFragmentStyle(r);if(!f)return null;const _=o.C(s,f.scope),x=f.options.get(_),S=x?x.value||x.default:null;return S?S.serialize():null}setConfigProperty(r,s,f){const _=this.getFragmentStyle(r);if(!_)return;const x=_.stylesheet.indoor?Xm(_.stylesheet.schema):_.stylesheet.schema;if(!x||!x[s])return;const S=o.X(f);if(S.result!=="success")return void Ss(this,S.value);const E=S.value.expression,C=o.C(s,_.scope),R=_.options.get(C);if(!R)return;let F;const{minValue:j,maxValue:B,stepValue:G,type:J,values:Y}=x[s],te=o.X(x[s].default);te.result==="success"&&(F=te.value.expression),F?(this.options.set(C,Object.assign({},R,{value:E,default:F,minValue:j,maxValue:B,stepValue:G,type:J,values:Y})),this.updateConfigDependencies(s)):this.fire(new o.z(new Error(`No schema defined for the config option "${s}" in the "${r}" fragment.`)))}getConfig(r){const s=this.getFragmentStyle(r);if(!s)return null;const f=s.stylesheet.schema;if(!f)return null;const _={};for(const x in f){const S=o.C(x,s.scope),E=s.options.get(S),C=E?E.value||E.default:null;_[x]=C?C.serialize():null}return _}setConfig(r,s){const f=this.getFragmentStyle(r);f&&(f.updateConfig(s,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){const s=this.getFragmentStyle(r);return s?s.stylesheet.schema:null}setSchema(r,s){const f=this.getFragmentStyle(r);f&&(f.stylesheet.schema=s,f.updateConfig(f._config,s),this.updateConfigDependencies())}updateConfig(r,s){if(this._config=r,r||s)if(s)for(const f in s){let _,x;const S=o.X(s[f].default);if(S.result==="success"&&(_=S.value.expression),r&&r[f]!==void 0){const B=o.X(r[f]);B.result==="success"&&(x=B.value.expression)}const{minValue:E,maxValue:C,stepValue:R,type:F,values:j}=s[f];if(_){const B=o.C(f,this.scope);this.options.set(B,{default:_,value:x,minValue:E,maxValue:C,stepValue:R,type:F,values:j})}else this.fire(new o.z(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new o.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(r){for(const s of this._configDependentLayers){const f=this.getLayer(s);if(f){if(r&&!f.configDependencies.has(r))continue;f.possiblyEvaluateVisibility(),this._updateLayer(f)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(s=>{const f=s._styleColorTheme.colorThemeOverride?s._styleColorTheme.colorThemeOverride:s._styleColorTheme.colorTheme;if(f){const _=s._evaluateColorThemeData(f);(!s._styleColorTheme.lut&&_!==""||s._styleColorTheme.lut&&_!==s._styleColorTheme.lut.data)&&s.setColorTheme(f)}}),this._changes.setDirty()}addLayer(r,s,f={}){this._checkLoaded();const _=r.id;if(this._layers[_])return void this.fire(new o.z(new Error(`Layer with id "${_}" already exists on this map`)));let x;if(r.type==="custom"){if(Ss(this,o.db(r)))return;x=o.dc(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(_,r.source),r=o.d7(r),r=o.l(r,{source:_})),this._validate(Q,`layers.${_}`,r,{arrayIndex:-1},f))return;x=o.dc(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}})}x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid);let S=this._order.length;if(s){const F=this._order.indexOf(s);if(F===-1)return void this.fire(new o.z(new Error(`Layer with id "${s}" does not exist on this map.`)));x.slot===this._layers[s].slot?S=F:o.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,_),this._layerOrderChanged=!0,this._layers[_]=x;const E=this.getOwnLayerSourceCache(x),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&x.canCastShadows()&&C&&(E.castsShadows=!0);const R=this._changes.getRemovedLayer(x);if(R&&x.source&&E&&x.type!=="custom"){this._changes.discardLayerRemoval(x);const F=o.C(x.source,x.scope);R.type!==x.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),E.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(r,s){this._checkLoaded();const f=this._checkLayer(r);if(!f||r===s)return;const _=this._order.indexOf(r);this._order.splice(_,1);let x=this._order.length;if(s){const S=this._order.indexOf(s);if(S===-1)return void this.fire(new o.z(new Error(`Layer with id "${s}" does not exist on this map.`)));f.slot===this._layers[s].slot?x=S:o.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const s=this._checkLayer(r);if(!s)return;s.setEventedParent(null);const f=this._order.indexOf(r);this._order.splice(f,1),delete this._layers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const _=this.getOwnLayerSourceCache(s);if(_&&_.castsShadows){let x=!1;for(const S in this._layers)if(this._layers[S].source===s.source&&this._layers[S].canCastShadows()){x=!0;break}_.castsShadows=x}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const s in this._layers)if(this._layers[s].type===r)return!0;return!1}setLayerZoomRange(r,s,f){this._checkLoaded();const _=this._checkLayer(r);_&&(_.minzoom===s&&_.maxzoom===f||(s!=null&&(_.minzoom=s),f!=null&&(_.maxzoom=f),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,s){this._checkLoaded();const f=this._checkLayer(r);f&&f.slot!==s&&(f.slot=s,this._updateLayer(f))}setFilter(r,s,f={}){this._checkLoaded();const _=this._checkLayer(r);if(_&&!o.bv(_.filter,s))return s==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(ae,`layers.${_.id}.filter`,s,{layerType:_.type},f)||(_.filter=o.d7(s),this._updateLayer(_)))}getFilter(r){const s=this._checkLayer(r);if(s)return o.d7(s.filter)}setLayoutProperty(r,s,f,_={}){this._checkLoaded();const x=this._checkLayer(r);if(x&&!o.bv(x.getLayoutProperty(s),f)){if(f!=null&&(!_||_.validate!==!1)&&Ss(x,De.call(An,{key:`layers.${r}.layout.${s}`,layerType:x.type,objectKey:s,value:f,styleSpec:o.a5,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(s,f),x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(r,s){const f=this._checkLayer(r);if(f)return f.getLayoutProperty(s)}setPaintProperty(r,s,f,_={}){this._checkLoaded();const x=this._checkLayer(r);if(!x||o.bv(x.getPaintProperty(s),f)||f!=null&&(!_||_.validate!==!1)&&Ss(x,Se.call(An,{key:`layers.${r}.paint.${s}`,layerType:x.type,objectKey:s,value:f,styleSpec:o.a5})))return;const S=x.setPaintProperty(s,f);x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),S&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(r,s){const f=this._checkLayer(r);if(f)return f.getPaintProperty(s)}setFeatureState(r,s){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:C,importId:R}=r.target,F=this.getFragmentStyle(R),j=F.getFeaturesetLayers(C);for(const{source:B,sourceLayer:G}of j)F.setFeatureState({id:r.id,source:B,sourceLayer:G},s)}else if("layerId"in r.target){const{layerId:C}=r.target,R=this.getLayer(C);this.setFeatureState({id:r.id,source:R.source,sourceLayer:R.sourceLayer},s)}return}const f=r.source,_=r.sourceLayer,x=this._checkSource(f);if(!x)return;const S=x.type;if(S==="geojson"&&_)return void this.fire(new o.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!_)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided.")));const E=this.getOwnSourceCaches(f);for(const C of E)C.setFeatureState(_,r.id,s)}removeFeatureState(r,s){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:C,importId:R}=r.target,F=this.getFragmentStyle(R),j=F.getFeaturesetLayers(C);for(const{source:B,sourceLayer:G}of j)F.removeFeatureState({id:r.id,source:B,sourceLayer:G},s)}else if("layerId"in r.target){const{layerId:C}=r.target,R=this.getLayer(C);this.removeFeatureState({id:r.id,source:R.source,sourceLayer:R.sourceLayer},s)}return}const f=r.source,_=this._checkSource(f);if(!_)return;const x=_.type,S=x==="vector"?r.sourceLayer:void 0;if(x==="vector"&&!S)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.z(new Error("A feature id is required to remove its specific state property.")));const E=this.getOwnSourceCaches(f);for(const C of E)C.removeFeatureState(S,r.id,s)}getFeatureState(r){if(this._checkLoaded(),"target"in r){let x;if("featuresetId"in r.target){const{featuresetId:S,importId:E}=r.target,C=this.getFragmentStyle(E),R=C.getFeaturesetLayers(S);for(const{source:F,sourceLayer:j}of R){const B=C.getFeatureState({id:r.id,source:F,sourceLayer:j});if(B&&!x)x=B;else if(!o.bv(x,B))return void this.fire(new o.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in r.target){const{layerId:S}=r.target,E=this.getLayer(S);x=this.getFeatureState({id:r.id,source:E.source,sourceLayer:E.sourceLayer})}return x}const s=r.source,f=r.sourceLayer,_=this._checkSource(s);if(_){if(_.type!=="vector"||f)return r.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(f,r.id);this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=o.l({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return o.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),s=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return o.dd({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateFilteredLayers(r){for(const s of Object.values(this._mergedLayers))r(s)&&this._updateLayer(s)}_updateLayer(r){this._changes.updateLayer(r);const s=this.getLayerSourceCache(r),f=o.C(r.source,r.scope),_=this._changes.getUpdatedSourceCaches();r.source&&!_[f]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),s.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const s=E=>this._mergedLayers[E].is3D(!!this.terrain),f=this.order,_={},x=[];for(let E=f.length-1;E>=0;E--){const C=f[E];if(s(C)){_[C]=E;for(const R of r){const F=R[C];if(F)for(const j of F)x.push(j)}}}x.sort((E,C)=>C.intersectionZ-E.intersectionZ);const S=[];for(let E=f.length-1;E>=0;E--){const C=f[E];if(s(C))for(let R=x.length-1;R>=0;R--){const F=x[R].feature;if(F.layer&&_[F.layer.id]<E)break;S.push(F),x.pop()}else for(const R of r){const F=R[C];if(F)for(const j of F)S.push(j.feature)}}return S}queryRenderedFeatures(r,s,f){let _;s&&!Array.isArray(s)&&s.filter&&(this._validate(ae,"queryRenderedFeatures.filter",s.filter,null,s),_=o.b3(s.filter));const x={},S=F=>{if(yl.has(F.type))return;const j=this.getOwnLayerSourceCache(F),B=x[j.id]=x[j.id]||{sourceCache:j,layers:{},has3DLayers:!1};F.is3D(!!this.terrain)&&(B.has3DLayers=!0),B.layers[F.fqid]=B.layers[F.fqid]||{styleLayer:F,targets:[]},B.layers[F.fqid].targets.push({filter:_})};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.z(new Error("parameters.layers must be an Array."))),[];for(const F of s.layers){const j=this._layers[F];if(!j)return this.fire(new o.z(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];S(j)}}else for(const F in this._layers)S(this._layers[F]);const E=this._queryRenderedFeatures(r,x,f),C=this._flattenAndSortRenderedFeatures(E),R=[];for(const F of C)o.de(F.layer.id)===this.scope&&R.push(F);return R}queryRenderedFeatureset(r,s,f){let _;s&&!Array.isArray(s)&&s.filter&&(this._validate(ae,"queryRenderedFeatures.filter",s.filter,null,s),_=o.b3(s.filter));const x="mock",S=[];if(s&&s.target)S.push(Object.assign({},s,{targetId:x,filter:_}));else{const F=this.getFeaturesetDescriptors();for(const j of F)S.push({targetId:x,filter:_,target:j});for(const{style:j}of this.fragments){const B=j.getFeaturesetDescriptors();for(const G of B)S.push({targetId:x,filter:_,target:G})}}const E=this.queryRenderedTargets(r,S,f),C=[],R=new Set;for(const F of E)for(const j of F.variants[x])Zl(j,F,R)||C.push(new o.df(F,j));return C}queryRenderedTargets(r,s,f){const _={},x=(E,C,R,F)=>{const j=_[C.id]=_[C.id]||{sourceCache:C,layers:{},has3DLayers:!1};if(j.layers[E.fqid]=j.layers[E.fqid]||{styleLayer:E,targets:[]},E.is3D(!!this.terrain)&&(j.has3DLayers=!0),!F)return R.uniqueFeatureID=!1,void j.layers[E.fqid].targets.push(R);j.layers[E.fqid].targets.push(Object.assign({},R,{namespace:F.namespace,properties:F.properties,uniqueFeatureID:F.uniqueFeatureID}))};for(const E of s)if("featuresetId"in E.target){const{featuresetId:C,importId:R}=E.target,F=this.getFragmentStyle(R);if(!F||!F._featuresetSelectors)continue;const j=F._featuresetSelectors[C];if(!j){this.fire(new o.z(new Error(`The featureset '${C}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of j){const G=F.getOwnLayer(B.layerId);G&&!yl.has(G.type)&&x(G,F.getOwnLayerSourceCache(G),E,B)}}else if("layerId"in E.target){const{layerId:C}=E.target,R=this.getLayer(C);if(!R||yl.has(R.type))continue;x(R,this.getLayerSourceCache(R),E)}const S=this._queryRenderedFeatures(r,_,f);return this._flattenAndSortRenderedFeatures(S)}_queryRenderedFeatures(r,s,f){const _=[],x=!!this.map._showQueryGeometry,S=oo.createFromScreenPoints(r,f);for(const E in s){const C=cl(S,s[E],this._availableImages,f,x);Object.keys(C).length&&_.push(C)}if(this.placement)for(const E in s){if(!s[E].sourceCache._onlySymbols)continue;const C=fd(S.screenGeometry,s[E],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(C).length&&_.push(C)}return _}querySourceFeatures(r,s){const f=s&&s.filter;f&&this._validate(ae,"querySourceFeatures.filter",f,null,s);let _=[];const x=this.getOwnSourceCaches(r);for(const S of x)_=_.concat(Cp(S,s));return _}addSourceType(r,s,f){return Ts.getSourceType(r)?f(new Error(`A source type called "${r}" already exists.`)):(Ts.setSourceType(r,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:s.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,s,f={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const E in r)if(!o.bv(r[E],_[E])){x=!0;break}if(!x)return;const S=this._getTransitionParameters();this.light.setLight(r,s,f),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,s=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=r;const _=r.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){const E="terrain-dem-src";this.addSource(E,f.source),f=o.d7(f),f=o.l(f,{source:E})}const x=o.l({},f),S={};if(this.terrain&&_){x.source=this.terrain.get().source;const E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(S.style=E.serialize())}if(this._validate(Dt,"terrain",x,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&s!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,s),this.fire(new o.A("data",{dataType:"style"}))}else{const x=this.terrain,S=x.get();for(const E of Object.keys(o.a5.terrain))!f.hasOwnProperty(E)&&o.a5.terrain[E].default&&(f[E]=o.a5.terrain[E].default);for(const E in r)if(!o.bv(r[E],S[E])){x.set(r,this.options),this.stylesheet.terrain=r;const C=this._getTransitionParameters({duration:0});x.updateTransitions(C),this.fire(new o.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const s=this.fog=new Nr(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const f=this._getTransitionParameters({duration:0});s.updateTransitions(f)}_createSnow(r){const s=this.snow=new hn(r,this.map.transform,this.scope,this.options);this.stylesheet.snow=s.get();const f=this._getTransitionParameters({duration:0});s.updateTransitions(f)}_createRain(r){const s=this.rain=new li(r,this.map.transform,this.scope,this.options);this.stylesheet.rain=s.get();const f=this._getTransitionParameters({duration:0});s.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!o.bv(s.get(),r)){s.set(r,this.options),this.stylesheet.fog=s.get();const f=this._getTransitionParameters({duration:0});s.updateTransitions(f)}}else this._createFog(r);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(r){if(this._checkLoaded(),!r)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const s=this.snow;if(!o.bv(s.get(),r)){s.set(r,this.options),this.stylesheet.snow=s.get();const f=this._getTransitionParameters({duration:0});s.updateTransitions(f)}}else this._createSnow(r);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(r){if(this._checkLoaded(),!r)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const s=this.rain;if(!o.bv(s.get(),r)){s.set(r,this.options),this.stylesheet.rain=s.get();const f=this._getTransitionParameters({duration:0});s.updateTransitions(f)}}else this._createRain(r);this._markersNeedUpdate=!0}_reloadColorTheme(){const r=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!s)return this._styleColorTheme.lut=null,void r();const f=this._evaluateColorThemeData(s);this._loadColorTheme(f).then(()=>{this.fire(new o.A("colorthemeset")),r()}).catch(_=>{o.w(`Couldn't set color theme: ${_}`)})}setColorTheme(r){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=r,this._reloadColorTheme()}setImportColorTheme(r,s){const f=this.getFragmentStyle(r);f&&(f._styleColorTheme.colorThemeOverride=s,f._reloadColorTheme())}_getTransitionParameters(r){return{now:o.q.now(),transition:o.l(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],s=[];for(const f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?r.push(f):s.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...s)}_createTerrain(r,s){const f=this.terrain=new ht(r,s,this.scope,this.options);s===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_force3DLayerUpdate(){for(const r in this._layers){const s=this._layers[r];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const s=this._layers[r];s.type==="symbol"&&this._updateLayer(s)}}_validate(r,s,f,_,x={}){if(x&&x.validate===!1)return!1;const S=o.l({},this.serialize());return Ss(this,r.call(An,o.l({key:s,style:S,value:f,styleSpec:o.a5},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.dg.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(r){const s=this.getSourceCaches(r);for(const f of s)f.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}reloadSource(r){const s=this.getSourceCaches(r);for(const f of s)f.resume(),f.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(r=>{r.modelManager.reloadModels(r.scope)})}updateSources(r){let s;this.directionalLight&&(s=xd(this.directionalLight));const f=new Set;for(const _ in this._mergedLayers){const x=this._mergedLayers[_];x.hasElevation()&&!f.has(x.source)&&f.add(x.source)}for(const _ in this._mergedSourceCaches){const x=this._mergedSourceCaches[_],S=f.has(x._source.id);x.update(r,void 0,void 0,s,S)}}_generateCollisionBoxes(){for(const r in this._sourceCaches){const s=this._sourceCaches[r];s.resume(),s.reload()}}_updatePlacement(r,s,f,_,x,S,E=!1){let C=!1,R=!1;const F={},j={};for(const B of this._mergedOrder){const G=this._mergedLayers[B];if(G.type!=="symbol")continue;const J=o.C(G.source,G.scope);let Y=F[J];if(!Y){const K=this.getLayerSourceCache(G);if(!K)continue;const ce=K.getRenderableIds(!0).map(fe=>K.getTileByID(fe));j[J]=ce.slice(),Y=F[J]=ce.sort((fe,pe)=>pe.tileID.overscaledZ-fe.tileID.overscaledZ||(fe.tileID.isLessThan(pe.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(G,Y,s.center.lng,s.projection);C=C||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),E=E||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new o.A("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),s.zoom))&&(this.pauseablePlacement=new _a(s,this._mergedOrder,E,f,_,x,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,j,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),R=!0),C&&this.pauseablePlacement.placement.setStale()),R||C){this._buildingIndex.onNewFrame(s.zoom);for(let B=0;B<this._mergedOrder.length;B++){const G=this._mergedLayers[this._mergedOrder[B]];if(G.type!=="symbol")continue;const J=this.isLayerClipped(G);this.placement.updateLayerOpacities(G,F[o.C(G.source,G.scope)],B,J?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,s){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:x})=>x===r.id)!==-1)return void this.fire(new o.z(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!s)return f.push(r),this._loadImports([r],!0);const _=f.findIndex(({id:x})=>x===s);return _===-1&&this.fire(new o.z(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,_).concat(r).concat(f.slice(_)),this._loadImports([r],!0,s)}updateImport(r,s){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(r);return _===-1?this:typeof s=="string"?(this.setImportUrl(r,s),this):(s.url&&s.url!==f[_].url&&this.setImportUrl(r,s.url),o.bv(s.config,f[_].config)||this.setImportConfig(r,s.config,s.data.schema),o.bv(s.data,f[_].data)||this.setImportData(r,s.data),this)}moveImport(r,s){this._checkLoaded();let f=this.stylesheet.imports||[];const _=this.getImportIndex(r);if(_===-1)return this;const x=this.getImportIndex(s);if(x===-1)return this;const S=f[_],E=this.fragments[_];return f=f.filter(({id:C})=>C!==r),this.fragments=this.fragments.filter(({id:C})=>C!==r),this.stylesheet.imports=f.slice(0,x).concat(S).concat(f.slice(x)),this.fragments=this.fragments.slice(0,x).concat(E).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(r,s){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(r);if(_===-1)return this;f[_].url=s;const x=this.fragments[_];return x.style=this._createFragmentStyle(f[_]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(s),this}setImportData(r,s){this._checkLoaded();const f=this.getImportIndex(r),_=this.stylesheet.imports||[];return f===-1?this:s?(this.fragments[f].style.setState(s),this._reloadImports(),this):(delete _[f].data,this.setImportUrl(r,_[f].url))}setImportConfig(r,s,f){this._checkLoaded();const _=this.getImportIndex(r),x=this.stylesheet.imports||[];if(_===-1)return this;s?x[_].config=s:delete x[_].config;const S=this.fragments[_];f&&S.style.stylesheet&&(S.style.stylesheet.schema=f);const E=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=s,S.style.updateConfig(s,E),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const s=this.stylesheet.imports||[],f=this.getImportIndex(r);f!==-1&&(s.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(r){const s=(this.stylesheet.imports||[]).findIndex(f=>f.id===r);return s===-1&&this.fire(new o.z(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),s}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const s in this._mergedOtherSourceCaches){const f=this._mergedOtherSourceCaches[s];f&&r.push(f.getSource())}return r}getSource(r,s){const f=this.getSourceCache(r,s);return f&&f.getSource()}getLayerSource(r){const s=this.getLayerSourceCache(r);return s&&s.getSource()}getSourceCache(r,s){const f=o.C(r,s);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(r){const s=o.C(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[r]&&s.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&s.push(this._mergedSymbolSourceCaches[r]),s}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const s in r){const f=r[s];f==="reload"?this.reloadSource(s):f==="clear"&&this.clearSource(s)}}updateLayers(r){const s=this._changes.getUpdatedPaintProperties();for(const f of s){const _=this.getLayer(f);_&&_.updateTransitions(r)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(r){this.stylesheet.glyphs=r,this.glyphManager.setURL(r,this.scope)}getImages(r,s,f){this.imageManager.getImages(s.images,s.scope,f),this._updateTilesForChangedImages();const _=S=>{if(S){const E=s.images.map(C=>o.I.toString(C));S.setDependencies(s.tileID.key,s.type,E)}},x=o.C(s.source,s.scope);_(this._mergedOtherSourceCaches[x]),_(this._mergedSymbolSourceCaches[x])}rasterizeImages(r,s,f){this.imageManager.rasterizeImages(s,f)}getGlyphs(r,s,f){this.glyphManager.getGlyphs(s.stacks,s.scope,f)}getResource(r,s,f){return o.dh(s,f)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const s=[];return this._otherSourceCaches[r]&&s.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&s.push(this._symbolSourceCaches[r]),s}_isSourceCacheLoaded(r){const s=this.getOwnSourceCaches(r);return s.length===0?(this.fire(new o.z(new Error(`There is no source with ID '${r}'`))),!1):s.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,s){if(!this._clipLayerPresent&&r.type!=="fill-extrusion")return!1;const f=r.type==="fill-extrusion"&&r.sourceLayer==="building";if(r.is3D(!!this.terrain)){if(f||s&&s.type==="batched-model"||r.type==="model")return!0}else if(r.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ts.getSourceType=function(d){return dd[d]},Ts.setSourceType=function(d,r){dd[d]=r},Ts.registerForPluginStateChange=o.c$;var Sh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,qs=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,wd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Fc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Oa=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Sd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,zt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Nc=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Th=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Td=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Eh=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Bc=[];ns(Sh,Bc),ns(wd,Bc),ns(qs,Bc);const rs={"_prelude_fog.vertex.glsl":Sd,"_prelude_terrain.vertex.glsl":Oa,"_prelude_shadow.vertex.glsl":Td,"_prelude_fog.fragment.glsl":zt,"_prelude_shadow.fragment.glsl":Eh,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Nc,"_prelude_raster_particle.glsl":Th},Cu={};Sn("",Oa),Sn(zt,Sd),Sn(Eh,Td),Sn(Nc,""),Sn(Th,"");const tc=Sn(qs,wd),Ah=Sh;var jc={background:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);color*=u_opacity;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=vec4(linearTosRGB(color.rgb),color.a);
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Sn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Sn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Sn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Sn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Sn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Sn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Sn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Sn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Sn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Sn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Sn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Sn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Sn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Sn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Sn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Sn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Sn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(abs(v_z_offset) > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Sn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Sn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Fc),skyboxGradient:Sn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Fc),skyboxCapture:Sn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Sn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Sn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Sn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Sn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Sn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Sn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Sn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Sn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ns(d,r){const s=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of s)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=f.split(" ");for(const x of _)r.includes(x)||r.push(x)}}function Sn(d,r){const s=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let _=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(R=>{const F=R.split(" ");return F[F.length-1]}),_=[...new Set(_)]);const x={},S=[],E=[];if(d=d.replace(s,(R,F)=>(E.push(F),"")),(r=r.replace(s,(R,F)=>(S.push(F),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...Bc];ns(d,C),ns(r,C);for(const R of[...S,...E])rs[R]||console.error(`Undefined include: ${R}`),Cu[R]||(Cu[R]=[],ns(rs[R],Cu[R])),C=[...C,...Cu[R]];return{fragmentSource:d=d.replace(f,(R,F,j,B,G)=>(x[G]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${G}
in ${j} ${B} ${G};
#else
uniform ${j} ${B} u_${G};
#endif
`:F==="initialize"?`
#ifdef HAS_UNIFORM_u_${G}
    ${j} ${B} ${G} = u_${G};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    in ${j} ${B} ${G};
#endif
`:F==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(f,(R,F,j,B,G)=>{const J=B==="float"?"vec2":B,Y=G.match(/color/)?"color":J;return F==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${G}
in ${j} ${B} a_${G};
#endif
`:x[G]?F==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${j} ${J} a_${G};
out ${j} ${B} ${G};
#else
uniform ${j} ${B} u_${G};
#endif
`:F==="initialize"?Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${j} ${B} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${Y}(a_${G}, u_${G}_t);
#else
    ${j} ${B} ${G} = u_${G};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    in ${j} ${B} a_${G};
    out ${j} ${B} ${G};
#endif
`:F==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    ${G} = a_${G};
#endif
`:void 0:F==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${j} ${J} a_${G};
#else
uniform ${j} ${B} u_${G};
#endif
`:F==="define-instanced"?Y==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${G}0;
in vec4 a_${G}1;
in vec4 a_${G}2;
in vec4 a_${G}3;
#else
uniform ${j} ${B} u_${G};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${j} ${J} a_${G};
#else
uniform ${j} ${B} u_${G};
#endif
`:F==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    ${j} ${B} ${G} = a_${G};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${j} ${B} ${G} = a_${G};
#else
    ${j} ${B} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${j} ${B} ${G} = unpack_mix_${Y}(a_${G}, u_${G}_t);
#else
    ${j} ${B} ${G} = u_${G};
#endif
`}),staticAttributes:_,usedDefines:C,vertexIncludes:S,fragmentIncludes:E}}class Ed{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,s,f,_,x,S,E,C){this.context=r;let R=this.boundPaintVertexBuffers.length!==_.length;for(let j=0;!R&&j<_.length;j++)this.boundPaintVertexBuffers[j]!==_[j]&&(R=!0);let F=this.boundDynamicVertexBuffers.length!==E.length;for(let j=0;!F&&j<E.length;j++)this.boundDynamicVertexBuffers[j]!==E[j]&&(F=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==f||R||F||this.boundIndexBuffer!==x||this.boundVertexOffset!==S)this.freshBind(s,f,_,x,S,E,C);else{r.bindVertexArrayOES.set(this.vao);for(const j of E)j&&(j.bind(),C&&j.instanceCount&&j.setVertexAttribDivisor(r.gl,s,C));x&&x.dynamicDraw&&x.bind()}}freshBind(r,s,f,_,x,S,E){const C=r.numAttributes,R=this.context,F=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=S,s.enableAttributes(F,r),s.bind(),s.setVertexAttribPointers(F,r,x);for(const j of f)j.enableAttributes(F,r),j.bind(),j.setVertexAttribPointers(F,r,x);for(const j of S)j&&(j.enableAttributes(F,r),j.bind(),j.setVertexAttribPointers(F,r,x),E&&j.instanceCount&&j.setVertexAttribDivisor(F,r,E));_&&_.bind(),R.currentNumAttributes=C}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function t_(d,r){const s=Math.pow(2,r.canonical.z),f=r.canonical.y;return[new o.ac(0,f/s).toLngLat().lat,new o.ac(0,(f+1)/s).toLngLat().lat]}function Km(d,r,s,f,_,x,S){const E=d.context,C=E.gl,R=s.hillshadeFBO;if(!R)return;d.prepareDrawTile();const F=d.isTileAffectedByFog(r),j=d.getOrCreateProgram("hillshade",{overrideFog:F});E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,R.colorAttachment.get());const B=((te,K,ce,fe)=>{const pe=ce.paint.get("hillshade-shadow-color"),Ee=ce.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Te=ce.paint.get("hillshade-highlight-color"),we=ce.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ye=ce.paint.get("hillshade-accent-color"),Ie=ce.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Oe=ce.paint.get("hillshade-emissive-strength");let Xe=o.al(ce.paint.get("hillshade-illumination-direction"));if(ce.paint.get("hillshade-illumination-anchor")==="viewport")Xe-=te.transform.angle;else if(te.style&&te.style.enable3dLights()&&te.style.directionalLight){const st=te.style.directionalLight.properties.get("direction"),ct=o.cR(st.x,st.y,st.z);Xe=o.al(ct[1])}const je=!te.options.moving;return{u_matrix:fe||te.transform.calculateProjMatrix(K.tileID.toUnwrapped(),je),u_image:0,u_latrange:t_(0,K.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),Xe],u_shadow:pe.toRenderColor(Ee?null:ce.lut),u_highlight:Te.toRenderColor(we?null:ce.lut),u_emissive_strength:Oe,u_accent:ye.toRenderColor(Ie?null:ce.lut)}})(d,s,f,d.terrain?r.projMatrix:null);d.uploadCommonUniforms(E,j,r.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:J,tileBoundsSegments:Y}=d.getTileBoundsBuffers(s);j.draw(d,C.TRIANGLES,_,x,S,Pr.disabled,B,f.id,G,J,Y)}function Mu(d,r,s){if(!r.needsDEMTextureUpload)return;const f=d.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||d.getTileTexture(s.stride);const x=s.getPixels();r.demTexture?r.demTexture.update(x,{premultiply:!1}):r.demTexture=new o.T(f,x,_.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function zp(d,r,s){const f=d.context,_=f.gl;if(!r.dem)return;const x=r.dem;if(f.activeTexture.set(_.TEXTURE1),Mu(d,r,x),!r.demTexture)return;r.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const S=x.dim;f.activeTexture.set(_.TEXTURE0);let E=r.hillshadeFBO;if(!E){const B=new o.T(f,{width:S,height:S,data:null},_.RGBA8);B.bind(_.LINEAR,_.CLAMP_TO_EDGE),E=r.hillshadeFBO=f.createFramebuffer(S,S,!0,"renderbuffer"),E.colorAttachment.set(B.texture)}f.bindFramebuffer.set(E.framebuffer),f.viewport.set([0,0,S,S]);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:R,tileBoundsSegments:F}=d.getMercatorTileBoundsBuffers(),j=[];d.linearFloatFilteringSupported()&&j.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:j}).draw(d,_.TRIANGLES,Jt.disabled,Tr.disabled,Yr.unblended,Pr.disabled,((B,G)=>{const J=G.stride,Y=o.bz();return o.c5(Y,0,o.aj,-o.aj,0,0,1),o.bo(Y,Y,[0,-o.aj,0]),{u_matrix:Y,u_image:1,u_dimension:[J,J],u_zoom:B.overscaledZ}})(r.tileID,x),s.id,C,R,F),r.needsHillshadePrepare=!1}class Mi{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jm extends Mi{getDefault(){return o.am.transparent}set(r){const s=this.current;(r.r!==s.r||r.g!==s.g||r.b!==s.b||r.a!==s.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class ao extends Mi{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Fp extends Mi{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Ad extends Mi{getDefault(){return[!0,!0,!0,!0]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Id extends Mi{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Pd extends Mi{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Np extends Mi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const s=this.current;(r.func!==s.func||r.ref!==s.ref||r.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Ih extends Mi{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Ph extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=r,this.dirty=!1}}class rc extends Mi{getDefault(){return[0,1]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Af extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=r,this.dirty=!1}}class Ou extends Mi{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Bp extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.BLEND):s.disable(s.BLEND),this.current=r,this.dirty=!1}}class jp extends Mi{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class nc extends Mi{getDefault(){return o.am.transparent}set(r){const s=this.current;(r.r!==s.r||r.g!==s.g||r.b!==s.b||r.a!==s.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Uc extends Mi{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class Ch extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=r,this.dirty=!1}}class Mh extends Mi{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Vc extends Mi{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Oh=class extends Mi{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class Up extends Mi{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Vp extends Mi{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class $p extends Mi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class If extends Mi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Du extends Mi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class ic extends Mi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Gp extends Mi{getDefault(){return null}set(r){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class ku extends Mi{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class Da extends Mi{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Dh extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class oc extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Cd extends Mi{constructor(r,s){super(r),this.context=r,this.parent=s}getDefault(){return null}}class r_ extends Cd{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Pf extends Cd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ac extends Cd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Ru extends Pf{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const $c=(d,r,s)=>({u_matrix:d,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:s}),kh=(d,r,s,f,_,x,S,E,C,R,F,j,B,G,J,Y)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:s,u_zoom_transition:_,u_merc_center:x,u_image0:0,u_frustum_tl:S,u_frustum_tr:E,u_frustum_br:C,u_frustum_bl:R,u_globe_pos:F,u_globe_radius:j,u_viewport:B,u_grid_matrix:Y?Float32Array.from(Y):new Float32Array(9),u_skirt_height:G,u_far_z_cutoff:J});function Md(d,r){return d!=null&&r!=null&&!(!d.hasData()||!r.hasData())&&d.demTexture!=null&&r.demTexture!=null&&d.tileID.key!==r.tileID.key}const Ws=new class{constructor(){this.operations={}}newMorphing(d,r,s,f,_){if(d in this.operations){const x=this.operations[d];x.to.tileID.key!==s.tileID.key&&(x.queued=s)}else this.operations[d]={startTime:f,phase:0,duration:_,from:r,to:s,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const r=this.operations[d];return{from:r.from,to:r.to,phase:r.phase}}update(d){for(const r in this.operations){const s=this.operations[r];for(s.phase=(d-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,d)){delete this.operations[r];break}}}_nextOp(d,r){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=r,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},is={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ui(d,r,s){if(r===0)return 0;const f=r<1&&s===514?.25/r:1;return 6*Math.pow(1.5,22-d)*Math.max(r,1)*f}function Ji(d,r){const s=1<<d.z;return!r&&(d.x===0||d.x===s-1)||d.y===0||d.y===s-1}const wo=d=>({u_matrix:d});function zo(d,r,s,f,_){if(_>0){const x=o.q.now(),S=(x-d.timeAdded)/_,E=r?(x-r.timeAdded)/_:-1,C=s.getSource(),R=f.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),F=!r||Math.abs(r.tileID.overscaledZ-R)>Math.abs(d.tileID.overscaledZ-R),j=F&&d.refreshedUponExpiration?1:o.aD(F?S:1-E,0,1);return d.refreshedUponExpiration&&S>=1&&(d.refreshedUponExpiration=!1),r?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class ua extends Zo{constructor(r){const s={type:"raster-dem",maxzoom:r.transform.maxZoom},f=new o.D(o.d0(),null),_=Hl("mock-dem",s,f,r.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,s){r.state="loaded",s(null)}}class vl extends Zo{constructor(r){const s=Hl("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new o.D(o.d0(),null),r.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,s,f){if(r.freezeTileCoverage)return;this.transform=r;const _=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,S)=>{if(x[S.key]="",!this._tiles[S.key]){const E=new ul(S,this._source.tileSize*S.overscaleFactor(),r.tileZoom);E.state="loaded",this._tiles[S.key]=E}return x},{});for(const x in this._tiles)x in _||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(r){const s=this.proxyCachedFBO[r];if(s!==void 0){const f=Object.values(s);this.renderCachePool.push(...f),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class sc extends o.aM{constructor(r,s,f){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=s,this.projMatrix=f}}class ha extends o.dt{constructor(r,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,_,x]=function(C){const R=new o.ba,F=new o.a_,j=131;R.reserve(17161),F.reserve(33800);const B=o.aj/128,G=o.aj+B/2,J=G+B;for(let te=-B;te<J;te+=B)for(let K=-B;K<J;K+=B){const ce=K<0||K>G||te<0||te>G?24575:0,fe=o.aD(Math.round(K),0,o.aj),pe=o.aD(Math.round(te),0,o.aj);R.emplaceBack(fe+ce,pe)}const Y=(te,K)=>{const ce=K*j+te;F.emplaceBack(ce+1,ce,ce+j),F.emplaceBack(ce+j,ce+j+1,ce+1)};for(let te=1;te<129;te++)for(let K=1;K<129;K++)Y(K,te);return[0,129].forEach(te=>{for(let K=0;K<130;K++)Y(K,te),Y(te,K)}),[R,F,32768]}(),S=r.context;this.gridBuffer=S.createVertexBuffer(f,o.bc.members),this.gridIndexBuffer=S.createIndexBuffer(_),this.gridSegments=o.bd.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=o.bd.simpleSegment(0,0,f.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new vl(s.map),this.orthoMatrix=o.bz(),o.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.aj,0,o.aj,0,1);const E=S.gl;this._overlapStencilMode=new Tr({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ua(s.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,s,f){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const _=r.terrain.properties,x=r.terrain.drapeRenderMode===0,S=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const E=r.terrain&&r.terrain.scope,C=_.get("source"),R=x?this._mockSourceCache:r.getSourceCache(C,E);if(!R)return void o.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=R,this._attenuationRange=r.terrain.getAttenuationRange(),this._exaggeration=S?this.calculateExaggeration(s):_.get("exaggeration"),!s.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(s,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),s.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(r){if(this._attenuationRange&&r.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(r.zoom);const s=this._previousCameraAltitude,f=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=f;const _=s!=null?f-s:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const x=r.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(x);let E=x-this._previousZoom;const C=this._previousUpdateTimestamp;let R=x;this._evaluationZoom!=null&&(R=this._evaluationZoom,Math.abs(x-R)>.5&&(E=.5*(x-R+E)),E*_<0&&(R+=E)),this._evaluationZoom=R;const F=S.getExaggeration(R),j=F===S.getExaggeration(Math.max(0,R-.1));if(j&&Math.abs(F-this._exaggeration)<.01)return F;let B=Math.min(.1,.00375*(this._updateTimestamp-C));return(j||F<.1||Math.abs(E)<1e-4)&&(B=Math.min(.2,4*B)),o.ai(this._exaggeration,F,B)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(o.ac.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=s.getIds().map(C=>{const R=s.getTileByID(C).tileID;return R.projMatrix=f.calculateProjMatrix(R.toUnwrapped()),R});(function(C,R){const F=R.transform.pointCoordinate(R.transform.getCameraPoint()),j=new o.P(F.x,F.y);C.sort((B,G)=>{if(G.overscaledZ-B.overscaledZ)return G.overscaledZ-B.overscaledZ;const J=new o.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),Y=new o.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),te=j.mult(1<<B.canonical.z);return te.x-=.5,te.y-=.5,te.distSqr(J)-te.distSqr(Y)})})(_,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},_.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const C in S){const R=S[C];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,r[C],x),R.usedForTerrain))continue;const F=r[C];R.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[s.id]=_.map(C=>new sc(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const E={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const R=this.terrainTileForTile[C.key];if(!R)continue;const F=R.tileID.key;F in E||(this._visibleDemTiles.push(R),E[F]=F)}}_assignTerrainTiles(r){this._initializing||r.forEach(s=>{if(this.terrainTileForTile[s.key])return;const f=this._findTileCoveringTileID(s,this.sourceCache);f&&(this.terrainTileForTile[s.key]=f)})}_prepareDEMTextures(){const r=this.painter.context,s=r.gl;for(const f in this.terrainTileForTile){const _=this.terrainTileForTile[f],x=_.dem;!x||_.demTexture&&!_.needsDEMTextureUpload||(r.activeTexture.set(s.TEXTURE1),Mu(this.painter,_,x))}}_prepareDemTileUniforms(r,s,f,_){if(!s||s.demTexture==null)return!1;const x=r.tileID.canonical,S=Math.pow(2,s.tileID.canonical.z-x.z),E=_||"";return f[`u_dem_tl${E}`]=[x.x*S%1,x.y*S%1],f[`u_dem_scale${E}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0;const s=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;const x=_.dem.tree.minimums[0];return x>0&&r++,f+x},0);return r?s/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,s=r.gl;r.activeTexture.set(s.TEXTURE2);const f=this._getLoadedAreaMinimum(),_=new o.du({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(_,{premultiply:!1}):x=this._emptyDEMTexture=new o.T(r,_,s.R32F,{premultiply:!1}),x}setupElevationDraw(r,s,f){const _=this.painter.context,x=_.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let E=null,C=null,R=1;if(f&&f.morphing&&this._useVertexMorphing){const G=f.morphing.srcDemTile,J=f.morphing.dstDemTile;R=f.morphing.phase,G&&J&&(this._prepareDemTileUniforms(r,G,S,"_prev")&&(C=G),this._prepareDemTileUniforms(r,J,S)&&(E=J))}const F=G=>G&&G.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST;let j=null;var B;if(this.enabled?C&&E?(j=E.demTexture,_.activeTexture.set(x.TEXTURE4),C.demTexture.bind(F(C),x.CLAMP_TO_EDGE),S.u_dem_lerp=R):(E=this.terrainTileForTile[r.tileID.key],j=this._prepareDemTileUniforms(r,E,S)?E.demTexture:this.emptyDEMTexture):j=this.emptyDEMTexture,_.activeTexture.set(x.TEXTURE2),j&&(S.u_dem_size=(B=j).size[0]===1?1:B.size[0]-2,j.bind(F(E),x.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,s,S),f&&f.useMeterToDem&&E){const G=(1<<E.tileID.canonical.z)*o.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=G}if(f&&f.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),s.setTerrainUniformValues(_,S),this.painter.transform.projection.name==="globe"){const G=this.globeUniformValues(this.painter.transform,r.tileID.canonical,f&&f.useDenormalizedUpVectorScale);s.setGlobeUniformValues(_,G)}}globeUniformValues(r,s,f){const _=r.projection;return{u_tile_tl_up:_.upVector(s,0,0),u_tile_tr_up:_.upVector(s,o.aj,0),u_tile_br_up:_.upVector(s,o.aj,o.aj),u_tile_bl_up:_.upVector(s,0,o.aj),u_tile_up_scale:f?o.dv(1):_.upVectorScale(s,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const s=this.painter,f=this.painter.context;r.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,x,S,E,C){if(_.transform.projection.name==="globe")(function(R,F,j,B,G){const J=R.context,Y=J.gl;let te,K;const ce=R.transform,fe=o.dl(R,J,ce),pe=(st,ct)=>{if(K===ct)return;const Et=[is[ct],"PROJECTION_GLOBE_VIEW"];fe&&Et.push("CUSTOM_ANTIALIASING");const Ve=R.isTileAffectedByFog(st);te=R.getOrCreateProgram("globeRaster",{defines:Et,overrideFog:Ve}),K=ct},Ee=R.colorModeForRenderPass(),Te=new Jt(Y.LEQUAL,Jt.ReadWrite,R.depthRangeFor3D);Ws.update(G);const we=o.dm(ce),ye=[o.ay(ce.center.lng),o.aH(ce.center.lat)],Ie=R.globeSharedBuffers,Oe=[ce.width*o.q.devicePixelRatio,ce.height*o.q.devicePixelRatio],Xe=Float32Array.from(ce.globeMatrix),je={useDenormalizedUpVectorScale:!0};{const st=R.transform,ct=Ui(st.zoom,F.exaggeration(),F.sourceCache._source.tileSize);K=-1;const Et=Y.TRIANGLES;for(const Ve of B){const He=j.getTile(Ve),Ue=Tr.disabled,ft=F.prevTerrainTileForTile[Ve.key],Ke=F.terrainTileForTile[Ve.key];Md(ft,Ke)&&Ws.newMorphing(Ve.key,ft,Ke,G,250),J.activeTexture.set(Y.TEXTURE0),He.texture&&He.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const gt=Ws.getMorphValuesForProxy(Ve.key),dt=gt?1:0;gt&&o.L(je,{morphing:{srcDemTile:gt.from,dstDemTile:gt.to,phase:o.dk(gt.phase)}});const vt=o.dn(Ve.canonical),bt=o.dp(vt.getCenter().lat),Yt=o.dq(Ve.canonical,vt,bt,st.worldSize/st._pixelsPerMercatorPixel),tr=o.bh(o.dr(Ve.canonical)),Bt=kh(st.expandedFarZProjMatrix,Xe,we,tr,o.ah(st.zoom),ye,st.frustumCorners.TL,st.frustumCorners.TR,st.frustumCorners.BR,st.frustumCorners.BL,st.globeCenterInViewSpace,st.globeRadius,Oe,ct,st._farZ,Yt);if(pe(Ve,dt),te&&(F.setupElevationDraw(He,te,je),R.uploadCommonUniforms(J,te,Ve.toUnwrapped()),Ie)){const[er,Wt,hr]=Ie.getGridBuffers(bt,ct!==0);te.draw(R,Et,Te,Ue,Ee,Pr.backCCW,Bt,"globe_raster",er,Wt,hr)}}}if(Ie&&(R.renderDefaultNorthPole||R.renderDefaultSouthPole)){const st=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];fe&&st.push("CUSTOM_ANTIALIASING"),te=R.getOrCreateProgram("globeRaster",{defines:st});for(const ct of B){const{x:Et,y:Ve,z:He}=ct.canonical,Ue=Ve===0,ft=Ve===(1<<He)-1,[Ke,gt,dt,vt]=Ie.getPoleBuffers(He,!1);if(vt&&(Ue||ft)){const bt=j.getTile(ct);J.activeTexture.set(Y.TEXTURE0),bt.texture&&bt.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let Yt=o.ds(He,Et,ce);const tr=o.bh(o.dr(ct.canonical)),Bt=(er,Wt)=>er.draw(R,Y.TRIANGLES,Te,Tr.disabled,Ee,Pr.disabled,kh(ce.expandedFarZProjMatrix,Yt,Yt,tr,0,ye,ce.frustumCorners.TL,ce.frustumCorners.TR,ce.frustumCorners.BR,ce.frustumCorners.BL,ce.globeCenterInViewSpace,ce.globeRadius,Oe,0,ce._farZ),"globe_pole_raster",Wt,dt,vt);F.setupElevationDraw(bt,te,je),R.uploadCommonUniforms(J,te,ct.toUnwrapped()),Ue&&R.renderDefaultNorthPole&&Bt(te,Ke),ft&&R.renderDefaultSouthPole&&(Yt=o.cE(o.bz(),Yt,[1,-1,1]),Bt(te,gt))}}}})(_,x,S,E,C);else{const R=_.context,F=R.gl;let j,B;const G=_.shadowRenderer,J=Gs(_,_.longestCutoffRange),Y=Ee=>{if(B===Ee)return;const Te=[];Te.push(is[Ee]),J.shouldRenderCutoff&&Te.push("RENDER_CUTOFF"),G&&(Te.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&Te.push("NORMAL_OFFSET")),j=_.getOrCreateProgram("terrainRaster",{defines:Te}),B=Ee},te=_.colorModeForRenderPass(),K=new Jt(F.LEQUAL,Jt.ReadWrite,_.depthRangeFor3D);Ws.update(C);const ce=_.transform,fe=Ui(ce.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let pe=[0,0,0];if(G){const Ee=_.style.directionalLight,Te=_.style.ambientLight;Ee&&Te&&(pe=bs(_.style,Ee,Te))}{B=-1;const Ee=F.TRIANGLES,[Te,we]=[x.gridIndexBuffer,x.gridSegments];for(const ye of E){const Ie=S.getTile(ye),Oe=Tr.disabled,Xe=x.prevTerrainTileForTile[ye.key],je=x.terrainTileForTile[ye.key];Md(Xe,je)&&Ws.newMorphing(ye.key,Xe,je,C,250),R.activeTexture.set(F.TEXTURE0),Ie.texture&&Ie.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const st=Ws.getMorphValuesForProxy(ye.key),ct=st?1:0;let Et;st&&(Et={morphing:{srcDemTile:st.from,dstDemTile:st.to,phase:o.dk(st.phase)}});const Ve=$c(ye.projMatrix,Ji(ye.canonical,ce.renderWorldCopies)?fe/10:fe,pe);if(Y(ct),!j)continue;x.setupElevationDraw(Ie,j,Et);const He=ye.toUnwrapped();G&&G.setupShadows(He,j),_.uploadCommonUniforms(R,j,He,null,J),j.draw(_,Ee,K,Oe,te,Pr.backCCW,Ve,"terrain_raster",x.gridBuffer,Te,we)}}}}(s,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const s=this.painter,f=this.painter.context,_=this.proxySourceCache,x=this.proxiedCoords[_.id],S=this._drapedRenderBatches.shift(),E=s.style.order,C=[];let R=0;for(const F of x){const j=_.getTileByID(F.proxyTileKey),B=_.proxyCachedFBO[F.key]?_.proxyCachedFBO[F.key][r]:void 0,G=B!==void 0?_.renderCache[B]:this.pool[R++],J=B!==void 0;if(j.texture=G.tex,J&&!G.dirty){C.push(j.tileID);continue}let Y;f.bindFramebuffer.set(G.fb.framebuffer),this.renderedToTile=!1,G.dirty&&(f.clear({color:o.am.transparent,stencil:0}),G.dirty=!1);for(let te=S.start;te<=S.end;++te){const K=s.style._mergedLayers[E[te]];if(K.isHidden(s.transform.zoom))continue;const ce=s.style.getLayerSourceCache(K),fe=ce?this.proxyToSource[F.key][ce.id]:[F];if(!fe)continue;const pe=fe;f.viewport.set([0,0,G.fb.width,G.fb.height]),Y!==(ce?ce.id:null)&&(this._setupStencil(G,fe,K,ce),Y=ce?ce.id:null),s.renderLayer(s,ce,K,pe)}if(this._drapedRenderBatches.length===0)for(const te of this._pendingGroundEffectLayers){const K=s.style._mergedLayers[E[te]];if(K.isHidden(s.transform.zoom))continue;const ce=s.style.getLayerSourceCache(K),fe=ce?this.proxyToSource[F.key][ce.id]:[F];if(!fe)continue;const pe=fe;f.viewport.set([0,0,G.fb.width,G.fb.height]),Y!==(ce?ce.id:null)&&(this._setupStencil(G,fe,K,ce),Y=ce?ce.id:null),s.renderLayer(s,ce,K,pe)}this.renderedToTile?(G.dirty=!0,C.push(j.tileID)):J||--R,R===5&&(R=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,s.width,s.height]),S.end+1}postRender(){}isLayerOrderingCorrect(r){const s=r.order.length;let f=-1,_=s;for(let x=0;x<s;++x)this._style.isLayerDraped(r._mergedLayers[r.order[x]])?f=Math.max(f,x):_=Math.min(_,x);return _>f}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{r=Math.min(r,s.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,s,f){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const S=x.tileID,E=1<<S.overscaledZ,{x:C,y:R}=S.canonical,F=C/E,j=(C+1)/E,B=R/E,G=(R+1)/E;return{minx:F,miny:B,maxx:j,maxy:G,t:x.dem.tree.raycastRoot(F,B,j,G,r,s,f),tile:x}});_.sort((x,S)=>(x.t!==null?x.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const x of _){if(x.t==null)return null;const S=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,r,s,f);if(S!=null)return S}return null}_createFBO(){const r=this.painter.context,s=r.gl,f=this.drapeBufferSize;r.activeTexture.set(s.TEXTURE0);const _=new o.T(r,{width:f[0],height:f[1],data:null},s.RGBA8);_.bind(s.LINEAR,s.CLAMP_TO_EDGE);const x=r.createFramebuffer(f[0],f[1],!0,null);return x.colorAttachment.set(_.texture),x.depthAttachment=new Ru(r,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:x,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const s=this._style._mergedLayers[r],f=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!f&&s.shouldRedrape():!f&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const f of this._style.getSources())if(f instanceof Wi){r=!0;break}if(!r)return;const s={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],x=this._style.getLayerSourceCache(_);if(x&&!s[x.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof o.ab){s[x.id]=!0;for(const S of this.proxyCoords){const E=this.proxyToSource[S.key][x.id];if(E)for(const C of E)this._clearRenderCacheForTile(x.id,C)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof ll){r=!0;break}if(!r)return;const s={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],x=this._style.getLayerSourceCache(_);if(!x||s[x.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const S=_.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const C=this.proxyToSource[E.key][x.id];if(C)for(const R of C){const F=zo(x.getTile(R),x.findLoadedParent(R,0),x,this.painter.transform,S);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(x.id,R)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const r=this._style.order,s=r.length;if(s===0)return;const f=[];this._pendingGroundEffectLayers=[];let _,x=0,S=this._style._mergedLayers[r[x]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++x<s;)S=this._style._mergedLayers[r[x]];for(;x<s;++x){const E=this._style._mergedLayers[r[x]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?_===void 0&&(_=x):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),_!==void 0&&(f.push({start:_,end:x-1}),_=void 0)))}if(_!==void 0&&f.push({start:_,end:x-1}),f.length!==0){const E=f[f.length-1];this._pendingGroundEffectLayers.every(C=>C>E.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(r){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const S=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let E=0;E<S.length;++E){const C=Object.values(S[E]);s.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,_=this._tilesDirty;for(let S=f.length-1;S>=0;S--){const E=f[S];if(s.getTileByID(E.key),s.proxyCachedFBO[E.key]!==void 0){const C=r[E.key],R=this.proxyToSource[E.key];let F=0;for(const j in R){const B=R[j],G=C[j];if(!G||G.length!==B.length||B.some((J,Y)=>J!==G[Y]||_[j]&&_[j].hasOwnProperty(J.key))){F=-1;break}++F}for(const j in s.proxyCachedFBO[E.key])s.renderCache[s.proxyCachedFBO[E.key][j]].dirty=F<0||F!==Object.values(C).length}}const x=[...this._drapedRenderBatches];x.sort((S,E)=>E.end-E.start-(S.end-S.start));for(const S of x)for(const E of f){if(s.proxyCachedFBO[E.key])continue;let C=s.renderCachePool.pop();C===void 0&&s.renderCache.length<50&&(C=s.renderCache.length,s.renderCache.push(this._createFBO())),C!==void 0&&(s.proxyCachedFBO[E.key]={},s.proxyCachedFBO[E.key][S.start]=C,s.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(r,s,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,S=x.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let E;if(f.isTileClipped())E=s.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):Tr.disabled}_renderTileClippingMasks(r,s){const f=this.painter,_=this.painter.context,x=_.gl;f._tileClippingMaskIDs={},_.setColorMode(Yr.disabled),_.setDepthMode(Jt.disabled);const S=f.getOrCreateProgram("clippingMask");for(const E of r){const C=f._tileClippingMaskIDs[E.key]=--s;S.draw(f,x.TRIANGLES,Jt.disabled,new Tr({func:x.ALWAYS,mask:0},C,255,x.KEEP,x.KEEP,x.REPLACE),Yr.disabled,Pr.disabled,wo(E.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(r){const s=this.painter.transform;if(r.x<0||r.x>s.width||r.y<0||r.y>s.height)return null;const f=[r.x,r.y,1,1];o.aA(f,f,s.pixelMatrixInverse),o.cw(f,f,1/f[3]),f[0]/=s.worldSize,f[1]/=s.worldSize;const _=s._camera.position,x=o.c6(1,s.center.lat),S=[_[0],_[1],_[2]/x,0],E=o.cY([],f.slice(0,3),S);o.au(E,E);const C=this.raycast(S,E,this._exaggeration);return C!==null&&C?(o.bF(S,S,E,C),S[3]=S[2],S[2]*=x,S):null}_setupProxiedCoordsForOrtho(r,s,f){if(r.getSource()instanceof o.aP)return this._setupProxiedCoordsForImageSource(r,s,f);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const _=this.proxiedCoords[r.id]=[],x=this.proxyCoords;for(let C=0;C<x.length;C++){const R=x[C],F=this._findTileCoveringTileID(R,r);if(F){const j=this._createProxiedId(R,F,f[R.key]&&f[R.key][r.id]);_.push(j),this.proxyToSource[R.key][r.id]=[j]}}let S=!1;const E=new Set;for(let C=0;C<s.length;C++){const R=r.getTile(s[C]);if(!R||!R.hasData())continue;const F=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==R.tileID.canonical.z){const j=this.proxyToSource[F.tileID.key][r.id],B=this._createProxiedId(F.tileID,R,f[F.tileID.key]&&f[F.tileID.key][r.id]);j?j.splice(j.length-1,0,B):this.proxyToSource[F.tileID.key][r.id]=[B];const G=this.proxyToSource[F.tileID.key][r.id];E.has(G)||E.add(G),_.push(B),S=!0}}if(this._sourceTilesOverlap[r.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const C of E)C.sort((R,F)=>F.overscaledZ-R.overscaledZ)}_setupProxiedCoordsForImageSource(r,s,f){if(!r.getSource().loaded())return;const _=this.proxiedCoords[r.id]=[],x=this.proxyCoords,S=r.getSource(),E=S.tileID;if(!E)return;const C=new o.P(E.x,E.y)._div(1<<E.z),R=S.coordinates.map(o.ac.fromLngLat).reduce((j,B)=>(j.min.x=Math.min(j.min.x,B.x-C.x),j.min.y=Math.min(j.min.y,B.y-C.y),j.max.x=Math.max(j.max.x,B.x-C.x),j.max.y=Math.max(j.max.y,B.y-C.y),j),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(j,B)=>{const G=j.wrap+j.canonical.x/(1<<j.canonical.z),J=j.canonical.y/(1<<j.canonical.z),Y=o.aj/(1<<j.canonical.z),te=B.wrap+B.canonical.x/(1<<B.canonical.z),K=B.canonical.y/(1<<B.canonical.z);return G+Y<te+R.min.x||G>te+R.max.x||J+Y<K+R.min.y||J>K+R.max.y};for(let j=0;j<x.length;j++){const B=x[j];for(let G=0;G<s.length;G++){const J=r.getTile(s[G]);if(!J||!J.hasData()||F(B,J.tileID))continue;const Y=this._createProxiedId(B,J,f[B.key]&&f[B.key][r.id]),te=this.proxyToSource[B.key][r.id];te?te.push(Y):this.proxyToSource[B.key][r.id]=[Y],_.push(Y)}}}_createProxiedId(r,s,f){let _=this.orthoMatrix;if(f){const x=f.find(S=>S.key===s.tileID.key);if(x)return x}if(s.tileID.key!==r.key){const x=r.canonical.z-s.tileID.canonical.z;let S,E,C;_=o.bz();const R=s.tileID.wrap-r.wrap<<r.overscaledZ;x>0?(S=o.aj>>x,E=S*((s.tileID.canonical.x<<x)-r.canonical.x+R),C=S*((s.tileID.canonical.y<<x)-r.canonical.y)):(S=o.aj<<-x,E=o.aj*(s.tileID.canonical.x-(r.canonical.x+R<<-x)),C=o.aj*(s.tileID.canonical.y-(r.canonical.y<<-x))),o.c5(_,0,S,0,S,0,1),o.bo(_,_,[E,C,0])}return new sc(s.tileID,r.key,_)}_findTileCoveringTileID(r,s){let f=s.getTile(r);if(f&&f.hasData())return f;const _=this._findCoveringTileCache[s.id],x=_[r.key];if(f=x?s.getTileByID(x):null,f&&f.hasData()||x===null)return f;let S=f?f.tileID:r,E=S.overscaledZ;const C=s.getSource().minzoom,R=[];if(!x){const j=s.getSource().maxzoom;if(r.canonical.z>=j){const B=r.canonical.z-j;s.getSource().reparseOverscaled?(E=Math.max(r.canonical.z+2,s.transform.tileZoom),S=new o.aM(E,r.wrap,j,r.canonical.x>>B,r.canonical.y>>B)):B!==0&&(E=j,S=new o.aM(E,r.wrap,j,r.canonical.x>>B,r.canonical.y>>B))}S.key!==r.key&&(R.push(S.key),f=s.getTile(S))}const F=j=>{R.forEach(B=>{_[B]=j}),R.length=0};for(E-=1;E>=C&&(!f||!f.hasData());E--){f&&F(f.tileID.key);const j=S.calculateScaledKey(E);if(f=s.getTileByID(j),f&&f.hasData())break;const B=_[j];if(B===null)break;B===void 0?R.push(j):f=s.getTileByID(B)}return F(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,s){let f=this._tilesDirty[r];f||(f=this._tilesDirty[r]={}),f[s.key]=!0}}function Rh(d,r,s){const f=function(E,C,R){const F=o.bE(C,E),j=o.bE(R,[.2126,.7152,.0722]),B=(J,Y,te)=>(1-te)*J+te*Y,G=B(1-.3*Math.min(j,1),1,Math.min(F+1,1));return B(.92,1,Math.asin(o.aD(C[2],-1,1))/Math.PI+.5)*G}(d,[0,0,1],r),_=[0,0,0];o.b$(_,s.slice(0,3),f);const x=[0,0,0];o.b$(x,r.slice(0,3),d[2]);const S=[0,0,0];return o.cU(S,_,x),o.cX(S)}const Od=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Cf=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Lu{static cacheKey(r,s,f,_){let x=`${s}${_?_.cacheKey:""}`;for(const S of f)r.usedDefines.includes(S)&&(x+=`/${S}`);return x}constructor(r,s,f,_,x,S){const E=r.gl;this.program=E.createProgram(),this.configuration=_,this.name=s,this.fixedDefines=[...S];const C=_?_.getBinderAttributes():[],R=(f.staticAttributes||[]).concat(C);let F=_?_.defines():[];F=F.concat(S.map(te=>`#define ${te}`));const j=`#version 300 es
`;let B=j+F.concat("precision mediump float;",Ah,tc.fragmentSource).join(`
`);for(const te of f.fragmentIncludes)B+=`
${rs[te]}`;B+=`
${f.fragmentSource}`;let G=j+F.concat("precision highp float;",Ah,tc.vertexSource).join(`
`);for(const te of f.vertexIncludes)G+=`
${rs[te]}`;this.forceManualRenderingForInstanceIDShaders=r.forceManualRenderingForInstanceIDShaders&&f.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(G+=`
uniform int u_instanceID;
`),G+=`
${f.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(G=G.replaceAll("gl_InstanceID","u_instanceID"));const J=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(J,B),E.compileShader(J),E.attachShader(this.program,J);const Y=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(Y,G),E.compileShader(Y),E.attachShader(this.program,Y),this.attributes={},this.numAttributes=R.length;for(let te=0;te<this.numAttributes;te++)if(R[te]){const K=R[te].startsWith("a_")?R[te]:`a_${R[te]}`;E.bindAttribLocation(this.program,te,K),this.attributes[K]=te}E.linkProgram(this.program),E.deleteShader(Y),E.deleteShader(J),this.fixedUniforms=x(r),this.binderUniforms=_?_.getUniforms(r):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(te=>({u_instanceID:new o.cc(te)}))(r)),(S.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(te=>({u_dem:new o.cc(te),u_dem_prev:new o.cc(te),u_dem_tl:new o.c9(te),u_dem_scale:new o.cb(te),u_dem_tl_prev:new o.c9(te),u_dem_scale_prev:new o.cb(te),u_dem_size:new o.cb(te),u_dem_lerp:new o.cb(te),u_exaggeration:new o.cb(te),u_depth:new o.cc(te),u_depth_size_inv:new o.c9(te),u_depth_range_unpack:new o.c9(te),u_occluder_half_size:new o.cb(te),u_occlusion_depth_offset:new o.cb(te),u_meter_to_dem:new o.cb(te),u_label_plane_matrix_inv:new o.c8(te)}))(r)),S.includes("GLOBE")&&(this.globeUniforms=(te=>({u_tile_tl_up:new o.ca(te),u_tile_tr_up:new o.ca(te),u_tile_br_up:new o.ca(te),u_tile_bl_up:new o.ca(te),u_tile_up_scale:new o.cb(te)}))(r)),S.includes("FOG")&&(this.fogUniforms=(te=>({u_fog_matrix:new o.c8(te),u_fog_range:new o.c9(te),u_fog_color:new o.cQ(te),u_fog_horizon_blend:new o.cb(te),u_fog_vertical_limit:new o.c9(te),u_fog_temporal_offset:new o.cb(te),u_frustum_tl:new o.ca(te),u_frustum_tr:new o.ca(te),u_frustum_br:new o.ca(te),u_frustum_bl:new o.ca(te),u_globe_pos:new o.ca(te),u_globe_radius:new o.cb(te),u_globe_transition:new o.cb(te),u_is_globe:new o.cc(te),u_viewport:new o.c9(te)}))(r)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(te=>({u_cutoff_params:new o.cQ(te)}))(r)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(te=>({u_lighting_ambient_color:new o.ca(te),u_lighting_directional_dir:new o.ca(te),u_lighting_directional_color:new o.ca(te),u_ground_radiance:new o.ca(te)}))(r)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(te=>({u_light_matrix_0:new o.c8(te),u_light_matrix_1:new o.c8(te),u_fade_range:new o.c9(te),u_shadow_normal_offset:new o.ca(te),u_shadow_intensity:new o.cb(te),u_shadow_texel_size:new o.cb(te),u_shadow_map_resolution:new o.cb(te),u_shadow_direction:new o.ca(te),u_shadow_bias:new o.ca(te),u_shadowmap_0:new o.cc(te),u_shadowmap_1:new o.cc(te)}))(r))}}setTerrainUniformValues(r,s){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in s)f[_]&&f[_].set(this.program,_,s[_])}}setGlobeUniformValues(r,s){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in s)f[_]&&f[_].set(this.program,_,s[_])}}setFogUniformValues(r,s){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in s)f[_].set(this.program,_,s[_])}}setCutoffUniformValues(r,s){if(!this.cutoffUniforms)return;const f=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in s)f[_].set(this.program,_,s[_])}}setLightsUniformValues(r,s){if(!this.lightsUniforms)return;const f=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in s)f[_].set(this.program,_,s[_])}}setShadowUniformValues(r,s){if(this.failedToCreate||!this.shadowUniforms)return;const f=this.shadowUniforms;r.program.set(this.program);for(const _ in s)f[_].set(this.program,_,s[_])}_drawDebugWireframe(r,s,f,_,x,S,E,C,R,F){const j=r.options.wireframe;if(j.terrain===!1&&j.layers2D===!1&&j.layers3D===!1)return;const B=r.context;if(!(!(!j.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!j.layers2D||r._terrain&&r._terrain.renderingToTexture||!Od.includes(this.name))||!(!j.layers3D||!Cf.includes(this.name))))return;const G=B.gl,J=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,x,B);if(!J)return;const Y=[...this.fixedDefines];Y.push("DEBUG_WIREFRAME");const te=r.getOrCreateProgram(this.name,{config:this.configuration,defines:Y});B.program.set(te.program);const K=(pe,Ee,Te)=>{if(Ee[pe]&&Te[pe])for(const we in Ee[pe])Te[pe][we]&&Te[pe][we].set(Te.program,we,Ee[pe][we].current)};R&&R.setUniforms(te.program,B,te.binderUniforms,E,{zoom:C}),K("fixedUniforms",this,te),K("terrainUniforms",this,te),K("globeUniforms",this,te),K("fogUniforms",this,te),K("lightsUniforms",this,te),K("shadowUniforms",this,te),J.bind(),B.setColorMode(new Yr([G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ZERO,G.ONE],o.am.transparent,[!0,!0,!0,!1])),B.setDepthMode(new Jt(s.func===G.LESS?G.LEQUAL:s.func,Jt.ReadOnly,s.range)),B.setStencilMode(Tr.disabled);const ce=3*S.primitiveLength*2,fe=3*S.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const pe=F||1;for(let Ee=0;Ee<pe;++Ee)te.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ee),G.drawElements(G.LINES,ce,G.UNSIGNED_SHORT,fe)}else F&&F>1?G.drawElementsInstanced(G.LINES,ce,G.UNSIGNED_SHORT,fe,F):G.drawElements(G.LINES,ce,G.UNSIGNED_SHORT,fe);x.bind(),B.program.set(this.program),B.setDepthMode(s),B.setStencilMode(f),B.setColorMode(_)}checkUniforms(r,s,f){if(this.fixedDefines.includes(s)){for(const _ of Object.keys(f))if(!f[_].initialized)throw new Error(`Program '${this.name}', from draw '${r}': uniform ${_} not set but required by ${s} being defined`)}}draw(r,s,f,_,x,S,E,C,R,F,j,B,G,J,Y,te){const K=r.context,ce=K.gl;if(this.failedToCreate)return;K.program.set(this.program),K.setDepthMode(f),K.setStencilMode(_),K.setColorMode(x),K.setCullFace(S);for(const Ee of Object.keys(this.fixedUniforms))this.fixedUniforms[Ee].set(this.program,Ee,E[Ee]);J&&J.setUniforms(this.program,K,this.binderUniforms,B,{zoom:G});const fe={[ce.POINTS]:1,[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[s];this.checkUniforms(C,"RENDER_SHADOWS",this.shadowUniforms);const pe=te&&te>0?1:void 0;for(const Ee of j.get()){const Te=Ee.vaos||(Ee.vaos={});if((Te[C]||(Te[C]=new Ed)).bind(K,this,R,J?J.getPaintVertexBuffers():[],F,Ee.vertexOffset,Y||[],pe),this.forceManualRenderingForInstanceIDShaders){const we=te||1;for(let ye=0;ye<we;++ye)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ye),F?ce.drawElements(s,Ee.primitiveLength*fe,ce.UNSIGNED_SHORT,Ee.primitiveOffset*fe*2):ce.drawArrays(s,Ee.vertexOffset,Ee.vertexLength)}else te&&te>1?ce.drawElementsInstanced(s,Ee.primitiveLength*fe,ce.UNSIGNED_SHORT,Ee.primitiveOffset*fe*2,te):F?ce.drawElements(s,Ee.primitiveLength*fe,ce.UNSIGNED_SHORT,Ee.primitiveOffset*fe*2):ce.drawArrays(s,Ee.vertexOffset,Ee.vertexLength);s===ce.TRIANGLES&&F&&this._drawDebugWireframe(r,f,_,x,F,Ee,B,G,J,te)}}}function Lh(d,r,s=0){const f=Math.pow(2,r.tileID.overscaledZ),_=r.tileSize*Math.pow(2,d.transform.tileZoom)/f,x=_*(r.tileID.canonical.x+r.tileID.wrap*f),S=_*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.aw(r,1,d.transform.tileZoom),u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S],u_pattern_transition:s}}const os={terrain:0,flat:1},Dd=o.bz(),lc=(d,r,s,f,_,x,S,E,C,R,F,j,B,G,J,Y,te,K)=>{const ce=r.style.light,fe=ce.properties.get("position"),pe=[fe.x,fe.y,fe.z],Ee=o.dx();ce.properties.get("anchor")==="viewport"&&(o.dy(Ee,-r.transform.angle),o.dz(pe,pe,Ee));const Te=ce.properties.get("color"),we=r.transform,ye={u_matrix:d,u_lightpos:pe,u_lightintensity:ce.properties.get("intensity"),u_lightcolor:[Te.r,Te.g,Te.b],u_vertical_gradient:+s,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Dd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:os[R],u_base_type:os[F],u_ao:_,u_edge_radius:x,u_width_scale:S,u_flood_light_color:J,u_vertical_scale:Y,u_flood_light_intensity:te,u_ground_shadow_factor:K};return we.projection.name==="globe"&&(ye.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],ye.u_zoom_transition=j,ye.u_inv_rot_matrix=G,ye.u_merc_center=B,ye.u_up_dir=we.projection.upVector(new o.cp(0,0,0),B[0]*o.aj,B[1]*o.aj),ye.u_height_lift=C),ye},Qm=(d,r,s,f,_,x)=>({u_matrix:d,u_edge_radius:r,u_width_scale:s,u_vertical_scale:f,u_height_type:os[_],u_base_type:os[x]}),n_=(d,r,s,f,_,x,S,E,C,R,F,j,B,G,J,Y,te,K)=>{const ce=lc(d,r,s,f,_,x,S,E,R,F,j,B,G,J,Y,te,1,[0,0,0]),fe={u_height_factor:-Math.pow(2,E.overscaledZ)/C.tileSize/8};return o.l(ce,Lh(r,C,K),fe)},cc=(d,r,s)=>({u_matrix:d,u_emissive_strength:r,u_ground_shadow_factor:s}),zu=(d,r,s,f,_,x=0)=>o.l(cc(d,r,_),Lh(s,f,x)),zh=(d,r,s,f)=>({u_matrix:d,u_world:s,u_emissive_strength:r,u_ground_shadow_factor:f}),Mf=(d,r,s,f,_,x,S=0)=>o.l(zu(d,r,s,f,x,S),{u_world:_}),Fh=(d,r)=>({u_matrix:d,u_ground_shadow_factor:r}),xa=(d,r,s,f,_)=>({u_matrix:d,u_camera_pos:[r[0],r[1],r[2]],u_depth_bias:s,u_height_scale:f,u_reset_depth:_}),as=(d,r,s,f)=>{const _=o.aj/s.tileSize;return{u_matrix:d,u_camera_to_center_distance:r.getCameraToCenterDistance(f),u_extrude_scale:[r.pixelsToGLUnits[0]/_,r.pixelsToGLUnits[1]/_]}},ss=(d,r,s=1)=>({u_matrix:d,u_color:r.toRenderColor(null),u_overlay:0,u_overlay_scale:s}),xl=o.bz(),bl=(d,r,s,f,_,x,S)=>{const E=d.transform,C=E.projection.name==="globe",R=C?o.dA(E.zoom,r.canonical)*E._pixelsPerMercatorPixel:o.aw(s,1,x),F={u_matrix:r.projMatrix,u_extrude_scale:R,u_intensity:S,u_inv_rot_matrix:xl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){F.u_inv_rot_matrix=f,F.u_merc_center=_,F.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],F.u_zoom_transition=o.ah(E.zoom);const j=_[0]*o.aj,B=_[1]*o.aj;F.u_up_dir=E.projection.upVector(new o.cp(0,0,0),j,B)}return F};function uc(d,[r,s,f,_],[x,S]){if(x===S)return[0,0,0,0];const E=255*(d-1)/(d*(S-x));return[r*E,s*E,f*E,_*E]}function kd(d,r,[s,f]){return s===f?0:.5/d+(r-s)*(d-1)/(d*(f-s))}const wl=(d,r,s,f,_,x,S,E,C,R,F,j,B,G,J,Y,te,K,ce,fe,pe)=>({u_matrix:d,u_normalize_matrix:r,u_globe_matrix:s,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:x,u_scale_parent:R,u_fade_t:F.mix,u_opacity:F.opacity*j.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:j.paint.get("raster-brightness-min"),u_brightness_high:j.paint.get("raster-brightness-max"),u_saturation_factor:o.dB(j.paint.get("raster-saturation")),u_contrast_factor:o.dC(j.paint.get("raster-contrast")),u_spin_weights:Of(j.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:G,u_zoom_transition:S,u_merc_center:E,u_cutoff_params:C,u_colorization_mix:uc(o.dD,Y,K),u_colorization_offset:kd(o.dD,te,K),u_color_ramp:J,u_texture_offset:[fe/(ce+2*fe),ce/(ce+2*fe)],u_texture_res:[ce+2*fe,ce+2*fe],u_emissive_strength:pe});function Of(d){d*=Math.PI/180;const r=Math.sin(d),s=Math.cos(d);return[(2*s+1)/3,(-Math.sqrt(3)*r-s+1)/3,(Math.sqrt(3)*r-s+1)/3]}const so=.05,ka=(d,r,s,f,_,x,S,E,C,R,F,j)=>({u_matrix:d,u_normalize_matrix:r,u_globe_matrix:s,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:x,u_scale_parent:R,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:j,u_zoom_transition:S,u_merc_center:E,u_cutoff_params:C}),Qi=(d,r,s,f,_,x,S,E,C,R)=>({u_particle_texture:d,u_particle_texture_side_len:r,u_tile_offset:s,u_velocity:f,u_color_ramp:x,u_velocity_res:_,u_max_speed:S,u_uv_offset:E,u_data_scale:[255*C[0],255*C[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[so,so]}),Es=(d,r,s,f,_,x,S,E,C,R)=>({u_particle_texture:d,u_particle_texture_side_len:r,u_velocity:s,u_velocity_res:f,u_max_speed:_,u_speed_factor:x,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:E,u_data_scale:[255*C[0],255*C[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[so,so]}),Df=o.bz(),Rd=(d,r,s,f,_,x,S,E,C,R,F,j,B,G,J,Y,te,K,ce,fe,pe,Ee,Te)=>{const we=_.transform,ye={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:we.getCameraToCenterDistance(ce),u_rotate_symbol:+s,u_aspect_ratio:we.width/we.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:S,u_coord_matrix:E,u_is_text:+R,u_elevation_from_sea:C?1:0,u_pitch_with_map:+f,u_texsize:F,u_texsize_icon:j,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Df,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Df,u_up_vector:[0,-1,0],u_color_adj_mat:pe,u_icon_transition:Ee||0,u_gamma_scale:f?_.transform.getCameraToCenterDistance(ce)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Te||1,u_ground_shadow_factor:fe,u_inv_matrix:o.bi(o.bz(),S)};return ce.name==="globe"&&(ye.u_tile_id=[G.canonical.x,G.canonical.y,1<<G.canonical.z],ye.u_zoom_transition=J,ye.u_inv_rot_matrix=te,ye.u_merc_center=Y,ye.u_camera_forward=we._camera.forward(),ye.u_ecef_origin=o.dE(we.globeMatrix,G.toUnwrapped()),ye.u_tile_matrix=Float32Array.from(we.globeMatrix),ye.u_up_vector=K),ye},Nh=(d,r,s,f)=>({u_matrix:d,u_emissive_strength:r,u_opacity:s,u_color:f}),kf=(d,r,s,f,_,x,S,E,C)=>o.l(function(R,F,j,B,G,J){const{width:Y,height:te}=B.imageManager.getPixelSize(F),K=Math.pow(2,J.tileID.overscaledZ),ce=J.tileSize*Math.pow(2,B.transform.tileZoom)/K,fe=ce*(J.tileID.canonical.x+J.tileID.wrap*K),pe=ce*J.tileID.canonical.y;return{u_image:0,u_pattern_tl:j.tl,u_pattern_br:j.br,u_texsize:[Y,te],u_pattern_size:j.displaySize,u_pattern_units_to_pixels:G?[B.transform.width,-1*B.transform.height]:[1/o.aw(J,1,B.transform.tileZoom),1/o.aw(J,1,B.transform.tileZoom)],u_pixel_coord_upper:[fe>>16,pe>>16],u_pixel_coord_lower:[65535&fe,65535&pe]}}(0,x,S,f,E,C),{u_matrix:d,u_emissive_strength:r,u_opacity:s}),Ld=new Float32Array(o.bx([])),Sl=(d,r,s,f,_,x,S,E,C,R,F,j,B,G=[0,0,0],J)=>{const Y=_.style.light,te=Y.properties.get("position"),K=[-te.x,-te.y,te.z],ce=o.dx();Y.properties.get("anchor")==="viewport"&&(o.dy(ce,-_.transform.angle),o.dz(K,K,ce));const fe=F.alphaMode==="MASK",pe=Y.properties.get("color").toRenderColor(null),Ee=B.paint.get("model-ambient-occlusion-intensity"),Te=B.paint.get("model-color").constantOr(o.am.white).toRenderColor(null),we=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:r,u_normal_matrix:s,u_node_matrix:f||Ld,u_lightpos:K,u_lightintensity:Y.properties.get("intensity"),u_lightcolor:[pe.r,pe.g,pe.b],u_camera_pos:G,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+fe,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[E[0],E[1],E[2],1],u_metallicFactor:C,u_roughnessFactor:R,u_baseColorTexture:va.BaseColor,u_metallicRoughnessTexture:va.MetallicRoughness,u_normalTexture:va.Normal,u_occlusionTexture:va.Occlusion,u_emissionTexture:va.Emission,u_lutTexture:va.LUT,u_color_mix:[Te.r,Te.g,Te.b,we],u_aoIntensity:Ee,u_emissive_strength:j,u_occlusionTextureTransform:J||[0,0,0,0]}},qp=(d,r=Ld,s=Ld)=>({u_matrix:d,u_instance:r,u_node_matrix:s}),Bh={fillExtrusion:d=>({u_matrix:new o.c8(d),u_lightpos:new o.ca(d),u_lightintensity:new o.cb(d),u_lightcolor:new o.ca(d),u_vertical_gradient:new o.cb(d),u_opacity:new o.cb(d),u_edge_radius:new o.cb(d),u_width_scale:new o.cb(d),u_ao:new o.c9(d),u_height_type:new o.cc(d),u_base_type:new o.cc(d),u_tile_id:new o.ca(d),u_zoom_transition:new o.cb(d),u_inv_rot_matrix:new o.c8(d),u_merc_center:new o.c9(d),u_up_dir:new o.ca(d),u_height_lift:new o.cb(d),u_flood_light_color:new o.ca(d),u_vertical_scale:new o.cb(d),u_flood_light_intensity:new o.cb(d),u_ground_shadow_factor:new o.ca(d)}),fillExtrusionDepth:d=>({u_matrix:new o.c8(d),u_edge_radius:new o.cb(d),u_width_scale:new o.cb(d),u_vertical_scale:new o.cb(d),u_height_type:new o.cc(d),u_base_type:new o.cc(d)}),fillExtrusionPattern:d=>({u_matrix:new o.c8(d),u_lightpos:new o.ca(d),u_lightintensity:new o.cb(d),u_lightcolor:new o.ca(d),u_vertical_gradient:new o.cb(d),u_height_factor:new o.cb(d),u_edge_radius:new o.cb(d),u_width_scale:new o.cb(d),u_ao:new o.c9(d),u_height_type:new o.cc(d),u_base_type:new o.cc(d),u_tile_id:new o.ca(d),u_zoom_transition:new o.cb(d),u_inv_rot_matrix:new o.c8(d),u_merc_center:new o.c9(d),u_up_dir:new o.ca(d),u_height_lift:new o.cb(d),u_image:new o.cc(d),u_texsize:new o.c9(d),u_pixel_coord_upper:new o.c9(d),u_pixel_coord_lower:new o.c9(d),u_tile_units_to_pixels:new o.cb(d),u_opacity:new o.cb(d),u_pattern_transition:new o.cb(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new o.c8(d),u_opacity:new o.cb(d),u_ao_pass:new o.cb(d),u_meter_to_tile:new o.cb(d),u_ao:new o.c9(d),u_flood_light_intensity:new o.cb(d),u_flood_light_color:new o.ca(d),u_attenuation:new o.cb(d),u_edge_radius:new o.cb(d),u_fb:new o.cc(d),u_fb_size:new o.cb(d),u_dynamic_offset:new o.cb(d)}),fill:d=>({u_matrix:new o.c8(d),u_emissive_strength:new o.cb(d),u_ground_shadow_factor:new o.ca(d)}),fillPattern:d=>({u_matrix:new o.c8(d),u_emissive_strength:new o.cb(d),u_image:new o.cc(d),u_texsize:new o.c9(d),u_pixel_coord_upper:new o.c9(d),u_pixel_coord_lower:new o.c9(d),u_tile_units_to_pixels:new o.cb(d),u_ground_shadow_factor:new o.ca(d),u_pattern_transition:new o.cb(d)}),fillOutline:d=>({u_matrix:new o.c8(d),u_emissive_strength:new o.cb(d),u_world:new o.c9(d),u_ground_shadow_factor:new o.ca(d)}),fillOutlinePattern:d=>({u_matrix:new o.c8(d),u_emissive_strength:new o.cb(d),u_world:new o.c9(d),u_image:new o.cc(d),u_texsize:new o.c9(d),u_pixel_coord_upper:new o.c9(d),u_pixel_coord_lower:new o.c9(d),u_tile_units_to_pixels:new o.cb(d),u_ground_shadow_factor:new o.ca(d),u_pattern_transition:new o.cb(d)}),building:d=>({u_matrix:new o.c8(d),u_normal_matrix:new o.c8(d),u_opacity:new o.cb(d)}),buildingDepth:d=>({u_matrix:new o.c8(d)}),elevatedStructuresDepth:d=>({u_matrix:new o.c8(d),u_depth_bias:new o.cb(d)}),elevatedStructures:d=>({u_matrix:new o.c8(d),u_ground_shadow_factor:new o.ca(d)}),elevatedStructuresDepthReconstruct:d=>({u_matrix:new o.c8(d),u_camera_pos:new o.ca(d),u_depth_bias:new o.cb(d),u_height_scale:new o.cb(d),u_reset_depth:new o.cb(d)}),circle:o.dF,collisionBox:d=>({u_matrix:new o.c8(d),u_camera_to_center_distance:new o.cb(d),u_extrude_scale:new o.c9(d)}),collisionCircle:d=>({u_matrix:new o.c8(d),u_inv_matrix:new o.c8(d),u_camera_to_center_distance:new o.cb(d),u_viewport_size:new o.c9(d)}),debug:d=>({u_color:new o.di(d),u_matrix:new o.c8(d),u_overlay:new o.cc(d),u_overlay_scale:new o.cb(d)}),clippingMask:d=>({u_matrix:new o.c8(d)}),heatmap:d=>({u_extrude_scale:new o.cb(d),u_intensity:new o.cb(d),u_matrix:new o.c8(d),u_inv_rot_matrix:new o.c8(d),u_merc_center:new o.c9(d),u_tile_id:new o.ca(d),u_zoom_transition:new o.cb(d),u_up_dir:new o.ca(d)}),heatmapTexture:d=>({u_image:new o.cc(d),u_color_ramp:new o.cc(d),u_opacity:new o.cb(d)}),hillshade:d=>({u_matrix:new o.c8(d),u_image:new o.cc(d),u_latrange:new o.c9(d),u_light:new o.c9(d),u_shadow:new o.di(d),u_highlight:new o.di(d),u_emissive_strength:new o.cb(d),u_accent:new o.di(d)}),hillshadePrepare:d=>({u_matrix:new o.c8(d),u_image:new o.cc(d),u_dimension:new o.c9(d),u_zoom:new o.cb(d)}),line:o.dG,linePattern:o.dH,raster:d=>({u_matrix:new o.c8(d),u_normalize_matrix:new o.c8(d),u_globe_matrix:new o.c8(d),u_merc_matrix:new o.c8(d),u_grid_matrix:new o.dj(d),u_tl_parent:new o.c9(d),u_scale_parent:new o.cb(d),u_fade_t:new o.cb(d),u_opacity:new o.cb(d),u_image0:new o.cc(d),u_image1:new o.cc(d),u_brightness_low:new o.cb(d),u_brightness_high:new o.cb(d),u_saturation_factor:new o.cb(d),u_contrast_factor:new o.cb(d),u_spin_weights:new o.ca(d),u_perspective_transform:new o.c9(d),u_raster_elevation:new o.cb(d),u_zoom_transition:new o.cb(d),u_merc_center:new o.c9(d),u_cutoff_params:new o.cQ(d),u_colorization_mix:new o.cQ(d),u_colorization_offset:new o.cb(d),u_color_ramp:new o.cc(d),u_texture_offset:new o.c9(d),u_texture_res:new o.c9(d),u_emissive_strength:new o.cb(d)}),rasterParticle:d=>({u_matrix:new o.c8(d),u_normalize_matrix:new o.c8(d),u_globe_matrix:new o.c8(d),u_merc_matrix:new o.c8(d),u_grid_matrix:new o.dj(d),u_tl_parent:new o.c9(d),u_scale_parent:new o.cb(d),u_fade_t:new o.cb(d),u_opacity:new o.cb(d),u_image0:new o.cc(d),u_image1:new o.cc(d),u_raster_elevation:new o.cb(d),u_zoom_transition:new o.cb(d),u_merc_center:new o.c9(d),u_cutoff_params:new o.cQ(d)}),rasterParticleTexture:d=>({u_texture:new o.cc(d),u_opacity:new o.cb(d)}),rasterParticleDraw:d=>({u_particle_texture:new o.cc(d),u_particle_texture_side_len:new o.cb(d),u_tile_offset:new o.c9(d),u_velocity:new o.cc(d),u_color_ramp:new o.cc(d),u_velocity_res:new o.c9(d),u_max_speed:new o.cb(d),u_uv_offset:new o.c9(d),u_data_scale:new o.c9(d),u_data_offset:new o.cb(d),u_particle_pos_scale:new o.cb(d),u_particle_pos_offset:new o.c9(d)}),rasterParticleUpdate:d=>({u_particle_texture:new o.cc(d),u_particle_texture_side_len:new o.cb(d),u_velocity:new o.cc(d),u_velocity_res:new o.c9(d),u_max_speed:new o.cb(d),u_speed_factor:new o.cb(d),u_reset_rate:new o.cb(d),u_rand_seed:new o.cb(d),u_uv_offset:new o.c9(d),u_data_scale:new o.c9(d),u_data_offset:new o.cb(d),u_particle_pos_scale:new o.cb(d),u_particle_pos_offset:new o.c9(d)}),symbol:d=>({u_is_size_zoom_constant:new o.cc(d),u_is_size_feature_constant:new o.cc(d),u_size_t:new o.cb(d),u_size:new o.cb(d),u_camera_to_center_distance:new o.cb(d),u_rotate_symbol:new o.cc(d),u_aspect_ratio:new o.cb(d),u_fade_change:new o.cb(d),u_matrix:new o.c8(d),u_label_plane_matrix:new o.c8(d),u_coord_matrix:new o.c8(d),u_is_text:new o.cc(d),u_elevation_from_sea:new o.cc(d),u_pitch_with_map:new o.cc(d),u_texsize:new o.c9(d),u_texsize_icon:new o.c9(d),u_texture:new o.cc(d),u_texture_icon:new o.cc(d),u_gamma_scale:new o.cb(d),u_device_pixel_ratio:new o.cb(d),u_tile_id:new o.ca(d),u_zoom_transition:new o.cb(d),u_inv_rot_matrix:new o.c8(d),u_merc_center:new o.c9(d),u_camera_forward:new o.ca(d),u_tile_matrix:new o.c8(d),u_up_vector:new o.ca(d),u_ecef_origin:new o.ca(d),u_is_halo:new o.cc(d),u_icon_transition:new o.cb(d),u_color_adj_mat:new o.c8(d),u_scale_factor:new o.cb(d),u_ground_shadow_factor:new o.ca(d),u_inv_matrix:new o.c8(d)}),background:d=>({u_matrix:new o.c8(d),u_emissive_strength:new o.cb(d),u_opacity:new o.cb(d),u_color:new o.di(d)}),backgroundPattern:d=>({u_matrix:new o.c8(d),u_emissive_strength:new o.cb(d),u_opacity:new o.cb(d),u_image:new o.cc(d),u_pattern_tl:new o.c9(d),u_pattern_br:new o.c9(d),u_texsize:new o.c9(d),u_pattern_size:new o.c9(d),u_pixel_coord_upper:new o.c9(d),u_pixel_coord_lower:new o.c9(d),u_pattern_units_to_pixels:new o.c9(d)}),terrainRaster:d=>({u_matrix:new o.c8(d),u_image0:new o.cc(d),u_skirt_height:new o.cb(d),u_ground_shadow_factor:new o.ca(d)}),skybox:d=>({u_matrix:new o.c8(d),u_sun_direction:new o.ca(d),u_cubemap:new o.cc(d),u_opacity:new o.cb(d),u_temporal_offset:new o.cb(d)}),skyboxGradient:d=>({u_matrix:new o.c8(d),u_color_ramp:new o.cc(d),u_center_direction:new o.ca(d),u_radius:new o.cb(d),u_opacity:new o.cb(d),u_temporal_offset:new o.cb(d)}),skyboxCapture:d=>({u_matrix_3f:new o.dj(d),u_sun_direction:new o.ca(d),u_sun_intensity:new o.cb(d),u_color_tint_r:new o.cQ(d),u_color_tint_m:new o.cQ(d),u_luminance:new o.cb(d)}),globeRaster:d=>({u_proj_matrix:new o.c8(d),u_globe_matrix:new o.c8(d),u_normalize_matrix:new o.c8(d),u_merc_matrix:new o.c8(d),u_zoom_transition:new o.cb(d),u_merc_center:new o.c9(d),u_image0:new o.cc(d),u_grid_matrix:new o.dj(d),u_skirt_height:new o.cb(d),u_far_z_cutoff:new o.cb(d),u_frustum_tl:new o.ca(d),u_frustum_tr:new o.ca(d),u_frustum_br:new o.ca(d),u_frustum_bl:new o.ca(d),u_globe_pos:new o.ca(d),u_globe_radius:new o.cb(d),u_viewport:new o.c9(d)}),globeAtmosphere:d=>({u_frustum_tl:new o.ca(d),u_frustum_tr:new o.ca(d),u_frustum_br:new o.ca(d),u_frustum_bl:new o.ca(d),u_horizon:new o.cb(d),u_transition:new o.cb(d),u_fadeout_range:new o.cb(d),u_color:new o.cQ(d),u_high_color:new o.cQ(d),u_space_color:new o.cQ(d),u_temporal_offset:new o.cb(d),u_horizon_angle:new o.cb(d)}),model:d=>({u_matrix:new o.c8(d),u_lighting_matrix:new o.c8(d),u_normal_matrix:new o.c8(d),u_node_matrix:new o.c8(d),u_lightpos:new o.ca(d),u_lightintensity:new o.cb(d),u_lightcolor:new o.ca(d),u_camera_pos:new o.ca(d),u_opacity:new o.cb(d),u_baseColorFactor:new o.cQ(d),u_emissiveFactor:new o.cQ(d),u_metallicFactor:new o.cb(d),u_roughnessFactor:new o.cb(d),u_baseTextureIsAlpha:new o.cc(d),u_alphaMask:new o.cc(d),u_alphaCutoff:new o.cb(d),u_baseColorTexture:new o.cc(d),u_metallicRoughnessTexture:new o.cc(d),u_normalTexture:new o.cc(d),u_occlusionTexture:new o.cc(d),u_emissionTexture:new o.cc(d),u_lutTexture:new o.cc(d),u_color_mix:new o.cQ(d),u_aoIntensity:new o.cb(d),u_emissive_strength:new o.cb(d),u_occlusionTextureTransform:new o.cQ(d)}),modelDepth:d=>({u_matrix:new o.c8(d),u_instance:new o.c8(d),u_node_matrix:new o.c8(d)}),groundShadow:d=>({u_matrix:new o.c8(d),u_ground_shadow_factor:new o.ca(d)}),stars:d=>({u_matrix:new o.c8(d),u_up:new o.ca(d),u_right:new o.ca(d),u_intensity_multiplier:new o.cb(d)}),snowParticle:d=>({u_modelview:new o.c8(d),u_projection:new o.c8(d),u_time:new o.cb(d),u_cam_pos:new o.ca(d),u_velocityConeAperture:new o.cb(d),u_velocity:new o.cb(d),u_horizontalOscillationRadius:new o.cb(d),u_horizontalOscillationRate:new o.cb(d),u_boxSize:new o.cb(d),u_billboardSize:new o.cb(d),u_simpleShapeParameters:new o.c9(d),u_screenSize:new o.c9(d),u_thinningCenterPos:new o.c9(d),u_thinningShape:new o.ca(d),u_thinningAffectedRatio:new o.cb(d),u_thinningParticleOffset:new o.cb(d),u_particleColor:new o.cQ(d),u_direction:new o.ca(d)}),rainParticle:d=>({u_modelview:new o.c8(d),u_projection:new o.c8(d),u_time:new o.cb(d),u_cam_pos:new o.ca(d),u_texScreen:new o.cc(d),u_velocityConeAperture:new o.cb(d),u_velocity:new o.cb(d),u_boxSize:new o.cb(d),u_rainDropletSize:new o.c9(d),u_distortionStrength:new o.cb(d),u_rainDirection:new o.ca(d),u_color:new o.cQ(d),u_screenSize:new o.c9(d),u_thinningCenterPos:new o.c9(d),u_thinningShape:new o.ca(d),u_thinningAffectedRatio:new o.cb(d),u_thinningParticleOffset:new o.cb(d),u_shapeDirectionalPower:new o.cb(d),u_shapeNormalPower:new o.cb(d),u_mode:new o.cb(d)}),vignette:d=>({u_vignetteShape:new o.ca(d),u_vignetteColor:new o.cQ(d)}),occlusion:d=>({u_matrix:new o.c8(d),u_anchorPos:new o.ca(d),u_screenSizePx:new o.c9(d),u_occluderSizePx:new o.c9(d),u_color:new o.cQ(d)})};class Hs{constructor(r,s,f,_){this.id=Hs.uniqueIdxCounter,Hs.uniqueIdxCounter++,this.context=r;const x=r.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||_||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=Hs.uniqueIdxCounter,Hs.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Hs.uniqueIdxCounter=0;const i_={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fu{constructor(r,s,f,_,x,S){this.length=s.length,this.attributes=f,this.itemSize=s.bytesPerElement,this.dynamicDraw=_,this.instanceCount=S,this.context=r;const E=r.gl;this.buffer=E.createBuffer(),r.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||x||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,s){for(let f=0;f<this.attributes.length;f++){const _=s.attributes[this.attributes[f].name];_!==void 0&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,s,f){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],S=s.attributes[x.name];S!==void 0&&r.vertexAttribPointer(S,x.components,r[i_[x.type]],!1,this.itemSize,x.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(r,s,f){for(let _=0;_<this.attributes.length;_++){const x=s.attributes[this.attributes[_].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(x,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Nu{constructor(r,s,f,_,x){this.context=r,this.width=s,this.height=f;const S=this.framebuffer=r.gl.createFramebuffer();_&&(this.colorAttachment=new r_(r,S)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new Pf(r,S):new ac(r,S))}destroy(){const r=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&r.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&r.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&r.deleteTexture(s)}r.deleteFramebuffer(this.framebuffer)}}class Bu{constructor(r,s){this.gl=r,this.clearColor=new Jm(this),this.clearDepth=new ao(this),this.clearStencil=new Fp(this),this.colorMask=new Ad(this),this.depthMask=new Id(this),this.stencilMask=new Pd(this),this.stencilFunc=new Np(this),this.stencilOp=new Ih(this),this.stencilTest=new Ph(this),this.depthRange=new rc(this),this.depthTest=new Af(this),this.depthFunc=new Ou(this),this.blend=new Bp(this),this.blendFunc=new jp(this),this.blendColor=new nc(this),this.blendEquation=new Uc(this),this.cullFace=new Ch(this),this.cullFaceSide=new Mh(this),this.frontFace=new Vc(this),this.program=new Oh(this),this.activeTexture=new Up(this),this.viewport=new Vp(this),this.bindFramebuffer=new $p(this),this.bindRenderbuffer=new If(this),this.bindTexture=new Du(this),this.bindVertexBuffer=new ic(this),this.bindElementBuffer=new Gp(this),this.bindVertexArrayOES=new ku(this),this.pixelStoreUnpack=new Da(this),this.pixelStoreUnpackPremultiplyAlpha=new Dh(this),this.pixelStoreUnpackFlipY=new oc(this),this.options=s?Object.assign({},s):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=s&&!!s.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,s,f){return new Hs(this,r,s,f)}createVertexBuffer(r,s,f,_,x){return new Fu(this,r,s,f,_,x)}createRenderbuffer(r,s,f){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,r,s,f),this.bindRenderbuffer.set(null),x}createFramebuffer(r,s,f,_){return new Nu(this,r,s,f,_)}clear({color:r,depth:s,stencil:f,colorMask:_}){const x=this.gl;let S=0;r&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set(_||[!0,!0,!0,!0])),s!==void 0&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),f!==void 0&&(S|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),x.clear(S)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){o.bv(r.blendFunction,Yr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Gc;function Zs(d,r,s,f,_,x,S){const E=d.context,C=E.gl,R=d.transform,F=d.getOrCreateProgram("collisionBox"),j=[];let B=0,G=0;for(let pe=0;pe<f.length;pe++){const Ee=f[pe],Te=r.getTile(Ee),we=Te.getBucket(s);if(!we)continue;const ye=vh(Ee,we,R);let Ie=ye;_[0]===0&&_[1]===0||(Ie=d.translatePosMatrix(ye,Te,_,x));const Oe=S?we.textCollisionBox:we.iconCollisionBox,Xe=we.collisionCircleArray;if(Xe.length>0){const je=o.bz(),st=Ie;o.cB(je,we.placementInvProjMatrix,R.glCoordMatrix),o.cB(je,je,we.placementViewportMatrix),j.push({circleArray:Xe,circleOffset:G,transform:st,invTransform:je,projection:we.getProjection()}),B+=Xe.length/4,G=B}Oe&&(d.terrain&&d.terrain.setupElevationDraw(Te,F),F.draw(d,C.LINES,Jt.disabled,Tr.disabled,d.colorModeForRenderPass(),Pr.disabled,as(Ie,R,Te,we.getProjection()),s.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,null,R.zoom,null,[Oe.collisionVertexBuffer,Oe.collisionVertexBufferExt]))}if(!S||!j.length)return;const J=d.getOrCreateProgram("collisionCircle"),Y=new o.dI;Y.resize(4*B),Y._trim();let te=0;for(const pe of j)for(let Ee=0;Ee<pe.circleArray.length/4;Ee++){const Te=4*Ee,we=pe.circleArray[Te+0],ye=pe.circleArray[Te+1],Ie=pe.circleArray[Te+2],Oe=pe.circleArray[Te+3];Y.emplace(te++,we,ye,Ie,Oe,0),Y.emplace(te++,we,ye,Ie,Oe,1),Y.emplace(te++,we,ye,Ie,Oe,2),Y.emplace(te++,we,ye,Ie,Oe,3)}(!Gc||Gc.length<2*B)&&(Gc=function(pe){const Ee=2*pe,Te=new o.a_;Te.resize(Ee),Te._trim();for(let we=0;we<Ee;we++){const ye=6*we;Te.uint16[ye+0]=4*we+0,Te.uint16[ye+1]=4*we+1,Te.uint16[ye+2]=4*we+2,Te.uint16[ye+3]=4*we+2,Te.uint16[ye+4]=4*we+3,Te.uint16[ye+5]=4*we+0}return Te}(B));const K=E.createIndexBuffer(Gc,!0),ce=E.createVertexBuffer(Y,o.dJ.members,!0);for(const pe of j){const Ee={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(fe=R).getCameraToCenterDistance(pe.projection),u_viewport_size:[fe.width,fe.height]};J.draw(d,C.TRIANGLES,Jt.disabled,Tr.disabled,d.colorModeForRenderPass(),Pr.disabled,Ee,s.id,ce,K,o.bd.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,R.zoom)}var fe;ce.destroy(),K.destroy()}const jh=o.bz();function qc(d){const r=d._camera.getWorldToCamera(d.worldSize,1),s=o.az([],r,d.globeMatrix);o.bi(s,s);const f=[0,0,0],_=[0,1,0,0];return o.aA(_,_,s),f[0]=_[0],f[1]=_[1],f[2]=_[2],o.au(f,f),f}function ju({width:d,height:r,anchor:s,textOffset:f,textScale:_},x){const{horizontalAlign:S,verticalAlign:E}=o.bV(s),C=-(S-.5)*d,R=-(E-.5)*r,F=o.bU(s,f);return new o.P((C/_+F[0])*x,(R/_+F[1])*x)}function Wc(d,r,s,f,_,x,S,E,C,R){const F=d.text.placedSymbolArray,j=d.text.dynamicLayoutVertexArray,B=d.icon.dynamicLayoutVertexArray,G={},J=d.getProjection(),Y=Tu(S,J,_),te=_.elevation,K=J.upVectorScale(S.canonical,_.center.lat,_.worldSize).metersToTile;j.clear();for(let ce=0;ce<F.length;ce++){const fe=F.get(ce),{tileAnchorX:pe,tileAnchorY:Ee,numGlyphs:Te}=fe,we=fe.hidden||!fe.crossTileID||d.allowVerticalPlacement&&!fe.placedOrientation?null:f[fe.crossTileID];if(we){let ye=0,Ie=0,Oe=0;if(te){const ft=te?te.getAtTileOffset(S,pe,Ee):0,[Ke,gt,dt]=J.upVector(S.canonical,pe,Ee);ye=ft*Ke*K,Ie=ft*gt*K,Oe=ft*dt*K}let[Xe,je,st,ct]=aa(fe.projectedAnchorX+ye,fe.projectedAnchorY+Ie,fe.projectedAnchorZ+Oe,s?Y:x);const Et=fl(_.getCameraToCenterDistance(J),ct);let Ve=o.bJ(d.textSizeData,C,fe)*Et/o.bO;s&&(Ve*=d.tilePixelRatio/E);const He=ju(we,Ve);s?({x:Xe,y:je,z:st}=J.projectTilePoint(pe+He.x,Ee+He.y,S.canonical),[Xe,je,st]=aa(Xe+ye,je+Ie,st+Oe,x)):(r&&He._rotate(-_.angle),Xe+=He.x,je+=He.y,st=0);const Ue=d.allowVerticalPlacement&&fe.placedOrientation===o.bI.vertical?Math.PI/2:0;for(let ft=0;ft<Te;ft++)o.bL(j,Xe,je,st,Ue);R&&fe.associatedIconIndex>=0&&(G[fe.associatedIconIndex]={x:Xe,y:je,z:st,angle:Ue})}else dn(Te,j)}if(R){B.clear();const ce=d.icon.placedSymbolArray;for(let fe=0;fe<ce.length;fe++){const pe=ce.get(fe),{numGlyphs:Ee}=pe,Te=G[fe];if(pe.hidden||!Te)dn(Ee,B);else{const{x:we,y:ye,z:Ie,angle:Oe}=Te;for(let Xe=0;Xe<Ee;Xe++)o.bL(B,we,ye,Ie,Oe)}}d.icon.dynamicLayoutVertexBuffer.updateData(B)}d.text.dynamicLayoutVertexBuffer.updateData(j)}function Uh(d,r,s,f,_,x,S={}){const E=s.paint.get("icon-translate"),C=s.paint.get("text-translate"),R=s.paint.get("icon-translate-anchor"),F=s.paint.get("text-translate-anchor"),j=s.layout.get("icon-rotation-alignment"),B=s.layout.get("text-rotation-alignment"),G=s.layout.get("icon-pitch-alignment"),J=s.layout.get("text-pitch-alignment"),Y=s.layout.get("icon-keep-upright"),te=s.layout.get("text-keep-upright"),K=s.paint.get("icon-color-saturation"),ce=s.paint.get("icon-color-contrast"),fe=s.paint.get("icon-color-brightness-min"),pe=s.paint.get("icon-color-brightness-max"),Ee=s.layout.get("symbol-elevation-reference")==="sea",Te=d.context,we=Te.gl,ye=d.transform,Ie=j==="map",Oe=B==="map",Xe=G==="map",je=J==="map",st=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ct=!1;const Et=d.depthModeForSublayer(0,Jt.ReadOnly),Ve=new Jt(d.context.gl.LEQUAL,Jt.ReadOnly,d.depthRangeFor3D),He=[o.ay(ye.center.lng),o.aH(ye.center.lat)],Ue=s.layout.get("text-variable-anchor"),ft=ye.projection.name==="globe",Ke=[],gt=[0,-1,0];for(const dt of f){const vt=r.getTile(dt),bt=vt.getBucket(s);if(!bt||bt.projection.name==="mercator"&&ft||bt.fullyClipped)continue;const Yt=bt.projection.name==="globe",tr=Yt?o.ah(ye.zoom):0,Bt=Tu(dt,bt.getProjection(),ye),er=ye.calculatePixelsToTileUnitsMatrix(vt),Wt=Ue&&bt.hasTextData(),hr=bt.hasIconTextFit()&&Wt&&bt.hasIconData(),Or=bt.elevationType==="road"?Ve:Et,rn=bt.getProjection().createInversionMatrix(ye,dt.canonical),Gn=d.shadowRenderer,qn=bt.elevationType==="road"&&!!Gn&&Gn.enabled;let Hr=[0,0,0];if(qn){const Ti=d.style.directionalLight,Zr=d.style.ambientLight;Ti&&Zr&&(Hr=bs(d.style,Ti,Zr))}const Li=Ti=>{ye.depthOcclusionForSymbolsAndCircles&&(s.hasInitialOcclusionOpacityProperties||d.terrain)&&(Ti.push("DEPTH_D24"),Ti.push("DEPTH_OCCLUSION"))},_i=()=>{const Ti=Ie&&s.layout.get("symbol-placement")!=="point",Zr=[];Li(Zr);const di=Ti||hr,In=s.paint.get("icon-image-cross-fade");d.terrainRenderModeElevated()&&Xe&&Zr.push("PITCH_WITH_MAP_TERRAIN"),Yt&&(Zr.push("PROJECTION_GLOBE_VIEW"),di&&Zr.push("PROJECTED_POS_ON_VIEWPORT")),In>0&&Zr.push("ICON_TRANSITION"),bt.icon.zOffsetVertexBuffer&&Zr.push("Z_OFFSET"),K===0&&ce===0&&fe===0&&pe===1||Zr.push("COLOR_ADJUSTMENT"),bt.sdfIcons&&Zr.push("RENDER_SDF"),qn&&Zr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Yn=bt.icon.programConfigurations.get(s.id),Fn=d.getOrCreateProgram("symbol",{config:Yn,defines:Zr}),ri=vt.imageAtlasTexture?vt.imageAtlasTexture.size:[0,0],To=bt.iconSizeData,fn=o.bH(To,ye.zoom),jo=Xe||ye.pitch!==0,Zi=ph(Bt,vt.tileID.canonical,Xe,Ie,ye,bt.getProjection(),er),Qo=md(Bt,vt.tileID.canonical,Xe,Ie,ye,bt.getProjection(),er),Qs=d.translatePosMatrix(Qo,vt,E,R,!0),Rl=d.translatePosMatrix(Bt,vt,E,R),za=di?jh:Zi,Os=Ie&&!Xe&&!Ti;let Mo=gt;!ft&&!ye.mercatorFromTransition||Ie||(Mo=qc(ye));const Ds=Yt?Mo:gt,el=s.getColorAdjustmentMatrix(K,ce,fe,pe),ds=Rd(To.kind,fn,Os,Xe,d,Rl,za,Qs,Ee,!1,ri,[0,0],!0,dt,tr,He,rn,Ds,bt.getProjection(),Hr,el,In),Ll=vt.imageAtlasTexture?vt.imageAtlasTexture:null,zl=s.layout.get("icon-size").constantOr(0)!==1||bt.iconsNeedLinear,Yu=bt.sdfIcons||d.options.rotating||d.options.zooming||zl||jo?we.LINEAR:we.NEAREST,Jh=bt.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,Ku=d.terrain&&Xe&&Ti?o.bi(o.bz(),Zi):jh;if(Ti&&bt.icon){const yi=ye.elevation,nu=yi?yi.getAtTileOffsetFunc(dt,ye.center.lat,ye.worldSize,bt.getProjection()):null,im=xf(Bt,vt.tileID.canonical,Xe,Ie,ye,bt.getProjection(),er);pl(bt,Bt,d,!1,im,Qo,Xe,Y,nu,dt)}return{program:Fn,buffers:bt.icon,uniformValues:ds,atlasTexture:Ll,atlasTextureIcon:null,atlasInterpolation:Yu,atlasInterpolationIcon:null,isSDF:bt.sdfIcons,hasHalo:Jh,depthMode:Or,tile:vt,renderWithShadows:qn,labelPlaneMatrixInv:Ku}},Rr=()=>{const Ti=Oe&&s.layout.get("symbol-placement")!=="point",Zr=[],di=Ti||Ue||hr;d.terrainRenderModeElevated()&&je&&Zr.push("PITCH_WITH_MAP_TERRAIN"),Yt&&(Zr.push("PROJECTION_GLOBE_VIEW"),di&&Zr.push("PROJECTED_POS_ON_VIEWPORT")),bt.text.zOffsetVertexBuffer&&Zr.push("Z_OFFSET"),bt.iconsInText&&Zr.push("RENDER_TEXT_AND_SYMBOL"),Zr.push("RENDER_SDF"),qn&&Zr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Li(Zr);const In=bt.text.programConfigurations.get(s.id),Yn=d.getOrCreateProgram("symbol",{config:In,defines:Zr});let Fn,ri=[0,0],To=null;const fn=bt.textSizeData;bt.iconsInText&&(ri=vt.imageAtlasTexture?vt.imageAtlasTexture.size:[0,0],To=vt.imageAtlasTexture?vt.imageAtlasTexture:null,Fn=je||ye.pitch!==0||d.options.rotating||d.options.zooming||fn.kind==="composite"||fn.kind==="camera"?we.LINEAR:we.NEAREST);const jo=vt.glyphAtlasTexture?vt.glyphAtlasTexture.size:[0,0],Zi=s.layout.get("text-size-scale-range"),Qo=o.aD(d.scaleFactor,Zi[0],Zi[1]),Qs=o.bH(fn,ye.zoom,Qo),Rl=ph(Bt,vt.tileID.canonical,je,Oe,ye,bt.getProjection(),er),za=md(Bt,vt.tileID.canonical,je,Oe,ye,bt.getProjection(),er),Os=d.translatePosMatrix(za,vt,C,F,!0),Mo=d.translatePosMatrix(Bt,vt,C,F),Ds=di?jh:Rl,el=Oe&&!je&&!Ti;let ds=gt;!ft&&!ye.mercatorFromTransition||Oe||(ds=qc(ye));const Ll=Rd(fn.kind,Qs,el,je,d,Mo,Ds,Os,Ee,!0,jo,ri,!0,dt,tr,He,rn,Yt?ds:gt,bt.getProjection(),Hr,null,null,Qo),zl=vt.glyphAtlasTexture?vt.glyphAtlasTexture:null,Yu=we.LINEAR,Jh=s.paint.get("text-halo-width").constantOr(1)!==0,Ku=d.terrain&&je&&Ti?o.bi(o.bz(),Rl):jh;if(Ti&&bt.text){const yi=ye.elevation,nu=yi?yi.getAtTileOffsetFunc(dt,ye.center.lat,ye.worldSize,bt.getProjection()):null,im=xf(Bt,vt.tileID.canonical,je,Oe,ye,bt.getProjection(),er);pl(bt,Bt,d,!0,im,za,je,te,nu,dt)}return{program:Yn,buffers:bt.text,uniformValues:Ll,atlasTexture:zl,atlasTextureIcon:To,atlasInterpolation:Yu,atlasInterpolationIcon:Fn,isSDF:!0,hasHalo:Jh,depthMode:Or,tile:vt,renderWithShadows:qn,labelPlaneMatrixInv:Ku}},_n=bt.icon.segments.get().length,yn=bt.text.segments.get().length,Wn=_n&&!S.onlyText?_i():null,no=yn&&!S.onlyIcons?Rr():null,zi=s.paint.get("icon-opacity").constantOr(1),Gi=s.paint.get("text-opacity").constantOr(1);if(st&&bt.canOverlap){ct=!0;const Ti=zi&&!S.onlyText?bt.icon.segments.get():[],Zr=Gi&&!S.onlyIcons?bt.text.segments.get():[];for(const di of Ti)Ke.push({segments:new o.bd([di]),sortKey:di.sortKey,state:Wn});for(const di of Zr)Ke.push({segments:new o.bd([di]),sortKey:di.sortKey,state:no})}else S.onlyText||Ke.push({segments:zi?bt.icon.segments:new o.bd([]),sortKey:0,state:Wn}),S.onlyIcons||Ke.push({segments:Gi?bt.text.segments:new o.bd([]),sortKey:0,state:no})}ct&&Ke.sort((dt,vt)=>dt.sortKey-vt.sortKey);for(const dt of Ke){const vt=dt.state;if(vt)if(d.terrain?d.terrain.setupElevationDraw(vt.tile,vt.program,{useDepthForOcclusion:ye.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:vt.labelPlaneMatrixInv}):d.setupDepthForOcclusion(ye.depthOcclusionForSymbolsAndCircles,vt.program),Te.activeTexture.set(we.TEXTURE0),vt.atlasTexture&&vt.atlasTexture.bind(vt.atlasInterpolation,we.CLAMP_TO_EDGE,!0),vt.atlasTextureIcon&&(Te.activeTexture.set(we.TEXTURE1),vt.atlasTextureIcon&&vt.atlasTextureIcon.bind(vt.atlasInterpolationIcon,we.CLAMP_TO_EDGE,!0)),vt.renderWithShadows&&d.shadowRenderer.setupShadows(vt.tile.tileID.toUnwrapped(),vt.program,"vector-tile",vt.tile.tileID.overscaledZ),d.uploadCommonLightUniforms(d.context,vt.program),vt.hasHalo){const bt=vt.uniformValues;bt.u_is_halo=1,zd(vt.buffers,dt.segments,s,d,vt.program,vt.depthMode,_,x,bt,2),bt.u_is_halo=0}else{if(vt.isSDF){const bt=vt.uniformValues;vt.hasHalo&&(bt.u_is_halo=1,zd(vt.buffers,dt.segments,s,d,vt.program,vt.depthMode,_,x,bt,1)),bt.u_is_halo=0}zd(vt.buffers,dt.segments,s,d,vt.program,vt.depthMode,_,x,vt.uniformValues,1)}}}function zd(d,r,s,f,_,x,S,E,C,R){const F=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];_.draw(f,f.context.gl.TRIANGLES,x,S,E,Pr.disabled,C,s.id,d.layoutVertexBuffer,d.indexBuffer,r,s.paint,f.transform.zoom,d.programConfigurations.get(s.id),F,R)}function Hc(d,r){const s=1<<d.canonical.z,f=(r.x*s-d.canonical.x-d.wrap*s)*o.aj,_=(r.y*s-d.canonical.y)*o.aj,x=o.dS(r.z,r.y);return o.cS(f,_,x)}function Uu(d,r,s,f,_){if(!s.layout||s.layout.get("fill-elevation-reference")==="none")return;const x=d.context.gl,S=new Jt(d.context.gl.LEQUAL,Jt.ReadWrite,d.depthRangeFor3D),E=new Jt(d.context.gl.GREATER,Jt.ReadWrite,d.depthRangeFor3D),C=function(G){const J=o.cJ(G.pitch);let Y=.01;return G.isOrthographic&&(Y=o.ai(1e-4,Y,o.cO(J>=Ql?1:J/Ql))),2*Y}(d.transform),R=d.transform.getFreeCameraOptions().position,F="elevatedStructuresDepthReconstruct",j=d.getOrCreateProgram(F,{defines:["DEPTH_RECONSTRUCTION"]}),B=d.getOrCreateProgram(F);for(const G of f){const J=r.getTile(G),Y=J.getBucket(s);if(!Y)continue;const te=Y.elevatedStructures;if(!te)continue;const K=Y.elevationBufferData.heightRange,ce=Hc(G.toUnwrapped(),R),fe=d.translatePosMatrix(G.projMatrix,J,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));let pe,Ee,Te,we;if(_==="initialize"){if(!K||K.min>=1||te.depthSegments.segments[0].primitiveLength===0)continue;pe=xa(fe,ce,C,1,0),Ee=S,Te=te.depthSegments,we=j}else if(_==="reset"){if(!K||K.min>=0||te.maskSegments.segments[0].primitiveLength===0)continue;pe=xa(fe,ce,0,0,1),Ee=E,Te=te.maskSegments,we=j}else if(_==="geometry"){if(te.depthSegments.segments[0].primitiveLength===0)continue;pe=xa(fe,ce,C,1,0),Ee=S,Te=te.depthSegments,we=B}we.draw(d,x.TRIANGLES,Ee,Tr.disabled,Yr.disabled,Pr.disabled,pe,s.id,te.vertexBuffer,te.indexBuffer,Te,s.paint,d.transform.zoom)}}function qt(d,r,s){const{painter:f,sourceCache:_,layer:x,coords:S,colorMode:E,elevationType:C,terrainEnabled:R,pass:F}=d,j=f.context.gl,B=x.paint.get("fill-pattern"),G=x.paint.get("fill-pattern-cross-fade"),J=B.constantOr(null);let Y=C;C!=="road"||r&&!R||(Y="none");const te=Y==="road",K=d.painter.shadowRenderer,ce=te&&!!K&&K.enabled,fe=new Jt(f.context.gl.LEQUAL,Jt.ReadOnly,f.depthRangeFor3D);let pe=[0,0,0];if(ce){const we=f.style.directionalLight,ye=f.style.ambientLight;we&&ye&&(pe=bs(f.style,we,ye))}const Ee=B&&B.constantOr(1),Te=(we,ye)=>{let Ie,Oe,Xe,je,st;ye?(Ie=Ee&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Xe=j.LINES):(Ie=Ee?"fillPattern":"fill",Xe=j.TRIANGLES);for(const ct of S){const Et=_.getTile(ct);if(Ee&&!Et.patternsLoaded())continue;const Ve=Et.getBucket(x);if(!Ve)continue;const He=r?Ve.elevationBufferData:Ve.bufferData;if(He.isEmpty())continue;f.prepareDrawTile();const Ue=He.programConfigurations.get(x.id),ft=f.isTileAffectedByFog(ct),Ke=[],gt=[];te&&(Ke.push("ELEVATED_ROADS"),gt.push(He.elevatedLayoutVertexBuffer)),ce&&Ke.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ee&&(f.context.activeTexture.set(j.TEXTURE0),Et.imageAtlasTexture&&Et.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Ue.updatePaintBuffers());let dt=!1;if(J&&Et.imageAtlas){const Bt=Et.imageAtlas,er=o.dN.from(J),Wt=er.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),hr=er.getSecondary(),Or=Bt.patternPositions.get(Wt),rn=hr?Bt.patternPositions.get(hr.scaleSelf(o.q.devicePixelRatio).toString()):null;dt=!!Or&&!!rn,Or&&Ue.setConstantPatternPositions(Or,rn)}G>0&&(dt||Ue.getPatternTransitionVertexBuffer("fill-pattern"))&&Ke.push("FILL_PATTERN_TRANSITION");const vt=f.getOrCreateProgram(Ie,{config:Ue,overrideFog:ft,defines:Ke}),bt=f.translatePosMatrix(ct.projMatrix,Et,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));ce&&K.setupShadows(Et.tileID.toUnwrapped(),vt,"vector-tile",Et.tileID.overscaledZ);const Yt=x.paint.get("fill-emissive-strength");if(ye){je=He.lineIndexBuffer,st=He.lineSegments;const Bt=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[j.drawingBufferWidth,j.drawingBufferHeight];Oe=Ie==="fillOutlinePattern"&&Ee?Mf(bt,Yt,f,Et,Bt,pe,G):zh(bt,Yt,Bt,pe)}else je=He.indexBuffer,st=He.triangleSegments,Oe=Ee?zu(bt,Yt,f,Et,pe,G):cc(bt,Yt,pe);f.uploadCommonUniforms(f.context,vt,ct.toUnwrapped());let tr=we;(C==="road"&&!R||C==="offset")&&(tr=fe),vt.draw(f,Xe,tr,s||f.stencilModeForClipping(ct),E,Pr.disabled,Oe,x.id,He.layoutVertexBuffer,je,st,x.paint,f.transform.zoom,Ue,gt)}};f.renderPass===F&&Te(f.depthModeForSublayer(1,f.renderPass==="opaque"?Jt.ReadWrite:Jt.ReadOnly),!1),Y==="none"&&f.renderPass==="translucent"&&x.paint.get("fill-antialias")&&Te(f.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,Jt.ReadOnly),!0)}function ba(d,r,s,f,_,x,S,E){s.resetLayerRenderingStats(d);const C=d.context,R=C.gl,F=d.transform,j=s.paint.get("fill-extrusion-pattern"),B=s.paint.get("fill-extrusion-pattern-cross-fade"),G=j.constantOr(null),J=j.constantOr(1),Y=s.paint.get("fill-extrusion-opacity"),te=d.style.enable3dLights(),K=s.paint.get(te&&!J?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ce=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),K],fe=s.layout.get("fill-extrusion-edge-radius"),pe=fe>0&&!s.paint.get("fill-extrusion-rounded-roof"),Ee=pe?0:fe,Te=F.projection.name==="globe"?o.dT():0,we=F.projection.name==="globe",ye=we?o.ah(F.zoom):0,Ie=[o.ay(F.center.lng),o.aH(F.center.lat)],Oe=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Xe=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(Oe?null:s.lut).toArray01().slice(0,3),je=s.paint.get("fill-extrusion-flood-light-intensity"),st=s.paint.get("fill-extrusion-vertical-scale"),ct=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Et=s.paint.get("fill-extrusion-height-alignment"),Ve=s.paint.get("fill-extrusion-base-alignment"),He=Gs(d,s.paint.get("fill-extrusion-cutoff-fade-range")),Ue=[];let ft;we&&Ue.push("PROJECTION_GLOBE_VIEW"),ce[0]>0&&Ue.push("FAUX_AO"),pe&&Ue.push("ZERO_ROOF_RADIUS"),E&&Ue.push("HAS_CENTROID"),je>0&&Ue.push("FLOOD_LIGHT"),He.shouldRenderCutoff&&Ue.push("RENDER_CUTOFF"),ct&&Ue.push("RENDER_WALL_MODE");const Ke=d.renderPass==="shadow",gt=d.shadowRenderer,dt=Ke&&!!gt,vt=Ke?Pr.disabled:Pr.backCCW;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let bt=[0,0,0];if(gt){const Bt=d.style.directionalLight,er=d.style.ambientLight;Bt&&er&&(bt=bs(d.style,Bt,er)),Ke||(Ue.push("RENDER_SHADOWS","DEPTH_TEXTURE"),gt.useNormalOffset&&Ue.push("NORMAL_OFFSET")),ft=Ue.concat(["SHADOWS_SINGLE_CASCADE"])}const Yt=dt?"fillExtrusionDepth":J?"fillExtrusionPattern":"fillExtrusion",tr=s.getLayerRenderingStats();for(const Bt of f){const er=r.getTile(Bt),Wt=er.getBucket(s);if(!Wt||Wt.projection.name!==F.projection.name)continue;let hr=!1;gt&&(hr=gt.getMaxCascadeForTile(Bt.toUnwrapped())===0);const Or=d.isTileAffectedByFog(Bt),rn=Wt.programConfigurations.get(s.id);let Gn=!1;if(G&&er.imageAtlas){const yn=er.imageAtlas,Wn=o.dN.from(G),no=Wn.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),zi=Wn.getSecondary(),Gi=yn.patternPositions.get(no),Ti=zi?yn.patternPositions.get(zi.scaleSelf(o.q.devicePixelRatio).toString()):null;Gn=!!Gi&&!!Ti,Gi&&rn.setConstantPatternPositions(Gi,Ti)}B>0&&(Gn||rn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ue.push("FILL_EXTRUSION_PATTERN_TRANSITION");const qn=d.getOrCreateProgram(Yt,{config:rn,defines:hr?ft:Ue,overrideFog:Or});if(d.terrain&&d.terrain.setupElevationDraw(er,qn,{useMeterToDem:!0}),!Wt.centroidVertexBuffer){const yn=qn.attributes.a_centroid_pos;yn!==void 0&&R.vertexAttrib2f(yn,0,0)}!Ke&&gt&&gt.setupShadows(er.tileID.toUnwrapped(),qn,"vector-tile",er.tileID.overscaledZ),J&&(d.context.activeTexture.set(R.TEXTURE0),er.imageAtlasTexture&&er.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),rn.updatePaintBuffers());const Hr=s.paint.get("fill-extrusion-vertical-gradient"),Li=1/Wt.tileToMeter;let _i;if(Ke&&gt){if(Wp(er.tileID,Wt,d))continue;const yn=gt.calculateShadowPassMatrixFromTile(er.tileID.toUnwrapped());_i=Qm(yn,Ee,Li,st,Et,Ve)}else{const yn=d.translatePosMatrix(Bt.expandedProjMatrix,er,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Wn=F.projection.createInversionMatrix(F,Bt.canonical);_i=J?n_(yn,d,Hr,Y,ce,Ee,Li,Bt,er,Te,Et,Ve,ye,Ie,Wn,Xe,st,B):lc(yn,d,Hr,Y,ce,Ee,Li,Bt,Te,Et,Ve,ye,Ie,Wn,Xe,st,je,bt)}d.uploadCommonUniforms(C,qn,Bt.toUnwrapped(),null,He);let Rr=Wt.segments;if(F.projection.name==="mercator"&&!Ke&&(Rr=Wt.getVisibleSegments(er.tileID,d.terrain,d.transform.getFrustum(0)),!Rr.get().length))continue;if(tr)if(Ke)for(const yn of Rr.get())tr.numRenderedVerticesInShadowPass+=yn.primitiveLength;else for(const yn of Rr.get())tr.numRenderedVerticesInTransparentPass+=yn.primitiveLength;const _n=[];(d.terrain||E)&&_n.push(Wt.centroidVertexBuffer),we&&_n.push(Wt.layoutVertexExtBuffer),ct&&_n.push(Wt.wallVertexBuffer),qn.draw(d,C.gl.TRIANGLES,_,x,S,vt,_i,s.id,Wt.layoutVertexBuffer,Wt.indexBuffer,Rr,s.paint,d.transform.zoom,rn,_n)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function ls(d,r,s,f,_,x,S,E,C,R,F,j,B,G,J,Y,te,K,ce){const fe=d.context,pe=fe.gl,Ee=d.transform,Te=d.transform.zoom,we=[],ye=Gs(d,s.paint.get("fill-extrusion-cutoff-fade-range"));R==="clear"?(we.push("CLEAR_SUBPASS"),ce&&(we.push("CLEAR_FROM_TEXTURE"),fe.activeTexture.set(pe.TEXTURE0),ce.bind(pe.LINEAR,pe.CLAMP_TO_EDGE))):R==="sdf"&&we.push("SDF_SUBPASS"),te&&we.push("HAS_CENTROID"),ye.shouldRenderCutoff&&we.push("RENDER_CUTOFF");const Ie=s.layout.get("fill-extrusion-edge-radius"),Oe=(Xe,je,st,ct,Et)=>{const Ve=je.programConfigurations.get(s.id),He=d.isTileAffectedByFog(Xe),Ue=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ve,defines:we,overrideFog:He}),ft=((gt,dt,vt,bt,Yt,tr,Bt,er,Wt,hr,Or)=>({u_matrix:dt,u_opacity:vt,u_ao_pass:bt?1:0,u_meter_to_tile:Yt,u_ao:tr,u_flood_light_intensity:Bt,u_flood_light_color:er,u_attenuation:Wt,u_edge_radius:hr,u_fb:0,u_fb_size:Or,u_dynamic_offset:1}))(0,ct,F,C,Et,[j,B*Et],G,J,Y,Te>=17?0:Ie*Et,ce?ce.size[0]:0),Ke=[];te&&Ke.push(je.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(fe,Ue,Xe.toUnwrapped(),null,ye),Ue.draw(d,fe.gl.TRIANGLES,_,x,S,E,ft,s.id,je.vertexBuffer,je.indexBuffer,st,s.paint,Te,Ve,Ke)};for(const Xe of f){const je=r.getTile(Xe),st=je.getBucket(s);if(!st||st.projection.name!==Ee.projection.name||!st.groundEffect||st.groundEffect&&!st.groundEffect.hasData())continue;const ct=st.groundEffect,Et=1/st.tileToMeter;{const Ve=d.translatePosMatrix(Xe.projMatrix,je,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),He=ct.getDefaultSegment();Oe(Xe,ct,He,Ve,Et)}if(K)for(let Ve=0;Ve<4;Ve++){const He=o.dU[Ve](Xe),Ue=r.getTile(He);if(!Ue)continue;const ft=Ue.getBucket(s);if(!ft||ft.projection.name!==Ee.projection.name||!ft.groundEffect||ft.groundEffect&&!ft.groundEffect.hasData())continue;const Ke=ft.groundEffect;let gt,dt;Ve===0?(gt=[-o.aj,0,0],dt=1):Ve===1?(gt=[o.aj,0,0],dt=0):Ve===2?(gt=[0,-o.aj,0],dt=3):(gt=[0,o.aj,0],dt=2);const vt=Ke.regionSegments[dt];if(!vt)continue;const bt=new Float32Array(16);o.bo(bt,Xe.projMatrix,gt),Oe(Xe,Ke,vt,d.translatePosMatrix(bt,je,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Et)}}}function Tl(d,r,s,f,_,x,S){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();const E=x?x.findDEMTileFor(s):null;if(!(E&&E.dem||S))return;x&&E&&E.dem&&f.selfDEMTileTimestamp!==E.dem._timestamp&&(f.borderDoneWithNeighborZ=[-1,-1,-1,-1],f.selfDEMTileTimestamp=E.dem._timestamp);const C=K=>new o.P(Math.ceil((K+o.dX)*o.dY),0),R=K=>{const ce=r.getSource().minzoom,fe=Ee=>{const Te=r.getTileByID(Ee);if(Te&&Te.hasData())return Te.getBucket(_)},pe=[0,-1,1];for(const Ee of pe){if(K.overscaledZ+Ee<ce)continue;const Te=fe(K.calculateScaledKey(K.overscaledZ+Ee));if(Te)return Te}},F=[0,0,0],j=(K,ce)=>(F[0]=Math.min(K.min.y,ce.min.y),F[1]=Math.max(K.max.y,ce.max.y),F[2]=o.aj-ce.min.x>K.max.x?ce.min.x-o.aj:K.max.x,F),B=(K,ce)=>(F[0]=Math.min(K.min.x,ce.min.x),F[1]=Math.max(K.max.x,ce.max.x),F[2]=o.aj-ce.min.y>K.max.y?ce.min.y-o.aj:K.max.y,F),G=[(K,ce)=>j(K,ce),(K,ce)=>j(ce,K),(K,ce)=>B(K,ce),(K,ce)=>B(ce,K)],J=(K,ce,fe,pe,Ee,Te,we)=>{if(!x)return 0;const ye=[[Te?fe:K,Te?K:fe,0],[Te?fe:ce,Te?ce:fe,0]],Ie=we<0?o.aj+we:we,Oe=[Te?Ie:(K+ce)/2,Te?(K+ce)/2:Ie,0];return fe===0&&we<0||fe!==0&&we>0?x.getForTilePoints(Ee,[Oe],!0,pe):ye.push(Oe),x.getForTilePoints(s,ye,!0,E),Math.max(ye[0][2],ye[1][2],Oe[2])/x.exaggeration()};for(let K=0;K<4;K++){const ce=f.borderFeatureIndices[K];if(ce.length===0)continue;const fe=o.dU[K](s),pe=R(fe);if(!(pe&&pe instanceof o.dV))continue;const Ee=x?x.findDEMTileFor(fe):null;if(!(Ee&&Ee.dem||S)||(x&&Ee&&Ee.dem&&f.borderDEMTileTimestamp[K]!==Ee.dem._timestamp&&(f.borderDoneWithNeighborZ[K]=-1,f.borderDEMTileTimestamp[K]=Ee.dem._timestamp),f.borderDoneWithNeighborZ[K]===pe.canonical.z))continue;pe.centroidVertexArray.length===0&&pe.createCentroidsBuffer();const Te=(K<2?1:5)-K,we=pe.borderDoneWithNeighborZ[Te]!==f.canonical.z,ye=pe.borderFeatureIndices[Te];let Ie=0;if(f.canonical.z!==pe.canonical.z){for(const Oe of ce)f.showCentroid(f.featuresOnBorder[Oe]);if(we)for(const Oe of ye)pe.showCentroid(pe.featuresOnBorder[Oe]);f.borderDoneWithNeighborZ[K]=pe.canonical.z,pe.borderDoneWithNeighborZ[Te]=f.canonical.z}for(const Oe of ce){const Xe=f.featuresOnBorder[Oe],je=f.centroidData[Xe.centroidDataIndex],st=Xe.borders[K];let ct;for(;Ie<ye.length;){ct=pe.featuresOnBorder[ye[Ie]];const Et=ct.borders[Te];if(Et[1]>st[0]+3||Et[0]>st[0]-3)break;pe.showCentroid(ct),Ie++}if(ct&&Ie<ye.length){const Et=Ie;let Ve=0;for(;!(ct.borders[Te][0]>st[1]-3)&&(Ve++,++Ie!==ye.length);)ct=pe.featuresOnBorder[ye[Ie]];ct=pe.featuresOnBorder[ye[Et]];let He=!1;if(Ve>=1){const Ke=ct.borders[Te];Math.abs(st[0]-Ke[0])<3&&Math.abs(st[1]-Ke[1])<3&&(Ve=1,He=!0,Ie=Et+1)}else if(Ve===0){f.showCentroid(Xe);continue}const Ue=pe.centroidData[ct.centroidDataIndex];S&&He&&(((Y=je).flags|(te=Ue).flags)&o.dW?(Y.flags|=o.dW,te.flags|=o.dW):(Y.flags&=~o.dW,te.flags&=~o.dW));const ft=Xe.intersectsCount()>1||ct.intersectsCount()>1;if(Ve>1)Ie=Et,je.centroidXY=Ue.centroidXY=new o.P(0,0);else if(Ee&&Ee.dem&&!ft){const Ke=G[K](je,Ue),gt=K%2?o.aj-1:0,dt=J(Ke[0],Math.min(o.aj-1,Ke[1]),gt,Ee,fe,K<2,Ke[2]);je.centroidXY=Ue.centroidXY=C(dt)}else ft?je.centroidXY=Ue.centroidXY=new o.P(0,0):(je.centroidXY=f.encodeBorderCentroid(Xe),Ue.centroidXY=pe.encodeBorderCentroid(ct));f.writeCentroidToBuffer(je),pe.writeCentroidToBuffer(Ue)}else f.showCentroid(Xe)}f.borderDoneWithNeighborZ[K]=pe.canonical.z,pe.borderDoneWithNeighborZ[Te]=f.canonical.z}var Y,te;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(d)}const hc=[1,0,0],_r=[0,1,0],El=[0,0,1];function Wp(d,r,s){const f=s.transform,_=s.shadowRenderer;if(!_)return!0;const x=d.toUnwrapped(),S=f.tileSize*_._cascades[s.currentShadowCascade].scale;let E=r.maxHeight;if(f.elevation){const Y=f.elevation.getMinMaxForTile(d);Y&&(E+=Y.max)}const C=[..._.shadowDirection];C[2]=-C[2];const R=_.computeSimplifiedTileShadowVolume(x,E,S,C);if(!R)return!1;const F=[hc,_r,El,C,[C[0],0,C[2]],[0,C[1],C[2]]],j=f.projection.name==="globe",B=f.scaleZoom(S),G=o.cn.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,B,!j),J=_.getCurrentCascadeFrustum();return G.intersectsPrecise(R.vertices,R.planes,F)===0||J.intersectsPrecise(R.vertices,R.planes,F)===0}function Hp(d){return[d[0]*o.dZ,d[1]*o.dZ,d[2]*o.dZ,0]}function cs(d,r,s,f,_,x,S,E,C){const R=f.getSource(),F=s.globeSharedBuffers;if(!F)return;let j,B,G;if(r&&(j=f.getTile(r)),R instanceof o.aP?(B=R.texture,G=o.ds(0,0,s.transform)):j&&r&&(B=j.texture,G=o.ds(r.canonical.z,r.canonical.x,s.transform)),!B||!G)return;d||(G=o.cE(o.bz(),G,[1,-1,1]));const J=s.context,Y=J.gl,te=_.paint.get("raster-resampling")==="nearest"?Y.NEAREST:Y.LINEAR,K=s.colorModeForDrapableLayerRenderPass(x),ce=S.defines;ce.push("GLOBE_POLES");const fe=new Jt(Y.LEQUAL,Jt.ReadWrite,s.depthRangeFor3D),pe=Float32Array.from(s.transform.expandedFarZProjMatrix),Ee=Float32Array.from(o.bh(o.dr(new o.cp(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),J.activeTexture.set(Y.TEXTURE0),B.bind(te,Y.CLAMP_TO_EDGE),J.activeTexture.set(Y.TEXTURE1),B.bind(te,Y.CLAMP_TO_EDGE),"useMipmap"in B&&J.extTextureFilterAnisotropic&&s.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,J.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,J.extTextureFilterAnisotropicMax);const[Te,we,ye,Ie]=r?F.getPoleBuffers(r.canonical.z,!1):F.getPoleBuffers(0,!0),Oe=_.paint.get("raster-elevation");let Xe;d?(Xe=Te,s.renderDefaultNorthPole=Oe!==0):(Xe=we,s.renderDefaultSouthPole=Oe!==0);const je=Hp(S.mix),st=((Et,Ve,He,Ue,ft,Ke,gt,dt,vt,bt,Yt,tr,Bt)=>wl(Et,Ve,He,new Float32Array(16),new Float32Array(9),[0,0],Ue,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ke,[0,0],dt,2,bt,Yt,tr,1,0,Bt))(pe,Ee,G,o.ah(s.transform.zoom),0,_,0,Oe,0,je,S.offset,S.range,x),ct=s.getOrCreateProgram("raster",{defines:ce});s.uploadCommonUniforms(J,ct,null),ct.draw(s,Y.TRIANGLES,fe,C,K,E,st,_.id,Xe,ye,Ie)}function dc(d){const r=d._nearZ,s=d.projection.farthestPixelDistance(d),f=s-r,_=.2*d.height,x=r+_;return[r,s,(x-_-r)/f,(x-r)/f]}function Rf(d,r,s,f){if(d)return r instanceof _u&&d instanceof uh?r.getTextureDescriptor(d,s,!0):{texture:d.texture,mix:Hp(f.mix),offset:f.offset,buffer:0,tileSize:1}}var Zp=o.d_([{name:"a_index",type:"Int16",components:1}]);class Lf{constructor(r,s,f,_){const x={width:f[0],height:f[1],data:null},S=r.gl;this.targetColorTexture=new o.T(r,x,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(r,x,S.RGBA8,{useMipmap:!1}),this.context=r,this.updateParticleTexture(s,_),this.lastInvalidatedAt=0}updateParticleTexture(r,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const f=this.context.gl,_=s.width*s.height;this.particleTexture0=new o.T(this.context,s,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,s,f.RGBA8,{premultiply:!1,useMipmap:!1});const x=new o.d$;x.reserve(_);for(let S=0;S<_;S++)x.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(x,Zp.members,!0),this.particleSegment=o.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function eg(d,r,s){if(!d)return null;const f=r.getTextureDescriptor(d,s,!0);if(!f)return null;let{texture:_,mix:x,offset:S,tileSize:E,buffer:C,format:R}=f;if(!_||!R)return null;let F=!1;return R==="uint32"&&(F=!0,x[3]=0,x=uc(o.e0,x,[0,s.paint.get("raster-particle-max-speed")]),S=kd(o.e0,S,[0,s.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[C/(E+2*C),E/(E+2*C)],tileSize:E,scalarData:F,scale:x,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[R]]}}function Vu(d){const r=d._nearZ,s=d.projection.farthestPixelDistance(d),f=s-r,_=.2*d.height,x=r+_;return[r,s,(x-_-r)/f,(x-r)/f]}const As=new o.am(1,0,0,1),$u=new o.am(0,1,0,1),Gu=new o.am(0,0,1,1),Fo=new o.am(1,0,1,1),Al=new o.am(0,1,1,1);function Is(d,r,s,f,_,x,S){const E=d.context,C=d.transform,R=E.gl,F=C.projection.name==="globe",j=F?["PROJECTION_GLOBE_VIEW"]:[];let B=o.bw(s.projMatrix);if(F&&o.ah(C.zoom)>0){const je=o.bg(s.canonical,C),st=o.e1(je);B=o.az(new Float32Array(16),C.globeMatrix,st),o.az(B,C.projMatrix,B)}const G=o.bz();G[12]+=2*_/(o.q.devicePixelRatio*C.width),G[13]+=2*x/(o.q.devicePixelRatio*C.height),o.az(B,G,B);const J=d.getOrCreateProgram("debug",{defines:j}),Y=r.getTileByID(s.key);d.terrain&&d.terrain.setupElevationDraw(Y,J);const te=Jt.disabled,K=Tr.disabled,ce=d.colorModeForRenderPass(),fe="$debug";E.activeTexture.set(R.TEXTURE0),d.emptyTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),F?Y._makeGlobeTileDebugBuffers(d.context,C):Y._makeDebugTileBoundsBuffers(d.context,C.projection);const pe=Y._tileDebugBuffer||d.debugBuffer,Ee=Y._tileDebugIndexBuffer||d.debugIndexBuffer,Te=Y._tileDebugSegments||d.debugSegments;if(J.draw(d,R.LINE_STRIP,te,K,ce,Pr.disabled,ss(B,f),fe,pe,Ee,Te,null,null,null,[Y._globeTileDebugBorderBuffer]),S){const je=Y.latestRawTileData,st=Math.floor((je&&je.byteLength||0)/1024);let ct=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(ct+=` => ${s.overscaledZ}`),ct+=` ${Y.state}`,ct+=` ${st}kb`,function(Et,Ve){Et.initDebugOverlayCanvas();const He=Et.debugOverlayCanvas,Ue=Et.context.gl,ft=Et.debugOverlayCanvas.getContext("2d");ft.clearRect(0,0,He.width,He.height),ft.shadowColor="white",ft.shadowBlur=2,ft.lineWidth=1.5,ft.strokeStyle="white",ft.textBaseline="top",ft.font="bold 36px Open Sans, sans-serif",ft.fillText(Ve,5,5),ft.strokeText(Ve,5,5),Et.debugOverlayTexture.update(He),Et.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(d,ct)}const we=r.getTile(s).tileSize,ye=512/Math.min(we,512)*(s.overscaledZ/C.zoom)*.5,Ie=Y._tileDebugTextBuffer||d.debugBuffer,Oe=Y._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Xe=Y._tileDebugTextSegments||d.debugSegments;J.draw(d,R.TRIANGLES,te,K,Yr.alphaBlended,Pr.disabled,ss(B,o.am.transparent,ye),fe,Ie,Oe,Xe,null,null,null,[Y._globeTileDebugTextBuffer])}function Fd(d,r,s,f){Hi(d,0,r+s/2,d.transform.width,s,f)}function Vh(d,r,s,f){Hi(d,r-s/2,0,s,d.transform.height,f)}function Hi(d,r,s,f,_,x){const S=d.context,E=S.gl;E.enable(E.SCISSOR_TEST),E.scissor(r*o.q.devicePixelRatio,s*o.q.devicePixelRatio,f*o.q.devicePixelRatio,_*o.q.devicePixelRatio),S.clear({color:x}),E.disable(E.SCISSOR_TEST)}const Nd=o.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ua}=Nd;function $n(d,r,s,f){d.emplaceBack(r,s,f)}class Zc{constructor(r){this.vertexArray=new o.e2,this.indices=new o.a_,$n(this.vertexArray,-1,-1,1),$n(this.vertexArray,1,-1,1),$n(this.vertexArray,-1,1,1),$n(this.vertexArray,1,1,1),$n(this.vertexArray,-1,-1,-1),$n(this.vertexArray,1,-1,-1),$n(this.vertexArray,-1,1,-1),$n(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Ua),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.bd.simpleSegment(0,0,36,12)}}function Il(d,r,s,f,_,x){const S=d.context.gl,E=r.paint.get("sky-atmosphere-color"),C=r.paint.get("sky-atmosphere-halo-color"),R=r.paint.get("sky-atmosphere-sun-intensity"),F=((j,B,G,J,Y)=>({u_matrix_3f:j,u_sun_direction:B,u_sun_intensity:G,u_color_tint_r:[J.r,J.g,J.b,J.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(o.e4(o.dx(),f),_,R,E,C);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+x,r.skyboxTexture,0),s.draw(d,S.TRIANGLES,Jt.disabled,Tr.disabled,Yr.unblended,Pr.frontCW,F,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Xc=o.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class mo{constructor(r){const s=new o.e5;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const f=new o.a_;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(s,Xc.members),this.indexBuffer=r.createIndexBuffer(f),this.segments=o.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const No=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class ra{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class fc{constructor(r){this.colorModeAlphaBlendedWriteRGB=new Yr([1,ya,1,ya],o.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Yr([1,0,1,0],o.am.transparent,[!1,!1,!1,!0]),this.params=new ra,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){const s=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new mo(s);const f=this.params.sizeRange,_=this.params.intensityRange,x=function(F){const j=o.ea(30),B=[];for(let G=0;G<F;++G){const J=2*Math.PI*j(),Y=Math.acos(1-2*j())-.5*Math.PI;B.push(o.cS(Math.cos(Y)*Math.cos(J),Math.cos(Y)*Math.sin(J),Math.sin(Y)))}return B}(this.params.starsCount),S=o.ea(300),E=new o.e6,C=new o.a_;let R=0;for(let F=0;F<x.length;++F){const j=o.b$([],x[F],200),B=Math.max(0,1+.01*f*(1*S()-.5)),G=Math.max(0,1+.01*_*(1*S()-.5));E.emplaceBack(j[0],j[1],j[2],-1,-1,B,G),E.emplaceBack(j[0],j[1],j[2],1,-1,B,G),E.emplaceBack(j[0],j[1],j[2],1,1,B,G),E.emplaceBack(j[0],j[1],j[2],-1,1,B,G),C.emplaceBack(R+0,R+1,R+2),C.emplaceBack(R+0,R+2,R+3),R+=4}this.starsVx=s.createVertexBuffer(E,No.members),this.starsIdx=s.createIndexBuffer(C),this.starsSegments=o.bd.simpleSegment(0,0,E.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,s){const f=r.context,_=f.gl,x=r.transform,S=new Jt(_.LEQUAL,Jt.ReadOnly,[0,1]),E=o.ah(x.zoom),C=r.style.getLut(s.scope),R=s.properties.get("color-use-theme")==="none",F=s.properties.get("color").toRenderColor(R?null:C).toArray01(),j=s.properties.get("high-color-use-theme")==="none",B=s.properties.get("high-color").toRenderColor(j?null:C).toArray01(),G=s.properties.get("space-color-use-theme")==="none",J=s.properties.get("space-color").toRenderColor(G?null:C).toArray01PremultipliedAlpha(),Y=5e-4,te=o.e7(s.properties.get("horizon-blend"),0,1,Y,.25),K=o.dl(r,f,x)&&te===Y?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,ce=r.frameCounter/1e3%1,fe=o.ae(x.globeCenterInViewSpace),pe=Math.sqrt(Math.pow(fe,2)-Math.pow(K,2)),Ee=Math.acos(pe/fe),Te=we=>{const ye=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];we&&ye.push("ALPHA_PASS");const Ie=r.getOrCreateProgram("globeAtmosphere",{defines:ye}),Oe=((je,st,ct,Et,Ve,He,Ue,ft,Ke,gt,dt,vt)=>({u_frustum_tl:je,u_frustum_tr:st,u_frustum_br:ct,u_frustum_bl:Et,u_horizon:Ve,u_transition:He,u_fadeout_range:Ue,u_color:ft,u_high_color:Ke,u_space_color:gt,u_temporal_offset:dt,u_horizon_angle:vt}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,E,te,F,B,J,ce,Ee);r.uploadCommonUniforms(f,Ie);const Xe=this.atmosphereBuffer;Xe&&Ie.draw(r,_.TRIANGLES,S,Tr.disabled,we?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Pr.backCW,Oe,we?"atmosphere_glow_alpha":"atmosphere_glow",Xe.vertexBuffer,Xe.indexBuffer,Xe.segments)};Te(!1),Te(!0)}drawStars(r,s){const f=o.aD(s.properties.get("star-intensity"),0,1);if(f===0)return;const _=r.context,x=_.gl,S=r.transform,E=r.getOrCreateProgram("stars"),C=o.bY([]);o.b_(C,C,-S._pitch),o.bZ(C,C,-S.angle),o.b_(C,C,o.al(S._center.lat)),o.e8(C,C,-o.al(S._center.lng));const R=o.c3(new Float32Array(16),C),F=o.az([],S.starsProjMatrix,R),j=o.e4([],R),B=o.e9([],j),G=[0,1,0];o.dz(G,G,B),o.b$(G,G,this.params.sizeMultiplier);const J=[1,0,0];o.dz(J,J,B),o.b$(J,J,this.params.sizeMultiplier);const Y=(te=G,K=J,ce=f,{u_matrix:Float32Array.from(F),u_up:te,u_right:K,u_intensity_multiplier:ce});var te,K,ce;r.uploadCommonUniforms(_,E),this.starsVx&&this.starsIdx&&E.draw(r,x.TRIANGLES,Jt.disabled,Tr.disabled,this.colorModeAlphaBlendedWriteRGB,Pr.disabled,Y,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Xs(d,r){const s=[...d],f=r.cameraWorldSizeForFog/r.worldSize,_=o.bx([]);return o.cE(_,_,[f,f,1]),o.az(s,_,s),o.az(s,r.worldToFogMatrix,s),s}function Ct(d,r,s,f,_){const x=s.material,S=f.context,{baseColorTexture:E,metallicRoughnessTexture:C}=x.pbrMetallicRoughness,{normalTexture:R,occlusionTexture:F,emissionTexture:j}=x;function B(J,Y,te){if(J&&(d.push(Y),S.activeTexture.set(S.gl.TEXTURE0+te),J.gfxTexture)){const{minFilter:K,magFilter:ce,wrapS:fe,wrapT:pe}=J.sampler;J.gfxTexture.bindExtraParam(K,ce,fe,pe)}}B(E,"HAS_TEXTURE_u_baseColorTexture",va.BaseColor),B(C,"HAS_TEXTURE_u_metallicRoughnessTexture",va.MetallicRoughness),B(R,"HAS_TEXTURE_u_normalTexture",va.Normal),B(F,"HAS_TEXTURE_u_occlusionTexture",va.Occlusion),B(j,"HAS_TEXTURE_u_emissionTexture",va.Emission),_&&(_.texture||(_.texture=new o.ed(f.context,_.image,[_.image.height,_.image.height,_.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+va.LUT),_.texture&&_.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(s.texcoordBuffer)),s.colorBuffer&&(d.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(s.colorBuffer)),s.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(s.normalBuffer)),s.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(s.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||d.push("DIFFUSE_SHADED");const G=f.shadowRenderer;G&&(d.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&d.push("NORMAL_OFFSET"))}function Xt(d,r,s,f,_,x){const S=s.paint.get("model-opacity").constantOr(1),E=r.context,C=new Jt(r.context.gl.LEQUAL,Jt.ReadWrite,r.depthRangeFor3D),R=r.transform,F=d.mesh,j=F.material,B=j.pbrMetallicRoughness,G=r.style.fog;let J;J=r.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:o.az([],f.zScaleMatrix,d.nodeModelMatrix),o.az(J,f.negCameraPosMatrix,J);const Y=o.bi([],J);o.ee(Y,Y);const te=s.paint.get("model-color-use-theme").constantOr("default")==="none",K=s.paint.get("model-emissive-strength").constantOr(0),ce=Sl(new Float32Array(d.worldViewProjection),new Float32Array(J),new Float32Array(Y),null,r,S,B.baseColorFactor.toRenderColor(null),j.emissiveFactor,B.metallicFactor,B.roughnessFactor,j,K,s),fe={defines:[]},pe=[],Ee=r.shadowRenderer;Ee&&(Ee.useNormalOffset=!1),Ct(fe.defines,pe,F,r,te?null:s.lut);let Te=null;if(G){const Ie=Xs(d.nodeModelMatrix,r.transform);if(Te=new Float32Array(Ie),R.projection.name!=="globe"){const Oe=F.aabb.min,Xe=F.aabb.max,[je,st]=G.getOpacityForBounds(Ie,Oe[0],Oe[1],Xe[0],Xe[1]);fe.overrideFog=je>=Vt||st>=Vt}}const we=Gs(r,s.paint.get("model-cutoff-fade-range"));we.shouldRenderCutoff&&fe.defines.push("RENDER_CUTOFF");const ye=r.getOrCreateProgram("model",fe);r.uploadCommonUniforms(E,ye,null,Te,we),r.renderPass!=="shadow"&&Ee&&Ee.setupShadowsFromMatrix(d.nodeModelMatrix,ye),ye.draw(r,E.gl.TRIANGLES,C,_,x,F.material.doubleSided?Pr.disabled:Pr.backCCW,ce,s.id,F.vertexBuffer,F.indexBuffer,F.segments,s.paint,r.transform.zoom,void 0,pe)}function So(d,r,s,f,_,x,S){let E;E=d.projection.name==="globe"?o.ef(s,d):[...s],o.az(E,E,r.matrix);const C=o.az([],f,E);if(r.meshes)for(const R of r.meshes){if(R.material.alphaMode!=="BLEND"){S.push({mesh:R,depth:0,modelIndex:_,worldViewProjection:C,nodeModelMatrix:E});continue}const F=o.ad([],R.centroid,C);!d.isOrthographic&&F[2]<=0||x.push({mesh:R,depth:F[2],modelIndex:_,worldViewProjection:C,nodeModelMatrix:E})}if(r.children)for(const R of r.children)So(d,R,s,f,_,x,S)}function Ri(d,r,s,f){const _=s.shadowRenderer;if(!_)return;const x=_.getShadowPassDepthMode(),S=_.getShadowPassColorMode(),E=_.calculateShadowPassMatrixFromMatrix(r),C=qp(E);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,x,Tr.disabled,S,Pr.backCCW,C,f.id,d.vertexBuffer,d.indexBuffer,d.segments,f.paint,s.transform.zoom,void 0,void 0)}function qe(d,r,s){const f=r.updateZoomBasedPaintProperties(),_=function(x,S,E){let C,R,F,j=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&j>0){const B=x.terrain,G=B.findDEMTileFor(E);G&&G.dem?C=o.el.create(B,E,G):j=0}if(j===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),j===S.validForExaggeration&&(j===0||C&&C._demTile&&C._demTile.tileID===S.validForDEMTile.id&&C._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const B in S.instancesPerModel){const G=S.instancesPerModel[B];for(let J=0;J<G.instancedDataArray.length;++J){const Y=(C?j*C.getElevationAt(0|G.instancedDataArray.float32[16*J],0|G.instancedDataArray.float32[16*J+1],!0,!0):0)+G.instancesEvaluatedElevation[J];G.instancedDataArray.float32[16*J+6]=Y,R=R?Math.min(S.terrainElevationMin,Y):Y,F=F?Math.max(S.terrainElevationMax,Y):Y}}return S.terrainElevationMin=R||0,S.terrainElevationMax=F||0,S.validForExaggeration=j,S.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,r,s);(f||_)&&(r.uploaded=!1,r.upload(d.context))}const us={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.cV([0,0,0],[o.aj,o.aj,0])};function hs(d,r){const s=1<<d.canonical.z,f=r.getFreeCameraOptions().position,_=r.elevation,x=d.canonical.x/s,S=(d.canonical.x+1)/s,E=d.canonical.y/s,C=(d.canonical.y+1)/s;let R=r._centerAltitude;if(_){const G=_.getMinMaxForTile(d);G&&G.max>R&&(R=G.max)}const F=o.aD(f.x,x,S)-f.x,j=o.aD(f.y,E,C)-f.y,B=o.c6(R,r.center.lat)-f.z;return r._zoomFromMercatorZ(Math.sqrt(F*F+j*j+B*B))}function Ra(d,r,s,f,_,x,S){const E=d.context,C=d.renderPass==="shadow",R=d.shadowRenderer,F=C&&R?R.getShadowPassDepthMode():new Jt(E.gl.LEQUAL,Jt.ReadWrite,d.depthRangeFor3D),j=d.isTileAffectedByFog(x);if(s.meshes)for(const B of s.meshes){const G=["MODEL_POSITION_ON_GPU"],J=[];let Y,te,K;f.instancedDataArray.length>20&&G.push("INSTANCED_ARRAYS");const ce=Gs(d,r.paint.get("model-cutoff-fade-range"));if(ce.shouldRenderCutoff&&G.push("RENDER_CUTOFF"),C&&R)Y=d.getOrCreateProgram("modelDepth",{defines:G}),te=qp(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(s.matrix)),K=R.getShadowPassColorMode();else{Ct(G,J,B,d,r.paint.get("model-color-use-theme").constantOr("default")==="none"?null:r.lut),Y=d.getOrCreateProgram("model",{defines:G,overrideFog:j});const pe=B.material,Ee=pe.pbrMetallicRoughness,Te=r.paint.get("model-opacity").constantOr(1),we=r.paint.get("model-emissive-strength").constantOr(0);te=Sl(x.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,d,Te,Ee.baseColorFactor.toRenderColor(null),pe.emissiveFactor,Ee.metallicFactor,Ee.roughnessFactor,pe,we,r,_),R&&(S.shadowUniformsInitialized?Y.setShadowUniformValues(E,R.getShadowUniformValues()):(R.setupShadows(x.toUnwrapped(),Y,"model-tile",x.overscaledZ),S.shadowUniformsInitialized=!0)),K=ce.shouldRenderCutoff||Te<1||pe.alphaMode!=="OPAQUE"?Yr.alphaBlended:Yr.unblended}d.uploadCommonUniforms(E,Y,x.toUnwrapped(),null,ce);const fe=B.material.doubleSided?Pr.disabled:Pr.backCCW;if(f.instancedDataArray.length>20)J.push(f.instancedDataBuffer),Y.draw(d,E.gl.TRIANGLES,F,Tr.disabled,K,fe,te,r.id,B.vertexBuffer,B.indexBuffer,B.segments,r.paint,d.transform.zoom,void 0,J,f.instancedDataArray.length);else{const pe=C?"u_instance":"u_normal_matrix";for(let Ee=0;Ee<f.instancedDataArray.length;++Ee)te[pe]=new Float32Array(f.instancedDataArray.arrayBuffer,64*Ee,16),Y.draw(d,E.gl.TRIANGLES,F,Tr.disabled,K,fe,te,r.id,B.vertexBuffer,B.indexBuffer,B.segments,r.paint,d.transform.zoom,void 0,J)}}if(s.children)for(const B of s.children)Ra(d,r,B,f,_,x,S)}const qu=[1,-1,1];function zf(d,r,s,f){if(!s.modelManager)return!0;const _=s.modelManager;if(!s.shadowRenderer)return!0;const x=s.shadowRenderer,S=r.aabb;let E=!0,C=d.maxHeight;if(C===0){let F=0;for(const j in d.instancesPerModel){const B=_.getModel(j,f);B?F=Math.max(F,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):E=!1}C=d.maxScale*F*1.41+d.maxVerticalOffset,E&&(d.maxHeight=C)}S.max[2]=C,S.min[2]+=d.terrainElevationMin,S.max[2]+=d.terrainElevationMax,o.ad(S.min,S.min,r.tileMatrix),o.ad(S.max,S.max,r.tileMatrix);const R=S.intersects(x.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=R===2),R===0}function Ff(d,r){const s=d.uniformValues.u_cutoff_params[0],f=d.uniformValues.u_cutoff_params[1],_=d.uniformValues.u_cutoff_params[2],x=d.uniformValues.u_cutoff_params[3];return f===s||x===_?1:o.aD(((r-s)/(f-s)-_)/(x-_),0,1)}function Wu(d,r,s,f){if(r.pitch<20)return 1;const _=r.getWorldToCameraMatrix();o.az(_,_,d);const x=o.ei(s.min[0],s.min[1],s.min[2],1);let S=o.aA(o.ej(),x,_),E=S,C=S;x[1]=s.max[1],S=o.aA(o.ej(),x,_),E=S[1]<E[1]?S:E,C=S[1]>C[1]?S:C,x[0]=s.max[0],S=o.aA(o.ej(),x,_),E=S[1]<E[1]?S:E,C=S[1]>C[1]?S:C,x[1]=s.min[1],S=o.aA(o.ej(),x,_),E=S[1]<E[1]?S:E,C=S[1]>C[1]?S:C;const R=o.aD(f[0],0,1),F=100*r.pixelsPerMeter*o.aD(f[1],0,1),j=o.aD(f[2],0,1),B=o.ek(o.ej(),E,C,R),G=Math.tan(.5*r.fovX),J=-B[2]*G;if(F===0)return B[1]<-Math.abs(J)?j:1;const Y=(-Math.abs(J)-B[1])/F,te=(ce,fe,pe)=>(1-pe)*ce+pe*fe,K=o.aD(te(1,j,Y),j,1);return te(1,K,o.aD((r.pitch-20)/20,0,1))}class tg{}class rg{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,s,f){{const j=this._storage.get(s.id);if(j)return j.lastUsedFrameIdx=r,j.buf}const _=f.gl,x=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),S=new ArrayBuffer(x),E=new Int16Array(S);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const C=new o.en;for(let j=0;j<x/2;j+=3){const B=E[j],G=E[j+1],J=E[j+2];C.emplaceBack(B,G),C.emplaceBack(G,J),C.emplaceBack(J,B)}const R=f.bindVertexArrayOES.current,F=new tg;return F.buf=new Hs(f,C),F.lastUsedFrameIdx=r,this._storage.set(s.id,F),f.bindVertexArrayOES.set(R),F.buf}update(r){for(const[s,f]of this._storage)r-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(s))}destroy(){for(const[r,s]of this._storage)s.buf.destroy(),this._storage.delete(r)}}class Xp{constructor(r){this.occluderSize=30,this.depthOffset=-1e-4,r.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Bd=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Nf{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Bf{constructor(r,s){this.revealStart=11,this.revealRange=2,r.registerParameter(this,[...s,"Reveal"],"revealStart",{min:0,max:17,step:.05}),r.registerParameter(this,[...s,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Yp=o.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Yc{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(r,s){const f=r.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const S=new o.eo,E=new o.a_;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(1,1),S.emplaceBack(-1,1),E.emplaceBack(0,1,2),E.emplaceBack(0,2,3),this.vignetteVx=r.context.createVertexBuffer(S,Yp.members),this.vignetteIdx=r.context.createIndexBuffer(E)}const _=o.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){r.uploadCommonUniforms(r.context,f);const S={u_vignetteShape:(x={vignetteShape:[s.start,s.range,Math.pow(10,s.fadePower)],vignetteColor:[s.color.r,s.color.g,s.color.b,s.color.a*s.strength]}).vignetteShape,u_vignetteColor:x.vignetteColor};f.draw(r,r.context.gl.TRIANGLES,Jt.disabled,Tr.disabled,Yr.alphaBlended,Pr.disabled,S,"vignette",this.vignetteVx,this.vignetteIdx,_)}var x}}class $h{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(r,s){const f=r.getFreeCameraOptions().position,_=f.toAltitude(),x=f.toLngLat(),S=o.al(x.lng),E=o.al(x.lat),C=r.pixelsPerMeter/s,R=S*o.eq,F=o.eq*Math.log(Math.tan(Math.PI/4+E/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const j=-this._offsetYPrev+F,B=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+R)*C,this._accumulatedOffsetY+=j*C,this._accumulatedElevation+=B*C,this._offsetXPrev=R,this._offsetYPrev=F,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Pl(d,r){return[-(d[0]-Math.floor(d[0]/r)*r),-(d[1]-Math.floor(d[1]/r)*r),-(d[2]-Math.floor(d[2]/r)*r)]}function Gh(d){const r=o.ea(1323123451230),s=[];for(let f=0;f<d;++f){const _=2*r()-1,x=2*r()-1,S=2*r()-1;s.push(o.cS(_,x,S))}return s}function pc(d,r,s,f,_){const x=o.aD((_-s)/(f-s),0,1);return(1-x)*d+x*r}class na{constructor(r){this._movement=new $h,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Yc,this._ppmScaleFactor=r}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(r,s){const f=r.transform;this._movement.update(f,this._ppmScaleFactor);const _=f.starsProjMatrix,x=o.bY([]);o.b_(x,x,o.al(90)-f._pitch),o.bZ(x,x,-f.angle);const S=o.c3(new Float32Array(16),x),E=o.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),C=o.ee([],E),R=o.az([],C,S),F=Date.now()/1e3;return this._accumulatedTimeFromStart+=(F-this._prevTime)*s,this._prevTime=F,{projectionMatrix:_,modelviewMatrix:R}}}class ng extends na{constructor(r){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Bf(r.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(r){const s=r.context;if(!this.particlesVx){const f=Gh(this.particlesCount),_=new o.er,x=new o.a_;let S=0;const E=o.ea(1323123451230);for(let C=0;C<f.length;++C){const R=f[C],F=[2*E()-1,E(),E(),E()];_.emplaceBack(R[0],R[1],R[2],-1,-1,...F),_.emplaceBack(R[0],R[1],R[2],1,-1,...F),_.emplaceBack(R[0],R[1],R[2],1,1,...F),_.emplaceBack(R[0],R[1],R[2],-1,1,...F),x.emplaceBack(S+0,S+1,S+2),x.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=s.createVertexBuffer(_,Bd.members),this.particlesIdx=s.createIndexBuffer(x)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.rain)return;const s=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},f=r.transform.zoom;if(s.revealStart>f)return;const _=pc(0,1,s.revealStart,s.revealStart+s.revealRange,f);if(!this.particlesVx||!this.particlesIdx)return;const x=structuredClone(this._params);let S=[-x.direction.x,x.direction.y,-100];o.au(S,S);const E=structuredClone(this._vignetteParams);E.strength*=_,x.overrideStyleParameters||(x.intensity=r.style.rain.state.density,x.timeFactor=r.style.rain.state.intensity,x.color=structuredClone(r.style.rain.state.color),S=structuredClone(r.style.rain.state.direction),x.screenThinning.intensity=r.style.rain.state.centerThinning,x.dropletSizeX=r.style.rain.state.dropletSize[0],x.dropletSizeYScale=r.style.rain.state.dropletSize[1]/r.style.rain.state.dropletSize[0],x.distortionStrength=100*r.style.rain.state.distortionStrength,E.strength=1,E.color=structuredClone(r.style.rain.state.vignetteColor));const C=this.updateOnRender(r,x.timeFactor),R=r.context,F=R.gl,j=r.transform;this.screenTexture&&this.screenTexture.size[0]===r.width&&this.screenTexture.size[1]===r.height||(this.screenTexture=new o.T(R,{width:r.width,height:r.height,data:null},F.RGBA8)),x.distortionStrength>0&&(R.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexSubImage2D(F.TEXTURE_2D,0,0,0,0,0,r.width,r.height));const B=r.getOrCreateProgram("rainParticle");r.uploadCommonUniforms(R,B),R.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const G=[x.color.r,x.color.g,x.color.b,x.color.a],J=(Y,te)=>{const K=Pl(this._movement.getPosition(),Y),ce=x.dropletSizeX,fe=x.dropletSizeX*x.dropletSizeYScale,pe=r.width/2,Ee=r.height/2,Te=pc(0,x.screenThinning.start,0,1,x.screenThinning.intensity),we=pc(.001,x.screenThinning.range,0,1,x.screenThinning.intensity),ye=pc(0,x.screenThinning.particleOffset,0,1,x.screenThinning.intensity),Ie=(Oe={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:K,velocityConeAperture:x.velocityConeAperture,velocity:x.velocity,boxSize:Y,rainDropletSize:[ce,fe],distortionStrength:x.distortionStrength,rainDirection:S,color:G,screenSize:[j.width,j.height],thinningCenterPos:[pe,Ee],thinningShape:[Te,we,Math.pow(10,x.screenThinning.fadePower)],thinningAffectedRatio:x.screenThinning.affectedRatio,thinningParticleOffset:ye,shapeDirectionalPower:x.shapeDirPower,shapeNormalPower:x.shapeNormalPower,mode:te?0:1},{u_modelview:Float32Array.from(Oe.modelview),u_projection:Float32Array.from(Oe.projection),u_time:Oe.time,u_cam_pos:Oe.camPos,u_texScreen:0,u_velocityConeAperture:Oe.velocityConeAperture,u_velocity:Oe.velocity,u_boxSize:Oe.boxSize,u_rainDropletSize:Oe.rainDropletSize,u_distortionStrength:Oe.distortionStrength,u_rainDirection:Oe.rainDirection,u_color:Oe.color,u_screenSize:Oe.screenSize,u_thinningCenterPos:Oe.thinningCenterPos,u_thinningShape:Oe.thinningShape,u_thinningAffectedRatio:Oe.thinningAffectedRatio,u_thinningParticleOffset:Oe.thinningParticleOffset,u_shapeDirectionalPower:Oe.shapeDirectionalPower,u_shapeNormalPower:Oe.shapeNormalPower,u_mode:Oe.mode});var Oe;const Xe=Math.round(x.intensity*this.particlesCount),je=o.bd.simpleSegment(0,0,4*Xe,2*Xe);B.draw(r,F.TRIANGLES,Jt.disabled,Tr.disabled,Yr.alphaBlended,Pr.disabled,Ie,"rain_particles",this.particlesVx,this.particlesIdx,je)};x.distortionStrength>0&&J(x.boxSize,!0),J(x.boxSize,!1),this._vignette.draw(r,E)}}const qh=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class gi extends na{constructor(r){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Bf(r.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(r){const s=r.context;if(!this.particlesVx){const f=Gh(this.particlesCount),_=new o.es,x=new o.a_;let S=0;const E=o.ea(1323123451230);for(let C=0;C<f.length;++C){const R=f[C],F=E(),j=E(),B=E(),G=[C/f.length,F,j,B],J=[E(),E()];_.emplaceBack(R[0],R[1],R[2],-1,-1,...G,...J),_.emplaceBack(R[0],R[1],R[2],1,-1,...G,...J),_.emplaceBack(R[0],R[1],R[2],1,1,...G,...J),_.emplaceBack(R[0],R[1],R[2],-1,1,...G,...J),x.emplaceBack(S+0,S+1,S+2),x.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=s.createVertexBuffer(_,qh.members),this.particlesIdx=s.createIndexBuffer(x)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.snow)return;const s=structuredClone(this._params);let f=[-s.direction.x,s.direction.y,-100];o.au(f,f);const _=structuredClone(this._vignetteParams),x=s.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},S=r.transform.zoom;if(x.revealStart>S)return;const E=pc(0,1,x.revealStart,x.revealStart+x.revealRange,S);_.strength*=E,s.overrideStyleParameters||(s.intensity=r.style.snow.state.density,s.timeFactor=r.style.snow.state.intensity,s.color=structuredClone(r.style.snow.state.color),f=structuredClone(r.style.snow.state.direction),s.screenThinning.intensity=r.style.snow.state.centerThinning,s.billboardSize=2.79*r.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(r.style.snow.state.vignetteColor));const C=this.updateOnRender(r,s.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const R=r.context,F=R.gl,j=r.transform,B=r.getOrCreateProgram("snowParticle");r.uploadCommonUniforms(R,B),((G,J,Y)=>{const te=Pl(this._movement.getPosition(),G),K=j.width/2,ce=j.height/2,fe=pc(0,Y.screenThinning.start,0,1,Y.screenThinning.intensity),pe=pc(.001,Y.screenThinning.range,0,1,Y.screenThinning.intensity),Ee=pc(0,Y.screenThinning.particleOffset,0,1,Y.screenThinning.intensity),Te=(we={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:Y.velocityConeAperture,velocity:Y.velocity,horizontalOscillationRadius:Y.horizontalOscillationRadius,horizontalOscillationRate:Y.horizontalOscillationRate,boxSize:G,billboardSize:1*Y.billboardSize,simpleShapeParameters:[Y.shapeFadeStart,Y.shapeFadePower],screenSize:[j.width,j.height],thinningCenterPos:[K,ce],thinningShape:[fe,pe,Math.pow(10,Y.screenThinning.fadePower)],thinningAffectedRatio:Y.screenThinning.affectedRatio,thinningParticleOffset:Ee,color:[Y.color.r,Y.color.g,Y.color.b,Y.color.a],direction:f},{u_modelview:Float32Array.from(we.modelview),u_projection:Float32Array.from(we.projection),u_time:we.time,u_cam_pos:we.camPos,u_velocityConeAperture:we.velocityConeAperture,u_velocity:we.velocity,u_horizontalOscillationRadius:we.horizontalOscillationRadius,u_horizontalOscillationRate:we.horizontalOscillationRate,u_boxSize:we.boxSize,u_billboardSize:we.billboardSize,u_simpleShapeParameters:we.simpleShapeParameters,u_screenSize:we.screenSize,u_thinningCenterPos:we.thinningCenterPos,u_thinningShape:we.thinningShape,u_thinningAffectedRatio:we.thinningAffectedRatio,u_thinningParticleOffset:we.thinningParticleOffset,u_particleColor:we.color,u_direction:we.direction});var we;const ye=Math.round(Y.intensity*this.particlesCount),Ie=o.bd.simpleSegment(0,0,4*ye,2*ye);this.particlesVx&&this.particlesIdx&&B.draw(r,F.TRIANGLES,Jt.disabled,Tr.disabled,Yr.alphaBlended,Pr.disabled,Te,"snow_particles",this.particlesVx,this.particlesIdx,Ie)})(s.boxSize,0,s),this._vignette.draw(r,_)}}const On={symbol:function(d,r,s,f,_){if(d.renderPass!=="translucent")return;const x=Tr.disabled,S=d.colorModeForRenderPass(),E=s.layout.get("text-variable-anchor"),C=s.layout.get("text-size-scale-range"),R=o.aD(d.scaleFactor,C[0],C[1]);E&&function(B,G,J,Y,te,K,ce,fe){const pe=G.transform,Ee=te==="map",Te=K==="map";for(const we of B){const ye=Y.getTile(we),Ie=ye.getBucket(J);if(!Ie||!Ie.text||!Ie.text.segments.get().length)continue;const Oe=o.bH(Ie.textSizeData,pe.zoom,fe),Xe=Tu(we,Ie.getProjection(),pe),je=pe.calculatePixelsToTileUnitsMatrix(ye),st=ph(Xe,ye.tileID.canonical,Te,Ee,pe,Ie.getProjection(),je),ct=Ie.hasIconTextFit()&&Ie.hasIconData();Oe&&Wc(Ie,Ee,Te,ce,pe,st,we,Math.pow(2,pe.zoom-ye.tileID.overscaledZ),Oe,ct)}}(f,d,s,r,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),_,R);const F=s.paint.get("icon-opacity").constantOr(1)!==0,j=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||j)?Uh(d,r,s,f,x,S):(F&&Uh(d,r,s,f,x,S,{onlyIcons:!0}),j&&Uh(d,r,s,f,x,S,{onlyText:!0})),r.map.showCollisionBoxes&&(Zs(d,r,s,f,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Zs(d,r,s,f,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(d,r,s,f){if(d.renderPass!=="translucent")return;const _=s.paint.get("circle-opacity"),x=s.paint.get("circle-stroke-width"),S=s.paint.get("circle-stroke-opacity"),E=s.layout.get("circle-sort-key").constantOr(1)!==void 0,C=s.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(x.constantOr(1)===0||S.constantOr(1)===0))return;const R=d.context,F=R.gl,j=d.transform,B=d.depthModeForSublayer(0,Jt.ReadOnly),G=Tr.disabled,J=d.colorModeForDrapableLayerRenderPass(C),Y=j.projection.name==="globe",te=[o.ay(j.center.lng),o.aH(j.center.lat)],K=[];for(let fe=0;fe<f.length;fe++){const pe=f[fe],Ee=r.getTile(pe),Te=Ee.getBucket(s);if(!Te||Te.projection.name!==j.projection.name)continue;const we=Te.programConfigurations.get(s.id),ye=o.dK(s),Ie=d.isTileAffectedByFog(pe);Y&&ye.push("PROJECTION_GLOBE_VIEW"),ye.push("DEPTH_D24"),d.terrain&&j.depthOcclusionForSymbolsAndCircles&&ye.push("DEPTH_OCCLUSION");const Oe=d.getOrCreateProgram("circle",{config:we,defines:ye,overrideFog:Ie}),Xe=Te.layoutVertexBuffer,je=Te.globeExtVertexBuffer,st=Te.indexBuffer,ct=j.projection.createInversionMatrix(j,pe.canonical),Et={programConfiguration:we,program:Oe,layoutVertexBuffer:Xe,globeExtVertexBuffer:je,indexBuffer:st,uniformValues:o.dL(d,pe,Ee,ct,te,s),tile:Ee};if(E){const Ve=Te.segments.get();for(const He of Ve)K.push({segments:new o.bd([He]),sortKey:He.sortKey,state:Et})}else K.push({segments:Te.segments,sortKey:0,state:Et})}E&&K.sort((fe,pe)=>fe.sortKey-pe.sortKey);const ce={useDepthForOcclusion:j.depthOcclusionForSymbolsAndCircles};for(const fe of K){const{programConfiguration:pe,program:Ee,layoutVertexBuffer:Te,globeExtVertexBuffer:we,indexBuffer:ye,uniformValues:Ie,tile:Oe}=fe.state,Xe=fe.segments;d.terrain&&d.terrain.setupElevationDraw(Oe,Ee,ce),d.uploadCommonUniforms(R,Ee,Oe.tileID.toUnwrapped()),Ee.draw(d,F.TRIANGLES,B,G,J,Pr.disabled,Ie,s.id,Te,ye,Xe,s.paint,j.zoom,pe,[we])}},heatmap:function(d,r,s,f){if(s.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const _=d.context,x=_.gl,S=Tr.disabled,E=new Yr([x.ONE,x.ONE,x.ONE,x.ONE],o.am.transparent,[!0,!0,!0,!0]);(function(G,J,Y,te){const K=G.gl,ce=J.width*te,fe=J.height*te;G.activeTexture.set(K.TEXTURE1),G.viewport.set([0,0,ce,fe]);let pe=Y.heatmapFbo;if(!pe||pe&&(pe.width!==ce||pe.height!==fe)){pe&&pe.destroy();const Ee=K.createTexture();K.bindTexture(K.TEXTURE_2D,Ee),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),pe=Y.heatmapFbo=G.createFramebuffer(ce,fe,!0,null),function(Te,we,ye,Ie,Oe,Xe){const je=Te.gl;je.texImage2D(je.TEXTURE_2D,0,Te.extRenderToTextureHalfFloat?je.RGBA16F:je.RGBA,Oe,Xe,0,je.RGBA,Te.extRenderToTextureHalfFloat?je.HALF_FLOAT:je.UNSIGNED_BYTE,null),Ie.colorAttachment.set(ye)}(G,0,Ee,pe,ce,fe)}else K.bindTexture(K.TEXTURE_2D,pe.colorAttachment.get()),G.bindFramebuffer.set(pe.framebuffer)})(_,d,s,d.transform.projection.name==="globe"?.5:.25),_.clear({color:o.am.transparent});const C=d.transform,R=C.projection.name==="globe",F=R?["PROJECTION_GLOBE_VIEW"]:[],j=R?Pr.frontCCW:Pr.disabled,B=[o.ay(C.center.lng),o.aH(C.center.lat)];for(let G=0;G<f.length;G++){const J=f[G];if(r.hasRenderableParent(J))continue;const Y=r.getTile(J),te=Y.getBucket(s);if(!te||te.projection.name!==C.projection.name)continue;const K=d.isTileAffectedByFog(J),ce=te.programConfigurations.get(s.id),fe=d.getOrCreateProgram("heatmap",{config:ce,defines:F,overrideFog:K}),{zoom:pe}=d.transform;d.terrain&&d.terrain.setupElevationDraw(Y,fe),d.uploadCommonUniforms(_,fe,J.toUnwrapped());const Ee=C.projection.createInversionMatrix(C,J.canonical);fe.draw(d,x.TRIANGLES,Jt.disabled,S,E,j,bl(d,J,Y,Ee,B,pe,s.paint.get("heatmap-intensity")),s.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,s.paint,d.transform.zoom,ce,R?[te.globeExtVertexBuffer]:null)}_.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(_,x){const S=_.context,E=S.gl,C=x.heatmapFbo;if(!C)return;S.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment.get()),S.activeTexture.set(E.TEXTURE1);let R=x.colorRampTexture;R||(R=x.colorRampTexture=new o.T(S,x.colorRamp,E.RGBA8)),R.bind(E.LINEAR,E.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,E.TRIANGLES,Jt.disabled,Tr.disabled,_.colorModeForRenderPass(),Pr.disabled,((F,j,B,G)=>({u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}))(0,x),x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(d,s))},line:function(d,r,s,f){if(d.renderPass!=="translucent")return;const _=s.paint.get("line-opacity"),x=s.paint.get("line-width");if(_.constantOr(1)===0||x.constantOr(1)===0)return;const S=s.paint.get("line-emissive-strength"),E=s.paint.get("line-occlusion-opacity"),C=s.layout.get("line-elevation-reference"),R=s.layout.get("line-width-unit")==="meters",F=C==="sea",j=!(!d.terrain||!d.terrain.enabled),B=d.context,G=B.gl;if(s.hasElevatedBuckets&&d.transform.projection.name==="globe")return;const J=s.layout.get("line-cross-slope"),Y=J!==void 0,te=J<1,K=d.colorModeForDrapableLayerRenderPass(S),ce=d.terrain&&d.terrain.renderingToTexture,fe=ce?1:o.q.devicePixelRatio,pe=s.paint.get("line-dasharray"),Ee=pe.constantOr(1),Te=s.layout.get("line-cap"),we=pe.constantOr(null),ye=Te.constantOr(null),Ie=s.paint.get("line-pattern"),Oe=Ie.constantOr(1),Xe=s.paint.get("line-pattern-cross-fade"),je=Ie.constantOr(null),st=s.paint.get("line-opacity").constantOr(1);let ct=!Oe&&st!==1||d.depthOcclusion&&E>0&&E<1;const Et=s.paint.get("line-gradient"),Ve=Oe?"linePattern":"line",He=o.dM(s);let Ue;if(ce&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(ct=!1),E!==0&&d.depthOcclusion){const dt=s.paint._values["line-opacity"];dt&&dt.value&&dt.value.kind==="constant"?Ue=dt.value:o.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}x.value.kind!=="constant"&&x.value.isLineProgressConstant===!1&&He.push("VARIABLE_LINE_WIDTH");const ft=(dt,vt,bt,Yt,tr,Bt)=>{for(const er of dt){const Wt=r.getTile(er);if(Oe&&!Wt.patternsLoaded())continue;const hr=Wt.getBucket(s);if(!hr||hr.elevationType!=="none"&&!tr||hr.elevationType==="none"&&tr)continue;d.prepareDrawTile();const Or=[...vt],rn=d.shadowRenderer,Gn=hr.elevationType==="road"&&!!rn&&rn.enabled;let qn=[0,0,0];if(Gn){const Zr=d.style.directionalLight,di=d.style.ambientLight;Zr&&di&&(qn=bs(d.style,Zr,di)),Or.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Hr=hr.programConfigurations.get(s.id);let Li=!1;if(je&&Wt.imageAtlas){const Zr=o.dN.from(je),di=Zr.getPrimary().scaleSelf(fe).toString(),In=Wt.imageAtlas.patternPositions.get(di),Yn=Zr.getSecondary(),Fn=Yn?Wt.imageAtlas.patternPositions.get(Yn.scaleSelf(fe).toString()):null;Li=!!In&&!!Fn,In&&Hr.setConstantPatternPositions(In,Fn)}Xe>0&&(Li||Hr.getPatternTransitionVertexBuffer("line-pattern"))&&Or.push("LINE_PATTERN_TRANSITION");const _i=d.isTileAffectedByFog(er),Rr=d.getOrCreateProgram(Ve,{config:Hr,defines:Or,overrideFog:_i,overrideRtt:!tr&&void 0});if(!Oe&&we&&ye&&Wt.lineAtlas){const Zr=Wt.lineAtlas.getDash(we,ye);Zr&&Hr.setConstantPatternPositions(Zr)}Gn&&rn.setupShadows(Wt.tileID.toUnwrapped(),Rr,"vector-tile",Wt.tileID.overscaledZ);let[_n,yn]=s.paint.get("line-trim-offset");(ye==="round"||ye==="square")&&_n!==yn&&(_n===0&&(_n-=1),yn===1&&(yn+=1));const Wn=ce?er.projMatrix:null,no=R?1/hr.tileToMeter/o.aw(Wt,1,d.transform.zoom):1,zi=R?1/hr.tileToMeter/o.aw(Wt,1,Math.floor(d.transform.zoom)):1,Gi=Oe?o.dO(d,Wt,s,Wn,fe,no,zi,[_n,yn],qn,Xe):o.dP(d,Wt,s,Wn,hr.lineClipsArray.length,fe,no,zi,[_n,yn],qn);if(Et){const Zr=hr.gradients[s.id];let di=Zr.texture;if(s.gradientVersion!==Zr.version){let In=256;if(s.stepInterpolant){const Yn=r.getSource().maxzoom,Fn=er.canonical.z===Yn?Math.ceil(1<<d.transform.maxZoom-er.canonical.z):1;In=o.aD(o.dQ(hr.maxLineLength/o.aj*1024*Fn),256,B.maxTextureSize)}Zr.gradient=o.dR({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:In,image:Zr.gradient||void 0,clips:hr.lineClipsArray}),Zr.texture?Zr.texture.update(Zr.gradient):Zr.texture=new o.T(B,Zr.gradient,G.RGBA8),Zr.version=s.gradientVersion,di=Zr.texture}B.activeTexture.set(G.TEXTURE1),di.bind(s.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}Ee&&(B.activeTexture.set(G.TEXTURE0),Wt.lineAtlasTexture&&Wt.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),Hr.updatePaintBuffers()),Oe&&(B.activeTexture.set(G.TEXTURE0),Wt.imageAtlasTexture&&Wt.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Hr.updatePaintBuffers()),tr&&!F&&d.terrain.setupElevationDraw(Wt,Rr),d.uploadCommonUniforms(B,Rr,er.toUnwrapped());const Ti=Zr=>{Ue!=null&&(Ue.value=st*E),Rr.draw(d,G.TRIANGLES,bt,Zr,K,Pr.disabled,Gi,s.id,hr.layoutVertexBuffer,hr.indexBuffer,hr.segments,s.paint,d.transform.zoom,Hr,[hr.layoutVertexBuffer2,hr.patternVertexBuffer,hr.zOffsetVertexBuffer]),Ue!=null&&(Ue.value=st)};if(ct&&!tr){const Zr=d.stencilModeForClipping(er).ref;Zr===0&&ce&&B.clear({stencil:0});const di={func:G.EQUAL,mask:255};Gi.u_alpha_discard_threshold=.8,Ti(new Tr(di,Zr,255,G.KEEP,G.KEEP,G.INVERT)),Gi.u_alpha_discard_threshold=0,Ti(new Tr(di,Zr,255,G.KEEP,G.KEEP,G.KEEP))}else Gi.u_alpha_discard_threshold=ct&&tr&&Bt?.8:0,Ti(tr?Yt:d.stencilModeForClipping(er))}};let Ke=d.depthModeForSublayer(0,Jt.ReadOnly);const gt=new Jt(d.depthOcclusion?G.GREATER:G.LEQUAL,Jt.ReadOnly,d.depthRangeFor3D);if(s.hasNonElevatedBuckets){const dt=!ce&&d.terrain;E!==0&&dt?o.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`):dt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${s.id}.`):ft(f,He,Ke,Tr.disabled,!1,!0)}if(s.hasElevatedBuckets){C==="hd-road-markup"?j||(Ke=gt,He.push("ELEVATED_ROADS")):(He.push("ELEVATED"),Ke=gt,Y&&He.push(te?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),F&&He.push("ELEVATION_REFERENCE_SEA"));const dt=ct?d.stencilModeFor3D():Tr.disabled;d.forceTerrainMode=!0,ft(f,He,Ke,dt,!0,!0),ct&&ft(f,He,Ke,dt,!0,!1),d.forceTerrainMode=!1}ct&&(d.resetStencilClippingMasks(),ce&&B.clear({stencil:0})),E===0||d.depthOcclusion||ce||d.layersWithOcclusionOpacity.push(d.currentLayer)},fill:function(d,r,s,f){const _=s.paint.get("fill-color"),x=s.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const S=s.paint.get("fill-emissive-strength"),E=d.colorModeForDrapableLayerRenderPass(S),C=s.paint.get("fill-pattern"),R=d.opaquePassEnabledForLayer()&&!C.constantOr(1)&&_.constantOr(o.am.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";let F="none";s.layout.get("fill-elevation-reference")!=="none"?F="road":s.paint.get("fill-z-offset").constantOr(1)!==0&&(F="offset");const j=!(!d.terrain||!d.terrain.enabled),B={painter:d,sourceCache:r,layer:s,coords:f,colorMode:E,elevationType:F,terrainEnabled:j,pass:R};if(d.renderPass!=="shadow")if(F!=="offset"){if(qt(B,!1),F==="road"){const G=!j&&d.renderPass==="translucent";G&&Uu(d,r,s,f,"geometry"),qt(B,!0,Tr.disabled),G&&function(J){const{painter:Y,sourceCache:te,layer:K,coords:ce,colorMode:fe}=J,pe=Y.context.gl,Ee=J.painter.shadowRenderer,Te=!!Ee&&Ee.enabled,we=new Jt(Y.context.gl.LEQUAL,Jt.ReadOnly,Y.depthRangeFor3D);let ye=[0,0,0];if(Te){const Ie=Y.style.directionalLight,Oe=Y.style.ambientLight;Ie&&Oe&&(ye=bs(Y.style,Ie,Oe))}for(const Ie of ce){const Oe=te.getTile(Ie),Xe=Oe.getBucket(K);if(!Xe)continue;const je=Xe.elevatedStructures;if(!je||!je.renderableSegments||je.renderableSegments.segments[0].primitiveLength===0)continue;Y.prepareDrawTile();const st=Xe.bufferData.programConfigurations.get(K.id),ct=Y.isTileAffectedByFog(Ie),Et=[];Te&&Et.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Ve=Y.getOrCreateProgram("elevatedStructures",{config:st,overrideFog:ct,defines:Et}),He=Y.translatePosMatrix(Ie.projMatrix,Oe,K.paint.get("fill-translate"),K.paint.get("fill-translate-anchor"));Te&&Ee.setupShadows(Oe.tileID.toUnwrapped(),Ve,"vector-tile",Oe.tileID.overscaledZ);const Ue=Fh(He,ye);Y.uploadCommonUniforms(Y.context,Ve,Ie.toUnwrapped()),Ve.draw(Y,pe.TRIANGLES,we,Tr.disabled,fe,Pr.backCCW,Ue,K.id,je.vertexBuffer,je.indexBuffer,je.renderableSegments,K.paint,Y.transform.zoom,st,[je.vertexBufferNormal])}}(B)}}else qt(B,!1,d.stencilModeFor3D());else d.shadowRenderer&&F==="road"&&!j&&function(G){const{painter:J,sourceCache:Y,layer:te,coords:K}=G,ce=J.context.gl,fe=G.painter.shadowRenderer;for(const pe of K){const Ee=Y.getTile(pe),Te=Ee.getBucket(te);if(!Te)continue;const we=Te.elevatedStructures;if(!we||!we.shadowCasterSegments||we.shadowCasterSegments.segments[0].primitiveLength===0)continue;J.prepareDrawTile();const ye=Te.bufferData.programConfigurations.get(te.id),Ie=J.isTileAffectedByFog(pe),Oe=J.getOrCreateProgram("elevatedStructuresDepth",{config:ye,overrideFog:Ie}),Xe=fe.calculateShadowPassMatrixFromTile(Ee.tileID.toUnwrapped());J.uploadCommonUniforms(J.context,Oe,pe.toUnwrapped());const je={u_matrix:Xe,u_depth_bias:.001};Oe.draw(J,ce.TRIANGLES,fe.getShadowPassDepthMode(),Tr.disabled,fe.getShadowPassColorMode(),Pr.disabled,je,te.id,we.vertexBuffer,we.indexBuffer,we.shadowCasterSegments,te.paint,J.transform.zoom,ye)}}(B)},"fill-extrusion":function(d,r,s,f){const _=s.paint.get("fill-extrusion-opacity"),x=d.context,S=x.gl,E=d.terrain,C=E&&E.renderingToTexture;if(_===0)return;const R=d.conflationActive&&d.style.isLayerClipped(s,r.getSource()),F=d.style.order.indexOf(s.fqid);if(R&&function(j,B,G,J,Y){for(const te of J){const K=B.getTile(te).getBucket(G);K&&(K.updateReplacement(te,j.replacementSource,Y),K.uploadCentroid(j.context))}}(d,r,s,f,F),E||R)for(const j of f){const B=r.getTile(j).getBucket(s);B&&Tl(d.context,r,j,B,s,E,R)}if(d.renderPass==="shadow"&&d.shadowRenderer){const j=d.shadowRenderer;if(E&&_<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ab)return;const B=j.getShadowPassDepthMode(),G=j.getShadowPassColorMode();ba(d,r,s,f,B,Tr.disabled,G,R)}else if(d.renderPass==="translucent"){const j=!s.paint.get("fill-extrusion-pattern").constantOr(1),B=s.paint.get("fill-extrusion-color").constantOr(o.am.white);if(!C&&B.a!==0){const G=new Jt(d.context.gl.LEQUAL,Jt.ReadWrite,d.depthRangeFor3D);_===1&&j?ba(d,r,s,f,G,Tr.disabled,Yr.unblended,R):(ba(d,r,s,f,G,Tr.disabled,Yr.disabled,R),ba(d,r,s,f,G,d.stencilModeFor3D(),d.colorModeForRenderPass(),R),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&j&&(!E&&d.transform.projection.name!=="globe"||C)){const G=s.paint.get("fill-extrusion-opacity"),J=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),te=s.paint.get("fill-extrusion-flood-light-intensity"),K=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ce=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(K?null:s.lut).toArray01().slice(0,3),fe=J>0&&Y>0,pe=te>0,Ee=(we,ye,Ie)=>(1-Ie)*we+Ie*ye,Te=we=>{const ye=d.depthModeForSublayer(1,Jt.ReadOnly,S.LEQUAL,!0),Ie=s.paint.get(we?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Oe=Ee(.1,3,Ie),Xe=d._showOverdrawInspector;if(!Xe){const je=new Tr({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),st=new Yr([S.ONE,S.ONE,S.ONE,S.ONE],o.am.transparent,[!1,!1,!1,!0],S.MIN);ls(d,r,s,f,ye,je,st,Pr.disabled,we,"sdf",G,J,Y,te,ce,Oe,R,!1)}{const je=Xe?Tr.disabled:new Tr({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),st=Xe?d.colorModeForRenderPass():new Yr([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],o.am.transparent,[!0,!0,!0,!0]);ls(d,r,s,f,ye,je,st,Pr.disabled,we,"color",G,J,Y,te,ce,Oe,R,!1)}};if(C){const we=(ye,Ie,Oe)=>{const Xe=d.depthModeForSublayer(1,Jt.ReadOnly,S.LEQUAL,!1),je=s.paint.get(ye?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),st=Ee(.1,3,je);{const ct=new Yr([S.ONE,S.ONE,S.ONE,S.ONE],o.am.transparent,[!1,!1,!1,!0]);ls(d,r,s,f,Xe,Tr.disabled,ct,Pr.disabled,ye,"clear",G,J,Y,te,ce,st,R,Ie)}{const ct=new Tr({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Et=new Yr([S.ONE,S.ONE,S.ONE,S.ONE],o.am.transparent,[!1,!1,!1,!0],S.MIN);ls(d,r,s,f,Xe,ct,Et,Pr.disabled,ye,"sdf",G,J,Y,te,ce,st,R,Ie)}{const ct=ye?S.ZERO:S.ONE_MINUS_DST_ALPHA,Et=new Tr({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Ve=new Yr([ct,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],o.am.transparent,[!0,!0,!0,!0]);ls(d,r,s,f,Xe,Et,Ve,Pr.disabled,ye,"color",G,J,Y,te,ce,st,R,Ie)}{const ct=new Yr([S.ONE,S.ONE,S.ONE,ye?S.ZERO:S.ONE],o.am.transparent,[!1,!1,!1,!0],ye?S.FUNC_ADD:S.MAX);ls(d,r,s,f,Xe,Tr.disabled,ct,Pr.disabled,ye,"clear",G,J,Y,te,ce,st,R,Ie,Oe)}};if(fe||pe){let ye;if(d.prepareDrawTile(),E){const Ie=E.drapeBufferSize[0],Oe=E.drapeBufferSize[1];ye=E.framebufferCopyTexture,ye&&(!ye||ye.size[0]===Ie&&ye.size[1]===Oe)||(ye&&ye.destroy(),ye=E.framebufferCopyTexture=new o.T(x,new o.r({width:Ie,height:Oe}),S.RGBA8)),ye.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexSubImage2D(S.TEXTURE_2D,0,0,0,0,0,Ie,Oe)}fe&&we(!0,!1,ye),pe&&we(!1,!0,ye)}}else fe&&Te(!0),pe&&Te(!1),(fe||pe)&&d.resetStencilClippingMasks()}}},hillshade:function(d,r,s,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const _=d.context,x=d.terrain&&d.terrain.renderingToTexture,[S,E]=d.renderPass!=="translucent"||x?[{},f]:d.stencilConfigForOverlap(f);for(const C of E){const R=r.getTile(C);if(R.needsHillshadePrepare&&d.renderPass==="offscreen")zp(d,R,s);else if(d.renderPass==="translucent"){const F=d.depthModeForSublayer(0,Jt.ReadOnly),j=s.paint.get("hillshade-emissive-strength"),B=d.colorModeForDrapableLayerRenderPass(j),G=x&&d.terrain?d.terrain.stencilModeForRTTOverlap(C):S[C.overscaledZ];Km(d,C,R,s,F,G,B)}}_.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,r,s,f,_,x){if(d.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const S=d.transform.projection.name==="globe",E=s.paint.get("raster-elevation")!==0,C=E&&S;if(d.renderElevatedRasterBackface&&!C)return;const R=d.context,F=R.gl,j=r.getSource(),B=function(Te,we,ye,Ie){const Oe=we.paint.get("raster-color"),Xe=Te.type==="raster-array",je=[],st=we.paint.get("raster-resampling"),ct=we.paint.get("raster-color-mix");let Et=we.paint.get("raster-color-range");const Ve=[ct[0],ct[1],ct[2],0],He=ct[3];let Ue=st==="nearest"?Ie.NEAREST:Ie.LINEAR;if(Xe&&(je.push("RASTER_ARRAY"),Oe||je.push("RASTER_COLOR"),st==="linear"&&je.push("RASTER_ARRAY_LINEAR"),Ue=Ie.NEAREST,!Et&&Te.rasterLayers)){const ft=Te.rasterLayers.find(({id:Ke})=>Ke===we.sourceLayer);ft&&ft.fields&&ft.fields.range&&(Et=ft.fields.range)}if(Et=Et||[0,1],Oe){je.push("RASTER_COLOR"),ye.activeTexture.set(Ie.TEXTURE2),we.updateColorRamp(Et);let ft=we.colorRampTexture;ft||(ft=we.colorRampTexture=new o.T(ye,we.colorRamp,Ie.RGBA8)),ft.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}return{mix:Ve,range:Et,offset:He,defines:je,resampling:Ue}}(j,s,R,F);if(j instanceof o.aP&&!f.length&&!S)return;const G=s.paint.get("raster-emissive-strength"),J=d.colorModeForDrapableLayerRenderPass(G),Y=d.terrain&&d.terrain.renderingToTexture,te=!d.options.moving,K=s.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(j instanceof o.aP&&!f.length&&(j.onNorthPole||j.onSouthPole)){const Te=E?d.stencilModeFor3D():Tr.disabled;return void cs(!!j.onNorthPole,null,d,r,s,G,B,Pr.disabled,Te)}if(!f.length)return;const[ce,fe]=j instanceof o.aP||Y?[{},f]:d.stencilConfigForOverlap(f),pe=fe[fe.length-1].overscaledZ;C&&B.defines.push("PROJECTION_GLOBE_VIEW"),E&&B.defines.push("RENDER_CUTOFF");const Ee=(Te,we,ye)=>{for(const Ie of Te){const Oe=Ie.toUnwrapped(),Xe=r.getTile(Ie);if(Y&&(!Xe||!Xe.hasData()))continue;R.activeTexture.set(F.TEXTURE0);const je=Rf(Xe,j,s,B);if(!je||!je.texture)continue;const{texture:st,mix:ct,offset:Et,tileSize:Ve,buffer:He}=je;let Ue,ft;Y?(Ue=Jt.disabled,ft=Ie.projMatrix):E?(Ue=new Jt(F.LEQUAL,Jt.ReadWrite,d.depthRangeFor3D),ft=S?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(Oe,te)):(Ue=d.depthModeForSublayer(Ie.overscaledZ-pe,s.paint.get("raster-opacity")===1?Jt.ReadWrite:Jt.ReadOnly,F.LESS),ft=d.transform.calculateProjMatrix(Oe,te));const Ke=d.terrain&&Y?d.terrain.stencilModeForRTTOverlap(Ie):ce[Ie.overscaledZ],gt=x?0:s.paint.get("raster-fade-duration");Xe.registerFadeDuration(gt);const dt=r.findLoadedParent(Ie,0),vt=zo(Xe,dt,r,d.transform,gt);let bt,Yt;d.terrain&&d.terrain.prepareDrawTile(),R.activeTexture.set(F.TEXTURE0),st.bind(K,F.CLAMP_TO_EDGE),R.activeTexture.set(F.TEXTURE1),dt?(dt.texture&&dt.texture.bind(K,F.CLAMP_TO_EDGE),bt=Math.pow(2,dt.tileID.overscaledZ-Xe.tileID.overscaledZ),Yt=[Xe.tileID.canonical.x*bt%1,Xe.tileID.canonical.y*bt%1]):st.bind(K,F.CLAMP_TO_EDGE),"useMipmap"in st&&R.extTextureFilterAnisotropic&&d.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const tr=d.transform;let Bt;const er=E?dc(tr):[0,0,0,0];let Wt,hr,Or,rn,Gn,qn=0;if(C&&j instanceof o.aP&&j.coordinates.length>3)Wt=Float32Array.from(o.bh(o.dr(new o.cp(0,0,0)))),hr=Float32Array.from(tr.globeMatrix),Or=Float32Array.from(o.dm(tr)),rn=[o.ay(tr.center.lng),o.aH(tr.center.lat)],Bt=j.elevatedGlobePerspectiveTransform,Gn=j.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){const Rr=o.dn(Ie.canonical);qn=o.dp(Rr.getCenter().lat),Wt=Float32Array.from(o.bh(o.dr(Ie.canonical))),hr=Float32Array.from(tr.globeMatrix),Or=Float32Array.from(o.dm(tr)),rn=[o.ay(tr.center.lng),o.aH(tr.center.lat)],Bt=[0,0],Gn=Float32Array.from(o.dq(Ie.canonical,Rr,qn,tr.worldSize/tr._pixelsPerMercatorPixel))}else Bt=j instanceof o.aP?j.perspectiveTransform:[0,0],Wt=new Float32Array(16),hr=new Float32Array(9),Or=new Float32Array(16),rn=[0,0],Gn=new Float32Array(9);const Hr=wl(ft,Wt,hr,Or,Gn,Yt||[0,0],o.ah(d.transform.zoom),rn,er,bt||1,vt,s,Bt,E?s.paint.get("raster-elevation"):0,2,ct,Et,B.range,Ve,He,G),Li=d.isTileAffectedByFog(Ie),_i=d.getOrCreateProgram("raster",{defines:B.defines,overrideFog:Li});if(d.uploadCommonUniforms(R,_i,Oe),j instanceof o.aP){const Rr=j.elevatedGlobeVertexBuffer,_n=j.elevatedGlobeIndexBuffer;if(Y||!S)j.boundsBuffer&&j.boundsSegments&&_i.draw(d,F.TRIANGLES,Ue,Tr.disabled,J,Pr.disabled,Hr,s.id,j.boundsBuffer,d.quadTriangleIndexBuffer,j.boundsSegments);else if(Rr&&_n){const yn=tr.zoom<=o.cL?j.elevatedGlobeSegments:j.getSegmentsForLongitude(tr.center.lng);yn&&_i.draw(d,F.TRIANGLES,Ue,Tr.disabled,J,we,Hr,s.id,Rr,_n,yn)}}else if(C){Ue=new Jt(F.LEQUAL,Jt.ReadOnly,d.depthRangeFor3D);const Rr=d.globeSharedBuffers;if(Rr){const[_n,yn,Wn]=Rr.getGridBuffers(qn,!1);_i.draw(d,F.TRIANGLES,Ue,ye||Ke,d.colorModeForRenderPass(),we,Hr,s.id,_n,yn,Wn)}}else{const{tileBoundsBuffer:Rr,tileBoundsIndexBuffer:_n,tileBoundsSegments:yn}=d.getTileBoundsBuffers(Xe);_i.draw(d,F.TRIANGLES,Ue,Ke,J,Pr.disabled,Hr,s.id,Rr,_n,yn)}}if(!(j instanceof o.aP)&&C)for(const Ie of Te){const Oe=Ie.canonical.y===(1<<Ie.canonical.z)-1;Ie.canonical.y===0&&cs(!0,Ie,d,r,s,G,B,we,ye||Tr.disabled),Oe&&cs(!1,Ie,d,r,s,G,B,we===Pr.frontCW?Pr.backCW:Pr.frontCW,ye||Tr.disabled)}};C?Ee(fe,d.renderElevatedRasterBackface?Pr.backCW:Pr.frontCW,d.stencilModeFor3D()):Ee(fe,Pr.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,r,s,f,_,x){d.renderPass==="offscreen"&&function(S,E,C,R){if(!R.length)return;const F=S.context,j=F.gl,B=E.getSource();if(!(B instanceof _u))return;const G=Math.ceil(Math.sqrt(C.paint.get("raster-particle-count")));let J=C.particlePositionRGBAImage;if(!J||J.width!==G){const fe=function(pe){const Ee=pe*pe,Te=new Uint8Array(4*Ee),we=function(Ie){return Ie|=0,Ie=Math.imul(2747636419^Ie,2654435769),Ie=Math.imul(Ie^Ie>>>16,2654435769),((Ie=Math.imul(Ie^Ie>>>16,2654435769))>>>0)/4294967296},ye=1/1.1;for(let Ie=0;Ie<Ee;Ie++){const Oe=ye*(we(2*Ie+0)+so),Xe=ye*(we(2*Ie+1)+so),je=255*Oe%1,st=255*Xe%1,ct=je,Et=Xe-st/255,Ve=st;Te[4*Ie+0]=255*(Oe-je/255),Te[4*Ie+1]=255*ct,Te[4*Ie+2]=255*Et,Te[4*Ie+3]=255*Ve}return Te}(G);J=C.particlePositionRGBAImage=new o.r({width:G,height:G},fe)}let Y=C.particleFramebuffer;Y?Y.width!==G&&(Y.destroy(),Y=C.particleFramebuffer=F.createFramebuffer(G,G,!0,null)):Y=C.particleFramebuffer=F.createFramebuffer(G,G,!0,null);const te=[];for(const fe of R){const pe=E.getTile(fe);if(!(pe instanceof uh))continue;const Ee=eg(pe,B,C);if(!Ee)continue;const Te=[pe.tileSize,pe.tileSize];let we=C.tileFramebuffer;we||(we=C.tileFramebuffer=F.createFramebuffer(Te[0],Te[1],!0,null));let ye=pe.rasterParticleState;ye||(ye=pe.rasterParticleState=new Lf(F,fe,Te,J));const Ie=ye.update(C.lastInvalidatedAt);ye.particleTextureDimension!==G&&ye.updateParticleTexture(fe,J);const Oe=ye.targetColorTexture;ye.targetColorTexture=ye.backgroundColorTexture,ye.backgroundColorTexture=Oe;const Xe=ye.particleTexture0;ye.particleTexture0=ye.particleTexture1,ye.particleTexture1=Xe,te.push([fe,Ee,ye,Ie])}if(te.length===0)return;const K=o.q.now(),ce=C.previousDrawTimestamp?.001*(K-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=K,C.hasColorMap()){F.activeTexture.set(j.TEXTURE0+2);let fe=C.colorRampTexture;fe||(fe=C.colorRampTexture=new o.T(F,C.colorRamp,j.RGBA8)),fe.bind(j.LINEAR,j.CLAMP_TO_EDGE)}F.bindFramebuffer.set(C.tileFramebuffer.framebuffer),function(fe,pe,Ee){const Te=fe.context,we=Te.gl,ye=pe.tileFramebuffer;Te.activeTexture.set(we.TEXTURE0);const Ie={u_texture:0,u_opacity:1.05*(Xe=pe.paint.get("raster-particle-fade-opacity-factor"))/(Xe+.05)},Oe=fe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Xe;for(const je of Ee){const[,,st,ct]=je;ye.colorAttachment.set(st.targetColorTexture.texture),Te.viewport.set([0,0,ye.width,ye.height]),Te.clear({color:o.am.transparent}),ct&&(st.backgroundColorTexture.bind(we.NEAREST,we.CLAMP_TO_EDGE),Oe.draw(fe,we.TRIANGLES,Jt.disabled,Tr.disabled,Yr.alphaBlended,Pr.disabled,Ie,pe.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments))}}(S,C,te),function(fe,pe,Ee,Te){const we=fe.context,ye=we.gl,Ie=Ee.tileFramebuffer,Oe=fe.transform.projection.name==="globe",Xe=Ee.paint.get("raster-particle-max-speed");for(const je of Te){const[st,ct,Et]=je;we.activeTexture.set(ye.TEXTURE0+0),ct.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),Ie.colorAttachment.set(Et.targetColorTexture.texture);const Ve=fe.getOrCreateProgram("rasterParticleDraw",{defines:ct.defines,overrideFog:!1});we.activeTexture.set(ye.TEXTURE0+1);const He=ct.scalarData?[]:[0,1,2,3].map(Ke=>o.dU[Ke](st));He.push(st);const Ue=st.canonical.x,ft=st.canonical.y;for(const Ke of He){const gt=pe.getTile(Oe?Ke.wrapped():Ke);if(!gt)continue;const dt=gt.rasterParticleState;if(!dt)continue;const vt=Ke.canonical.x+(1<<Ke.canonical.z)*(Ke.wrap-st.wrap),bt=Ke.canonical.y;dt.particleTexture0.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);const Yt=Qi(1,dt.particleTexture0.size[0],[vt-Ue,bt-ft],0,ct.texture.size,2,Xe,ct.textureOffset,ct.scale,ct.offset);Ve.draw(fe,ye.POINTS,Jt.disabled,Tr.disabled,Yr.alphaBlended,Pr.disabled,Yt,Ee.id,dt.particleIndexBuffer,void 0,dt.particleSegment)}}}(S,E,C,te),F.bindFramebuffer.set(C.particleFramebuffer.framebuffer),function(fe,pe,Ee,Te){const we=fe.context,ye=we.gl,Ie=pe.paint.get("raster-particle-max-speed"),Oe=Te*pe.paint.get("raster-particle-speed-factor")*.15,Xe=function(st){return Math.pow(st,6)}(.01+1*pe.paint.get("raster-particle-reset-rate-factor")),je=pe.particleFramebuffer;we.viewport.set([0,0,je.width,je.height]);for(const st of Ee){const[,ct,Et]=st;we.activeTexture.set(ye.TEXTURE0+0),ct.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),we.activeTexture.set(ye.TEXTURE0+1);const Ve=Et.particleTexture0;Ve.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);const He=Es(1,Ve.size[0],0,ct.texture.size,Ie,Oe,Xe,ct.textureOffset,ct.scale,ct.offset);je.colorAttachment.set(Et.particleTexture1.texture),we.clear({color:o.am.transparent}),fe.getOrCreateProgram("rasterParticleUpdate",{defines:ct.defines}).draw(fe,ye.TRIANGLES,Jt.disabled,Tr.disabled,Yr.unblended,Pr.disabled,He,pe.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments)}}(S,C,te,ce)}(d,r,s,f),d.renderPass==="translucent"&&(function(S,E,C,R,F){const j=S.context,B=j.gl,G=E.getSource().tileSize,J=5*(1-o.af(o.cx,o.cx+1,S.transform.zoom))*G+C.paint.get("raster-particle-elevation"),Y=!S.options.moving,te=S.transform.projection.name==="globe";if(!R.length)return;const[K,ce]=S.stencilConfigForOverlap(R),fe=[];te&&fe.push("PROJECTION_GLOBE_VIEW");const pe=S.stencilModeFor3D();for(const Ee of ce){const Te=Ee.toUnwrapped(),we=E.getTile(Ee);if(!we.rasterParticleState)continue;const ye=we.rasterParticleState,Ie=100;we.registerFadeDuration(Ie);const Oe=E.findLoadedParent(Ee,0),Xe=zo(we,Oe,E,S.transform,Ie);let je,st;S.terrain&&S.terrain.prepareDrawTile(),j.activeTexture.set(B.TEXTURE0),ye.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),j.activeTexture.set(B.TEXTURE1),Oe&&Oe.rasterParticleState?(Oe.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),je=Math.pow(2,Oe.tileID.overscaledZ-we.tileID.overscaledZ),st=[we.tileID.canonical.x*je%1,we.tileID.canonical.y*je%1]):ye.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const ct=te?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Te,Y),Et=S.transform,Ve=Vu(Et),He=o.dn(Ee.canonical),Ue=o.dp(He.getCenter().lat);let ft,Ke,gt,dt,vt;te?(ft=Float32Array.from(o.bh(o.dr(Ee.canonical))),Ke=Float32Array.from(Et.globeMatrix),gt=Float32Array.from(o.dm(Et)),dt=[o.ay(Et.center.lng),o.aH(Et.center.lat)],vt=Float32Array.from(o.dq(Ee.canonical,He,Ue,Et.worldSize/Et._pixelsPerMercatorPixel))):(ft=new Float32Array(16),Ke=new Float32Array(9),gt=new Float32Array(16),dt=[0,0],vt=new Float32Array(9));const bt=ka(ct,ft,Ke,gt,vt,st||[0,0],o.ah(S.transform.zoom),dt,Ve,je||1,Xe,J),Yt=S.isTileAffectedByFog(Ee),tr=S.getOrCreateProgram("rasterParticle",{defines:fe,overrideFog:Yt});if(S.uploadCommonUniforms(j,tr,Te),te){const Bt=new Jt(B.LEQUAL,Jt.ReadOnly,S.depthRangeFor3D),er=0,Wt=S.globeSharedBuffers;if(Wt){const[hr,Or,rn]=Wt.getGridBuffers(Ue,er!==0);tr.draw(S,B.TRIANGLES,Bt,pe,Yr.alphaBlended,S.renderElevatedRasterBackface?Pr.frontCCW:Pr.backCCW,bt,C.id,hr,Or,rn)}}else{const Bt=S.depthModeForSublayer(0,Jt.ReadOnly),er=K[Ee.overscaledZ],{tileBoundsBuffer:Wt,tileBoundsIndexBuffer:hr,tileBoundsSegments:Or}=S.getTileBoundsBuffers(we);tr.draw(S,B.TRIANGLES,Bt,er,Yr.alphaBlended,Pr.disabled,bt,C.id,Wt,hr,Or)}}S.resetStencilClippingMasks()}(d,r,s,f),d.style.map.triggerRepaint())},background:function(d,r,s,f){const _=s.paint.get("background-color"),x=s.paint.get("background-color-use-theme").constantOr("default")==="none",S=s.paint.get("background-opacity"),E=s.paint.get("background-emissive-strength"),C=s.paint.get("background-pitch-alignment")==="viewport";if(S===0)return;const R=d.context,F=R.gl,j=d.transform,B=j.tileSize,G=s.paint.get("background-pattern");let J;if(G!==void 0&&(G===null||(J=d.imageManager.getPattern(o.I.from(G.toString()),s.scope,d.style.getLut(s.scope)),!J)))return;const Y=!G&&_.a===1&&S===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==Y)return;const te=Tr.disabled,K=d.depthModeForSublayer(0,Y==="opaque"?Jt.ReadWrite:Jt.ReadOnly),ce=d.colorModeForDrapableLayerRenderPass(E),fe=G?"backgroundPattern":"background";let pe,Ee=f;if(Ee||(pe=d.getBackgroundTiles(),Ee=Object.values(pe).map(Te=>Te.tileID)),G&&(R.activeTexture.set(F.TEXTURE0),d.imageManager.bind(d.context,s.scope)),C){const Te=d.getOrCreateProgram(fe,{overrideFog:!1,overrideRtt:!0}),we=new Float32Array(o.bx([])),ye=new o.aM(0,0,0,0,0),Ie=G?kf(we,E,S,d,0,s.scope,J,C,{tileID:ye,tileSize:B}):Nh(we,E,S,_.toRenderColor(x?null:s.lut));Te.draw(d,F.TRIANGLES,K,te,ce,Pr.disabled,Ie,s.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(const Te of Ee){const we=d.isTileAffectedByFog(Te),ye=d.getOrCreateProgram(fe,{overrideFog:we}),Ie=Te.toUnwrapped(),Oe=f?Te.projMatrix:d.transform.calculateProjMatrix(Ie);d.prepareDrawTile();const Xe=r?r.getTile(Te):pe?pe[Te.key]:new ul(Te,B,j.zoom,d),je=G?kf(Oe,E,S,d,0,s.scope,J,C,{tileID:Te,tileSize:B}):Nh(Oe,E,S,_.toRenderColor(x?null:s.lut));d.uploadCommonUniforms(R,ye,Ie);const{tileBoundsBuffer:st,tileBoundsIndexBuffer:ct,tileBoundsSegments:Et}=d.getTileBoundsBuffers(Xe);ye.draw(d,F.TRIANGLES,K,te,ce,Pr.disabled,je,s.id,st,ct,Et)}},sky:function(d,r,s){const f=d._atmosphere?o.ah(d.transform.zoom):1,_=s.paint.get("sky-opacity")*f;if(_===0)return;const x=d.context,S=s.paint.get("sky-type"),E=new Jt(x.gl.LEQUAL,Jt.ReadOnly,[0,1]),C=d.frameCounter/1e3%1;S==="atmosphere"?d.renderPass==="offscreen"?s.needsSkyboxCapture(d)&&(function(R,F,j,B){const G=R.context,J=G.gl;let Y=F.skyboxFbo;if(!Y){Y=F.skyboxFbo=G.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new Zc(G),F.skyboxTexture=G.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,F.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let fe=0;fe<6;++fe)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}G.bindFramebuffer.set(Y.framebuffer),G.viewport.set([0,0,32,32]);const te=F.getCenter(R,!0),K=R.getOrCreateProgram("skyboxCapture"),ce=new Float64Array(16);o.bx(ce),o.e3(ce,ce,.5*-Math.PI),Il(R,F,K,ce,te,0),o.bx(ce),o.e3(ce,ce,.5*Math.PI),Il(R,F,K,ce,te,1),o.bx(ce),o.cG(ce,ce,.5*-Math.PI),Il(R,F,K,ce,te,2),o.bx(ce),o.cG(ce,ce,.5*Math.PI),Il(R,F,K,ce,te,3),o.bx(ce),Il(R,F,K,ce,te,4),o.bx(ce),o.e3(ce,ce,Math.PI),Il(R,F,K,ce,te,5),G.viewport.set([0,0,R.width,R.height])}(d,s),s.markSkyboxValid(d)):d.renderPass==="sky"&&function(R,F,j,B,G){const J=R.context,Y=J.gl,te=R.transform,K=R.getOrCreateProgram("skybox");J.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,F.skyboxTexture);const ce=((fe,pe,Ee,Te,we)=>({u_matrix:fe,u_sun_direction:pe,u_cubemap:0,u_opacity:Te,u_temporal_offset:we}))(te.skyboxMatrix,F.getCenter(R,!1),0,B,G);R.uploadCommonUniforms(J,K),K.draw(R,Y.TRIANGLES,j,Tr.disabled,R.colorModeForRenderPass(),Pr.backCW,ce,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(d,s,E,_,C):S==="gradient"&&d.renderPass==="sky"&&function(R,F,j,B,G){const J=R.context,Y=J.gl,te=R.transform,K=R.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new Zc(J)),J.activeTexture.set(Y.TEXTURE0);let ce=F.colorRampTexture;ce||(ce=F.colorRampTexture=new o.T(J,F.colorRamp,Y.RGBA8)),ce.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const fe=((pe,Ee,Te,we,ye)=>({u_matrix:pe,u_color_ramp:0,u_center_direction:Ee,u_radius:o.al(Te),u_opacity:we,u_temporal_offset:ye}))(te.skyboxMatrix,F.getCenter(R,!1),F.paint.get("sky-gradient-radius"),B,G);R.uploadCommonUniforms(J,K),K.draw(R,Y.TRIANGLES,j,Tr.disabled,R.colorModeForRenderPass(),Pr.backCW,fe,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(d,s,E,_,C)},debug:function(d,r,s,f,_,x){for(let S=0;S<s.length;S++)if(_){const R=new o.am(f.r*.8,f.g*.8,f.b*.8,1);Is(d,r,s[S],f,-1,-1,x),Is(d,r,s[S],f,-1,1,x),Is(d,r,s[S],f,1,1,x),Is(d,r,s[S],f,1,-1,x),Is(d,r,s[S],R,0,0,x)}else Is(d,r,s[S],f,0,0,x)},custom:function(d,r,s,f){const _=d.context,x=s.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&s.isDraped(r)){if(d.renderPass==="offscreen"){const S=x.prerender;if(S){if(d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const E=d.transform.pointMerc;S.call(x,_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),o.ah(d.transform.zoom),[E.x,E.y],d.transform.pixelsPerMeterRatio)}else S.call(x,_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const E=x.renderToTile;if(E){const C=f[0].canonical,R={x:C.x+f[0].wrap*(x.wrapTileId?0:1<<C.z),y:C.y,z:C.z};_.setDepthMode(Jt.disabled),_.setStencilMode(Tr.disabled),_.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),E.call(x,_.gl,R),_.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),_.setStencilMode(Tr.disabled);const S=x.renderingMode==="3d"?new Jt(d.context.gl.LEQUAL,Jt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Jt.ReadOnly);if(_.setDepthMode(S),d.transform.projection.name==="globe"){const E=d.transform.pointMerc;x.render(_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),o.ah(d.transform.zoom),[E.x,E.y],d.transform.pixelsPerMeterRatio)}else x.render(_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState(),_.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,r,s,f){if(d.renderPass==="opaque")return;const _=s.paint.get("model-opacity").constantOr(1);if(_===0)return;const x=s.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!x||d.terrain&&_<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof o.ab))return;const S=d.shadowRenderer,E=s.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,E||(S.enabled=!1));const C=()=>{S&&(S.useNormalOffset=!0,E||(S.enabled=!0))},R=r.getSource();if(d.renderPass==="light-beam"&&R.type!=="batched-model")return;if(R.type==="vector"||R.type==="geojson")return function(K,ce,fe,pe,Ee){const Te=K.transform;if(Te.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${Te.projection.name} projection is not yet implemented`);const we=Te.getFreeCameraOptions().position;if(!K.modelManager)return;const ye=K.modelManager;fe.modelManager=ye;const Ie=K.shadowRenderer;if(!fe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Oe=fe._unevaluatedLayout._values["model-id"],Xe=Object.assign({},fe.layout.get("model-id").parameters),je=K.style.order.indexOf(fe.fqid);for(const st of pe){const ct=ce.getTile(st).getBucket(fe);if(!ct||ct.projection.name!==Te.projection.name)continue;const Et=ct.getModelUris();Et&&!ct.modelsRequested&&(ye.addModelsFromBucket(Et,Ee),ct.modelsRequested=!0);const Ve=hs(st,Te);Xe.zoom=Ve;const He=Oe.possiblyEvaluate(Xe);if(qe(K,ct,st),us.shadowUniformsInitialized=!1,us.useSingleShadowCascade=!!Ie&&Ie.getMaxCascadeForTile(st.toUnwrapped())===0,K.renderPass==="shadow"&&Ie){if(K.currentShadowCascade===1&&ct.isInsideFirstShadowMapFrustum)continue;const Ke=Te.calculatePosMatrix(st.toUnwrapped(),Te.worldSize);if(us.tileMatrix.set(Ke),us.shadowTileMatrix=Float32Array.from(Ie.calculateShadowPassMatrixFromMatrix(Ke)),us.aabb.min.fill(0),us.aabb.max[0]=us.aabb.max[1]=o.aj,us.aabb.max[2]=0,zf(ct,us,K,fe.scope))continue}const Ue=1<<st.canonical.z,ft=[((we.x-st.wrap)*Ue-st.canonical.x)*o.aj,(we.y*Ue-st.canonical.y)*o.aj,we.z*Ue*o.aj];K.conflationActive&&Object.keys(ct.instancesPerModel).length>0&&K.style.isLayerClipped(fe,ce.getSource())&&ct.updateReplacement(st,K.replacementSource,je,Ee)&&(ct.uploaded=!1,ct.upload(K.context));for(let Ke in ct.instancesPerModel){const gt=ct.instancesPerModel[Ke];gt.features.length>0&&(Ke=He.evaluate(gt.features[0].feature,{}));const dt=ye.getModel(Ke,Ee);if(dt||ye.hasURLBeenRequested(Ke)||ct.modelUris.includes(Ke)||(ct.modelUris.push(Ke),ct.modelsRequested=!1),dt&&dt.uploaded)for(const vt of dt.nodes)Ra(K,fe,vt,gt,ft,st,us)}}}(d,r,s,f,R.type==="vector"?s.scope:""),void C();if(!R.loaded())return;if(R.type==="batched-model")return function(K,ce,fe,pe){fe.resetLayerRenderingStats(K);const Ee=K.context,Te=K.transform,we=K.style.fog,ye=K.shadowRenderer;if(Te.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${Te.projection.name} projection is not yet implemented`);const Ie=K.transform.getFreeCameraOptions().position,Oe=o.b$([],[Ie.x,Ie.y,Ie.z],K.transform.worldSize),Xe=o.eb([],Oe),je=o.bx([]),st=o.ec(Te.center.lat,Te.zoom),ct=o.bn([],[1,1,1/st]);o.bo(je,je,Xe);const Et=fe.paint.get("model-opacity").constantOr(1),Ve=new Jt(Ee.gl.LEQUAL,Jt.ReadWrite,K.depthRangeFor3D),He=new Jt(Ee.gl.LEQUAL,Jt.ReadOnly,K.depthRangeFor3D),Ue=new o.cV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ft=K.renderPass==="shadow",Ke=ft&&ye?ye.getCurrentCascadeFrustum():Te.getFrustum(Te.scaleZoom(Te.worldSize)),gt=fe.paint.get("model-front-cutoff"),dt=gt[2]<1,vt=Gs(K,fe.paint.get("model-cutoff-fade-range")),bt=fe.getLayerRenderingStats();(function(Yt,tr,Bt,er){const Wt=Yt.terrain?Yt.terrain.exaggeration():0,hr=Yt.transform.zoom;for(const Or of er){const rn=tr.getTile(Or).getBucket(Bt);rn&&(rn.setFilter(Bt.filter),Yt.conflationActive&&rn.updateReplacement(Or,Yt.replacementSource),rn.evaluateScale(Yt,Bt),Yt.terrain&&Wt>0&&rn.elevationUpdate(Yt.terrain,Wt,Or,Bt.source),rn.needsReEvaluation(Yt,hr,Bt)&&rn.evaluate(Bt))}})(K,ce,fe,pe),function(){let Yt,tr,Bt;dt?(Yt=pe.length-1,tr=-1,Bt=-1):(Yt=0,tr=pe.length,Bt=1);const er=new Float64Array(16),Wt=o.eg(),hr=new o.P(0,0);for(let Or=Yt;Or!==tr;Or+=Bt){const rn=pe[Or],Gn=ce.getTile(rn).getBucket(fe);if(!Gn||!Gn.uploaded)continue;let qn=!1;ye&&(qn=ye.getMaxCascadeForTile(rn.toUnwrapped())===0);const Hr=Te.calculatePosMatrix(rn.toUnwrapped(),Te.worldSize),Li=Gn.modelTraits;!ft&&dt&&(o.bi(er,Hr),o.ad(Wt,Oe,er),hr.x=Wt[0],hr.y=Wt[1]);const _i=[];Gn.setFilter(fe.filter);for(const Rr of Gn.getNodesInfo()){if(Rr.hiddenByReplacement||!Rr.node.meshes)continue;const _n=Rr.node;let yn=0;K.terrain&&_n.elevation&&(yn=_n.elevation*K.terrain.exaggeration());const Wn=(()=>{const ri=Rr.aabb;return Ue.min=[...ri.min],Ue.max=[...ri.max],Ue.min[2]+=yn,Ue.max[2]+=yn,o.ad(Ue.min,Ue.min,Hr),o.ad(Ue.max,Ue.max,Hr),Ue})(),no=Rr.evaluatedScale;if(no[0]<=1&&no[1]<=1&&no[2]<=1&&Wn.intersects(Ke)===0)continue;if(!ft&&dt){const ri=.16666666666666666;Rr.cameraCollisionOpacity=Oe[0]>Wn.min[0]&&Oe[0]<Wn.max[0]&&Oe[1]>Wn.min[1]&&Oe[1]<Wn.max[1]&&Oe[2]*st<Wn.max[2]&&_n.footprint&&o.bS(hr,_n.footprint)?Math.max(Rr.cameraCollisionOpacity-ri,0):Math.min(1,Rr.cameraCollisionOpacity+ri)}const zi=[...Hr],Gi=_n.anchor?_n.anchor[0]:0,Ti=_n.anchor?_n.anchor[1]:0;o.bo(zi,zi,[Gi*(no[0]-1),Ti*(no[1]-1),yn]),o.ci(no,o.eh)||o.cE(zi,zi,no);const Zr=o.az([],zi,_n.matrix),di=o.az([],Te.expandedFarZProjMatrix,Zr),In=o.az([],Te.expandedFarZProjMatrix,zi),Yn=o.aA([],[Gi,Ti,yn,1],di)[2];_n.hidden=!1;let Fn=Et;ft||(dt&&(Fn*=Rr.cameraCollisionOpacity,Fn*=Wu(zi,Te,Rr.aabb,gt)),Fn*=Ff(vt,Yn)),Fn!==0?_i.push({nodeInfo:Rr,depth:Yn,opacity:Fn,wvpForNode:di,wvpForTile:In,nodeModelMatrix:Zr,tileModelMatrix:zi}):_n.hidden=!0}ft||_i.sort((Rr,_n)=>!dt||Rr.opacity===1&&_n.opacity===1?Rr.depth<_n.depth?-1:1:Rr.opacity===1?-1:_n.opacity===1?1:Rr.depth>_n.depth?-1:1);for(const Rr of _i){const _n=Rr.nodeInfo,yn=_n.node;let Wn=o.az([],ct,Rr.tileModelMatrix);o.az(Wn,je,Wn);const no=o.bi([],Wn);o.ee(no,no),o.cE(no,no,qu),Wn=o.az(Wn,Wn,yn.matrix);const zi=K.renderPass==="light-beam",Gi=fe.paint.get("model-color-use-theme").constantOr("default")==="none",Ti=Li&o.em.HasMapboxMeshFeatures,Zr=Ti?0:_n.evaluatedRMEA[0][2];for(let di=0;di<yn.meshes.length;++di){const In=yn.meshes[di],Yn=di===yn.lightMeshIndex;let Fn=Rr.wvpForNode;if(Yn){if(!zi&&!K.terrain&&K.shadowRenderer){K.currentLayer<K.firstLightBeamLayer&&(K.firstLightBeamLayer=K.currentLayer);continue}Fn=Rr.wvpForTile}else if(zi)continue;const ri={defines:[]},To=[];if(!ft&&ye&&(ye.useNormalOffset=!!In.normalBuffer),Ct(ri.defines,To,In,K,Gi?null:fe.lut),Ti||ri.defines.push("DIFFUSE_SHADED"),qn&&ri.defines.push("SHADOWS_SINGLE_CASCADE"),bt&&(ft?bt.numRenderedVerticesInShadowPass+=In.vertexArray.length:bt.numRenderedVerticesInTransparentPass+=In.vertexArray.length),ft){Ri(In,Rr.nodeModelMatrix,K,fe);continue}let fn=null;if(we){const za=Xs(Rr.nodeModelMatrix,K.transform);if(fn=new Float32Array(za),Te.projection.name!=="globe"){const Os=In.aabb.min,Mo=In.aabb.max,[Ds,el]=we.getOpacityForBounds(za,Os[0],Os[1],Mo[0],Mo[1]);ri.overrideFog=Ds>=Vt||el>=Vt}}const jo=In.material;let Zi;jo.occlusionTexture&&jo.occlusionTexture.offsetScale&&(Zi=jo.occlusionTexture.offsetScale,ri.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Qo=K.getOrCreateProgram("model",ri);!ft&&ye&&ye.setupShadowsFromMatrix(Rr.tileModelMatrix,Qo,ye.useNormalOffset),K.uploadCommonUniforms(Ee,Qo,null,fn);const Qs=jo.pbrMetallicRoughness;Qs.metallicFactor=.9,Qs.roughnessFactor=.5;const Rl=Sl(new Float32Array(Fn),new Float32Array(Wn),new Float32Array(no),new Float32Array(yn.matrix),K,Rr.opacity,Qs.baseColorFactor.toRenderColor(null),jo.emissiveFactor,Qs.metallicFactor,Qs.roughnessFactor,jo,Zr,fe,[0,0,0],Zi);!Yn&&(_n.hasTranslucentParts||Rr.opacity<1)&&Qo.draw(K,Ee.gl.TRIANGLES,Ve,Tr.disabled,Yr.disabled,Pr.backCCW,Rl,fe.id,In.vertexBuffer,In.indexBuffer,In.segments,fe.paint,K.transform.zoom,void 0,To),Qo.draw(K,Ee.gl.TRIANGLES,Yn?He:Ve,Tr.disabled,Yn||Rr.opacity<1||_n.hasTranslucentParts?Yr.alphaBlended:Yr.unblended,Pr.backCCW,Rl,fe.id,In.vertexBuffer,In.indexBuffer,In.segments,fe.paint,K.transform.zoom,void 0,To)}}}}()}(d,r,s,f),void C();if(R.type!=="model")return;const F=R.getModels(),j=[],B=d.transform.getFreeCameraOptions().position,G=o.b$([],[B.x,B.y,B.z],d.transform.worldSize);o.eb(G,G);const J=[],Y=[];let te=0;for(const K of F){const ce=s.paint.get("model-rotation").constantOr(null),fe=s.paint.get("model-scale").constantOr(null),pe=s.paint.get("model-translation").constantOr(null);K.computeModelMatrix(d,ce,fe,pe,!0,!0,!1);const Ee=o.bx([]),Te=o.ec(K.position.lat,d.transform.zoom),we=o.bn([],[1,1,1/Te]);o.bo(Ee,Ee,G),j.push({zScaleMatrix:we,negCameraPosMatrix:Ee});for(const ye of K.nodes)So(d.transform,ye,K.matrix,d.transform.expandedFarZProjMatrix,te,J,Y);te++}if(J.sort((K,ce)=>ce.depth-K.depth),d.renderPass!=="shadow"){if(_===1)for(const K of Y)Xt(K,d,s,j[K.modelIndex],Tr.disabled,d.colorModeForRenderPass());else{for(const K of Y)Xt(K,d,s,j[K.modelIndex],Tr.disabled,Yr.disabled);for(const K of Y)Xt(K,d,s,j[K.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(const K of J)Xt(K,d,s,j[K.modelIndex],Tr.disabled,d.colorModeForRenderPass());C()}else{for(const K of Y)Ri(K.mesh,K.nodeModelMatrix,d,s);for(const K of J)Ri(K.mesh,K.nodeModelMatrix,d,s);C()}}},jd={line:function(d,r,s){if(d.hasElevatedBuckets=!1,d.hasNonElevatedBuckets=!1,d._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||d._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(r){const f=r.getVisibleCoordinates();for(const _ of f){const x=r.getTile(_).getBucket(d);if(x&&(x.elevationType!=="none"?d.hasElevatedBuckets=!0:d.hasNonElevatedBuckets=!0,d.hasElevatedBuckets&&d.hasNonElevatedBuckets))break}}}else d.hasNonElevatedBuckets=!0},model:function(d,r,s){const f=r.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,f.type==="vector"?d.scope:""));if(f.type==="batched-model"||f.type!=="model")return;const _=f.getModels();for(const x of _)x.upload(s.context)},raster:function(d,r,s){const f=r.getSource();if(!(f instanceof _u&&f.loaded()))return;const _=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const x=d.paint.get("raster-array-band")||f.getInitialBand(_);if(x==null)return;const S=r.getIds().map(E=>r.getTileByID(E));for(const E of S)E.updateNeeded(_,x)&&f.prepareTile(E,_,x)},"raster-particle":function(d,r,s){const f=r.getSource();if(!(f instanceof _u&&f.loaded()))return;const _=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const x=d.paint.get("raster-particle-array-band")||f.getInitialBand(_);if(x==null)return;const S=r.getIds().map(E=>r.getTileByID(E));for(const E of S)E.updateNeeded(_,x)&&f.prepareTile(E,_,x)}},Cl={fill:Uu};class Ud{constructor(r,s,f,_,x){this.context=new Bu(r,s),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const S=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const C of S)this._debugParams.enabledLayers[C]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const C of S)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],C);this.occlusionParams=new Xp(x),this.setup(),this.numSublayers=Zo.maxUnderzooming+Zo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Jg(this),this._wireframeDebugCache=new rg,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const E=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,E,r.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_}updateTerrain(r,s){const f=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ha(this,r));const _=this._terrain;this.transform.elevation=f?_:null,_.update(r,this.transform,s),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(r){const s=r.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,_]=s.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);const x=f+.78*(_-f);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new ha(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,s){if(this.width=r*o.q.devicePixelRatio,this.height=s*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._mergedLayers[f].resize()}setup(){const r=this.context,s=new o.ba;s.emplaceBack(0,0),s.emplaceBack(o.aj,0),s.emplaceBack(0,o.aj),s.emplaceBack(o.aj,o.aj),this.tileExtentBuffer=r.createVertexBuffer(s,o.bc.members),this.tileExtentSegments=o.bd.simpleSegment(0,0,4,2);const f=new o.ba;f.emplaceBack(0,0),f.emplaceBack(o.aj,0),f.emplaceBack(0,o.aj),f.emplaceBack(o.aj,o.aj),this.debugBuffer=r.createVertexBuffer(f,o.bc.members),this.debugSegments=o.bd.simpleSegment(0,0,4,5);const _=new o.ba;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(_,o.bc.members),this.viewportSegments=o.bd.simpleSegment(0,0,4,2);const x=new o.aZ;x.emplaceBack(0,0,0,0),x.emplaceBack(o.aj,0,o.aj,0),x.emplaceBack(0,o.aj,0,o.aj),x.emplaceBack(o.aj,o.aj,o.aj,o.aj),this.mercatorBoundsBuffer=r.createVertexBuffer(x,o.bf.members),this.mercatorBoundsSegments=o.bd.simpleSegment(0,0,4,2);const S=new o.a_;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(S);const E=new o.bb;for(const R of[0,1,3,2,0])E.emplaceBack(R);this.debugIndexBuffer=r.createIndexBuffer(E),this.emptyTexture=new o.T(r,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA8),this.identityMat=o.bz();const C=this.context.gl;this.stencilClearMode=new Tr({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,Jt.disabled,this.stencilClearMode,Yr.disabled,Pr.disabled,wo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,s,f){if(!s||this.currentStencilSource===s.id||!r.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const C of f)if(this._tileClippingMaskIDs[C.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=s.id;const _=this.context,x=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(Yr.disabled),_.setDepthMode(Jt.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of f){const C=s.getTile(E),R=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:j,tileBoundsSegments:B}=this.getTileBoundsBuffers(C);S.draw(this,x.TRIANGLES,Jt.disabled,new Tr({func:x.ALWAYS,mask:0},R,255,x.KEEP,x.KEEP,x.REPLACE),Yr.disabled,Pr.disabled,wo(E.projMatrix),"$clipping",F,j,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,s=this.context.gl;return new Tr({func:s.NOTEQUAL,mask:255},r,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const s=this.context.gl;return new Tr({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(r){const s=this.context.gl,f=r.sort((S,E)=>E.overscaledZ-S.overscaledZ),_=f[f.length-1].overscaledZ,x=f[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const S={};for(let E=0;E<x;E++)S[E+_]=new Tr({func:s.GEQUAL,mask:255},E+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=x,[S,f]}return[{[_]:Tr.disabled},f]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new Yr([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new o.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Yr.unblended:Yr.alphaBlended}colorModeForDrapableLayerRenderPass(r){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Yr([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new o.am(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,s,f,_=!1){if(this.depthOcclusion)return new Jt(this.context.gl.GREATER,Jt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return Jt.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Jt(f||this.context.gl.LEQUAL,s,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const r=this.context.gl,s=Math.ceil(this.width),f=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),x=r.getParameter(r.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&f!==0&&(this.depthFBO=new Nu(this.context,s,f,!1,"texture"),this.depthTexture=new o.T(this.context,{width:s,height:f,data:null},r.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),r.bindTexture(r.TEXTURE_2D,x),this.depthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),r.blitFramebuffer(0,0,s,f,0,0,s,f,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,s)=>r+s/this._fpsHistory.length,0))}render(r,s){const f=o.q.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=s;const _=this.style._mergedLayers,x=!(!this.terrain||!this.terrain.enabled),S=()=>this.style._getOrder(x).filter(Ve=>{const He=_[Ve];return!(He.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[He.type]});let E=S(),C=!1,R=!1;for(const Ve of E){const He=_[Ve];He.type==="circle"&&(C=!0),He.type==="symbol"&&(He.hasInitialOcclusionOpacityProperties?R=!0:C=!0)}let F=E.map(Ve=>_[Ve]);const j=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let B=0,G=!1;for(const Ve in j){const He=j[Ve];He.used&&(He.prepare(this.context),He.getSource().usedInConflation&&++B)}let J=!1;for(const Ve of F)Ve.isHidden(this.transform.zoom)||(Ve.type==="clip"&&(J=!0),this.prepareLayer(Ve));const Y={},te={},K={},ce={},fe={};for(const Ve in j){const He=j[Ve];Y[Ve]=He.getVisibleCoordinates(),te[Ve]=Y[Ve].slice().reverse(),K[Ve]=He.getVisibleCoordinates(!0).reverse(),ce[Ve]=He.getShadowCasterCoordinates(),fe[Ve]=He.sortCoordinatesByDistance(Y[Ve])}const pe=Ve=>{const He=this.style.getLayerSourceCache(Ve);return He&&He.used?He.getSource():null};if(B||J||this._clippingActiveLastFrame){const Ve=[],He=[];let Ue=0;for(const ft of F)this.isSourceForClippingOrConflation(ft,pe(ft))&&(Ve.push(ft),He.push(Ue)),Ue++;if(Ve&&(J||Ve.length>1)||this._clippingActiveLastFrame){J=!1;const ft=[];for(let Ke=0;Ke<Ve.length;Ke++){const gt=Ve[Ke],dt=He[Ke],vt=this.style.getLayerSourceCache(gt);if(!vt||!vt.used||!vt.getSource().usedInConflation&&gt.type!=="clip")continue;let bt=o.ev,Yt=o.bQ.None;const tr=[];let Bt=!0;if(gt.type==="clip"){bt=dt;for(const er of gt.layout.get("clip-layer-types"))Yt|=er==="model"?o.bQ.Model:er==="symbol"?o.bQ.Symbol:o.bQ.FillExtrusion;for(const er of gt.layout.get("clip-layer-scope"))tr.push(er);gt.isHidden(this.transform.zoom)?Bt=!1:J=!0}Bt&&ft.push({layer:gt.fqid,cache:vt,order:bt,clipMask:Yt,clipScope:tr})}this.replacementSource.setSources(ft),G=!0}}this._clippingActiveLastFrame=J,G||this.replacementSource.clear(),this.conflationActive=G,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ve=0;Ve<F.length;Ve++){const He=F[Ve],Ue=He.cutoffRange();if(this.longestCutoffRange=Math.max(Ue,this.longestCutoffRange),Ue>0){const ft=pe(He);ft&&(this.minCutoffZoom=Math.max(ft.minzoom,this.minCutoffZoom)),He.minzoom&&(this.minCutoffZoom=Math.max(He.minzoom,this.minCutoffZoom))}He.is3D(x)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ve),this._lastOcclusionLayer=Ve)}const Ee=this.style&&this.style.fog;Ee?(this._fogVisible=Ee.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ee.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(K),this.opaquePassCutoff=0,E=S(),F=E.map(Ve=>_[Ve]));const Te=this._shadowRenderer;if(Te){Te.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ve in j)for(const He of Y[Ve]){let Ue={min:0,max:0};this.terrain&&(Ue=this.terrain.getMinMaxForTile(He)||Ue),Te.addShadowReceiver(He.toUnwrapped(),Ue.min,Ue.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eu(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new fc(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const we=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ye=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(we&&!this._snow&&(this._snow=new gi(this)),!we&&this._snow&&(this._snow.destroy(),delete this._snow),ye&&!this._rain&&(this._rain=new ng(this)),!ye&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Tn.has(this.context.gl))return;this.renderPass="offscreen";for(const Ve of F){const He=r.getLayerSourceCache(Ve);if(!Ve.hasOffscreenPass()||Ve.isHidden(this.transform.zoom))continue;const Ue=He?te[He.id]:void 0;(Ve.type==="custom"||Ve.type==="raster"||Ve.type==="raster-particle"||Ve.isSky()||Ue&&Ue.length)&&this.renderLayer(this,He,Ve,Ue)}this.depthRangeFor3D=[0,1-(F.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ce)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ie=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Oe=(()=>{if(s.showOverdrawInspector)return o.am.black;const Ve=this.style.fog;if(Ve&&this.transform.projection.supportsFog){const He=this.style.getLut(Ve.scope);if(!Ie){const Ue=Ve.properties.get("color-use-theme")==="none",ft=Ve.properties.get("color").toRenderColor(Ue?null:He).toArray01();return new o.am(...ft)}if(Ie){const Ue=Ve.properties.get("space-color-use-theme")==="none",ft=Ve.properties.get("space-color").toRenderColor(Ue?null:He).toArray01();return new o.am(...ft)}}return o.am.transparent})();if(this.context.clear({color:Oe,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ie&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=E.length-1;this.currentLayer>=0;this.currentLayer--){const Ve=F[this.currentLayer],He=r.getLayerSourceCache(Ve);if(Ve.isSky())continue;const Ue=He?(Ve.is3D(x)?fe:te)[He.id]:void 0;this._renderTileClippingMasks(Ve,He,Ue),this.renderLayer(this,He,Ve,Ue)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ie&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<E.length;this.currentLayer++){const Ve=F[this.currentLayer],He=r.getLayerSourceCache(Ve);Ve.isSky()&&this.renderLayer(this,He,Ve,He?te[He.id]:void 0)}function Xe(Ve,He){let Ue;return He&&(Ue=(Ve.type==="symbol"?K:Ve.is3D(x)?fe:te)[He.id]),Ue}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<E.length;){const Ve=F[this.currentLayer];if(Ve.type==="raster"||Ve.type==="raster-particle"){const He=r.getLayerSourceCache(Ve);this.renderLayer(this,He,Ve,Xe(Ve,He))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let je=0;Te&&(je=Te.getShadowCastingLayerCount());let st=!1,ct=-1;for(let Ve=0;Ve<E.length;++Ve){const He=F[Ve];He.isHidden(this.transform.zoom)||He.is3D(x)&&(ct=Ve)}R&&ct===-1&&(C=!0);let Et=!1;for(;this.currentLayer<E.length;){const Ve=F[this.currentLayer],He=r.getLayerSourceCache(Ve);if(Ve.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ve)){if(Ve.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Et&&Ve.is3D(x)&&!x){const Ue=this.currentLayer,ft=Ke=>{for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const gt=F[this.currentLayer];if(Cl[gt.type]){const dt=this.style.getLayerSourceCache(gt);Cl[gt.type](this,dt,gt,Xe(gt,dt),Ke)}}};ft("initialize"),ft("reset"),this.currentLayer=Ue,Et=!0}if(C&&!st&&this.terrain&&!this.transform.isOrthographic&&(st=!0,this.blitDepth()),R&&ct!==-1&&this.currentLayer===ct+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ve,He,He?Y[He.id]:void 0),this.renderLayer(this,He,Ve,Xe(Ve,He)),!this.terrain&&Te&&je>0&&Ve.hasShadowPass()&&--je==0&&(Te.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ue=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ue;this.currentLayer++){const ft=F[this.currentLayer];if(!ft.hasLightBeamPass())continue;const Ke=r.getLayerSourceCache(ft);this.renderLayer(this,Ke,ft,Ke?te[Ke.id]:void 0)}this.currentLayer=Ue,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ue=this.currentLayer;this.depthOcclusion=!0;for(const ft of this.layersWithOcclusionOpacity){this.currentLayer=ft;const Ke=F[this.currentLayer],gt=r.getLayerSourceCache(Ke),dt=gt?te[gt.id]:void 0;this.terrain||this._renderTileClippingMasks(Ke,gt,gt?Y[gt.id]:void 0),this.renderLayer(this,gt,Ke,dt)}this.depthOcclusion=!1,this.currentLayer=Ue,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ve=null;F.forEach(He=>{const Ue=r.getLayerSourceCache(He);Ue&&!He.isHidden(this.transform.zoom)&&Ue.getVisibleCoordinates().length&&(!Ve||Ve.getSource().maxzoom<Ue.getSource().maxzoom)&&(Ve=Ue)}),Ve&&this.options.showTileBoundaries&&On.debug(this,Ve,Ve.getVisibleCoordinates(),o.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&On.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ve){const He=Ve.transform.padding;Fd(Ve,Ve.transform.height-(He.top||0),3,As),Fd(Ve,He.bottom||0,3,$u),Vh(Ve,He.left||0,3,Gu),Vh(Ve,Ve.transform.width-(He.right||0),3,Fo);const Ue=Ve.transform.centerPoint;(function(ft,Ke,gt,dt){Hi(ft,Ke-1,gt-10,2,20,dt),Hi(ft,Ke-10,gt-1,20,2,dt)})(Ve,Ue.x,Ve.transform.height-Ue.y,Al)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),G||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:s}=this.transform.projection,f=!s||!s.includes(r.type);if(jd[r.type]&&(f||this.terrain&&r.type==="custom")){const _=this.style.getLayerSourceCache(r);jd[r.type](r,_,this)}this.gpuTimingEnd()}renderLayer(r,s,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(f.type)&&(!r.terrain||f.type!=="custom")||f.type==="clip"||On[f.type](r,s,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,f=this.context.gl;let _=this.gpuTimers[r.id];_||(_=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:f.createQuery()}),_.calls++,f.beginQuery(s.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,s=this.context.gl,f=s.createQuery();this.deferredRenderGpuTimeQueries.push(f),s.beginQuery(r.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const s={};for(const f in r){const _=r[f],x=this.context.extTimerQuery,S=x.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(_.query),s[f]=S}return s}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let f=0;for(const _ of r)f+=s.getQueryParameter(_,s.QUERY_RESULT)/1e6,s.deleteQuery(_);return f}translatePosMatrix(r,s,f,_,x){if(!f[0]&&!f[1])return r;const S=x?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(S){const R=Math.sin(S),F=Math.cos(S);f=[f[0]*F-f[1]*R,f[0]*R+f[1]*F]}const E=[x?f[0]:o.aw(s,f[0],this.transform.zoom),x?f[1]:o.aw(s,f[1],this.transform.zoom),0],C=new Float32Array(16);return o.bo(C,r,E),C}saveTileTexture(r){const s=r.size[0],f=this._tileTextures[s];f?f.push(r):this._tileTextures[s]=[r]}getTileTexture(r){const s=this._tileTextures[r];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,s,f){const _=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,x=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||x.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||_||s!==void 0&&!s||x.push("FOG","FOG_DITHERING"),_&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(r,s){this.cache=this.cache||{};const f=s&&s.defines||[],_=s&&s.config,x=this.currentGlobalDefines(r,s&&s.overrideFog,s&&s.overrideRtt).concat(f),S=Lu.cacheKey(jc[r],r,x,_);return this.cache[S]||(this.cache[S]=new Lu(this.context,r,jc[r],_,Bh[r],x)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,s){if(this.style.enable3dLights()){const f=this.style.directionalLight,_=this.style.ambientLight;if(f&&_){const x=((S,E,C)=>{const R=S.properties.get("direction"),F=S.properties.get("color-use-theme")==="none",j=S.properties.get("color").toRenderColor(F?null:C.getLut(S.scope)).toArray01(),B=S.properties.get("intensity"),G=E.properties.get("color-use-theme")==="none",J=E.properties.get("color").toRenderColor(G?null:C.getLut(E.scope)).toArray01(),Y=E.properties.get("intensity"),te=[R.x,R.y,R.z],K=o.dw(J,Y),ce=o.dw(j,B);return{u_lighting_ambient_color:K,u_lighting_directional_dir:te,u_lighting_directional_color:ce,u_ground_radiance:Rh(te,ce,K)}})(f,_,this.style);s.setLightsUniformValues(r,x)}}}uploadCommonUniforms(r,s,f,_,x){if(this.uploadCommonLightUniforms(r,s),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const E=S.getOpacity(this.transform.pitch),C=((R,F,j,B,G,J,Y,te,K,ce,fe,pe)=>{const Ee=R.transform,Te=F.properties.get("color-use-theme")==="none",we=F.properties.get("color").toRenderColor(Te?null:R.style.getLut(F.scope)).toArray01();we[3]=B;const ye=R.frameCounter/1e3%1,[Ie,Oe]=F.properties.get("vertical-range");return{u_fog_matrix:j?Ee.calculateFogTileMatrix(j):pe||R.identityMat,u_fog_range:F.getFovAdjustedRange(Ee._fov),u_fog_color:we,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ie,Oe),Oe],u_fog_temporal_offset:ye,u_frustum_tl:G,u_frustum_tr:J,u_frustum_br:Y,u_frustum_bl:te,u_globe_pos:K,u_globe_radius:ce,u_viewport:fe,u_globe_transition:o.ah(Ee.zoom),u_is_globe:+(Ee.projection.name==="globe")}})(this,S,f,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],_);s.setFogUniformValues(r,C)}x&&s.setCutoffUniformValues(r,x.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,s=r.createTexture();return r.bindTexture(r.TEXTURE_2D,s),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,s=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const _ of f)s[_.key]=r[_.key]||new ul(_,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,s){return!(!r.is3D(!(!this.terrain||!this.terrain.enabled))||r.type!=="clip"&&(r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerPresent||r.sourceLayer!=="building")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[r.key];return s||(this._cachedTileFogOpacities[r.key]=s=this.style.fog.getOpacityForTile(r)),s[0]>=Vt||s[1]>=Vt}setupDepthForOcclusion(r,s,f){const _=this.context,x=_.gl,S=!!f;var E;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(x.TEXTURE3),r&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((E=this.depthRangeFor3D)[1]-E[0]),-1-2*E[0]/(E[1]-E[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),_.activeTexture.set(x.TEXTURE0),S||s.setTerrainUniformValues(_,f)}}function Kc(d,r){let s=!1,f=null;const _=()=>{f=null,s&&(d(),f=setTimeout(_,r),s=!1)};return()=>(s=!0,f||_(),f)}class Wh{constructor(r){this._hashName=r&&encodeURIComponent(r),o.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Kc(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const s=Vd(r);if(this._hashName){const f=this._hashName;let _=!1;const x=location.hash.slice(1).split("&").map(S=>{const E=S.split("=")[0];return E===f?(_=!0,`${E}=${s}`):S}).filter(S=>S);return _||x.push(`${f}=${s}`),`#${x.join("&")}`}return`#${s}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let s;return r.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(s=f)}),(s&&s[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(f=>isNaN(Number(f)))){const f=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(s[3]||0):r.getBearing();return r.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:f,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Vd(d,r){const s=d.getCenter(),f=Math.round(100*d.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),S=Math.round(s.lng*x)/x,E=Math.round(s.lat*x)/x,C=d.getBearing(),R=d.getPitch();let F=r?`/${S}/${E}/${f}`:`${f}/${E}/${S}`;return(C||R)&&(F+="/"+Math.round(10*C)/10),R&&(F+=`/${Math.round(R)}`),F}const Hh={linearity:.3,easing:o.ew(0,0,.3,1)},Kp=o.l({deceleration:2500,maxSpeed:1400},Hh),jf=o.l({deceleration:20,maxSpeed:1400},Hh),Ys=o.l({deceleration:1e3,maxSpeed:360},Hh),Ml=o.l({deceleration:1e3,maxSpeed:90},Hh);class Hu{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,s=o.q.now();for(;r.length>0&&s-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)s.zoom+=x.zoomDelta||0,s.bearing+=x.bearingDelta||0,s.pitch+=x.pitchDelta||0,x.panDelta&&s.pan._add(x.panDelta),x.around&&(s.around=x.around),x.pinchAround&&(s.pinchAround=x.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(s.pan.mag()){const x=Zh(s.pan.mag(),f,o.l({},Kp,r||{}));_.offset=s.pan.mult(x.amount/s.pan.mag()),_.center=this._map.transform.center,Zu(_,x)}if(s.zoom){const x=Zh(s.zoom,f,jf);_.zoom=this._map.transform.zoom+x.amount,Zu(_,x)}if(s.bearing){const x=Zh(s.bearing,f,Ys);_.bearing=this._map.transform.bearing+o.aD(x.amount,-179,179),Zu(_,x)}if(s.pitch){const x=Zh(s.pitch,f,Ml);_.pitch=this._map.transform.pitch+x.amount,Zu(_,x)}if(_.zoom||_.bearing){const x=s.pinchAround===void 0?s.around:s.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Zu(d,r){(!d.duration||d.duration<r.duration)&&(d.duration=r.duration,d.easing=r.easing)}function Zh(d,r,s){const{maxSpeed:f,linearity:_,deceleration:x}=s,S=o.aD(d*_/(r/1e3),-f,f),E=Math.abs(S)/(x*_);return{easing:s.easing,duration:1e3*E,amount:S*(E/2)}}class La extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,f,_={}){const x=Gt(s.getCanvasContainer(),f),S=s.unproject(x);super(r,o.l({point:x,lngLat:S,originalEvent:f},_)),this._defaultPrevented=!1,this.target=s}}class Bo extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,f){const _=r==="touchend"?f.changedTouches:f.touches,x=ir(s.getCanvasContainer(),_),S=x.map(C=>s.unproject(C)),E=x.reduce((C,R,F,j)=>C.add(R.div(j.length)),new o.P(0,0));super(r,{points:x,point:E,lngLats:S,lngLat:s.unproject(E),originalEvent:f}),this._defaultPrevented=!1}}class $d extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class Ks{constructor(r,s){this._map=r,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new $d(this._map,r))}mousedown(r,s){return this._mousedownPos=s,this._firePreventable(new La(r.type,this._map,r))}mouseup(r){this._map.fire(new La(r.type,this._map,r))}preclick(r){const s=o.l({},r);s.type="preclick",this._map.fire(new La(s.type,this._map,s))}click(r,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(r),this._map.fire(new La(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new La(r.type,this._map,r))}mouseover(r){this._map.fire(new La(r.type,this._map,r))}mouseout(r){this._map.fire(new La(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Bo(r.type,this._map,r))}touchmove(r){this._map.fire(new Bo(r.type,this._map,r))}touchend(r){this._map.fire(new Bo(r.type,this._map,r))}touchcancel(r){this._map.fire(new Bo(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uf{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new La(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new La("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new La(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gd{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,s){this.isEnabled()&&r.shiftKey&&r.button===0&&(et(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(r,s){if(!this._active)return;const f=s,_=this._startPos,x=this._lastPos;if(!_||!x||x.equals(f)||!this._box&&f.dist(_)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=oe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const S=Math.min(_.x,f.x),E=Math.max(_.x,f.x),C=Math.min(_.y,f.y),R=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${C}px)`,this._box.style.width=E-S+"px",this._box.style.height=R-C+"px")})}mouseupWindow(r,s){if(!this._active)return;const f=this._startPos,_=s;if(f&&r.button===0){if(this.reset(),pt(),f.x!==_.x||f.y!==_.y)return this._map.fire(new o.A("boxzoomend",{originalEvent:r})),{cameraAnimation:x=>x.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ze(),delete this._startPos,delete this._lastPos}_fireEvent(r,s){return this._map.fire(new o.A(r,{originalEvent:s}))}}function Xh(d,r){const s={};for(let f=0;f<d.length;f++)s[d[f].identifier]=r[f];return s}class qd{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,s,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){const x=new o.P(0,0);for(const S of _)x._add(S);return x.div(_.length)}(s),this.touches=Xh(f,s)))}touchmove(r,s,f){if(this.aborted||!this.centroid)return;const _=Xh(f,s);for(const x in this.touches){const S=_[x];(!S||S.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(r,s,f){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class to{constructor(r){this.singleTap=new qd(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,s,f){this.singleTap.touchstart(r,s,f)}touchmove(r,s,f){this.singleTap.touchmove(r,s,f)}touchend(r,s,f){const _=this.singleTap.touchend(r,s,f);if(_){const x=r.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(_)<30;if(x&&S||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Wd{constructor(){this._zoomIn=new to({numTouches:1,numTaps:2}),this._zoomOut=new to({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,s,f){this._zoomIn.touchstart(r,s,f),this._zoomOut.touchstart(r,s,f)}touchmove(r,s,f){this._zoomIn.touchmove(r,s,f),this._zoomOut.touchmove(r,s,f)}touchend(r,s,f){const _=this._zoomIn.touchend(r,s,f),x=this._zoomOut.touchend(r,s,f);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(_)},{originalEvent:r})}):x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(x)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Hd={0:1,2:2},Jc={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Yh{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,s){return!1}_move(r,s){return{}}mousedown(r,s){if(this._lastPoint)return;const f=Br(r);this._correctButton(r,f)&&(this._lastPoint=s,this._eventButton=f)}mousemoveWindow(r,s){const f=this._lastPoint;if(f){if(r.preventDefault(),this._eventButton!=null&&function(_,x){const S=Hd[x];return _.buttons===void 0||(_.buttons&S)!==S}(r,this._eventButton))this.reset();else if(this._moved||!(s.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(f,s)}}mouseupWindow(r){this._lastPoint&&Br(r)===this._eventButton&&(this._moved&&pt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vf extends Yh{mousedown(r,s){super.mousedown(r,s),this._lastPoint&&(this._active=!0)}_correctButton(r,s){return s===0&&!r.ctrlKey}_move(r,s){return{around:s,panDelta:s.sub(r)}}}class Zd extends Yh{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?Jc[r.pitchRotateKey]:void 0}_correctButton(r,s){return this._pitchRotateKey?s===0&&r[this._pitchRotateKey]:s===0&&r.ctrlKey||s===2}_move(r,s){const f=.8*(s.x-r.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class Qc extends Yh{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?Jc[r.pitchRotateKey]:void 0}_correctButton(r,s){return this._pitchRotateKey?s===0&&r[this._pitchRotateKey]:s===0&&r.ctrlKey||s===2}_move(r,s){const f=-.5*(s.y-r.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class $f{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(r,s,f){return this._calculateTransform(r,s,f)}touchmove(r,s,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!o.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,s,f)}}touchend(r,s,f){this._calculateTransform(r,s,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,s,f){f.length>0&&(this._active=!0);const _=Xh(f,s),x=new o.P(0,0),S=new o.P(0,0);let E=0;for(const R in _){const F=_[R],j=this._touches[R];j&&(x._add(F),S._add(F.sub(j)),E++,_[R]=F)}if(this._touches=_,E<this._minTouches||!S.mag())return;const C=S.div(E);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(E),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=oe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Xd{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,s,f){return{}}touchstart(r,s,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([s[0],s[1]]))}touchmove(r,s,f){const _=this._firstTwoTouches;if(!_)return;r.preventDefault();const[x,S]=_,E=Xo(f,s,x),C=Xo(f,s,S);if(!E||!C)return;const R=this._aroundCenter?null:E.add(C).div(2);return this._move([E,C],R,r)}touchend(r,s,f){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,S=Xo(f,s,_),E=Xo(f,s,x);S&&E||(this._active&&pt(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xo(d,r,s){for(let f=0;f<d.length;f++)if(d[f].identifier===s)return r[f]}function Yo(d,r){return Math.log(d/r)/Math.LN2}class Gf extends Xd{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,s){const f=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Yo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Yo(this._distance,f),pinchAround:s}}}function Yd(d,r){return 180*d.angleWith(r)/Math.PI}class Jp extends Xd{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,s){const f=this._vector;if(this._vector=r[0].sub(r[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Yd(this._vector,f),pinchAround:s}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const s=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const _=Yd(r,f);return Math.abs(_)<s}}function Kd(d){return Math.abs(d.y)>Math.abs(d.x)}class Qp extends Xd{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Kd(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,s,f){const _=this._lastPoints;if(!_)return;const x=r[0].sub(_[0]),S=r[1].sub(_[1]);return this._map._cooperativeGestures&&!o.ex()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(x,S,f.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(x.y+S.y)/2*-.5})}gestureBeginsVertically(r,s,f){if(this._valid!==void 0)return this._valid;const _=r.mag()>=2,x=s.mag()>=2;if(!_&&!x)return;if(!_||!x)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const S=r.y>0==s.y>0;return Kd(r)&&Kd(s)&&S}}const qf={panStep:100,bearingStep:15,pitchStep:10};class em{constructor(){const r=qf;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let s=0,f=0,_=0,x=0,S=0;switch(r.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:r.shiftKey?f=-1:(r.preventDefault(),x=-1);break;case 39:r.shiftKey?f=1:(r.preventDefault(),x=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),S=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:E=>{const C=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Wf,zoom:s?Math.round(C)+s*(r.shiftKey?2:1):C,bearing:E.getBearing()+f*this._bearingStep,pitch:E.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-S*this._panStep],center:E.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wf(d){return d*(2-d)}const Hf=4.000244140625,tm=1/450;class Zf{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=tm,o.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const f=o.q.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,s!==0&&s%Hf==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),r.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=r,this._delta-=s,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Gt(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>Hf?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&F!==0&&(F=1/F);const j=s(),B=Math.pow(2,j),G=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(G*F))),this._type==="wheel"&&(this._startZoom=j,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:s(),_=this._startZoom,x=this._easing;let S,E=!1;if(this._type==="wheel"&&_&&x){const R=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),F=x(R);S=o.ai(_,f,F),R<1?this._frameId||(this._frameId=!0):E=!0}else S=f,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let C=S-s();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let s=o.ey;if(this._prevEase){const f=this._prevEase,_=(o.q.now()-f.start)/f.duration,x=f.easing(_+.01)-f.easing(_),S=.27/Math.sqrt(x*x+1e-4)*.01,E=Math.sqrt(.0729-S*S);s=o.ew(S,E,.25,1)}return this._prevEase={start:o.q.now(),duration:r,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=oe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Xf{constructor(r,s){this._clickZoom=r,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class rm{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,s){return r.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(r.shiftKey?-1:1),around:f.unproject(s)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yf{constructor(){this._tap=new to({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,s,f){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=s[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(r,s,f))}touchmove(r,s,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const _=s[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(r,s,f)}touchend(r,s,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(r,s,f)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jd{constructor(r,s,f){this._el=r,this._mousePan=s,this._touchPan=f}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class o_{constructor(r,s,f){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=s,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ig{constructor(r,s,f,_){this._el=r,this._touchZoom=s,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Si=d=>d.zoom||d.drag||d.pitch||d.rotate;class nm extends o.A{}class Kf{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,s){const f=o.at([],s,r);this.radius=o.ae(f[2]<0?o.eA([],f,this.constants):[f[0],f[1],0])}projectRay(r){o.eA(r,r,this.constants),o.au(r,r),o.eB(r,r,this.constants);const s=o.b$([],r,this.radius);if(s[2]>0){const f=o.b$([],[0,0,1],o.bE(s,[0,0,1])),_=o.b$([],o.au([],[s[0],s[1],0]),this.radius),x=o.cU([],s,o.b$([],o.at([],o.cU([],_,f),s),2));s[0]=x[0],s[1]=x[1]}return s}}function Va(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class a_{constructor(r,s){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Hu(r),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Kf,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.aV(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,x,S]of this._listeners){const E=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(x,E,S)}}destroy(){for(const[r,s,f]of this._listeners){const _=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(s,_,f)}}_addDefaultHandlers(r){const s=this._map,f=s.getCanvasContainer();this._add("mapEvent",new Ks(s,r));const _=s.boxZoom=new Gd(s,r);this._add("boxZoom",_);const x=new Wd,S=new rm;s.doubleClickZoom=new Xf(S,x),this._add("tapZoom",x),this._add("clickZoom",S);const E=new Yf;this._add("tapDragZoom",E);const C=s.touchPitch=new Qp(s);this._add("touchPitch",C);const R=new Zd(r),F=new Qc(r);s.dragRotate=new o_(r,R,F),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const j=new Vf(r),B=new $f(s,r);s.dragPan=new Jd(f,j,B),this._add("mousePan",j),this._add("touchPan",B,["touchZoom","touchRotate"]);const G=new Jp,J=new Gf;s.touchZoomRotate=new ig(f,J,G,E),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Uf(s));const Y=s.scrollZoom=new Zf(s,this);this._add("scrollZoom",Y,["mousePan"]);const te=s.keyboard=new em;this._add("keyboard",te);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[K]&&s[K].enable(r[K])}_add(r,s,f){this._handlers.push({handlerName:r,handler:s,allowed:f}),this._handlersById[r]=s}stop(r){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Si(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,s,f){for(const _ in r)if(_!==f&&(!s||s.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const s=[];for(const f of r)this._el.contains(f.target)&&s.push(f);return s}handleEvent(r,s){this._updatingCamera=!0;const f=r.type==="renderFrame",_=f?void 0:r,x={needsRenderFrame:!1},S={},E={},C=r.touches?this._getMapTouches(r.touches):void 0,R=C?ir(this._el,C):f?void 0:Gt(this._el,r);for(const{handlerName:B,handler:G,allowed:J}of this._handlers){if(!G.isEnabled())continue;let Y;this._blockedByActive(E,J,B)?G.reset():G[s||r.type]&&(Y=G[s||r.type](r,R,C),this.mergeHandlerResult(x,S,Y,B,_),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||G.isActive())&&(E[B]=G)}const F={};for(const B in this._previousActiveHandlers)E[B]||(F[B]=_);this._previousActiveHandlers=E,(Object.keys(F).length||Va(x))&&(this._changes.push([x,S,F]),this._triggerRenderFrame()),(Object.keys(E).length||Va(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=x;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(r,s,f,_,x){if(!f)return;o.l(r,f);const S={handlerName:_,originalEvent:f.originalEvent||x};f.zoomDelta!==void 0&&(s.zoom=S),f.panDelta!==void 0&&(s.drag=S),f.pitchDelta!==void 0&&(s.pitch=S),f.bearingDelta!==void 0&&(s.rotate=S)}_applyChanges(){const r={},s={},f={};for(const[_,x,S]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new o.P(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(r.around=_.around),_.aroundCoord!==void 0&&(r.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),o.l(s,x),o.l(f,S);this._updateMapTransform(r,s,f),this._changes=[]}_updateMapTransform(r,s,f){const _=this._map,x=_.transform,S=ce=>[ce.x,ce.y,ce.z];if((ce=>{const fe=this._eventsInProgress.drag;return fe&&!this._handlersById[fe.handlerName].isActive()})()&&!Va(r)){const ce=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),ce!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&_._stop(!0),!Va(r))return void this._fireEvents(s,f,!0);let{panDelta:E,zoomDelta:C,bearingDelta:R,pitchDelta:F,around:j,aroundCoord:B,pinchAround:G}=r;x._isCameraConstrained&&(C>0&&(C=0),x._isCameraConstrained=!1),G!==void 0&&(j=G),(C||(ce=>s[ce]&&!this._eventsInProgress[ce])("drag"))&&j&&(this._dragOrigin=S(x.pointCoordinate3D(j)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",_._stop(!0),j=j||_.transform.centerPoint,R&&(x.bearing+=R),F&&(x.pitch+=F),x._updateCameraState();const J=[0,0,0];if(E)if(x.projection.name==="mercator"){const ce=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(j).dir),fe=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(j.sub(E)).dir);J[0]=fe[0]-ce[0],J[1]=fe[1]-ce[1]}else{const ce=x.pointCoordinate(j);if(x.projection.name==="globe"){E=E.rotate(-x.angle);const fe=x._pixelsPerMercatorPixel/x.worldSize;J[0]=-E.x*o.ez(o.aY(ce.y))*fe,J[1]=-E.y*o.ez(x.center.lat)*fe}else{const fe=x.pointCoordinate(j.sub(E));ce&&fe&&(J[0]=fe.x-ce.x,J[1]=fe.y-ce.y)}}const Y=x.zoom,te=[0,0,0];if(C){const ce=S(B||x.pointCoordinate3D(j)),fe={dir:o.au([],o.at([],ce,x._camera.position))};if(fe.dir[2]<0){const pe=x.zoomDeltaToMovement(ce,C);o.b$(te,fe.dir,pe)}}const K=o.cU(J,J,te);x._translateCameraConstrained(K),C&&Math.abs(x.zoom-Y)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(s,f,!0)}_fireEvents(r,s,f){const _=Si(this._eventsInProgress),x=Si(r),S={};for(const F in r){const{originalEvent:j}=r[F];this._eventsInProgress[F]||(S[`${F}start`]=j),this._eventsInProgress[F]=r[F]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const F in S)this._fireEvent(F,S[F]);x&&this._fireEvent("move",x.originalEvent);for(const F in r){const{originalEvent:j}=r[F];this._fireEvent(F,j)}const E={};let C;for(const F in this._eventsInProgress){const{handlerName:j,originalEvent:B}=this._eventsInProgress[F];this._handlersById[j].isActive()||(delete this._eventsInProgress[F],C=s[j]||B,E[`${F}end`]=C)}for(const F in E)this._fireEvent(F,E[F]);const R=Si(this._eventsInProgress);if(f&&(_||x)&&!R){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;F?(j(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:C})):(this._map.fire(new o.A("moveend",{originalEvent:C})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,s){this._map.fire(new o.A(r,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new nm("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Xu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Jf extends o.E{constructor(r,s){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,o.aV(["_renderFrameCallback"],this)}getCenter(){return new o.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(r,s){return this.jumpTo({center:r},s)}panBy(r,s,f){return r=o.P.convert(r).mult(-1),this.panTo(this.transform.center,o.l({offset:r},s),f)}panTo(r,s,f){return this.easeTo(o.l({center:r},s),f)}getZoom(){return this.transform.zoom}setZoom(r,s){return this.jumpTo({zoom:r},s),this}zoomTo(r,s,f){return this.easeTo(o.l({zoom:r},s),f)}zoomIn(r,s){return this.zoomTo(this.getZoom()+1,r,s),this}zoomOut(r,s){return this.zoomTo(this.getZoom()-1,r,s),this}getBearing(){return this.transform.bearing}setBearing(r,s){return this.jumpTo({bearing:r},s),this}getPadding(){return this.transform.padding}setPadding(r,s){return this.jumpTo({padding:r},s),this}rotateTo(r,s,f){return this.easeTo(o.l({bearing:r},s),f)}resetNorth(r,s){return this.rotateTo(0,o.l({duration:1e3},r),s),this}resetNorthPitch(r,s){return this.easeTo(o.l({bearing:0,pitch:0,duration:1e3},r),s),this}snapToNorth(r,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,s):this}getPitch(){return this.transform.pitch}setPitch(r,s){return this.jumpTo({pitch:r},s),this}cameraForBounds(r,s){r=o.aG.convert(r);const f=s&&s.bearing||0,_=s&&s.pitch||0,x=r.getNorthWest(),S=r.getSouthEast();return this._cameraForBounds(this.transform,x,S,f,_,s)}_extendPadding(r){const s={top:0,right:0,bottom:0,left:0};return r==null?o.l({},s,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:o.l({},s,r)}_extendCameraOptions(r){return(r=o.l({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,s){const f=s.max[0]-s.min[0],_=s.max[1]-s.min[1];return f/_>r.aspect?f/(2*Math.tan(.5*r.fovX)*r.aspect):_/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,s,f,_,x,S){const E=r.clone(),C=this._extendCameraOptions(S);E.bearing=_,E.pitch=x;const R=o.cd.convert(s),F=o.cd.convert(f),j=.5*(R.lat+F.lat),B=.5*(R.lng+F.lng),G=o.eC(j,B),J=o.au([],G),Y=o.au([],o.bG([],J,[0,1,0])),te=o.bG([],Y,J),K=[Y[0],Y[1],Y[2],0,te[0],te[1],te[2],0,J[0],J[1],J[2],0,0,0,0,1],ce=[G,o.eC(R.lat,R.lng),o.eC(F.lat,R.lng),o.eC(F.lat,F.lng),o.eC(R.lat,F.lng),o.eC(j,R.lng),o.eC(j,F.lng),o.eC(R.lat,B),o.eC(F.lat,B)];let fe=o.cV.fromPoints(ce.map(Ke=>[o.bE(Y,Ke),o.bE(te,Ke),o.bE(J,Ke)]));const pe=o.ad([],fe.center,K);o.eD(pe)===0&&o.eE(pe,0,0,1),o.au(pe,pe),o.b$(pe,pe,o.aE),E.center=o.eF(pe);const Ee=E.getWorldToCameraMatrix(),Te=o.bi(new Float64Array(16),Ee);fe=o.cV.applyTransform(fe,o.az([],Ee,K));const we=this._extendAABB(fe,E,C,_);if(!we)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=we,o.ad(pe,pe,Ee);const ye=.5*(fe.max[2]-fe.min[2]),Ie=this._minimumAABBFrustumDistance(E,fe),Oe=o.b$([],[0,0,1],ye),Xe=o.cU(Oe,pe,Oe),je=Ie+(E.pitch===0?0:o.bD(pe,Xe)),st=E.globeCenterInViewSpace,ct=o.at([],pe,[st[0],st[1],st[2]]);o.au(ct,ct),o.b$(ct,ct,je);const Et=o.cU([],pe,ct);o.ad(Et,Et,Te);const Ve=o.eq/o.aE,He=o.ae(Et),Ue=o.c6(Math.max(He*Ve-o.eq,Number.EPSILON),0),ft=Math.min(E.zoomFromMercatorZAdjusted(Ue),C.maxZoom);return ft>.5*(o.cL+o.cx)?(E.setProjection({name:"mercator"}),E.zoom=ft,this._cameraForBounds(E,s,f,_,x,S)):{center:E.center,zoom:ft,bearing:_,pitch:x}}_extendAABB(r,s,f,_){const x=.5*((f.padding.left||0)+(f.padding.right||0)),S=.5*((f.padding.top||0)+(f.padding.bottom||0)),E=S,C=x,R=x,F=S,j=s.width-(C+R),B=s.height-(E+F),G=o.at([],r.max,r.min),J=Math.min(j/G[0],B/G[1]),Y=Math.min(s.scaleZoom(s.scale*J),f.maxZoom);if(isNaN(Y))return null;const te=s.scale/s.zoomScale(Y),K=new o.cV([r.min[0]-C*te,r.min[1]-F*te,r.min[2]],[r.max[0]+R*te,r.max[1]+E*te,r.max[2]]),ce=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new o.P(f.offset.x,f.offset.y):o.P.convert(f.offset)).rotate(-o.al(_));return K.center[0]-=ce.x*te,K.center[1]+=ce.y*te,K}queryTerrainElevation(r,s){const f=this.transform.elevation;return f?(s=o.l({},{exaggerated:!0},s),f.getAtPoint(o.ac.fromLngLat(r),null,s.exaggerated)):null}_cameraForBounds(r,s,f,_,x,S){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,s,f,_,x,S);const E=r.clone(),C=this._extendCameraOptions(S);E.bearing=_,E.pitch=x;const R=o.cd.convert(s),F=o.cd.convert(f),j=new o.cd(R.lng,F.lat),B=new o.cd(F.lng,R.lat),G=E.project(R),J=E.project(F),Y=this.queryTerrainElevation(R),te=this.queryTerrainElevation(F),K=this.queryTerrainElevation(j),ce=this.queryTerrainElevation(B),fe=[[G.x,G.y,Math.min(Y||0,te||0,K||0,ce||0)],[J.x,J.y,Math.max(Y||0,te||0,K||0,ce||0)]];let pe=o.cV.fromPoints(fe);const Ee=E.getWorldToCameraMatrix(),Te=o.bi(new Float64Array(16),Ee);pe=o.cV.applyTransform(pe,Ee);const we=this._extendAABB(pe,E,C,_);if(!we)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=we;const ye=.5*o.at([],pe.max,pe.min)[2],Ie=this._minimumAABBFrustumDistance(E,pe),Oe=[0,0,1,0];o.aA(Oe,Oe,Ee),o.eG(Oe,Oe);const Xe=o.b$([],Oe,Ie+ye),je=o.cU([],pe.center,Xe);o.ad(pe.center,pe.center,Te),o.ad(je,je,Te);const st=E.unproject(new o.P(pe.center[0],pe.center[1])),ct=o.eH(E.projection,st),Et=Math.pow(2,ct),Ve=Math.min(E._zoomFromMercatorZ(je[2]*E.pixelsPerMeter*Et/E.worldSize),C.maxZoom);return E.mercatorFromTransition&&Ve<.5*(o.cL+o.cx)?(E.setProjection({name:"globe"}),E.zoom=Ve,this._cameraForBounds(E,s,f,_,x,S)):{center:st,zoom:Ve,bearing:_,pitch:x}}fitBounds(r,s,f){const _=this.cameraForBounds(r,s);return this._fitInternal(_,s,f)}fitScreenCoordinates(r,s,f,_,x){const S=o.P.convert(r),E=o.P.convert(s),C=new o.P(Math.min(S.x,E.x),Math.min(S.y,E.y)),R=new o.P(Math.max(S.x,E.x),Math.max(S.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,E))return this;const F=this.transform.pointLocation3D(C),j=this.transform.pointLocation3D(R),B=this.transform.pointLocation3D(new o.P(C.x,R.y)),G=this.transform.pointLocation3D(new o.P(R.x,C.y)),J=[Math.min(F.lng,j.lng,B.lng,G.lng),Math.min(F.lat,j.lat,B.lat,G.lat)],Y=[Math.max(F.lng,j.lng,B.lng,G.lng),Math.max(F.lat,j.lat,B.lat,G.lat)],te=_&&_.pitch?_.pitch:this.getPitch(),K=this._cameraForBounds(this.transform,J,Y,f,te,_);return this._fitInternal(K,_,x)}_fitInternal(r,s,f){return r?(s=o.l(r,s)).linear?this.easeTo(s,f):this.flyTo(s,f):this}jumpTo(r,s){this.stop();const f=r.preloadOnly?this.transform.clone():this.transform;let _=!1,x=!1,S=!1;"zoom"in r&&f.zoom!==+r.zoom&&(_=!0,f.zoom=+r.zoom),r.center!==void 0&&(f.center=o.cd.convert(r.center)),"bearing"in r&&f.bearing!==+r.bearing&&(x=!0,f.bearing=+r.bearing),"pitch"in r&&f.pitch!==+r.pitch&&(S=!0,f.pitch=+r.pitch);const E=typeof r.padding=="number"?this._extendPadding(r.padding):r.padding;if(r.padding!=null&&!f.isPaddingEqual(E))if(r.retainPadding===!1){const C=f.clone();C.padding=E,f.setLocationAtPoint(f.center,C.centerPoint)}else f.padding=E;return r.preloadOnly?(this._preloadTiles(f),this):(this.fire(new o.A("movestart",s)).fire(new o.A("move",s)),_&&this.fire(new o.A("zoomstart",s)).fire(new o.A("zoom",s)).fire(new o.A("zoomend",s)),x&&this.fire(new o.A("rotatestart",s)).fire(new o.A("rotate",s)).fire(new o.A("rotateend",s)),S&&this.fire(new o.A("pitchstart",s)).fire(new o.A("pitch",s)).fire(new o.A("pitchend",s)),this.fire(new o.A("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Xu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,s){const f=this.transform;if(!f.projection.supportsFreeCamera)return o.w(Xu),this;this.stop();const _=f.zoom,x=f.pitch,S=f.bearing;f.setFreeCameraOptions(r);const E=_!==f.zoom,C=x!==f.pitch,R=S!==f.bearing;return this.fire(new o.A("movestart",s)).fire(new o.A("move",s)),E&&this.fire(new o.A("zoomstart",s)).fire(new o.A("zoom",s)).fire(new o.A("zoomend",s)),R&&this.fire(new o.A("rotatestart",s)).fire(new o.A("rotate",s)).fire(new o.A("rotateend",s)),C&&this.fire(new o.A("pitchstart",s)).fire(new o.A("pitch",s)).fire(new o.A("pitchend",s)),this.fire(new o.A("moveend",s)),this}easeTo(r,s){this._stop(!1,r.easeId),((r=o.l({offset:[0,0],duration:500,easing:o.ey},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const f=this.transform,_=this.getZoom(),x=this.getBearing(),S=this.getPitch(),E=this.getPadding(),C="zoom"in r?+r.zoom:_,R="bearing"in r?this._normalizeBearing(r.bearing,x):x,F="pitch"in r?+r.pitch:S,j=this._extendPadding(r.padding),B=o.P.convert(r.offset);let G,J,Y;if(f.projection.name==="globe"){const Oe=o.ac.fromLngLat(f.center),Xe=B.rotate(-f.angle);Oe.x+=Xe.x/f.worldSize,Oe.y+=Xe.y/f.worldSize;const je=Oe.toLngLat(),st=o.cd.convert(r.center||je);this._normalizeCenter(st),G=f.centerPoint.add(Xe),J=new o.P(Oe.x,Oe.y).mult(f.worldSize),Y=new o.P(o.ay(st.lng),o.aH(st.lat)).mult(f.worldSize).sub(J)}else{G=f.centerPoint.add(B);const Oe=f.pointLocation(G),Xe=o.cd.convert(r.center||Oe);this._normalizeCenter(Xe),J=f.project(Oe),Y=f.project(Xe).sub(J)}const te=f.zoomScale(C-_);let K,ce;r.around&&(K=o.cd.convert(r.around),ce=f.locationPoint(K));const fe=this._zooming||C!==_,pe=this._rotating||x!==R,Ee=this._pitching||F!==S,Te=!f.isPaddingEqual(j),we=r.retainPadding===!1?f.clone():f,ye=Oe=>Xe=>{if(fe&&(Oe.zoom=o.ai(_,C,Xe)),pe&&(Oe.bearing=o.ai(x,R,Xe)),Ee&&(Oe.pitch=o.ai(S,F,Xe)),Te&&(we.interpolatePadding(E,j,Xe),G=we.centerPoint.add(B)),K)Oe.setLocationAtPoint(K,ce);else{const je=Oe.zoomScale(Oe.zoom-_),st=C>_?Math.min(2,te):Math.max(.5,te),ct=Math.pow(st,1-Xe),Et=Oe.unproject(J.add(Y.mult(Xe*ct)).mult(je));Oe.setLocationAtPoint(Oe.renderWorldCopies?Et.wrap():Et,G)}return r.preloadOnly||this._fireMoveEvents(s),Oe};if(r.preloadOnly){const Oe=this._emulate(ye,r.duration,f);return this._preloadTiles(Oe),this}const Ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=fe,this._rotating=pe,this._pitching=Ee,this._padding=Te,this._easeId=r.easeId,this._prepareEase(s,r.noMoveStart,Ie),this._ease(ye(f),Oe=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(s,Oe)},r),this}_prepareEase(r,s,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||f.moving||this.fire(new o.A("movestart",r)),this._zooming&&!f.zooming&&this.fire(new o.A("zoomstart",r)),this._rotating&&!f.rotating&&this.fire(new o.A("rotatestart",r)),this._pitching&&!f.pitching&&this.fire(new o.A("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.A("move",r)),this._zooming&&this.fire(new o.A("zoom",r)),this._rotating&&this.fire(new o.A("rotate",r)),this._pitching&&this.fire(new o.A("pitch",r))}_afterEase(r,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new o.A("zoomend",r)),_&&this.fire(new o.A("rotateend",r)),x&&this.fire(new o.A("pitchend",r)),this.fire(new o.A("moveend",r))}flyTo(r,s){if(this._prefersReducedMotion(r)){const Ke=o.aF(r,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ke,s)}this.stop(),r=o.l({offset:[0,0],speed:1.2,curve:1.42,easing:o.ey},r);const f=this.transform,_=this.getZoom(),x=this.getBearing(),S=this.getPitch(),E=this.getPadding(),C="zoom"in r?o.aD(+r.zoom,f.minZoom,f.maxZoom):_,R="bearing"in r?this._normalizeBearing(r.bearing,x):x,F="pitch"in r?+r.pitch:S,j=this._extendPadding(r.padding),B=f.zoomScale(C-_),G=o.P.convert(r.offset);let J=f.centerPoint.add(G);const Y=f.pointLocation(J),te=o.cd.convert(r.center||Y);this._normalizeCenter(te);const K=f.project(Y),ce=f.project(te).sub(K);let fe=r.curve;const pe=Math.max(f.width,f.height),Ee=pe/B,Te=ce.mag();if("minZoom"in r){const Ke=o.aD(Math.min(r.minZoom,_,C),f.minZoom,f.maxZoom),gt=pe/f.zoomScale(Ke-_);fe=Math.sqrt(gt/Te*2)}const we=fe*fe;function ye(Ke){const gt=(Ee*Ee-pe*pe+(Ke?-1:1)*we*we*Te*Te)/(2*(Ke?Ee:pe)*we*Te);return Math.log(Math.sqrt(gt*gt+1)-gt)}function Ie(Ke){return(Math.exp(Ke)-Math.exp(-Ke))/2}function Oe(Ke){return(Math.exp(Ke)+Math.exp(-Ke))/2}const Xe=ye(0);let je=function(Ke){return Oe(Xe)/Oe(Xe+fe*Ke)},st=function(Ke){return pe*((Oe(Xe)*(Ie(gt=Xe+fe*Ke)/Oe(gt))-Ie(Xe))/we)/Te;var gt},ct=(ye(1)-Xe)/fe;if(Math.abs(Te)<1e-6||!isFinite(ct)){if(Math.abs(pe-Ee)<1e-6)return this.easeTo(r,s);const Ke=Ee<pe?-1:1;ct=Math.abs(Math.log(Ee/pe))/fe,st=function(){return 0},je=function(gt){return Math.exp(Ke*fe*gt)}}r.duration="duration"in r?+r.duration:1e3*ct/("screenSpeed"in r?+r.screenSpeed/fe:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Et=x!==R,Ve=F!==S,He=!f.isPaddingEqual(j),Ue=r.retainPadding===!1?f.clone():f,ft=Ke=>gt=>{const dt=gt*ct,vt=1/je(dt);Ke.zoom=gt===1?C:_+Ke.scaleZoom(vt),Et&&(Ke.bearing=o.ai(x,R,gt)),Ve&&(Ke.pitch=o.ai(S,F,gt)),He&&(Ue.interpolatePadding(E,j,gt),J=Ue.centerPoint.add(G));const bt=gt===1?te:Ke.unproject(K.add(ce.mult(st(dt))).mult(vt));return Ke.setLocationAtPoint(Ke.renderWorldCopies?bt.wrap():bt,J),Ke._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(s),Ke};if(r.preloadOnly){const Ke=this._emulate(ft,r.duration,f);return this._preloadTiles(Ke),this}return this._zooming=!0,this._rotating=Et,this._pitching=Ve,this._padding=He,this._prepareEase(s,!1),this._ease(ft(f),()=>this._afterEase(s),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,s)}if(!r){const f=this.handlers;f&&f.stop(!1)}return this}_ease(r,s,f){f.animate===!1||f.duration===0?(r(1),s()):(this._easeStart=o.q.now(),this._easeOptions=f,this._onEaseFrame=r,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,s){r=o.bX(r,-180,180);const f=Math.abs(r-s);return Math.abs(r-360-s)<f&&(r-=360),Math.abs(r+360-s)<f&&(r+=360),r}_normalizeCenter(r){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const f=r.lng-s.center.lng;r.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,s,f){const _=Math.ceil(15*s/1e3),x=[],S=r(f.clone());for(let E=0;E<=_;E++){const C=S(E/_);x.push(C.clone())}return x}_preloadTiles(r,s){}}class Qd{constructor(r={}){this.options=r,o.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const s=this.options&&this.options.compact,f=r._getUIString("AttributionControl.ToggleAttribution");this._map=r,this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=oe("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);const _=oe("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",f),this._innerContainer=oe("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(r){const f=s.reduce((_,x,S)=>(x.value&&(_+=`${x.key}=${x.value}${S<s.length-1?"&":""}`),_),"?");r.href=`${o.e.FEEDBACK_URL}/${f}#${Vd(this._map,!0)}`,r.rel="noopener nofollow"}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const s=this._map.style._mergedSourceCaches;for(const _ in s){const x=s[_];if(x.used){const S=x.getSource();S.attribution&&r.indexOf(S.attribution)<0&&r.push(S.attribution)}}r.sort((_,x)=>_.length-x.length),r=r.filter((_,x)=>{for(let S=x+1;S<r.length;S++)if(r[S].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const f=r.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,r.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Kh{constructor(){o.aV(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=oe("div","mapboxgl-ctrl");const s=oe("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const s in r){const f=r[s].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const s=r[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class $a{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const s=++this._id;return this._queue.push({callback:r,id:s,cancelled:!1}),s}remove(r){const s=this._currentlyRunning,f=s?this._queue.concat(s):this._queue;for(const _ of f)if(_.id===r)return void(_.cancelled=!0)}run(r=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const f of s)if(!f.cancelled&&(f.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Ko{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const s=o.dk((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,s,f){this._start=this.getValue(s),this._end=r,this._startTime=s,this._endTime=s+f}}const ro={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Js extends o.A{constructor(r,s,f,_){const{point:x,lngLat:S,originalEvent:E,target:C}=r;super(r.type,{point:x,lngLat:S,originalEvent:E,target:C}),this.preventDefault=()=>{r.preventDefault()},this.id=s,this.interaction=f,this.feature=_}}class eu{constructor(r){this.map=r,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(r,s){if(this.typeById.has(r))throw new Error(`Interaction id "${r}" already exists.`);const f=s.filter;let _=s.type;f&&this.filters.set(r,o.b3(f)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");const x=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(r,s)):x.size===0&&this.map.on(_,this.handleType),x.size===0&&this.interactionsByType.set(_,x),x.set(r,s),this.typeById.set(r,_)}get(r){const s=this.typeById.get(r);if(!s)return;const f=this.interactionsByType.get(s);return f?f.get(r):void 0}remove(r){const s=this.typeById.get(r);if(!s)return;this.typeById.delete(r),this.filters.delete(r);const f=this.interactionsByType.get(s);f&&(f.delete(r),s==="mouseenter"||s==="mouseleave"?(this.delegatedInteractions.delete(r),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):f.size===0&&this.map.off(s,this.handleType))}queryTargets(r,s){const f=[];for(const[_,x]of s)x.target&&f.push({targetId:_,target:x.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(r,f,this.map.transform)}handleMove(r){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const s=this.queryTargets(r.point,Array.from(this.delegatedInteractions).reverse());s.length&&(r.type="mouseenter",this.handleType(r,s));const f=new Map;for(const[_,{feature:x}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||f.set(x.id,x);f.size&&(r.type="mouseleave",this.handleType(r,Array.from(f.values())))}handleOut(r){const s=Array.from(this.hoveredFeatures.values()).map(({feature:f})=>f);s.length&&(r.type="mouseleave",this.handleType(r,s)),this.hoveredFeatures.clear()}handleType(r,s){const f=Array.from(this.interactionsByType.get(r.type)).reverse(),_=!!s;s=s||this.queryTargets(r.point,f);const x=r.type==="mouseenter";let S=!1;const E=new Set;for(const C of s){for(const[R,F]of f){if(!F.target)continue;const j=C.variants?C.variants[R]:null;if(j){for(const B of j){if(Zl(B,C,E,R))continue;const G=new o.df(C,B),J=yu(B,C,R);_&&(G.state=this.map.getFeatureState(G));const Y=x?this.prevHoveredFeatures.get(J):null,te=new Js(r,R,F,G),K=Y?Y.stop:F.handler(te);if(x&&this.hoveredFeatures.set(J,{feature:C,stop:K}),K!==!1){S=!0;break}}if(S)break}}if(S)break}if(!S)for(const[C,R]of f){const{handler:F,target:j}=R;if(!j&&F(new Js(r,C,R,null))!==!1)break}}}function Jo(d,r){if(Array.isArray(d)&&Array.isArray(r)){const s=new Set(d),f=new Set(r);return s.size===f.size&&d.every(_=>f.has(_))}return o.bv(d,r)}const og={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Wr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ol{constructor(r,s,f=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Zd({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,f&&(this.mousePitch=new Qc({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(r,s){this.mouseRotate.mousedown(r,s),this.mousePitch&&this.mousePitch.mousedown(r,s),et()}move(r,s){const f=this.map,_=this.mouseRotate.mousemoveWindow(r,s),x=_&&_.bearingDelta;if(x&&f.setBearing(f.getBearing()+x),this.mousePitch){const S=this.mousePitch.mousemoveWindow(r,s),E=S&&S.pitchDelta;E&&f.setPitch(f.getPitch()+E)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ze(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.l({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Gt(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Gt(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ir(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=ir(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Qf(d,r,s){if(d=new o.cd(d.lng,d.lat),r){const f=new o.cd(d.lng-360,d.lat),_=new o.cd(d.lng+360,d.lat),x=360*Math.ceil(Math.abs(d.lng-s.center.lng)/360),S=s.locationPoint3D(d).distSqr(r),E=r.x<0||r.y<0||r.x>s.width||r.y>s.height;s.locationPoint3D(f).distSqr(r)<S&&(E||Math.abs(f.lng-s.center.lng)<x)?d=f:s.locationPoint3D(_).distSqr(r)<S&&(E||Math.abs(_.lng-s.center.lng)<x)&&(d=_)}for(;Math.abs(d.lng-s.center.lng)>180;){const f=s.locationPoint3D(d);if(f.x>=0&&f.y>=0&&f.x<=s.width&&f.y<=s.height)break;d.lng>s.center.lng?d.lng-=360:d.lng+=360}return d}const ep={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ps={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class mc extends o.E{constructor(r,s){super(),(r instanceof HTMLElement||s)&&(r=o.l({element:r},s)),o.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:f="center",color:_="#3FB1CE",scale:x=1,draggable:S=!1,clickTolerance:E=0,rotation:C=Ps.rotation,rotationAlignment:R=Ps.rotationAlignment,pitchAlignment:F=Ps.pitchAlignment,occludedOpacity:j=Ps.occludedOpacity,altitude:B=Ps.altitude}=r||{};this._anchor=f,this._color=_,this._scale=x,this._draggable=S,this._clickTolerance=E,this._rotation=C,this._rotationAlignment=R,this._pitchAlignment=F,this._occludedOpacity=j,this._altitude=B,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),r&&r.element?(this._element=r.element,this._offset=o.P.convert(r&&r.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(r&&r.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Y=>{Y.preventDefault()}),this._element.addEventListener("mousedown",Y=>{Y.preventDefault()});const G=this._element.classList;for(const Y in ep)G.remove(`mapboxgl-marker-anchor-${Y}`);G.add(`mapboxgl-marker-anchor-${this._anchor}`);const J=r&&r.className?r.className.trim().split(/\s+/):[];G.add(...J),this._popup=null}_createDefaultMarker(){const r=oe("div"),s=le("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},r);if(this._altitude===0){const f=le("radialGradient",{id:"shadowGradient"},le("defs",{},s));le("stop",{offset:"10%","stop-opacity":.4},f),le("stop",{offset:"100%","stop-opacity":.05},f),le("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},s)}return le("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},s),le("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},s),le("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},s),r}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.cd.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(r){return r===this._altitude||(this._defaultMarker&&(this._altitude===0&&r!==0||this._altitude!==0&&r===0)&&(this._element=this._createDefaultMarker()),this._altitude=r||Ps.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,r._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const s=r.code,f=r.charCode||r.keyCode;s!=="Space"&&s!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(r){const s=r.originalEvent.target,f=this._element;this._popup&&(s===f||f.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,s=this._pos;if(!r||!s)return!1;const f=r.unproject(s,this._altitude),_=r.getFreeCameraOptions();if(!_.position)return!1;const x=_.position.toLngLat();return x.distanceTo(f)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const s=this._pos;if(!s||s.x<0||s.x>r.transform.width||s.y<0||s.y>r.transform.height)return void this._clearFadeTimer();const f=r.unproject(s,this._altitude);let _;r._showingGlobe()&&o.eK(r.transform,this._lngLat)?_=0:(_=1-r._queryFogOpacity(f),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${ep[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const r=this._pos,s=this._map,f=this.getPitchAlignment();if(!s||!r||f!=="map")return"";if(!s._showingGlobe()){const C=s.getPitch();return C?`rotateX(${C}deg)`:""}const _=o.cJ(o.eL(s.transform,this._lngLat)),x=r.sub(o.eM(s.transform)),S=Math.abs(x.x)+Math.abs(x.y);if(S===0)return"";const E=_/S;return`rotateX(${-x.y*E}deg) rotateY(${x.x*E}deg)`}_calculateZTransform(){const r=this._pos,s=this._map;if(!s||!r)return"";let f=0;const _=this.getRotationAlignment();if(_==="map")if(s._showingGlobe()){const x=s.project(new o.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),S=s.project(new o.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(x);f=o.cJ(Math.atan2(S.y,S.x))-90}else f=-s.getBearing();else if(_==="horizon"){const x=o.af(4,6,s.getZoom()),S=o.eM(s.transform);S.y+=x*s.transform.height;const E=r.sub(S),C=o.cJ(Math.atan2(E.y,E.x));f=(C>90?C-270:C+90)*(1-x)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=Qf(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat,this._altitude),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const s=this._map;if(!s)return;const f=this._pointerdownPos,_=this._positionDelta;if(f&&_){if(!this._isDragging){const x=this._clickTolerance||s._clickTolerance;if(r.point.dist(f)<x)return;this._isDragging=!0}this._pos=r.point.sub(_),this._lngLat=s.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.A("dragstart"))),this.fire(new o.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.A("dragend")),this._state="inactive"}_addDragHandler(r){const s=this._map,f=this._pos;s&&f&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(f),this._pointerdownPos=r.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const s=this._map;return s&&(r?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||Ps.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||Ps.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||Ps.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||Ps.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const tu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ru={maxWidth:100,unit:"metric"},Dl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Cs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ms=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function kl(d=new o.P(0,0),r="bottom"){if(typeof d=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(r){case"top":return new o.P(0,d);case"top-left":return new o.P(s,s);case"top-right":return new o.P(-s,s);case"bottom":return new o.P(0,-d);case"bottom-left":return new o.P(s,-s);case"bottom-right":return new o.P(-s,-s);case"left":return new o.P(d,0);case"right":return new o.P(-d,0)}return new o.P(0,0)}return d instanceof o.P||Array.isArray(d)?o.P.convert(d):o.P.convert(d[r]||[0,0])}return{version:D,supported:ie.supported,setRTLTextPlugin:o.eN,getRTLTextPluginStatus:o.eO,Map:class extends Jf{constructor(d){L.mark(k.create);const r=d;if((d=o.l({},og,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&o.eI(window)&&(d.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Lc(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies,null,null),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new $a,this._domRenderTaskQueue=new $a,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.a$(),this._locale=o.l({},ro,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ko(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=d.scaleFactor,this._requestManager=new vr(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?Object.assign({},d.contextCreateOptions):{},typeof d.container=="string"){const s=document.getElementById(d.container);if(!s)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=s}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),this._spriteFormat=d.spriteFormat,o.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Nf),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new a_(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||o.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this.indoor=new Ym(this),d.hash&&(this._hash=new Wh(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const s=d.bounds;s&&(this.resize(),this.fitBounds(s,o.l({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new Qd({customAttribution:d.customAttribution})),this._logoControl=new Kh,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new o.A(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new o.A(`${s.dataType}dataloading`,s))}),this._interactions=new eu(this)}_getMapId(){return this._mapId}addControl(d,r){if(r===void 0&&(r=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new o.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[r];return r.indexOf("bottom")!==-1?f.insertBefore(s,f.firstChild):f.appendChild(s),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new o.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(d);return r>-1&&this._controls.splice(r,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.A("movestart",d)).fire(new o.A("move",d)),this.fire(new o.A("resize",d)),r&&this.fire(new o.A("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(o.aG.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(d){return this._scaleFactor=d,this.painter.scaleFactor=d,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(r=>r.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(r=>r==="auto"?navigator.language:r):d}setLanguage(d){const r=this._parseLanguage(d);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,r=d.projection.name;let s;r==="globe"&&d.zoom>=o.cx?(d.setMercatorFromTransition(),s=!0):r==="mercator"&&d.zoom<o.cx&&(d.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,r){return this._updateProjection(d||r||{name:"mercator"})}_updateProjection(d){let r;return r=d.name==="globe"&&this.transform.zoom>=o.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d,r){return this.transform.locationPoint3D(o.cd.convert(d),r)}unproject(d,r){return this.transform.pointLocation3D(o.P.convert(d),r)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,r,s){const f=_=>{let x=[];if(Array.isArray(r)){const S=r.filter(E=>this.getLayer(E));x=S.length?this.queryRenderedFeatures(_,{layers:S}):[]}else x=this.queryRenderedFeatures(_,{target:r});return x};if(d==="mouseenter"||d==="mouseover"){let _=!1;return{listener:s,targets:r,delegates:{mousemove:S=>{const E=f(S.point);E.length?_||(_=!0,s.call(this,new La(d,this,S.originalEvent,{features:E}))):_=!1},mouseout:()=>{_=!1}}}}if(d==="mouseleave"||d==="mouseout"){let _=!1;return{listener:s,targets:r,delegates:{mousemove:E=>{f(E.point).length?_=!0:_&&(_=!1,s.call(this,new La(d,this,E.originalEvent)))},mouseout:E=>{_&&(_=!1,s.call(this,new La(d,this,E.originalEvent)))}}}}{const _=x=>{const S=f(x.point);S.length&&(x.features=S,s.call(this,x),delete x.features)};return{listener:s,targets:r,delegates:{[d]:_}}}}on(d,r,s){if(typeof r=="function"||s===void 0)return super.on(d,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const f=this._createDelegatedListener(d,r,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return this}once(d,r,s){if(typeof r=="function"||s===void 0)return super.once(d,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const f=this._createDelegatedListener(d,r,s);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(d,r,s){if(typeof r=="function"||s===void 0)return super.off(d,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const f=this._delegatedListeners?this._delegatedListeners[d]:void 0;return f&&(_=>{for(let x=0;x<_.length;x++){const S=_[x];if(S.listener===s&&Jo(S.targets,r)){for(const E in S.delegates)this.off(E,S.delegates[E]);return _.splice(x,1),this}}})(f),this}queryRenderedFeatures(d,r){if(!this.style)return[];if(d===void 0||d instanceof o.P||Array.isArray(d)||r!==void 0||(r=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],!r){const x=this.style.queryRenderedFeatures(d,void 0,this.transform),S=this.style.queryRenderedFeatureset(d,void 0,this.transform);return x.concat(S)}let s=!0;if(r.target&&(s=this._isTargetValid(r.target),s&&!r.layers))return this.style.queryRenderedFeatureset(d,r,this.transform);let f=!0;if(r.layers&&Array.isArray(r.layers)){for(const x of r.layers)if(!this._isValidId(x)){f=!1;break}if(f&&!r.target)return this.style.queryRenderedFeatures(d,r,this.transform)}let _=[];return f&&(_=_.concat(this.style.queryRenderedFeatures(d,r,this.transform))),s&&(_=_.concat(this.style.queryRenderedFeatureset(d,r,this.transform))),_}querySourceFeatures(d,r){return!d||typeof d=="string"&&!this._isValidId(d)?[]:this.style.querySourceFeatures(d,r)}isPointOnSurface(d){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&o.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(d))}addInteraction(d,r){return this._interactions.add(d,r),this}removeInteraction(d){return this._interactions.remove(d),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this}setStyle(d,r){return r=o.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&d&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(d,(s,f)=>{if(s){const _=typeof s=="string"?s:s instanceof Error?s.message:s.error;o.w(`Unable to perform style diff: ${_}. Rebuilding the style from scratch.`),this._updateStyle(d,r)}else f&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(d,r))}_getUIString(d){const r=this._locale[d];if(r==null)throw new Error(`Missing UI string '${d}'`);return r}_updateStyle(d,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){const s=o.l({},r);r&&r.config&&(s.initialConfig=r.config,delete s.config),this.style=new Ts(this,s).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ts(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new o.z(new Error("IDs can't be empty."))),!1):!o.d9(d)||(this.fire(new o.z(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}_isTargetValid(d){return"featuresetId"in d?this._isValidId("importId"in d?d.importId:d.featuresetId):"layerId"in d&&this._isValidId(d.layerId)}_areTargetsValid(d){if(Array.isArray(d)){for(const r of d)if(!this._isValidId(r))return!1;return!0}return this._isTargetValid(d)}addSource(d,r){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,r),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,r,s){this._lazyInitEmptyStyle(),this.style.addSourceType(d,r,s)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,r,{pixelRatio:s=1,sdf:f=!1,stretchX:_,stretchY:x,content:S}={}){this._lazyInitEmptyStyle();const E=o.I.from(d);if(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:C,height:R,data:F}=o.q.getImageData(r);this.style.addImage(E,{data:new o.r({width:C,height:R},F),pixelRatio:s,stretchX:_,stretchY:x,content:S,sdf:f,version:0,usvg:!1})}else if(r.width===void 0||r.height===void 0)this.fire(new o.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:R}=r,F=r;this.style.addImage(E,{data:new o.r({width:C,height:R},new Uint8Array(F.data)),pixelRatio:s,stretchX:_,stretchY:x,content:S,sdf:f,usvg:!1,version:0,userImage:F}),F.onAdd&&F.onAdd(this,d)}}updateImage(d,r){this._lazyInitEmptyStyle();const s=o.I.from(d),f=this.style.getImage(s);if(!f)return void this.fire(new o.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?o.q.getImageData(r):r,{width:x,height:S,data:E}=_;if(x===void 0||S===void 0)return void this.fire(new o.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==(f.usvg?f.icon.usvg_tree.width:f.data.width)||S!==(f.usvg?f.icon.usvg_tree.height:f.data.height))return void this.fire(new o.z(new Error(`The width and height of the updated image (${x}, ${S})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`)));const C=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);let R=!1;f.usvg?(f.data=new o.r({width:x,height:S},new Uint8Array(E)),f.usvg=!1,f.icon=void 0,R=!0):f.data.replace(E,C),this.style.updateImage(s,f,R)}hasImage(d){return d?!!this.style&&!!this.style.getImage(o.I.from(d)):(this.fire(new o.z(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(o.I.from(d))}loadImage(d,r){o.o(this._requestManager.transformRequest(d,o.R.Image),(s,f)=>{r(s,f instanceof HTMLImageElement?o.q.getImageData(f):f)})}listImages(){return this.style.listImages().map(d=>d.name)}addModel(d,r){this._lazyInitEmptyStyle(),this.style.addModel(d,r)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new o.z(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,r){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,r),this._update(!0)):this}getSlot(d){const r=this.getLayer(d);return r&&r.slot||null}setSlot(d,r){return this.style.setSlot(d,r),this.style.mergeLayers(),this._update(!0)}addImport(d,r){return this.style.addImport(d,r).catch(s=>this.fire(new o.z(new Error("Failed to add import",s)))),this}updateImport(d,r){return typeof r!="string"&&r.id!==d?(this.removeImport(d),this.addImport(r)):(this.style.updateImport(d,r),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,r){return this.style.moveImport(d,r),this._update(!0)}moveLayer(d,r){return this._isValidId(d)?(this.style.moveLayer(d,r),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;const r=this.style.getOwnLayer(d);return r?r.type==="custom"?r.implementation:r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,r,s){return this._isValidId(d)?(this.style.setLayerZoomRange(d,r,s),this._update(!0)):this}setFilter(d,r,s={}){return this._isValidId(d)?(this.style.setFilter(d,r,s),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,r,s,f={}){return this._isValidId(d)?(this.style.setPaintProperty(d,r,s,f),this._update(!0)):this}getPaintProperty(d,r){return this._isValidId(d)?this.style.getPaintProperty(d,r):null}setLayoutProperty(d,r,s,f={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,r,s,f),this._update(!0)):this}getLayoutProperty(d,r){return this._isValidId(d)?this.style.getLayoutProperty(d,r):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(d){return this.style.setGlyphsUrl(d),this._update(!0)}getSchema(d){return this.style.getSchema(d)}setSchema(d,r){return this.style.setSchema(d,r),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,r){return this.style.setConfig(d,r),this._update(!0)}getConfigProperty(d,r){return this.style.getConfigProperty(d,r)}setConfigProperty(d,r,s){return this.style.setConfigProperty(d,r,s),this._update(!0)}getFeaturesetDescriptors(d){return this.style.getFeaturesetDescriptors(d)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const r=d[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(d){return this._lazyInitEmptyStyle(),this.style.setSnow(d),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(d){return this._lazyInitEmptyStyle(),this.style.setRain(d),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setImportColorTheme(d,r){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(d,r),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.cd.convert(d),this.transform):0}setFeatureState(d,r){return d.source&&!this._isValidId(d.source)?this:(this.style.setFeatureState(d,r),this._update())}removeFeatureState(d,r){return d.source&&!this._isValidId(d.source)?this:(this.style.removeFeatureState(d,r),this._update())}getFeatureState(d){return d.source&&!this._isValidId(d.source)?null:this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let s,f,_,x=this._container;for(;x&&(!f||!_);){const S=window.getComputedStyle(x).transform;S&&S!=="none"&&(s=S.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(f=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(_=s[3])),x=x.parentElement}this._containerWidth=f?Math.abs(d/f):d,this._containerHeight=_?Math.abs(r/_):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=oe("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=oe("div","mapboxgl-canvas-container",d);this._canvas=oe("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=oe("div","mapboxgl-control-container",d),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{f[_]=oe("div",`mapboxgl-ctrl-${_}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,r){const s=o.q.devicePixelRatio||1;this._canvas.width=s*Math.ceil(d),this._canvas.height=s*Math.ceil(r),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${r}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const r=this._markers.indexOf(d);r!==-1&&this._markers.splice(r,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const r=this._popups.indexOf(d);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const d=o.l({},ie.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",d);r?(Kt(r,!0),this.painter=new Ud(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.m.testSupport(r)):this.fire(new o.z(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.A("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.A("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let r;this.fire(new o.A("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,f=o.q.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=_.createQuery(),_.beginQuery(s.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,F=this.transform.pitch,j=o.q.now(),B=new o.aa(R,{now:j,fadeDuration:x,pitch:F,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(f),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(f);const E=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),E&&(this._placementDirty=E.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,L.mark(k.load),this.fire(new o.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const R=o.q.now()-f;_.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const F=_.getQueryParameter(r,_.QUERY_RESULT)/1e6;_.deleteQuery(r),this.fire(new o.A("gpu-timing-frame",{cpuTime:R,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(R);this.fire(new o.A("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(R);this.fire(new o.A("gpu-timing-deferred-render",{gpuTime:F}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(C||this._repaint)this.triggerRepaint();else{const R=this.idle();if(R&&(S=this._updateAverageElevation(f,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new o.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new o.A("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,L.mark(k.fullLoad),this._performanceMetricsCollection&&wn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const r of this._markers)d&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!d||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(d,r=!1){const s=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(r||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=d;const S=Math.abs(_-x);if(S>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(x),s(x);this._averageElevation.easeTo(x,d,300)}else if(S>1e-4)return this._averageElevation.jumpTo(x),s(x)}return!!this._averageElevation.isEasing(d)&&s(this._averageElevation.getValue(d))}_authenticate(){Qr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===Dr||d.status===401)){const r=this.painter.context.gl;Kt(r,!1),this._logoControl instanceof Kh&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),gn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&kr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const s=this.painter.context.gl,f=s.createFramebuffer();function _(x){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,x,0);const S=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,S),S}return s.bindFramebuffer(s.FRAMEBUFFER,f),this._canvasPixelComparison(_(d),r.canvasCopies.map(_),r.timeStamps)}_canvasPixelComparison(d,r,s){let f=s[1]-s[0];const _=d.length/4;for(let x=0;x<r.length;x++){const S=r[x];let E=0;for(let C=0;C<S.length;C+=4)S[C]===d[C]&&S[C+1]===d[C+1]&&S[C+2]===d[C+2]&&S[C+3]===d[C+3]&&(E+=1);f+=(s[x+2]-s[x+1])*(1-E/_)}return f}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Tn.delete(this.painter.context.gl),Nt.remove(),Ur.remove(),this._removed=!0,this.fire(new o.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=o.q.frame(r=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(r)}))}_preloadTiles(d){const r=this.style?this.style.getSourceCaches():[];return o.bt(r,(s,f)=>s._preloadTiles(d,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,r){o.eJ(d,r)}get version(){return D}},NavigationControl:class{constructor(d={}){this.options=o.l({},Wr,d),this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),oe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),oe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:r}):s.resetNorth({},{originalEvent:r}))}),this._compassIcon=oe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const r=d.getZoom(),s=r===d.getMaxZoom(),f=r===d.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ol(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,r){const s=oe("button",d,this._container);return s.type="button",s.addEventListener("click",r),s}_setButtonTitle(d,r){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${r}`);d.setAttribute("aria-label",s),d.firstElementChild&&d.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.E{constructor(d={}){super();const r=navigator.geolocation;this.options=o.l({geolocation:r},tu,d),o.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Kc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const r=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,d(s)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>r(s.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(d){const r=this._map.getMaxBounds(),s=d.coords;return!!r&&(s.longitude<r.getWest()||s.longitude>r.getEast()||s.latitude<r.getSouth()||s.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new o.A("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("geolocate",d)),this._finish()}}_updateCamera(d){const r=new o.cd(d.coords.longitude,d.coords.latitude),s=d.coords.accuracy,f=this._map.getBearing(),_=o.l({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(s),_,{geolocateSource:!0})}_updateMarker(d){if(d){const r=new o.cd(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,r=o.c6(1,d._center.lat)*d.worldSize,s=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=oe("button","mapboxgl-ctrl-geolocate",this._container),oe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=oe("div","mapboxgl-user-location"),this._dotElement.appendChild(oe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(oe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new mc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=oe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new mc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.A("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Qd,ScaleControl:class{constructor(d={}){this.options=o.l({},ru,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,r=this._map,s=r._containerHeight/2,f=r._containerWidth/2-d/2,_=r.unproject([f,s]),x=r.unproject([f+d,s]),S=_.distanceTo(x);if(this.options.unit==="imperial"){const E=3.2808*S;E>5280?this._setScale(d,E/5280,"mile"):this._setScale(d,E,"foot")}else this.options.unit==="nautical"?this._setScale(d,S/1852,"nautical-mile"):S>=1e3?this._setScale(d,S/1e3,"kilometer"):this._setScale(d,S,"meter")}_setScale(d,r,s){this._map._requestDomTask(()=>{const f=function(x){const S=Math.pow(10,`${Math.floor(x)}`.length-1);let E=x/S;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(C){const R=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*R)/R}(E),S*E}(r),_=f/r;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(f):`${f}&nbsp;${Dl[s]}`,this._container.style.width=d*_+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:o.w("Full screen control 'container' must be a DOM element.")),o.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=oe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);oe("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(d){super(),this.options=o.l(Object.create(Cs),d),this._altitude=this.options.altitude,o.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new o.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new o.A("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=o.cd.convert(d),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(d){return this._altitude=d,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const r=document.createDocumentFragment(),s=document.createElement("body");let f;for(s.innerHTML=d;f=s.firstChild,f;)r.appendChild(f);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=oe("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(d),this.options.closeButton){const s=this._closeButton=oe("button","mapboxgl-popup-close-button",r);s.type="button",s.setAttribute("aria-label","Close popup"),s.innerHTML='<span aria-hidden="true">&#215;</span>',s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let r;return this._classList.delete(d)?r=!1:(this._classList.add(d),r=!0),this._updateClassList(),r}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const r=this._map,s=this._container,f=this._pos;if(!r||!s||!f)return"bottom";const _=s.offsetWidth,x=s.offsetHeight,S=f.x<_/2,E=f.x>r.transform.width-_/2;if(f.y+d<x)return S?"top-left":E?"top-right":"top";if(f.y>r.transform.height-x){if(S)return"bottom-left";if(E)return"bottom-right"}return S?"left":E?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),d.className=r.join(" ")}_update(d){const r=this._map,s=this._content;if(!r||!this._lngLat&&!this._trackPointer||!s)return;let f=this._container;if(f||(f=this._container=oe("div","mapboxgl-popup",r.getContainer()),this._tip=oe("div","mapboxgl-popup-tip",f),f.appendChild(s)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Qf(this._lngLat,this._pos,r.transform)),!this._trackPointer||d){const _=this._pos=this._trackPointer&&d instanceof o.P?d:r.project(this._lngLat,this._altitude),x=kl(this.options.offset),S=this._anchor=this._getAnchor(x.y),E=kl(this.options.offset,S),C=_.add(E).round();r._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${ep[S]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&r._showingGlobe()){const _=o.eK(r.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Ms);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:mc,Style:Ts,LngLat:o.cd,LngLatBounds:o.aG,Point:o.P,MercatorCoordinate:o.ac,FreeCameraOptions:Jl,Evented:o.E,config:o.e,prewarm:o.eP,clearPrewarmedResources:o.eQ,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(d){o.e.ACCESS_TOKEN=d},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(d){o.e.API_URL=d},get workerCount(){return o.eR.workerCount},set workerCount(d){o.eR.workerCount=d},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){o.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){o.eS(d)},get workerUrl(){return o.eT.workerUrl},set workerUrl(d){o.eT.workerUrl=d},get workerClass(){return o.eT.workerClass},set workerClass(d){o.eT.workerClass=d},get workerParams(){return o.eT.workerParams},set workerParams(d){o.eT.workerParams=d},get dracoUrl(){return o.eU()},set dracoUrl(d){o.eV(d)},get meshoptUrl(){return o.eW()},set meshoptUrl(d){o.eX(d)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}});var I=y;return I})}(t0)),t0.exports}var H4=W4();const _p=Bs(H4),nS=function(e,n){const l={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},u={on(b,I,o){if(l[b]===void 0)throw new Error(`Invalid event type: ${b}`);l[b].push({selector:I,fn:o})},render(b){n.store.featureChanged(b)}},y=function(b,I){const o=l[b];let D=o.length;for(;D--;){const k=o[D];if(k.selector(I)){k.fn.call(u,I)||n.store.render(),n.ui.updateMapClasses();break}}};return e.start.call(u),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),n.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(b){y("drag",b)},click(b){y("click",b)},mousemove(b){y("mousemove",b)},mousedown(b){y("mousedown",b)},mouseup(b){y("mouseup",b)},mouseout(b){y("mouseout",b)},keydown(b){y("keydown",b)},keyup(b){y("keyup",b)},touchstart(b){y("touchstart",b)},touchmove(b){y("touchmove",b)},touchend(b){y("touchend",b)},tap(b){y("tap",b)}}};var Fv={},$_={},ZP;function Z4(){return ZP||(ZP=1,$_.RADIUS=6378137,$_.FLATTENING=1/298.257223563,$_.POLAR_RADIUS=63567523142e-4),$_}var XP;function X4(){if(XP)return Fv;XP=1;var e=Z4();Fv.geometry=n,Fv.ring=u;function n(b){var I=0,o;switch(b.type){case"Polygon":return l(b.coordinates);case"MultiPolygon":for(o=0;o<b.coordinates.length;o++)I+=l(b.coordinates[o]);return I;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(o=0;o<b.geometries.length;o++)I+=n(b.geometries[o]);return I}}function l(b){var I=0;if(b&&b.length>0){I+=Math.abs(u(b[0]));for(var o=1;o<b.length;o++)I-=Math.abs(u(b[o]))}return I}function u(b){var I,o,D,k,L,$,q,Z=0,ie=b.length;if(ie>2){for(q=0;q<ie;q++)q===ie-2?(k=ie-2,L=ie-1,$=0):q===ie-1?(k=ie-1,L=0,$=1):(k=q,L=q+1,$=q+2),I=b[k],o=b[L],D=b[$],Z+=(y(D[0])-y(I[0]))*Math.sin(y(o[1]));Z=Z*e.RADIUS*e.RADIUS/2}return Z}function y(b){return b*Math.PI/180}return Fv}var Y4=X4();const K4=Bs(Y4),jl={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},cu={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Go={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},Ul={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Pn={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},Fi={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},ol={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Sy={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},Ns={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Wa={ACTIVE:"true",INACTIVE:"false"},Pk=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],J4=-90,iS=-85,Q4=90,oS=85,e5=-270,t5=270,Ck=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:Q4,LAT_MIN:J4,LAT_RENDERED_MAX:oS,LAT_RENDERED_MIN:iS,LNG_MAX:t5,LNG_MIN:e5,activeStates:Wa,classes:jl,cursors:Go,events:ol,geojsonTypes:Pn,interactions:Pk,meta:Ns,modes:Fi,sources:cu,types:Ul,updateActions:Sy},Symbol.toStringTag,{value:"Module"})),YP={Point:0,LineString:1,MultiLineString:1,Polygon:2};function r5(e,n){const l=YP[e.geometry.type]-YP[n.geometry.type];return l===0&&e.geometry.type===Pn.POLYGON?e.area-n.area:l}function Mk(e){return e.map(n=>(n.geometry.type===Pn.POLYGON&&(n.area=K4.geometry({type:Pn.FEATURE,property:{},geometry:n.geometry})),n)).sort(r5).map(n=>(delete n.area,n))}function Ok(e,n=0){return[[e.point.x-n,e.point.y-n],[e.point.x+n,e.point.y+n]]}function du(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let n=0,l=e.length;n<l;n++)this.add(e[n]),e[n]!==void 0&&(typeof e[n]=="string"?this._items[e[n]]=n:this._nums[e[n]]=n)}du.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};du.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};du.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};du.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(n=>{e.push({k:n,v:this._items[n]})}),Object.keys(this._nums).forEach(n=>{e.push({k:JSON.parse(n),v:this._nums[n]})}),e.sort((n,l)=>n.v-l.v).map(n=>n.k)};du.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const n5=[Ns.FEATURE,Ns.MIDPOINT,Ns.VERTEX],Cg={click:i5,touch:o5};function i5(e,n,l){return Dk(e,n,l,l.options.clickBuffer)}function o5(e,n,l){return Dk(e,n,l,l.options.touchBuffer)}function Dk(e,n,l,u){if(l.map===null)return[];const y=e?Ok(e,u):n,b={};l.options.styles&&(b.layers=l.options.styles.map(k=>k.id).filter(k=>l.map.getLayer(k)!=null));const I=l.map.queryRenderedFeatures(y,b).filter(k=>n5.indexOf(k.properties.meta)!==-1),o=new du,D=[];return I.forEach(k=>{const L=k.properties.id;o.has(L)||(o.add(L),D.push(k))}),Mk(D)}function r0(e,n){const l=Cg.click(e,null,n),u={mouse:Go.NONE};return l[0]&&(u.mouse=l[0].properties.active===Wa.ACTIVE?Go.MOVE:Go.POINTER,u.feature=l[0].properties.meta),n.events.currentModeName().indexOf("draw")!==-1&&(u.mouse=Go.ADD),n.ui.queueMapClasses(u),n.ui.updateMapClasses(),l[0]}function uT(e,n){const l=e.x-n.x,u=e.y-n.y;return Math.sqrt(l*l+u*u)}const a5=4,s5=12,l5=500;function aS(e,n,l={}){const u=l.fineTolerance!=null?l.fineTolerance:a5,y=l.grossTolerance!=null?l.grossTolerance:s5,b=l.interval!=null?l.interval:l5;e.point=e.point||n.point,e.time=e.time||n.time;const I=uT(e.point,n.point);return I<u||I<y&&n.time-e.time<b}const c5=25,u5=250;function sS(e,n,l={}){const u=l.tolerance!=null?l.tolerance:c5,y=l.interval!=null?l.interval:u5;return e.point=e.point||n.point,e.time=e.time||n.time,uT(e.point,n.point)<u&&n.time-e.time<y}let h5=(e,n=21)=>(l=n)=>{let u="",y=l|0;for(;y--;)u+=e[Math.random()*e.length|0];return u};const d5=h5("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function hT(){return d5()}const al=function(e,n){this.ctx=e,this.properties=n.properties||{},this.coordinates=n.geometry.coordinates,this.id=n.id||hT(),this.type=n.geometry.type};al.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};al.prototype.incomingCoords=function(e){this.setCoordinates(e)};al.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};al.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};al.prototype.setProperty=function(e,n){this.properties[e]=n};al.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Pn.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};al.prototype.internal=function(e){const n={id:this.id,meta:Ns.FEATURE,"meta:type":this.type,active:Wa.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const l in this.properties)n[`user_${l}`]=this.properties[l];return{type:Pn.FEATURE,properties:n,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const Sp=function(e,n){al.call(this,e,n)};Sp.prototype=Object.create(al.prototype);Sp.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};Sp.prototype.updateCoordinate=function(e,n,l){arguments.length===3?this.coordinates=[n,l]:this.coordinates=[e,n],this.changed()};Sp.prototype.getCoordinate=function(){return this.getCoordinates()};const hd=function(e,n){al.call(this,e,n)};hd.prototype=Object.create(al.prototype);hd.prototype.isValid=function(){return this.coordinates.length>1};hd.prototype.addCoordinate=function(e,n,l){this.changed();const u=parseInt(e,10);this.coordinates.splice(u,0,[n,l])};hd.prototype.getCoordinate=function(e){const n=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[n]))};hd.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};hd.prototype.updateCoordinate=function(e,n,l){const u=parseInt(e,10);this.coordinates[u]=[n,l],this.changed()};const Cc=function(e,n){al.call(this,e,n),this.coordinates=this.coordinates.map(l=>l.slice(0,-1))};Cc.prototype=Object.create(al.prototype);Cc.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};Cc.prototype.incomingCoords=function(e){this.coordinates=e.map(n=>n.slice(0,-1)),this.changed()};Cc.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};Cc.prototype.addCoordinate=function(e,n,l){this.changed();const u=e.split(".").map(b=>parseInt(b,10));this.coordinates[u[0]].splice(u[1],0,[n,l])};Cc.prototype.removeCoordinate=function(e){this.changed();const n=e.split(".").map(u=>parseInt(u,10)),l=this.coordinates[n[0]];l&&(l.splice(n[1],1),l.length<3&&this.coordinates.splice(n[0],1))};Cc.prototype.getCoordinate=function(e){const n=e.split(".").map(u=>parseInt(u,10)),l=this.coordinates[n[0]];return JSON.parse(JSON.stringify(l[n[1]]))};Cc.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};Cc.prototype.updateCoordinate=function(e,n,l){this.changed();const u=e.split("."),y=parseInt(u[0],10),b=parseInt(u[1],10);this.coordinates[y]===void 0&&(this.coordinates[y]=[]),this.coordinates[y][b]=[n,l]};const f5={MultiPoint:Sp,MultiLineString:hd,MultiPolygon:Cc},Z0=(e,n,l,u,y)=>{const b=l.split("."),I=parseInt(b[0],10),o=b[1]?b.slice(1).join("."):null;return e[I][n](o,u,y)},il=function(e,n){if(al.call(this,e,n),delete this.coordinates,this.model=f5[n.geometry.type],this.model===void 0)throw new TypeError(`${n.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(n.geometry.coordinates)};il.prototype=Object.create(al.prototype);il.prototype._coordinatesToFeatures=function(e){const n=this.model.bind(this);return e.map(l=>new n(this.ctx,{id:hT(),type:Pn.FEATURE,properties:{},geometry:{coordinates:l,type:this.type.replace("Multi","")}}))};il.prototype.isValid=function(){return this.features.every(e=>e.isValid())};il.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};il.prototype.getCoordinate=function(e){return Z0(this.features,"getCoordinate",e)};il.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===Pn.POLYGON?e.getCoordinates():e.coordinates)))};il.prototype.updateCoordinate=function(e,n,l){Z0(this.features,"updateCoordinate",e,n,l),this.changed()};il.prototype.addCoordinate=function(e,n,l){Z0(this.features,"addCoordinate",e,n,l),this.changed()};il.prototype.removeCoordinate=function(e){Z0(this.features,"removeCoordinate",e),this.changed()};il.prototype.getFeatures=function(){return this.features};function wi(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}wi.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};wi.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((n,l)=>(n[l.feature_id]===void 0&&(n[l.feature_id]=!0,this._ctx.store.get(l.feature_id).changed()),n),{})};wi.prototype.getSelected=function(){return this._ctx.store.getSelected()};wi.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};wi.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};wi.prototype.getFeature=function(e){return this._ctx.store.get(e)};wi.prototype.select=function(e){return this._ctx.store.select(e)};wi.prototype.deselect=function(e){return this._ctx.store.deselect(e)};wi.prototype.deleteFeature=function(e,n={}){return this._ctx.store.delete(e,n)};wi.prototype.addFeature=function(e,n={}){return this._ctx.store.add(e,n)};wi.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};wi.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};wi.prototype.setActionableState=function(e={}){const n={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(n)};wi.prototype.changeMode=function(e,n={},l={}){return this._ctx.events.changeMode(e,n,l)};wi.prototype.fire=function(e,n){return this._ctx.events.fire(e,n)};wi.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};wi.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};wi.prototype.featuresAt=function(e,n,l="click"){if(l!=="click"&&l!=="touch")throw new Error("invalid buffer type");return Cg[l](e,n,this._ctx)};wi.prototype.newFeature=function(e){const n=e.geometry.type;return n===Pn.POINT?new Sp(this._ctx,e):n===Pn.LINE_STRING?new hd(this._ctx,e):n===Pn.POLYGON?new Cc(this._ctx,e):new il(this._ctx,e)};wi.prototype.isInstanceOf=function(e,n){if(e===Pn.POINT)return n instanceof Sp;if(e===Pn.LINE_STRING)return n instanceof hd;if(e===Pn.POLYGON)return n instanceof Cc;if(e==="MultiFeature")return n instanceof il;throw new Error(`Unknown feature class: ${e}`)};wi.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};wi.prototype.onSetup=function(){};wi.prototype.onDrag=function(){};wi.prototype.onClick=function(){};wi.prototype.onMouseMove=function(){};wi.prototype.onMouseDown=function(){};wi.prototype.onMouseUp=function(){};wi.prototype.onMouseOut=function(){};wi.prototype.onKeyUp=function(){};wi.prototype.onKeyDown=function(){};wi.prototype.onTouchStart=function(){};wi.prototype.onTouchMove=function(){};wi.prototype.onTouchEnd=function(){};wi.prototype.onTap=function(){};wi.prototype.onStop=function(){};wi.prototype.onTrash=function(){};wi.prototype.onCombineFeature=function(){};wi.prototype.onUncombineFeature=function(){};wi.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const kk={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},p5=Object.keys(kk);function m5(e){const n=Object.keys(e);return function(l,u={}){let y={};const b=n.reduce((o,D)=>(o[D]=e[D],o),new wi(l));function I(o){return D=>b[o](y,D)}return{start(){y=b.onSetup(u),p5.forEach(o=>{const D=kk[o];let k=()=>!1;e[D]&&(k=()=>!0),this.on(o,k,I(D))})},stop(){b.onStop(y)},trash(){b.onTrash(y)},combineFeatures(){b.onCombineFeatures(y)},uncombineFeatures(){b.onUncombineFeatures(y)},render(o,D){b.toDisplayFeatures(y,o,D)}}}}function g5(e){const n=Object.keys(e.options.modes).reduce((q,Z)=>(q[Z]=m5(e.options.modes[Z]),q),{});let l={},u={};const y={};let b=null,I=null;y.drag=function(q,Z){Z({point:q.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:Go.DRAG}),I.drag(q)):q.originalEvent.stopPropagation()},y.mousedrag=function(q){y.drag(q,Z=>!aS(l,Z))},y.touchdrag=function(q){y.drag(q,Z=>!sS(u,Z))},y.mousemove=function(q){if((q.originalEvent.buttons!==void 0?q.originalEvent.buttons:q.originalEvent.which)===1)return y.mousedrag(q);const ie=r0(q,e);q.featureTarget=ie,I.mousemove(q)},y.mousedown=function(q){l={time:new Date().getTime(),point:q.point};const Z=r0(q,e);q.featureTarget=Z,I.mousedown(q)},y.mouseup=function(q){const Z=r0(q,e);q.featureTarget=Z,aS(l,{point:q.point,time:new Date().getTime()})?I.click(q):I.mouseup(q)},y.mouseout=function(q){I.mouseout(q)},y.touchstart=function(q){if(!e.options.touchEnabled)return;u={time:new Date().getTime(),point:q.point};const Z=Cg.touch(q,null,e)[0];q.featureTarget=Z,I.touchstart(q)},y.touchmove=function(q){if(e.options.touchEnabled)return I.touchmove(q),y.touchdrag(q)},y.touchend=function(q){if(q.originalEvent.preventDefault(),!e.options.touchEnabled)return;const Z=Cg.touch(q,null,e)[0];q.featureTarget=Z,sS(u,{time:new Date().getTime(),point:q.point})?I.tap(q):I.touchend(q)};const o=q=>!(q===8||q===46||q>=48&&q<=57);y.keydown=function(q){(q.srcElement||q.target).classList.contains(jl.CANVAS)&&((q.keyCode===8||q.keyCode===46)&&e.options.controls.trash?(q.preventDefault(),I.trash()):o(q.keyCode)?I.keydown(q):q.keyCode===49&&e.options.controls.point?D(Fi.DRAW_POINT):q.keyCode===50&&e.options.controls.line_string?D(Fi.DRAW_LINE_STRING):q.keyCode===51&&e.options.controls.polygon&&D(Fi.DRAW_POLYGON))},y.keyup=function(q){o(q.keyCode)&&I.keyup(q)},y.zoomend=function(){e.store.changeZoom()},y.data=function(q){if(q.dataType==="style"){const{setup:Z,map:ie,options:oe,store:le}=e;oe.styles.some(ge=>ie.getLayer(ge.id))||(Z.addLayers(),le.setDirty(),le.render())}};function D(q,Z,ie={}){I.stop();const oe=n[q];if(oe===void 0)throw new Error(`${q} is not valid`);b=q;const le=oe(e,Z);I=nS(le,e),ie.silent||e.map.fire(ol.MODE_CHANGE,{mode:q}),e.store.setDirty(),e.store.render()}const k={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function L(q){let Z=!1;Object.keys(q).forEach(ie=>{if(k[ie]===void 0)throw new Error("Invalid action type");k[ie]!==q[ie]&&(Z=!0),k[ie]=q[ie]}),Z&&e.map.fire(ol.ACTIONABLE,{actions:k})}return{start(){b=e.options.defaultMode,I=nS(n[b](e),e)},changeMode:D,actionable:L,currentModeName(){return b},currentModeRender(q,Z){return I.render(q,Z)},fire(q,Z){e.map&&e.map.fire(q,Z)},addEventListeners(){e.map.on("mousemove",y.mousemove),e.map.on("mousedown",y.mousedown),e.map.on("mouseup",y.mouseup),e.map.on("data",y.data),e.map.on("touchmove",y.touchmove),e.map.on("touchstart",y.touchstart),e.map.on("touchend",y.touchend),e.container.addEventListener("mouseout",y.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",y.keydown),e.container.addEventListener("keyup",y.keyup))},removeEventListeners(){e.map.off("mousemove",y.mousemove),e.map.off("mousedown",y.mousedown),e.map.off("mouseup",y.mouseup),e.map.off("data",y.data),e.map.off("touchmove",y.touchmove),e.map.off("touchstart",y.touchstart),e.map.off("touchend",y.touchend),e.container.removeEventListener("mouseout",y.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",y.keydown),e.container.removeEventListener("keyup",y.keyup))},trash(q){I.trash(q)},combineFeatures(){I.combineFeatures()},uncombineFeatures(){I.uncombineFeatures()},getMode(){return b}}}function Ty(e){return[].concat(e).filter(n=>n!==void 0)}function _5(){const e=this;if(!(e.ctx.map&&e.ctx.map.getSource(cu.HOT)!==void 0))return D();const l=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:l});let u=[],y=[];e.isDirty?y=e.getAllIds():(u=e.getChangedIds().filter(k=>e.get(k)!==void 0),y=e.sources.hot.filter(k=>k.properties.id&&u.indexOf(k.properties.id)===-1&&e.get(k.properties.id)!==void 0).map(k=>k.properties.id)),e.sources.hot=[];const b=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(k=>{const L=k.properties.id||k.properties.parent;return u.indexOf(L)===-1});const I=b!==e.sources.cold.length||y.length>0;u.forEach(k=>o(k,"hot")),y.forEach(k=>o(k,"cold"));function o(k,L){const q=e.get(k).internal(l);e.ctx.events.currentModeRender(q,Z=>{Z.properties.mode=l,e.sources[L].push(Z)})}I&&e.ctx.map.getSource(cu.COLD).setData({type:Pn.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(cu.HOT).setData({type:Pn.FEATURE_COLLECTION,features:e.sources.hot}),D();function D(){e.isDirty=!1,e.clearChangedIds()}}function Po(e){this._features={},this._featureIds=new du,this._selectedFeatureIds=new du,this._selectedCoordinates=[],this._changedFeatureIds=new du,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]};let n;this.render=()=>{n||(n=requestAnimationFrame(()=>{n=null,_5.call(this),this._emitSelectionChange&&(this.ctx.events.fire(ol.SELECTION_CHANGE,{features:this.getSelected().map(l=>l.toGeoJSON()),points:this.getSelectedCoordinates().map(l=>({type:Pn.FEATURE,properties:{},geometry:{type:Pn.POINT,coordinates:l.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(ol.RENDER,{})}))},this.isDirty=!1}Po.prototype.createRenderBatch=function(){const e=this.render;let n=0;return this.render=function(){n++},()=>{this.render=e,n>0&&this.render()}};Po.prototype.setDirty=function(){return this.isDirty=!0,this};Po.prototype.featureCreated=function(e,n={}){if(this._changedFeatureIds.add(e),(n.silent!=null?n.silent:this.ctx.options.suppressAPIEvents)!==!0){const u=this.get(e);this.ctx.events.fire(ol.CREATE,{features:[u.toGeoJSON()]})}return this};Po.prototype.featureChanged=function(e,n={}){return this._changedFeatureIds.add(e),(n.silent!=null?n.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(ol.UPDATE,{action:n.action?n.action:Sy.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this};Po.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};Po.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};Po.prototype.getAllIds=function(){return this._featureIds.values()};Po.prototype.add=function(e,n={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:n.silent}),this};Po.prototype.delete=function(e,n={}){const l=[];return Ty(e).forEach(u=>{this._featureIds.has(u)&&(this._featureIds.delete(u),this._selectedFeatureIds.delete(u),n.silent||l.indexOf(this._features[u])===-1&&l.push(this._features[u].toGeoJSON()),delete this._features[u],this.isDirty=!0)}),l.length&&this.ctx.events.fire(ol.DELETE,{features:l}),Rk(this,n),this};Po.prototype.get=function(e){return this._features[e]};Po.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};Po.prototype.select=function(e,n={}){return Ty(e).forEach(l=>{this._selectedFeatureIds.has(l)||(this._selectedFeatureIds.add(l),this._changedFeatureIds.add(l),n.silent||(this._emitSelectionChange=!0))}),this};Po.prototype.deselect=function(e,n={}){return Ty(e).forEach(l=>{this._selectedFeatureIds.has(l)&&(this._selectedFeatureIds.delete(l),this._changedFeatureIds.add(l),n.silent||(this._emitSelectionChange=!0))}),Rk(this,n),this};Po.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};Po.prototype.setSelected=function(e,n={}){return e=Ty(e),this.deselect(this._selectedFeatureIds.values().filter(l=>e.indexOf(l)===-1),{silent:n.silent}),this.select(e.filter(l=>!this._selectedFeatureIds.has(l)),{silent:n.silent}),this};Po.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};Po.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};Po.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};Po.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))};Po.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(n=>({coordinates:this.get(n.feature_id).getCoordinate(n.coord_path)}))};Po.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};Po.prototype.setFeatureProperty=function(e,n,l,u={}){this.get(e).setProperty(n,l),this.featureChanged(e,{silent:u.silent,action:Sy.CHANGE_PROPERTIES})};function Rk(e,n={}){const l=e._selectedCoordinates.filter(u=>e._selectedFeatureIds.has(u.feature_id));e._selectedCoordinates.length!==l.length&&!n.silent&&(e._emitSelectionChange=!0),e._selectedCoordinates=l}Po.prototype.storeMapConfig=function(){Pk.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};Po.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};Po.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};const y5=["mode","feature","mouse"];function v5(e){const n={};let l=null,u={mode:null,feature:null,mouse:null},y={mode:null,feature:null,mouse:null};function b(){I({mode:null,feature:null,mouse:null}),o()}function I(Z){y=Object.assign(y,Z)}function o(){if(!e.container)return;const Z=[],ie=[];y5.forEach(oe=>{y[oe]!==u[oe]&&(Z.push(`${oe}-${u[oe]}`),y[oe]!==null&&ie.push(`${oe}-${y[oe]}`))}),Z.length>0&&e.container.classList.remove(...Z),ie.length>0&&e.container.classList.add(...ie),u=Object.assign(u,y)}function D(Z,ie={}){const oe=document.createElement("button");return oe.className=`${jl.CONTROL_BUTTON} ${ie.className}`,oe.setAttribute("title",ie.title),ie.container.appendChild(oe),oe.addEventListener("click",le=>{if(le.preventDefault(),le.stopPropagation(),le.target===l){k(),ie.onDeactivate();return}L(Z),ie.onActivate()},!0),oe}function k(){l&&(l.classList.remove(jl.ACTIVE_BUTTON),l=null)}function L(Z){k();const ie=n[Z];ie&&ie&&Z!=="trash"&&(ie.classList.add(jl.ACTIVE_BUTTON),l=ie)}function $(){const Z=e.options.controls,ie=document.createElement("div");return ie.className=`${jl.CONTROL_GROUP} ${jl.CONTROL_BASE}`,Z&&(Z[Ul.LINE]&&(n[Ul.LINE]=D(Ul.LINE,{container:ie,className:jl.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(l)":""}`,onActivate:()=>e.events.changeMode(Fi.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),Z[Ul.POLYGON]&&(n[Ul.POLYGON]=D(Ul.POLYGON,{container:ie,className:jl.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(p)":""}`,onActivate:()=>e.events.changeMode(Fi.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),Z[Ul.POINT]&&(n[Ul.POINT]=D(Ul.POINT,{container:ie,className:jl.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(m)":""}`,onActivate:()=>e.events.changeMode(Fi.DRAW_POINT),onDeactivate:()=>e.events.trash()})),Z.trash&&(n.trash=D("trash",{container:ie,className:jl.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),Z.combine_features&&(n.combine_features=D("combineFeatures",{container:ie,className:jl.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),Z.uncombine_features&&(n.uncombine_features=D("uncombineFeatures",{container:ie,className:jl.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),ie}function q(){Object.keys(n).forEach(Z=>{const ie=n[Z];ie.parentNode&&ie.parentNode.removeChild(ie),delete n[Z]})}return{setActiveButton:L,queueMapClasses:I,updateMapClasses:o,clearMapClasses:b,addButtons:$,removeButtons:q}}function x5(e){let n=null,l=null;const u={onRemove(){return e.map.off("load",u.connect),clearInterval(l),u.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,n&&n.parentNode&&n.parentNode.removeChild(n),n=null,this},connect(){e.map.off("load",u.connect),clearInterval(l),u.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(y){if(e.map=y,e.events=g5(e),e.ui=v5(e),e.container=y.getContainer(),e.store=new Po(e),n=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=y.boxZoom.isEnabled(),y.boxZoom.disable();const b=y.dragPan.isEnabled();y.dragPan.disable(),y.dragPan.enable(),b||y.dragPan.disable()}return y.loaded()?u.connect():(y.on("load",u.connect),l=setInterval(()=>{y.loaded()&&u.connect()},16)),e.events.start(),n},addLayers(){e.map.addSource(cu.COLD,{data:{type:Pn.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(cu.HOT,{data:{type:Pn.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(y=>{e.map.addLayer(y)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(y=>{e.map.getLayer(y.id)&&e.map.removeLayer(y.id)}),e.map.getSource(cu.COLD)&&e.map.removeSource(cu.COLD),e.map.getSource(cu.HOT)&&e.map.removeSource(cu.HOT)}};return e.setup=u,u}const ib="#3bb2d0",G_="#fbb03b",KP="#fff",Lk=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],G_,ib],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],G_,ib],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":KP}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],G_,ib]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":KP}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":G_}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":G_}}];function X0(e){return function(n){const l=n.featureTarget;return!l||!l.properties?!1:l.properties.meta===e}}function zk(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0}function jm(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===Wa.ACTIVE&&e.featureTarget.properties.meta===Ns.FEATURE}function dT(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===Wa.INACTIVE&&e.featureTarget.properties.meta===Ns.FEATURE}function Y0(e){return e.featureTarget===void 0}function fT(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===Ns.FEATURE}function Ey(e){const n=e.featureTarget;return!n||!n.properties?!1:n.properties.meta===Ns.VERTEX}function o0(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1}function K0(e){return e.keyCode===27}function J0(e){return e.keyCode===13}function b5(){return!0}const w5=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature:jm,isEnterKey:J0,isEscapeKey:K0,isFeature:fT,isInactiveFeature:dT,isOfMetaType:X0,isShiftDown:o0,isShiftMousedown:zk,isTrue:b5,isVertex:Ey,noTarget:Y0},Symbol.toStringTag,{value:"Module"}));function yp(e,n){this.x=e,this.y=n}yp.prototype={clone(){return new yp(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,n){return this.clone()._rotateAround(e,n)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const n=e.x-this.x,l=e.y-this.y;return n*n+l*l},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,n){return Math.atan2(this.x*n-this.y*e,this.x*e+this.y*n)},_matMult(e){const n=e[0]*this.x+e[1]*this.y,l=e[2]*this.x+e[3]*this.y;return this.x=n,this.y=l,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const n=Math.cos(e),l=Math.sin(e),u=n*this.x-l*this.y,y=l*this.x+n*this.y;return this.x=u,this.y=y,this},_rotateAround(e,n){const l=Math.cos(e),u=Math.sin(e),y=n.x+l*(this.x-n.x)-u*(this.y-n.y),b=n.y+u*(this.x-n.x)+l*(this.y-n.y);return this.x=y,this.y=b,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:yp};yp.convert=function(e){if(e instanceof yp)return e;if(Array.isArray(e))return new yp(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new yp(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};function pT(e,n){const l=n.getBoundingClientRect();return new yp(e.clientX-l.left-(n.clientLeft||0),e.clientY-l.top-(n.clientTop||0))}function Mg(e,n,l,u){return{type:Pn.FEATURE,properties:{meta:Ns.VERTEX,parent:e,coord_path:l,active:u?Wa.ACTIVE:Wa.INACTIVE},geometry:{type:Pn.POINT,coordinates:n}}}function Fk(e,n,l){const u=n.geometry.coordinates,y=l.geometry.coordinates;if(u[1]>oS||u[1]<iS||y[1]>oS||y[1]<iS)return null;const b={lng:(u[0]+y[0])/2,lat:(u[1]+y[1])/2};return{type:Pn.FEATURE,properties:{meta:Ns.MIDPOINT,parent:e,lng:b.lng,lat:b.lat,coord_path:l.properties.coord_path},geometry:{type:Pn.POINT,coordinates:[b.lng,b.lat]}}}function Q0(e,n={},l=null){const{type:u,coordinates:y}=e.geometry,b=e.properties&&e.properties.id;let I=[];u===Pn.POINT?I.push(Mg(b,y,l,D(l))):u===Pn.POLYGON?y.forEach((L,$)=>{o(L,l!==null?`${l}.${$}`:String($))}):u===Pn.LINE_STRING?o(y,l):u.indexOf(Pn.MULTI_PREFIX)===0&&k();function o(L,$){let q="",Z=null;L.forEach((ie,oe)=>{const le=$!=null?`${$}.${oe}`:String(oe),xe=Mg(b,ie,le,D(le));if(n.midpoints&&Z){const ke=Fk(b,Z,xe);ke&&I.push(ke)}Z=xe;const ge=JSON.stringify(ie);q!==ge&&I.push(xe),oe===0&&(q=ge)})}function D(L){return n.selectedPaths?n.selectedPaths.indexOf(L)!==-1:!1}function k(){const L=u.replace(Pn.MULTI_PREFIX,"");y.forEach(($,q)=>{const Z={type:Pn.FEATURE,properties:e.properties,geometry:{type:L,coordinates:$}};I=I.concat(Q0(Z,n,q))})}return I}const ih={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},{LAT_MIN:Nv,LAT_MAX:Bv,LAT_RENDERED_MIN:JP,LAT_RENDERED_MAX:QP,LNG_MIN:eC,LNG_MAX:tC}=Ck;function S5(e){const n={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],l=[e.geometry.coordinates].flat(n),u=l.map(o=>o[0]),y=l.map(o=>o[1]),b=o=>Math.min.apply(null,o),I=o=>Math.max.apply(null,o);return[b(u),b(y),I(u),I(y)]}function mT(e,n){let l=Nv,u=Bv,y=Nv,b=Bv,I=tC,o=eC;e.forEach(k=>{const L=S5(k),$=L[1],q=L[3],Z=L[0],ie=L[2];$>l&&(l=$),q<u&&(u=q),q>y&&(y=q),$<b&&(b=$),Z<I&&(I=Z),ie>o&&(o=ie)});const D=n;return l+D.lat>QP&&(D.lat=QP-l),y+D.lat>Bv&&(D.lat=Bv-y),u+D.lat<JP&&(D.lat=JP-u),b+D.lat<Nv&&(D.lat=Nv-b),I+D.lng<=eC&&(D.lng+=Math.ceil(Math.abs(D.lng)/360)*360),o+D.lng>=tC&&(D.lng-=Math.ceil(Math.abs(D.lng)/360)*360),D}function gT(e,n){const l=mT(e.map(u=>u.toGeoJSON()),n);e.forEach(u=>{const y=u.getCoordinates(),b=k=>{const L={lng:k[0]+l.lng,lat:k[1]+l.lat};return[L.lng,L.lat]},I=k=>k.map(L=>b(L)),o=k=>k.map(L=>I(L));let D;u.type===Pn.POINT?D=b(y):u.type===Pn.LINE_STRING||u.type===Pn.MULTI_POINT?D=y.map(b):u.type===Pn.POLYGON||u.type===Pn.MULTI_LINE_STRING?D=y.map(I):u.type===Pn.MULTI_POLYGON&&(D=y.map(o)),u.incomingCoords(D)})}const yo={};yo.onSetup=function(e){const n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter(l=>this.getFeature(l)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),n};yo.fireUpdate=function(){this.fire(ol.UPDATE,{action:Sy.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};yo.fireActionable=function(){const e=this.getSelected(),n=e.filter(b=>this.isInstanceOf("MultiFeature",b));let l=!1;if(e.length>1){l=!0;const b=e[0].type.replace("Multi","");e.forEach(I=>{I.type.replace("Multi","")!==b&&(l=!1)})}const u=n.length>0,y=e.length>0;this.setActionableState({combineFeatures:l,uncombineFeatures:u,trash:y})};yo.getUniqueIds=function(e){return e.length?e.map(l=>l.properties.id).filter(l=>l!==void 0).reduce((l,u)=>(l.add(u),l),new du).values():[]};yo.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};yo.onStop=function(){ih.enable(this)};yo.onMouseMove=function(e,n){return fT(n)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0};yo.onMouseOut=function(e){return e.dragMoving?this.fireUpdate():!0};yo.onTap=yo.onClick=function(e,n){if(Y0(n))return this.clickAnywhere(e,n);if(X0(Ns.VERTEX)(n))return this.clickOnVertex(e,n);if(fT(n))return this.clickOnFeature(e,n)};yo.clickAnywhere=function(e){const n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach(l=>this.doRender(l))),ih.enable(this),this.stopExtendedInteractions(e)};yo.clickOnVertex=function(e,n){this.changeMode(Fi.DIRECT_SELECT,{featureId:n.featureTarget.properties.parent,coordPath:n.featureTarget.properties.coord_path,startPos:n.lngLat}),this.updateUIClasses({mouse:Go.MOVE})};yo.startOnActiveFeature=function(e,n){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(n.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=n.lngLat};yo.clickOnFeature=function(e,n){ih.disable(this),this.stopExtendedInteractions(e);const l=o0(n),u=this.getSelectedIds(),y=n.featureTarget.properties.id,b=this.isSelected(y);if(!l&&b&&this.getFeature(y).type!==Pn.POINT)return this.changeMode(Fi.DIRECT_SELECT,{featureId:y});b&&l?(this.deselect(y),this.updateUIClasses({mouse:Go.POINTER}),u.length===1&&ih.enable(this)):!b&&l?(this.select(y),this.updateUIClasses({mouse:Go.MOVE})):!b&&!l&&(u.forEach(I=>this.doRender(I)),this.setSelected(y),this.updateUIClasses({mouse:Go.MOVE})),this.doRender(y)};yo.onMouseDown=function(e,n){if(e.initialDragPanState=this.map.dragPan.isEnabled(),jm(n))return this.startOnActiveFeature(e,n);if(this.drawConfig.boxSelect&&zk(n))return this.startBoxSelect(e,n)};yo.startBoxSelect=function(e,n){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=pT(n.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};yo.onTouchStart=function(e,n){if(jm(n))return this.startOnActiveFeature(e,n)};yo.onDrag=function(e,n){if(e.canDragMove)return this.dragMove(e,n);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,n)};yo.whileBoxSelect=function(e,n){e.boxSelecting=!0,this.updateUIClasses({mouse:Go.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(jl.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const l=pT(n.originalEvent,this.map.getContainer()),u=Math.min(e.boxSelectStartLocation.x,l.x),y=Math.max(e.boxSelectStartLocation.x,l.x),b=Math.min(e.boxSelectStartLocation.y,l.y),I=Math.max(e.boxSelectStartLocation.y,l.y),o=`translate(${u}px, ${b}px)`;e.boxSelectElement.style.transform=o,e.boxSelectElement.style.WebkitTransform=o,e.boxSelectElement.style.width=`${y-u}px`,e.boxSelectElement.style.height=`${I-b}px`};yo.dragMove=function(e,n){e.dragMoving=!0,n.originalEvent.stopPropagation();const l={lng:n.lngLat.lng-e.dragMoveLocation.lng,lat:n.lngLat.lat-e.dragMoveLocation.lat};gT(this.getSelected(),l),e.dragMoveLocation=n.lngLat};yo.onTouchEnd=yo.onMouseUp=function(e,n){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const l=[e.boxSelectStartLocation,pT(n.originalEvent,this.map.getContainer())],u=this.featuresAt(null,l,"click"),y=this.getUniqueIds(u).filter(b=>!this.isSelected(b));y.length&&(this.select(y),y.forEach(b=>this.doRender(b)),this.updateUIClasses({mouse:Go.MOVE}))}this.stopExtendedInteractions(e)};yo.toDisplayFeatures=function(e,n,l){n.properties.active=this.isSelected(n.properties.id)?Wa.ACTIVE:Wa.INACTIVE,l(n),this.fireActionable(),!(n.properties.active!==Wa.ACTIVE||n.geometry.type===Pn.POINT)&&Q0(n).forEach(l)};yo.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};yo.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const n=[],l=[],u=e[0].type.replace("Multi","");for(let y=0;y<e.length;y++){const b=e[y];if(b.type.replace("Multi","")!==u)return;b.type.includes("Multi")?b.getCoordinates().forEach(I=>{n.push(I)}):n.push(b.getCoordinates()),l.push(b.toGeoJSON())}if(l.length>1){const y=this.newFeature({type:Pn.FEATURE,properties:l[0].properties,geometry:{type:`Multi${u}`,coordinates:n}});this.addFeature(y),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([y.id]),this.fire(ol.COMBINE_FEATURES,{createdFeatures:[y.toGeoJSON()],deletedFeatures:l})}this.fireActionable()};yo.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const n=[],l=[];for(let u=0;u<e.length;u++){const y=e[u];this.isInstanceOf("MultiFeature",y)&&(y.getFeatures().forEach(b=>{this.addFeature(b),b.properties=y.properties,n.push(b.toGeoJSON()),this.select([b.id])}),this.deleteFeature(y.id,{silent:!0}),l.push(y.toGeoJSON()))}n.length>1&&this.fire(ol.UNCOMBINE_FEATURES,{createdFeatures:n,deletedFeatures:l}),this.fireActionable()};const Nk=X0(Ns.VERTEX),Bk=X0(Ns.MIDPOINT),vo={};vo.fireUpdate=function(){this.fire(ol.UPDATE,{action:Sy.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};vo.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};vo.startDragging=function(e,n){e.initialDragPanState=this.map.dragPan.isEnabled(),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=n.lngLat};vo.stopDragging=function(e){e.canDragMove&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};vo.onVertex=function(e,n){this.startDragging(e,n);const l=n.featureTarget.properties,u=e.selectedCoordPaths.indexOf(l.coord_path);!o0(n)&&u===-1?e.selectedCoordPaths=[l.coord_path]:o0(n)&&u===-1&&e.selectedCoordPaths.push(l.coord_path);const y=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(y)};vo.onMidpoint=function(e,n){this.startDragging(e,n);const l=n.featureTarget.properties;e.feature.addCoordinate(l.coord_path,l.lng,l.lat),this.fireUpdate(),e.selectedCoordPaths=[l.coord_path]};vo.pathsToCoordinates=function(e,n){return n.map(l=>({feature_id:e,coord_path:l}))};vo.onFeature=function(e,n){e.selectedCoordPaths.length===0?this.startDragging(e,n):this.stopDragging(e)};vo.dragFeature=function(e,n,l){gT(this.getSelected(),l),e.dragMoveLocation=n.lngLat};vo.dragVertex=function(e,n,l){const u=e.selectedCoordPaths.map(I=>e.feature.getCoordinate(I)),y=u.map(I=>({type:Pn.FEATURE,properties:{},geometry:{type:Pn.POINT,coordinates:I}})),b=mT(y,l);for(let I=0;I<u.length;I++){const o=u[I];e.feature.updateCoordinate(e.selectedCoordPaths[I],o[0]+b.lng,o[1]+b.lat)}};vo.clickNoTarget=function(){this.changeMode(Fi.SIMPLE_SELECT)};vo.clickInactive=function(){this.changeMode(Fi.SIMPLE_SELECT)};vo.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};vo.onSetup=function(e){const n=e.featureId,l=this.getFeature(n);if(!l)throw new Error("You must provide a featureId to enter direct_select mode");if(l.type===Pn.POINT)throw new TypeError("direct_select mode doesn't handle point features");const u={featureId:n,feature:l,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(n,u.selectedCoordPaths)),this.setSelected(n),ih.disable(this),this.setActionableState({trash:!0}),u};vo.onStop=function(){ih.enable(this),this.clearSelectedCoordinates()};vo.toDisplayFeatures=function(e,n,l){e.featureId===n.properties.id?(n.properties.active=Wa.ACTIVE,l(n),Q0(n,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(l)):(n.properties.active=Wa.INACTIVE,l(n)),this.fireActionable(e)};vo.onTrash=function(e){e.selectedCoordPaths.sort((n,l)=>l.localeCompare(n,"en",{numeric:!0})).forEach(n=>e.feature.removeCoordinate(n)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(Fi.SIMPLE_SELECT,{}))};vo.onMouseMove=function(e,n){const l=jm(n),u=Nk(n),y=Bk(n),b=e.selectedCoordPaths.length===0;return l&&b?this.updateUIClasses({mouse:Go.MOVE}):u&&!b?this.updateUIClasses({mouse:Go.MOVE}):this.updateUIClasses({mouse:Go.NONE}),(u||l||y)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0};vo.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0};vo.onTouchStart=vo.onMouseDown=function(e,n){if(Nk(n))return this.onVertex(e,n);if(jm(n))return this.onFeature(e,n);if(Bk(n))return this.onMidpoint(e,n)};vo.onDrag=function(e,n){if(e.canDragMove!==!0)return;e.dragMoving=!0,n.originalEvent.stopPropagation();const l={lng:n.lngLat.lng-e.dragMoveLocation.lng,lat:n.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,n,l):this.dragFeature(e,n,l),e.dragMoveLocation=n.lngLat};vo.onClick=function(e,n){if(Y0(n))return this.clickNoTarget(e,n);if(jm(n))return this.clickActiveFeature(e,n);if(dT(n))return this.clickInactive(e,n);this.stopDragging(e)};vo.onTap=function(e,n){if(Y0(n))return this.clickNoTarget(e,n);if(jm(n))return this.clickActiveFeature(e,n);if(dT(n))return this.clickInactive(e,n)};vo.onTouchEnd=vo.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const sd={};sd.onSetup=function(){const e=this.newFeature({type:Pn.FEATURE,properties:{},geometry:{type:Pn.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Go.ADD}),this.activateUIButton(Ul.POINT),this.setActionableState({trash:!0}),{point:e}};sd.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(Fi.SIMPLE_SELECT)};sd.onTap=sd.onClick=function(e,n){this.updateUIClasses({mouse:Go.MOVE}),e.point.updateCoordinate("",n.lngLat.lng,n.lngLat.lat),this.fire(ol.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(Fi.SIMPLE_SELECT,{featureIds:[e.point.id]})};sd.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};sd.toDisplayFeatures=function(e,n,l){const u=n.properties.id===e.point.id;if(n.properties.active=u?Wa.ACTIVE:Wa.INACTIVE,!u)return l(n)};sd.onTrash=sd.stopDrawingAndRemove;sd.onKeyUp=function(e,n){if(K0(n)||J0(n))return this.stopDrawingAndRemove(e,n)};function a0(e,n){return e.lngLat?e.lngLat.lng===n[0]&&e.lngLat.lat===n[1]:!1}const oh={};oh.onSetup=function(){const e=this.newFeature({type:Pn.FEATURE,properties:{},geometry:{type:Pn.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),ih.disable(this),this.updateUIClasses({mouse:Go.ADD}),this.activateUIButton(Ul.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};oh.clickAnywhere=function(e,n){if(e.currentVertexPosition>0&&a0(n,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(Fi.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:Go.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,n.lngLat.lng,n.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,n.lngLat.lng,n.lngLat.lat)};oh.clickOnVertex=function(e){return this.changeMode(Fi.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};oh.onMouseMove=function(e,n){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,n.lngLat.lng,n.lngLat.lat),Ey(n)&&this.updateUIClasses({mouse:Go.POINTER})};oh.onTap=oh.onClick=function(e,n){return Ey(n)?this.clickOnVertex(e,n):this.clickAnywhere(e,n)};oh.onKeyUp=function(e,n){K0(n)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Fi.SIMPLE_SELECT)):J0(n)&&this.changeMode(Fi.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};oh.onStop=function(e){this.updateUIClasses({mouse:Go.NONE}),ih.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(ol.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Fi.SIMPLE_SELECT,{},{silent:!0})))};oh.toDisplayFeatures=function(e,n,l){const u=n.properties.id===e.polygon.id;if(n.properties.active=u?Wa.ACTIVE:Wa.INACTIVE,!u)return l(n);if(n.geometry.coordinates.length===0)return;const y=n.geometry.coordinates[0].length;if(!(y<3)){if(n.properties.meta=Ns.FEATURE,l(Mg(e.polygon.id,n.geometry.coordinates[0][0],"0.0",!1)),y>3){const b=n.geometry.coordinates[0].length-3;l(Mg(e.polygon.id,n.geometry.coordinates[0][b],`0.${b}`,!1))}if(y<=4){const b=[[n.geometry.coordinates[0][0][0],n.geometry.coordinates[0][0][1]],[n.geometry.coordinates[0][1][0],n.geometry.coordinates[0][1][1]]];if(l({type:Pn.FEATURE,properties:n.properties,geometry:{coordinates:b,type:Pn.LINE_STRING}}),y===3)return}return l(n)}};oh.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Fi.SIMPLE_SELECT)};const ah={};ah.onSetup=function(e){e=e||{};const n=e.featureId;let l,u,y="forward";if(n){if(l=this.getFeature(n),!l)throw new Error("Could not find a feature with the provided featureId");let b=e.from;if(b&&b.type==="Feature"&&b.geometry&&b.geometry.type==="Point"&&(b=b.geometry),b&&b.type==="Point"&&b.coordinates&&b.coordinates.length===2&&(b=b.coordinates),!b||!Array.isArray(b))throw new Error("Please use the `from` property to indicate which point to continue the line from");const I=l.coordinates.length-1;if(l.coordinates[I][0]===b[0]&&l.coordinates[I][1]===b[1])u=I+1,l.addCoordinate(u,...l.coordinates[I]);else if(l.coordinates[0][0]===b[0]&&l.coordinates[0][1]===b[1])y="backwards",u=0,l.addCoordinate(u,...l.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else l=this.newFeature({type:Pn.FEATURE,properties:{},geometry:{type:Pn.LINE_STRING,coordinates:[]}}),u=0,this.addFeature(l);return this.clearSelectedFeatures(),ih.disable(this),this.updateUIClasses({mouse:Go.ADD}),this.activateUIButton(Ul.LINE),this.setActionableState({trash:!0}),{line:l,currentVertexPosition:u,direction:y}};ah.clickAnywhere=function(e,n){if(e.currentVertexPosition>0&&a0(n,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&a0(n,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(Fi.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:Go.ADD}),e.line.updateCoordinate(e.currentVertexPosition,n.lngLat.lng,n.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,n.lngLat.lng,n.lngLat.lat)):e.line.addCoordinate(0,n.lngLat.lng,n.lngLat.lat)};ah.clickOnVertex=function(e){return this.changeMode(Fi.SIMPLE_SELECT,{featureIds:[e.line.id]})};ah.onMouseMove=function(e,n){e.line.updateCoordinate(e.currentVertexPosition,n.lngLat.lng,n.lngLat.lat),Ey(n)&&this.updateUIClasses({mouse:Go.POINTER})};ah.onTap=ah.onClick=function(e,n){if(Ey(n))return this.clickOnVertex(e,n);this.clickAnywhere(e,n)};ah.onKeyUp=function(e,n){J0(n)?this.changeMode(Fi.SIMPLE_SELECT,{featureIds:[e.line.id]}):K0(n)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(Fi.SIMPLE_SELECT))};ah.onStop=function(e){ih.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(ol.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(Fi.SIMPLE_SELECT,{},{silent:!0})))};ah.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(Fi.SIMPLE_SELECT)};ah.toDisplayFeatures=function(e,n,l){const u=n.properties.id===e.line.id;if(n.properties.active=u?Wa.ACTIVE:Wa.INACTIVE,!u)return l(n);n.geometry.coordinates.length<2||(n.properties.meta=Ns.FEATURE,l(Mg(e.line.id,n.geometry.coordinates[e.direction==="forward"?n.geometry.coordinates.length-2:1],`${e.direction==="forward"?n.geometry.coordinates.length-2:1}`,!1)),l(n))};const jk={simple_select:yo,direct_select:vo,draw_point:sd,draw_polygon:oh,draw_line_string:ah},T5={defaultMode:Fi.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Lk,modes:jk,controls:{},userProperties:!1,suppressAPIEvents:!0},E5={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},A5={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function rC(e,n){return e.map(l=>l.source?l:Object.assign({},l,{id:`${l.id}.${n}`,source:n==="hot"?cu.HOT:cu.COLD}))}function I5(e={}){let n=Object.assign({},e);return e.controls||(n.controls={}),e.displayControlsDefault===!1?n.controls=Object.assign({},A5,e.controls):n.controls=Object.assign({},E5,e.controls),n=Object.assign({},T5,n),n.styles=rC(n.styles,"cold").concat(rC(n.styles,"hot")),n}var ob,nC;function P5(){return nC||(nC=1,ob=function e(n,l){if(n===l)return!0;if(n&&l&&typeof n=="object"&&typeof l=="object"){if(n.constructor!==l.constructor)return!1;var u,y,b;if(Array.isArray(n)){if(u=n.length,u!=l.length)return!1;for(y=u;y--!==0;)if(!e(n[y],l[y]))return!1;return!0}if(n.constructor===RegExp)return n.source===l.source&&n.flags===l.flags;if(n.valueOf!==Object.prototype.valueOf)return n.valueOf()===l.valueOf();if(n.toString!==Object.prototype.toString)return n.toString()===l.toString();if(b=Object.keys(n),u=b.length,u!==Object.keys(l).length)return!1;for(y=u;y--!==0;)if(!Object.prototype.hasOwnProperty.call(l,b[y]))return!1;for(y=u;y--!==0;){var I=b[y];if(!e(n[I],l[I]))return!1}return!0}return n!==n&&l!==l}),ob}var C5=P5();const iC=Bs(C5);var ab,oC;function M5(){if(oC)return ab;oC=1,ab=n;var e={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function n(l){if(!l||!l.type)return null;var u=e[l.type];if(!u)return null;if(u==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:l}]};if(u==="feature")return{type:"FeatureCollection",features:[l]};if(u==="featurecollection")return l}return ab}var O5=M5();const D5=Bs(O5);function Uk(e,n){return e.length!==n.length?!1:JSON.stringify(e.map(l=>l).sort())===JSON.stringify(n.map(l=>l).sort())}const k5={Polygon:Cc,LineString:hd,Point:Sp,MultiPolygon:il,MultiLineString:il,MultiPoint:il};function R5(e,n){n.modes=Fi;const l=e.options.suppressAPIEvents!==void 0?!!e.options.suppressAPIEvents:!0;return n.getFeatureIdsAt=function(u){return Cg.click({point:u},null,e).map(b=>b.properties.id)},n.getSelectedIds=function(){return e.store.getSelectedIds()},n.getSelected=function(){return{type:Pn.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(u=>e.store.get(u)).map(u=>u.toGeoJSON())}},n.getSelectedPoints=function(){return{type:Pn.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(u=>({type:Pn.FEATURE,properties:{},geometry:{type:Pn.POINT,coordinates:u.coordinates}}))}},n.set=function(u){if(u.type===void 0||u.type!==Pn.FEATURE_COLLECTION||!Array.isArray(u.features))throw new Error("Invalid FeatureCollection");const y=e.store.createRenderBatch();let b=e.store.getAllIds().slice();const I=n.add(u),o=new du(I);return b=b.filter(D=>!o.has(D)),b.length&&n.delete(b),y(),I},n.add=function(u){const b=JSON.parse(JSON.stringify(D5(u))).features.map(I=>{if(I.id=I.id||hT(),I.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(I.id)===void 0||e.store.get(I.id).type!==I.geometry.type){const o=k5[I.geometry.type];if(o===void 0)throw new Error(`Invalid geometry type: ${I.geometry.type}.`);const D=new o(e,I);e.store.add(D,{silent:l})}else{const o=e.store.get(I.id),D=o.properties;o.properties=I.properties,iC(D,I.properties)||e.store.featureChanged(o.id,{silent:l}),iC(o.getCoordinates(),I.geometry.coordinates)||o.incomingCoords(I.geometry.coordinates)}return I.id});return e.store.render(),b},n.get=function(u){const y=e.store.get(u);if(y)return y.toGeoJSON()},n.getAll=function(){return{type:Pn.FEATURE_COLLECTION,features:e.store.getAll().map(u=>u.toGeoJSON())}},n.delete=function(u){return e.store.delete(u,{silent:l}),n.getMode()===Fi.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(Fi.SIMPLE_SELECT,void 0,{silent:l}):e.store.render(),n},n.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:l}),n.getMode()===Fi.DIRECT_SELECT?e.events.changeMode(Fi.SIMPLE_SELECT,void 0,{silent:l}):e.store.render(),n},n.changeMode=function(u,y={}){return u===Fi.SIMPLE_SELECT&&n.getMode()===Fi.SIMPLE_SELECT?(Uk(y.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(y.featureIds,{silent:l}),e.store.render()),n):(u===Fi.DIRECT_SELECT&&n.getMode()===Fi.DIRECT_SELECT&&y.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(u,y,{silent:l}),n)},n.getMode=function(){return e.events.getMode()},n.trash=function(){return e.events.trash({silent:l}),n},n.combineFeatures=function(){return e.events.combineFeatures({silent:l}),n},n.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:l}),n},n.setFeatureProperty=function(u,y,b){return e.store.setFeatureProperty(u,y,b,{silent:l}),n},n}const L5=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:w5,ModeHandler:nS,StringSet:du,constrainFeatureMovement:mT,createMidPoint:Fk,createSupplementaryPoints:Q0,createVertex:Mg,doubleClickZoom:ih,euclideanDistance:uT,featuresAt:Cg,getFeatureAtAndSetCursors:r0,isClick:aS,isEventAtCoordinates:a0,isTap:sS,mapEventToBoundingBox:Ok,moveFeatures:gT,sortFeatures:Mk,stringSetsAreEqual:Uk,theme:Lk,toDenseArray:Ty},Symbol.toStringTag,{value:"Module"})),z5=function(e,n){e=I5(e);const l={options:e};n=R5(l,n),l.api=n;const u=x5(l);return n.onAdd=u.onAdd,n.onRemove=u.onRemove,n.types=Ul,n.options=e,n};function ex(e){z5(e,this)}ex.modes=jk;ex.constants=Ck;ex.lib=L5;_p.accessToken="pk.eyJ1IjoiZmZiLWdpcyIsImEiOiJjbTRwZ2o0aW8wdTdiMmpyMjQxZnhoaW1kIn0.wdZgBjvbzlC5pF2yg8fCpw";function F5(){return new Promise((e,n)=>{if(window.MapboxSearchBox)return e();const l=document.createElement("script");l.src="https://api.mapbox.com/search-js/v1.0.0/web.js",l.async=!0,l.defer=!0,l.onload=()=>e(),l.onerror=()=>n(new Error("Mapbox Search JS failed to load")),document.head.appendChild(l)})}function N5({zoom:e,onMapReady:n,onDrawCreate:l=()=>{},onDrawUpdate:u=()=>{},onDrawDelete:y=()=>{},onMapClick:b=()=>{}}){const I=Ae.useRef(null),o=Ae.useRef(null),D=Ae.useRef(null),k=Ae.useRef(null);return Ae.useEffect(()=>{!o.current&&I.current&&(o.current=new _p.Map({container:I.current,style:"mapbox://styles/mapbox/satellite-streets-v12",center:[78.0734,20.9405],zoom:13}),F5().then(()=>{if(!o.current||!window.MapboxSearchBox)return;const L=new window.MapboxSearchBox;L.accessToken=_p.accessToken,L.options={types:"address,poi",proximity:o.current.getCenter().toArray()},L.marker=!0,L.mapboxgl=_p,k.current&&k.current.appendChild(L.onAdd(o.current))}).catch(L=>{console.error(" Failed to load or add MapboxSearchBox:",L)}),D.current=new ex({displayControlsDefault:!1,controls:{polygon:!0,point:!0,line_string:!0,trash:!0}}),o.current.addControl(D.current,"top-left"),o.current.on("load",()=>{n(o.current,D.current);const L=I.current.querySelector(".mapboxgl-ctrl-top-left");L&&(L.style.top="60px")}),o.current.on("draw.create",L=>l(L)),o.current.on("draw.update",L=>u(L.features)),o.current.on("draw.delete",L=>y(L.features)),o.current.on("click",L=>{const{lng:$,lat:q}=L.lngLat;b({lng:$,lat:q})}))},[n,l,u,y,b]),Me.jsx("div",{ref:I,className:"absolute inset-0 z-0",children:Me.jsx("div",{ref:k,className:"absolute bottom-4 right-4 z-10 bg-white p-2 shadow-md rounded"})})}var sb={},lb={},aC;function B5(){return aC||(aC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){return l==="__proto__"}e.isUnsafeProperty=n}(lb)),lb}var cb={},sC;function Vk(){return sC||(sC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){switch(typeof l){case"number":case"symbol":return!1;case"string":return l.includes(".")||l.includes("[")||l.includes("]")}}e.isDeepKey=n}(cb)),cb}var ub={},lC;function $k(){return lC||(lC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){var u;return typeof l=="string"||typeof l=="symbol"?l:Object.is((u=l==null?void 0:l.valueOf)==null?void 0:u.call(l),-0)?"-0":String(l)}e.toKey=n}(ub)),ub}var hb={},cC;function _T(){return cC||(cC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){const u=[],y=l.length;if(y===0)return u;let b=0,I="",o="",D=!1;for(l.charCodeAt(0)===46&&(u.push(""),b++);b<y;){const k=l[b];o?k==="\\"&&b+1<y?(b++,I+=l[b]):k===o?o="":I+=k:D?k==='"'||k==="'"?o=k:k==="]"?(D=!1,u.push(I),I=""):I+=k:k==="["?(D=!0,I&&(u.push(I),I="")):k==="."?I&&(u.push(I),I=""):I+=k,b++}return I&&u.push(I),u}e.toPath=n}(hb)),hb}var uC;function yT(){return uC||(uC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=B5(),l=Vk(),u=$k(),y=_T();function b(o,D,k){if(o==null)return k;switch(typeof D){case"string":{if(n.isUnsafeProperty(D))return k;const L=o[D];return L===void 0?l.isDeepKey(D)?b(o,y.toPath(D),k):k:L}case"number":case"symbol":{typeof D=="number"&&(D=u.toKey(D));const L=o[D];return L===void 0?k:L}default:{if(Array.isArray(D))return I(o,D,k);if(Object.is(D==null?void 0:D.valueOf(),-0)?D="-0":D=String(D),n.isUnsafeProperty(D))return k;const L=o[D];return L===void 0?k:L}}}function I(o,D,k){if(D.length===0)return k;let L=o;for(let $=0;$<D.length;$++){if(L==null||n.isUnsafeProperty(D[$]))return k;L=L[D[$]]}return L===void 0?k:L}e.get=b}(sb)),sb}var db,hC;function j5(){return hC||(hC=1,db=yT().get),db}var U5=j5();const Rm=Bs(U5);var fb={exports:{}},io={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dC;function V5(){if(dC)return io;dC=1;var e=typeof Symbol=="function"&&Symbol.for,n=e?Symbol.for("react.element"):60103,l=e?Symbol.for("react.portal"):60106,u=e?Symbol.for("react.fragment"):60107,y=e?Symbol.for("react.strict_mode"):60108,b=e?Symbol.for("react.profiler"):60114,I=e?Symbol.for("react.provider"):60109,o=e?Symbol.for("react.context"):60110,D=e?Symbol.for("react.async_mode"):60111,k=e?Symbol.for("react.concurrent_mode"):60111,L=e?Symbol.for("react.forward_ref"):60112,$=e?Symbol.for("react.suspense"):60113,q=e?Symbol.for("react.suspense_list"):60120,Z=e?Symbol.for("react.memo"):60115,ie=e?Symbol.for("react.lazy"):60116,oe=e?Symbol.for("react.block"):60121,le=e?Symbol.for("react.fundamental"):60117,xe=e?Symbol.for("react.responder"):60118,ge=e?Symbol.for("react.scope"):60119;function ke(ze){if(typeof ze=="object"&&ze!==null){var nt=ze.$$typeof;switch(nt){case n:switch(ze=ze.type,ze){case D:case k:case u:case b:case y:case $:return ze;default:switch(ze=ze&&ze.$$typeof,ze){case o:case L:case ie:case Z:case I:return ze;default:return nt}}case l:return nt}}}function et(ze){return ke(ze)===k}return io.AsyncMode=D,io.ConcurrentMode=k,io.ContextConsumer=o,io.ContextProvider=I,io.Element=n,io.ForwardRef=L,io.Fragment=u,io.Lazy=ie,io.Memo=Z,io.Portal=l,io.Profiler=b,io.StrictMode=y,io.Suspense=$,io.isAsyncMode=function(ze){return et(ze)||ke(ze)===D},io.isConcurrentMode=et,io.isContextConsumer=function(ze){return ke(ze)===o},io.isContextProvider=function(ze){return ke(ze)===I},io.isElement=function(ze){return typeof ze=="object"&&ze!==null&&ze.$$typeof===n},io.isForwardRef=function(ze){return ke(ze)===L},io.isFragment=function(ze){return ke(ze)===u},io.isLazy=function(ze){return ke(ze)===ie},io.isMemo=function(ze){return ke(ze)===Z},io.isPortal=function(ze){return ke(ze)===l},io.isProfiler=function(ze){return ke(ze)===b},io.isStrictMode=function(ze){return ke(ze)===y},io.isSuspense=function(ze){return ke(ze)===$},io.isValidElementType=function(ze){return typeof ze=="string"||typeof ze=="function"||ze===u||ze===k||ze===b||ze===y||ze===$||ze===q||typeof ze=="object"&&ze!==null&&(ze.$$typeof===ie||ze.$$typeof===Z||ze.$$typeof===I||ze.$$typeof===o||ze.$$typeof===L||ze.$$typeof===le||ze.$$typeof===xe||ze.$$typeof===ge||ze.$$typeof===oe)},io.typeOf=ke,io}var fC;function $5(){return fC||(fC=1,fb.exports=V5()),fb.exports}var G5=$5(),$l=e=>e===0?0:e>0?1:-1,Ec=e=>typeof e=="number"&&e!=+e,Sm=e=>typeof e=="string"&&e.indexOf("%")===e.length-1,mn=e=>(typeof e=="number"||e instanceof Number)&&!Ec(e),ld=e=>mn(e)||typeof e=="string",q5=0,sy=e=>{var n=++q5;return"".concat(e||"").concat(n)},sh=function(n,l){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!mn(n)&&typeof n!="string")return u;var b;if(Sm(n)){if(l==null)return u;var I=n.indexOf("%");b=l*parseFloat(n.slice(0,I))/100}else b=+n;return Ec(b)&&(b=u),y&&l!=null&&b>l&&(b=l),b},Gk=e=>{if(!Array.isArray(e))return!1;for(var n=e.length,l={},u=0;u<n;u++)if(!l[e[u]])l[e[u]]=!0;else return!0;return!1},xg=(e,n)=>mn(e)&&mn(n)?l=>e+l*(n-e):()=>n;function W5(e,n,l){if(!(!e||!e.length))return e.find(u=>u&&(typeof n=="function"?n(u):Rm(u,n))===l)}var Aa=e=>e===null||typeof e>"u",Ay=e=>Aa(e)?e:"".concat(e.charAt(0).toUpperCase()).concat(e.slice(1)),H5=["viewBox","children"],Z5=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],pC=["points","pathLength"],pb={svg:H5,polygon:pC,polyline:pC},vT=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],X5=(e,n)=>{if(!e||typeof e=="function"||typeof e=="boolean")return null;var l=e;if(Ae.isValidElement(e)&&(l=e.props),typeof l!="object"&&typeof l!="function")return null;var u={};return Object.keys(l).forEach(y=>{vT.includes(y)&&(u[y]=b=>l[y](l,b))}),u},Y5=(e,n,l)=>u=>(e(n,l,u),null),xT=(e,n,l)=>{if(e===null||typeof e!="object"&&typeof e!="function")return null;var u=null;return Object.keys(e).forEach(y=>{var b=e[y];vT.includes(y)&&typeof b=="function"&&(u||(u={}),u[y]=Y5(b,n,l))}),u},mC=e=>typeof e=="string"?e:e?e.displayName||e.name||"Component":"",gC=null,mb=null,qk=e=>{if(e===gC&&Array.isArray(mb))return mb;var n=[];return Ae.Children.forEach(e,l=>{Aa(l)||(G5.isFragment(l)?n=n.concat(qk(l.props.children)):n.push(l))}),mb=n,gC=e,n};function bT(e,n){var l=[],u=[];return Array.isArray(n)?u=n.map(y=>mC(y)):u=[mC(n)],qk(e).forEach(y=>{var b=Rm(y,"type.displayName")||Rm(y,"type.name");u.indexOf(b)!==-1&&l.push(y)}),l}var K5=(e,n,l,u)=>{var y,b=(y=u&&(pb==null?void 0:pb[u]))!==null&&y!==void 0?y:[];return n.startsWith("data-")||typeof e!="function"&&(u&&b.includes(n)||Z5.includes(n))||l&&vT.includes(n)},$o=(e,n,l)=>{if(!e||typeof e=="function"||typeof e=="boolean")return null;var u=e;if(Ae.isValidElement(e)&&(u=e.props),typeof u!="object"&&typeof u!="function")return null;var y={};return Object.keys(u).forEach(b=>{var I;K5((I=u)===null||I===void 0?void 0:I[b],b,n,l)&&(y[b]=u[b])}),y},J5=["children","width","height","viewBox","className","style","title","desc"];function lS(){return lS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},lS.apply(null,arguments)}function Q5(e,n){if(e==null)return{};var l,u,y=eU(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function eU(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}var Wk=Ae.forwardRef((e,n)=>{var{children:l,width:u,height:y,viewBox:b,className:I,style:o,title:D,desc:k}=e,L=Q5(e,J5),$=b||{width:u,height:y,x:0,y:0},q=co("recharts-surface",I);return Ae.createElement("svg",lS({},$o(L,!0,"svg"),{className:q,width:u,height:y,style:o,viewBox:"".concat($.x," ").concat($.y," ").concat($.width," ").concat($.height),ref:n}),Ae.createElement("title",null,D),Ae.createElement("desc",null,k),l)}),tU=["children","className"];function cS(){return cS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},cS.apply(null,arguments)}function rU(e,n){if(e==null)return{};var l,u,y=nU(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function nU(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}var cd=Ae.forwardRef((e,n)=>{var{children:l,className:u}=e,y=rU(e,tU),b=co("recharts-layer",u);return Ae.createElement("g",cS({className:b},$o(y,!0),{ref:n}),l)}),iU=ek(),oU=Ae.createContext(null);function Io(e){return function(){return e}}const Hk=Math.cos,s0=Math.sin,lh=Math.sqrt,l0=Math.PI,tx=2*l0,uS=Math.PI,hS=2*uS,xm=1e-6,aU=hS-xm;function Zk(e){this._+=e[0];for(let n=1,l=e.length;n<l;++n)this._+=arguments[n]+e[n]}function sU(e){let n=Math.floor(e);if(!(n>=0))throw new Error(`invalid digits: ${e}`);if(n>15)return Zk;const l=10**n;return function(u){this._+=u[0];for(let y=1,b=u.length;y<b;++y)this._+=Math.round(arguments[y]*l)/l+u[y]}}class lU{constructor(n){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=n==null?Zk:sU(n)}moveTo(n,l){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+l}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(n,l){this._append`L${this._x1=+n},${this._y1=+l}`}quadraticCurveTo(n,l,u,y){this._append`Q${+n},${+l},${this._x1=+u},${this._y1=+y}`}bezierCurveTo(n,l,u,y,b,I){this._append`C${+n},${+l},${+u},${+y},${this._x1=+b},${this._y1=+I}`}arcTo(n,l,u,y,b){if(n=+n,l=+l,u=+u,y=+y,b=+b,b<0)throw new Error(`negative radius: ${b}`);let I=this._x1,o=this._y1,D=u-n,k=y-l,L=I-n,$=o-l,q=L*L+$*$;if(this._x1===null)this._append`M${this._x1=n},${this._y1=l}`;else if(q>xm)if(!(Math.abs($*D-k*L)>xm)||!b)this._append`L${this._x1=n},${this._y1=l}`;else{let Z=u-I,ie=y-o,oe=D*D+k*k,le=Z*Z+ie*ie,xe=Math.sqrt(oe),ge=Math.sqrt(q),ke=b*Math.tan((uS-Math.acos((oe+q-le)/(2*xe*ge)))/2),et=ke/ge,ze=ke/xe;Math.abs(et-1)>xm&&this._append`L${n+et*L},${l+et*$}`,this._append`A${b},${b},0,0,${+($*Z>L*ie)},${this._x1=n+ze*D},${this._y1=l+ze*k}`}}arc(n,l,u,y,b,I){if(n=+n,l=+l,u=+u,I=!!I,u<0)throw new Error(`negative radius: ${u}`);let o=u*Math.cos(y),D=u*Math.sin(y),k=n+o,L=l+D,$=1^I,q=I?y-b:b-y;this._x1===null?this._append`M${k},${L}`:(Math.abs(this._x1-k)>xm||Math.abs(this._y1-L)>xm)&&this._append`L${k},${L}`,u&&(q<0&&(q=q%hS+hS),q>aU?this._append`A${u},${u},0,1,${$},${n-o},${l-D}A${u},${u},0,1,${$},${this._x1=k},${this._y1=L}`:q>xm&&this._append`A${u},${u},0,${+(q>=uS)},${$},${this._x1=n+u*Math.cos(b)},${this._y1=l+u*Math.sin(b)}`)}rect(n,l,u,y){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+l}h${u=+u}v${+y}h${-u}Z`}toString(){return this._}}function wT(e){let n=3;return e.digits=function(l){if(!arguments.length)return n;if(l==null)n=null;else{const u=Math.floor(l);if(!(u>=0))throw new RangeError(`invalid digits: ${l}`);n=u}return e},()=>new lU(n)}function ST(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Xk(e){this._context=e}Xk.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;default:this._context.lineTo(e,n);break}}};function rx(e){return new Xk(e)}function Yk(e){return e[0]}function Kk(e){return e[1]}function Jk(e,n){var l=Io(!0),u=null,y=rx,b=null,I=wT(o);e=typeof e=="function"?e:e===void 0?Yk:Io(e),n=typeof n=="function"?n:n===void 0?Kk:Io(n);function o(D){var k,L=(D=ST(D)).length,$,q=!1,Z;for(u==null&&(b=y(Z=I())),k=0;k<=L;++k)!(k<L&&l($=D[k],k,D))===q&&((q=!q)?b.lineStart():b.lineEnd()),q&&b.point(+e($,k,D),+n($,k,D));if(Z)return b=null,Z+""||null}return o.x=function(D){return arguments.length?(e=typeof D=="function"?D:Io(+D),o):e},o.y=function(D){return arguments.length?(n=typeof D=="function"?D:Io(+D),o):n},o.defined=function(D){return arguments.length?(l=typeof D=="function"?D:Io(!!D),o):l},o.curve=function(D){return arguments.length?(y=D,u!=null&&(b=y(u)),o):y},o.context=function(D){return arguments.length?(D==null?u=b=null:b=y(u=D),o):u},o}function jv(e,n,l){var u=null,y=Io(!0),b=null,I=rx,o=null,D=wT(k);e=typeof e=="function"?e:e===void 0?Yk:Io(+e),n=typeof n=="function"?n:Io(n===void 0?0:+n),l=typeof l=="function"?l:l===void 0?Kk:Io(+l);function k($){var q,Z,ie,oe=($=ST($)).length,le,xe=!1,ge,ke=new Array(oe),et=new Array(oe);for(b==null&&(o=I(ge=D())),q=0;q<=oe;++q){if(!(q<oe&&y(le=$[q],q,$))===xe)if(xe=!xe)Z=q,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),ie=q-1;ie>=Z;--ie)o.point(ke[ie],et[ie]);o.lineEnd(),o.areaEnd()}xe&&(ke[q]=+e(le,q,$),et[q]=+n(le,q,$),o.point(u?+u(le,q,$):ke[q],l?+l(le,q,$):et[q]))}if(ge)return o=null,ge+""||null}function L(){return Jk().defined(y).curve(I).context(b)}return k.x=function($){return arguments.length?(e=typeof $=="function"?$:Io(+$),u=null,k):e},k.x0=function($){return arguments.length?(e=typeof $=="function"?$:Io(+$),k):e},k.x1=function($){return arguments.length?(u=$==null?null:typeof $=="function"?$:Io(+$),k):u},k.y=function($){return arguments.length?(n=typeof $=="function"?$:Io(+$),l=null,k):n},k.y0=function($){return arguments.length?(n=typeof $=="function"?$:Io(+$),k):n},k.y1=function($){return arguments.length?(l=$==null?null:typeof $=="function"?$:Io(+$),k):l},k.lineX0=k.lineY0=function(){return L().x(e).y(n)},k.lineY1=function(){return L().x(e).y(l)},k.lineX1=function(){return L().x(u).y(n)},k.defined=function($){return arguments.length?(y=typeof $=="function"?$:Io(!!$),k):y},k.curve=function($){return arguments.length?(I=$,b!=null&&(o=I(b)),k):I},k.context=function($){return arguments.length?($==null?b=o=null:o=I(b=$),k):b},k}class Qk{constructor(n,l){this._context=n,this._x=l}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(n,l){switch(n=+n,l=+l,this._point){case 0:{this._point=1,this._line?this._context.lineTo(n,l):this._context.moveTo(n,l);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+n)/2,this._y0,this._x0,l,n,l):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+l)/2,n,this._y0,n,l);break}}this._x0=n,this._y0=l}}function cU(e){return new Qk(e,!0)}function uU(e){return new Qk(e,!1)}const TT={draw(e,n){const l=lh(n/l0);e.moveTo(l,0),e.arc(0,0,l,0,tx)}},hU={draw(e,n){const l=lh(n/5)/2;e.moveTo(-3*l,-l),e.lineTo(-l,-l),e.lineTo(-l,-3*l),e.lineTo(l,-3*l),e.lineTo(l,-l),e.lineTo(3*l,-l),e.lineTo(3*l,l),e.lineTo(l,l),e.lineTo(l,3*l),e.lineTo(-l,3*l),e.lineTo(-l,l),e.lineTo(-3*l,l),e.closePath()}},eR=lh(1/3),dU=eR*2,fU={draw(e,n){const l=lh(n/dU),u=l*eR;e.moveTo(0,-l),e.lineTo(u,0),e.lineTo(0,l),e.lineTo(-u,0),e.closePath()}},pU={draw(e,n){const l=lh(n),u=-l/2;e.rect(u,u,l,l)}},mU=.8908130915292852,tR=s0(l0/10)/s0(7*l0/10),gU=s0(tx/10)*tR,_U=-Hk(tx/10)*tR,yU={draw(e,n){const l=lh(n*mU),u=gU*l,y=_U*l;e.moveTo(0,-l),e.lineTo(u,y);for(let b=1;b<5;++b){const I=tx*b/5,o=Hk(I),D=s0(I);e.lineTo(D*l,-o*l),e.lineTo(o*u-D*y,D*u+o*y)}e.closePath()}},gb=lh(3),vU={draw(e,n){const l=-lh(n/(gb*3));e.moveTo(0,l*2),e.lineTo(-gb*l,-l),e.lineTo(gb*l,-l),e.closePath()}},au=-.5,su=lh(3)/2,dS=1/lh(12),xU=(dS/2+1)*3,bU={draw(e,n){const l=lh(n/xU),u=l/2,y=l*dS,b=u,I=l*dS+l,o=-b,D=I;e.moveTo(u,y),e.lineTo(b,I),e.lineTo(o,D),e.lineTo(au*u-su*y,su*u+au*y),e.lineTo(au*b-su*I,su*b+au*I),e.lineTo(au*o-su*D,su*o+au*D),e.lineTo(au*u+su*y,au*y-su*u),e.lineTo(au*b+su*I,au*I-su*b),e.lineTo(au*o+su*D,au*D-su*o),e.closePath()}};function wU(e,n){let l=null,u=wT(y);e=typeof e=="function"?e:Io(e||TT),n=typeof n=="function"?n:Io(n===void 0?64:+n);function y(){let b;if(l||(l=b=u()),e.apply(this,arguments).draw(l,+n.apply(this,arguments)),b)return l=null,b+""||null}return y.type=function(b){return arguments.length?(e=typeof b=="function"?b:Io(b),y):e},y.size=function(b){return arguments.length?(n=typeof b=="function"?b:Io(+b),y):n},y.context=function(b){return arguments.length?(l=b??null,y):l},y}function c0(){}function u0(e,n,l){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+n)/6,(e._y0+4*e._y1+l)/6)}function rR(e){this._context=e}rR.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:u0(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:u0(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function SU(e){return new rR(e)}function nR(e){this._context=e}nR.prototype={areaStart:c0,areaEnd:c0,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._x2=e,this._y2=n;break;case 1:this._point=2,this._x3=e,this._y3=n;break;case 2:this._point=3,this._x4=e,this._y4=n,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+n)/6);break;default:u0(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function TU(e){return new nR(e)}function iR(e){this._context=e}iR.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var l=(this._x0+4*this._x1+e)/6,u=(this._y0+4*this._y1+n)/6;this._line?this._context.lineTo(l,u):this._context.moveTo(l,u);break;case 3:this._point=4;default:u0(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function EU(e){return new iR(e)}function oR(e){this._context=e}oR.prototype={areaStart:c0,areaEnd:c0,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,n){e=+e,n=+n,this._point?this._context.lineTo(e,n):(this._point=1,this._context.moveTo(e,n))}};function AU(e){return new oR(e)}function _C(e){return e<0?-1:1}function yC(e,n,l){var u=e._x1-e._x0,y=n-e._x1,b=(e._y1-e._y0)/(u||y<0&&-0),I=(l-e._y1)/(y||u<0&&-0),o=(b*y+I*u)/(u+y);return(_C(b)+_C(I))*Math.min(Math.abs(b),Math.abs(I),.5*Math.abs(o))||0}function vC(e,n){var l=e._x1-e._x0;return l?(3*(e._y1-e._y0)/l-n)/2:n}function _b(e,n,l){var u=e._x0,y=e._y0,b=e._x1,I=e._y1,o=(b-u)/3;e._context.bezierCurveTo(u+o,y+o*n,b-o,I-o*l,b,I)}function h0(e){this._context=e}h0.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:_b(this,this._t0,vC(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){var l=NaN;if(e=+e,n=+n,!(e===this._x1&&n===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;break;case 2:this._point=3,_b(this,vC(this,l=yC(this,e,n)),l);break;default:_b(this,this._t0,l=yC(this,e,n));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n,this._t0=l}}};function aR(e){this._context=new sR(e)}(aR.prototype=Object.create(h0.prototype)).point=function(e,n){h0.prototype.point.call(this,n,e)};function sR(e){this._context=e}sR.prototype={moveTo:function(e,n){this._context.moveTo(n,e)},closePath:function(){this._context.closePath()},lineTo:function(e,n){this._context.lineTo(n,e)},bezierCurveTo:function(e,n,l,u,y,b){this._context.bezierCurveTo(n,e,u,l,b,y)}};function IU(e){return new h0(e)}function PU(e){return new aR(e)}function lR(e){this._context=e}lR.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,n=this._y,l=e.length;if(l)if(this._line?this._context.lineTo(e[0],n[0]):this._context.moveTo(e[0],n[0]),l===2)this._context.lineTo(e[1],n[1]);else for(var u=xC(e),y=xC(n),b=0,I=1;I<l;++b,++I)this._context.bezierCurveTo(u[0][b],y[0][b],u[1][b],y[1][b],e[I],n[I]);(this._line||this._line!==0&&l===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,n){this._x.push(+e),this._y.push(+n)}};function xC(e){var n,l=e.length-1,u,y=new Array(l),b=new Array(l),I=new Array(l);for(y[0]=0,b[0]=2,I[0]=e[0]+2*e[1],n=1;n<l-1;++n)y[n]=1,b[n]=4,I[n]=4*e[n]+2*e[n+1];for(y[l-1]=2,b[l-1]=7,I[l-1]=8*e[l-1]+e[l],n=1;n<l;++n)u=y[n]/b[n-1],b[n]-=u,I[n]-=u*I[n-1];for(y[l-1]=I[l-1]/b[l-1],n=l-2;n>=0;--n)y[n]=(I[n]-y[n+1])/b[n];for(b[l-1]=(e[l]+y[l-1])/2,n=0;n<l-1;++n)b[n]=2*e[n+1]-y[n+1];return[y,b]}function CU(e){return new lR(e)}function nx(e,n){this._context=e,this._t=n}nx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,n),this._context.lineTo(e,n);else{var l=this._x*(1-this._t)+e*this._t;this._context.lineTo(l,this._y),this._context.lineTo(l,n)}break}}this._x=e,this._y=n}};function MU(e){return new nx(e,.5)}function OU(e){return new nx(e,0)}function DU(e){return new nx(e,1)}function Og(e,n){if((I=e.length)>1)for(var l=1,u,y,b=e[n[0]],I,o=b.length;l<I;++l)for(y=b,b=e[n[l]],u=0;u<o;++u)b[u][1]+=b[u][0]=isNaN(y[u][1])?y[u][0]:y[u][1]}function fS(e){for(var n=e.length,l=new Array(n);--n>=0;)l[n]=n;return l}function kU(e,n){return e[n]}function RU(e){const n=[];return n.key=e,n}function LU(){var e=Io([]),n=fS,l=Og,u=kU;function y(b){var I=Array.from(e.apply(this,arguments),RU),o,D=I.length,k=-1,L;for(const $ of b)for(o=0,++k;o<D;++o)(I[o][k]=[0,+u($,I[o].key,k,b)]).data=$;for(o=0,L=ST(n(I));o<D;++o)I[L[o]].index=o;return l(I,L),I}return y.keys=function(b){return arguments.length?(e=typeof b=="function"?b:Io(Array.from(b)),y):e},y.value=function(b){return arguments.length?(u=typeof b=="function"?b:Io(+b),y):u},y.order=function(b){return arguments.length?(n=b==null?fS:typeof b=="function"?b:Io(Array.from(b)),y):n},y.offset=function(b){return arguments.length?(l=b??Og,y):l},y}function zU(e,n){if((u=e.length)>0){for(var l,u,y=0,b=e[0].length,I;y<b;++y){for(I=l=0;l<u;++l)I+=e[l][y][1]||0;if(I)for(l=0;l<u;++l)e[l][y][1]/=I}Og(e,n)}}function FU(e,n){if((y=e.length)>0){for(var l=0,u=e[n[0]],y,b=u.length;l<b;++l){for(var I=0,o=0;I<y;++I)o+=e[I][l][1]||0;u[l][1]+=u[l][0]=-o/2}Og(e,n)}}function NU(e,n){if(!(!((I=e.length)>0)||!((b=(y=e[n[0]]).length)>0))){for(var l=0,u=1,y,b,I;u<b;++u){for(var o=0,D=0,k=0;o<I;++o){for(var L=e[n[o]],$=L[u][1]||0,q=L[u-1][1]||0,Z=($-q)/2,ie=0;ie<o;++ie){var oe=e[n[ie]],le=oe[u][1]||0,xe=oe[u-1][1]||0;Z+=le-xe}D+=$,k+=Z*$}y[u-1][1]+=y[u-1][0]=l,D&&(l-=k/D)}y[u-1][1]+=y[u-1][0]=l,Og(e,n)}}var BU=["type","size","sizeType"];function pS(){return pS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},pS.apply(null,arguments)}function bC(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function wC(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?bC(Object(l),!0).forEach(function(u){jU(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):bC(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function jU(e,n,l){return(n=UU(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function UU(e){var n=VU(e,"string");return typeof n=="symbol"?n:n+""}function VU(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function $U(e,n){if(e==null)return{};var l,u,y=GU(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function GU(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}var cR={symbolCircle:TT,symbolCross:hU,symbolDiamond:fU,symbolSquare:pU,symbolStar:yU,symbolTriangle:vU,symbolWye:bU},qU=Math.PI/180,WU=e=>{var n="symbol".concat(Ay(e));return cR[n]||TT},HU=(e,n,l)=>{if(n==="area")return e;switch(l){case"cross":return 5*e*e/9;case"diamond":return .5*e*e/Math.sqrt(3);case"square":return e*e;case"star":{var u=18*qU;return 1.25*e*e*(Math.tan(u)-Math.tan(u*2)*Math.tan(u)**2)}case"triangle":return Math.sqrt(3)*e*e/4;case"wye":return(21-10*Math.sqrt(3))*e*e/8;default:return Math.PI*e*e/4}},ZU=(e,n)=>{cR["symbol".concat(Ay(e))]=n},uR=e=>{var{type:n="circle",size:l=64,sizeType:u="area"}=e,y=$U(e,BU),b=wC(wC({},y),{},{type:n,size:l,sizeType:u}),I=()=>{var $=WU(n),q=wU().type($).size(HU(l,u,n));return q()},{className:o,cx:D,cy:k}=b,L=$o(b,!0);return D===+D&&k===+k&&l===+l?Ae.createElement("path",pS({},L,{className:co("recharts-symbols",o),transform:"translate(".concat(D,", ").concat(k,")"),d:I()})):null};uR.registerSymbol=ZU;var yb={},vb={},SC;function XU(){return SC||(SC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l,u){const y=new Map;for(let b=0;b<l.length;b++){const I=l[b],o=u(I);y.has(o)||y.set(o,I)}return Array.from(y.values())}e.uniqBy=n}(vb)),vb}var xb={},TC;function hR(){return TC||(TC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){return l}e.identity=n}(xb)),xb}var bb={},wb={},Sb={},EC;function YU(){return EC||(EC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){return Number.isSafeInteger(l)&&l>=0}e.isLength=n}(Sb)),Sb}var AC;function ET(){return AC||(AC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=YU();function l(u){return u!=null&&typeof u!="function"&&n.isLength(u.length)}e.isArrayLike=l}(wb)),wb}var Tb={},IC;function KU(){return IC||(IC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){return typeof l=="object"&&l!==null}e.isObjectLike=n}(Tb)),Tb}var PC;function JU(){return PC||(PC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=ET(),l=KU();function u(y){return l.isObjectLike(y)&&n.isArrayLike(y)}e.isArrayLikeObject=u}(bb)),bb}var Eb={},Ab={},CC;function QU(){return CC||(CC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=yT();function l(u){return function(y){return n.get(y,u)}}e.property=l}(Ab)),Ab}var Ib={},Pb={},Cb={},Mb={},MC;function dR(){return MC||(MC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){return l!==null&&(typeof l=="object"||typeof l=="function")}e.isObject=n}(Mb)),Mb}var Ob={},OC;function fR(){return OC||(OC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){return l==null||typeof l!="object"&&typeof l!="function"}e.isPrimitive=n}(Ob)),Ob}var Db={},DC;function AT(){return DC||(DC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l,u){return l===u||Number.isNaN(l)&&Number.isNaN(u)}e.eq=n}(Db)),Db}var kC;function eV(){return kC||(kC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=IT(),l=dR(),u=fR(),y=AT();function b($,q,Z){return typeof Z!="function"?n.isMatch($,q):I($,q,function ie(oe,le,xe,ge,ke,et){const ze=Z(oe,le,xe,ge,ke,et);return ze!==void 0?!!ze:I(oe,le,ie,et)},new Map)}function I($,q,Z,ie){if(q===$)return!0;switch(typeof q){case"object":return o($,q,Z,ie);case"function":return Object.keys(q).length>0?I($,{...q},Z,ie):y.eq($,q);default:return l.isObject($)?typeof q=="string"?q==="":!0:y.eq($,q)}}function o($,q,Z,ie){if(q==null)return!0;if(Array.isArray(q))return k($,q,Z,ie);if(q instanceof Map)return D($,q,Z,ie);if(q instanceof Set)return L($,q,Z,ie);const oe=Object.keys(q);if($==null)return oe.length===0;if(oe.length===0)return!0;if(ie&&ie.has(q))return ie.get(q)===$;ie&&ie.set(q,$);try{for(let le=0;le<oe.length;le++){const xe=oe[le];if(!u.isPrimitive($)&&!(xe in $)||q[xe]===void 0&&$[xe]!==void 0||q[xe]===null&&$[xe]!==null||!Z($[xe],q[xe],xe,$,q,ie))return!1}return!0}finally{ie&&ie.delete(q)}}function D($,q,Z,ie){if(q.size===0)return!0;if(!($ instanceof Map))return!1;for(const[oe,le]of q.entries()){const xe=$.get(oe);if(Z(xe,le,oe,$,q,ie)===!1)return!1}return!0}function k($,q,Z,ie){if(q.length===0)return!0;if(!Array.isArray($))return!1;const oe=new Set;for(let le=0;le<q.length;le++){const xe=q[le];let ge=!1;for(let ke=0;ke<$.length;ke++){if(oe.has(ke))continue;const et=$[ke];let ze=!1;if(Z(et,xe,le,$,q,ie)&&(ze=!0),ze){oe.add(ke),ge=!0;break}}if(!ge)return!1}return!0}function L($,q,Z,ie){return q.size===0?!0:$ instanceof Set?k([...$],[...q],Z,ie):!1}e.isMatchWith=b,e.isSetMatch=L}(Cb)),Cb}var RC;function IT(){return RC||(RC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=eV();function l(u,y){return n.isMatchWith(u,y,()=>{})}e.isMatch=l}(Pb)),Pb}var kb={},Rb={},Lb={},LC;function pR(){return LC||(LC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){return Object.getOwnPropertySymbols(l).filter(u=>Object.prototype.propertyIsEnumerable.call(l,u))}e.getSymbols=n}(Lb)),Lb}var zb={},zC;function PT(){return zC||(zC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){return l==null?l===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(l)}e.getTag=n}(zb)),zb}var Fb={},FC;function CT(){return FC||(FC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n="[object RegExp]",l="[object String]",u="[object Number]",y="[object Boolean]",b="[object Arguments]",I="[object Symbol]",o="[object Date]",D="[object Map]",k="[object Set]",L="[object Array]",$="[object Function]",q="[object ArrayBuffer]",Z="[object Object]",ie="[object Error]",oe="[object DataView]",le="[object Uint8Array]",xe="[object Uint8ClampedArray]",ge="[object Uint16Array]",ke="[object Uint32Array]",et="[object BigUint64Array]",ze="[object Int8Array]",nt="[object Int16Array]",pt="[object Int32Array]",Gt="[object BigInt64Array]",ir="[object Float32Array]",Br="[object Float64Array]";e.argumentsTag=b,e.arrayBufferTag=q,e.arrayTag=L,e.bigInt64ArrayTag=Gt,e.bigUint64ArrayTag=et,e.booleanTag=y,e.dataViewTag=oe,e.dateTag=o,e.errorTag=ie,e.float32ArrayTag=ir,e.float64ArrayTag=Br,e.functionTag=$,e.int16ArrayTag=nt,e.int32ArrayTag=pt,e.int8ArrayTag=ze,e.mapTag=D,e.numberTag=u,e.objectTag=Z,e.regexpTag=n,e.setTag=k,e.stringTag=l,e.symbolTag=I,e.uint16ArrayTag=ge,e.uint32ArrayTag=ke,e.uint8ArrayTag=le,e.uint8ClampedArrayTag=xe}(Fb)),Fb}var Nb={},NC;function tV(){return NC||(NC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){return ArrayBuffer.isView(l)&&!(l instanceof DataView)}e.isTypedArray=n}(Nb)),Nb}var BC;function mR(){return BC||(BC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=pR(),l=PT(),u=CT(),y=fR(),b=tV();function I(L,$){return o(L,void 0,L,new Map,$)}function o(L,$,q,Z=new Map,ie=void 0){const oe=ie==null?void 0:ie(L,$,q,Z);if(oe!=null)return oe;if(y.isPrimitive(L))return L;if(Z.has(L))return Z.get(L);if(Array.isArray(L)){const le=new Array(L.length);Z.set(L,le);for(let xe=0;xe<L.length;xe++)le[xe]=o(L[xe],xe,q,Z,ie);return Object.hasOwn(L,"index")&&(le.index=L.index),Object.hasOwn(L,"input")&&(le.input=L.input),le}if(L instanceof Date)return new Date(L.getTime());if(L instanceof RegExp){const le=new RegExp(L.source,L.flags);return le.lastIndex=L.lastIndex,le}if(L instanceof Map){const le=new Map;Z.set(L,le);for(const[xe,ge]of L)le.set(xe,o(ge,xe,q,Z,ie));return le}if(L instanceof Set){const le=new Set;Z.set(L,le);for(const xe of L)le.add(o(xe,void 0,q,Z,ie));return le}if(typeof Buffer<"u"&&Buffer.isBuffer(L))return L.subarray();if(b.isTypedArray(L)){const le=new(Object.getPrototypeOf(L)).constructor(L.length);Z.set(L,le);for(let xe=0;xe<L.length;xe++)le[xe]=o(L[xe],xe,q,Z,ie);return le}if(L instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&L instanceof SharedArrayBuffer)return L.slice(0);if(L instanceof DataView){const le=new DataView(L.buffer.slice(0),L.byteOffset,L.byteLength);return Z.set(L,le),D(le,L,q,Z,ie),le}if(typeof File<"u"&&L instanceof File){const le=new File([L],L.name,{type:L.type});return Z.set(L,le),D(le,L,q,Z,ie),le}if(L instanceof Blob){const le=new Blob([L],{type:L.type});return Z.set(L,le),D(le,L,q,Z,ie),le}if(L instanceof Error){const le=new L.constructor;return Z.set(L,le),le.message=L.message,le.name=L.name,le.stack=L.stack,le.cause=L.cause,D(le,L,q,Z,ie),le}if(typeof L=="object"&&k(L)){const le=Object.create(Object.getPrototypeOf(L));return Z.set(L,le),D(le,L,q,Z,ie),le}return L}function D(L,$,q=L,Z,ie){const oe=[...Object.keys($),...n.getSymbols($)];for(let le=0;le<oe.length;le++){const xe=oe[le],ge=Object.getOwnPropertyDescriptor(L,xe);(ge==null||ge.writable)&&(L[xe]=o($[xe],xe,q,Z,ie))}}function k(L){switch(l.getTag(L)){case u.argumentsTag:case u.arrayTag:case u.arrayBufferTag:case u.dataViewTag:case u.booleanTag:case u.dateTag:case u.float32ArrayTag:case u.float64ArrayTag:case u.int8ArrayTag:case u.int16ArrayTag:case u.int32ArrayTag:case u.mapTag:case u.numberTag:case u.objectTag:case u.regexpTag:case u.setTag:case u.stringTag:case u.symbolTag:case u.uint8ArrayTag:case u.uint8ClampedArrayTag:case u.uint16ArrayTag:case u.uint32ArrayTag:return!0;default:return!1}}e.cloneDeepWith=I,e.cloneDeepWithImpl=o,e.copyProperties=D}(Rb)),Rb}var jC;function rV(){return jC||(jC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=mR();function l(u){return n.cloneDeepWithImpl(u,void 0,u,new Map,void 0)}e.cloneDeep=l}(kb)),kb}var UC;function nV(){return UC||(UC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=IT(),l=rV();function u(y){return y=l.cloneDeep(y),b=>n.isMatch(b,y)}e.matches=u}(Ib)),Ib}var Bb={},jb={},Ub={},VC;function iV(){return VC||(VC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=mR(),l=CT();function u(y,b){return n.cloneDeepWith(y,(I,o,D,k)=>{const L=b==null?void 0:b(I,o,D,k);if(L!=null)return L;if(typeof y=="object")switch(Object.prototype.toString.call(y)){case l.numberTag:case l.stringTag:case l.booleanTag:{const $=new y.constructor(y==null?void 0:y.valueOf());return n.copyProperties($,y),$}case l.argumentsTag:{const $={};return n.copyProperties($,y),$.length=y.length,$[Symbol.iterator]=y[Symbol.iterator],$}default:return}})}e.cloneDeepWith=u}(Ub)),Ub}var $C;function oV(){return $C||($C=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=iV();function l(u){return n.cloneDeepWith(u)}e.cloneDeep=l}(jb)),jb}var Vb={},$b={},GC;function gR(){return GC||(GC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=/^(?:0|[1-9]\d*)$/;function l(u,y=Number.MAX_SAFE_INTEGER){switch(typeof u){case"number":return Number.isInteger(u)&&u>=0&&u<y;case"symbol":return!1;case"string":return n.test(u)}}e.isIndex=l}($b)),$b}var Gb={},qC;function aV(){return qC||(qC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=PT();function l(u){return u!==null&&typeof u=="object"&&n.getTag(u)==="[object Arguments]"}e.isArguments=l}(Gb)),Gb}var WC;function sV(){return WC||(WC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=Vk(),l=gR(),u=aV(),y=_T();function b(I,o){let D;if(Array.isArray(o)?D=o:typeof o=="string"&&n.isDeepKey(o)&&(I==null?void 0:I[o])==null?D=y.toPath(o):D=[o],D.length===0)return!1;let k=I;for(let L=0;L<D.length;L++){const $=D[L];if((k==null||!Object.hasOwn(k,$))&&!((Array.isArray(k)||u.isArguments(k))&&l.isIndex($)&&$<k.length))return!1;k=k[$]}return!0}e.has=b}(Vb)),Vb}var HC;function lV(){return HC||(HC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=IT(),l=$k(),u=oV(),y=yT(),b=sV();function I(o,D){switch(typeof o){case"object":{Object.is(o==null?void 0:o.valueOf(),-0)&&(o="-0");break}case"number":{o=l.toKey(o);break}}return D=u.cloneDeep(D),function(k){const L=y.get(k,o);return L===void 0?b.has(k,o):D===void 0?L===void 0:n.isMatch(L,D)}}e.matchesProperty=I}(Bb)),Bb}var ZC;function cV(){return ZC||(ZC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=hR(),l=QU(),u=nV(),y=lV();function b(I){if(I==null)return n.identity;switch(typeof I){case"function":return I;case"object":return Array.isArray(I)&&I.length===2?y.matchesProperty(I[0],I[1]):u.matches(I);case"string":case"symbol":case"number":return l.property(I)}}e.iteratee=b}(Eb)),Eb}var XC;function uV(){return XC||(XC=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=XU(),l=hR(),u=JU(),y=cV();function b(I,o=l.identity){return u.isArrayLikeObject(I)?n.uniqBy(Array.from(I),y.iteratee(o)):[]}e.uniqBy=b}(yb)),yb}var qb,YC;function hV(){return YC||(YC=1,qb=uV().uniqBy),qb}var dV=hV();const KC=Bs(dV);function fV(e,n,l){return n===!0?KC(e,l):typeof n=="function"?KC(e,n):e}var Wb={exports:{}},Hb={},Zb={exports:{}},Xb={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JC;function pV(){if(JC)return Xb;JC=1;var e=jg();function n($,q){return $===q&&($!==0||1/$===1/q)||$!==$&&q!==q}var l=typeof Object.is=="function"?Object.is:n,u=e.useState,y=e.useEffect,b=e.useLayoutEffect,I=e.useDebugValue;function o($,q){var Z=q(),ie=u({inst:{value:Z,getSnapshot:q}}),oe=ie[0].inst,le=ie[1];return b(function(){oe.value=Z,oe.getSnapshot=q,D(oe)&&le({inst:oe})},[$,Z,q]),y(function(){return D(oe)&&le({inst:oe}),$(function(){D(oe)&&le({inst:oe})})},[$]),I(Z),Z}function D($){var q=$.getSnapshot;$=$.value;try{var Z=q();return!l($,Z)}catch{return!0}}function k($,q){return q()}var L=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?k:o;return Xb.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:L,Xb}var QC;function mV(){return QC||(QC=1,Zb.exports=pV()),Zb.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eM;function gV(){if(eM)return Hb;eM=1;var e=jg(),n=mV();function l(k,L){return k===L&&(k!==0||1/k===1/L)||k!==k&&L!==L}var u=typeof Object.is=="function"?Object.is:l,y=n.useSyncExternalStore,b=e.useRef,I=e.useEffect,o=e.useMemo,D=e.useDebugValue;return Hb.useSyncExternalStoreWithSelector=function(k,L,$,q,Z){var ie=b(null);if(ie.current===null){var oe={hasValue:!1,value:null};ie.current=oe}else oe=ie.current;ie=o(function(){function xe(nt){if(!ge){if(ge=!0,ke=nt,nt=q(nt),Z!==void 0&&oe.hasValue){var pt=oe.value;if(Z(pt,nt))return et=pt}return et=nt}if(pt=et,u(ke,nt))return pt;var Gt=q(nt);return Z!==void 0&&Z(pt,Gt)?(ke=nt,pt):(ke=nt,et=Gt)}var ge=!1,ke,et,ze=$===void 0?null:$;return[function(){return xe(L())},ze===null?void 0:function(){return xe(ze())}]},[L,$,q,Z]);var le=y(k,ie[0],ie[1]);return I(function(){oe.hasValue=!0,oe.value=le},[le]),D(le),le},Hb}var tM;function _V(){return tM||(tM=1,Wb.exports=gV()),Wb.exports}var yV=_V(),MT=Ae.createContext(null),vV=e=>e,Ba=()=>{var e=Ae.useContext(MT);return e?e.store.dispatch:vV},n0=()=>{},xV=()=>n0,bV=(e,n)=>e===n;function Ln(e){var n=Ae.useContext(MT);return yV.useSyncExternalStoreWithSelector(n?n.subscription.addNestedSub:xV,n?n.store.getState:n0,n?n.store.getState:n0,n?e:n0,bV)}function wV(e,n=`expected a function, instead received ${typeof e}`){if(typeof e!="function")throw new TypeError(n)}function SV(e,n=`expected an object, instead received ${typeof e}`){if(typeof e!="object")throw new TypeError(n)}function TV(e,n="expected all items to be functions, instead received the following types: "){if(!e.every(l=>typeof l=="function")){const l=e.map(u=>typeof u=="function"?`function ${u.name||"unnamed"}()`:typeof u).join(", ");throw new TypeError(`${n}[${l}]`)}}var rM=e=>Array.isArray(e)?e:[e];function EV(e){const n=Array.isArray(e[0])?e[0]:e;return TV(n,"createSelector expects all input-selectors to be functions, but received the following types: "),n}function AV(e,n){const l=[],{length:u}=e;for(let y=0;y<u;y++)l.push(e[y].apply(null,n));return l}var IV=class{constructor(e){this.value=e}deref(){return this.value}},PV=typeof WeakRef<"u"?WeakRef:IV,CV=0,nM=1;function Uv(){return{s:CV,v:void 0,o:null,p:null}}function _R(e,n={}){let l=Uv();const{resultEqualityCheck:u}=n;let y,b=0;function I(){var $;let o=l;const{length:D}=arguments;for(let q=0,Z=D;q<Z;q++){const ie=arguments[q];if(typeof ie=="function"||typeof ie=="object"&&ie!==null){let oe=o.o;oe===null&&(o.o=oe=new WeakMap);const le=oe.get(ie);le===void 0?(o=Uv(),oe.set(ie,o)):o=le}else{let oe=o.p;oe===null&&(o.p=oe=new Map);const le=oe.get(ie);le===void 0?(o=Uv(),oe.set(ie,o)):o=le}}const k=o;let L;if(o.s===nM)L=o.v;else if(L=e.apply(null,arguments),b++,u){const q=(($=y==null?void 0:y.deref)==null?void 0:$.call(y))??y;q!=null&&u(q,L)&&(L=q,b!==0&&b--),y=typeof L=="object"&&L!==null||typeof L=="function"?new PV(L):L}return k.s=nM,k.v=L,L}return I.clearCache=()=>{l=Uv(),I.resetResultsCount()},I.resultsCount=()=>b,I.resetResultsCount=()=>{b=0},I}function MV(e,...n){const l=typeof e=="function"?{memoize:e,memoizeOptions:n}:e,u=(...y)=>{let b=0,I=0,o,D={},k=y.pop();typeof k=="object"&&(D=k,k=y.pop()),wV(k,`createSelector expects an output function after the inputs, but received: [${typeof k}]`);const L={...l,...D},{memoize:$,memoizeOptions:q=[],argsMemoize:Z=_R,argsMemoizeOptions:ie=[]}=L,oe=rM(q),le=rM(ie),xe=EV(y),ge=$(function(){return b++,k.apply(null,arguments)},...oe),ke=Z(function(){I++;const ze=AV(xe,arguments);return o=ge.apply(null,ze),o},...le);return Object.assign(ke,{resultFunc:k,memoizedResultFunc:ge,dependencies:xe,dependencyRecomputations:()=>I,resetDependencyRecomputations:()=>{I=0},lastResult:()=>o,recomputations:()=>b,resetRecomputations:()=>{b=0},memoize:$,argsMemoize:Z})};return Object.assign(u,{withTypes:()=>u}),u}var Ht=MV(_R),OV=Object.assign((e,n=Ht)=>{SV(e,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof e}`);const l=Object.keys(e),u=l.map(b=>e[b]);return n(u,(...b)=>b.reduce((I,o,D)=>(I[l[D]]=o,I),{}))},{withTypes:()=>OV}),Yb={},Kb={},Jb={},iM;function DV(){return iM||(iM=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(u){return typeof u=="symbol"?1:u===null?2:u===void 0?3:u!==u?4:0}const l=(u,y,b)=>{if(u!==y){const I=n(u),o=n(y);if(I===o&&I===0){if(u<y)return b==="desc"?1:-1;if(u>y)return b==="desc"?-1:1}return b==="desc"?o-I:I-o}return 0};e.compareValues=l}(Jb)),Jb}var Qb={},ew={},oM;function yR(){return oM||(oM=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){return typeof l=="symbol"||l instanceof Symbol}e.isSymbol=n}(ew)),ew}var aM;function kV(){return aM||(aM=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=yR(),l=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,u=/^\w*$/;function y(b,I){return Array.isArray(b)?!1:typeof b=="number"||typeof b=="boolean"||b==null||n.isSymbol(b)?!0:typeof b=="string"&&(u.test(b)||!l.test(b))||I!=null&&Object.hasOwn(I,b)}e.isKey=y}(Qb)),Qb}var sM;function RV(){return sM||(sM=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=DV(),l=kV(),u=_T();function y(b,I,o,D){if(b==null)return[];o=D?void 0:o,Array.isArray(b)||(b=Object.values(b)),Array.isArray(I)||(I=I==null?[null]:[I]),I.length===0&&(I=[null]),Array.isArray(o)||(o=o==null?[]:[o]),o=o.map(Z=>String(Z));const k=(Z,ie)=>{let oe=Z;for(let le=0;le<ie.length&&oe!=null;++le)oe=oe[ie[le]];return oe},L=(Z,ie)=>ie==null||Z==null?ie:typeof Z=="object"&&"key"in Z?Object.hasOwn(ie,Z.key)?ie[Z.key]:k(ie,Z.path):typeof Z=="function"?Z(ie):Array.isArray(Z)?k(ie,Z):typeof ie=="object"?ie[Z]:ie,$=I.map(Z=>(Array.isArray(Z)&&Z.length===1&&(Z=Z[0]),Z==null||typeof Z=="function"||Array.isArray(Z)||l.isKey(Z)?Z:{key:Z,path:u.toPath(Z)}));return b.map(Z=>({original:Z,criteria:$.map(ie=>L(ie,Z))})).slice().sort((Z,ie)=>{for(let oe=0;oe<$.length;oe++){const le=n.compareValues(Z.criteria[oe],ie.criteria[oe],o[oe]);if(le!==0)return le}return 0}).map(Z=>Z.original)}e.orderBy=y}(Kb)),Kb}var tw={},lM;function LV(){return lM||(lM=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l,u=1){const y=[],b=Math.floor(u),I=(o,D)=>{for(let k=0;k<o.length;k++){const L=o[k];Array.isArray(L)&&D<b?I(L,D+1):y.push(L)}};return I(l,0),y}e.flatten=n}(tw)),tw}var rw={},cM;function vR(){return cM||(cM=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=gR(),l=ET(),u=dR(),y=AT();function b(I,o,D){return u.isObject(D)&&(typeof o=="number"&&l.isArrayLike(D)&&n.isIndex(o)&&o<D.length||typeof o=="string"&&o in D)?y.eq(D[o],I):!1}e.isIterateeCall=b}(rw)),rw}var uM;function zV(){return uM||(uM=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=RV(),l=LV(),u=vR();function y(b,...I){const o=I.length;return o>1&&u.isIterateeCall(b,I[0],I[1])?I=[]:o>2&&u.isIterateeCall(I[0],I[1],I[2])&&(I=[I[0]]),n.orderBy(b,l.flatten(I),["asc"])}e.sortBy=y}(Yb)),Yb}var nw,hM;function FV(){return hM||(hM=1,nw=zV().sortBy),nw}var NV=FV();const ix=Bs(NV);var xR=e=>e.legend.settings,BV=e=>e.legend.size,jV=e=>e.legend.payload;Ht([jV,xR],(e,n)=>{var{itemSorter:l}=n,u=e.flat(1);return l?ix(u,l):u});var Vv=1;function UV(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],[n,l]=Ae.useState({height:0,left:0,top:0,width:0}),u=Ae.useCallback(y=>{if(y!=null){var b=y.getBoundingClientRect(),I={height:b.height,left:b.left,top:b.top,width:b.width};(Math.abs(I.height-n.height)>Vv||Math.abs(I.left-n.left)>Vv||Math.abs(I.top-n.top)>Vv||Math.abs(I.width-n.width)>Vv)&&l({height:I.height,left:I.left,top:I.top,width:I.width})}},[n.width,n.height,n.top,n.left,...e]);return[n,u]}function fs(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var VV=typeof Symbol=="function"&&Symbol.observable||"@@observable",dM=VV,iw=()=>Math.random().toString(36).substring(7).split("").join("."),$V={INIT:`@@redux/INIT${iw()}`,REPLACE:`@@redux/REPLACE${iw()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${iw()}`},d0=$V;function OT(e){if(typeof e!="object"||e===null)return!1;let n=e;for(;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return Object.getPrototypeOf(e)===n||Object.getPrototypeOf(e)===null}function bR(e,n,l){if(typeof e!="function")throw new Error(fs(2));if(typeof n=="function"&&typeof l=="function"||typeof l=="function"&&typeof arguments[3]=="function")throw new Error(fs(0));if(typeof n=="function"&&typeof l>"u"&&(l=n,n=void 0),typeof l<"u"){if(typeof l!="function")throw new Error(fs(1));return l(bR)(e,n)}let u=e,y=n,b=new Map,I=b,o=0,D=!1;function k(){I===b&&(I=new Map,b.forEach((le,xe)=>{I.set(xe,le)}))}function L(){if(D)throw new Error(fs(3));return y}function $(le){if(typeof le!="function")throw new Error(fs(4));if(D)throw new Error(fs(5));let xe=!0;k();const ge=o++;return I.set(ge,le),function(){if(xe){if(D)throw new Error(fs(6));xe=!1,k(),I.delete(ge),b=null}}}function q(le){if(!OT(le))throw new Error(fs(7));if(typeof le.type>"u")throw new Error(fs(8));if(typeof le.type!="string")throw new Error(fs(17));if(D)throw new Error(fs(9));try{D=!0,y=u(y,le)}finally{D=!1}return(b=I).forEach(ge=>{ge()}),le}function Z(le){if(typeof le!="function")throw new Error(fs(10));u=le,q({type:d0.REPLACE})}function ie(){const le=$;return{subscribe(xe){if(typeof xe!="object"||xe===null)throw new Error(fs(11));function ge(){const et=xe;et.next&&et.next(L())}return ge(),{unsubscribe:le(ge)}},[dM](){return this}}}return q({type:d0.INIT}),{dispatch:q,subscribe:$,getState:L,replaceReducer:Z,[dM]:ie}}function GV(e){Object.keys(e).forEach(n=>{const l=e[n];if(typeof l(void 0,{type:d0.INIT})>"u")throw new Error(fs(12));if(typeof l(void 0,{type:d0.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(fs(13))})}function wR(e){const n=Object.keys(e),l={};for(let b=0;b<n.length;b++){const I=n[b];typeof e[I]=="function"&&(l[I]=e[I])}const u=Object.keys(l);let y;try{GV(l)}catch(b){y=b}return function(I={},o){if(y)throw y;let D=!1;const k={};for(let L=0;L<u.length;L++){const $=u[L],q=l[$],Z=I[$],ie=q(Z,o);if(typeof ie>"u")throw o&&o.type,new Error(fs(14));k[$]=ie,D=D||ie!==Z}return D=D||u.length!==Object.keys(I).length,D?k:I}}function f0(...e){return e.length===0?n=>n:e.length===1?e[0]:e.reduce((n,l)=>(...u)=>n(l(...u)))}function qV(...e){return n=>(l,u)=>{const y=n(l,u);let b=()=>{throw new Error(fs(15))};const I={getState:y.getState,dispatch:(D,...k)=>b(D,...k)},o=e.map(D=>D(I));return b=f0(...o)(y.dispatch),{...y,dispatch:b}}}function SR(e){return OT(e)&&"type"in e&&typeof e.type=="string"}var TR=Symbol.for("immer-nothing"),fM=Symbol.for("immer-draftable"),Ac=Symbol.for("immer-state");function rh(e,...n){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var Dg=Object.getPrototypeOf;function Lm(e){return!!e&&!!e[Ac]}function lf(e){var n;return e?ER(e)||Array.isArray(e)||!!e[fM]||!!((n=e.constructor)!=null&&n[fM])||ax(e)||sx(e):!1}var WV=Object.prototype.constructor.toString();function ER(e){if(!e||typeof e!="object")return!1;const n=Dg(e);if(n===null)return!0;const l=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return l===Object?!0:typeof l=="function"&&Function.toString.call(l)===WV}function p0(e,n){ox(e)===0?Reflect.ownKeys(e).forEach(l=>{n(l,e[l],e)}):e.forEach((l,u)=>n(u,l,e))}function ox(e){const n=e[Ac];return n?n.type_:Array.isArray(e)?1:ax(e)?2:sx(e)?3:0}function mS(e,n){return ox(e)===2?e.has(n):Object.prototype.hasOwnProperty.call(e,n)}function AR(e,n,l){const u=ox(e);u===2?e.set(n,l):u===3?e.add(l):e[n]=l}function HV(e,n){return e===n?e!==0||1/e===1/n:e!==e&&n!==n}function ax(e){return e instanceof Map}function sx(e){return e instanceof Set}function bm(e){return e.copy_||e.base_}function gS(e,n){if(ax(e))return new Map(e);if(sx(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const l=ER(e);if(n===!0||n==="class_only"&&!l){const u=Object.getOwnPropertyDescriptors(e);delete u[Ac];let y=Reflect.ownKeys(u);for(let b=0;b<y.length;b++){const I=y[b],o=u[I];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(u[I]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[I]})}return Object.create(Dg(e),u)}else{const u=Dg(e);if(u!==null&&l)return{...e};const y=Object.create(u);return Object.assign(y,e)}}function DT(e,n=!1){return lx(e)||Lm(e)||!lf(e)||(ox(e)>1&&(e.set=e.add=e.clear=e.delete=ZV),Object.freeze(e),n&&Object.entries(e).forEach(([l,u])=>DT(u,!0))),e}function ZV(){rh(2)}function lx(e){return Object.isFrozen(e)}var XV={};function zm(e){const n=XV[e];return n||rh(0,e),n}var ly;function IR(){return ly}function YV(e,n){return{drafts_:[],parent_:e,immer_:n,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function pM(e,n){n&&(zm("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=n)}function _S(e){yS(e),e.drafts_.forEach(KV),e.drafts_=null}function yS(e){e===ly&&(ly=e.parent_)}function mM(e){return ly=YV(ly,e)}function KV(e){const n=e[Ac];n.type_===0||n.type_===1?n.revoke_():n.revoked_=!0}function gM(e,n){n.unfinalizedDrafts_=n.drafts_.length;const l=n.drafts_[0];return e!==void 0&&e!==l?(l[Ac].modified_&&(_S(n),rh(4)),lf(e)&&(e=m0(n,e),n.parent_||g0(n,e)),n.patches_&&zm("Patches").generateReplacementPatches_(l[Ac].base_,e,n.patches_,n.inversePatches_)):e=m0(n,l,[]),_S(n),n.patches_&&n.patchListener_(n.patches_,n.inversePatches_),e!==TR?e:void 0}function m0(e,n,l){if(lx(n))return n;const u=n[Ac];if(!u)return p0(n,(y,b)=>_M(e,u,n,y,b,l)),n;if(u.scope_!==e)return n;if(!u.modified_)return g0(e,u.base_,!0),u.base_;if(!u.finalized_){u.finalized_=!0,u.scope_.unfinalizedDrafts_--;const y=u.copy_;let b=y,I=!1;u.type_===3&&(b=new Set(y),y.clear(),I=!0),p0(b,(o,D)=>_M(e,u,y,o,D,l,I)),g0(e,y,!1),l&&e.patches_&&zm("Patches").generatePatches_(u,l,e.patches_,e.inversePatches_)}return u.copy_}function _M(e,n,l,u,y,b,I){if(Lm(y)){const o=b&&n&&n.type_!==3&&!mS(n.assigned_,u)?b.concat(u):void 0,D=m0(e,y,o);if(AR(l,u,D),Lm(D))e.canAutoFreeze_=!1;else return}else I&&l.add(y);if(lf(y)&&!lx(y)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;m0(e,y),(!n||!n.scope_.parent_)&&typeof u!="symbol"&&Object.prototype.propertyIsEnumerable.call(l,u)&&g0(e,y)}}function g0(e,n,l=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&DT(n,l)}function JV(e,n){const l=Array.isArray(e),u={type_:l?1:0,scope_:n?n.scope_:IR(),modified_:!1,finalized_:!1,assigned_:{},parent_:n,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let y=u,b=kT;l&&(y=[u],b=cy);const{revoke:I,proxy:o}=Proxy.revocable(y,b);return u.draft_=o,u.revoke_=I,o}var kT={get(e,n){if(n===Ac)return e;const l=bm(e);if(!mS(l,n))return QV(e,l,n);const u=l[n];return e.finalized_||!lf(u)?u:u===ow(e.base_,n)?(aw(e),e.copy_[n]=xS(u,e)):u},has(e,n){return n in bm(e)},ownKeys(e){return Reflect.ownKeys(bm(e))},set(e,n,l){const u=PR(bm(e),n);if(u!=null&&u.set)return u.set.call(e.draft_,l),!0;if(!e.modified_){const y=ow(bm(e),n),b=y==null?void 0:y[Ac];if(b&&b.base_===l)return e.copy_[n]=l,e.assigned_[n]=!1,!0;if(HV(l,y)&&(l!==void 0||mS(e.base_,n)))return!0;aw(e),vS(e)}return e.copy_[n]===l&&(l!==void 0||n in e.copy_)||Number.isNaN(l)&&Number.isNaN(e.copy_[n])||(e.copy_[n]=l,e.assigned_[n]=!0),!0},deleteProperty(e,n){return ow(e.base_,n)!==void 0||n in e.base_?(e.assigned_[n]=!1,aw(e),vS(e)):delete e.assigned_[n],e.copy_&&delete e.copy_[n],!0},getOwnPropertyDescriptor(e,n){const l=bm(e),u=Reflect.getOwnPropertyDescriptor(l,n);return u&&{writable:!0,configurable:e.type_!==1||n!=="length",enumerable:u.enumerable,value:l[n]}},defineProperty(){rh(11)},getPrototypeOf(e){return Dg(e.base_)},setPrototypeOf(){rh(12)}},cy={};p0(kT,(e,n)=>{cy[e]=function(){return arguments[0]=arguments[0][0],n.apply(this,arguments)}});cy.deleteProperty=function(e,n){return cy.set.call(this,e,n,void 0)};cy.set=function(e,n,l){return kT.set.call(this,e[0],n,l,e[0])};function ow(e,n){const l=e[Ac];return(l?bm(l):e)[n]}function QV(e,n,l){var y;const u=PR(n,l);return u?"value"in u?u.value:(y=u.get)==null?void 0:y.call(e.draft_):void 0}function PR(e,n){if(!(n in e))return;let l=Dg(e);for(;l;){const u=Object.getOwnPropertyDescriptor(l,n);if(u)return u;l=Dg(l)}}function vS(e){e.modified_||(e.modified_=!0,e.parent_&&vS(e.parent_))}function aw(e){e.copy_||(e.copy_=gS(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var e6=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(n,l,u)=>{if(typeof n=="function"&&typeof l!="function"){const b=l;l=n;const I=this;return function(D=b,...k){return I.produce(D,L=>l.call(this,L,...k))}}typeof l!="function"&&rh(6),u!==void 0&&typeof u!="function"&&rh(7);let y;if(lf(n)){const b=mM(this),I=xS(n,void 0);let o=!0;try{y=l(I),o=!1}finally{o?_S(b):yS(b)}return pM(b,u),gM(y,b)}else if(!n||typeof n!="object"){if(y=l(n),y===void 0&&(y=n),y===TR&&(y=void 0),this.autoFreeze_&&DT(y,!0),u){const b=[],I=[];zm("Patches").generateReplacementPatches_(n,y,b,I),u(b,I)}return y}else rh(1,n)},this.produceWithPatches=(n,l)=>{if(typeof n=="function")return(I,...o)=>this.produceWithPatches(I,D=>n(D,...o));let u,y;return[this.produce(n,l,(I,o)=>{u=I,y=o}),u,y]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){lf(e)||rh(8),Lm(e)&&(e=af(e));const n=mM(this),l=xS(e,void 0);return l[Ac].isManual_=!0,yS(n),l}finishDraft(e,n){const l=e&&e[Ac];(!l||!l.isManual_)&&rh(9);const{scope_:u}=l;return pM(u,n),gM(void 0,u)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,n){let l;for(l=n.length-1;l>=0;l--){const y=n[l];if(y.path.length===0&&y.op==="replace"){e=y.value;break}}l>-1&&(n=n.slice(l+1));const u=zm("Patches").applyPatches_;return Lm(e)?u(e,n):this.produce(e,y=>u(y,n))}};function xS(e,n){const l=ax(e)?zm("MapSet").proxyMap_(e,n):sx(e)?zm("MapSet").proxySet_(e,n):JV(e,n);return(n?n.scope_:IR()).drafts_.push(l),l}function af(e){return Lm(e)||rh(10,e),CR(e)}function CR(e){if(!lf(e)||lx(e))return e;const n=e[Ac];let l;if(n){if(!n.modified_)return n.base_;n.finalized_=!0,l=gS(e,n.scope_.immer_.useStrictShallowCopy_)}else l=gS(e,!0);return p0(l,(u,y)=>{AR(l,u,CR(y))}),n&&(n.finalized_=!1),l}var Ic=new e6,MR=Ic.produce;Ic.produceWithPatches.bind(Ic);Ic.setAutoFreeze.bind(Ic);Ic.setUseStrictShallowCopy.bind(Ic);Ic.applyPatches.bind(Ic);Ic.createDraft.bind(Ic);Ic.finishDraft.bind(Ic);function OR(e){return({dispatch:l,getState:u})=>y=>b=>typeof b=="function"?b(l,u,e):y(b)}var t6=OR(),r6=OR,n6=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?f0:f0.apply(null,arguments)};function fu(e,n){function l(...u){if(n){let y=n(...u);if(!y)throw new Error(Sc(0));return{type:e,payload:y.payload,..."meta"in y&&{meta:y.meta},..."error"in y&&{error:y.error}}}return{type:e,payload:u[0]}}return l.toString=()=>`${e}`,l.type=e,l.match=u=>SR(u)&&u.type===e,l}var DR=class ty extends Array{constructor(...n){super(...n),Object.setPrototypeOf(this,ty.prototype)}static get[Symbol.species](){return ty}concat(...n){return super.concat.apply(this,n)}prepend(...n){return n.length===1&&Array.isArray(n[0])?new ty(...n[0].concat(this)):new ty(...n.concat(this))}};function yM(e){return lf(e)?MR(e,()=>{}):e}function $v(e,n,l){return e.has(n)?e.get(n):e.set(n,l(n)).get(n)}function i6(e){return typeof e=="boolean"}var o6=()=>function(n){const{thunk:l=!0,immutableCheck:u=!0,serializableCheck:y=!0,actionCreatorCheck:b=!0}=n??{};let I=new DR;return l&&(i6(l)?I.push(t6):I.push(r6(l.extraArgument))),I},a6="RTK_autoBatch",vM=e=>n=>{setTimeout(n,e)},s6=(e={type:"raf"})=>n=>(...l)=>{const u=n(...l);let y=!0,b=!1,I=!1;const o=new Set,D=e.type==="tick"?queueMicrotask:e.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:vM(10):e.type==="callback"?e.queueNotification:vM(e.timeout),k=()=>{I=!1,b&&(b=!1,o.forEach(L=>L()))};return Object.assign({},u,{subscribe(L){const $=()=>y&&L(),q=u.subscribe($);return o.add(L),()=>{q(),o.delete(L)}},dispatch(L){var $;try{return y=!(($=L==null?void 0:L.meta)!=null&&$[a6]),b=!y,b&&(I||(I=!0,D(k))),u.dispatch(L)}finally{y=!0}}})},l6=e=>function(l){const{autoBatch:u=!0}=l??{};let y=new DR(e);return u&&y.push(s6(typeof u=="object"?u:void 0)),y};function c6(e){const n=o6(),{reducer:l=void 0,middleware:u,devTools:y=!0,preloadedState:b=void 0,enhancers:I=void 0}=e||{};let o;if(typeof l=="function")o=l;else if(OT(l))o=wR(l);else throw new Error(Sc(1));let D;typeof u=="function"?D=u(n):D=n();let k=f0;y&&(k=n6({trace:!1,...typeof y=="object"&&y}));const L=qV(...D),$=l6(L);let q=typeof I=="function"?I($):$();const Z=k(...q);return bR(o,b,Z)}function kR(e){const n={},l=[];let u;const y={addCase(b,I){const o=typeof b=="string"?b:b.type;if(!o)throw new Error(Sc(28));if(o in n)throw new Error(Sc(29));return n[o]=I,y},addMatcher(b,I){return l.push({matcher:b,reducer:I}),y},addDefaultCase(b){return u=b,y}};return e(y),[n,l,u]}function u6(e){return typeof e=="function"}function h6(e,n){let[l,u,y]=kR(n),b;if(u6(e))b=()=>yM(e());else{const o=yM(e);b=()=>o}function I(o=b(),D){let k=[l[D.type],...u.filter(({matcher:L})=>L(D)).map(({reducer:L})=>L)];return k.filter(L=>!!L).length===0&&(k=[y]),k.reduce((L,$)=>{if($)if(Lm(L)){const Z=$(L,D);return Z===void 0?L:Z}else{if(lf(L))return MR(L,q=>$(q,D));{const q=$(L,D);if(q===void 0){if(L===null)return L;throw Error("A case reducer on a non-draftable value must not return undefined")}return q}}return L},o)}return I.getInitialState=b,I}var d6="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",f6=(e=21)=>{let n="",l=e;for(;l--;)n+=d6[Math.random()*64|0];return n},p6=Symbol.for("rtk-slice-createasyncthunk");function m6(e,n){return`${e}/${n}`}function g6({creators:e}={}){var l;const n=(l=e==null?void 0:e.asyncThunk)==null?void 0:l[p6];return function(y){const{name:b,reducerPath:I=b}=y;if(!b)throw new Error(Sc(11));const o=(typeof y.reducers=="function"?y.reducers(y6()):y.reducers)||{},D=Object.keys(o),k={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},L={addCase(et,ze){const nt=typeof et=="string"?et:et.type;if(!nt)throw new Error(Sc(12));if(nt in k.sliceCaseReducersByType)throw new Error(Sc(13));return k.sliceCaseReducersByType[nt]=ze,L},addMatcher(et,ze){return k.sliceMatchers.push({matcher:et,reducer:ze}),L},exposeAction(et,ze){return k.actionCreators[et]=ze,L},exposeCaseReducer(et,ze){return k.sliceCaseReducersByName[et]=ze,L}};D.forEach(et=>{const ze=o[et],nt={reducerName:et,type:m6(b,et),createNotation:typeof y.reducers=="function"};x6(ze)?w6(nt,ze,L,n):v6(nt,ze,L)});function $(){const[et={},ze=[],nt=void 0]=typeof y.extraReducers=="function"?kR(y.extraReducers):[y.extraReducers],pt={...et,...k.sliceCaseReducersByType};return h6(y.initialState,Gt=>{for(let ir in pt)Gt.addCase(ir,pt[ir]);for(let ir of k.sliceMatchers)Gt.addMatcher(ir.matcher,ir.reducer);for(let ir of ze)Gt.addMatcher(ir.matcher,ir.reducer);nt&&Gt.addDefaultCase(nt)})}const q=et=>et,Z=new Map,ie=new WeakMap;let oe;function le(et,ze){return oe||(oe=$()),oe(et,ze)}function xe(){return oe||(oe=$()),oe.getInitialState()}function ge(et,ze=!1){function nt(Gt){let ir=Gt[et];return typeof ir>"u"&&ze&&(ir=$v(ie,nt,xe)),ir}function pt(Gt=q){const ir=$v(Z,ze,()=>new WeakMap);return $v(ir,Gt,()=>{const Br={};for(const[Zt,dr]of Object.entries(y.selectors??{}))Br[Zt]=_6(dr,Gt,()=>$v(ie,Gt,xe),ze);return Br})}return{reducerPath:et,getSelectors:pt,get selectors(){return pt(nt)},selectSlice:nt}}const ke={name:b,reducer:le,actions:k.actionCreators,caseReducers:k.sliceCaseReducersByName,getInitialState:xe,...ge(I),injectInto(et,{reducerPath:ze,...nt}={}){const pt=ze??I;return et.inject({reducerPath:pt,reducer:le},nt),{...ke,...ge(pt,!0)}}};return ke}}function _6(e,n,l,u){function y(b,...I){let o=n(b);return typeof o>"u"&&u&&(o=l()),e(o,...I)}return y.unwrapped=e,y}var mu=g6();function y6(){function e(n,l){return{_reducerDefinitionType:"asyncThunk",payloadCreator:n,...l}}return e.withTypes=()=>e,{reducer(n){return Object.assign({[n.name](...l){return n(...l)}}[n.name],{_reducerDefinitionType:"reducer"})},preparedReducer(n,l){return{_reducerDefinitionType:"reducerWithPrepare",prepare:n,reducer:l}},asyncThunk:e}}function v6({type:e,reducerName:n,createNotation:l},u,y){let b,I;if("reducer"in u){if(l&&!b6(u))throw new Error(Sc(17));b=u.reducer,I=u.prepare}else b=u;y.addCase(e,b).exposeCaseReducer(n,b).exposeAction(n,I?fu(e,I):fu(e))}function x6(e){return e._reducerDefinitionType==="asyncThunk"}function b6(e){return e._reducerDefinitionType==="reducerWithPrepare"}function w6({type:e,reducerName:n},l,u,y){if(!y)throw new Error(Sc(18));const{payloadCreator:b,fulfilled:I,pending:o,rejected:D,settled:k,options:L}=l,$=y(e,b,L);u.exposeAction(n,$),I&&u.addCase($.fulfilled,I),o&&u.addCase($.pending,o),D&&u.addCase($.rejected,D),k&&u.addMatcher($.settled,k),u.exposeCaseReducer(n,{fulfilled:I||Gv,pending:o||Gv,rejected:D||Gv,settled:k||Gv})}function Gv(){}var S6="task",RR="listener",LR="completed",RT="cancelled",T6=`task-${RT}`,E6=`task-${LR}`,bS=`${RR}-${RT}`,A6=`${RR}-${LR}`,cx=class{constructor(e){q1(this,"name","TaskAbortError");q1(this,"message");this.code=e,this.message=`${S6} ${RT} (reason: ${e})`}},LT=(e,n)=>{if(typeof e!="function")throw new TypeError(Sc(32))},_0=()=>{},zR=(e,n=_0)=>(e.catch(n),e),FR=(e,n)=>(e.addEventListener("abort",n,{once:!0}),()=>e.removeEventListener("abort",n)),Cm=(e,n)=>{const l=e.signal;l.aborted||("reason"in l||Object.defineProperty(l,"reason",{enumerable:!0,value:n,configurable:!0,writable:!0}),e.abort(n))},Mm=e=>{if(e.aborted){const{reason:n}=e;throw new cx(n)}};function NR(e,n){let l=_0;return new Promise((u,y)=>{const b=()=>y(new cx(e.reason));if(e.aborted){b();return}l=FR(e,b),n.finally(()=>l()).then(u,y)}).finally(()=>{l=_0})}var I6=async(e,n)=>{try{return await Promise.resolve(),{status:"ok",value:await e()}}catch(l){return{status:l instanceof cx?"cancelled":"rejected",error:l}}finally{n==null||n()}},y0=e=>n=>zR(NR(e,n).then(l=>(Mm(e),l))),BR=e=>{const n=y0(e);return l=>n(new Promise(u=>setTimeout(u,l)))},{assign:Ig}=Object,xM={},ux="listenerMiddleware",P6=(e,n)=>{const l=u=>FR(e,()=>Cm(u,e.reason));return(u,y)=>{LT(u);const b=new AbortController;l(b);const I=I6(async()=>{Mm(e),Mm(b.signal);const o=await u({pause:y0(b.signal),delay:BR(b.signal),signal:b.signal});return Mm(b.signal),o},()=>Cm(b,E6));return y!=null&&y.autoJoin&&n.push(I.catch(_0)),{result:y0(e)(I),cancel(){Cm(b,T6)}}}},C6=(e,n)=>{const l=async(u,y)=>{Mm(n);let b=()=>{};const o=[new Promise((D,k)=>{let L=e({predicate:u,effect:($,q)=>{q.unsubscribe(),D([$,q.getState(),q.getOriginalState()])}});b=()=>{L(),k()}})];y!=null&&o.push(new Promise(D=>setTimeout(D,y,null)));try{const D=await NR(n,Promise.race(o));return Mm(n),D}finally{b()}};return(u,y)=>zR(l(u,y))},jR=e=>{let{type:n,actionCreator:l,matcher:u,predicate:y,effect:b}=e;if(n)y=fu(n).match;else if(l)n=l.type,y=l.match;else if(u)y=u;else if(!y)throw new Error(Sc(21));return LT(b),{predicate:y,type:n,effect:b}},UR=Ig(e=>{const{type:n,predicate:l,effect:u}=jR(e);return{id:f6(),effect:u,type:n,predicate:l,pending:new Set,unsubscribe:()=>{throw new Error(Sc(22))}}},{withTypes:()=>UR}),bM=(e,n)=>{const{type:l,effect:u,predicate:y}=jR(n);return Array.from(e.values()).find(b=>(typeof l=="string"?b.type===l:b.predicate===y)&&b.effect===u)},wS=e=>{e.pending.forEach(n=>{Cm(n,bS)})},M6=e=>()=>{e.forEach(wS),e.clear()},wM=(e,n,l)=>{try{e(n,l)}catch(u){setTimeout(()=>{throw u},0)}},VR=Ig(fu(`${ux}/add`),{withTypes:()=>VR}),O6=fu(`${ux}/removeAll`),$R=Ig(fu(`${ux}/remove`),{withTypes:()=>$R}),D6=(...e)=>{console.error(`${ux}/error`,...e)},Iy=(e={})=>{const n=new Map,{extra:l,onError:u=D6}=e;LT(u);const y=L=>(L.unsubscribe=()=>n.delete(L.id),n.set(L.id,L),$=>{L.unsubscribe(),$!=null&&$.cancelActive&&wS(L)}),b=L=>{const $=bM(n,L)??UR(L);return y($)};Ig(b,{withTypes:()=>b});const I=L=>{const $=bM(n,L);return $&&($.unsubscribe(),L.cancelActive&&wS($)),!!$};Ig(I,{withTypes:()=>I});const o=async(L,$,q,Z)=>{const ie=new AbortController,oe=C6(b,ie.signal),le=[];try{L.pending.add(ie),await Promise.resolve(L.effect($,Ig({},q,{getOriginalState:Z,condition:(xe,ge)=>oe(xe,ge).then(Boolean),take:oe,delay:BR(ie.signal),pause:y0(ie.signal),extra:l,signal:ie.signal,fork:P6(ie.signal,le),unsubscribe:L.unsubscribe,subscribe:()=>{n.set(L.id,L)},cancelActiveListeners:()=>{L.pending.forEach((xe,ge,ke)=>{xe!==ie&&(Cm(xe,bS),ke.delete(xe))})},cancel:()=>{Cm(ie,bS),L.pending.delete(ie)},throwIfCancelled:()=>{Mm(ie.signal)}})))}catch(xe){xe instanceof cx||wM(u,xe,{raisedBy:"effect"})}finally{await Promise.all(le),Cm(ie,A6),L.pending.delete(ie)}},D=M6(n);return{middleware:L=>$=>q=>{if(!SR(q))return $(q);if(VR.match(q))return b(q.payload);if(O6.match(q)){D();return}if($R.match(q))return I(q.payload);let Z=L.getState();const ie=()=>{if(Z===xM)throw new Error(Sc(23));return Z};let oe;try{if(oe=$(q),n.size>0){const le=L.getState(),xe=Array.from(n.values());for(const ge of xe){let ke=!1;try{ke=ge.predicate(q,le,Z)}catch(et){ke=!1,wM(u,et,{raisedBy:"predicate"})}ke&&o(ge,q,L,ie)}}}finally{Z=xM}return oe},startListening:b,stopListening:I,clearListeners:D}};function Sc(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var k6={layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},GR=mu({name:"chartLayout",initialState:k6,reducers:{setLayout(e,n){e.layoutType=n.payload},setChartSize(e,n){e.width=n.payload.width,e.height=n.payload.height},setMargin(e,n){e.margin.top=n.payload.top,e.margin.right=n.payload.right,e.margin.bottom=n.payload.bottom,e.margin.left=n.payload.left},setScale(e,n){e.scale=n.payload}}}),{setMargin:R6,setLayout:L6,setChartSize:z6,setScale:F6}=GR.actions,N6=GR.reducer;function SM(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function TM(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?SM(Object(l),!0).forEach(function(u){B6(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):SM(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function B6(e,n,l){return(n=j6(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function j6(e){var n=U6(e,"string");return typeof n=="symbol"?n:n+""}function U6(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var v0=Math.PI/180,V6=e=>e*180/Math.PI,gs=(e,n,l,u)=>({x:e+Math.cos(-v0*u)*l,y:n+Math.sin(-v0*u)*l}),$6=function(n,l){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(n-(u.left||0)-(u.right||0)),Math.abs(l-(u.top||0)-(u.bottom||0)))/2},G6=(e,n)=>{var{x:l,y:u}=e,{x:y,y:b}=n;return Math.sqrt((l-y)**2+(u-b)**2)},q6=(e,n)=>{var{x:l,y:u}=e,{cx:y,cy:b}=n,I=G6({x:l,y:u},{x:y,y:b});if(I<=0)return{radius:I,angle:0};var o=(l-y)/I,D=Math.acos(o);return u>b&&(D=2*Math.PI-D),{radius:I,angle:V6(D),angleInRadian:D}},W6=e=>{var{startAngle:n,endAngle:l}=e,u=Math.floor(n/360),y=Math.floor(l/360),b=Math.min(u,y);return{startAngle:n-b*360,endAngle:l-b*360}},H6=(e,n)=>{var{startAngle:l,endAngle:u}=n,y=Math.floor(l/360),b=Math.floor(u/360),I=Math.min(y,b);return e+I*360},Z6=(e,n)=>{var{x:l,y:u}=e,{radius:y,angle:b}=q6({x:l,y:u},n),{innerRadius:I,outerRadius:o}=n;if(y<I||y>o||y===0)return null;var{startAngle:D,endAngle:k}=W6(n),L=b,$;if(D<=k){for(;L>k;)L-=360;for(;L<D;)L+=360;$=L>=D&&L<=k}else{for(;L>D;)L-=360;for(;L<k;)L+=360;$=L>=k&&L<=D}return $?TM(TM({},n),{},{radius:y,angle:H6(L,n)}):null};function EM(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function uu(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?EM(Object(l),!0).forEach(function(u){X6(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):EM(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function X6(e,n,l){return(n=Y6(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function Y6(e){var n=K6(e,"string");return typeof n=="symbol"?n:n+""}function K6(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Tc(e,n,l){return Aa(e)||Aa(n)?l:ld(n)?Rm(e,n,l):typeof n=="function"?n(e):l}var J6=(e,n,l,u,y)=>{var b,I=-1,o=(b=n==null?void 0:n.length)!==null&&b!==void 0?b:0;if(o<=1||e==null)return 0;if(u==="angleAxis"&&y!=null&&Math.abs(Math.abs(y[1]-y[0])-360)<=1e-6)for(var D=0;D<o;D++){var k=D>0?l[D-1].coordinate:l[o-1].coordinate,L=l[D].coordinate,$=D>=o-1?l[0].coordinate:l[D+1].coordinate,q=void 0;if($l(L-k)!==$l($-L)){var Z=[];if($l($-L)===$l(y[1]-y[0])){q=$;var ie=L+y[1]-y[0];Z[0]=Math.min(ie,(ie+k)/2),Z[1]=Math.max(ie,(ie+k)/2)}else{q=k;var oe=$+y[1]-y[0];Z[0]=Math.min(L,(oe+L)/2),Z[1]=Math.max(L,(oe+L)/2)}var le=[Math.min(L,(q+L)/2),Math.max(L,(q+L)/2)];if(e>le[0]&&e<=le[1]||e>=Z[0]&&e<=Z[1]){({index:I}=l[D]);break}}else{var xe=Math.min(k,$),ge=Math.max(k,$);if(e>(xe+L)/2&&e<=(ge+L)/2){({index:I}=l[D]);break}}}else if(n){for(var ke=0;ke<o;ke++)if(ke===0&&e<=(n[ke].coordinate+n[ke+1].coordinate)/2||ke>0&&ke<o-1&&e>(n[ke].coordinate+n[ke-1].coordinate)/2&&e<=(n[ke].coordinate+n[ke+1].coordinate)/2||ke===o-1&&e>(n[ke].coordinate+n[ke-1].coordinate)/2){({index:I}=n[ke]);break}}return I},Q6=(e,n,l)=>{if(n&&l){var{width:u,height:y}=l,{align:b,verticalAlign:I,layout:o}=n;if((o==="vertical"||o==="horizontal"&&I==="middle")&&b!=="center"&&mn(e[b]))return uu(uu({},e),{},{[b]:e[b]+(u||0)});if((o==="horizontal"||o==="vertical"&&b==="center")&&I!=="middle"&&mn(e[I]))return uu(uu({},e),{},{[I]:e[I]+(y||0)})}return e},Um=(e,n)=>e==="horizontal"&&n==="xAxis"||e==="vertical"&&n==="yAxis"||e==="centric"&&n==="angleAxis"||e==="radial"&&n==="radiusAxis",qR=(e,n,l,u)=>{if(u)return e.map(o=>o.coordinate);var y,b,I=e.map(o=>(o.coordinate===n&&(y=!0),o.coordinate===l&&(b=!0),o.coordinate));return y||I.push(n),b||I.push(l),I},WR=(e,n,l)=>{if(!e)return null;var{duplicateDomain:u,type:y,range:b,scale:I,realScaleType:o,isCategorical:D,categoricalDomain:k,tickCount:L,ticks:$,niceTicks:q,axisType:Z}=e;if(!I)return null;var ie=o==="scaleBand"&&I.bandwidth?I.bandwidth()/2:2,oe=y==="category"&&I.bandwidth?I.bandwidth()/ie:0;if(oe=Z==="angleAxis"&&b&&b.length>=2?$l(b[0]-b[1])*2*oe:oe,$||q){var le=($||q||[]).map((xe,ge)=>{var ke=u?u.indexOf(xe):xe;return{coordinate:I(ke)+oe,value:xe,offset:oe,index:ge}});return le.filter(xe=>!Ec(xe.coordinate))}return D&&k?k.map((xe,ge)=>({coordinate:I(xe)+oe,value:xe,index:ge,offset:oe})):I.ticks&&L!=null?I.ticks(L).map((xe,ge)=>({coordinate:I(xe)+oe,value:xe,offset:oe,index:ge})):I.domain().map((xe,ge)=>({coordinate:I(xe)+oe,value:u?u[xe]:xe,index:ge,offset:oe}))},AM=1e-4,e8=e=>{var n=e.domain();if(!(!n||n.length<=2)){var l=n.length,u=e.range(),y=Math.min(u[0],u[1])-AM,b=Math.max(u[0],u[1])+AM,I=e(n[0]),o=e(n[l-1]);(I<y||I>b||o<y||o>b)&&e.domain([n[0],n[l-1]])}},t8=(e,n)=>{if(!n||n.length!==2||!mn(n[0])||!mn(n[1]))return e;var l=Math.min(n[0],n[1]),u=Math.max(n[0],n[1]),y=[e[0],e[1]];return(!mn(e[0])||e[0]<l)&&(y[0]=l),(!mn(e[1])||e[1]>u)&&(y[1]=u),y[0]>u&&(y[0]=u),y[1]<l&&(y[1]=l),y},r8=e=>{var n=e.length;if(!(n<=0))for(var l=0,u=e[0].length;l<u;++l)for(var y=0,b=0,I=0;I<n;++I){var o=Ec(e[I][l][1])?e[I][l][0]:e[I][l][1];o>=0?(e[I][l][0]=y,e[I][l][1]=y+o,y=e[I][l][1]):(e[I][l][0]=b,e[I][l][1]=b+o,b=e[I][l][1])}},n8=e=>{var n=e.length;if(!(n<=0))for(var l=0,u=e[0].length;l<u;++l)for(var y=0,b=0;b<n;++b){var I=Ec(e[b][l][1])?e[b][l][0]:e[b][l][1];I>=0?(e[b][l][0]=y,e[b][l][1]=y+I,y=e[b][l][1]):(e[b][l][0]=0,e[b][l][1]=0)}},i8={sign:r8,expand:zU,none:Og,silhouette:FU,wiggle:NU,positive:n8},o8=(e,n,l)=>{var u=i8[l],y=LU().keys(n).value((b,I)=>+Tc(b,I,0)).order(fS).offset(u);return y(e)};function HR(e){return e==null?void 0:String(e)}var IM=e=>{var{axis:n,ticks:l,offset:u,bandSize:y,entry:b,index:I}=e;if(n.type==="category")return l[I]?l[I].coordinate+u:null;var o=Tc(b,n.dataKey,n.scale.domain()[I]);return Aa(o)?null:n.scale(o)-y/2+u},a8=e=>{var{numericAxis:n}=e,l=n.scale.domain();if(n.type==="number"){var u=Math.min(l[0],l[1]),y=Math.max(l[0],l[1]);return u<=0&&y>=0?0:y<0?y:u}return l[0]},s8=e=>{var n=e.flat(2).filter(mn);return[Math.min(...n),Math.max(...n)]},l8=e=>[e[0]===1/0?0:e[0],e[1]===-1/0?0:e[1]],c8=(e,n,l)=>{if(e!=null)return l8(Object.keys(e).reduce((u,y)=>{var b=e[y],{stackedData:I}=b,o=I.reduce((D,k)=>{var L=s8(k.slice(n,l+1));return[Math.min(D[0],L[0]),Math.max(D[1],L[1])]},[1/0,-1/0]);return[Math.min(o[0],u[0]),Math.max(o[1],u[1])]},[1/0,-1/0]))},PM=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,CM=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,zT=(e,n,l)=>{if(e&&e.scale&&e.scale.bandwidth){var u=e.scale.bandwidth();if(!l||u>0)return u}if(e&&n&&n.length>=2){for(var y=ix(n,L=>L.coordinate),b=1/0,I=1,o=y.length;I<o;I++){var D=y[I],k=y[I-1];b=Math.min((D.coordinate||0)-(k.coordinate||0),b)}return b===1/0?0:b}return l?void 0:0};function MM(e){var{tooltipEntrySettings:n,dataKey:l,payload:u,value:y,name:b}=e;return uu(uu({},n),{},{dataKey:l,payload:u,value:y,name:b})}function ZR(e,n){if(e)return String(e);if(typeof n=="string")return n}function u8(e,n,l,u,y){if(l==="horizontal"||l==="vertical"){var b=e>=y.left&&e<=y.left+y.width&&n>=y.top&&n<=y.top+y.height;return b?{x:e,y:n}:null}return u?Z6({x:e,y:n},u):null}var h8=(e,n,l,u)=>{var y=n.find(k=>k&&k.index===l);if(y){if(e==="horizontal")return{x:y.coordinate,y:u.y};if(e==="vertical")return{x:u.x,y:y.coordinate};if(e==="centric"){var b=y.coordinate,{radius:I}=u;return uu(uu(uu({},u),gs(u.cx,u.cy,I,b)),{},{angle:b,radius:I})}var o=y.coordinate,{angle:D}=u;return uu(uu(uu({},u),gs(u.cx,u.cy,o,D)),{},{angle:D,radius:o})}return{x:0,y:0}},d8=(e,n)=>n==="horizontal"?e.x:n==="vertical"?e.y:n==="centric"?e.angle:e.radius,ff=e=>e.layout.width,pf=e=>e.layout.height,f8=e=>e.layout.scale,XR=e=>e.layout.margin,FT=Ht(e=>e.cartesianAxis.xAxis,e=>Object.values(e)),NT=Ht(e=>e.cartesianAxis.yAxis,e=>Object.values(e)),p8="data-recharts-item-index",m8="data-recharts-item-data-key",hx=60;function OM(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function fp(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?OM(Object(l),!0).forEach(function(u){g8(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):OM(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function g8(e,n,l){return(n=_8(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function _8(e){var n=y8(e,"string");return typeof n=="symbol"?n:n+""}function y8(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var v8=e=>e.brush.height,Ha=Ht([ff,pf,XR,v8,FT,NT,xR,BV],(e,n,l,u,y,b,I,o)=>{var D=b.reduce((ie,oe)=>{var{orientation:le}=oe;if(!oe.mirror&&!oe.hide){var xe=typeof oe.width=="number"?oe.width:hx;return fp(fp({},ie),{},{[le]:ie[le]+xe})}return ie},{left:l.left||0,right:l.right||0}),k=y.reduce((ie,oe)=>{var{orientation:le}=oe;return!oe.mirror&&!oe.hide?fp(fp({},ie),{},{[le]:Rm(ie,"".concat(le))+oe.height}):ie},{top:l.top||0,bottom:l.bottom||0}),L=fp(fp({},k),D),$=L.bottom;L.bottom+=u,L=Q6(L,I,o);var q=e-L.left-L.right,Z=n-L.top-L.bottom;return fp(fp({brushBottom:$},L),{},{width:Math.max(q,0),height:Math.max(Z,0)})}),x8=Ht(Ha,e=>({x:e.left,y:e.top,width:e.width,height:e.height})),YR=Ht(ff,pf,(e,n)=>({x:0,y:0,width:e,height:n})),b8=Ae.createContext(null),ql=()=>Ae.useContext(b8)!=null,dx=e=>e.brush,fx=Ht([dx,Ha,XR],(e,n,l)=>({height:e.height,x:mn(e.x)?e.x:n.left,y:mn(e.y)?e.y:n.top+n.height+n.brushBottom-((l==null?void 0:l.bottom)||0),width:mn(e.width)?e.width:n.width})),BT=()=>{var e,n=ql(),l=Ln(x8),u=Ln(fx),y=(e=Ln(dx))===null||e===void 0?void 0:e.padding;return!n||!u||!y?l:{width:u.width-y.left-y.right,height:u.height-y.top-y.bottom,x:y.left,y:y.top}},w8={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},KR=()=>{var e;return(e=Ln(Ha))!==null&&e!==void 0?e:w8},JR=()=>Ln(ff),QR=()=>Ln(pf),xo=e=>e.layout.layoutType,jT=()=>Ln(xo),S8={settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},eL=mu({name:"legend",initialState:S8,reducers:{setLegendSize(e,n){e.size.width=n.payload.width,e.size.height=n.payload.height},setLegendSettings(e,n){e.settings.align=n.payload.align,e.settings.layout=n.payload.layout,e.settings.verticalAlign=n.payload.verticalAlign,e.settings.itemSorter=n.payload.itemSorter},addLegendPayload(e,n){e.payload.push(n.payload)},removeLegendPayload(e,n){var l=af(e).payload.indexOf(n.payload);l>-1&&e.payload.splice(l,1)}}}),{setLegendSize:BJ,setLegendSettings:jJ,addLegendPayload:T8,removeLegendPayload:E8}=eL.actions,A8=eL.reducer;function SS(){return SS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},SS.apply(null,arguments)}function DM(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function sw(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?DM(Object(l),!0).forEach(function(u){I8(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):DM(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function I8(e,n,l){return(n=P8(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function P8(e){var n=C8(e,"string");return typeof n=="symbol"?n:n+""}function C8(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function M8(e){return Array.isArray(e)&&ld(e[0])&&ld(e[1])?e.join(" ~ "):e}var O8=e=>{var{separator:n=" : ",contentStyle:l={},itemStyle:u={},labelStyle:y={},payload:b,formatter:I,itemSorter:o,wrapperClassName:D,labelClassName:k,label:L,labelFormatter:$,accessibilityLayer:q=!1}=e,Z=()=>{if(b&&b.length){var ze={padding:0,margin:0},nt=(o?ix(b,o):b).map((pt,Gt)=>{if(pt.type==="none")return null;var ir=pt.formatter||I||M8,{value:Br,name:Zt}=pt,dr=Br,Dr=Zt;if(ir){var vr=ir(Br,Zt,pt,Gt,b);if(Array.isArray(vr))[dr,Dr]=vr;else if(vr!=null)dr=vr;else return null}var Ar=sw({display:"block",paddingTop:4,paddingBottom:4,color:pt.color||"#000"},u);return Ae.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(Gt),style:Ar},ld(Dr)?Ae.createElement("span",{className:"recharts-tooltip-item-name"},Dr):null,ld(Dr)?Ae.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,Ae.createElement("span",{className:"recharts-tooltip-item-value"},dr),Ae.createElement("span",{className:"recharts-tooltip-item-unit"},pt.unit||""))});return Ae.createElement("ul",{className:"recharts-tooltip-item-list",style:ze},nt)}return null},ie=sw({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},l),oe=sw({margin:0},y),le=!Aa(L),xe=le?L:"",ge=co("recharts-default-tooltip",D),ke=co("recharts-tooltip-label",k);le&&$&&b!==void 0&&b!==null&&(xe=$(L,b));var et=q?{role:"status","aria-live":"assertive"}:{};return Ae.createElement("div",SS({className:ge,style:ie},et),Ae.createElement("p",{className:ke,style:oe},Ae.isValidElement(xe)?xe:"".concat(xe)),Z())},q_="recharts-tooltip-wrapper",D8={visibility:"hidden"};function k8(e){var{coordinate:n,translateX:l,translateY:u}=e;return co(q_,{["".concat(q_,"-right")]:mn(l)&&n&&mn(n.x)&&l>=n.x,["".concat(q_,"-left")]:mn(l)&&n&&mn(n.x)&&l<n.x,["".concat(q_,"-bottom")]:mn(u)&&n&&mn(n.y)&&u>=n.y,["".concat(q_,"-top")]:mn(u)&&n&&mn(n.y)&&u<n.y})}function kM(e){var{allowEscapeViewBox:n,coordinate:l,key:u,offsetTopLeft:y,position:b,reverseDirection:I,tooltipDimension:o,viewBox:D,viewBoxDimension:k}=e;if(b&&mn(b[u]))return b[u];var L=l[u]-o-(y>0?y:0),$=l[u]+y;if(n[u])return I[u]?L:$;var q=D[u];if(q==null)return 0;if(I[u]){var Z=L,ie=q;return Z<ie?Math.max($,q):Math.max(L,q)}if(k==null)return 0;var oe=$+o,le=q+k;return oe>le?Math.max(L,q):Math.max($,q)}function R8(e){var{translateX:n,translateY:l,useTranslate3d:u}=e;return{transform:u?"translate3d(".concat(n,"px, ").concat(l,"px, 0)"):"translate(".concat(n,"px, ").concat(l,"px)")}}function L8(e){var{allowEscapeViewBox:n,coordinate:l,offsetTopLeft:u,position:y,reverseDirection:b,tooltipBox:I,useTranslate3d:o,viewBox:D}=e,k,L,$;return I.height>0&&I.width>0&&l?(L=kM({allowEscapeViewBox:n,coordinate:l,key:"x",offsetTopLeft:u,position:y,reverseDirection:b,tooltipDimension:I.width,viewBox:D,viewBoxDimension:D.width}),$=kM({allowEscapeViewBox:n,coordinate:l,key:"y",offsetTopLeft:u,position:y,reverseDirection:b,tooltipDimension:I.height,viewBox:D,viewBoxDimension:D.height}),k=R8({translateX:L,translateY:$,useTranslate3d:o})):k=D8,{cssProperties:k,cssClasses:k8({translateX:L,translateY:$,coordinate:l})}}function RM(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function qv(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?RM(Object(l),!0).forEach(function(u){TS(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):RM(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function TS(e,n,l){return(n=z8(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function z8(e){var n=F8(e,"string");return typeof n=="symbol"?n:n+""}function F8(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}class N8 extends Ae.PureComponent{constructor(){super(...arguments),TS(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),TS(this,"handleKeyDown",n=>{if(n.key==="Escape"){var l,u,y,b;this.setState({dismissed:!0,dismissedAtCoordinate:{x:(l=(u=this.props.coordinate)===null||u===void 0?void 0:u.x)!==null&&l!==void 0?l:0,y:(y=(b=this.props.coordinate)===null||b===void 0?void 0:b.y)!==null&&y!==void 0?y:0}})}})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var n,l;this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((l=this.props.coordinate)===null||l===void 0?void 0:l.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}render(){var{active:n,allowEscapeViewBox:l,animationDuration:u,animationEasing:y,children:b,coordinate:I,hasPayload:o,isAnimationActive:D,offset:k,position:L,reverseDirection:$,useTranslate3d:q,viewBox:Z,wrapperStyle:ie,lastBoundingBox:oe,innerRef:le,hasPortalFromProps:xe}=this.props,{cssClasses:ge,cssProperties:ke}=L8({allowEscapeViewBox:l,coordinate:I,offsetTopLeft:k,position:L,reverseDirection:$,tooltipBox:{height:oe.height,width:oe.width},useTranslate3d:q,viewBox:Z}),et=xe?{}:qv(qv({transition:D&&n?"transform ".concat(u,"ms ").concat(y):void 0},ke),{},{pointerEvents:"none",visibility:!this.state.dismissed&&n&&o?"visible":"hidden",position:"absolute",top:0,left:0}),ze=qv(qv({},et),{},{visibility:!this.state.dismissed&&n&&o?"visible":"hidden"},ie);return Ae.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:ge,style:ze,ref:le},b)}}var B8=()=>!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout),Py={isSsr:B8()},tL=()=>Ln(e=>e.rootProps.accessibilityLayer);function Pc(e){return Number.isFinite(e)}function x0(e){return typeof e=="number"&&e>0&&Number.isFinite(e)}function ES(){return ES=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},ES.apply(null,arguments)}function LM(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function zM(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?LM(Object(l),!0).forEach(function(u){j8(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):LM(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function j8(e,n,l){return(n=U8(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function U8(e){var n=V8(e,"string");return typeof n=="symbol"?n:n+""}function V8(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var FM={curveBasisClosed:TU,curveBasisOpen:EU,curveBasis:SU,curveBumpX:cU,curveBumpY:uU,curveLinearClosed:AU,curveLinear:rx,curveMonotoneX:IU,curveMonotoneY:PU,curveNatural:CU,curveStep:MU,curveStepAfter:DU,curveStepBefore:OU},Wv=e=>Pc(e.x)&&Pc(e.y),W_=e=>e.x,H_=e=>e.y,$8=(e,n)=>{if(typeof e=="function")return e;var l="curve".concat(Ay(e));return(l==="curveMonotone"||l==="curveBump")&&n?FM["".concat(l).concat(n==="vertical"?"Y":"X")]:FM[l]||rx},G8=e=>{var{type:n="linear",points:l=[],baseLine:u,layout:y,connectNulls:b=!1}=e,I=$8(n,y),o=b?l.filter(Wv):l,D;if(Array.isArray(u)){var k=b?u.filter($=>Wv($)):u,L=o.map(($,q)=>zM(zM({},$),{},{base:k[q]}));return y==="vertical"?D=jv().y(H_).x1(W_).x0($=>$.base.x):D=jv().x(W_).y1(H_).y0($=>$.base.y),D.defined(Wv).curve(I),D(L)}return y==="vertical"&&mn(u)?D=jv().y(H_).x1(W_).x0(u):mn(u)?D=jv().x(W_).y1(H_).y0(u):D=Jk().x(W_).y(H_),D.defined(Wv).curve(I),D(o)},q8=e=>{var{className:n,points:l,path:u,pathRef:y}=e;if((!l||!l.length)&&!u)return null;var b=l&&l.length?G8(e):u;return Ae.createElement("path",ES({},$o(e,!1),X5(e),{className:co("recharts-curve",n),d:b===null?void 0:b,ref:y}))},W8=["x","y","top","left","width","height","className"];function AS(){return AS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},AS.apply(null,arguments)}function NM(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function H8(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?NM(Object(l),!0).forEach(function(u){Z8(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):NM(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function Z8(e,n,l){return(n=X8(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function X8(e){var n=Y8(e,"string");return typeof n=="symbol"?n:n+""}function Y8(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function K8(e,n){if(e==null)return{};var l,u,y=J8(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function J8(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}var Q8=(e,n,l,u,y,b)=>"M".concat(e,",").concat(y,"v").concat(u,"M").concat(b,",").concat(n,"h").concat(l),e$=e=>{var{x:n=0,y:l=0,top:u=0,left:y=0,width:b=0,height:I=0,className:o}=e,D=K8(e,W8),k=H8({x:n,y:l,top:u,left:y,width:b,height:I},D);return!mn(n)||!mn(l)||!mn(b)||!mn(I)||!mn(u)||!mn(y)?null:Ae.createElement("path",AS({},$o(k,!0),{className:co("recharts-cross",o),d:Q8(n,l,b,I,u,y)}))};function t$(e,n,l,u){var y=u/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?n.x-y:l.left+.5,y:e==="horizontal"?l.top+.5:n.y-y,width:e==="horizontal"?u:l.width-1,height:e==="horizontal"?l.height-1:u}}function BM(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function r$(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?BM(Object(l),!0).forEach(function(u){n$(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):BM(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function n$(e,n,l){return(n=i$(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function i$(e){var n=o$(e,"string");return typeof n=="symbol"?n:n+""}function o$(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Tp(e,n){var l=r$({},e),u=n,y=Object.keys(n),b=y.reduce((I,o)=>(I[o]===void 0&&u[o]!==void 0&&(I[o]=u[o]),I),l);return b}var lw={},cw={},uw={},jM;function a$(){return jM||(jM=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){if(!l||typeof l!="object")return!1;const u=Object.getPrototypeOf(l);return u===null||u===Object.prototype||Object.getPrototypeOf(u)===null?Object.prototype.toString.call(l)==="[object Object]":!1}e.isPlainObject=n}(uw)),uw}var UM;function s$(){return UM||(UM=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=a$(),l=pR(),u=PT(),y=CT(),b=AT();function I(k,L,$){return o(k,L,void 0,void 0,void 0,void 0,$)}function o(k,L,$,q,Z,ie,oe){const le=oe(k,L,$,q,Z,ie);if(le!==void 0)return le;if(typeof k==typeof L)switch(typeof k){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return k===L;case"number":return k===L||Object.is(k,L);case"function":return k===L;case"object":return D(k,L,ie,oe)}return D(k,L,ie,oe)}function D(k,L,$,q){if(Object.is(k,L))return!0;let Z=u.getTag(k),ie=u.getTag(L);if(Z===y.argumentsTag&&(Z=y.objectTag),ie===y.argumentsTag&&(ie=y.objectTag),Z!==ie)return!1;switch(Z){case y.stringTag:return k.toString()===L.toString();case y.numberTag:{const xe=k.valueOf(),ge=L.valueOf();return b.eq(xe,ge)}case y.booleanTag:case y.dateTag:case y.symbolTag:return Object.is(k.valueOf(),L.valueOf());case y.regexpTag:return k.source===L.source&&k.flags===L.flags;case y.functionTag:return k===L}$=$??new Map;const oe=$.get(k),le=$.get(L);if(oe!=null&&le!=null)return oe===L;$.set(k,L),$.set(L,k);try{switch(Z){case y.mapTag:{if(k.size!==L.size)return!1;for(const[xe,ge]of k.entries())if(!L.has(xe)||!o(ge,L.get(xe),xe,k,L,$,q))return!1;return!0}case y.setTag:{if(k.size!==L.size)return!1;const xe=Array.from(k.values()),ge=Array.from(L.values());for(let ke=0;ke<xe.length;ke++){const et=xe[ke],ze=ge.findIndex(nt=>o(et,nt,void 0,k,L,$,q));if(ze===-1)return!1;ge.splice(ze,1)}return!0}case y.arrayTag:case y.uint8ArrayTag:case y.uint8ClampedArrayTag:case y.uint16ArrayTag:case y.uint32ArrayTag:case y.bigUint64ArrayTag:case y.int8ArrayTag:case y.int16ArrayTag:case y.int32ArrayTag:case y.bigInt64ArrayTag:case y.float32ArrayTag:case y.float64ArrayTag:{if(typeof Buffer<"u"&&Buffer.isBuffer(k)!==Buffer.isBuffer(L)||k.length!==L.length)return!1;for(let xe=0;xe<k.length;xe++)if(!o(k[xe],L[xe],xe,k,L,$,q))return!1;return!0}case y.arrayBufferTag:return k.byteLength!==L.byteLength?!1:D(new Uint8Array(k),new Uint8Array(L),$,q);case y.dataViewTag:return k.byteLength!==L.byteLength||k.byteOffset!==L.byteOffset?!1:D(new Uint8Array(k),new Uint8Array(L),$,q);case y.errorTag:return k.name===L.name&&k.message===L.message;case y.objectTag:{if(!(D(k.constructor,L.constructor,$,q)||n.isPlainObject(k)&&n.isPlainObject(L)))return!1;const ge=[...Object.keys(k),...l.getSymbols(k)],ke=[...Object.keys(L),...l.getSymbols(L)];if(ge.length!==ke.length)return!1;for(let et=0;et<ge.length;et++){const ze=ge[et],nt=k[ze];if(!Object.hasOwn(L,ze))return!1;const pt=L[ze];if(!o(nt,pt,ze,k,L,$,q))return!1}return!0}default:return!1}}finally{$.delete(k),$.delete(L)}}e.isEqualWith=I}(cw)),cw}var hw={},VM;function l$(){return VM||(VM=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(){}e.noop=n}(hw)),hw}var $M;function c$(){return $M||($M=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=s$(),l=l$();function u(y,b){return n.isEqualWith(y,b,l.noop)}e.isEqual=u}(lw)),lw}var dw,GM;function u$(){return GM||(GM=1,dw=c$().isEqual),dw}var h$=u$();const d$=Bs(h$);function f$(e){var n={},l=()=>null,u=!1,y=null,b=I=>{if(!u){if(Array.isArray(I)){if(!I.length)return;var o=I,[D,...k]=o;if(typeof D=="number"){y=e.setTimeout(b.bind(null,k),D);return}b(D),y=e.setTimeout(b.bind(null,k));return}typeof I=="object"&&(n=I,l(n)),typeof I=="function"&&I()}};return{stop:()=>{u=!0},start:I=>{u=!1,y&&(y(),y=null),b(I)},subscribe:I=>(l=I,()=>{l=()=>null}),getTimeoutController:()=>e}}var b0=1e-4,rL=(e,n)=>[0,3*e,3*n-6*e,3*e-3*n+1],nL=(e,n)=>e.map((l,u)=>l*n**u).reduce((l,u)=>l+u),qM=(e,n)=>l=>{var u=rL(e,n);return nL(u,l)},p$=(e,n)=>l=>{var u=rL(e,n),y=[...u.map((b,I)=>b*I).slice(1),0];return nL(y,l)},WM=function(){for(var n,l,u,y,b=arguments.length,I=new Array(b),o=0;o<b;o++)I[o]=arguments[o];if(I.length===1)switch(I[0]){case"linear":[n,u,l,y]=[0,0,1,1];break;case"ease":[n,u,l,y]=[.25,.1,.25,1];break;case"ease-in":[n,u,l,y]=[.42,0,1,1];break;case"ease-out":[n,u,l,y]=[.42,0,.58,1];break;case"ease-in-out":[n,u,l,y]=[0,0,.58,1];break;default:{var D=I[0].split("(");D[0]==="cubic-bezier"&&D[1].split(")")[0].split(",").length===4&&([n,u,l,y]=D[1].split(")")[0].split(",").map(ie=>parseFloat(ie)))}}else I.length===4&&([n,u,l,y]=I);var k=qM(n,l),L=qM(u,y),$=p$(n,l),q=ie=>ie>1?1:ie<0?0:ie,Z=ie=>{for(var oe=ie>1?1:ie,le=oe,xe=0;xe<8;++xe){var ge=k(le)-oe,ke=$(le);if(Math.abs(ge-oe)<b0||ke<b0)return L(le);le=q(le-ge/ke)}return L(le)};return Z.isStepper=!1,Z},m$=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{stiff:l=100,damping:u=8,dt:y=17}=n,b=(I,o,D)=>{var k=-(I-o)*l,L=D*u,$=D+(k-L)*y/1e3,q=D*y/1e3+I;return Math.abs(q-o)<b0&&Math.abs($)<b0?[o,0]:[q,$]};return b.isStepper=!0,b.dt=y,b},g$=e=>{if(typeof e=="string")switch(e){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return WM(e);case"spring":return m$();default:if(e.split("(")[0]==="cubic-bezier")return WM(e)}return typeof e=="function"?e:null};function HM(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function ZM(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?HM(Object(l),!0).forEach(function(u){_$(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):HM(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function _$(e,n,l){return(n=y$(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function y$(e){var n=v$(e,"string");return typeof n=="symbol"?n:n+""}function v$(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var x$=e=>e.replace(/([A-Z])/g,n=>"-".concat(n.toLowerCase())),b$=(e,n,l)=>e.map(u=>"".concat(x$(u)," ").concat(n,"ms ").concat(l)).join(","),w$=(e,n)=>[Object.keys(e),Object.keys(n)].reduce((l,u)=>l.filter(y=>u.includes(y))),uy=(e,n)=>Object.keys(n).reduce((l,u)=>ZM(ZM({},l),{},{[u]:e(u,n[u])}),{});function XM(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function ps(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?XM(Object(l),!0).forEach(function(u){S$(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):XM(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function S$(e,n,l){return(n=T$(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function T$(e){var n=E$(e,"string");return typeof n=="symbol"?n:n+""}function E$(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var w0=(e,n,l)=>e+(n-e)*l,IS=e=>{var{from:n,to:l}=e;return n!==l},iL=(e,n,l)=>{var u=uy((y,b)=>{if(IS(b)){var[I,o]=e(b.from,b.to,b.velocity);return ps(ps({},b),{},{from:I,velocity:o})}return b},n);return l<1?uy((y,b)=>IS(b)?ps(ps({},b),{},{velocity:w0(b.velocity,u[y].velocity,l),from:w0(b.from,u[y].from,l)}):b,n):iL(e,u,l-1)};function A$(e,n,l,u,y,b){var I,o=u.reduce((q,Z)=>ps(ps({},q),{},{[Z]:{from:e[Z],velocity:0,to:n[Z]}}),{}),D=()=>uy((q,Z)=>Z.from,o),k=()=>!Object.values(o).filter(IS).length,L=null,$=q=>{I||(I=q);var Z=q-I,ie=Z/l.dt;o=iL(l,o,ie),y(ps(ps(ps({},e),n),D())),I=q,k()||(L=b.setTimeout($))};return()=>(L=b.setTimeout($),()=>{L()})}function I$(e,n,l,u,y,b,I){var o=null,D=y.reduce(($,q)=>ps(ps({},$),{},{[q]:[e[q],n[q]]}),{}),k,L=$=>{k||(k=$);var q=($-k)/u,Z=uy((oe,le)=>w0(...le,l(q)),D);if(b(ps(ps(ps({},e),n),Z)),q<1)o=I.setTimeout(L);else{var ie=uy((oe,le)=>w0(...le,l(1)),D);b(ps(ps(ps({},e),n),ie))}};return()=>(o=I.setTimeout(L),()=>{o()})}const P$=(e,n,l,u,y,b)=>{var I=w$(e,n);return l.isStepper===!0?A$(e,n,l,I,y,b):I$(e,n,l,u,I,y,b)};class C${setTimeout(n){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,u=performance.now(),y=null,b=I=>{I-u>=l?n(I):typeof requestAnimationFrame=="function"&&(y=requestAnimationFrame(b))};return y=requestAnimationFrame(b),()=>{cancelAnimationFrame(y)}}}var M$=["children","begin","duration","attributeName","easing","isActive","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart","animationManager"];function PS(){return PS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},PS.apply(null,arguments)}function O$(e,n){if(e==null)return{};var l,u,y=D$(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function D$(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}function YM(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function pp(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?YM(Object(l),!0).forEach(function(u){Tm(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):YM(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function Tm(e,n,l){return(n=k$(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function k$(e){var n=R$(e,"string");return typeof n=="symbol"?n:n+""}function R$(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function L$(){return f$(new C$)}class UT extends Ae.PureComponent{constructor(n,l){super(n,l),Tm(this,"mounted",!1),Tm(this,"manager",null),Tm(this,"stopJSAnimation",null),Tm(this,"unSubscribe",null);var{isActive:u,attributeName:y,from:b,to:I,children:o,duration:D,animationManager:k}=this.props;if(this.manager=k,this.handleStyleChange=this.handleStyleChange.bind(this),this.changeStyle=this.changeStyle.bind(this),!u||D<=0){this.state={style:{}},typeof o=="function"&&(this.state={style:I});return}if(b){if(typeof o=="function"){this.state={style:b};return}this.state={style:y?{[y]:b}:b}}else this.state={style:{}}}componentDidMount(){var{isActive:n,canBegin:l}=this.props;this.mounted=!0,!(!n||!l)&&this.runAnimation(this.props)}componentDidUpdate(n){var{isActive:l,canBegin:u,attributeName:y,shouldReAnimate:b,to:I,from:o}=this.props,{style:D}=this.state;if(u){if(!l){var k={style:y?{[y]:I}:I};this.state&&D&&(y&&D[y]!==I||!y&&D!==I)&&this.setState(k);return}if(!(d$(n.to,I)&&n.canBegin&&n.isActive)){var L=!n.canBegin||!n.isActive;this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var $=L||b?o:n.to;if(this.state&&D){var q={style:y?{[y]:$}:$};(y&&D[y]!==$||!y&&D!==$)&&this.setState(q)}this.runAnimation(pp(pp({},this.props),{},{from:$,begin:0}))}}}componentWillUnmount(){this.mounted=!1;var{onAnimationEnd:n}=this.props;this.unSubscribe&&this.unSubscribe(),this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation(),n&&n()}handleStyleChange(n){this.changeStyle(n)}changeStyle(n){this.mounted&&this.setState({style:n})}runJSAnimation(n){var{from:l,to:u,duration:y,easing:b,begin:I,onAnimationEnd:o,onAnimationStart:D}=n,k=P$(l,u,g$(b),y,this.changeStyle,this.manager.getTimeoutController()),L=()=>{this.stopJSAnimation=k()};this.manager.start([D,I,L,y,o])}runAnimation(n){var{begin:l,duration:u,attributeName:y,to:b,easing:I,onAnimationStart:o,onAnimationEnd:D,children:k}=n;if(this.unSubscribe=this.manager.subscribe(this.handleStyleChange),typeof I=="function"||typeof k=="function"||I==="spring"){this.runJSAnimation(n);return}var L=y?{[y]:b}:b,$=b$(Object.keys(L),u,I);this.manager.start([o,l,pp(pp({},L),{},{transition:$}),u,D])}render(){var n=this.props,{children:l,begin:u,duration:y,attributeName:b,easing:I,isActive:o,from:D,to:k,canBegin:L,onAnimationEnd:$,shouldReAnimate:q,onAnimationReStart:Z,animationManager:ie}=n,oe=O$(n,M$),le=Ae.Children.count(l),xe=this.state.style;if(typeof l=="function")return l(xe);if(!o||le===0||y<=0)return l;var ge=ke=>{var{style:et={},className:ze}=ke.props,nt=Ae.cloneElement(ke,pp(pp({},oe),{},{style:pp(pp({},et),xe),className:ze}));return nt};return le===1?ge(Ae.Children.only(l)):Ae.createElement("div",null,Ae.Children.map(l,ke=>ge(ke)))}}Tm(UT,"displayName","Animate");Tm(UT,"defaultProps",{begin:0,duration:1e3,attributeName:"",easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}});var z$=Ae.createContext(null);function kg(e){var n,l,u=Ae.useContext(z$);return Ae.createElement(UT,PS({},e,{animationManager:(n=(l=e.animationManager)!==null&&l!==void 0?l:u)!==null&&n!==void 0?n:L$()}))}function S0(){return S0=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},S0.apply(null,arguments)}var KM=(e,n,l,u,y)=>{var b=Math.min(Math.abs(l)/2,Math.abs(u)/2),I=u>=0?1:-1,o=l>=0?1:-1,D=u>=0&&l>=0||u<0&&l<0?1:0,k;if(b>0&&y instanceof Array){for(var L=[0,0,0,0],$=0,q=4;$<q;$++)L[$]=y[$]>b?b:y[$];k="M".concat(e,",").concat(n+I*L[0]),L[0]>0&&(k+="A ".concat(L[0],",").concat(L[0],",0,0,").concat(D,",").concat(e+o*L[0],",").concat(n)),k+="L ".concat(e+l-o*L[1],",").concat(n),L[1]>0&&(k+="A ".concat(L[1],",").concat(L[1],",0,0,").concat(D,`,
        `).concat(e+l,",").concat(n+I*L[1])),k+="L ".concat(e+l,",").concat(n+u-I*L[2]),L[2]>0&&(k+="A ".concat(L[2],",").concat(L[2],",0,0,").concat(D,`,
        `).concat(e+l-o*L[2],",").concat(n+u)),k+="L ".concat(e+o*L[3],",").concat(n+u),L[3]>0&&(k+="A ".concat(L[3],",").concat(L[3],",0,0,").concat(D,`,
        `).concat(e,",").concat(n+u-I*L[3])),k+="Z"}else if(b>0&&y===+y&&y>0){var Z=Math.min(b,y);k="M ".concat(e,",").concat(n+I*Z,`
            A `).concat(Z,",").concat(Z,",0,0,").concat(D,",").concat(e+o*Z,",").concat(n,`
            L `).concat(e+l-o*Z,",").concat(n,`
            A `).concat(Z,",").concat(Z,",0,0,").concat(D,",").concat(e+l,",").concat(n+I*Z,`
            L `).concat(e+l,",").concat(n+u-I*Z,`
            A `).concat(Z,",").concat(Z,",0,0,").concat(D,",").concat(e+l-o*Z,",").concat(n+u,`
            L `).concat(e+o*Z,",").concat(n+u,`
            A `).concat(Z,",").concat(Z,",0,0,").concat(D,",").concat(e,",").concat(n+u-I*Z," Z")}else k="M ".concat(e,",").concat(n," h ").concat(l," v ").concat(u," h ").concat(-l," Z");return k},F$={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},oL=e=>{var n=Tp(e,F$),l=Ae.useRef(null),[u,y]=Ae.useState(-1);Ae.useEffect(()=>{if(l.current&&l.current.getTotalLength)try{var xe=l.current.getTotalLength();xe&&y(xe)}catch{}},[]);var{x:b,y:I,width:o,height:D,radius:k,className:L}=n,{animationEasing:$,animationDuration:q,animationBegin:Z,isAnimationActive:ie,isUpdateAnimationActive:oe}=n;if(b!==+b||I!==+I||o!==+o||D!==+D||o===0||D===0)return null;var le=co("recharts-rectangle",L);return oe?Ae.createElement(kg,{canBegin:u>0,from:{width:o,height:D,x:b,y:I},to:{width:o,height:D,x:b,y:I},duration:q,animationEasing:$,isActive:oe},xe=>{var{width:ge,height:ke,x:et,y:ze}=xe;return Ae.createElement(kg,{canBegin:u>0,from:"0px ".concat(u===-1?1:u,"px"),to:"".concat(u,"px 0px"),attributeName:"strokeDasharray",begin:Z,duration:q,isActive:ie,easing:$},Ae.createElement("path",S0({},$o(n,!0),{className:le,d:KM(et,ze,ge,ke,k),ref:l})))}):Ae.createElement("path",S0({},$o(n,!0),{className:le,d:KM(b,I,o,D,k)}))};function aL(e){var{cx:n,cy:l,radius:u,startAngle:y,endAngle:b}=e,I=gs(n,l,u,y),o=gs(n,l,u,b);return{points:[I,o],cx:n,cy:l,radius:u,startAngle:y,endAngle:b}}function CS(){return CS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},CS.apply(null,arguments)}var N$=(e,n)=>{var l=$l(n-e),u=Math.min(Math.abs(n-e),359.999);return l*u},Hv=e=>{var{cx:n,cy:l,radius:u,angle:y,sign:b,isExternal:I,cornerRadius:o,cornerIsExternal:D}=e,k=o*(I?1:-1)+u,L=Math.asin(o/k)/v0,$=D?y:y+b*L,q=gs(n,l,k,$),Z=gs(n,l,u,$),ie=D?y-b*L:y,oe=gs(n,l,k*Math.cos(L*v0),ie);return{center:q,circleTangency:Z,lineTangency:oe,theta:L}},sL=e=>{var{cx:n,cy:l,innerRadius:u,outerRadius:y,startAngle:b,endAngle:I}=e,o=N$(b,I),D=b+o,k=gs(n,l,y,b),L=gs(n,l,y,D),$="M ".concat(k.x,",").concat(k.y,`
    A `).concat(y,",").concat(y,`,0,
    `).concat(+(Math.abs(o)>180),",").concat(+(b>D),`,
    `).concat(L.x,",").concat(L.y,`
  `);if(u>0){var q=gs(n,l,u,b),Z=gs(n,l,u,D);$+="L ".concat(Z.x,",").concat(Z.y,`
            A `).concat(u,",").concat(u,`,0,
            `).concat(+(Math.abs(o)>180),",").concat(+(b<=D),`,
            `).concat(q.x,",").concat(q.y," Z")}else $+="L ".concat(n,",").concat(l," Z");return $},B$=e=>{var{cx:n,cy:l,innerRadius:u,outerRadius:y,cornerRadius:b,forceCornerRadius:I,cornerIsExternal:o,startAngle:D,endAngle:k}=e,L=$l(k-D),{circleTangency:$,lineTangency:q,theta:Z}=Hv({cx:n,cy:l,radius:y,angle:D,sign:L,cornerRadius:b,cornerIsExternal:o}),{circleTangency:ie,lineTangency:oe,theta:le}=Hv({cx:n,cy:l,radius:y,angle:k,sign:-L,cornerRadius:b,cornerIsExternal:o}),xe=o?Math.abs(D-k):Math.abs(D-k)-Z-le;if(xe<0)return I?"M ".concat(q.x,",").concat(q.y,`
        a`).concat(b,",").concat(b,",0,0,1,").concat(b*2,`,0
        a`).concat(b,",").concat(b,",0,0,1,").concat(-b*2,`,0
      `):sL({cx:n,cy:l,innerRadius:u,outerRadius:y,startAngle:D,endAngle:k});var ge="M ".concat(q.x,",").concat(q.y,`
    A`).concat(b,",").concat(b,",0,0,").concat(+(L<0),",").concat($.x,",").concat($.y,`
    A`).concat(y,",").concat(y,",0,").concat(+(xe>180),",").concat(+(L<0),",").concat(ie.x,",").concat(ie.y,`
    A`).concat(b,",").concat(b,",0,0,").concat(+(L<0),",").concat(oe.x,",").concat(oe.y,`
  `);if(u>0){var{circleTangency:ke,lineTangency:et,theta:ze}=Hv({cx:n,cy:l,radius:u,angle:D,sign:L,isExternal:!0,cornerRadius:b,cornerIsExternal:o}),{circleTangency:nt,lineTangency:pt,theta:Gt}=Hv({cx:n,cy:l,radius:u,angle:k,sign:-L,isExternal:!0,cornerRadius:b,cornerIsExternal:o}),ir=o?Math.abs(D-k):Math.abs(D-k)-ze-Gt;if(ir<0&&b===0)return"".concat(ge,"L").concat(n,",").concat(l,"Z");ge+="L".concat(pt.x,",").concat(pt.y,`
      A`).concat(b,",").concat(b,",0,0,").concat(+(L<0),",").concat(nt.x,",").concat(nt.y,`
      A`).concat(u,",").concat(u,",0,").concat(+(ir>180),",").concat(+(L>0),",").concat(ke.x,",").concat(ke.y,`
      A`).concat(b,",").concat(b,",0,0,").concat(+(L<0),",").concat(et.x,",").concat(et.y,"Z")}else ge+="L".concat(n,",").concat(l,"Z");return ge},j$={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},lL=e=>{var n=Tp(e,j$),{cx:l,cy:u,innerRadius:y,outerRadius:b,cornerRadius:I,forceCornerRadius:o,cornerIsExternal:D,startAngle:k,endAngle:L,className:$}=n;if(b<y||k===L)return null;var q=co("recharts-sector",$),Z=b-y,ie=sh(I,Z,0,!0),oe;return ie>0&&Math.abs(k-L)<360?oe=B$({cx:l,cy:u,innerRadius:y,outerRadius:b,cornerRadius:Math.min(ie,Z/2),forceCornerRadius:o,cornerIsExternal:D,startAngle:k,endAngle:L}):oe=sL({cx:l,cy:u,innerRadius:y,outerRadius:b,startAngle:k,endAngle:L}),Ae.createElement("path",CS({},$o(n,!0),{className:q,d:oe}))};function U$(e,n,l){var u,y,b,I;if(e==="horizontal")u=n.x,b=u,y=l.top,I=l.top+l.height;else if(e==="vertical")y=n.y,I=y,u=l.left,b=l.left+l.width;else if(n.cx!=null&&n.cy!=null)if(e==="centric"){var{cx:o,cy:D,innerRadius:k,outerRadius:L,angle:$}=n,q=gs(o,D,k,$),Z=gs(o,D,L,$);u=q.x,y=q.y,b=Z.x,I=Z.y}else return aL(n);return[{x:u,y},{x:b,y:I}]}var fw={},pw={},mw={},JM;function V$(){return JM||(JM=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=yR();function l(u){return n.isSymbol(u)?NaN:Number(u)}e.toNumber=l}(mw)),mw}var QM;function $$(){return QM||(QM=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=V$();function l(u){return u?(u=n.toNumber(u),u===1/0||u===-1/0?(u<0?-1:1)*Number.MAX_VALUE:u===u?u:0):u===0?u:0}e.toFinite=l}(pw)),pw}var eO;function G$(){return eO||(eO=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=vR(),l=$$();function u(y,b,I){I&&typeof I!="number"&&n.isIterateeCall(y,b,I)&&(b=I=void 0),y=l.toFinite(y),b===void 0?(b=y,y=0):b=l.toFinite(b),I=I===void 0?y<b?1:-1:l.toFinite(I);const o=Math.max(Math.ceil((b-y)/(I||1)),0),D=new Array(o);for(let k=0;k<o;k++)D[k]=y,y+=I;return D}e.range=u}(fw)),fw}var gw,tO;function q$(){return tO||(tO=1,gw=G$().range),gw}var W$=q$();const cL=Bs(W$);function vp(e,n){return e==null||n==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function H$(e,n){return e==null||n==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function uL(e){let n,l,u;e.length!==2?(n=vp,l=(o,D)=>vp(e(o),D),u=(o,D)=>e(o)-D):(n=e===vp||e===H$?e:Z$,l=e,u=e);function y(o,D,k=0,L=o.length){if(k<L){if(n(D,D)!==0)return L;do{const $=k+L>>>1;l(o[$],D)<0?k=$+1:L=$}while(k<L)}return k}function b(o,D,k=0,L=o.length){if(k<L){if(n(D,D)!==0)return L;do{const $=k+L>>>1;l(o[$],D)<=0?k=$+1:L=$}while(k<L)}return k}function I(o,D,k=0,L=o.length){const $=y(o,D,k,L-1);return $>k&&u(o[$-1],D)>-u(o[$],D)?$-1:$}return{left:y,center:I,right:b}}function Z$(){return 0}function hL(e){return e===null?NaN:+e}function*X$(e,n){for(let l of e)l!=null&&(l=+l)>=l&&(yield l)}const Y$=uL(vp),Cy=Y$.right;uL(hL).center;class rO extends Map{constructor(n,l=Q$){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:l}}),n!=null)for(const[u,y]of n)this.set(u,y)}get(n){return super.get(nO(this,n))}has(n){return super.has(nO(this,n))}set(n,l){return super.set(K$(this,n),l)}delete(n){return super.delete(J$(this,n))}}function nO({_intern:e,_key:n},l){const u=n(l);return e.has(u)?e.get(u):l}function K$({_intern:e,_key:n},l){const u=n(l);return e.has(u)?e.get(u):(e.set(u,l),l)}function J$({_intern:e,_key:n},l){const u=n(l);return e.has(u)&&(l=e.get(u),e.delete(u)),l}function Q$(e){return e!==null&&typeof e=="object"?e.valueOf():e}function eG(e=vp){if(e===vp)return dL;if(typeof e!="function")throw new TypeError("compare is not a function");return(n,l)=>{const u=e(n,l);return u||u===0?u:(e(l,l)===0)-(e(n,n)===0)}}function dL(e,n){return(e==null||!(e>=e))-(n==null||!(n>=n))||(e<n?-1:e>n?1:0)}const tG=Math.sqrt(50),rG=Math.sqrt(10),nG=Math.sqrt(2);function T0(e,n,l){const u=(n-e)/Math.max(0,l),y=Math.floor(Math.log10(u)),b=u/Math.pow(10,y),I=b>=tG?10:b>=rG?5:b>=nG?2:1;let o,D,k;return y<0?(k=Math.pow(10,-y)/I,o=Math.round(e*k),D=Math.round(n*k),o/k<e&&++o,D/k>n&&--D,k=-k):(k=Math.pow(10,y)*I,o=Math.round(e/k),D=Math.round(n/k),o*k<e&&++o,D*k>n&&--D),D<o&&.5<=l&&l<2?T0(e,n,l*2):[o,D,k]}function MS(e,n,l){if(n=+n,e=+e,l=+l,!(l>0))return[];if(e===n)return[e];const u=n<e,[y,b,I]=u?T0(n,e,l):T0(e,n,l);if(!(b>=y))return[];const o=b-y+1,D=new Array(o);if(u)if(I<0)for(let k=0;k<o;++k)D[k]=(b-k)/-I;else for(let k=0;k<o;++k)D[k]=(b-k)*I;else if(I<0)for(let k=0;k<o;++k)D[k]=(y+k)/-I;else for(let k=0;k<o;++k)D[k]=(y+k)*I;return D}function OS(e,n,l){return n=+n,e=+e,l=+l,T0(e,n,l)[2]}function iG(e,n,l){n=+n,e=+e,l=+l;const u=n<e,y=u?OS(n,e,l):OS(e,n,l);return(u?-1:1)*(y<0?1/-y:y)}function iO(e,n){let l;for(const u of e)u!=null&&(l<u||l===void 0&&u>=u)&&(l=u);return l}function oO(e,n){let l;for(const u of e)u!=null&&(l>u||l===void 0&&u>=u)&&(l=u);return l}function fL(e,n,l=0,u=1/0,y){if(n=Math.floor(n),l=Math.floor(Math.max(0,l)),u=Math.floor(Math.min(e.length-1,u)),!(l<=n&&n<=u))return e;for(y=y===void 0?dL:eG(y);u>l;){if(u-l>600){const D=u-l+1,k=n-l+1,L=Math.log(D),$=.5*Math.exp(2*L/3),q=.5*Math.sqrt(L*$*(D-$)/D)*(k-D/2<0?-1:1),Z=Math.max(l,Math.floor(n-k*$/D+q)),ie=Math.min(u,Math.floor(n+(D-k)*$/D+q));fL(e,n,Z,ie,y)}const b=e[n];let I=l,o=u;for(Z_(e,l,n),y(e[u],b)>0&&Z_(e,l,u);I<o;){for(Z_(e,I,o),++I,--o;y(e[I],b)<0;)++I;for(;y(e[o],b)>0;)--o}y(e[l],b)===0?Z_(e,l,o):(++o,Z_(e,o,u)),o<=n&&(l=o+1),n<=o&&(u=o-1)}return e}function Z_(e,n,l){const u=e[n];e[n]=e[l],e[l]=u}function oG(e,n,l){if(e=Float64Array.from(X$(e)),!(!(u=e.length)||isNaN(n=+n))){if(n<=0||u<2)return oO(e);if(n>=1)return iO(e);var u,y=(u-1)*n,b=Math.floor(y),I=iO(fL(e,b).subarray(0,b+1)),o=oO(e.subarray(b+1));return I+(o-I)*(y-b)}}function aG(e,n,l=hL){if(!(!(u=e.length)||isNaN(n=+n))){if(n<=0||u<2)return+l(e[0],0,e);if(n>=1)return+l(e[u-1],u-1,e);var u,y=(u-1)*n,b=Math.floor(y),I=+l(e[b],b,e),o=+l(e[b+1],b+1,e);return I+(o-I)*(y-b)}}function sG(e,n,l){e=+e,n=+n,l=(y=arguments.length)<2?(n=e,e=0,1):y<3?1:+l;for(var u=-1,y=Math.max(0,Math.ceil((n-e)/l))|0,b=new Array(y);++u<y;)b[u]=e+u*l;return b}function gu(e,n){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(n).domain(e);break}return this}function mf(e,n){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof n=="function"?this.interpolator(n):this.range(n);break}}return this}const DS=Symbol("implicit");function VT(){var e=new rO,n=[],l=[],u=DS;function y(b){let I=e.get(b);if(I===void 0){if(u!==DS)return u;e.set(b,I=n.push(b)-1)}return l[I%l.length]}return y.domain=function(b){if(!arguments.length)return n.slice();n=[],e=new rO;for(const I of b)e.has(I)||e.set(I,n.push(I)-1);return y},y.range=function(b){return arguments.length?(l=Array.from(b),y):l.slice()},y.unknown=function(b){return arguments.length?(u=b,y):u},y.copy=function(){return VT(n,l).unknown(u)},gu.apply(y,arguments),y}function $T(){var e=VT().unknown(void 0),n=e.domain,l=e.range,u=0,y=1,b,I,o=!1,D=0,k=0,L=.5;delete e.unknown;function $(){var q=n().length,Z=y<u,ie=Z?y:u,oe=Z?u:y;b=(oe-ie)/Math.max(1,q-D+k*2),o&&(b=Math.floor(b)),ie+=(oe-ie-b*(q-D))*L,I=b*(1-D),o&&(ie=Math.round(ie),I=Math.round(I));var le=sG(q).map(function(xe){return ie+b*xe});return l(Z?le.reverse():le)}return e.domain=function(q){return arguments.length?(n(q),$()):n()},e.range=function(q){return arguments.length?([u,y]=q,u=+u,y=+y,$()):[u,y]},e.rangeRound=function(q){return[u,y]=q,u=+u,y=+y,o=!0,$()},e.bandwidth=function(){return I},e.step=function(){return b},e.round=function(q){return arguments.length?(o=!!q,$()):o},e.padding=function(q){return arguments.length?(D=Math.min(1,k=+q),$()):D},e.paddingInner=function(q){return arguments.length?(D=Math.min(1,q),$()):D},e.paddingOuter=function(q){return arguments.length?(k=+q,$()):k},e.align=function(q){return arguments.length?(L=Math.max(0,Math.min(1,q)),$()):L},e.copy=function(){return $T(n(),[u,y]).round(o).paddingInner(D).paddingOuter(k).align(L)},gu.apply($(),arguments)}function pL(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return pL(n())},e}function lG(){return pL($T.apply(null,arguments).paddingInner(1))}function GT(e,n,l){e.prototype=n.prototype=l,l.constructor=e}function mL(e,n){var l=Object.create(e.prototype);for(var u in n)l[u]=n[u];return l}function My(){}var hy=.7,E0=1/hy,Pg="\\s*([+-]?\\d+)\\s*",dy="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ad="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",cG=/^#([0-9a-f]{3,8})$/,uG=new RegExp(`^rgb\\(${Pg},${Pg},${Pg}\\)$`),hG=new RegExp(`^rgb\\(${ad},${ad},${ad}\\)$`),dG=new RegExp(`^rgba\\(${Pg},${Pg},${Pg},${dy}\\)$`),fG=new RegExp(`^rgba\\(${ad},${ad},${ad},${dy}\\)$`),pG=new RegExp(`^hsl\\(${dy},${ad},${ad}\\)$`),mG=new RegExp(`^hsla\\(${dy},${ad},${ad},${dy}\\)$`),aO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};GT(My,fy,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:sO,formatHex:sO,formatHex8:gG,formatHsl:_G,formatRgb:lO,toString:lO});function sO(){return this.rgb().formatHex()}function gG(){return this.rgb().formatHex8()}function _G(){return gL(this).formatHsl()}function lO(){return this.rgb().formatRgb()}function fy(e){var n,l;return e=(e+"").trim().toLowerCase(),(n=cG.exec(e))?(l=n[1].length,n=parseInt(n[1],16),l===6?cO(n):l===3?new Gl(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):l===8?Zv(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):l===4?Zv(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=uG.exec(e))?new Gl(n[1],n[2],n[3],1):(n=hG.exec(e))?new Gl(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=dG.exec(e))?Zv(n[1],n[2],n[3],n[4]):(n=fG.exec(e))?Zv(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=pG.exec(e))?dO(n[1],n[2]/100,n[3]/100,1):(n=mG.exec(e))?dO(n[1],n[2]/100,n[3]/100,n[4]):aO.hasOwnProperty(e)?cO(aO[e]):e==="transparent"?new Gl(NaN,NaN,NaN,0):null}function cO(e){return new Gl(e>>16&255,e>>8&255,e&255,1)}function Zv(e,n,l,u){return u<=0&&(e=n=l=NaN),new Gl(e,n,l,u)}function yG(e){return e instanceof My||(e=fy(e)),e?(e=e.rgb(),new Gl(e.r,e.g,e.b,e.opacity)):new Gl}function kS(e,n,l,u){return arguments.length===1?yG(e):new Gl(e,n,l,u??1)}function Gl(e,n,l,u){this.r=+e,this.g=+n,this.b=+l,this.opacity=+u}GT(Gl,kS,mL(My,{brighter(e){return e=e==null?E0:Math.pow(E0,e),new Gl(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?hy:Math.pow(hy,e),new Gl(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Gl(Om(this.r),Om(this.g),Om(this.b),A0(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:uO,formatHex:uO,formatHex8:vG,formatRgb:hO,toString:hO}));function uO(){return`#${Em(this.r)}${Em(this.g)}${Em(this.b)}`}function vG(){return`#${Em(this.r)}${Em(this.g)}${Em(this.b)}${Em((isNaN(this.opacity)?1:this.opacity)*255)}`}function hO(){const e=A0(this.opacity);return`${e===1?"rgb(":"rgba("}${Om(this.r)}, ${Om(this.g)}, ${Om(this.b)}${e===1?")":`, ${e})`}`}function A0(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Om(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Em(e){return e=Om(e),(e<16?"0":"")+e.toString(16)}function dO(e,n,l,u){return u<=0?e=n=l=NaN:l<=0||l>=1?e=n=NaN:n<=0&&(e=NaN),new nh(e,n,l,u)}function gL(e){if(e instanceof nh)return new nh(e.h,e.s,e.l,e.opacity);if(e instanceof My||(e=fy(e)),!e)return new nh;if(e instanceof nh)return e;e=e.rgb();var n=e.r/255,l=e.g/255,u=e.b/255,y=Math.min(n,l,u),b=Math.max(n,l,u),I=NaN,o=b-y,D=(b+y)/2;return o?(n===b?I=(l-u)/o+(l<u)*6:l===b?I=(u-n)/o+2:I=(n-l)/o+4,o/=D<.5?b+y:2-b-y,I*=60):o=D>0&&D<1?0:I,new nh(I,o,D,e.opacity)}function xG(e,n,l,u){return arguments.length===1?gL(e):new nh(e,n,l,u??1)}function nh(e,n,l,u){this.h=+e,this.s=+n,this.l=+l,this.opacity=+u}GT(nh,xG,mL(My,{brighter(e){return e=e==null?E0:Math.pow(E0,e),new nh(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?hy:Math.pow(hy,e),new nh(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,n=isNaN(e)||isNaN(this.s)?0:this.s,l=this.l,u=l+(l<.5?l:1-l)*n,y=2*l-u;return new Gl(_w(e>=240?e-240:e+120,y,u),_w(e,y,u),_w(e<120?e+240:e-120,y,u),this.opacity)},clamp(){return new nh(fO(this.h),Xv(this.s),Xv(this.l),A0(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=A0(this.opacity);return`${e===1?"hsl(":"hsla("}${fO(this.h)}, ${Xv(this.s)*100}%, ${Xv(this.l)*100}%${e===1?")":`, ${e})`}`}}));function fO(e){return e=(e||0)%360,e<0?e+360:e}function Xv(e){return Math.max(0,Math.min(1,e||0))}function _w(e,n,l){return(e<60?n+(l-n)*e/60:e<180?l:e<240?n+(l-n)*(240-e)/60:n)*255}const qT=e=>()=>e;function bG(e,n){return function(l){return e+l*n}}function wG(e,n,l){return e=Math.pow(e,l),n=Math.pow(n,l)-e,l=1/l,function(u){return Math.pow(e+u*n,l)}}function SG(e){return(e=+e)==1?_L:function(n,l){return l-n?wG(n,l,e):qT(isNaN(n)?l:n)}}function _L(e,n){var l=n-e;return l?bG(e,l):qT(isNaN(e)?n:e)}const pO=function e(n){var l=SG(n);function u(y,b){var I=l((y=kS(y)).r,(b=kS(b)).r),o=l(y.g,b.g),D=l(y.b,b.b),k=_L(y.opacity,b.opacity);return function(L){return y.r=I(L),y.g=o(L),y.b=D(L),y.opacity=k(L),y+""}}return u.gamma=e,u}(1);function TG(e,n){n||(n=[]);var l=e?Math.min(n.length,e.length):0,u=n.slice(),y;return function(b){for(y=0;y<l;++y)u[y]=e[y]*(1-b)+n[y]*b;return u}}function EG(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function AG(e,n){var l=n?n.length:0,u=e?Math.min(l,e.length):0,y=new Array(u),b=new Array(l),I;for(I=0;I<u;++I)y[I]=$g(e[I],n[I]);for(;I<l;++I)b[I]=n[I];return function(o){for(I=0;I<u;++I)b[I]=y[I](o);return b}}function IG(e,n){var l=new Date;return e=+e,n=+n,function(u){return l.setTime(e*(1-u)+n*u),l}}function I0(e,n){return e=+e,n=+n,function(l){return e*(1-l)+n*l}}function PG(e,n){var l={},u={},y;(e===null||typeof e!="object")&&(e={}),(n===null||typeof n!="object")&&(n={});for(y in n)y in e?l[y]=$g(e[y],n[y]):u[y]=n[y];return function(b){for(y in l)u[y]=l[y](b);return u}}var RS=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,yw=new RegExp(RS.source,"g");function CG(e){return function(){return e}}function MG(e){return function(n){return e(n)+""}}function OG(e,n){var l=RS.lastIndex=yw.lastIndex=0,u,y,b,I=-1,o=[],D=[];for(e=e+"",n=n+"";(u=RS.exec(e))&&(y=yw.exec(n));)(b=y.index)>l&&(b=n.slice(l,b),o[I]?o[I]+=b:o[++I]=b),(u=u[0])===(y=y[0])?o[I]?o[I]+=y:o[++I]=y:(o[++I]=null,D.push({i:I,x:I0(u,y)})),l=yw.lastIndex;return l<n.length&&(b=n.slice(l),o[I]?o[I]+=b:o[++I]=b),o.length<2?D[0]?MG(D[0].x):CG(n):(n=D.length,function(k){for(var L=0,$;L<n;++L)o[($=D[L]).i]=$.x(k);return o.join("")})}function $g(e,n){var l=typeof n,u;return n==null||l==="boolean"?qT(n):(l==="number"?I0:l==="string"?(u=fy(n))?(n=u,pO):OG:n instanceof fy?pO:n instanceof Date?IG:EG(n)?TG:Array.isArray(n)?AG:typeof n.valueOf!="function"&&typeof n.toString!="function"||isNaN(n)?PG:I0)(e,n)}function WT(e,n){return e=+e,n=+n,function(l){return Math.round(e*(1-l)+n*l)}}function DG(e,n){n===void 0&&(n=e,e=$g);for(var l=0,u=n.length-1,y=n[0],b=new Array(u<0?0:u);l<u;)b[l]=e(y,y=n[++l]);return function(I){var o=Math.max(0,Math.min(u-1,Math.floor(I*=u)));return b[o](I-o)}}function kG(e){return function(){return e}}function P0(e){return+e}var mO=[0,1];function nl(e){return e}function LS(e,n){return(n-=e=+e)?function(l){return(l-e)/n}:kG(isNaN(n)?NaN:.5)}function RG(e,n){var l;return e>n&&(l=e,e=n,n=l),function(u){return Math.max(e,Math.min(n,u))}}function LG(e,n,l){var u=e[0],y=e[1],b=n[0],I=n[1];return y<u?(u=LS(y,u),b=l(I,b)):(u=LS(u,y),b=l(b,I)),function(o){return b(u(o))}}function zG(e,n,l){var u=Math.min(e.length,n.length)-1,y=new Array(u),b=new Array(u),I=-1;for(e[u]<e[0]&&(e=e.slice().reverse(),n=n.slice().reverse());++I<u;)y[I]=LS(e[I],e[I+1]),b[I]=l(n[I],n[I+1]);return function(o){var D=Cy(e,o,1,u)-1;return b[D](y[D](o))}}function Oy(e,n){return n.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function px(){var e=mO,n=mO,l=$g,u,y,b,I=nl,o,D,k;function L(){var q=Math.min(e.length,n.length);return I!==nl&&(I=RG(e[0],e[q-1])),o=q>2?zG:LG,D=k=null,$}function $(q){return q==null||isNaN(q=+q)?b:(D||(D=o(e.map(u),n,l)))(u(I(q)))}return $.invert=function(q){return I(y((k||(k=o(n,e.map(u),I0)))(q)))},$.domain=function(q){return arguments.length?(e=Array.from(q,P0),L()):e.slice()},$.range=function(q){return arguments.length?(n=Array.from(q),L()):n.slice()},$.rangeRound=function(q){return n=Array.from(q),l=WT,L()},$.clamp=function(q){return arguments.length?(I=q?!0:nl,L()):I!==nl},$.interpolate=function(q){return arguments.length?(l=q,L()):l},$.unknown=function(q){return arguments.length?(b=q,$):b},function(q,Z){return u=q,y=Z,L()}}function HT(){return px()(nl,nl)}function FG(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function C0(e,n){if((l=(e=n?e.toExponential(n-1):e.toExponential()).indexOf("e"))<0)return null;var l,u=e.slice(0,l);return[u.length>1?u[0]+u.slice(2):u,+e.slice(l+1)]}function Rg(e){return e=C0(Math.abs(e)),e?e[1]:NaN}function NG(e,n){return function(l,u){for(var y=l.length,b=[],I=0,o=e[0],D=0;y>0&&o>0&&(D+o+1>u&&(o=Math.max(1,u-D)),b.push(l.substring(y-=o,y+o)),!((D+=o+1)>u));)o=e[I=(I+1)%e.length];return b.reverse().join(n)}}function BG(e){return function(n){return n.replace(/[0-9]/g,function(l){return e[+l]})}}var jG=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function py(e){if(!(n=jG.exec(e)))throw new Error("invalid format: "+e);var n;return new ZT({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}py.prototype=ZT.prototype;function ZT(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}ZT.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function UG(e){e:for(var n=e.length,l=1,u=-1,y;l<n;++l)switch(e[l]){case".":u=y=l;break;case"0":u===0&&(u=l),y=l;break;default:if(!+e[l])break e;u>0&&(u=0);break}return u>0?e.slice(0,u)+e.slice(y+1):e}var yL;function VG(e,n){var l=C0(e,n);if(!l)return e+"";var u=l[0],y=l[1],b=y-(yL=Math.max(-8,Math.min(8,Math.floor(y/3)))*3)+1,I=u.length;return b===I?u:b>I?u+new Array(b-I+1).join("0"):b>0?u.slice(0,b)+"."+u.slice(b):"0."+new Array(1-b).join("0")+C0(e,Math.max(0,n+b-1))[0]}function gO(e,n){var l=C0(e,n);if(!l)return e+"";var u=l[0],y=l[1];return y<0?"0."+new Array(-y).join("0")+u:u.length>y+1?u.slice(0,y+1)+"."+u.slice(y+1):u+new Array(y-u.length+2).join("0")}const _O={"%":(e,n)=>(e*100).toFixed(n),b:e=>Math.round(e).toString(2),c:e=>e+"",d:FG,e:(e,n)=>e.toExponential(n),f:(e,n)=>e.toFixed(n),g:(e,n)=>e.toPrecision(n),o:e=>Math.round(e).toString(8),p:(e,n)=>gO(e*100,n),r:gO,s:VG,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function yO(e){return e}var vO=Array.prototype.map,xO=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function $G(e){var n=e.grouping===void 0||e.thousands===void 0?yO:NG(vO.call(e.grouping,Number),e.thousands+""),l=e.currency===void 0?"":e.currency[0]+"",u=e.currency===void 0?"":e.currency[1]+"",y=e.decimal===void 0?".":e.decimal+"",b=e.numerals===void 0?yO:BG(vO.call(e.numerals,String)),I=e.percent===void 0?"%":e.percent+"",o=e.minus===void 0?"":e.minus+"",D=e.nan===void 0?"NaN":e.nan+"";function k($){$=py($);var q=$.fill,Z=$.align,ie=$.sign,oe=$.symbol,le=$.zero,xe=$.width,ge=$.comma,ke=$.precision,et=$.trim,ze=$.type;ze==="n"?(ge=!0,ze="g"):_O[ze]||(ke===void 0&&(ke=12),et=!0,ze="g"),(le||q==="0"&&Z==="=")&&(le=!0,q="0",Z="=");var nt=oe==="$"?l:oe==="#"&&/[boxX]/.test(ze)?"0"+ze.toLowerCase():"",pt=oe==="$"?u:/[%p]/.test(ze)?I:"",Gt=_O[ze],ir=/[defgprs%]/.test(ze);ke=ke===void 0?6:/[gprs]/.test(ze)?Math.max(1,Math.min(21,ke)):Math.max(0,Math.min(20,ke));function Br(Zt){var dr=nt,Dr=pt,vr,Ar,zr;if(ze==="c")Dr=Gt(Zt)+Dr,Zt="";else{Zt=+Zt;var qr=Zt<0||1/Zt<0;if(Zt=isNaN(Zt)?D:Gt(Math.abs(Zt),ke),et&&(Zt=UG(Zt)),qr&&+Zt==0&&ie!=="+"&&(qr=!1),dr=(qr?ie==="("?ie:o:ie==="-"||ie==="("?"":ie)+dr,Dr=(ze==="s"?xO[8+yL/3]:"")+Dr+(qr&&ie==="("?")":""),ir){for(vr=-1,Ar=Zt.length;++vr<Ar;)if(zr=Zt.charCodeAt(vr),48>zr||zr>57){Dr=(zr===46?y+Zt.slice(vr+1):Zt.slice(vr))+Dr,Zt=Zt.slice(0,vr);break}}}ge&&!le&&(Zt=n(Zt,1/0));var lr=dr.length+Zt.length+Dr.length,br=lr<xe?new Array(xe-lr+1).join(q):"";switch(ge&&le&&(Zt=n(br+Zt,br.length?xe-Dr.length:1/0),br=""),Z){case"<":Zt=dr+Zt+Dr+br;break;case"=":Zt=dr+br+Zt+Dr;break;case"^":Zt=br.slice(0,lr=br.length>>1)+dr+Zt+Dr+br.slice(lr);break;default:Zt=br+dr+Zt+Dr;break}return b(Zt)}return Br.toString=function(){return $+""},Br}function L($,q){var Z=k(($=py($),$.type="f",$)),ie=Math.max(-8,Math.min(8,Math.floor(Rg(q)/3)))*3,oe=Math.pow(10,-ie),le=xO[8+ie/3];return function(xe){return Z(oe*xe)+le}}return{format:k,formatPrefix:L}}var Yv,XT,vL;GG({thousands:",",grouping:[3],currency:["$",""]});function GG(e){return Yv=$G(e),XT=Yv.format,vL=Yv.formatPrefix,Yv}function qG(e){return Math.max(0,-Rg(Math.abs(e)))}function WG(e,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Rg(n)/3)))*3-Rg(Math.abs(e)))}function HG(e,n){return e=Math.abs(e),n=Math.abs(n)-e,Math.max(0,Rg(n)-Rg(e))+1}function xL(e,n,l,u){var y=iG(e,n,l),b;switch(u=py(u??",f"),u.type){case"s":{var I=Math.max(Math.abs(e),Math.abs(n));return u.precision==null&&!isNaN(b=WG(y,I))&&(u.precision=b),vL(u,I)}case"":case"e":case"g":case"p":case"r":{u.precision==null&&!isNaN(b=HG(y,Math.max(Math.abs(e),Math.abs(n))))&&(u.precision=b-(u.type==="e"));break}case"f":case"%":{u.precision==null&&!isNaN(b=qG(y))&&(u.precision=b-(u.type==="%")*2);break}}return XT(u)}function Ep(e){var n=e.domain;return e.ticks=function(l){var u=n();return MS(u[0],u[u.length-1],l??10)},e.tickFormat=function(l,u){var y=n();return xL(y[0],y[y.length-1],l??10,u)},e.nice=function(l){l==null&&(l=10);var u=n(),y=0,b=u.length-1,I=u[y],o=u[b],D,k,L=10;for(o<I&&(k=I,I=o,o=k,k=y,y=b,b=k);L-- >0;){if(k=OS(I,o,l),k===D)return u[y]=I,u[b]=o,n(u);if(k>0)I=Math.floor(I/k)*k,o=Math.ceil(o/k)*k;else if(k<0)I=Math.ceil(I*k)/k,o=Math.floor(o*k)/k;else break;D=k}return e},e}function bL(){var e=HT();return e.copy=function(){return Oy(e,bL())},gu.apply(e,arguments),Ep(e)}function wL(e){var n;function l(u){return u==null||isNaN(u=+u)?n:u}return l.invert=l,l.domain=l.range=function(u){return arguments.length?(e=Array.from(u,P0),l):e.slice()},l.unknown=function(u){return arguments.length?(n=u,l):n},l.copy=function(){return wL(e).unknown(n)},e=arguments.length?Array.from(e,P0):[0,1],Ep(l)}function SL(e,n){e=e.slice();var l=0,u=e.length-1,y=e[l],b=e[u],I;return b<y&&(I=l,l=u,u=I,I=y,y=b,b=I),e[l]=n.floor(y),e[u]=n.ceil(b),e}function bO(e){return Math.log(e)}function wO(e){return Math.exp(e)}function ZG(e){return-Math.log(-e)}function XG(e){return-Math.exp(-e)}function YG(e){return isFinite(e)?+("1e"+e):e<0?0:e}function KG(e){return e===10?YG:e===Math.E?Math.exp:n=>Math.pow(e,n)}function JG(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),n=>Math.log(n)/e)}function SO(e){return(n,l)=>-e(-n,l)}function YT(e){const n=e(bO,wO),l=n.domain;let u=10,y,b;function I(){return y=JG(u),b=KG(u),l()[0]<0?(y=SO(y),b=SO(b),e(ZG,XG)):e(bO,wO),n}return n.base=function(o){return arguments.length?(u=+o,I()):u},n.domain=function(o){return arguments.length?(l(o),I()):l()},n.ticks=o=>{const D=l();let k=D[0],L=D[D.length-1];const $=L<k;$&&([k,L]=[L,k]);let q=y(k),Z=y(L),ie,oe;const le=o==null?10:+o;let xe=[];if(!(u%1)&&Z-q<le){if(q=Math.floor(q),Z=Math.ceil(Z),k>0){for(;q<=Z;++q)for(ie=1;ie<u;++ie)if(oe=q<0?ie/b(-q):ie*b(q),!(oe<k)){if(oe>L)break;xe.push(oe)}}else for(;q<=Z;++q)for(ie=u-1;ie>=1;--ie)if(oe=q>0?ie/b(-q):ie*b(q),!(oe<k)){if(oe>L)break;xe.push(oe)}xe.length*2<le&&(xe=MS(k,L,le))}else xe=MS(q,Z,Math.min(Z-q,le)).map(b);return $?xe.reverse():xe},n.tickFormat=(o,D)=>{if(o==null&&(o=10),D==null&&(D=u===10?"s":","),typeof D!="function"&&(!(u%1)&&(D=py(D)).precision==null&&(D.trim=!0),D=XT(D)),o===1/0)return D;const k=Math.max(1,u*o/n.ticks().length);return L=>{let $=L/b(Math.round(y(L)));return $*u<u-.5&&($*=u),$<=k?D(L):""}},n.nice=()=>l(SL(l(),{floor:o=>b(Math.floor(y(o))),ceil:o=>b(Math.ceil(y(o)))})),n}function TL(){const e=YT(px()).domain([1,10]);return e.copy=()=>Oy(e,TL()).base(e.base()),gu.apply(e,arguments),e}function TO(e){return function(n){return Math.sign(n)*Math.log1p(Math.abs(n/e))}}function EO(e){return function(n){return Math.sign(n)*Math.expm1(Math.abs(n))*e}}function KT(e){var n=1,l=e(TO(n),EO(n));return l.constant=function(u){return arguments.length?e(TO(n=+u),EO(n)):n},Ep(l)}function EL(){var e=KT(px());return e.copy=function(){return Oy(e,EL()).constant(e.constant())},gu.apply(e,arguments)}function AO(e){return function(n){return n<0?-Math.pow(-n,e):Math.pow(n,e)}}function QG(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function eq(e){return e<0?-e*e:e*e}function JT(e){var n=e(nl,nl),l=1;function u(){return l===1?e(nl,nl):l===.5?e(QG,eq):e(AO(l),AO(1/l))}return n.exponent=function(y){return arguments.length?(l=+y,u()):l},Ep(n)}function QT(){var e=JT(px());return e.copy=function(){return Oy(e,QT()).exponent(e.exponent())},gu.apply(e,arguments),e}function tq(){return QT.apply(null,arguments).exponent(.5)}function IO(e){return Math.sign(e)*e*e}function rq(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function AL(){var e=HT(),n=[0,1],l=!1,u;function y(b){var I=rq(e(b));return isNaN(I)?u:l?Math.round(I):I}return y.invert=function(b){return e.invert(IO(b))},y.domain=function(b){return arguments.length?(e.domain(b),y):e.domain()},y.range=function(b){return arguments.length?(e.range((n=Array.from(b,P0)).map(IO)),y):n.slice()},y.rangeRound=function(b){return y.range(b).round(!0)},y.round=function(b){return arguments.length?(l=!!b,y):l},y.clamp=function(b){return arguments.length?(e.clamp(b),y):e.clamp()},y.unknown=function(b){return arguments.length?(u=b,y):u},y.copy=function(){return AL(e.domain(),n).round(l).clamp(e.clamp()).unknown(u)},gu.apply(y,arguments),Ep(y)}function IL(){var e=[],n=[],l=[],u;function y(){var I=0,o=Math.max(1,n.length);for(l=new Array(o-1);++I<o;)l[I-1]=aG(e,I/o);return b}function b(I){return I==null||isNaN(I=+I)?u:n[Cy(l,I)]}return b.invertExtent=function(I){var o=n.indexOf(I);return o<0?[NaN,NaN]:[o>0?l[o-1]:e[0],o<l.length?l[o]:e[e.length-1]]},b.domain=function(I){if(!arguments.length)return e.slice();e=[];for(let o of I)o!=null&&!isNaN(o=+o)&&e.push(o);return e.sort(vp),y()},b.range=function(I){return arguments.length?(n=Array.from(I),y()):n.slice()},b.unknown=function(I){return arguments.length?(u=I,b):u},b.quantiles=function(){return l.slice()},b.copy=function(){return IL().domain(e).range(n).unknown(u)},gu.apply(b,arguments)}function PL(){var e=0,n=1,l=1,u=[.5],y=[0,1],b;function I(D){return D!=null&&D<=D?y[Cy(u,D,0,l)]:b}function o(){var D=-1;for(u=new Array(l);++D<l;)u[D]=((D+1)*n-(D-l)*e)/(l+1);return I}return I.domain=function(D){return arguments.length?([e,n]=D,e=+e,n=+n,o()):[e,n]},I.range=function(D){return arguments.length?(l=(y=Array.from(D)).length-1,o()):y.slice()},I.invertExtent=function(D){var k=y.indexOf(D);return k<0?[NaN,NaN]:k<1?[e,u[0]]:k>=l?[u[l-1],n]:[u[k-1],u[k]]},I.unknown=function(D){return arguments.length&&(b=D),I},I.thresholds=function(){return u.slice()},I.copy=function(){return PL().domain([e,n]).range(y).unknown(b)},gu.apply(Ep(I),arguments)}function CL(){var e=[.5],n=[0,1],l,u=1;function y(b){return b!=null&&b<=b?n[Cy(e,b,0,u)]:l}return y.domain=function(b){return arguments.length?(e=Array.from(b),u=Math.min(e.length,n.length-1),y):e.slice()},y.range=function(b){return arguments.length?(n=Array.from(b),u=Math.min(e.length,n.length-1),y):n.slice()},y.invertExtent=function(b){var I=n.indexOf(b);return[e[I-1],e[I]]},y.unknown=function(b){return arguments.length?(l=b,y):l},y.copy=function(){return CL().domain(e).range(n).unknown(l)},gu.apply(y,arguments)}const vw=new Date,xw=new Date;function ja(e,n,l,u){function y(b){return e(b=arguments.length===0?new Date:new Date(+b)),b}return y.floor=b=>(e(b=new Date(+b)),b),y.ceil=b=>(e(b=new Date(b-1)),n(b,1),e(b),b),y.round=b=>{const I=y(b),o=y.ceil(b);return b-I<o-b?I:o},y.offset=(b,I)=>(n(b=new Date(+b),I==null?1:Math.floor(I)),b),y.range=(b,I,o)=>{const D=[];if(b=y.ceil(b),o=o==null?1:Math.floor(o),!(b<I)||!(o>0))return D;let k;do D.push(k=new Date(+b)),n(b,o),e(b);while(k<b&&b<I);return D},y.filter=b=>ja(I=>{if(I>=I)for(;e(I),!b(I);)I.setTime(I-1)},(I,o)=>{if(I>=I)if(o<0)for(;++o<=0;)for(;n(I,-1),!b(I););else for(;--o>=0;)for(;n(I,1),!b(I););}),l&&(y.count=(b,I)=>(vw.setTime(+b),xw.setTime(+I),e(vw),e(xw),Math.floor(l(vw,xw))),y.every=b=>(b=Math.floor(b),!isFinite(b)||!(b>0)?null:b>1?y.filter(u?I=>u(I)%b===0:I=>y.count(0,I)%b===0):y)),y}const M0=ja(()=>{},(e,n)=>{e.setTime(+e+n)},(e,n)=>n-e);M0.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ja(n=>{n.setTime(Math.floor(n/e)*e)},(n,l)=>{n.setTime(+n+l*e)},(n,l)=>(l-n)/e):M0);M0.range;const nf=1e3,hu=nf*60,of=hu*60,cf=of*24,eE=cf*7,PO=cf*30,bw=cf*365,Am=ja(e=>{e.setTime(e-e.getMilliseconds())},(e,n)=>{e.setTime(+e+n*nf)},(e,n)=>(n-e)/nf,e=>e.getUTCSeconds());Am.range;const tE=ja(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*nf)},(e,n)=>{e.setTime(+e+n*hu)},(e,n)=>(n-e)/hu,e=>e.getMinutes());tE.range;const rE=ja(e=>{e.setUTCSeconds(0,0)},(e,n)=>{e.setTime(+e+n*hu)},(e,n)=>(n-e)/hu,e=>e.getUTCMinutes());rE.range;const nE=ja(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*nf-e.getMinutes()*hu)},(e,n)=>{e.setTime(+e+n*of)},(e,n)=>(n-e)/of,e=>e.getHours());nE.range;const iE=ja(e=>{e.setUTCMinutes(0,0,0)},(e,n)=>{e.setTime(+e+n*of)},(e,n)=>(n-e)/of,e=>e.getUTCHours());iE.range;const Dy=ja(e=>e.setHours(0,0,0,0),(e,n)=>e.setDate(e.getDate()+n),(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*hu)/cf,e=>e.getDate()-1);Dy.range;const mx=ja(e=>{e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n)},(e,n)=>(n-e)/cf,e=>e.getUTCDate()-1);mx.range;const ML=ja(e=>{e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n)},(e,n)=>(n-e)/cf,e=>Math.floor(e/cf));ML.range;function Vm(e){return ja(n=>{n.setDate(n.getDate()-(n.getDay()+7-e)%7),n.setHours(0,0,0,0)},(n,l)=>{n.setDate(n.getDate()+l*7)},(n,l)=>(l-n-(l.getTimezoneOffset()-n.getTimezoneOffset())*hu)/eE)}const gx=Vm(0),O0=Vm(1),nq=Vm(2),iq=Vm(3),Lg=Vm(4),oq=Vm(5),aq=Vm(6);gx.range;O0.range;nq.range;iq.range;Lg.range;oq.range;aq.range;function $m(e){return ja(n=>{n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-e)%7),n.setUTCHours(0,0,0,0)},(n,l)=>{n.setUTCDate(n.getUTCDate()+l*7)},(n,l)=>(l-n)/eE)}const _x=$m(0),D0=$m(1),sq=$m(2),lq=$m(3),zg=$m(4),cq=$m(5),uq=$m(6);_x.range;D0.range;sq.range;lq.range;zg.range;cq.range;uq.range;const oE=ja(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,n)=>{e.setMonth(e.getMonth()+n)},(e,n)=>n.getMonth()-e.getMonth()+(n.getFullYear()-e.getFullYear())*12,e=>e.getMonth());oE.range;const aE=ja(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCMonth(e.getUTCMonth()+n)},(e,n)=>n.getUTCMonth()-e.getUTCMonth()+(n.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());aE.range;const uf=ja(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n)},(e,n)=>n.getFullYear()-e.getFullYear(),e=>e.getFullYear());uf.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ja(n=>{n.setFullYear(Math.floor(n.getFullYear()/e)*e),n.setMonth(0,1),n.setHours(0,0,0,0)},(n,l)=>{n.setFullYear(n.getFullYear()+l*e)});uf.range;const hf=ja(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n)},(e,n)=>n.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());hf.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ja(n=>{n.setUTCFullYear(Math.floor(n.getUTCFullYear()/e)*e),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},(n,l)=>{n.setUTCFullYear(n.getUTCFullYear()+l*e)});hf.range;function ww(e,n){return e==null||n==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function hq(e,n){return e==null||n==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function dq(e){let n,l,u;e.length!==2?(n=ww,l=(o,D)=>ww(e(o),D),u=(o,D)=>e(o)-D):(n=e===ww||e===hq?e:fq,l=e,u=e);function y(o,D,k=0,L=o.length){if(k<L){if(n(D,D)!==0)return L;do{const $=k+L>>>1;l(o[$],D)<0?k=$+1:L=$}while(k<L)}return k}function b(o,D,k=0,L=o.length){if(k<L){if(n(D,D)!==0)return L;do{const $=k+L>>>1;l(o[$],D)<=0?k=$+1:L=$}while(k<L)}return k}function I(o,D,k=0,L=o.length){const $=y(o,D,k,L-1);return $>k&&u(o[$-1],D)>-u(o[$],D)?$-1:$}return{left:y,center:I,right:b}}function fq(){return 0}const pq=Math.sqrt(50),mq=Math.sqrt(10),gq=Math.sqrt(2);function OL(e,n,l){const u=(n-e)/Math.max(0,l),y=Math.floor(Math.log10(u)),b=u/Math.pow(10,y),I=b>=pq?10:b>=mq?5:b>=gq?2:1;let o,D,k;return y<0?(k=Math.pow(10,-y)/I,o=Math.round(e*k),D=Math.round(n*k),o/k<e&&++o,D/k>n&&--D,k=-k):(k=Math.pow(10,y)*I,o=Math.round(e/k),D=Math.round(n/k),o*k<e&&++o,D*k>n&&--D),D<o&&.5<=l&&l<2?OL(e,n,l*2):[o,D,k]}function CO(e,n,l){return n=+n,e=+e,l=+l,OL(e,n,l)[2]}function MO(e,n,l){n=+n,e=+e,l=+l;const u=n<e,y=u?CO(n,e,l):CO(e,n,l);return(u?-1:1)*(y<0?1/-y:y)}function DL(e,n,l,u,y,b){const I=[[Am,1,nf],[Am,5,5*nf],[Am,15,15*nf],[Am,30,30*nf],[b,1,hu],[b,5,5*hu],[b,15,15*hu],[b,30,30*hu],[y,1,of],[y,3,3*of],[y,6,6*of],[y,12,12*of],[u,1,cf],[u,2,2*cf],[l,1,eE],[n,1,PO],[n,3,3*PO],[e,1,bw]];function o(k,L,$){const q=L<k;q&&([k,L]=[L,k]);const Z=$&&typeof $.range=="function"?$:D(k,L,$),ie=Z?Z.range(k,+L+1):[];return q?ie.reverse():ie}function D(k,L,$){const q=Math.abs(L-k)/$,Z=dq(([,,le])=>le).right(I,q);if(Z===I.length)return e.every(MO(k/bw,L/bw,$));if(Z===0)return M0.every(Math.max(MO(k,L,$),1));const[ie,oe]=I[q/I[Z-1][2]<I[Z][2]/q?Z-1:Z];return ie.every(oe)}return[o,D]}const[_q,yq]=DL(hf,aE,_x,ML,iE,rE),[vq,xq]=DL(uf,oE,gx,Dy,nE,tE);function Sw(e){if(0<=e.y&&e.y<100){var n=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return n.setFullYear(e.y),n}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Tw(e){if(0<=e.y&&e.y<100){var n=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return n.setUTCFullYear(e.y),n}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function X_(e,n,l){return{y:e,m:n,d:l,H:0,M:0,S:0,L:0}}function bq(e){var n=e.dateTime,l=e.date,u=e.time,y=e.periods,b=e.days,I=e.shortDays,o=e.months,D=e.shortMonths,k=Y_(y),L=K_(y),$=Y_(b),q=K_(b),Z=Y_(I),ie=K_(I),oe=Y_(o),le=K_(o),xe=Y_(D),ge=K_(D),ke={a:qr,A:lr,b:br,B:Ft,c:null,d:zO,e:zO,f:Gq,g:eW,G:rW,H:Uq,I:Vq,j:$q,L:kL,m:qq,M:Wq,p:ot,q:St,Q:BO,s:jO,S:Hq,u:Zq,U:Xq,V:Yq,w:Kq,W:Jq,x:null,X:null,y:Qq,Y:tW,Z:nW,"%":NO},et={a:Ur,A:gn,b:Sr,B:kr,c:null,d:FO,e:FO,f:sW,g:_W,G:vW,H:iW,I:oW,j:aW,L:LL,m:lW,M:cW,p:Vr,q:wn,Q:BO,s:jO,S:uW,u:hW,U:dW,V:fW,w:pW,W:mW,x:null,X:null,y:gW,Y:yW,Z:xW,"%":NO},ze={a:Br,A:Zt,b:dr,B:Dr,c:vr,d:RO,e:RO,f:Fq,g:kO,G:DO,H:LO,I:LO,j:kq,L:zq,m:Dq,M:Rq,p:ir,q:Oq,Q:Bq,s:jq,S:Lq,u:Aq,U:Iq,V:Pq,w:Eq,W:Cq,x:Ar,X:zr,y:kO,Y:DO,Z:Mq,"%":Nq};ke.x=nt(l,ke),ke.X=nt(u,ke),ke.c=nt(n,ke),et.x=nt(l,et),et.X=nt(u,et),et.c=nt(n,et);function nt(Nt,Qr){return function(Tn){var Kt=[],We=-1,fr=0,jr=Nt.length,mr,en,uo;for(Tn instanceof Date||(Tn=new Date(+Tn));++We<jr;)Nt.charCodeAt(We)===37&&(Kt.push(Nt.slice(fr,We)),(en=OO[mr=Nt.charAt(++We)])!=null?mr=Nt.charAt(++We):en=mr==="e"?" ":"0",(uo=Qr[mr])&&(mr=uo(Tn,en)),Kt.push(mr),fr=We+1);return Kt.push(Nt.slice(fr,We)),Kt.join("")}}function pt(Nt,Qr){return function(Tn){var Kt=X_(1900,void 0,1),We=Gt(Kt,Nt,Tn+="",0),fr,jr;if(We!=Tn.length)return null;if("Q"in Kt)return new Date(Kt.Q);if("s"in Kt)return new Date(Kt.s*1e3+("L"in Kt?Kt.L:0));if(Qr&&!("Z"in Kt)&&(Kt.Z=0),"p"in Kt&&(Kt.H=Kt.H%12+Kt.p*12),Kt.m===void 0&&(Kt.m="q"in Kt?Kt.q:0),"V"in Kt){if(Kt.V<1||Kt.V>53)return null;"w"in Kt||(Kt.w=1),"Z"in Kt?(fr=Tw(X_(Kt.y,0,1)),jr=fr.getUTCDay(),fr=jr>4||jr===0?D0.ceil(fr):D0(fr),fr=mx.offset(fr,(Kt.V-1)*7),Kt.y=fr.getUTCFullYear(),Kt.m=fr.getUTCMonth(),Kt.d=fr.getUTCDate()+(Kt.w+6)%7):(fr=Sw(X_(Kt.y,0,1)),jr=fr.getDay(),fr=jr>4||jr===0?O0.ceil(fr):O0(fr),fr=Dy.offset(fr,(Kt.V-1)*7),Kt.y=fr.getFullYear(),Kt.m=fr.getMonth(),Kt.d=fr.getDate()+(Kt.w+6)%7)}else("W"in Kt||"U"in Kt)&&("w"in Kt||(Kt.w="u"in Kt?Kt.u%7:"W"in Kt?1:0),jr="Z"in Kt?Tw(X_(Kt.y,0,1)).getUTCDay():Sw(X_(Kt.y,0,1)).getDay(),Kt.m=0,Kt.d="W"in Kt?(Kt.w+6)%7+Kt.W*7-(jr+5)%7:Kt.w+Kt.U*7-(jr+6)%7);return"Z"in Kt?(Kt.H+=Kt.Z/100|0,Kt.M+=Kt.Z%100,Tw(Kt)):Sw(Kt)}}function Gt(Nt,Qr,Tn,Kt){for(var We=0,fr=Qr.length,jr=Tn.length,mr,en;We<fr;){if(Kt>=jr)return-1;if(mr=Qr.charCodeAt(We++),mr===37){if(mr=Qr.charAt(We++),en=ze[mr in OO?Qr.charAt(We++):mr],!en||(Kt=en(Nt,Tn,Kt))<0)return-1}else if(mr!=Tn.charCodeAt(Kt++))return-1}return Kt}function ir(Nt,Qr,Tn){var Kt=k.exec(Qr.slice(Tn));return Kt?(Nt.p=L.get(Kt[0].toLowerCase()),Tn+Kt[0].length):-1}function Br(Nt,Qr,Tn){var Kt=Z.exec(Qr.slice(Tn));return Kt?(Nt.w=ie.get(Kt[0].toLowerCase()),Tn+Kt[0].length):-1}function Zt(Nt,Qr,Tn){var Kt=$.exec(Qr.slice(Tn));return Kt?(Nt.w=q.get(Kt[0].toLowerCase()),Tn+Kt[0].length):-1}function dr(Nt,Qr,Tn){var Kt=xe.exec(Qr.slice(Tn));return Kt?(Nt.m=ge.get(Kt[0].toLowerCase()),Tn+Kt[0].length):-1}function Dr(Nt,Qr,Tn){var Kt=oe.exec(Qr.slice(Tn));return Kt?(Nt.m=le.get(Kt[0].toLowerCase()),Tn+Kt[0].length):-1}function vr(Nt,Qr,Tn){return Gt(Nt,n,Qr,Tn)}function Ar(Nt,Qr,Tn){return Gt(Nt,l,Qr,Tn)}function zr(Nt,Qr,Tn){return Gt(Nt,u,Qr,Tn)}function qr(Nt){return I[Nt.getDay()]}function lr(Nt){return b[Nt.getDay()]}function br(Nt){return D[Nt.getMonth()]}function Ft(Nt){return o[Nt.getMonth()]}function ot(Nt){return y[+(Nt.getHours()>=12)]}function St(Nt){return 1+~~(Nt.getMonth()/3)}function Ur(Nt){return I[Nt.getUTCDay()]}function gn(Nt){return b[Nt.getUTCDay()]}function Sr(Nt){return D[Nt.getUTCMonth()]}function kr(Nt){return o[Nt.getUTCMonth()]}function Vr(Nt){return y[+(Nt.getUTCHours()>=12)]}function wn(Nt){return 1+~~(Nt.getUTCMonth()/3)}return{format:function(Nt){var Qr=nt(Nt+="",ke);return Qr.toString=function(){return Nt},Qr},parse:function(Nt){var Qr=pt(Nt+="",!1);return Qr.toString=function(){return Nt},Qr},utcFormat:function(Nt){var Qr=nt(Nt+="",et);return Qr.toString=function(){return Nt},Qr},utcParse:function(Nt){var Qr=pt(Nt+="",!0);return Qr.toString=function(){return Nt},Qr}}}var OO={"-":"",_:" ",0:"0"},Za=/^\s*\d+/,wq=/^%/,Sq=/[\\^$*+?|[\]().{}]/g;function Yi(e,n,l){var u=e<0?"-":"",y=(u?-e:e)+"",b=y.length;return u+(b<l?new Array(l-b+1).join(n)+y:y)}function Tq(e){return e.replace(Sq,"\\$&")}function Y_(e){return new RegExp("^(?:"+e.map(Tq).join("|")+")","i")}function K_(e){return new Map(e.map((n,l)=>[n.toLowerCase(),l]))}function Eq(e,n,l){var u=Za.exec(n.slice(l,l+1));return u?(e.w=+u[0],l+u[0].length):-1}function Aq(e,n,l){var u=Za.exec(n.slice(l,l+1));return u?(e.u=+u[0],l+u[0].length):-1}function Iq(e,n,l){var u=Za.exec(n.slice(l,l+2));return u?(e.U=+u[0],l+u[0].length):-1}function Pq(e,n,l){var u=Za.exec(n.slice(l,l+2));return u?(e.V=+u[0],l+u[0].length):-1}function Cq(e,n,l){var u=Za.exec(n.slice(l,l+2));return u?(e.W=+u[0],l+u[0].length):-1}function DO(e,n,l){var u=Za.exec(n.slice(l,l+4));return u?(e.y=+u[0],l+u[0].length):-1}function kO(e,n,l){var u=Za.exec(n.slice(l,l+2));return u?(e.y=+u[0]+(+u[0]>68?1900:2e3),l+u[0].length):-1}function Mq(e,n,l){var u=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(l,l+6));return u?(e.Z=u[1]?0:-(u[2]+(u[3]||"00")),l+u[0].length):-1}function Oq(e,n,l){var u=Za.exec(n.slice(l,l+1));return u?(e.q=u[0]*3-3,l+u[0].length):-1}function Dq(e,n,l){var u=Za.exec(n.slice(l,l+2));return u?(e.m=u[0]-1,l+u[0].length):-1}function RO(e,n,l){var u=Za.exec(n.slice(l,l+2));return u?(e.d=+u[0],l+u[0].length):-1}function kq(e,n,l){var u=Za.exec(n.slice(l,l+3));return u?(e.m=0,e.d=+u[0],l+u[0].length):-1}function LO(e,n,l){var u=Za.exec(n.slice(l,l+2));return u?(e.H=+u[0],l+u[0].length):-1}function Rq(e,n,l){var u=Za.exec(n.slice(l,l+2));return u?(e.M=+u[0],l+u[0].length):-1}function Lq(e,n,l){var u=Za.exec(n.slice(l,l+2));return u?(e.S=+u[0],l+u[0].length):-1}function zq(e,n,l){var u=Za.exec(n.slice(l,l+3));return u?(e.L=+u[0],l+u[0].length):-1}function Fq(e,n,l){var u=Za.exec(n.slice(l,l+6));return u?(e.L=Math.floor(u[0]/1e3),l+u[0].length):-1}function Nq(e,n,l){var u=wq.exec(n.slice(l,l+1));return u?l+u[0].length:-1}function Bq(e,n,l){var u=Za.exec(n.slice(l));return u?(e.Q=+u[0],l+u[0].length):-1}function jq(e,n,l){var u=Za.exec(n.slice(l));return u?(e.s=+u[0],l+u[0].length):-1}function zO(e,n){return Yi(e.getDate(),n,2)}function Uq(e,n){return Yi(e.getHours(),n,2)}function Vq(e,n){return Yi(e.getHours()%12||12,n,2)}function $q(e,n){return Yi(1+Dy.count(uf(e),e),n,3)}function kL(e,n){return Yi(e.getMilliseconds(),n,3)}function Gq(e,n){return kL(e,n)+"000"}function qq(e,n){return Yi(e.getMonth()+1,n,2)}function Wq(e,n){return Yi(e.getMinutes(),n,2)}function Hq(e,n){return Yi(e.getSeconds(),n,2)}function Zq(e){var n=e.getDay();return n===0?7:n}function Xq(e,n){return Yi(gx.count(uf(e)-1,e),n,2)}function RL(e){var n=e.getDay();return n>=4||n===0?Lg(e):Lg.ceil(e)}function Yq(e,n){return e=RL(e),Yi(Lg.count(uf(e),e)+(uf(e).getDay()===4),n,2)}function Kq(e){return e.getDay()}function Jq(e,n){return Yi(O0.count(uf(e)-1,e),n,2)}function Qq(e,n){return Yi(e.getFullYear()%100,n,2)}function eW(e,n){return e=RL(e),Yi(e.getFullYear()%100,n,2)}function tW(e,n){return Yi(e.getFullYear()%1e4,n,4)}function rW(e,n){var l=e.getDay();return e=l>=4||l===0?Lg(e):Lg.ceil(e),Yi(e.getFullYear()%1e4,n,4)}function nW(e){var n=e.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+Yi(n/60|0,"0",2)+Yi(n%60,"0",2)}function FO(e,n){return Yi(e.getUTCDate(),n,2)}function iW(e,n){return Yi(e.getUTCHours(),n,2)}function oW(e,n){return Yi(e.getUTCHours()%12||12,n,2)}function aW(e,n){return Yi(1+mx.count(hf(e),e),n,3)}function LL(e,n){return Yi(e.getUTCMilliseconds(),n,3)}function sW(e,n){return LL(e,n)+"000"}function lW(e,n){return Yi(e.getUTCMonth()+1,n,2)}function cW(e,n){return Yi(e.getUTCMinutes(),n,2)}function uW(e,n){return Yi(e.getUTCSeconds(),n,2)}function hW(e){var n=e.getUTCDay();return n===0?7:n}function dW(e,n){return Yi(_x.count(hf(e)-1,e),n,2)}function zL(e){var n=e.getUTCDay();return n>=4||n===0?zg(e):zg.ceil(e)}function fW(e,n){return e=zL(e),Yi(zg.count(hf(e),e)+(hf(e).getUTCDay()===4),n,2)}function pW(e){return e.getUTCDay()}function mW(e,n){return Yi(D0.count(hf(e)-1,e),n,2)}function gW(e,n){return Yi(e.getUTCFullYear()%100,n,2)}function _W(e,n){return e=zL(e),Yi(e.getUTCFullYear()%100,n,2)}function yW(e,n){return Yi(e.getUTCFullYear()%1e4,n,4)}function vW(e,n){var l=e.getUTCDay();return e=l>=4||l===0?zg(e):zg.ceil(e),Yi(e.getUTCFullYear()%1e4,n,4)}function xW(){return"+0000"}function NO(){return"%"}function BO(e){return+e}function jO(e){return Math.floor(+e/1e3)}var bg,FL,NL;bW({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function bW(e){return bg=bq(e),FL=bg.format,bg.parse,NL=bg.utcFormat,bg.utcParse,bg}function wW(e){return new Date(e)}function SW(e){return e instanceof Date?+e:+new Date(+e)}function sE(e,n,l,u,y,b,I,o,D,k){var L=HT(),$=L.invert,q=L.domain,Z=k(".%L"),ie=k(":%S"),oe=k("%I:%M"),le=k("%I %p"),xe=k("%a %d"),ge=k("%b %d"),ke=k("%B"),et=k("%Y");function ze(nt){return(D(nt)<nt?Z:o(nt)<nt?ie:I(nt)<nt?oe:b(nt)<nt?le:u(nt)<nt?y(nt)<nt?xe:ge:l(nt)<nt?ke:et)(nt)}return L.invert=function(nt){return new Date($(nt))},L.domain=function(nt){return arguments.length?q(Array.from(nt,SW)):q().map(wW)},L.ticks=function(nt){var pt=q();return e(pt[0],pt[pt.length-1],nt??10)},L.tickFormat=function(nt,pt){return pt==null?ze:k(pt)},L.nice=function(nt){var pt=q();return(!nt||typeof nt.range!="function")&&(nt=n(pt[0],pt[pt.length-1],nt??10)),nt?q(SL(pt,nt)):L},L.copy=function(){return Oy(L,sE(e,n,l,u,y,b,I,o,D,k))},L}function TW(){return gu.apply(sE(vq,xq,uf,oE,gx,Dy,nE,tE,Am,FL).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function EW(){return gu.apply(sE(_q,yq,hf,aE,_x,mx,iE,rE,Am,NL).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function yx(){var e=0,n=1,l,u,y,b,I=nl,o=!1,D;function k($){return $==null||isNaN($=+$)?D:I(y===0?.5:($=(b($)-l)*y,o?Math.max(0,Math.min(1,$)):$))}k.domain=function($){return arguments.length?([e,n]=$,l=b(e=+e),u=b(n=+n),y=l===u?0:1/(u-l),k):[e,n]},k.clamp=function($){return arguments.length?(o=!!$,k):o},k.interpolator=function($){return arguments.length?(I=$,k):I};function L($){return function(q){var Z,ie;return arguments.length?([Z,ie]=q,I=$(Z,ie),k):[I(0),I(1)]}}return k.range=L($g),k.rangeRound=L(WT),k.unknown=function($){return arguments.length?(D=$,k):D},function($){return b=$,l=$(e),u=$(n),y=l===u?0:1/(u-l),k}}function Ap(e,n){return n.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function BL(){var e=Ep(yx()(nl));return e.copy=function(){return Ap(e,BL())},mf.apply(e,arguments)}function jL(){var e=YT(yx()).domain([1,10]);return e.copy=function(){return Ap(e,jL()).base(e.base())},mf.apply(e,arguments)}function UL(){var e=KT(yx());return e.copy=function(){return Ap(e,UL()).constant(e.constant())},mf.apply(e,arguments)}function lE(){var e=JT(yx());return e.copy=function(){return Ap(e,lE()).exponent(e.exponent())},mf.apply(e,arguments)}function AW(){return lE.apply(null,arguments).exponent(.5)}function VL(){var e=[],n=nl;function l(u){if(u!=null&&!isNaN(u=+u))return n((Cy(e,u,1)-1)/(e.length-1))}return l.domain=function(u){if(!arguments.length)return e.slice();e=[];for(let y of u)y!=null&&!isNaN(y=+y)&&e.push(y);return e.sort(vp),l},l.interpolator=function(u){return arguments.length?(n=u,l):n},l.range=function(){return e.map((u,y)=>n(y/(e.length-1)))},l.quantiles=function(u){return Array.from({length:u+1},(y,b)=>oG(e,b/u))},l.copy=function(){return VL(n).domain(e)},mf.apply(l,arguments)}function vx(){var e=0,n=.5,l=1,u=1,y,b,I,o,D,k=nl,L,$=!1,q;function Z(oe){return isNaN(oe=+oe)?q:(oe=.5+((oe=+L(oe))-b)*(u*oe<u*b?o:D),k($?Math.max(0,Math.min(1,oe)):oe))}Z.domain=function(oe){return arguments.length?([e,n,l]=oe,y=L(e=+e),b=L(n=+n),I=L(l=+l),o=y===b?0:.5/(b-y),D=b===I?0:.5/(I-b),u=b<y?-1:1,Z):[e,n,l]},Z.clamp=function(oe){return arguments.length?($=!!oe,Z):$},Z.interpolator=function(oe){return arguments.length?(k=oe,Z):k};function ie(oe){return function(le){var xe,ge,ke;return arguments.length?([xe,ge,ke]=le,k=DG(oe,[xe,ge,ke]),Z):[k(0),k(.5),k(1)]}}return Z.range=ie($g),Z.rangeRound=ie(WT),Z.unknown=function(oe){return arguments.length?(q=oe,Z):q},function(oe){return L=oe,y=oe(e),b=oe(n),I=oe(l),o=y===b?0:.5/(b-y),D=b===I?0:.5/(I-b),u=b<y?-1:1,Z}}function $L(){var e=Ep(vx()(nl));return e.copy=function(){return Ap(e,$L())},mf.apply(e,arguments)}function GL(){var e=YT(vx()).domain([.1,1,10]);return e.copy=function(){return Ap(e,GL()).base(e.base())},mf.apply(e,arguments)}function qL(){var e=KT(vx());return e.copy=function(){return Ap(e,qL()).constant(e.constant())},mf.apply(e,arguments)}function cE(){var e=JT(vx());return e.copy=function(){return Ap(e,cE()).exponent(e.exponent())},mf.apply(e,arguments)}function IW(){return cE.apply(null,arguments).exponent(.5)}const ry=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:$T,scaleDiverging:$L,scaleDivergingLog:GL,scaleDivergingPow:cE,scaleDivergingSqrt:IW,scaleDivergingSymlog:qL,scaleIdentity:wL,scaleImplicit:DS,scaleLinear:bL,scaleLog:TL,scaleOrdinal:VT,scalePoint:lG,scalePow:QT,scaleQuantile:IL,scaleQuantize:PL,scaleRadial:AL,scaleSequential:BL,scaleSequentialLog:jL,scaleSequentialPow:lE,scaleSequentialQuantile:VL,scaleSequentialSqrt:AW,scaleSequentialSymlog:UL,scaleSqrt:tq,scaleSymlog:EL,scaleThreshold:CL,scaleTime:TW,scaleUtc:EW,tickFormat:xL},Symbol.toStringTag,{value:"Module"}));var Gm=e=>e.chartData,PW=Ht([Gm],e=>{var n=e.chartData!=null?e.chartData.length-1:0;return{chartData:e.chartData,computedData:e.computedData,dataEndIndex:n,dataStartIndex:0}}),WL=(e,n,l,u)=>u?PW(e):Gm(e);function Fg(e){if(Array.isArray(e)&&e.length===2){var[n,l]=e;if(Pc(n)&&Pc(l))return!0}return!1}function UO(e,n,l){return l?e:[Math.min(e[0],n[0]),Math.max(e[1],n[1])]}function CW(e,n){if(n&&typeof e!="function"&&Array.isArray(e)&&e.length===2){var[l,u]=e,y,b;if(Pc(l))y=l;else if(typeof l=="function")return;if(Pc(u))b=u;else if(typeof u=="function")return;var I=[y,b];if(Fg(I))return I}}function MW(e,n,l){if(!(!l&&n==null)){if(typeof e=="function"&&n!=null)try{var u=e(n,l);if(Fg(u))return UO(u,n,l)}catch{}if(Array.isArray(e)&&e.length===2){var[y,b]=e,I,o;if(y==="auto")n!=null&&(I=Math.min(...n));else if(mn(y))I=y;else if(typeof y=="function")try{n!=null&&(I=y(n==null?void 0:n[0]))}catch{}else if(typeof y=="string"&&PM.test(y)){var D=PM.exec(y);if(D==null||n==null)I=void 0;else{var k=+D[1];I=n[0]-k}}else I=n==null?void 0:n[0];if(b==="auto")n!=null&&(o=Math.max(...n));else if(mn(b))o=b;else if(typeof b=="function")try{n!=null&&(o=b(n==null?void 0:n[1]))}catch{}else if(typeof b=="string"&&CM.test(b)){var L=CM.exec(b);if(L==null||n==null)o=void 0;else{var $=+L[1];o=n[1]+$}}else o=n==null?void 0:n[1];var q=[I,o];if(Fg(q))return n==null?q:UO(q,n,l)}}}var Gg=1e9,OW={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},hE,qo=!0,pu="[DecimalError] ",Dm=pu+"Invalid argument: ",uE=pu+"Exponent out of range: ",qg=Math.floor,wm=Math.pow,DW=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,wc,qa=1e7,Do=7,HL=9007199254740991,k0=qg(HL/Do),sn={};sn.absoluteValue=sn.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};sn.comparedTo=sn.cmp=function(e){var n,l,u,y,b=this;if(e=new b.constructor(e),b.s!==e.s)return b.s||-e.s;if(b.e!==e.e)return b.e>e.e^b.s<0?1:-1;for(u=b.d.length,y=e.d.length,n=0,l=u<y?u:y;n<l;++n)if(b.d[n]!==e.d[n])return b.d[n]>e.d[n]^b.s<0?1:-1;return u===y?0:u>y^b.s<0?1:-1};sn.decimalPlaces=sn.dp=function(){var e=this,n=e.d.length-1,l=(n-e.e)*Do;if(n=e.d[n],n)for(;n%10==0;n/=10)l--;return l<0?0:l};sn.dividedBy=sn.div=function(e){return sf(this,new this.constructor(e))};sn.dividedToIntegerBy=sn.idiv=function(e){var n=this,l=n.constructor;return _o(sf(n,new l(e),0,1),l.precision)};sn.equals=sn.eq=function(e){return!this.cmp(e)};sn.exponent=function(){return Ia(this)};sn.greaterThan=sn.gt=function(e){return this.cmp(e)>0};sn.greaterThanOrEqualTo=sn.gte=function(e){return this.cmp(e)>=0};sn.isInteger=sn.isint=function(){return this.e>this.d.length-2};sn.isNegative=sn.isneg=function(){return this.s<0};sn.isPositive=sn.ispos=function(){return this.s>0};sn.isZero=function(){return this.s===0};sn.lessThan=sn.lt=function(e){return this.cmp(e)<0};sn.lessThanOrEqualTo=sn.lte=function(e){return this.cmp(e)<1};sn.logarithm=sn.log=function(e){var n,l=this,u=l.constructor,y=u.precision,b=y+5;if(e===void 0)e=new u(10);else if(e=new u(e),e.s<1||e.eq(wc))throw Error(pu+"NaN");if(l.s<1)throw Error(pu+(l.s?"NaN":"-Infinity"));return l.eq(wc)?new u(0):(qo=!1,n=sf(my(l,b),my(e,b),b),qo=!0,_o(n,y))};sn.minus=sn.sub=function(e){var n=this;return e=new n.constructor(e),n.s==e.s?YL(n,e):ZL(n,(e.s=-e.s,e))};sn.modulo=sn.mod=function(e){var n,l=this,u=l.constructor,y=u.precision;if(e=new u(e),!e.s)throw Error(pu+"NaN");return l.s?(qo=!1,n=sf(l,e,0,1).times(e),qo=!0,l.minus(n)):_o(new u(l),y)};sn.naturalExponential=sn.exp=function(){return XL(this)};sn.naturalLogarithm=sn.ln=function(){return my(this)};sn.negated=sn.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};sn.plus=sn.add=function(e){var n=this;return e=new n.constructor(e),n.s==e.s?ZL(n,e):YL(n,(e.s=-e.s,e))};sn.precision=sn.sd=function(e){var n,l,u,y=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Dm+e);if(n=Ia(y)+1,u=y.d.length-1,l=u*Do+1,u=y.d[u],u){for(;u%10==0;u/=10)l--;for(u=y.d[0];u>=10;u/=10)l++}return e&&n>l?n:l};sn.squareRoot=sn.sqrt=function(){var e,n,l,u,y,b,I,o=this,D=o.constructor;if(o.s<1){if(!o.s)return new D(0);throw Error(pu+"NaN")}for(e=Ia(o),qo=!1,y=Math.sqrt(+o),y==0||y==1/0?(n=od(o.d),(n.length+e)%2==0&&(n+="0"),y=Math.sqrt(n),e=qg((e+1)/2)-(e<0||e%2),y==1/0?n="5e"+e:(n=y.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),u=new D(n)):u=new D(y.toString()),l=D.precision,y=I=l+3;;)if(b=u,u=b.plus(sf(o,b,I+2)).times(.5),od(b.d).slice(0,I)===(n=od(u.d)).slice(0,I)){if(n=n.slice(I-3,I+1),y==I&&n=="4999"){if(_o(b,l+1,0),b.times(b).eq(o)){u=b;break}}else if(n!="9999")break;I+=4}return qo=!0,_o(u,l)};sn.times=sn.mul=function(e){var n,l,u,y,b,I,o,D,k,L=this,$=L.constructor,q=L.d,Z=(e=new $(e)).d;if(!L.s||!e.s)return new $(0);for(e.s*=L.s,l=L.e+e.e,D=q.length,k=Z.length,D<k&&(b=q,q=Z,Z=b,I=D,D=k,k=I),b=[],I=D+k,u=I;u--;)b.push(0);for(u=k;--u>=0;){for(n=0,y=D+u;y>u;)o=b[y]+Z[u]*q[y-u-1]+n,b[y--]=o%qa|0,n=o/qa|0;b[y]=(b[y]+n)%qa|0}for(;!b[--I];)b.pop();return n?++l:b.shift(),e.d=b,e.e=l,qo?_o(e,$.precision):e};sn.toDecimalPlaces=sn.todp=function(e,n){var l=this,u=l.constructor;return l=new u(l),e===void 0?l:(ud(e,0,Gg),n===void 0?n=u.rounding:ud(n,0,8),_o(l,e+Ia(l)+1,n))};sn.toExponential=function(e,n){var l,u=this,y=u.constructor;return e===void 0?l=Fm(u,!0):(ud(e,0,Gg),n===void 0?n=y.rounding:ud(n,0,8),u=_o(new y(u),e+1,n),l=Fm(u,!0,e+1)),l};sn.toFixed=function(e,n){var l,u,y=this,b=y.constructor;return e===void 0?Fm(y):(ud(e,0,Gg),n===void 0?n=b.rounding:ud(n,0,8),u=_o(new b(y),e+Ia(y)+1,n),l=Fm(u.abs(),!1,e+Ia(u)+1),y.isneg()&&!y.isZero()?"-"+l:l)};sn.toInteger=sn.toint=function(){var e=this,n=e.constructor;return _o(new n(e),Ia(e)+1,n.rounding)};sn.toNumber=function(){return+this};sn.toPower=sn.pow=function(e){var n,l,u,y,b,I,o=this,D=o.constructor,k=12,L=+(e=new D(e));if(!e.s)return new D(wc);if(o=new D(o),!o.s){if(e.s<1)throw Error(pu+"Infinity");return o}if(o.eq(wc))return o;if(u=D.precision,e.eq(wc))return _o(o,u);if(n=e.e,l=e.d.length-1,I=n>=l,b=o.s,I){if((l=L<0?-L:L)<=HL){for(y=new D(wc),n=Math.ceil(u/Do+4),qo=!1;l%2&&(y=y.times(o),$O(y.d,n)),l=qg(l/2),l!==0;)o=o.times(o),$O(o.d,n);return qo=!0,e.s<0?new D(wc).div(y):_o(y,u)}}else if(b<0)throw Error(pu+"NaN");return b=b<0&&e.d[Math.max(n,l)]&1?-1:1,o.s=1,qo=!1,y=e.times(my(o,u+k)),qo=!0,y=XL(y),y.s=b,y};sn.toPrecision=function(e,n){var l,u,y=this,b=y.constructor;return e===void 0?(l=Ia(y),u=Fm(y,l<=b.toExpNeg||l>=b.toExpPos)):(ud(e,1,Gg),n===void 0?n=b.rounding:ud(n,0,8),y=_o(new b(y),e,n),l=Ia(y),u=Fm(y,e<=l||l<=b.toExpNeg,e)),u};sn.toSignificantDigits=sn.tosd=function(e,n){var l=this,u=l.constructor;return e===void 0?(e=u.precision,n=u.rounding):(ud(e,1,Gg),n===void 0?n=u.rounding:ud(n,0,8)),_o(new u(l),e,n)};sn.toString=sn.valueOf=sn.val=sn.toJSON=sn[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,n=Ia(e),l=e.constructor;return Fm(e,n<=l.toExpNeg||n>=l.toExpPos)};function ZL(e,n){var l,u,y,b,I,o,D,k,L=e.constructor,$=L.precision;if(!e.s||!n.s)return n.s||(n=new L(e)),qo?_o(n,$):n;if(D=e.d,k=n.d,I=e.e,y=n.e,D=D.slice(),b=I-y,b){for(b<0?(u=D,b=-b,o=k.length):(u=k,y=I,o=D.length),I=Math.ceil($/Do),o=I>o?I+1:o+1,b>o&&(b=o,u.length=1),u.reverse();b--;)u.push(0);u.reverse()}for(o=D.length,b=k.length,o-b<0&&(b=o,u=k,k=D,D=u),l=0;b;)l=(D[--b]=D[b]+k[b]+l)/qa|0,D[b]%=qa;for(l&&(D.unshift(l),++y),o=D.length;D[--o]==0;)D.pop();return n.d=D,n.e=y,qo?_o(n,$):n}function ud(e,n,l){if(e!==~~e||e<n||e>l)throw Error(Dm+e)}function od(e){var n,l,u,y=e.length-1,b="",I=e[0];if(y>0){for(b+=I,n=1;n<y;n++)u=e[n]+"",l=Do-u.length,l&&(b+=mp(l)),b+=u;I=e[n],u=I+"",l=Do-u.length,l&&(b+=mp(l))}else if(I===0)return"0";for(;I%10===0;)I/=10;return b+I}var sf=function(){function e(u,y){var b,I=0,o=u.length;for(u=u.slice();o--;)b=u[o]*y+I,u[o]=b%qa|0,I=b/qa|0;return I&&u.unshift(I),u}function n(u,y,b,I){var o,D;if(b!=I)D=b>I?1:-1;else for(o=D=0;o<b;o++)if(u[o]!=y[o]){D=u[o]>y[o]?1:-1;break}return D}function l(u,y,b){for(var I=0;b--;)u[b]-=I,I=u[b]<y[b]?1:0,u[b]=I*qa+u[b]-y[b];for(;!u[0]&&u.length>1;)u.shift()}return function(u,y,b,I){var o,D,k,L,$,q,Z,ie,oe,le,xe,ge,ke,et,ze,nt,pt,Gt,ir=u.constructor,Br=u.s==y.s?1:-1,Zt=u.d,dr=y.d;if(!u.s)return new ir(u);if(!y.s)throw Error(pu+"Division by zero");for(D=u.e-y.e,pt=dr.length,ze=Zt.length,Z=new ir(Br),ie=Z.d=[],k=0;dr[k]==(Zt[k]||0);)++k;if(dr[k]>(Zt[k]||0)&&--D,b==null?ge=b=ir.precision:I?ge=b+(Ia(u)-Ia(y))+1:ge=b,ge<0)return new ir(0);if(ge=ge/Do+2|0,k=0,pt==1)for(L=0,dr=dr[0],ge++;(k<ze||L)&&ge--;k++)ke=L*qa+(Zt[k]||0),ie[k]=ke/dr|0,L=ke%dr|0;else{for(L=qa/(dr[0]+1)|0,L>1&&(dr=e(dr,L),Zt=e(Zt,L),pt=dr.length,ze=Zt.length),et=pt,oe=Zt.slice(0,pt),le=oe.length;le<pt;)oe[le++]=0;Gt=dr.slice(),Gt.unshift(0),nt=dr[0],dr[1]>=qa/2&&++nt;do L=0,o=n(dr,oe,pt,le),o<0?(xe=oe[0],pt!=le&&(xe=xe*qa+(oe[1]||0)),L=xe/nt|0,L>1?(L>=qa&&(L=qa-1),$=e(dr,L),q=$.length,le=oe.length,o=n($,oe,q,le),o==1&&(L--,l($,pt<q?Gt:dr,q))):(L==0&&(o=L=1),$=dr.slice()),q=$.length,q<le&&$.unshift(0),l(oe,$,le),o==-1&&(le=oe.length,o=n(dr,oe,pt,le),o<1&&(L++,l(oe,pt<le?Gt:dr,le))),le=oe.length):o===0&&(L++,oe=[0]),ie[k++]=L,o&&oe[0]?oe[le++]=Zt[et]||0:(oe=[Zt[et]],le=1);while((et++<ze||oe[0]!==void 0)&&ge--)}return ie[0]||ie.shift(),Z.e=D,_o(Z,I?b+Ia(Z)+1:b)}}();function XL(e,n){var l,u,y,b,I,o,D=0,k=0,L=e.constructor,$=L.precision;if(Ia(e)>16)throw Error(uE+Ia(e));if(!e.s)return new L(wc);for(qo=!1,o=$,I=new L(.03125);e.abs().gte(.1);)e=e.times(I),k+=5;for(u=Math.log(wm(2,k))/Math.LN10*2+5|0,o+=u,l=y=b=new L(wc),L.precision=o;;){if(y=_o(y.times(e),o),l=l.times(++D),I=b.plus(sf(y,l,o)),od(I.d).slice(0,o)===od(b.d).slice(0,o)){for(;k--;)b=_o(b.times(b),o);return L.precision=$,n==null?(qo=!0,_o(b,$)):b}b=I}}function Ia(e){for(var n=e.e*Do,l=e.d[0];l>=10;l/=10)n++;return n}function Ew(e,n,l){if(n>e.LN10.sd())throw qo=!0,l&&(e.precision=l),Error(pu+"LN10 precision limit exceeded");return _o(new e(e.LN10),n)}function mp(e){for(var n="";e--;)n+="0";return n}function my(e,n){var l,u,y,b,I,o,D,k,L,$=1,q=10,Z=e,ie=Z.d,oe=Z.constructor,le=oe.precision;if(Z.s<1)throw Error(pu+(Z.s?"NaN":"-Infinity"));if(Z.eq(wc))return new oe(0);if(n==null?(qo=!1,k=le):k=n,Z.eq(10))return n==null&&(qo=!0),Ew(oe,k);if(k+=q,oe.precision=k,l=od(ie),u=l.charAt(0),b=Ia(Z),Math.abs(b)<15e14){for(;u<7&&u!=1||u==1&&l.charAt(1)>3;)Z=Z.times(e),l=od(Z.d),u=l.charAt(0),$++;b=Ia(Z),u>1?(Z=new oe("0."+l),b++):Z=new oe(u+"."+l.slice(1))}else return D=Ew(oe,k+2,le).times(b+""),Z=my(new oe(u+"."+l.slice(1)),k-q).plus(D),oe.precision=le,n==null?(qo=!0,_o(Z,le)):Z;for(o=I=Z=sf(Z.minus(wc),Z.plus(wc),k),L=_o(Z.times(Z),k),y=3;;){if(I=_o(I.times(L),k),D=o.plus(sf(I,new oe(y),k)),od(D.d).slice(0,k)===od(o.d).slice(0,k))return o=o.times(2),b!==0&&(o=o.plus(Ew(oe,k+2,le).times(b+""))),o=sf(o,new oe($),k),oe.precision=le,n==null?(qo=!0,_o(o,le)):o;o=D,y+=2}}function VO(e,n){var l,u,y;for((l=n.indexOf("."))>-1&&(n=n.replace(".","")),(u=n.search(/e/i))>0?(l<0&&(l=u),l+=+n.slice(u+1),n=n.substring(0,u)):l<0&&(l=n.length),u=0;n.charCodeAt(u)===48;)++u;for(y=n.length;n.charCodeAt(y-1)===48;)--y;if(n=n.slice(u,y),n){if(y-=u,l=l-u-1,e.e=qg(l/Do),e.d=[],u=(l+1)%Do,l<0&&(u+=Do),u<y){for(u&&e.d.push(+n.slice(0,u)),y-=Do;u<y;)e.d.push(+n.slice(u,u+=Do));n=n.slice(u),u=Do-n.length}else u-=y;for(;u--;)n+="0";if(e.d.push(+n),qo&&(e.e>k0||e.e<-k0))throw Error(uE+l)}else e.s=0,e.e=0,e.d=[0];return e}function _o(e,n,l){var u,y,b,I,o,D,k,L,$=e.d;for(I=1,b=$[0];b>=10;b/=10)I++;if(u=n-I,u<0)u+=Do,y=n,k=$[L=0];else{if(L=Math.ceil((u+1)/Do),b=$.length,L>=b)return e;for(k=b=$[L],I=1;b>=10;b/=10)I++;u%=Do,y=u-Do+I}if(l!==void 0&&(b=wm(10,I-y-1),o=k/b%10|0,D=n<0||$[L+1]!==void 0||k%b,D=l<4?(o||D)&&(l==0||l==(e.s<0?3:2)):o>5||o==5&&(l==4||D||l==6&&(u>0?y>0?k/wm(10,I-y):0:$[L-1])%10&1||l==(e.s<0?8:7))),n<1||!$[0])return D?(b=Ia(e),$.length=1,n=n-b-1,$[0]=wm(10,(Do-n%Do)%Do),e.e=qg(-n/Do)||0):($.length=1,$[0]=e.e=e.s=0),e;if(u==0?($.length=L,b=1,L--):($.length=L+1,b=wm(10,Do-u),$[L]=y>0?(k/wm(10,I-y)%wm(10,y)|0)*b:0),D)for(;;)if(L==0){($[0]+=b)==qa&&($[0]=1,++e.e);break}else{if($[L]+=b,$[L]!=qa)break;$[L--]=0,b=1}for(u=$.length;$[--u]===0;)$.pop();if(qo&&(e.e>k0||e.e<-k0))throw Error(uE+Ia(e));return e}function YL(e,n){var l,u,y,b,I,o,D,k,L,$,q=e.constructor,Z=q.precision;if(!e.s||!n.s)return n.s?n.s=-n.s:n=new q(e),qo?_o(n,Z):n;if(D=e.d,$=n.d,u=n.e,k=e.e,D=D.slice(),I=k-u,I){for(L=I<0,L?(l=D,I=-I,o=$.length):(l=$,u=k,o=D.length),y=Math.max(Math.ceil(Z/Do),o)+2,I>y&&(I=y,l.length=1),l.reverse(),y=I;y--;)l.push(0);l.reverse()}else{for(y=D.length,o=$.length,L=y<o,L&&(o=y),y=0;y<o;y++)if(D[y]!=$[y]){L=D[y]<$[y];break}I=0}for(L&&(l=D,D=$,$=l,n.s=-n.s),o=D.length,y=$.length-o;y>0;--y)D[o++]=0;for(y=$.length;y>I;){if(D[--y]<$[y]){for(b=y;b&&D[--b]===0;)D[b]=qa-1;--D[b],D[y]+=qa}D[y]-=$[y]}for(;D[--o]===0;)D.pop();for(;D[0]===0;D.shift())--u;return D[0]?(n.d=D,n.e=u,qo?_o(n,Z):n):new q(0)}function Fm(e,n,l){var u,y=Ia(e),b=od(e.d),I=b.length;return n?(l&&(u=l-I)>0?b=b.charAt(0)+"."+b.slice(1)+mp(u):I>1&&(b=b.charAt(0)+"."+b.slice(1)),b=b+(y<0?"e":"e+")+y):y<0?(b="0."+mp(-y-1)+b,l&&(u=l-I)>0&&(b+=mp(u))):y>=I?(b+=mp(y+1-I),l&&(u=l-y-1)>0&&(b=b+"."+mp(u))):((u=y+1)<I&&(b=b.slice(0,u)+"."+b.slice(u)),l&&(u=l-I)>0&&(y+1===I&&(b+="."),b+=mp(u))),e.s<0?"-"+b:b}function $O(e,n){if(e.length>n)return e.length=n,!0}function KL(e){var n,l,u;function y(b){var I=this;if(!(I instanceof y))return new y(b);if(I.constructor=y,b instanceof y){I.s=b.s,I.e=b.e,I.d=(b=b.d)?b.slice():b;return}if(typeof b=="number"){if(b*0!==0)throw Error(Dm+b);if(b>0)I.s=1;else if(b<0)b=-b,I.s=-1;else{I.s=0,I.e=0,I.d=[0];return}if(b===~~b&&b<1e7){I.e=0,I.d=[b];return}return VO(I,b.toString())}else if(typeof b!="string")throw Error(Dm+b);if(b.charCodeAt(0)===45?(b=b.slice(1),I.s=-1):I.s=1,DW.test(b))VO(I,b);else throw Error(Dm+b)}if(y.prototype=sn,y.ROUND_UP=0,y.ROUND_DOWN=1,y.ROUND_CEIL=2,y.ROUND_FLOOR=3,y.ROUND_HALF_UP=4,y.ROUND_HALF_DOWN=5,y.ROUND_HALF_EVEN=6,y.ROUND_HALF_CEIL=7,y.ROUND_HALF_FLOOR=8,y.clone=KL,y.config=y.set=kW,e===void 0&&(e={}),e)for(u=["precision","rounding","toExpNeg","toExpPos","LN10"],n=0;n<u.length;)e.hasOwnProperty(l=u[n++])||(e[l]=this[l]);return y.config(e),y}function kW(e){if(!e||typeof e!="object")throw Error(pu+"Object expected");var n,l,u,y=["precision",1,Gg,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(n=0;n<y.length;n+=3)if((u=e[l=y[n]])!==void 0)if(qg(u)===u&&u>=y[n+1]&&u<=y[n+2])this[l]=u;else throw Error(Dm+l+": "+u);if((u=e[l="LN10"])!==void 0)if(u==Math.LN10)this[l]=new this(u);else throw Error(Dm+l+": "+u);return this}var hE=KL(OW);wc=new hE(1);const lo=hE;var RW=e=>e,JL={},QL=e=>e===JL,GO=e=>function n(){return arguments.length===0||arguments.length===1&&QL(arguments.length<=0?void 0:arguments[0])?n:e(...arguments)},ez=(e,n)=>e===1?n:GO(function(){for(var l=arguments.length,u=new Array(l),y=0;y<l;y++)u[y]=arguments[y];var b=u.filter(I=>I!==JL).length;return b>=e?n(...u):ez(e-b,GO(function(){for(var I=arguments.length,o=new Array(I),D=0;D<I;D++)o[D]=arguments[D];var k=u.map(L=>QL(L)?o.shift():L);return n(...k,...o)}))}),xx=e=>ez(e.length,e),zS=(e,n)=>{for(var l=[],u=e;u<n;++u)l[u-e]=u;return l},LW=xx((e,n)=>Array.isArray(n)?n.map(e):Object.keys(n).map(l=>n[l]).map(e)),zW=function(){for(var n=arguments.length,l=new Array(n),u=0;u<n;u++)l[u]=arguments[u];if(!l.length)return RW;var y=l.reverse(),b=y[0],I=y.slice(1);return function(){return I.reduce((o,D)=>D(o),b(...arguments))}},FS=e=>Array.isArray(e)?e.reverse():e.split("").reverse().join(""),tz=e=>{var n=null,l=null;return function(){for(var u=arguments.length,y=new Array(u),b=0;b<u;b++)y[b]=arguments[b];return n&&y.every((I,o)=>{var D;return I===((D=n)===null||D===void 0?void 0:D[o])})||(n=y,l=e(...y)),l}};function rz(e){var n;return e===0?n=1:n=Math.floor(new lo(e).abs().log(10).toNumber())+1,n}function nz(e,n,l){for(var u=new lo(e),y=0,b=[];u.lt(n)&&y<1e5;)b.push(u.toNumber()),u=u.add(l),y++;return b}xx((e,n,l)=>{var u=+e,y=+n;return u+l*(y-u)});xx((e,n,l)=>{var u=n-+e;return u=u||1/0,(l-e)/u});xx((e,n,l)=>{var u=n-+e;return u=u||1/0,Math.max(0,Math.min(1,(l-e)/u))});var iz=e=>{var[n,l]=e,[u,y]=[n,l];return n>l&&([u,y]=[l,n]),[u,y]},oz=(e,n,l)=>{if(e.lte(0))return new lo(0);var u=rz(e.toNumber()),y=new lo(10).pow(u),b=e.div(y),I=u!==1?.05:.1,o=new lo(Math.ceil(b.div(I).toNumber())).add(l).mul(I),D=o.mul(y);return n?new lo(D.toNumber()):new lo(Math.ceil(D.toNumber()))},FW=(e,n,l)=>{var u=new lo(1),y=new lo(e);if(!y.isint()&&l){var b=Math.abs(e);b<1?(u=new lo(10).pow(rz(e)-1),y=new lo(Math.floor(y.div(u).toNumber())).mul(u)):b>1&&(y=new lo(Math.floor(e)))}else e===0?y=new lo(Math.floor((n-1)/2)):l||(y=new lo(Math.floor(e)));var I=Math.floor((n-1)/2),o=zW(LW(D=>y.add(new lo(D-I).mul(u)).toNumber()),zS);return o(0,n)},az=function(n,l,u,y){var b=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((l-n)/(u-1)))return{step:new lo(0),tickMin:new lo(0),tickMax:new lo(0)};var I=oz(new lo(l).sub(n).div(u-1),y,b),o;n<=0&&l>=0?o=new lo(0):(o=new lo(n).add(l).div(2),o=o.sub(new lo(o).mod(I)));var D=Math.ceil(o.sub(n).div(I).toNumber()),k=Math.ceil(new lo(l).sub(o).div(I).toNumber()),L=D+k+1;return L>u?az(n,l,u,y,b+1):(L<u&&(k=l>0?k+(u-L):k,D=l>0?D:D+(u-L)),{step:I,tickMin:o.sub(new lo(D).mul(I)),tickMax:o.add(new lo(k).mul(I))})};function NW(e){var[n,l]=e,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,b=Math.max(u,2),[I,o]=iz([n,l]);if(I===-1/0||o===1/0){var D=o===1/0?[I,...zS(0,u-1).map(()=>1/0)]:[...zS(0,u-1).map(()=>-1/0),o];return n>l?FS(D):D}if(I===o)return FW(I,u,y);var{step:k,tickMin:L,tickMax:$}=az(I,o,b,y,0),q=nz(L,$.add(new lo(.1).mul(k)),k);return n>l?FS(q):q}function BW(e,n){var[l,u]=e,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,[b,I]=iz([l,u]);if(b===-1/0||I===1/0)return[l,u];if(b===I)return[b];var o=Math.max(n,2),D=oz(new lo(I).sub(b).div(o-1),y,0),k=[...nz(new lo(b),new lo(I),D),I];return y===!1&&(k=k.map(L=>Math.round(L))),l>u?FS(k):k}var jW=tz(NW),UW=tz(BW),sz=e=>e.rootProps.maxBarSize,VW=e=>e.rootProps.barGap,lz=e=>e.rootProps.barCategoryGap,$W=e=>e.rootProps.barSize,bx=e=>e.rootProps.stackOffset,dE=e=>e.options.chartName,fE=e=>e.rootProps.syncId,cz=e=>e.rootProps.syncMethod,pE=e=>e.options.eventEmitter,tf={allowDuplicatedCategory:!0,angleAxisId:0,reversed:!1,scale:"auto",tick:!0,type:"category"},xc={allowDataOverflow:!1,allowDuplicatedCategory:!0,radiusAxisId:0,scale:"auto",tick:!0,tickCount:5,type:"number"},wx=(e,n)=>{if(!(!e||!n))return e!=null&&e.reversed?[n[1],n[0]]:n},GW={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:tf.angleAxisId,includeHidden:!1,name:void 0,reversed:tf.reversed,scale:tf.scale,tick:tf.tick,tickCount:void 0,ticks:void 0,type:tf.type,unit:void 0},qW={allowDataOverflow:xc.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:xc.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:xc.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:xc.scale,tick:xc.tick,tickCount:xc.tickCount,ticks:void 0,type:xc.type,unit:void 0},WW={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:tf.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:tf.angleAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:tf.scale,tick:tf.tick,tickCount:void 0,ticks:void 0,type:"number",unit:void 0},HW={allowDataOverflow:xc.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:xc.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:xc.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:xc.scale,tick:xc.tick,tickCount:xc.tickCount,ticks:void 0,type:"category",unit:void 0},mE=(e,n)=>e.polarAxis.angleAxis[n]!=null?e.polarAxis.angleAxis[n]:e.layout.layoutType==="radial"?WW:GW,gE=(e,n)=>e.polarAxis.radiusAxis[n]!=null?e.polarAxis.radiusAxis[n]:e.layout.layoutType==="radial"?HW:qW,Sx=e=>e.polarOptions,_E=Ht([ff,pf,Ha],$6),uz=Ht([Sx,_E],(e,n)=>{if(e!=null)return sh(e.innerRadius,n,0)}),hz=Ht([Sx,_E],(e,n)=>{if(e!=null)return sh(e.outerRadius,n,n*.8)}),ZW=e=>{if(e==null)return[0,0];var{startAngle:n,endAngle:l}=e;return[n,l]},dz=Ht([Sx],ZW);Ht([mE,dz],wx);var fz=Ht([_E,uz,hz],(e,n,l)=>{if(!(e==null||n==null||l==null))return[n,l]});Ht([gE,fz],wx);var XW=Ht([xo,Sx,uz,hz,ff,pf],(e,n,l,u,y,b)=>{if(!(e!=="centric"&&e!=="radial"||n==null||l==null||u==null)){var{cx:I,cy:o,startAngle:D,endAngle:k}=n;return{cx:sh(I,y,y/2),cy:sh(o,b,b/2),innerRadius:l,outerRadius:u,startAngle:D,endAngle:k,clockWise:!1}}}),Xa=(e,n)=>n,Tx=(e,n,l)=>l;function qO(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function R0(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?qO(Object(l),!0).forEach(function(u){YW(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):qO(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function YW(e,n,l){return(n=KW(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function KW(e){var n=JW(e,"string");return typeof n=="symbol"?n:n+""}function JW(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var NS=[0,"auto"],yc={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},gf=(e,n)=>{var l=e.cartesianAxis.xAxis[n];return l??yc},vc={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:NS,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:hx},Ip=(e,n)=>{var l=e.cartesianAxis.yAxis[n];return l??vc},QW={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},yE=(e,n)=>{var l=e.cartesianAxis.zAxis[n];return l??QW},Wl=(e,n,l)=>{switch(n){case"xAxis":return gf(e,l);case"yAxis":return Ip(e,l);case"zAxis":return yE(e,l);case"angleAxis":return mE(e,l);case"radiusAxis":return gE(e,l);default:throw new Error("Unexpected axis type: ".concat(n))}},eH=(e,n,l)=>{switch(n){case"xAxis":return gf(e,l);case"yAxis":return Ip(e,l);default:throw new Error("Unexpected axis type: ".concat(n))}},ky=(e,n,l)=>{switch(n){case"xAxis":return gf(e,l);case"yAxis":return Ip(e,l);case"angleAxis":return mE(e,l);case"radiusAxis":return gE(e,l);default:throw new Error("Unexpected axis type: ".concat(n))}},pz=e=>e.graphicalItems.countOfBars>0;function mz(e,n){return l=>{switch(e){case"xAxis":return"xAxisId"in l&&l.xAxisId===n;case"yAxis":return"yAxisId"in l&&l.yAxisId===n;case"zAxis":return"zAxisId"in l&&l.zAxisId===n;case"angleAxis":return"angleAxisId"in l&&l.angleAxisId===n;case"radiusAxis":return"radiusAxisId"in l&&l.radiusAxisId===n;default:return!1}}}var vE=e=>e.graphicalItems.cartesianItems,tH=Ht([Xa,Tx],mz),gz=(e,n,l)=>e.filter(l).filter(u=>(n==null?void 0:n.includeHidden)===!0?!0:!u.hide),Ry=Ht([vE,Wl,tH],gz),_z=e=>e.filter(n=>n.stackId===void 0),rH=Ht([Ry],_z),yz=e=>e.map(n=>n.data).filter(Boolean).flat(1),nH=Ht([Ry],yz),vz=(e,n)=>{var{chartData:l=[],dataStartIndex:u,dataEndIndex:y}=n;return e.length>0?e:l.slice(u,y+1)},Ex=Ht([nH,WL],vz),xz=(e,n,l)=>(n==null?void 0:n.dataKey)!=null?e.map(u=>({value:Tc(u,n.dataKey)})):l.length>0?l.map(u=>u.dataKey).flatMap(u=>e.map(y=>({value:Tc(y,u)}))):e.map(u=>({value:u})),Ax=Ht([Ex,Wl,Ry],xz);function bz(e,n){switch(e){case"xAxis":return n.direction==="x";case"yAxis":return n.direction==="y";default:return!1}}function qm(e){return e.filter(n=>ld(n)||n instanceof Date).map(Number).filter(n=>Ec(n)===!1)}function iH(e,n,l){return!l||typeof n!="number"||Ec(n)?[]:l.length?qm(l.flatMap(u=>{var y=Tc(e,u.dataKey),b,I;if(Array.isArray(y)?[b,I]=y:b=I=y,!(!Pc(b)||!Pc(I)))return[n-b,n+I]})):[]}var wz=(e,n,l)=>{var u={},y=n.reduce((b,I)=>(I.stackId==null||(b[I.stackId]==null&&(b[I.stackId]=[]),b[I.stackId].push(I)),b),u);return Object.fromEntries(Object.entries(y).map(b=>{var[I,o]=b,D=o.map(k=>k.dataKey);return[I,{stackedData:o8(e,D,l),graphicalItems:o}]}))},BS=Ht([Ex,Ry,bx],wz),Sz=(e,n,l)=>{var{dataStartIndex:u,dataEndIndex:y}=n;if(l!=="zAxis"){var b=c8(e,u,y);if(!(b!=null&&b[0]===0&&b[1]===0))return b}},oH=Ht([BS,Gm,Xa],Sz),Tz=(e,n,l,u)=>l.length>0?e.flatMap(y=>l.flatMap(b=>{var I,o,D=(I=b.errorBars)===null||I===void 0?void 0:I.filter(L=>bz(u,L)),k=Tc(y,(o=n.dataKey)!==null&&o!==void 0?o:b.dataKey);return{value:k,errorDomain:iH(y,k,D)}})).filter(Boolean):(n==null?void 0:n.dataKey)!=null?e.map(y=>({value:Tc(y,n.dataKey),errorDomain:[]})):e.map(y=>({value:y,errorDomain:[]})),aH=Ht(Ex,Wl,rH,Xa,Tz);function sH(e){var{value:n}=e;if(ld(n)||n instanceof Date)return n}var lH=e=>{var n=e.flatMap(u=>[u.value,u.errorDomain]).flat(1),l=qm(n);if(l.length!==0)return[Math.min(...l),Math.max(...l)]},cH=(e,n,l)=>{var u=e.map(sH).filter(y=>y!=null);return l&&(n.dataKey==null||n.allowDuplicatedCategory&&Gk(u))?cL(0,e.length):n.allowDuplicatedCategory?u:Array.from(new Set(u))},xE=e=>{var n;if(e==null||!("domain"in e))return NS;if(e.domain!=null)return e.domain;if(e.ticks!=null){if(e.type==="number"){var l=qm(e.ticks);return[Math.min(...l),Math.max(...l)]}if(e.type==="category")return e.ticks.map(String)}return(n=e==null?void 0:e.domain)!==null&&n!==void 0?n:NS},bE=function(){for(var n=arguments.length,l=new Array(n),u=0;u<n;u++)l[u]=arguments[u];var y=l.filter(Boolean);if(y.length!==0){var b=y.flat(),I=Math.min(...b),o=Math.max(...b);return[I,o]}},Ez=e=>e.referenceElements.dots,Wg=(e,n,l)=>e.filter(u=>u.ifOverflow==="extendDomain").filter(u=>n==="xAxis"?u.xAxisId===l:u.yAxisId===l),uH=Ht([Ez,Xa,Tx],Wg),Az=e=>e.referenceElements.areas,hH=Ht([Az,Xa,Tx],Wg),Iz=e=>e.referenceElements.lines,dH=Ht([Iz,Xa,Tx],Wg),Pz=(e,n)=>{var l=qm(e.map(u=>n==="xAxis"?u.x:u.y));if(l.length!==0)return[Math.min(...l),Math.max(...l)]},fH=Ht(uH,Xa,Pz),Cz=(e,n)=>{var l=qm(e.flatMap(u=>[n==="xAxis"?u.x1:u.y1,n==="xAxis"?u.x2:u.y2]));if(l.length!==0)return[Math.min(...l),Math.max(...l)]},pH=Ht([hH,Xa],Cz),Mz=(e,n)=>{var l=qm(e.map(u=>n==="xAxis"?u.x:u.y));if(l.length!==0)return[Math.min(...l),Math.max(...l)]},mH=Ht(dH,Xa,Mz),gH=Ht(fH,mH,pH,(e,n,l)=>bE(e,l,n)),_H=Ht([Wl],xE),Oz=(e,n,l,u,y)=>{var b=CW(n,e.allowDataOverflow);return b??MW(n,bE(l,y,lH(u)),e.allowDataOverflow)},yH=Ht([Wl,_H,oH,aH,gH],Oz),vH=[0,1],Dz=(e,n,l,u,y,b,I)=>{if(!(e==null||l==null||l.length===0)){var{dataKey:o,type:D}=e,k=Um(n,b);return k&&o==null?cL(0,l.length):D==="category"?cH(u,e,k):y==="expand"?vH:I}},wE=Ht([Wl,xo,Ex,Ax,bx,Xa,yH],Dz),kz=(e,n,l,u,y)=>{if(e!=null){var{scale:b,type:I}=e;if(b==="auto")return n==="radial"&&y==="radiusAxis"?"band":n==="radial"&&y==="angleAxis"?"linear":I==="category"&&u&&(u.indexOf("LineChart")>=0||u.indexOf("AreaChart")>=0||u.indexOf("ComposedChart")>=0&&!l)?"point":I==="category"?"band":"linear";if(typeof b=="string"){var o="scale".concat(Ay(b));return o in ry?o:"point"}}},Ly=Ht([Wl,xo,pz,dE,Xa],kz);function xH(e){if(e!=null){if(e in ry)return ry[e]();var n="scale".concat(Ay(e));if(n in ry)return ry[n]()}}function SE(e,n,l,u){if(!(l==null||u==null)){if(typeof e.scale=="function")return e.scale.copy().domain(l).range(u);var y=xH(n);if(y!=null){var b=y.domain(l).range(u);return e8(b),b}}}var Rz=(e,n,l)=>{var u=xE(n);if(!(l!=="auto"&&l!=="linear")){if(n!=null&&n.tickCount&&Array.isArray(u)&&(u[0]==="auto"||u[1]==="auto")&&Fg(e))return jW(e,n.tickCount,n.allowDecimals);if(n!=null&&n.tickCount&&n.type==="number"&&Fg(e))return UW(e,n.tickCount,n.allowDecimals)}},TE=Ht([wE,ky,Ly],Rz),Lz=(e,n,l,u)=>{if(u!=="angleAxis"&&(e==null?void 0:e.type)==="number"&&Fg(n)&&Array.isArray(l)&&l.length>0){var y=n[0],b=l[0],I=n[1],o=l[l.length-1];return[Math.min(y,b),Math.max(I,o)]}return n},bH=Ht([Wl,wE,TE,Xa],Lz),wH=Ht(Ax,Wl,(e,n)=>{if(!(!n||n.type!=="number")){var l=1/0,u=Array.from(qm(e.map(o=>o.value))).sort((o,D)=>o-D);if(u.length<2)return 1/0;var y=u[u.length-1]-u[0];if(y===0)return 1/0;for(var b=0;b<u.length-1;b++){var I=u[b+1]-u[b];l=Math.min(l,I)}return l/y}}),zz=Ht(wH,xo,lz,Ha,(e,n,l,u)=>u,(e,n,l,u,y)=>{if(!Pc(e))return 0;var b=n==="vertical"?u.height:u.width;if(y==="gap")return e*b/2;if(y==="no-gap"){var I=sh(l,e*b),o=e*b/2;return o-I-(o-I)/b*I}return 0}),SH=(e,n)=>{var l=gf(e,n);return l==null||typeof l.padding!="string"?0:zz(e,"xAxis",n,l.padding)},TH=(e,n)=>{var l=Ip(e,n);return l==null||typeof l.padding!="string"?0:zz(e,"yAxis",n,l.padding)},EH=Ht(gf,SH,(e,n)=>{var l,u;if(e==null)return{left:0,right:0};var{padding:y}=e;return typeof y=="string"?{left:n,right:n}:{left:((l=y.left)!==null&&l!==void 0?l:0)+n,right:((u=y.right)!==null&&u!==void 0?u:0)+n}}),AH=Ht(Ip,TH,(e,n)=>{var l,u;if(e==null)return{top:0,bottom:0};var{padding:y}=e;return typeof y=="string"?{top:n,bottom:n}:{top:((l=y.top)!==null&&l!==void 0?l:0)+n,bottom:((u=y.bottom)!==null&&u!==void 0?u:0)+n}}),IH=Ht([Ha,EH,fx,dx,(e,n,l)=>l],(e,n,l,u,y)=>{var{padding:b}=u;return y?[b.left,l.width-b.right]:[e.left+n.left,e.left+e.width-n.right]}),PH=Ht([Ha,xo,AH,fx,dx,(e,n,l)=>l],(e,n,l,u,y,b)=>{var{padding:I}=y;return b?[u.height-I.bottom,I.top]:n==="horizontal"?[e.top+e.height-l.bottom,e.top+l.top]:[e.top+l.top,e.top+e.height-l.bottom]}),zy=(e,n,l,u)=>{var y;switch(n){case"xAxis":return IH(e,l,u);case"yAxis":return PH(e,l,u);case"zAxis":return(y=yE(e,l))===null||y===void 0?void 0:y.range;case"angleAxis":return dz(e);case"radiusAxis":return fz(e,l);default:return}},Fz=Ht([Wl,zy],wx),Hg=Ht([Wl,Ly,bH,Fz],SE);Ht(Ry,Xa,(e,n)=>e.flatMap(l=>{var u;return(u=l.errorBars)!==null&&u!==void 0?u:[]}).filter(l=>bz(n,l)));function Nz(e,n){return e.id<n.id?-1:e.id>n.id?1:0}var Ix=(e,n)=>n,Px=(e,n,l)=>l,CH=Ht(FT,Ix,Px,(e,n,l)=>e.filter(u=>u.orientation===n).filter(u=>u.mirror===l).sort(Nz)),MH=Ht(NT,Ix,Px,(e,n,l)=>e.filter(u=>u.orientation===n).filter(u=>u.mirror===l).sort(Nz)),Bz=(e,n)=>({width:e.width,height:n.height}),OH=(e,n)=>{var l=typeof n.width=="number"?n.width:hx;return{width:l,height:e.height}},jz=Ht(Ha,gf,Bz),DH=(e,n,l)=>{switch(n){case"top":return e.top;case"bottom":return l-e.bottom;default:return 0}},kH=(e,n,l)=>{switch(n){case"left":return e.left;case"right":return l-e.right;default:return 0}},RH=Ht(pf,Ha,CH,Ix,Px,(e,n,l,u,y)=>{var b={},I;return l.forEach(o=>{var D=Bz(n,o);I==null&&(I=DH(n,u,e));var k=u==="top"&&!y||u==="bottom"&&y;b[o.id]=I-Number(k)*D.height,I+=(k?-1:1)*D.height}),b}),LH=Ht(ff,Ha,MH,Ix,Px,(e,n,l,u,y)=>{var b={},I;return l.forEach(o=>{var D=OH(n,o);I==null&&(I=kH(n,u,e));var k=u==="left"&&!y||u==="right"&&y;b[o.id]=I-Number(k)*D.width,I+=(k?-1:1)*D.width}),b}),zH=(e,n)=>{var l=Ha(e),u=gf(e,n);if(u!=null){var y=RH(e,u.orientation,u.mirror),b=y[n];return b==null?{x:l.left,y:0}:{x:l.left,y:b}}},FH=(e,n)=>{var l=Ha(e),u=Ip(e,n);if(u!=null){var y=LH(e,u.orientation,u.mirror),b=y[n];return b==null?{x:0,y:l.top}:{x:b,y:l.top}}},Uz=Ht(Ha,Ip,(e,n)=>{var l=typeof n.width=="number"?n.width:hx;return{width:l,height:e.height}}),WO=(e,n,l)=>{switch(n){case"xAxis":return jz(e,l).width;case"yAxis":return Uz(e,l).height;default:return}},Vz=(e,n,l,u)=>{if(l!=null){var{allowDuplicatedCategory:y,type:b,dataKey:I}=l,o=Um(e,u),D=n.map(k=>k.value);if(I&&o&&b==="category"&&y&&Gk(D))return D}},EE=Ht([xo,Ax,Wl,Xa],Vz),$z=(e,n,l,u)=>{if(!(l==null||l.dataKey==null)){var{type:y,scale:b}=l,I=Um(e,u);if(I&&(y==="number"||b!=="auto"))return n.map(o=>o.value)}},AE=Ht([xo,Ax,ky,Xa],$z),HO=Ht([xo,eH,Ly,Hg,EE,AE,zy,TE,Xa],(e,n,l,u,y,b,I,o,D)=>{if(n==null)return null;var k=Um(e,D);return{angle:n.angle,interval:n.interval,minTickGap:n.minTickGap,orientation:n.orientation,tick:n.tick,tickCount:n.tickCount,tickFormatter:n.tickFormatter,ticks:n.ticks,type:n.type,unit:n.unit,axisType:D,categoricalDomain:b,duplicateDomain:y,isCategorical:k,niceTicks:o,range:I,realScaleType:l,scale:u}}),NH=(e,n,l,u,y,b,I,o,D)=>{if(!(n==null||u==null)){var k=Um(e,D),{type:L,ticks:$,tickCount:q}=n,Z=l==="scaleBand"&&typeof u.bandwidth=="function"?u.bandwidth()/2:2,ie=L==="category"&&u.bandwidth?u.bandwidth()/Z:0;ie=D==="angleAxis"&&b!=null&&b.length>=2?$l(b[0]-b[1])*2*ie:ie;var oe=$||y;if(oe){var le=oe.map((xe,ge)=>{var ke=I?I.indexOf(xe):xe;return{index:ge,coordinate:u(ke)+ie,value:xe,offset:ie}});return le.filter(xe=>!Ec(xe.coordinate))}return k&&o?o.map((xe,ge)=>({coordinate:u(xe)+ie,value:xe,index:ge,offset:ie})):u.ticks?u.ticks(q).map(xe=>({coordinate:u(xe)+ie,value:xe,offset:ie})):u.domain().map((xe,ge)=>({coordinate:u(xe)+ie,value:I?I[xe]:xe,index:ge,offset:ie}))}},Gz=Ht([xo,ky,Ly,Hg,TE,zy,EE,AE,Xa],NH),BH=(e,n,l,u,y,b,I)=>{if(!(n==null||l==null||u==null||u[0]===u[1])){var o=Um(e,I),{tickCount:D}=n,k=0;return k=I==="angleAxis"&&(u==null?void 0:u.length)>=2?$l(u[0]-u[1])*2*k:k,o&&b?b.map((L,$)=>({coordinate:l(L)+k,value:L,index:$,offset:k})):l.ticks?l.ticks(D).map(L=>({coordinate:l(L)+k,value:L,offset:k})):l.domain().map((L,$)=>({coordinate:l(L)+k,value:y?y[L]:L,index:$,offset:k}))}},Ng=Ht([xo,ky,Hg,zy,EE,AE,Xa],BH),xp=Ht(Wl,Hg,(e,n)=>{if(!(e==null||n==null))return R0(R0({},e),{},{scale:n})}),jH=Ht([Wl,Ly,wE,Fz],SE);Ht((e,n,l)=>yE(e,l),jH,(e,n)=>{if(!(e==null||n==null))return R0(R0({},e),{},{scale:n})});var UH=Ht([xo,FT,NT],(e,n,l)=>{switch(e){case"horizontal":return n.some(u=>u.reversed)?"right-to-left":"left-to-right";case"vertical":return l.some(u=>u.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}}),qz=e=>e.options.defaultTooltipEventType,Wz=e=>e.options.validateTooltipEventTypes;function Hz(e,n,l){if(e==null)return n;var u=e?"axis":"item";return l==null?n:l.includes(u)?u:n}function IE(e,n){var l=qz(e),u=Wz(e);return Hz(n,l,u)}function VH(e){return Ln(n=>IE(n,e))}var Zz=(e,n)=>{var l,u=Number(n);if(!(Ec(u)||n==null))return u>=0?e==null||(l=e[u])===null||l===void 0?void 0:l.value:void 0},$H=e=>e.tooltip.settings,gp={active:!1,index:null,dataKey:void 0,coordinate:void 0},GH={itemInteraction:{click:gp,hover:gp},axisInteraction:{click:gp,hover:gp},keyboardInteraction:gp,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},Xz=mu({name:"tooltip",initialState:GH,reducers:{addTooltipEntrySettings(e,n){e.tooltipItemPayloads.push(n.payload)},removeTooltipEntrySettings(e,n){var l=af(e).tooltipItemPayloads.indexOf(n.payload);l>-1&&e.tooltipItemPayloads.splice(l,1)},setTooltipSettingsState(e,n){e.settings=n.payload},setActiveMouseOverItemIndex(e,n){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.itemInteraction.hover.active=!0,e.itemInteraction.hover.index=n.payload.activeIndex,e.itemInteraction.hover.dataKey=n.payload.activeDataKey,e.itemInteraction.hover.coordinate=n.payload.activeCoordinate},mouseLeaveChart(e){e.itemInteraction.hover.active=!1,e.axisInteraction.hover.active=!1},mouseLeaveItem(e){e.itemInteraction.hover.active=!1},setActiveClickItemIndex(e,n){e.syncInteraction.active=!1,e.itemInteraction.click.active=!0,e.keyboardInteraction.active=!1,e.itemInteraction.click.index=n.payload.activeIndex,e.itemInteraction.click.dataKey=n.payload.activeDataKey,e.itemInteraction.click.coordinate=n.payload.activeCoordinate},setMouseOverAxisIndex(e,n){e.syncInteraction.active=!1,e.axisInteraction.hover.active=!0,e.keyboardInteraction.active=!1,e.axisInteraction.hover.index=n.payload.activeIndex,e.axisInteraction.hover.dataKey=n.payload.activeDataKey,e.axisInteraction.hover.coordinate=n.payload.activeCoordinate},setMouseClickAxisIndex(e,n){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.axisInteraction.click.active=!0,e.axisInteraction.click.index=n.payload.activeIndex,e.axisInteraction.click.dataKey=n.payload.activeDataKey,e.axisInteraction.click.coordinate=n.payload.activeCoordinate},setSyncInteraction(e,n){e.syncInteraction=n.payload},setKeyboardInteraction(e,n){e.keyboardInteraction.active=n.payload.active,e.keyboardInteraction.index=n.payload.activeIndex,e.keyboardInteraction.coordinate=n.payload.activeCoordinate,e.keyboardInteraction.dataKey=n.payload.activeDataKey}}}),{addTooltipEntrySettings:qH,removeTooltipEntrySettings:WH,setTooltipSettingsState:HH,setActiveMouseOverItemIndex:Yz,mouseLeaveItem:ZH,mouseLeaveChart:Kz,setActiveClickItemIndex:XH,setMouseOverAxisIndex:Jz,setMouseClickAxisIndex:YH,setSyncInteraction:jS,setKeyboardInteraction:US}=Xz.actions,KH=Xz.reducer;function ZO(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function Kv(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?ZO(Object(l),!0).forEach(function(u){JH(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):ZO(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function JH(e,n,l){return(n=QH(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function QH(e){var n=e7(e,"string");return typeof n=="symbol"?n:n+""}function e7(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function t7(e,n,l){return n==="axis"?l==="click"?e.axisInteraction.click:e.axisInteraction.hover:l==="click"?e.itemInteraction.click:e.itemInteraction.hover}function r7(e){return e.index!=null}var Qz=(e,n,l,u)=>{if(n==null)return gp;var y=t7(e,n,l);if(y==null)return gp;if(y.active)return y;if(e.keyboardInteraction.active)return e.keyboardInteraction;if(e.syncInteraction.active&&e.syncInteraction.index!=null)return e.syncInteraction;var b=e.settings.active===!0;if(r7(y)){if(b)return Kv(Kv({},y),{},{active:!0})}else if(u!=null)return{active:!0,coordinate:void 0,dataKey:void 0,index:u};return Kv(Kv({},gp),{},{coordinate:y.coordinate})},PE=(e,n)=>{var l=e==null?void 0:e.index;if(l==null)return null;var u=Number(l);if(!Pc(u))return l;var y=0,b=1/0;return n.length>0&&(b=n.length-1),String(Math.max(y,Math.min(u,b)))},e3=(e,n,l,u,y,b,I,o)=>{if(!(b==null||o==null)){var D=I[0],k=D==null?void 0:o(D.positions,b);if(k!=null)return k;var L=y==null?void 0:y[Number(b)];if(L)switch(l){case"horizontal":return{x:L.coordinate,y:(u.top+n)/2};default:return{x:(u.left+e)/2,y:L.coordinate}}}},t3=(e,n,l,u)=>{if(n==="axis")return e.tooltipItemPayloads;if(e.tooltipItemPayloads.length===0)return[];var y;return l==="hover"?y=e.itemInteraction.hover.dataKey:y=e.itemInteraction.click.dataKey,y==null&&u!=null?[e.tooltipItemPayloads[0]]:e.tooltipItemPayloads.filter(b=>{var I;return((I=b.settings)===null||I===void 0?void 0:I.dataKey)===y})},Fy=e=>e.options.tooltipPayloadSearcher,Zg=e=>e.tooltip;function XO(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function YO(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?XO(Object(l),!0).forEach(function(u){n7(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):XO(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function n7(e,n,l){return(n=i7(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function i7(e){var n=o7(e,"string");return typeof n=="symbol"?n:n+""}function o7(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function a7(e,n,l){return Array.isArray(e)&&e&&n+l!==0?e.slice(n,l+1):e}function s7(e,n){return e??n}var r3=(e,n,l,u,y,b,I)=>{if(!(n==null||b==null)){var{chartData:o,computedData:D,dataStartIndex:k,dataEndIndex:L}=l,$=[];return e.reduce((q,Z)=>{var ie,{dataDefinedOnItem:oe,settings:le}=Z,xe=s7(oe,o),ge=a7(xe,k,L),ke=(ie=le==null?void 0:le.dataKey)!==null&&ie!==void 0?ie:u==null?void 0:u.dataKey,et=le==null?void 0:le.nameKey,ze;if(u!=null&&u.dataKey&&Array.isArray(ge)&&!Array.isArray(ge[0])&&I==="axis"?ze=W5(ge,u.dataKey,y):ze=b(ge,n,D,et),Array.isArray(ze))ze.forEach(pt=>{var Gt=YO(YO({},le),{},{name:pt.name,unit:pt.unit,color:void 0,fill:void 0});q.push(MM({tooltipEntrySettings:Gt,dataKey:pt.dataKey,payload:pt.payload,value:Tc(pt.payload,pt.dataKey),name:pt.name}))});else{var nt;q.push(MM({tooltipEntrySettings:le,dataKey:ke,payload:ze,value:Tc(ze,ke),name:(nt=Tc(ze,et))!==null&&nt!==void 0?nt:le==null?void 0:le.name}))}return q},$)}},Ya=e=>{var n=xo(e);return n==="horizontal"?"xAxis":n==="vertical"?"yAxis":n==="centric"?"angleAxis":"radiusAxis"},Xg=e=>e.tooltip.settings.axisId,_s=e=>{var n=Ya(e),l=Xg(e);return ky(e,n,l)},CE=Ht([_s,xo,pz,dE,Ya],kz),l7=Ht([e=>e.graphicalItems.cartesianItems,e=>e.graphicalItems.polarItems],(e,n)=>[...e,...n]),c7=Ht([Ya,Xg],mz),Cx=Ht([l7,_s,c7],gz),u7=Ht([Cx],yz),Wm=Ht([u7,Gm],vz),ME=Ht([Wm,_s,Cx],xz),h7=Ht([_s],xE),d7=Ht([Wm,Cx,bx],wz),f7=Ht([d7,Gm,Ya],Sz),p7=Ht([Cx],_z),m7=Ht([Wm,_s,p7,Ya],Tz),g7=Ht([Ez,Ya,Xg],Wg),_7=Ht([g7,Ya],Pz),y7=Ht([Az,Ya,Xg],Wg),v7=Ht([y7,Ya],Cz),x7=Ht([Iz,Ya,Xg],Wg),b7=Ht([x7,Ya],Mz),w7=Ht([_7,b7,v7],bE),S7=Ht([_s,h7,f7,m7,w7],Oz),n3=Ht([_s,xo,Wm,ME,bx,Ya,S7],Dz),T7=Ht([n3,_s,CE],Rz),E7=Ht([_s,n3,T7,Ya],Lz),i3=e=>{var n=Ya(e),l=Xg(e),u=!1;return zy(e,n,l,u)},o3=Ht([_s,i3],wx),a3=Ht([_s,CE,E7,o3],SE),A7=Ht([xo,ME,_s,Ya],Vz),I7=Ht([xo,ME,_s,Ya],$z),P7=(e,n,l,u,y,b,I,o)=>{if(n){var{type:D}=n,k=Um(e,o);if(u){var L=l==="scaleBand"&&u.bandwidth?u.bandwidth()/2:2,$=D==="category"&&u.bandwidth?u.bandwidth()/L:0;return $=o==="angleAxis"&&y!=null&&(y==null?void 0:y.length)>=2?$l(y[0]-y[1])*2*$:$,k&&I?I.map((q,Z)=>({coordinate:u(q)+$,value:q,index:Z,offset:$})):u.domain().map((q,Z)=>({coordinate:u(q)+$,value:b?b[q]:q,index:Z,offset:$}))}}},_f=Ht([xo,_s,CE,a3,i3,A7,I7,Ya],P7),OE=Ht([qz,Wz,$H],(e,n,l)=>Hz(l.shared,e,n)),s3=e=>e.tooltip.settings.trigger,DE=e=>e.tooltip.settings.defaultIndex,Mx=Ht([Zg,OE,s3,DE],Qz),Bg=Ht([Mx,Wm],PE),l3=Ht([_f,Bg],Zz),c3=Ht([Mx],e=>{if(e)return e.dataKey}),u3=Ht([Zg,OE,s3,DE],t3),C7=Ht([ff,pf,xo,Ha,_f,DE,u3,Fy],e3),M7=Ht([Mx,C7],(e,n)=>e!=null&&e.coordinate?e.coordinate:n),O7=Ht([Mx],e=>e.active),D7=Ht([u3,Bg,Gm,_s,l3,Fy,OE],r3);Ht([D7],e=>{if(e!=null){var n=e.map(l=>l.payload).filter(l=>l!=null);return Array.from(new Set(n))}});function KO(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function JO(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?KO(Object(l),!0).forEach(function(u){k7(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):KO(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function k7(e,n,l){return(n=R7(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function R7(e){var n=L7(e,"string");return typeof n=="symbol"?n:n+""}function L7(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var z7=()=>Ln(_s),F7=()=>{var e=z7(),n=Ln(_f),l=Ln(a3);return zT(JO(JO({},e),{},{scale:l}),n)},N7=()=>Ln(dE),kE=(e,n)=>n,h3=(e,n,l)=>l,RE=(e,n,l,u)=>u,B7=Ht(_f,e=>ix(e,n=>n.coordinate)),LE=Ht([Zg,kE,h3,RE],Qz),d3=Ht([LE,Wm],PE),j7=(e,n,l)=>{if(n!=null){var u=Zg(e);return n==="axis"?l==="hover"?u.axisInteraction.hover.dataKey:u.axisInteraction.click.dataKey:l==="hover"?u.itemInteraction.hover.dataKey:u.itemInteraction.click.dataKey}},f3=Ht([Zg,kE,h3,RE],t3),L0=Ht([ff,pf,xo,Ha,_f,RE,f3,Fy],e3),U7=Ht([LE,L0],(e,n)=>{var l;return(l=e.coordinate)!==null&&l!==void 0?l:n}),p3=Ht(_f,d3,Zz),V7=Ht([f3,d3,Gm,_s,p3,Fy,kE],r3),$7=Ht([LE],e=>({isActive:e.active,activeIndex:e.index})),G7=(e,n,l,u,y,b,I,o)=>{if(!(!e||!n||!u||!y||!b)){var D=u8(e.chartX,e.chartY,n,l,o);if(D){var k=d8(D,n),L=J6(k,I,b,u,y),$=h8(n,b,L,D);return{activeIndex:String(L),activeCoordinate:$}}}};function VS(){return VS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},VS.apply(null,arguments)}function QO(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function Jv(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?QO(Object(l),!0).forEach(function(u){q7(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):QO(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function q7(e,n,l){return(n=W7(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function W7(e){var n=H7(e,"string");return typeof n=="symbol"?n:n+""}function H7(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Z7(e){var{coordinate:n,payload:l,index:u,offset:y,tooltipAxisBandSize:b,layout:I,cursor:o,tooltipEventType:D,chartName:k}=e,L=n,$=l,q=u;if(!o||!L||k!=="ScatterChart"&&D!=="axis")return null;var Z,ie;if(k==="ScatterChart")Z=L,ie=e$;else if(k==="BarChart")Z=t$(I,L,y,b),ie=oL;else if(I==="radial"){var{cx:oe,cy:le,radius:xe,startAngle:ge,endAngle:ke}=aL(L);Z={cx:oe,cy:le,startAngle:ge,endAngle:ke,innerRadius:xe,outerRadius:xe},ie=lL}else Z={points:U$(I,L,y)},ie=q8;var et=typeof o=="object"&&"className"in o?o.className:void 0,ze=Jv(Jv(Jv(Jv({stroke:"#ccc",pointerEvents:"none"},y),Z),$o(o,!1)),{},{payload:$,payloadIndex:q,className:co("recharts-tooltip-cursor",et)});return Ae.isValidElement(o)?Ae.cloneElement(o,ze):Ae.createElement(ie,ze)}function X7(e){var n=F7(),l=KR(),u=jT(),y=N7();return Ae.createElement(Z7,VS({},e,{coordinate:e.coordinate,index:e.index,payload:e.payload,offset:l,layout:u,tooltipAxisBandSize:n,chartName:y}))}var m3=Ae.createContext(null),Y7=()=>Ae.useContext(m3),Aw={exports:{}},eD;function K7(){return eD||(eD=1,function(e){var n=Object.prototype.hasOwnProperty,l="~";function u(){}Object.create&&(u.prototype=Object.create(null),new u().__proto__||(l=!1));function y(D,k,L){this.fn=D,this.context=k,this.once=L||!1}function b(D,k,L,$,q){if(typeof L!="function")throw new TypeError("The listener must be a function");var Z=new y(L,$||D,q),ie=l?l+k:k;return D._events[ie]?D._events[ie].fn?D._events[ie]=[D._events[ie],Z]:D._events[ie].push(Z):(D._events[ie]=Z,D._eventsCount++),D}function I(D,k){--D._eventsCount===0?D._events=new u:delete D._events[k]}function o(){this._events=new u,this._eventsCount=0}o.prototype.eventNames=function(){var k=[],L,$;if(this._eventsCount===0)return k;for($ in L=this._events)n.call(L,$)&&k.push(l?$.slice(1):$);return Object.getOwnPropertySymbols?k.concat(Object.getOwnPropertySymbols(L)):k},o.prototype.listeners=function(k){var L=l?l+k:k,$=this._events[L];if(!$)return[];if($.fn)return[$.fn];for(var q=0,Z=$.length,ie=new Array(Z);q<Z;q++)ie[q]=$[q].fn;return ie},o.prototype.listenerCount=function(k){var L=l?l+k:k,$=this._events[L];return $?$.fn?1:$.length:0},o.prototype.emit=function(k,L,$,q,Z,ie){var oe=l?l+k:k;if(!this._events[oe])return!1;var le=this._events[oe],xe=arguments.length,ge,ke;if(le.fn){switch(le.once&&this.removeListener(k,le.fn,void 0,!0),xe){case 1:return le.fn.call(le.context),!0;case 2:return le.fn.call(le.context,L),!0;case 3:return le.fn.call(le.context,L,$),!0;case 4:return le.fn.call(le.context,L,$,q),!0;case 5:return le.fn.call(le.context,L,$,q,Z),!0;case 6:return le.fn.call(le.context,L,$,q,Z,ie),!0}for(ke=1,ge=new Array(xe-1);ke<xe;ke++)ge[ke-1]=arguments[ke];le.fn.apply(le.context,ge)}else{var et=le.length,ze;for(ke=0;ke<et;ke++)switch(le[ke].once&&this.removeListener(k,le[ke].fn,void 0,!0),xe){case 1:le[ke].fn.call(le[ke].context);break;case 2:le[ke].fn.call(le[ke].context,L);break;case 3:le[ke].fn.call(le[ke].context,L,$);break;case 4:le[ke].fn.call(le[ke].context,L,$,q);break;default:if(!ge)for(ze=1,ge=new Array(xe-1);ze<xe;ze++)ge[ze-1]=arguments[ze];le[ke].fn.apply(le[ke].context,ge)}}return!0},o.prototype.on=function(k,L,$){return b(this,k,L,$,!1)},o.prototype.once=function(k,L,$){return b(this,k,L,$,!0)},o.prototype.removeListener=function(k,L,$,q){var Z=l?l+k:k;if(!this._events[Z])return this;if(!L)return I(this,Z),this;var ie=this._events[Z];if(ie.fn)ie.fn===L&&(!q||ie.once)&&(!$||ie.context===$)&&I(this,Z);else{for(var oe=0,le=[],xe=ie.length;oe<xe;oe++)(ie[oe].fn!==L||q&&!ie[oe].once||$&&ie[oe].context!==$)&&le.push(ie[oe]);le.length?this._events[Z]=le.length===1?le[0]:le:I(this,Z)}return this},o.prototype.removeAllListeners=function(k){var L;return k?(L=l?l+k:k,this._events[L]&&I(this,L)):(this._events=new u,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=l,o.EventEmitter=o,e.exports=o}(Aw)),Aw.exports}var J7=K7();const Q7=Bs(J7);var gy=new Q7,$S="recharts.syncEvent.tooltip",tD="recharts.syncEvent.brush";function e9(e,n){if(n){var l=Number.parseInt(n,10);if(!Ec(l))return e==null?void 0:e[l]}}var t9={chartName:"",tooltipPayloadSearcher:void 0,eventEmitter:void 0,defaultTooltipEventType:"axis"},g3=mu({name:"options",initialState:t9,reducers:{createEventEmitter:e=>{e.eventEmitter==null&&(e.eventEmitter=Symbol("rechartsEventEmitter"))}}}),r9=g3.reducer,{createEventEmitter:n9}=g3.actions;function i9(e){return e.tooltip.syncInteraction}var o9={chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},_3=mu({name:"chartData",initialState:o9,reducers:{setChartData(e,n){if(e.chartData=n.payload,n.payload==null){e.dataStartIndex=0,e.dataEndIndex=0;return}n.payload.length>0&&e.dataEndIndex!==n.payload.length-1&&(e.dataEndIndex=n.payload.length-1)},setComputedData(e,n){e.computedData=n.payload},setDataStartEndIndexes(e,n){var{startIndex:l,endIndex:u}=n.payload;l!=null&&(e.dataStartIndex=l),u!=null&&(e.dataEndIndex=u)}}}),{setChartData:rD,setDataStartEndIndexes:a9,setComputedData:UJ}=_3.actions,s9=_3.reducer,y3=()=>{};function l9(){var e=Ln(fE),n=Ln(pE),l=Ba(),u=Ln(cz),y=Ln(_f),b=jT(),I=BT(),o=Ln(D=>D.rootProps.className);Ae.useEffect(()=>{if(e==null)return y3;var D=(k,L,$)=>{if(n!==$&&e===k){if(u==="index"){l(L);return}if(y!=null){var q;if(typeof u=="function"){var Z={activeTooltipIndex:L.payload.index==null?void 0:Number(L.payload.index),isTooltipActive:L.payload.active,activeIndex:L.payload.index==null?void 0:Number(L.payload.index),activeLabel:L.payload.label,activeDataKey:L.payload.dataKey,activeCoordinate:L.payload.coordinate},ie=u(y,Z);q=y[ie]}else u==="value"&&(q=y.find(nt=>String(nt.value)===L.payload.label));var{coordinate:oe}=L.payload;if(q==null||L.payload.active===!1||oe==null||I==null){l(jS({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0}));return}var{x:le,y:xe}=oe,ge=Math.min(le,I.x+I.width),ke=Math.min(xe,I.y+I.height),et={x:b==="horizontal"?q.coordinate:ge,y:b==="horizontal"?ke:q.coordinate},ze=jS({active:L.payload.active,coordinate:et,dataKey:L.payload.dataKey,index:String(q.index),label:L.payload.label});l(ze)}}};return gy.on($S,D),()=>{gy.off($S,D)}},[o,l,n,e,u,y,b,I])}function c9(){var e=Ln(fE),n=Ln(pE),l=Ba();Ae.useEffect(()=>{if(e==null)return y3;var u=(y,b,I)=>{n!==I&&e===y&&l(a9(b))};return gy.on(tD,u),()=>{gy.off(tD,u)}},[l,n,e])}function u9(){var e=Ba();Ae.useEffect(()=>{e(n9())},[e]),l9(),c9()}function h9(e,n,l,u,y,b){var I=Ln(q=>j7(q,e,n)),o=Ln(pE),D=Ln(fE),k=Ln(cz),L=Ln(i9),$=L==null?void 0:L.active;Ae.useEffect(()=>{if(!$&&D!=null&&o!=null){var q=jS({active:b,coordinate:l,dataKey:I,index:y,label:typeof u=="number"?String(u):u});gy.emit($S,D,q,o)}},[$,l,I,y,u,o,D,k,b])}function nD(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function iD(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?nD(Object(l),!0).forEach(function(u){d9(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):nD(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function d9(e,n,l){return(n=f9(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function f9(e){var n=p9(e,"string");return typeof n=="symbol"?n:n+""}function p9(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function m9(e){return e.dataKey}function g9(e,n){return Ae.isValidElement(e)?Ae.cloneElement(e,n):typeof e=="function"?Ae.createElement(e,n):Ae.createElement(O8,n)}var oD=[],_9={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,isAnimationActive:!Py.isSsr,itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function y9(e){var n=Tp(e,_9),{active:l,allowEscapeViewBox:u,animationDuration:y,animationEasing:b,content:I,filterNull:o,isAnimationActive:D,offset:k,payloadUniqBy:L,position:$,reverseDirection:q,useTranslate3d:Z,wrapperStyle:ie,cursor:oe,shared:le,trigger:xe,defaultIndex:ge,portal:ke,axisId:et}=n,ze=Ba(),nt=typeof ge=="number"?String(ge):ge;Ae.useEffect(()=>{ze(HH({shared:le,trigger:xe,axisId:et,active:l,defaultIndex:nt}))},[ze,le,xe,et,l,nt]);var pt=BT(),Gt=tL(),ir=VH(le),{activeIndex:Br,isActive:Zt}=Ln(Sr=>$7(Sr,ir,xe,nt)),dr=Ln(Sr=>V7(Sr,ir,xe,nt)),Dr=Ln(Sr=>p3(Sr,ir,xe,nt)),vr=Ln(Sr=>U7(Sr,ir,xe,nt)),Ar=dr,zr=Y7(),qr=l??Zt,[lr,br]=UV([Ar,qr]),Ft=ir==="axis"?Dr:void 0;h9(ir,xe,vr,Ft,Br,qr);var ot=ke??zr;if(ot==null)return null;var St=Ar??oD;qr||(St=oD),o&&St.length&&(St=fV(Ar.filter(Sr=>Sr.value!=null&&(Sr.hide!==!0||n.includeHidden)),L,m9));var Ur=St.length>0,gn=Ae.createElement(N8,{allowEscapeViewBox:u,animationDuration:y,animationEasing:b,isAnimationActive:D,active:qr,coordinate:vr,hasPayload:Ur,offset:k,position:$,reverseDirection:q,useTranslate3d:Z,viewBox:pt,wrapperStyle:ie,lastBoundingBox:lr,innerRef:br,hasPortalFromProps:!!ke},g9(I,iD(iD({},n),{},{payload:St,label:Ft,active:qr,coordinate:vr,accessibilityLayer:Gt})));return Ae.createElement(Ae.Fragment,null,iU.createPortal(gn,ot),qr&&Ae.createElement(X7,{cursor:oe,tooltipEventType:ir,coordinate:vr,payload:Ar,index:Br}))}var Iw={},Pw={},aD;function v9(){return aD||(aD=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l,u=0,y={}){typeof y!="object"&&(y={});let b=null,I=null,o=null,D=0,k=null,L;const{leading:$=!1,trailing:q=!0,maxWait:Z}=y,ie="maxWait"in y,oe=ie?Math.max(Number(Z)||0,u):0,le=pt=>(b!==null&&(L=l.apply(I,b)),b=I=null,D=pt,L),xe=pt=>(D=pt,k=setTimeout(ze,u),$&&b!==null?le(pt):L),ge=pt=>(k=null,q&&b!==null?le(pt):L),ke=pt=>{if(o===null)return!0;const Gt=pt-o,ir=Gt>=u||Gt<0,Br=ie&&pt-D>=oe;return ir||Br},et=pt=>{const Gt=o===null?0:pt-o,ir=u-Gt,Br=oe-(pt-D);return ie?Math.min(ir,Br):ir},ze=()=>{const pt=Date.now();if(ke(pt))return ge(pt);k=setTimeout(ze,et(pt))},nt=function(...pt){const Gt=Date.now(),ir=ke(Gt);if(b=pt,I=this,o=Gt,ir){if(k===null)return xe(Gt);if(ie)return clearTimeout(k),k=setTimeout(ze,u),le(Gt)}return k===null&&(k=setTimeout(ze,u)),L};return nt.cancel=()=>{k!==null&&clearTimeout(k),D=0,o=b=I=k=null},nt.flush=()=>k===null?L:ge(Date.now()),nt}e.debounce=n}(Pw)),Pw}var sD;function x9(){return sD||(sD=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=v9();function l(u,y=0,b={}){const{leading:I=!0,trailing:o=!0}=b;return n.debounce(u,y,{leading:I,maxWait:y,trailing:o})}e.throttle=l}(Iw)),Iw}var Cw,lD;function b9(){return lD||(lD=1,Cw=x9().throttle),Cw}var w9=b9();const S9=Bs(w9);var ny=function(n,l){for(var u=arguments.length,y=new Array(u>2?u-2:0),b=2;b<u;b++)y[b-2]=arguments[b]};function cD(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function Mw(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?cD(Object(l),!0).forEach(function(u){T9(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):cD(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function T9(e,n,l){return(n=E9(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function E9(e){var n=A9(e,"string");return typeof n=="symbol"?n:n+""}function A9(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var I9=Ae.forwardRef((e,n)=>{var{aspect:l,initialDimension:u={width:-1,height:-1},width:y="100%",height:b="100%",minWidth:I=0,minHeight:o,maxHeight:D,children:k,debounce:L=0,id:$,className:q,onResize:Z,style:ie={}}=e,oe=Ae.useRef(null),le=Ae.useRef();le.current=Z,Ae.useImperativeHandle(n,()=>oe.current);var[xe,ge]=Ae.useState({containerWidth:u.width,containerHeight:u.height}),ke=Ae.useCallback((ze,nt)=>{ge(pt=>{var Gt=Math.round(ze),ir=Math.round(nt);return pt.containerWidth===Gt&&pt.containerHeight===ir?pt:{containerWidth:Gt,containerHeight:ir}})},[]);Ae.useEffect(()=>{var ze=ir=>{var Br,{width:Zt,height:dr}=ir[0].contentRect;ke(Zt,dr),(Br=le.current)===null||Br===void 0||Br.call(le,Zt,dr)};L>0&&(ze=S9(ze,L,{trailing:!0,leading:!1}));var nt=new ResizeObserver(ze),{width:pt,height:Gt}=oe.current.getBoundingClientRect();return ke(pt,Gt),nt.observe(oe.current),()=>{nt.disconnect()}},[ke,L]);var et=Ae.useMemo(()=>{var{containerWidth:ze,containerHeight:nt}=xe;if(ze<0||nt<0)return null;ny(Sm(y)||Sm(b),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,y,b),ny(!l||l>0,"The aspect(%s) must be greater than zero.",l);var pt=Sm(y)?ze:y,Gt=Sm(b)?nt:b;return l&&l>0&&(pt?Gt=pt/l:Gt&&(pt=Gt*l),D&&Gt>D&&(Gt=D)),ny(pt>0||Gt>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,pt,Gt,y,b,I,o,l),Ae.Children.map(k,ir=>Ae.cloneElement(ir,{width:pt,height:Gt,style:Mw({width:pt,height:Gt},ir.props.style)}))},[l,k,b,D,o,I,xe,y]);return Ae.createElement("div",{id:$?"".concat($):void 0,className:co("recharts-responsive-container",q),style:Mw(Mw({},ie),{},{width:y,height:b,minWidth:I,minHeight:o,maxHeight:D}),ref:oe},Ae.createElement("div",{style:{width:0,height:0,overflow:"visible"}},et))}),v3=e=>null;v3.displayName="Cell";function uD(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function GS(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?uD(Object(l),!0).forEach(function(u){P9(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):uD(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function P9(e,n,l){return(n=C9(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function C9(e){var n=M9(e,"string");return typeof n=="symbol"?n:n+""}function M9(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var wg={widthCache:{},cacheCount:0},O9=2e3,D9={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},hD="recharts_measurement_span";function k9(e){var n=GS({},e);return Object.keys(n).forEach(l=>{n[l]||delete n[l]}),n}var iy=function(n){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n==null||Py.isSsr)return{width:0,height:0};var u=k9(l),y=JSON.stringify({text:n,copyStyle:u});if(wg.widthCache[y])return wg.widthCache[y];try{var b=document.getElementById(hD);b||(b=document.createElement("span"),b.setAttribute("id",hD),b.setAttribute("aria-hidden","true"),document.body.appendChild(b));var I=GS(GS({},D9),u);Object.assign(b.style,I),b.textContent="".concat(n);var o=b.getBoundingClientRect(),D={width:o.width,height:o.height};return wg.widthCache[y]=D,++wg.cacheCount>O9&&(wg.cacheCount=0,wg.widthCache={}),D}catch{return{width:0,height:0}}},dD=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,fD=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,R9=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,L9=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,x3={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},z9=Object.keys(x3),Eg="NaN";function F9(e,n){return e*x3[n]}class Vl{static parse(n){var l,[,u,y]=(l=L9.exec(n))!==null&&l!==void 0?l:[];return new Vl(parseFloat(u),y??"")}constructor(n,l){this.num=n,this.unit=l,this.num=n,this.unit=l,Ec(n)&&(this.unit=""),l!==""&&!R9.test(l)&&(this.num=NaN,this.unit=""),z9.includes(l)&&(this.num=F9(n,l),this.unit="px")}add(n){return this.unit!==n.unit?new Vl(NaN,""):new Vl(this.num+n.num,this.unit)}subtract(n){return this.unit!==n.unit?new Vl(NaN,""):new Vl(this.num-n.num,this.unit)}multiply(n){return this.unit!==""&&n.unit!==""&&this.unit!==n.unit?new Vl(NaN,""):new Vl(this.num*n.num,this.unit||n.unit)}divide(n){return this.unit!==""&&n.unit!==""&&this.unit!==n.unit?new Vl(NaN,""):new Vl(this.num/n.num,this.unit||n.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return Ec(this.num)}}function b3(e){if(e.includes(Eg))return Eg;for(var n=e;n.includes("*")||n.includes("/");){var l,[,u,y,b]=(l=dD.exec(n))!==null&&l!==void 0?l:[],I=Vl.parse(u??""),o=Vl.parse(b??""),D=y==="*"?I.multiply(o):I.divide(o);if(D.isNaN())return Eg;n=n.replace(dD,D.toString())}for(;n.includes("+")||/.-\d+(?:\.\d+)?/.test(n);){var k,[,L,$,q]=(k=fD.exec(n))!==null&&k!==void 0?k:[],Z=Vl.parse(L??""),ie=Vl.parse(q??""),oe=$==="+"?Z.add(ie):Z.subtract(ie);if(oe.isNaN())return Eg;n=n.replace(fD,oe.toString())}return n}var pD=/\(([^()]*)\)/;function N9(e){for(var n=e,l;(l=pD.exec(n))!=null;){var[,u]=l;n=n.replace(pD,b3(u))}return n}function B9(e){var n=e.replace(/\s+/g,"");return n=N9(n),n=b3(n),n}function j9(e){try{return B9(e)}catch{return Eg}}function Ow(e){var n=j9(e.slice(5,-1));return n===Eg?"":n}var U9=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],V9=["dx","dy","angle","className","breakAll"];function qS(){return qS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},qS.apply(null,arguments)}function mD(e,n){if(e==null)return{};var l,u,y=$9(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function $9(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}var w3=/[ \f\n\r\t\v\u2028\u2029]+/,S3=e=>{var{children:n,breakAll:l,style:u}=e;try{var y=[];Aa(n)||(l?y=n.toString().split(""):y=n.toString().split(w3));var b=y.map(o=>({word:o,width:iy(o,u).width})),I=l?0:iy("",u).width;return{wordsWithComputedWidth:b,spaceWidth:I}}catch{return null}},G9=(e,n,l,u,y)=>{var{maxLines:b,children:I,style:o,breakAll:D}=e,k=mn(b),L=I,$=function(){var Zt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Zt.reduce((dr,Dr)=>{var{word:vr,width:Ar}=Dr,zr=dr[dr.length-1];if(zr&&(u==null||y||zr.width+Ar+l<Number(u)))zr.words.push(vr),zr.width+=Ar+l;else{var qr={words:[vr],width:Ar};dr.push(qr)}return dr},[])},q=$(n),Z=Br=>Br.reduce((Zt,dr)=>Zt.width>dr.width?Zt:dr);if(!k||y)return q;var ie=q.length>b||Z(q).width>Number(u);if(!ie)return q;for(var oe="",le=Br=>{var Zt=L.slice(0,Br),dr=S3({breakAll:D,style:o,children:Zt+oe}).wordsWithComputedWidth,Dr=$(dr),vr=Dr.length>b||Z(Dr).width>Number(u);return[vr,Dr]},xe=0,ge=L.length-1,ke=0,et;xe<=ge&&ke<=L.length-1;){var ze=Math.floor((xe+ge)/2),nt=ze-1,[pt,Gt]=le(nt),[ir]=le(ze);if(!pt&&!ir&&(xe=ze+1),pt&&ir&&(ge=ze-1),!pt&&ir){et=Gt;break}ke++}return et||q},gD=e=>{var n=Aa(e)?[]:e.toString().split(w3);return[{words:n}]},q9=e=>{var{width:n,scaleToFit:l,children:u,style:y,breakAll:b,maxLines:I}=e;if((n||l)&&!Py.isSsr){var o,D,k=S3({breakAll:b,children:u,style:y});if(k){var{wordsWithComputedWidth:L,spaceWidth:$}=k;o=L,D=$}else return gD(u);return G9({breakAll:b,children:u,maxLines:I,style:y},o,D,n,l)}return gD(u)},_D="#808080",zE=Ae.forwardRef((e,n)=>{var{x:l=0,y:u=0,lineHeight:y="1em",capHeight:b="0.71em",scaleToFit:I=!1,textAnchor:o="start",verticalAnchor:D="end",fill:k=_D}=e,L=mD(e,U9),$=Ae.useMemo(()=>q9({breakAll:L.breakAll,children:L.children,maxLines:L.maxLines,scaleToFit:I,style:L.style,width:L.width}),[L.breakAll,L.children,L.maxLines,I,L.style,L.width]),{dx:q,dy:Z,angle:ie,className:oe,breakAll:le}=L,xe=mD(L,V9);if(!ld(l)||!ld(u))return null;var ge=l+(mn(q)?q:0),ke=u+(mn(Z)?Z:0),et;switch(D){case"start":et=Ow("calc(".concat(b,")"));break;case"middle":et=Ow("calc(".concat(($.length-1)/2," * -").concat(y," + (").concat(b," / 2))"));break;default:et=Ow("calc(".concat($.length-1," * -").concat(y,")"));break}var ze=[];if(I){var nt=$[0].width,{width:pt}=L;ze.push("scale(".concat(mn(pt)?pt/nt:1,")"))}return ie&&ze.push("rotate(".concat(ie,", ").concat(ge,", ").concat(ke,")")),ze.length&&(xe.transform=ze.join(" ")),Ae.createElement("text",qS({},$o(xe,!0),{ref:n,x:ge,y:ke,className:co("recharts-text",oe),textAnchor:o,fill:k.includes("url")?_D:k}),$.map((Gt,ir)=>{var Br=Gt.words.join(le?"":" ");return Ae.createElement("tspan",{x:ge,dy:ir===0?et:y,key:"".concat(Br,"-").concat(ir)},Br)}))});zE.displayName="Text";var W9=["offset"],H9=["labelRef"];function yD(e,n){if(e==null)return{};var l,u,y=Z9(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function Z9(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}function vD(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function Ea(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?vD(Object(l),!0).forEach(function(u){X9(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):vD(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function X9(e,n,l){return(n=Y9(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function Y9(e){var n=K9(e,"string");return typeof n=="symbol"?n:n+""}function K9(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function rf(){return rf=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},rf.apply(null,arguments)}var J9=e=>{var{value:n,formatter:l}=e,u=Aa(e.children)?n:e.children;return typeof l=="function"?l(u):u},FE=e=>e!=null&&typeof e=="function",Q9=(e,n)=>{var l=$l(n-e),u=Math.min(Math.abs(n-e),360);return l*u},eZ=(e,n,l)=>{var{position:u,viewBox:y,offset:b,className:I}=e,{cx:o,cy:D,innerRadius:k,outerRadius:L,startAngle:$,endAngle:q,clockWise:Z}=y,ie=(k+L)/2,oe=Q9($,q),le=oe>=0?1:-1,xe,ge;u==="insideStart"?(xe=$+le*b,ge=Z):u==="insideEnd"?(xe=q-le*b,ge=!Z):u==="end"&&(xe=q+le*b,ge=Z),ge=oe<=0?ge:!ge;var ke=gs(o,D,ie,xe),et=gs(o,D,ie,xe+(ge?1:-1)*359),ze="M".concat(ke.x,",").concat(ke.y,`
    A`).concat(ie,",").concat(ie,",0,1,").concat(ge?0:1,`,
    `).concat(et.x,",").concat(et.y),nt=Aa(e.id)?sy("recharts-radial-line-"):e.id;return Ae.createElement("text",rf({},l,{dominantBaseline:"central",className:co("recharts-radial-bar-label",I)}),Ae.createElement("defs",null,Ae.createElement("path",{id:nt,d:ze})),Ae.createElement("textPath",{xlinkHref:"#".concat(nt)},n))},tZ=e=>{var{viewBox:n,offset:l,position:u}=e,{cx:y,cy:b,innerRadius:I,outerRadius:o,startAngle:D,endAngle:k}=n,L=(D+k)/2;if(u==="outside"){var{x:$,y:q}=gs(y,b,o+l,L);return{x:$,y:q,textAnchor:$>=y?"start":"end",verticalAnchor:"middle"}}if(u==="center")return{x:y,y:b,textAnchor:"middle",verticalAnchor:"middle"};if(u==="centerTop")return{x:y,y:b,textAnchor:"middle",verticalAnchor:"start"};if(u==="centerBottom")return{x:y,y:b,textAnchor:"middle",verticalAnchor:"end"};var Z=(I+o)/2,{x:ie,y:oe}=gs(y,b,Z,L);return{x:ie,y:oe,textAnchor:"middle",verticalAnchor:"middle"}},rZ=(e,n)=>{var{parentViewBox:l,offset:u,position:y}=e,{x:b,y:I,width:o,height:D}=n,k=D>=0?1:-1,L=k*u,$=k>0?"end":"start",q=k>0?"start":"end",Z=o>=0?1:-1,ie=Z*u,oe=Z>0?"end":"start",le=Z>0?"start":"end";if(y==="top"){var xe={x:b+o/2,y:I-k*u,textAnchor:"middle",verticalAnchor:$};return Ea(Ea({},xe),l?{height:Math.max(I-l.y,0),width:o}:{})}if(y==="bottom"){var ge={x:b+o/2,y:I+D+L,textAnchor:"middle",verticalAnchor:q};return Ea(Ea({},ge),l?{height:Math.max(l.y+l.height-(I+D),0),width:o}:{})}if(y==="left"){var ke={x:b-ie,y:I+D/2,textAnchor:oe,verticalAnchor:"middle"};return Ea(Ea({},ke),l?{width:Math.max(ke.x-l.x,0),height:D}:{})}if(y==="right"){var et={x:b+o+ie,y:I+D/2,textAnchor:le,verticalAnchor:"middle"};return Ea(Ea({},et),l?{width:Math.max(l.x+l.width-et.x,0),height:D}:{})}var ze=l?{width:o,height:D}:{};return y==="insideLeft"?Ea({x:b+ie,y:I+D/2,textAnchor:le,verticalAnchor:"middle"},ze):y==="insideRight"?Ea({x:b+o-ie,y:I+D/2,textAnchor:oe,verticalAnchor:"middle"},ze):y==="insideTop"?Ea({x:b+o/2,y:I+L,textAnchor:"middle",verticalAnchor:q},ze):y==="insideBottom"?Ea({x:b+o/2,y:I+D-L,textAnchor:"middle",verticalAnchor:$},ze):y==="insideTopLeft"?Ea({x:b+ie,y:I+L,textAnchor:le,verticalAnchor:q},ze):y==="insideTopRight"?Ea({x:b+o-ie,y:I+L,textAnchor:oe,verticalAnchor:q},ze):y==="insideBottomLeft"?Ea({x:b+ie,y:I+D-L,textAnchor:le,verticalAnchor:$},ze):y==="insideBottomRight"?Ea({x:b+o-ie,y:I+D-L,textAnchor:oe,verticalAnchor:$},ze):y&&typeof y=="object"&&(mn(y.x)||Sm(y.x))&&(mn(y.y)||Sm(y.y))?Ea({x:b+sh(y.x,o),y:I+sh(y.y,D),textAnchor:"end",verticalAnchor:"end"},ze):Ea({x:b+o/2,y:I+D/2,textAnchor:"middle",verticalAnchor:"middle"},ze)},nZ=e=>"cx"in e&&mn(e.cx);function bc(e){var{offset:n=5}=e,l=yD(e,W9),u=Ea({offset:n},l),{viewBox:y,position:b,value:I,children:o,content:D,className:k="",textBreakAll:L,labelRef:$}=u,q=BT(),Z=y||q;if(!Z||Aa(I)&&Aa(o)&&!Ae.isValidElement(D)&&typeof D!="function")return null;if(Ae.isValidElement(D)){var{labelRef:ie}=u,oe=yD(u,H9);return Ae.cloneElement(D,oe)}var le;if(typeof D=="function"){if(le=Ae.createElement(D,u),Ae.isValidElement(le))return le}else le=J9(u);var xe=nZ(Z),ge=$o(u,!0);if(xe&&(b==="insideStart"||b==="insideEnd"||b==="end"))return eZ(u,le,ge);var ke=xe?tZ(u):rZ(u,Z);return Ae.createElement(zE,rf({ref:$,className:co("recharts-label",k)},ge,ke,{breakAll:L}),le)}bc.displayName="Label";var T3=e=>{var{cx:n,cy:l,angle:u,startAngle:y,endAngle:b,r:I,radius:o,innerRadius:D,outerRadius:k,x:L,y:$,top:q,left:Z,width:ie,height:oe,clockWise:le,labelViewBox:xe}=e;if(xe)return xe;if(mn(ie)&&mn(oe)){if(mn(L)&&mn($))return{x:L,y:$,width:ie,height:oe};if(mn(q)&&mn(Z))return{x:q,y:Z,width:ie,height:oe}}if(mn(L)&&mn($))return{x:L,y:$,width:0,height:0};if(mn(n)&&mn(l))return{cx:n,cy:l,startAngle:y||u||0,endAngle:b||u||0,innerRadius:D||0,outerRadius:k||o||I||0,clockWise:le};if(e.viewBox)return e.viewBox},iZ=(e,n,l)=>{if(!e)return null;var u={viewBox:n,labelRef:l};return e===!0?Ae.createElement(bc,rf({key:"label-implicit"},u)):ld(e)?Ae.createElement(bc,rf({key:"label-implicit",value:e},u)):Ae.isValidElement(e)?e.type===bc?Ae.cloneElement(e,Ea({key:"label-implicit"},u)):Ae.createElement(bc,rf({key:"label-implicit",content:e},u)):FE(e)?Ae.createElement(bc,rf({key:"label-implicit",content:e},u)):e&&typeof e=="object"?Ae.createElement(bc,rf({},e,{key:"label-implicit"},u)):null},oZ=function(n,l){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!n||!n.children&&u&&!n.label)return null;var{children:y,labelRef:b}=n,I=T3(n),o=bT(y,bc).map((k,L)=>Ae.cloneElement(k,{viewBox:l||I,key:"label-".concat(L)}));if(!u)return o;var D=iZ(n.label,l||I,b);return[D,...o]};bc.parseViewBox=T3;bc.renderCallByParent=oZ;var Dw={},kw={},xD;function aZ(){return xD||(xD=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){return l[l.length-1]}e.last=n}(kw)),kw}var Rw={},bD;function sZ(){return bD||(bD=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){return Array.isArray(l)?l:Array.from(l)}e.toArray=n}(Rw)),Rw}var wD;function lZ(){return wD||(wD=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const n=aZ(),l=sZ(),u=ET();function y(b){if(u.isArrayLike(b))return n.last(l.toArray(b))}e.last=y}(Dw)),Dw}var Lw,SD;function cZ(){return SD||(SD=1,Lw=lZ().last),Lw}var uZ=cZ();const hZ=Bs(uZ);var dZ=["valueAccessor"],fZ=["data","dataKey","clockWise","id","textBreakAll"];function z0(){return z0=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},z0.apply(null,arguments)}function TD(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function ED(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?TD(Object(l),!0).forEach(function(u){pZ(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):TD(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function pZ(e,n,l){return(n=mZ(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function mZ(e){var n=gZ(e,"string");return typeof n=="symbol"?n:n+""}function gZ(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function AD(e,n){if(e==null)return{};var l,u,y=_Z(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function _Z(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}var yZ=e=>Array.isArray(e.value)?hZ(e.value):e.value;function km(e){var{valueAccessor:n=yZ}=e,l=AD(e,dZ),{data:u,dataKey:y,clockWise:b,id:I,textBreakAll:o}=l,D=AD(l,fZ);return!u||!u.length?null:Ae.createElement(cd,{className:"recharts-label-list"},u.map((k,L)=>{var $=Aa(y)?n(k,L):Tc(k&&k.payload,y),q=Aa(I)?{}:{id:"".concat(I,"-").concat(L)};return Ae.createElement(bc,z0({},$o(k,!0),D,q,{parentViewBox:k.parentViewBox,value:$,textBreakAll:o,viewBox:bc.parseViewBox(Aa(b)?k:ED(ED({},k),{},{clockWise:b})),key:"label-".concat(L),index:L}))}))}km.displayName="LabelList";function vZ(e,n){return e?e===!0?Ae.createElement(km,{key:"labelList-implicit",data:n}):Ae.isValidElement(e)||FE(e)?Ae.createElement(km,{key:"labelList-implicit",data:n,content:e}):typeof e=="object"?Ae.createElement(km,z0({data:n},e,{key:"labelList-implicit"})):null:null}function xZ(e,n){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&l&&!e.label)return null;var{children:u}=e,y=bT(u,km).map((I,o)=>Ae.cloneElement(I,{data:n,key:"labelList-".concat(o)}));if(!l)return y;var b=vZ(e.label,n);return[b,...y]}km.renderCallByParent=xZ;var bZ={radiusAxis:{},angleAxis:{}},E3=mu({name:"polarAxis",initialState:bZ,reducers:{addRadiusAxis(e,n){e.radiusAxis[n.payload.id]=n.payload},removeRadiusAxis(e,n){delete e.radiusAxis[n.payload.id]},addAngleAxis(e,n){e.angleAxis[n.payload.id]=n.payload},removeAngleAxis(e,n){delete e.angleAxis[n.payload.id]}}}),{addRadiusAxis:VJ,removeRadiusAxis:$J,addAngleAxis:GJ,removeAngleAxis:qJ}=E3.actions,wZ=E3.reducer,SZ={countOfBars:0,cartesianItems:[],polarItems:[]},A3=mu({name:"graphicalItems",initialState:SZ,reducers:{addBar(e){e.countOfBars+=1},removeBar(e){e.countOfBars-=1},addCartesianGraphicalItem(e,n){e.cartesianItems.push(n.payload)},replaceCartesianGraphicalItem(e,n){var{prev:l,next:u}=n.payload,y=af(e).cartesianItems.indexOf(l);y>-1&&(e.cartesianItems[y]=u)},removeCartesianGraphicalItem(e,n){var l=af(e).cartesianItems.indexOf(n.payload);l>-1&&e.cartesianItems.splice(l,1)},addPolarGraphicalItem(e,n){e.polarItems.push(n.payload)},removePolarGraphicalItem(e,n){var l=af(e).polarItems.indexOf(n.payload);l>-1&&e.polarItems.splice(l,1)}}}),{addBar:TZ,removeBar:EZ,addCartesianGraphicalItem:AZ,replaceCartesianGraphicalItem:IZ,removeCartesianGraphicalItem:PZ,addPolarGraphicalItem:WJ,removePolarGraphicalItem:HJ}=A3.actions,CZ=A3.reducer;function ID(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function PD(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?ID(Object(l),!0).forEach(function(u){MZ(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):ID(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function MZ(e,n,l){return(n=OZ(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function OZ(e){var n=DZ(e,"string");return typeof n=="symbol"?n:n+""}function DZ(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function kZ(e){var n=Ba(),l=Ae.useRef(null);return Ae.useEffect(()=>{var u=PD(PD({},e),{},{stackId:HR(e.stackId)});l.current===null?n(AZ(u)):l.current!==u&&n(IZ({prev:l.current,next:u})),l.current=u},[n,e]),Ae.useEffect(()=>()=>{l.current&&(n(PZ(l.current)),l.current=null)},[n]),null}var zw={},CD;function RZ(){return CD||(CD=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function n(l){var y;if(typeof l!="object"||l==null)return!1;if(Object.getPrototypeOf(l)===null)return!0;if(Object.prototype.toString.call(l)!=="[object Object]"){const b=l[Symbol.toStringTag];return b==null||!((y=Object.getOwnPropertyDescriptor(l,Symbol.toStringTag))!=null&&y.writable)?!1:l.toString()===`[object ${b}]`}let u=l;for(;Object.getPrototypeOf(u)!==null;)u=Object.getPrototypeOf(u);return Object.getPrototypeOf(l)===u}e.isPlainObject=n}(zw)),zw}var Fw,MD;function LZ(){return MD||(MD=1,Fw=RZ().isPlainObject),Fw}var zZ=LZ();const FZ=Bs(zZ);function F0(){return F0=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},F0.apply(null,arguments)}var OD=(e,n,l,u,y)=>{var b=l-u,I;return I="M ".concat(e,",").concat(n),I+="L ".concat(e+l,",").concat(n),I+="L ".concat(e+l-b/2,",").concat(n+y),I+="L ".concat(e+l-b/2-u,",").concat(n+y),I+="L ".concat(e,",").concat(n," Z"),I},NZ={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},BZ=e=>{var n=Tp(e,NZ),l=Ae.useRef(),[u,y]=Ae.useState(-1);Ae.useEffect(()=>{if(l.current&&l.current.getTotalLength)try{var le=l.current.getTotalLength();le&&y(le)}catch{}},[]);var{x:b,y:I,upperWidth:o,lowerWidth:D,height:k,className:L}=n,{animationEasing:$,animationDuration:q,animationBegin:Z,isUpdateAnimationActive:ie}=n;if(b!==+b||I!==+I||o!==+o||D!==+D||k!==+k||o===0&&D===0||k===0)return null;var oe=co("recharts-trapezoid",L);return ie?Ae.createElement(kg,{canBegin:u>0,from:{upperWidth:0,lowerWidth:0,height:k,x:b,y:I},to:{upperWidth:o,lowerWidth:D,height:k,x:b,y:I},duration:q,animationEasing:$,isActive:ie},le=>{var{upperWidth:xe,lowerWidth:ge,height:ke,x:et,y:ze}=le;return Ae.createElement(kg,{canBegin:u>0,from:"0px ".concat(u===-1?1:u,"px"),to:"".concat(u,"px 0px"),attributeName:"strokeDasharray",begin:Z,duration:q,easing:$},Ae.createElement("path",F0({},$o(n,!0),{className:oe,d:OD(et,ze,xe,ge,ke),ref:l})))}):Ae.createElement("g",null,Ae.createElement("path",F0({},$o(n,!0),{className:oe,d:OD(b,I,o,D,k)})))},jZ=["option","shapeType","propTransformer","activeClassName","isActive"];function UZ(e,n){if(e==null)return{};var l,u,y=VZ(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function VZ(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}function DD(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function N0(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?DD(Object(l),!0).forEach(function(u){$Z(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):DD(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function $Z(e,n,l){return(n=GZ(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function GZ(e){var n=qZ(e,"string");return typeof n=="symbol"?n:n+""}function qZ(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function WZ(e,n){return N0(N0({},n),e)}function HZ(e,n){return e==="symbols"}function kD(e){var{shapeType:n,elementProps:l}=e;switch(n){case"rectangle":return Ae.createElement(oL,l);case"trapezoid":return Ae.createElement(BZ,l);case"sector":return Ae.createElement(lL,l);case"symbols":if(HZ(n))return Ae.createElement(uR,l);break;default:return null}}function ZZ(e){return Ae.isValidElement(e)?e.props:e}function XZ(e){var{option:n,shapeType:l,propTransformer:u=WZ,activeClassName:y="recharts-active-shape",isActive:b}=e,I=UZ(e,jZ),o;if(Ae.isValidElement(n))o=Ae.cloneElement(n,N0(N0({},I),ZZ(n)));else if(typeof n=="function")o=n(I);else if(FZ(n)&&typeof n!="boolean"){var D=u(n,I);o=Ae.createElement(kD,{shapeType:l,elementProps:D})}else{var k=I;o=Ae.createElement(kD,{shapeType:l,elementProps:k})}return b?Ae.createElement(cd,{className:y},o):o}var I3=(e,n)=>{var l=Ba();return(u,y)=>b=>{e==null||e(u,y,b),l(Yz({activeIndex:String(y),activeDataKey:n,activeCoordinate:u.tooltipPosition}))}},P3=e=>{var n=Ba();return(l,u)=>y=>{e==null||e(l,u,y),n(ZH())}},C3=(e,n)=>{var l=Ba();return(u,y)=>b=>{e==null||e(u,y,b),l(XH({activeIndex:String(y),activeDataKey:n,activeCoordinate:u.tooltipPosition}))}};function YZ(e){var{fn:n,args:l}=e,u=Ba(),y=ql();return Ae.useEffect(()=>{if(!y){var b=n(l);return u(qH(b)),()=>{u(WH(b))}}},[n,l,u,y]),null}var KZ=()=>{};function JZ(e){var{legendPayload:n}=e,l=Ba(),u=ql();return Ae.useEffect(()=>u?KZ:(l(T8(n)),()=>{l(E8(n))}),[l,u,n]),null}function QZ(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"animation-",l=Ae.useRef(sy(n)),u=Ae.useRef(e);return u.current!==e&&(l.current=sy(n),u.current=e),l.current}var eX=Ht([Ha],e=>{if(e)return{top:e.top,bottom:e.bottom,left:e.left,right:e.right}}),tX=Ht([eX,ff,pf],(e,n,l)=>{if(!(!e||n==null||l==null))return{x:e.left,y:e.top,width:Math.max(0,n-e.left-e.right),height:Math.max(0,l-e.top-e.bottom)}}),rX=e=>{var n=ql();return Ln(l=>xp(l,"xAxis",e,n))},nX=e=>{var n=ql();return Ln(l=>xp(l,"yAxis",e,n))},M3=()=>Ln(tX),iX=()=>{var e=Ba();return Ae.useEffect(()=>(e(TZ()),()=>{e(EZ())})),null},oX=["children"];function aX(e,n){if(e==null)return{};var l,u,y=sX(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function sX(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}var RD=()=>{},O3=Ae.createContext({addErrorBar:RD,removeErrorBar:RD}),lX={data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0},D3=Ae.createContext(lX);function cX(e){var{children:n}=e,l=aX(e,oX);return Ae.createElement(D3.Provider,{value:l},n)}var uX=()=>Ae.useContext(D3),hX=e=>{var{children:n,xAxisId:l,yAxisId:u,zAxisId:y,dataKey:b,data:I,stackId:o,hide:D,type:k,barSize:L}=e,[$,q]=Ae.useState([]),Z=Ae.useCallback(le=>{q(xe=>[...xe,le])},[q]),ie=Ae.useCallback(le=>{q(xe=>xe.filter(ge=>ge!==le))},[q]),oe=ql();return Ae.createElement(O3.Provider,{value:{addErrorBar:Z,removeErrorBar:ie}},Ae.createElement(kZ,{type:k,data:I,xAxisId:l,yAxisId:u,zAxisId:y,dataKey:b,errorBars:$,stackId:o,hide:D,barSize:L,isPanorama:oe}),n)};function dX(e){var{addErrorBar:n,removeErrorBar:l}=Ae.useContext(O3);return Ae.useEffect(()=>(n(e),()=>{l(e)}),[n,l,e]),null}var fX=["direction","width","dataKey","isAnimationActive","animationBegin","animationDuration","animationEasing"];function k3(e,n,l){return(n=pX(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function pX(e){var n=mX(e,"string");return typeof n=="symbol"?n:n+""}function mX(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function _y(){return _y=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},_y.apply(null,arguments)}function gX(e,n){if(e==null)return{};var l,u,y=_X(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function _X(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}function yX(e){var{direction:n,width:l,dataKey:u,isAnimationActive:y,animationBegin:b,animationDuration:I,animationEasing:o}=e,D=gX(e,fX),k=$o(D,!1),{data:L,dataPointFormatter:$,xAxisId:q,yAxisId:Z,errorBarOffset:ie}=uX(),oe=rX(q),le=nX(Z);if((oe==null?void 0:oe.scale)==null||(le==null?void 0:le.scale)==null||L==null||n==="x"&&oe.type!=="number")return null;var xe=L.map(ge=>{var{x:ke,y:et,value:ze,errorVal:nt}=$(ge,u,n);if(!nt)return null;var pt=[],Gt,ir;if(Array.isArray(nt)?[Gt,ir]=nt:Gt=ir=nt,n==="x"){var{scale:Br}=oe,Zt=et+ie,dr=Zt+l,Dr=Zt-l,vr=Br(ze-Gt),Ar=Br(ze+ir);pt.push({x1:Ar,y1:dr,x2:Ar,y2:Dr}),pt.push({x1:vr,y1:Zt,x2:Ar,y2:Zt}),pt.push({x1:vr,y1:dr,x2:vr,y2:Dr})}else if(n==="y"){var{scale:zr}=le,qr=ke+ie,lr=qr-l,br=qr+l,Ft=zr(ze-Gt),ot=zr(ze+ir);pt.push({x1:lr,y1:ot,x2:br,y2:ot}),pt.push({x1:qr,y1:Ft,x2:qr,y2:ot}),pt.push({x1:lr,y1:Ft,x2:br,y2:Ft})}var St="".concat(ke+ie,"px ").concat(et+ie,"px");return Ae.createElement(cd,_y({className:"recharts-errorBar",key:"bar-".concat(pt.map(Ur=>"".concat(Ur.x1,"-").concat(Ur.x2,"-").concat(Ur.y1,"-").concat(Ur.y2)))},k),pt.map(Ur=>{var gn=y?{transformOrigin:"".concat(Ur.x1-5,"px")}:void 0;return Ae.createElement(kg,{from:{transform:"scaleY(0)",transformOrigin:St},to:{transform:"scaleY(1)",transformOrigin:St},begin:b,easing:o,isActive:y,duration:I,key:"line-".concat(Ur.x1,"-").concat(Ur.x2,"-").concat(Ur.y1,"-").concat(Ur.y2),style:{transformOrigin:St}},Ae.createElement("line",_y({},Ur,{style:gn})))}))});return Ae.createElement(cd,{className:"recharts-errorBars"},xe)}var R3=Ae.createContext(void 0);function vX(e){var n=Ae.useContext(R3);return e??n??"x"}function xX(e){var{direction:n,children:l}=e;return Ae.createElement(R3.Provider,{value:n},l)}var L3={stroke:"black",strokeWidth:1.5,width:5,offset:0,isAnimationActive:!0,animationBegin:0,animationDuration:400,animationEasing:"ease-in-out"};function bX(e){var n=vX(e.direction),{width:l,isAnimationActive:u,animationBegin:y,animationDuration:b,animationEasing:I}=Tp(e,L3);return Ae.createElement(Ae.Fragment,null,Ae.createElement(dX,{dataKey:e.dataKey,direction:n}),Ae.createElement(yX,_y({},e,{direction:n,width:l,isAnimationActive:u,animationBegin:y,animationDuration:b,animationEasing:I})))}class z3 extends Ae.Component{render(){return Ae.createElement(bX,this.props)}}k3(z3,"defaultProps",L3);k3(z3,"displayName","ErrorBar");var wX="Invariant failed";function SX(e,n){throw new Error(wX)}var TX=["x","y"];function WS(){return WS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},WS.apply(null,arguments)}function LD(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function J_(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?LD(Object(l),!0).forEach(function(u){EX(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):LD(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function EX(e,n,l){return(n=AX(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function AX(e){var n=IX(e,"string");return typeof n=="symbol"?n:n+""}function IX(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function PX(e,n){if(e==null)return{};var l,u,y=CX(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function CX(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}function MX(e,n){var{x:l,y:u}=e,y=PX(e,TX),b="".concat(l),I=parseInt(b,10),o="".concat(u),D=parseInt(o,10),k="".concat(n.height||y.height),L=parseInt(k,10),$="".concat(n.width||y.width),q=parseInt($,10);return J_(J_(J_(J_(J_({},n),y),I?{x:I}:{}),D?{y:D}:{}),{},{height:L,width:q,name:n.name,radius:n.radius})}function F3(e){return Ae.createElement(XZ,WS({shapeType:"rectangle",propTransformer:MX,activeClassName:"recharts-active-bar"},e))}var OX=function(n){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(u,y)=>{if(mn(n))return n;var b=mn(u)||Aa(u);return b?n(u,y):(b||SX(),l)}};function N3(e,n){var l,u,y=Ln(k=>gf(k,e)),b=Ln(k=>Ip(k,n)),I=(l=y==null?void 0:y.allowDataOverflow)!==null&&l!==void 0?l:yc.allowDataOverflow,o=(u=b==null?void 0:b.allowDataOverflow)!==null&&u!==void 0?u:vc.allowDataOverflow,D=I||o;return{needClip:D,needClipX:I,needClipY:o}}function DX(e){var{xAxisId:n,yAxisId:l,clipPathId:u}=e,y=M3(),{needClipX:b,needClipY:I,needClip:o}=N3(n,l);if(!o)return null;var{x:D,y:k,width:L,height:$}=y;return Ae.createElement("clipPath",{id:"clipPath-".concat(u)},Ae.createElement("rect",{x:b?D:D-L/2,y:I?k:k-$/2,width:b?L:L*2,height:I?$:$*2}))}var kX=["onMouseEnter","onMouseLeave","onClick"],RX=["value","background","tooltipPosition"],LX=["onMouseEnter","onClick","onMouseLeave"];function yy(){return yy=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},yy.apply(null,arguments)}function zD(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function zs(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?zD(Object(l),!0).forEach(function(u){Ox(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):zD(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function Ox(e,n,l){return(n=zX(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function zX(e){var n=FX(e,"string");return typeof n=="symbol"?n:n+""}function FX(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function HS(e,n){if(e==null)return{};var l,u,y=NX(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function NX(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}var BX=e=>{var{dataKey:n,name:l,fill:u,legendType:y,hide:b}=e;return[{inactive:b,dataKey:n,type:y,color:u,value:ZR(l,n),payload:e}]};function jX(e){var{dataKey:n,stroke:l,strokeWidth:u,fill:y,name:b,hide:I,unit:o}=e;return{dataDefinedOnItem:void 0,positions:void 0,settings:{stroke:l,strokeWidth:u,fill:y,dataKey:n,nameKey:void 0,name:ZR(b,n),hide:I,type:e.tooltipType,color:e.fill,unit:o}}}function UX(e){var n=Ln(Bg),{data:l,dataKey:u,background:y,allOtherBarProps:b}=e,{onMouseEnter:I,onMouseLeave:o,onClick:D}=b,k=HS(b,kX),L=I3(I,u),$=P3(o),q=C3(D,u);if(!y||l==null)return null;var Z=$o(y,!1);return Ae.createElement(Ae.Fragment,null,l.map((ie,oe)=>{var{value:le,background:xe,tooltipPosition:ge}=ie,ke=HS(ie,RX);if(!xe)return null;var et=L(ie,oe),ze=$(ie,oe),nt=q(ie,oe),pt=zs(zs(zs(zs(zs({option:y,isActive:String(oe)===n},ke),{},{fill:"#eee"},xe),Z),xT(k,ie,oe)),{},{onMouseEnter:et,onMouseLeave:ze,onClick:nt,dataKey:u,index:oe,className:"recharts-bar-background-rectangle"});return Ae.createElement(F3,yy({key:"background-bar-".concat(oe)},pt))}))}function B3(e){var{data:n,props:l,showLabels:u}=e,y=$o(l,!1),{shape:b,dataKey:I,activeBar:o}=l,D=Ln(Bg),k=Ln(c3),{onMouseEnter:L,onClick:$,onMouseLeave:q}=l,Z=HS(l,LX),ie=I3(L,I),oe=P3(q),le=C3($,I);return n?Ae.createElement(Ae.Fragment,null,n.map((xe,ge)=>{var ke=o&&String(ge)===D&&(k==null||I===k),et=ke?o:b,ze=zs(zs(zs({},y),xe),{},{isActive:ke,option:et,index:ge,dataKey:I});return Ae.createElement(cd,yy({className:"recharts-bar-rectangle"},xT(Z,xe,ge),{onMouseEnter:ie(xe,ge),onMouseLeave:oe(xe,ge),onClick:le(xe,ge),key:"rectangle-".concat(xe==null?void 0:xe.x,"-").concat(xe==null?void 0:xe.y,"-").concat(xe==null?void 0:xe.value,"-").concat(ge)}),Ae.createElement(F3,ze))}),u&&km.renderCallByParent(l,n)):null}function VX(e){var{props:n,previousRectanglesRef:l}=e,{data:u,layout:y,isAnimationActive:b,animationBegin:I,animationDuration:o,animationEasing:D,onAnimationEnd:k,onAnimationStart:L}=n,$=l.current,q=QZ(n,"recharts-bar-"),[Z,ie]=Ae.useState(!1),oe=Ae.useCallback(()=>{typeof k=="function"&&k(),ie(!1)},[k]),le=Ae.useCallback(()=>{typeof L=="function"&&L(),ie(!0)},[L]);return Ae.createElement(kg,{begin:I,duration:o,isActive:b,easing:D,from:{t:0},to:{t:1},onAnimationEnd:oe,onAnimationStart:le,key:q},xe=>{var{t:ge}=xe,ke=ge===1?u:u.map((et,ze)=>{var nt=$&&$[ze];if(nt){var pt=xg(nt.x,et.x),Gt=xg(nt.y,et.y),ir=xg(nt.width,et.width),Br=xg(nt.height,et.height);return zs(zs({},et),{},{x:pt(ge),y:Gt(ge),width:ir(ge),height:Br(ge)})}if(y==="horizontal"){var Zt=xg(0,et.height),dr=Zt(ge);return zs(zs({},et),{},{y:et.y+et.height-dr,height:dr})}var Dr=xg(0,et.width),vr=Dr(ge);return zs(zs({},et),{},{width:vr})});return ge>0&&(l.current=ke),Ae.createElement(cd,null,Ae.createElement(B3,{props:n,data:ke,showLabels:!Z}))})}function $X(e){var{data:n,isAnimationActive:l}=e,u=Ae.useRef(null);return l&&n&&n.length&&(u.current==null||u.current!==n)?Ae.createElement(VX,{previousRectanglesRef:u,props:e}):Ae.createElement(B3,{props:e,data:n,showLabels:!0})}var j3=0,GX=(e,n)=>{var l=Array.isArray(e.value)?e.value[1]:e.value;return{x:e.x,y:e.y,value:l,errorVal:Tc(e,n)}};class qX extends Ae.PureComponent{constructor(){super(...arguments),Ox(this,"id",sy("recharts-bar-"))}render(){var{hide:n,data:l,dataKey:u,className:y,xAxisId:b,yAxisId:I,needClip:o,background:D,id:k,layout:L}=this.props;if(n)return null;var $=co("recharts-bar",y),q=Aa(k)?this.id:k;return Ae.createElement(cd,{className:$},o&&Ae.createElement("defs",null,Ae.createElement(DX,{clipPathId:q,xAxisId:b,yAxisId:I})),Ae.createElement(cd,{className:"recharts-bar-rectangles",clipPath:o?"url(#clipPath-".concat(q,")"):null},Ae.createElement(UX,{data:l,dataKey:u,background:D,allOtherBarProps:this.props}),Ae.createElement($X,this.props)),Ae.createElement(xX,{direction:L==="horizontal"?"y":"x"},this.props.children))}}var U3={activeBar:!1,animationBegin:0,animationDuration:400,animationEasing:"ease",hide:!1,isAnimationActive:!Py.isSsr,legendType:"rect",minPointSize:j3,xAxisId:0,yAxisId:0};function WX(e){var{xAxisId:n,yAxisId:l,hide:u,legendType:y,minPointSize:b,activeBar:I,animationBegin:o,animationDuration:D,animationEasing:k,isAnimationActive:L}=Tp(e,U3),{needClip:$}=N3(n,l),q=jT(),Z=ql(),ie=Ae.useMemo(()=>({barSize:e.barSize,data:void 0,dataKey:e.dataKey,maxBarSize:e.maxBarSize,minPointSize:b,stackId:HR(e.stackId)}),[e.barSize,e.dataKey,e.maxBarSize,b,e.stackId]),oe=bT(e.children,v3),le=Ln(ke=>xY(ke,n,l,Z,ie,oe));if(q!=="vertical"&&q!=="horizontal")return null;var xe,ge=le==null?void 0:le[0];return ge==null||ge.height==null||ge.width==null?xe=0:xe=q==="vertical"?ge.height/2:ge.width/2,Ae.createElement(cX,{xAxisId:n,yAxisId:l,data:le,dataPointFormatter:GX,errorBarOffset:xe},Ae.createElement(qX,yy({},e,{layout:q,needClip:$,data:le,xAxisId:n,yAxisId:l,hide:u,legendType:y,minPointSize:b,activeBar:I,animationBegin:o,animationDuration:D,animationEasing:k,isAnimationActive:L})))}function HX(e){var{layout:n,barSettings:{dataKey:l,minPointSize:u},pos:y,bandSize:b,xAxis:I,yAxis:o,xAxisTicks:D,yAxisTicks:k,stackedData:L,displayedData:$,offset:q,cells:Z}=e,ie=n==="horizontal"?o:I,oe=L?ie.scale.domain():null,le=a8({numericAxis:ie});return $.map((xe,ge)=>{var ke,et,ze,nt,pt,Gt;L?ke=t8(L[ge],oe):(ke=Tc(xe,l),Array.isArray(ke)||(ke=[le,ke]));var ir=OX(u,j3)(ke[1],ge);if(n==="horizontal"){var Br,[Zt,dr]=[o.scale(ke[0]),o.scale(ke[1])];et=IM({axis:I,ticks:D,bandSize:b,offset:y.offset,entry:xe,index:ge}),ze=(Br=dr??Zt)!==null&&Br!==void 0?Br:void 0,nt=y.size;var Dr=Zt-dr;if(pt=Ec(Dr)?0:Dr,Gt={x:et,y:q.top,width:nt,height:q.height},Math.abs(ir)>0&&Math.abs(pt)<Math.abs(ir)){var vr=$l(pt||ir)*(Math.abs(ir)-Math.abs(pt));ze-=vr,pt+=vr}}else{var[Ar,zr]=[I.scale(ke[0]),I.scale(ke[1])];if(et=Ar,ze=IM({axis:o,ticks:k,bandSize:b,offset:y.offset,entry:xe,index:ge}),nt=zr-Ar,pt=y.size,Gt={x:q.left,y:ze,width:q.width,height:pt},Math.abs(ir)>0&&Math.abs(nt)<Math.abs(ir)){var qr=$l(nt||ir)*(Math.abs(ir)-Math.abs(nt));nt+=qr}}var lr=zs(zs({},xe),{},{x:et,y:ze,width:nt,height:pt,value:L?ke:ke[1],payload:xe,background:Gt,tooltipPosition:{x:et+nt/2,y:ze+pt/2}},Z&&Z[ge]&&Z[ge].props);return lr})}class NE extends Ae.PureComponent{render(){return Ae.createElement(hX,{type:"bar",data:null,xAxisId:this.props.xAxisId,yAxisId:this.props.yAxisId,zAxisId:0,dataKey:this.props.dataKey,stackId:this.props.stackId,hide:this.props.hide,barSize:this.props.barSize},Ae.createElement(iX,null),Ae.createElement(JZ,{legendPayload:BX(this.props)}),Ae.createElement(YZ,{fn:jX,args:this.props}),Ae.createElement(WX,this.props))}}Ox(NE,"displayName","Bar");Ox(NE,"defaultProps",U3);function FD(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function Qv(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?FD(Object(l),!0).forEach(function(u){ZX(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):FD(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function ZX(e,n,l){return(n=XX(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function XX(e){var n=YX(e,"string");return typeof n=="symbol"?n:n+""}function YX(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var KX=(e,n)=>n,JX=(e,n,l)=>l,QX=(e,n,l,u)=>u,BE=(e,n,l,u,y)=>y,eY=(e,n,l,u,y)=>y.maxBarSize,tY=(e,n,l,u,y,b)=>b,ND=(e,n,l)=>{var u=l??e;if(!Aa(u))return sh(u,n,0)},rY=Ht([xo,vE,KX,JX,QX],(e,n,l,u,y)=>n.filter(b=>e==="horizontal"?b.xAxisId===l:b.yAxisId===u).filter(b=>b.isPanorama===y).filter(b=>b.hide===!1).filter(b=>b.type==="bar")),nY=(e,n,l,u)=>{var y=xo(e);return y==="horizontal"?BS(e,"yAxis",l,u):BS(e,"xAxis",n,u)},iY=(e,n,l)=>{var u=xo(e);return u==="horizontal"?WO(e,"xAxis",n):WO(e,"yAxis",l)};function oY(e){return e.stackId!=null&&e.dataKey!=null}var aY=(e,n,l)=>{var u={},y=e.filter(oY),b=e.filter(k=>k.stackId==null),I=y.reduce((k,L)=>(k[L.stackId]||(k[L.stackId]=[]),k[L.stackId].push(L),k),u),o=Object.entries(I).map(k=>{var[L,$]=k,q=$.map(ie=>ie.dataKey),Z=ND(n,l,$[0].barSize);return{stackId:L,dataKeys:q,barSize:Z}}),D=b.map(k=>{var L=[k.dataKey].filter(q=>q!=null),$=ND(n,l,k.barSize);return{stackId:void 0,dataKeys:L,barSize:$}});return[...o,...D]},sY=Ht([rY,$W,iY],aY),lY=(e,n,l,u,y)=>{var b,I,o=xo(e),D=sz(e),{maxBarSize:k}=y,L=Aa(k)?D:k,$,q;return o==="horizontal"?($=xp(e,"xAxis",n,u),q=Ng(e,"xAxis",n,u)):($=xp(e,"yAxis",l,u),q=Ng(e,"yAxis",l,u)),(b=(I=zT($,q,!0))!==null&&I!==void 0?I:L)!==null&&b!==void 0?b:0},V3=(e,n,l,u)=>{var y=xo(e),b,I;return y==="horizontal"?(b=xp(e,"xAxis",n,u),I=Ng(e,"xAxis",n,u)):(b=xp(e,"yAxis",l,u),I=Ng(e,"yAxis",l,u)),zT(b,I)};function cY(e,n,l,u,y){var b=u.length;if(!(b<1)){var I=sh(e,l,0,!0),o,D=[];if(Pc(u[0].barSize)){var k=!1,L=l/b,$=u.reduce((xe,ge)=>xe+(ge.barSize||0),0);$+=(b-1)*I,$>=l&&($-=(b-1)*I,I=0),$>=l&&L>0&&(k=!0,L*=.9,$=b*L);var q=(l-$)/2>>0,Z={offset:q-I,size:0};o=u.reduce((xe,ge)=>{var ke,et={stackId:ge.stackId,dataKeys:ge.dataKeys,position:{offset:Z.offset+Z.size+I,size:k?L:(ke=ge.barSize)!==null&&ke!==void 0?ke:0}},ze=[...xe,et];return Z=ze[ze.length-1].position,ze},D)}else{var ie=sh(n,l,0,!0);l-2*ie-(b-1)*I<=0&&(I=0);var oe=(l-2*ie-(b-1)*I)/b;oe>1&&(oe>>=0);var le=Pc(y)?Math.min(oe,y):oe;o=u.reduce((xe,ge,ke)=>[...xe,{stackId:ge.stackId,dataKeys:ge.dataKeys,position:{offset:ie+(oe+I)*ke+(oe-le)/2,size:le}}],D)}return o}}var uY=(e,n,l,u,y,b,I)=>{var o=Aa(I)?n:I,D=cY(l,u,y!==b?y:b,e,o);return y!==b&&D!=null&&(D=D.map(k=>Qv(Qv({},k),{},{position:Qv(Qv({},k.position),{},{offset:k.position.offset-y/2})}))),D},hY=Ht([sY,sz,VW,lz,lY,V3,eY],uY),dY=(e,n,l,u)=>xp(e,"xAxis",n,u),fY=(e,n,l,u)=>xp(e,"yAxis",l,u),pY=(e,n,l,u)=>Ng(e,"xAxis",n,u),mY=(e,n,l,u)=>Ng(e,"yAxis",l,u),gY=Ht([hY,BE],(e,n)=>{if(e!=null){var l=e.find(u=>u.stackId===n.stackId&&u.dataKeys.includes(n.dataKey));if(l!=null)return l.position}}),_Y=(e,n)=>{if(!(!e||(n==null?void 0:n.dataKey)==null)){var{stackId:l}=n;if(l!=null){var u=e[l];if(u){var{stackedData:y}=u;if(y){var b=y.find(I=>I.key===n.dataKey);return b}}}}},yY=Ht([vE,BE],(e,n)=>{if(e.some(l=>l.type==="bar"&&n.dataKey===l.dataKey&&n.stackId===l.stackId&&n.stackId===l.stackId))return n}),vY=Ht([nY,BE],_Y),xY=Ht([Ha,dY,fY,pY,mY,gY,xo,WL,V3,vY,yY,tY],(e,n,l,u,y,b,I,o,D,k,L,$)=>{var{chartData:q,dataStartIndex:Z,dataEndIndex:ie}=o;if(!(L==null||b==null||I!=="horizontal"&&I!=="vertical"||n==null||l==null||u==null||y==null||D==null)){var{data:oe}=L,le;if(oe!=null&&oe.length>0?le=oe:le=q==null?void 0:q.slice(Z,ie+1),le!=null)return HX({layout:I,barSettings:L,pos:b,bandSize:D,xAxis:n,yAxis:l,xAxisTicks:u,yAxisTicks:y,stackedData:k,displayedData:le,offset:e,cells:$})}}),bY=e=>{var{chartData:n}=e,l=Ba(),u=ql();return Ae.useEffect(()=>u?()=>{}:(l(rD(n)),()=>{l(rD(void 0))}),[n,l,u]),null},BD={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},$3=mu({name:"brush",initialState:BD,reducers:{setBrushSettings(e,n){return n.payload==null?BD:n.payload}}}),{setBrushSettings:ZJ}=$3.actions,wY=$3.reducer;function SY(e,n,l){return(n=TY(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function TY(e){var n=EY(e,"string");return typeof n=="symbol"?n:n+""}function EY(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}class jE{static create(n){return new jE(n)}constructor(n){this.scale=n}get domain(){return this.scale.domain}get range(){return this.scale.range}get rangeMin(){return this.range()[0]}get rangeMax(){return this.range()[1]}get bandwidth(){return this.scale.bandwidth}apply(n){var{bandAware:l,position:u}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n!==void 0){if(u)switch(u){case"start":return this.scale(n);case"middle":{var y=this.bandwidth?this.bandwidth()/2:0;return this.scale(n)+y}case"end":{var b=this.bandwidth?this.bandwidth():0;return this.scale(n)+b}default:return this.scale(n)}if(l){var I=this.bandwidth?this.bandwidth()/2:0;return this.scale(n)+I}return this.scale(n)}}isInRange(n){var l=this.range(),u=l[0],y=l[l.length-1];return u<=y?n>=u&&n<=y:n>=y&&n<=u}}SY(jE,"EPS",1e-4);function AY(e){return(e%180+180)%180}var IY=function(n){var{width:l,height:u}=n,y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,b=AY(y),I=b*Math.PI/180,o=Math.atan(u/l),D=I>o&&I<Math.PI-o?u/Math.sin(I):l/Math.cos(I);return Math.abs(D)},PY={dots:[],areas:[],lines:[]},G3=mu({name:"referenceElements",initialState:PY,reducers:{addDot:(e,n)=>{e.dots.push(n.payload)},removeDot:(e,n)=>{var l=af(e).dots.findIndex(u=>u===n.payload);l!==-1&&e.dots.splice(l,1)},addArea:(e,n)=>{e.areas.push(n.payload)},removeArea:(e,n)=>{var l=af(e).areas.findIndex(u=>u===n.payload);l!==-1&&e.areas.splice(l,1)},addLine:(e,n)=>{e.lines.push(n.payload)},removeLine:(e,n)=>{var l=af(e).lines.findIndex(u=>u===n.payload);l!==-1&&e.lines.splice(l,1)}}}),{addDot:XJ,removeDot:YJ,addArea:KJ,removeArea:JJ,addLine:QJ,removeLine:eQ}=G3.actions,CY=G3.reducer,MY=Ae.createContext(void 0),OY=e=>{var{children:n}=e,[l]=Ae.useState("".concat(sy("recharts"),"-clip")),u=M3();if(u==null)return null;var{x:y,y:b,width:I,height:o}=u;return Ae.createElement(MY.Provider,{value:l},Ae.createElement("defs",null,Ae.createElement("clipPath",{id:l},Ae.createElement("rect",{x:y,y:b,height:o,width:I}))),n)};function Nw(e,n){for(var l in e)if({}.hasOwnProperty.call(e,l)&&(!{}.hasOwnProperty.call(n,l)||e[l]!==n[l]))return!1;for(var u in n)if({}.hasOwnProperty.call(n,u)&&!{}.hasOwnProperty.call(e,u))return!1;return!0}function q3(e,n,l){if(n<1)return[];if(n===1&&l===void 0)return e;for(var u=[],y=0;y<e.length;y+=n)u.push(e[y]);return u}function DY(e,n,l){var u={width:e.width+n.width,height:e.height+n.height};return IY(u,l)}function kY(e,n,l){var u=l==="width",{x:y,y:b,width:I,height:o}=e;return n===1?{start:u?y:b,end:u?y+I:b+o}:{start:u?y+I:b+o,end:u?y:b}}function B0(e,n,l,u,y){if(e*n<e*u||e*n>e*y)return!1;var b=l();return e*(n-e*b/2-u)>=0&&e*(n+e*b/2-y)<=0}function RY(e,n){return q3(e,n+1)}function LY(e,n,l,u,y){for(var b=(u||[]).slice(),{start:I,end:o}=n,D=0,k=1,L=I,$=function(){var ie=u==null?void 0:u[D];if(ie===void 0)return{v:q3(u,k)};var oe=D,le,xe=()=>(le===void 0&&(le=l(ie,oe)),le),ge=ie.coordinate,ke=D===0||B0(e,ge,xe,L,o);ke||(D=0,L=I,k+=1),ke&&(L=ge+e*(xe()/2+y),D+=k)},q;k<=b.length;)if(q=$(),q)return q.v;return[]}function jD(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function Ls(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?jD(Object(l),!0).forEach(function(u){zY(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):jD(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function zY(e,n,l){return(n=FY(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function FY(e){var n=NY(e,"string");return typeof n=="symbol"?n:n+""}function NY(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function BY(e,n,l,u,y){for(var b=(u||[]).slice(),I=b.length,{start:o}=n,{end:D}=n,k=function(q){var Z=b[q],ie,oe=()=>(ie===void 0&&(ie=l(Z,q)),ie);if(q===I-1){var le=e*(Z.coordinate+e*oe()/2-D);b[q]=Z=Ls(Ls({},Z),{},{tickCoord:le>0?Z.coordinate-le*e:Z.coordinate})}else b[q]=Z=Ls(Ls({},Z),{},{tickCoord:Z.coordinate});var xe=B0(e,Z.tickCoord,oe,o,D);xe&&(D=Z.tickCoord-e*(oe()/2+y),b[q]=Ls(Ls({},Z),{},{isShow:!0}))},L=I-1;L>=0;L--)k(L);return b}function jY(e,n,l,u,y,b){var I=(u||[]).slice(),o=I.length,{start:D,end:k}=n;if(b){var L=u[o-1],$=l(L,o-1),q=e*(L.coordinate+e*$/2-k);I[o-1]=L=Ls(Ls({},L),{},{tickCoord:q>0?L.coordinate-q*e:L.coordinate});var Z=B0(e,L.tickCoord,()=>$,D,k);Z&&(k=L.tickCoord-e*($/2+y),I[o-1]=Ls(Ls({},L),{},{isShow:!0}))}for(var ie=b?o-1:o,oe=function(ge){var ke=I[ge],et,ze=()=>(et===void 0&&(et=l(ke,ge)),et);if(ge===0){var nt=e*(ke.coordinate-e*ze()/2-D);I[ge]=ke=Ls(Ls({},ke),{},{tickCoord:nt<0?ke.coordinate-nt*e:ke.coordinate})}else I[ge]=ke=Ls(Ls({},ke),{},{tickCoord:ke.coordinate});var pt=B0(e,ke.tickCoord,ze,D,k);pt&&(D=ke.tickCoord+e*(ze()/2+y),I[ge]=Ls(Ls({},ke),{},{isShow:!0}))},le=0;le<ie;le++)oe(le);return I}function UE(e,n,l){var{tick:u,ticks:y,viewBox:b,minTickGap:I,orientation:o,interval:D,tickFormatter:k,unit:L,angle:$}=e;if(!y||!y.length||!u)return[];if(mn(D)||Py.isSsr){var q;return(q=RY(y,mn(D)?D:0))!==null&&q!==void 0?q:[]}var Z=[],ie=o==="top"||o==="bottom"?"width":"height",oe=L&&ie==="width"?iy(L,{fontSize:n,letterSpacing:l}):{width:0,height:0},le=(ke,et)=>{var ze=typeof k=="function"?k(ke.value,et):ke.value;return ie==="width"?DY(iy(ze,{fontSize:n,letterSpacing:l}),oe,$):iy(ze,{fontSize:n,letterSpacing:l})[ie]},xe=y.length>=2?$l(y[1].coordinate-y[0].coordinate):1,ge=kY(b,xe,ie);return D==="equidistantPreserveStart"?LY(xe,ge,le,y,I):(D==="preserveStart"||D==="preserveStartEnd"?Z=jY(xe,ge,le,y,I,D==="preserveStartEnd"):Z=BY(xe,ge,le,y,I),Z.filter(ke=>ke.isShow))}var UY=["viewBox"],VY=["viewBox"];function Ag(){return Ag=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},Ag.apply(null,arguments)}function UD(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function Na(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?UD(Object(l),!0).forEach(function(u){VE(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):UD(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function VD(e,n){if(e==null)return{};var l,u,y=$Y(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function $Y(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}function VE(e,n,l){return(n=GY(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function GY(e){var n=qY(e,"string");return typeof n=="symbol"?n:n+""}function qY(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}class Pp extends Ae.Component{constructor(n){super(n),this.tickRefs=Ae.createRef(),this.tickRefs.current=[],this.state={fontSize:"",letterSpacing:""}}shouldComponentUpdate(n,l){var{viewBox:u}=n,y=VD(n,UY),b=this.props,{viewBox:I}=b,o=VD(b,VY);return!Nw(u,I)||!Nw(y,o)||!Nw(l,this.state)}getTickLineCoord(n){var{x:l,y:u,width:y,height:b,orientation:I,tickSize:o,mirror:D,tickMargin:k}=this.props,L,$,q,Z,ie,oe,le=D?-1:1,xe=n.tickSize||o,ge=mn(n.tickCoord)?n.tickCoord:n.coordinate;switch(I){case"top":L=$=n.coordinate,Z=u+ +!D*b,q=Z-le*xe,oe=q-le*k,ie=ge;break;case"left":q=Z=n.coordinate,$=l+ +!D*y,L=$-le*xe,ie=L-le*k,oe=ge;break;case"right":q=Z=n.coordinate,$=l+ +D*y,L=$+le*xe,ie=L+le*k,oe=ge;break;default:L=$=n.coordinate,Z=u+ +D*b,q=Z+le*xe,oe=q+le*k,ie=ge;break}return{line:{x1:L,y1:q,x2:$,y2:Z},tick:{x:ie,y:oe}}}getTickTextAnchor(){var{orientation:n,mirror:l}=this.props,u;switch(n){case"left":u=l?"start":"end";break;case"right":u=l?"end":"start";break;default:u="middle";break}return u}getTickVerticalAnchor(){var{orientation:n,mirror:l}=this.props;switch(n){case"left":case"right":return"middle";case"top":return l?"start":"end";default:return l?"end":"start"}}renderAxisLine(){var{x:n,y:l,width:u,height:y,orientation:b,mirror:I,axisLine:o}=this.props,D=Na(Na(Na({},$o(this.props,!1)),$o(o,!1)),{},{fill:"none"});if(b==="top"||b==="bottom"){var k=+(b==="top"&&!I||b==="bottom"&&I);D=Na(Na({},D),{},{x1:n,y1:l+k*y,x2:n+u,y2:l+k*y})}else{var L=+(b==="left"&&!I||b==="right"&&I);D=Na(Na({},D),{},{x1:n+L*u,y1:l,x2:n+L*u,y2:l+y})}return Ae.createElement("line",Ag({},D,{className:co("recharts-cartesian-axis-line",Rm(o,"className"))}))}static renderTickItem(n,l,u){var y,b=co(l.className,"recharts-cartesian-axis-tick-value");if(Ae.isValidElement(n))y=Ae.cloneElement(n,Na(Na({},l),{},{className:b}));else if(typeof n=="function")y=n(Na(Na({},l),{},{className:b}));else{var I="recharts-cartesian-axis-tick-value";typeof n!="boolean"&&(I=co(I,n.className)),y=Ae.createElement(zE,Ag({},l,{className:I}),u)}return y}renderTicks(n,l){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],{tickLine:y,stroke:b,tick:I,tickFormatter:o,unit:D}=this.props,k=UE(Na(Na({},this.props),{},{ticks:u}),n,l),L=this.getTickTextAnchor(),$=this.getTickVerticalAnchor(),q=$o(this.props,!1),Z=$o(I,!1),ie=Na(Na({},q),{},{fill:"none"},$o(y,!1)),oe=k.map((le,xe)=>{var{line:ge,tick:ke}=this.getTickLineCoord(le),et=Na(Na(Na(Na({textAnchor:L,verticalAnchor:$},q),{},{stroke:"none",fill:b},Z),ke),{},{index:xe,payload:le,visibleTicksCount:k.length,tickFormatter:o});return Ae.createElement(cd,Ag({className:"recharts-cartesian-axis-tick",key:"tick-".concat(le.value,"-").concat(le.coordinate,"-").concat(le.tickCoord)},xT(this.props,le,xe)),y&&Ae.createElement("line",Ag({},ie,ge,{className:co("recharts-cartesian-axis-tick-line",Rm(y,"className"))})),I&&Pp.renderTickItem(I,et,"".concat(typeof o=="function"?o(le.value,xe):le.value).concat(D||"")))});return oe.length>0?Ae.createElement("g",{className:"recharts-cartesian-axis-ticks"},oe):null}render(){var{axisLine:n,width:l,height:u,className:y,hide:b}=this.props;if(b)return null;var{ticks:I}=this.props;return l!=null&&l<=0||u!=null&&u<=0?null:Ae.createElement(cd,{className:co("recharts-cartesian-axis",y),ref:o=>{if(o){var D=o.getElementsByClassName("recharts-cartesian-axis-tick-value");this.tickRefs.current=Array.from(D);var k=D[0];if(k){var L=window.getComputedStyle(k).fontSize,$=window.getComputedStyle(k).letterSpacing;(L!==this.state.fontSize||$!==this.state.letterSpacing)&&this.setState({fontSize:window.getComputedStyle(k).fontSize,letterSpacing:window.getComputedStyle(k).letterSpacing})}}}},n&&this.renderAxisLine(),this.renderTicks(this.state.fontSize,this.state.letterSpacing,I),bc.renderCallByParent(this.props))}}VE(Pp,"displayName","CartesianAxis");VE(Pp,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var WY=["x1","y1","x2","y2","key"],HY=["offset"],ZY=["xAxisId","yAxisId"],XY=["xAxisId","yAxisId"];function $D(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function Fs(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?$D(Object(l),!0).forEach(function(u){YY(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):$D(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function YY(e,n,l){return(n=KY(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function KY(e){var n=JY(e,"string");return typeof n=="symbol"?n:n+""}function JY(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Im(){return Im=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},Im.apply(null,arguments)}function j0(e,n){if(e==null)return{};var l,u,y=QY(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function QY(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}var eK=e=>{var{fill:n}=e;if(!n||n==="none")return null;var{fillOpacity:l,x:u,y,width:b,height:I,ry:o}=e;return Ae.createElement("rect",{x:u,y,ry:o,width:b,height:I,stroke:"none",fill:n,fillOpacity:l,className:"recharts-cartesian-grid-bg"})};function W3(e,n){var l;if(Ae.isValidElement(e))l=Ae.cloneElement(e,n);else if(typeof e=="function")l=e(n);else{var{x1:u,y1:y,x2:b,y2:I,key:o}=n,D=j0(n,WY),k=$o(D,!1),{offset:L}=k,$=j0(k,HY);l=Ae.createElement("line",Im({},$,{x1:u,y1:y,x2:b,y2:I,fill:"none",key:o}))}return l}function tK(e){var{x:n,width:l,horizontal:u=!0,horizontalPoints:y}=e;if(!u||!y||!y.length)return null;var{xAxisId:b,yAxisId:I}=e,o=j0(e,ZY),D=y.map((k,L)=>{var $=Fs(Fs({},o),{},{x1:n,y1:k,x2:n+l,y2:k,key:"line-".concat(L),index:L});return W3(u,$)});return Ae.createElement("g",{className:"recharts-cartesian-grid-horizontal"},D)}function rK(e){var{y:n,height:l,vertical:u=!0,verticalPoints:y}=e;if(!u||!y||!y.length)return null;var{xAxisId:b,yAxisId:I}=e,o=j0(e,XY),D=y.map((k,L)=>{var $=Fs(Fs({},o),{},{x1:k,y1:n,x2:k,y2:n+l,key:"line-".concat(L),index:L});return W3(u,$)});return Ae.createElement("g",{className:"recharts-cartesian-grid-vertical"},D)}function nK(e){var{horizontalFill:n,fillOpacity:l,x:u,y,width:b,height:I,horizontalPoints:o,horizontal:D=!0}=e;if(!D||!n||!n.length)return null;var k=o.map($=>Math.round($+y-y)).sort(($,q)=>$-q);y!==k[0]&&k.unshift(0);var L=k.map(($,q)=>{var Z=!k[q+1],ie=Z?y+I-$:k[q+1]-$;if(ie<=0)return null;var oe=q%n.length;return Ae.createElement("rect",{key:"react-".concat(q),y:$,x:u,height:ie,width:b,stroke:"none",fill:n[oe],fillOpacity:l,className:"recharts-cartesian-grid-bg"})});return Ae.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},L)}function iK(e){var{vertical:n=!0,verticalFill:l,fillOpacity:u,x:y,y:b,width:I,height:o,verticalPoints:D}=e;if(!n||!l||!l.length)return null;var k=D.map($=>Math.round($+y-y)).sort(($,q)=>$-q);y!==k[0]&&k.unshift(0);var L=k.map(($,q)=>{var Z=!k[q+1],ie=Z?y+I-$:k[q+1]-$;if(ie<=0)return null;var oe=q%l.length;return Ae.createElement("rect",{key:"react-".concat(q),x:$,y:b,width:ie,height:o,stroke:"none",fill:l[oe],fillOpacity:u,className:"recharts-cartesian-grid-bg"})});return Ae.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},L)}var oK=(e,n)=>{var{xAxis:l,width:u,height:y,offset:b}=e;return qR(UE(Fs(Fs(Fs({},Pp.defaultProps),l),{},{ticks:WR(l),viewBox:{x:0,y:0,width:u,height:y}})),b.left,b.left+b.width,n)},aK=(e,n)=>{var{yAxis:l,width:u,height:y,offset:b}=e;return qR(UE(Fs(Fs(Fs({},Pp.defaultProps),l),{},{ticks:WR(l),viewBox:{x:0,y:0,width:u,height:y}})),b.top,b.top+b.height,n)},sK={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[],xAxisId:0,yAxisId:0};function H3(e){var n=JR(),l=QR(),u=KR(),y=Fs(Fs({},Tp(e,sK)),{},{x:mn(e.x)?e.x:u.left,y:mn(e.y)?e.y:u.top,width:mn(e.width)?e.width:u.width,height:mn(e.height)?e.height:u.height}),{xAxisId:b,yAxisId:I,x:o,y:D,width:k,height:L,syncWithTicks:$,horizontalValues:q,verticalValues:Z}=y,ie=ql(),oe=Ln(ir=>HO(ir,"xAxis",b,ie)),le=Ln(ir=>HO(ir,"yAxis",I,ie));if(!mn(k)||k<=0||!mn(L)||L<=0||!mn(o)||o!==+o||!mn(D)||D!==+D)return null;var xe=y.verticalCoordinatesGenerator||oK,ge=y.horizontalCoordinatesGenerator||aK,{horizontalPoints:ke,verticalPoints:et}=y;if((!ke||!ke.length)&&typeof ge=="function"){var ze=q&&q.length,nt=ge({yAxis:le?Fs(Fs({},le),{},{ticks:ze?q:le.ticks}):void 0,width:n,height:l,offset:u},ze?!0:$);ny(Array.isArray(nt),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(typeof nt,"]")),Array.isArray(nt)&&(ke=nt)}if((!et||!et.length)&&typeof xe=="function"){var pt=Z&&Z.length,Gt=xe({xAxis:oe?Fs(Fs({},oe),{},{ticks:pt?Z:oe.ticks}):void 0,width:n,height:l,offset:u},pt?!0:$);ny(Array.isArray(Gt),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(typeof Gt,"]")),Array.isArray(Gt)&&(et=Gt)}return Ae.createElement("g",{className:"recharts-cartesian-grid"},Ae.createElement(eK,{fill:y.fill,fillOpacity:y.fillOpacity,x:y.x,y:y.y,width:y.width,height:y.height,ry:y.ry}),Ae.createElement(nK,Im({},y,{horizontalPoints:ke})),Ae.createElement(iK,Im({},y,{verticalPoints:et})),Ae.createElement(tK,Im({},y,{offset:u,horizontalPoints:ke,xAxis:oe,yAxis:le})),Ae.createElement(rK,Im({},y,{offset:u,verticalPoints:et,xAxis:oe,yAxis:le})))}H3.displayName="CartesianGrid";function GD(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function qD(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?GD(Object(l),!0).forEach(function(u){lK(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):GD(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function lK(e,n,l){return(n=cK(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function cK(e){var n=uK(e,"string");return typeof n=="symbol"?n:n+""}function uK(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var hK={xAxis:{},yAxis:{},zAxis:{}},Z3=mu({name:"cartesianAxis",initialState:hK,reducers:{addXAxis(e,n){e.xAxis[n.payload.id]=n.payload},removeXAxis(e,n){delete e.xAxis[n.payload.id]},addYAxis(e,n){e.yAxis[n.payload.id]=n.payload},removeYAxis(e,n){delete e.yAxis[n.payload.id]},addZAxis(e,n){e.zAxis[n.payload.id]=n.payload},removeZAxis(e,n){delete e.zAxis[n.payload.id]},updateYAxisWidth(e,n){var{id:l,width:u}=n.payload;e.yAxis[l]&&(e.yAxis[l]=qD(qD({},e.yAxis[l]),{},{width:u}))}}}),{addXAxis:dK,removeXAxis:fK,addYAxis:pK,removeYAxis:mK,addZAxis:tQ,removeZAxis:rQ,updateYAxisWidth:gK}=Z3.actions,_K=Z3.reducer,yK=["children"],vK=["dangerouslySetInnerHTML","ticks"];function X3(e,n,l){return(n=xK(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function xK(e){var n=bK(e,"string");return typeof n=="symbol"?n:n+""}function bK(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function ZS(){return ZS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},ZS.apply(null,arguments)}function Y3(e,n){if(e==null)return{};var l,u,y=wK(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function wK(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}function SK(e){var n=Ba(),l=Ae.useMemo(()=>{var{children:b}=e,I=Y3(e,yK);return I},[e]),u=Ln(b=>gf(b,l.id)),y=l===u;return Ae.useEffect(()=>(n(dK(l)),()=>{n(fK(l))}),[l,n]),y?e.children:null}var TK=e=>{var{xAxisId:n,className:l}=e,u=Ln(YR),y=ql(),b="xAxis",I=Ln(Z=>Hg(Z,b,n,y)),o=Ln(Z=>Gz(Z,b,n,y)),D=Ln(Z=>jz(Z,n)),k=Ln(Z=>zH(Z,n));if(D==null||k==null)return null;var{dangerouslySetInnerHTML:L,ticks:$}=e,q=Y3(e,vK);return Ae.createElement(Pp,ZS({},q,{scale:I,x:k.x,y:k.y,width:D.width,height:D.height,className:co("recharts-".concat(b," ").concat(b),l),viewBox:u,ticks:o}))},EK=e=>{var n,l,u,y,b;return Ae.createElement(SK,{interval:(n=e.interval)!==null&&n!==void 0?n:"preserveEnd",id:e.xAxisId,scale:e.scale,type:e.type,padding:e.padding,allowDataOverflow:e.allowDataOverflow,domain:e.domain,dataKey:e.dataKey,allowDuplicatedCategory:e.allowDuplicatedCategory,allowDecimals:e.allowDecimals,tickCount:e.tickCount,includeHidden:(l=e.includeHidden)!==null&&l!==void 0?l:!1,reversed:e.reversed,ticks:e.ticks,height:e.height,orientation:e.orientation,mirror:e.mirror,hide:e.hide,unit:e.unit,name:e.name,angle:(u=e.angle)!==null&&u!==void 0?u:0,minTickGap:(y=e.minTickGap)!==null&&y!==void 0?y:5,tick:(b=e.tick)!==null&&b!==void 0?b:!0,tickFormatter:e.tickFormatter},Ae.createElement(TK,e))};class $E extends Ae.Component{render(){return Ae.createElement(EK,this.props)}}X3($E,"displayName","XAxis");X3($E,"defaultProps",{allowDataOverflow:yc.allowDataOverflow,allowDecimals:yc.allowDecimals,allowDuplicatedCategory:yc.allowDuplicatedCategory,height:yc.height,hide:!1,mirror:yc.mirror,orientation:yc.orientation,padding:yc.padding,reversed:yc.reversed,scale:yc.scale,tickCount:yc.tickCount,type:yc.type,xAxisId:0});var AK=e=>{var{ticks:n,label:l,labelGapWithTick:u=5,tickSize:y=0,tickMargin:b=0}=e,I=0;if(n){n.forEach(L=>{if(L){var $=L.getBoundingClientRect();$.width>I&&(I=$.width)}});var o=l?l.getBoundingClientRect().width:0,D=y+b,k=I+D+o+(l?u:0);return Math.round(k)}return 0},IK=["dangerouslySetInnerHTML","ticks"];function K3(e,n,l){return(n=PK(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function PK(e){var n=CK(e,"string");return typeof n=="symbol"?n:n+""}function CK(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function XS(){return XS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},XS.apply(null,arguments)}function MK(e,n){if(e==null)return{};var l,u,y=OK(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function OK(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}function DK(e){var n=Ba();return Ae.useEffect(()=>(n(pK(e)),()=>{n(mK(e))}),[e,n]),null}var kK=e=>{var n,{yAxisId:l,className:u,width:y,label:b}=e,I=Ae.useRef(null),o=Ae.useRef(null),D=Ln(YR),k=ql(),L=Ba(),$="yAxis",q=Ln(ke=>Hg(ke,$,l,k)),Z=Ln(ke=>Uz(ke,l)),ie=Ln(ke=>FH(ke,l)),oe=Ln(ke=>Gz(ke,$,l,k));if(Ae.useLayoutEffect(()=>{var ke;if(!(y!=="auto"||!Z||FE(b)||Ae.isValidElement(b))){var et=I.current,ze=et==null||(ke=et.tickRefs)===null||ke===void 0?void 0:ke.current,{tickSize:nt,tickMargin:pt}=et.props,Gt=AK({ticks:ze,label:o.current,labelGapWithTick:5,tickSize:nt,tickMargin:pt});Math.round(Z.width)!==Math.round(Gt)&&L(gK({id:l,width:Gt}))}},[I,I==null||(n=I.current)===null||n===void 0||(n=n.tickRefs)===null||n===void 0?void 0:n.current,Z==null?void 0:Z.width,Z,L,b,l,y]),Z==null||ie==null)return null;var{dangerouslySetInnerHTML:le,ticks:xe}=e,ge=MK(e,IK);return Ae.createElement(Pp,XS({},ge,{ref:I,labelRef:o,scale:q,x:ie.x,y:ie.y,width:Z.width,height:Z.height,className:co("recharts-".concat($," ").concat($),u),viewBox:D,ticks:oe}))},RK=e=>{var n,l,u,y,b;return Ae.createElement(Ae.Fragment,null,Ae.createElement(DK,{interval:(n=e.interval)!==null&&n!==void 0?n:"preserveEnd",id:e.yAxisId,scale:e.scale,type:e.type,domain:e.domain,allowDataOverflow:e.allowDataOverflow,dataKey:e.dataKey,allowDuplicatedCategory:e.allowDuplicatedCategory,allowDecimals:e.allowDecimals,tickCount:e.tickCount,padding:e.padding,includeHidden:(l=e.includeHidden)!==null&&l!==void 0?l:!1,reversed:e.reversed,ticks:e.ticks,width:e.width,orientation:e.orientation,mirror:e.mirror,hide:e.hide,unit:e.unit,name:e.name,angle:(u=e.angle)!==null&&u!==void 0?u:0,minTickGap:(y=e.minTickGap)!==null&&y!==void 0?y:5,tick:(b=e.tick)!==null&&b!==void 0?b:!0,tickFormatter:e.tickFormatter}),Ae.createElement(kK,e))},LK={allowDataOverflow:vc.allowDataOverflow,allowDecimals:vc.allowDecimals,allowDuplicatedCategory:vc.allowDuplicatedCategory,hide:!1,mirror:vc.mirror,orientation:vc.orientation,padding:vc.padding,reversed:vc.reversed,scale:vc.scale,tickCount:vc.tickCount,type:vc.type,width:vc.width,yAxisId:0};class GE extends Ae.Component{render(){return Ae.createElement(RK,this.props)}}K3(GE,"displayName","YAxis");K3(GE,"defaultProps",LK);var Bw={exports:{}},jw={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WD;function zK(){if(WD)return jw;WD=1;var e=jg();function n(D,k){return D===k&&(D!==0||1/D===1/k)||D!==D&&k!==k}var l=typeof Object.is=="function"?Object.is:n,u=e.useSyncExternalStore,y=e.useRef,b=e.useEffect,I=e.useMemo,o=e.useDebugValue;return jw.useSyncExternalStoreWithSelector=function(D,k,L,$,q){var Z=y(null);if(Z.current===null){var ie={hasValue:!1,value:null};Z.current=ie}else ie=Z.current;Z=I(function(){function le(ze){if(!xe){if(xe=!0,ge=ze,ze=$(ze),q!==void 0&&ie.hasValue){var nt=ie.value;if(q(nt,ze))return ke=nt}return ke=ze}if(nt=ke,l(ge,ze))return nt;var pt=$(ze);return q!==void 0&&q(nt,pt)?(ge=ze,nt):(ge=ze,ke=pt)}var xe=!1,ge,ke,et=L===void 0?null:L;return[function(){return le(k())},et===null?void 0:function(){return le(et())}]},[k,L,$,q]);var oe=u(D,Z[0],Z[1]);return b(function(){ie.hasValue=!0,ie.value=oe},[oe]),o(oe),oe},jw}var HD;function FK(){return HD||(HD=1,Bw.exports=zK()),Bw.exports}FK();function NK(e){e()}function BK(){let e=null,n=null;return{clear(){e=null,n=null},notify(){NK(()=>{let l=e;for(;l;)l.callback(),l=l.next})},get(){const l=[];let u=e;for(;u;)l.push(u),u=u.next;return l},subscribe(l){let u=!0;const y=n={callback:l,next:null,prev:n};return y.prev?y.prev.next=y:e=y,function(){!u||e===null||(u=!1,y.next?y.next.prev=y.prev:n=y.prev,y.prev?y.prev.next=y.next:e=y.next)}}}}var ZD={notify(){},get:()=>[]};function jK(e,n){let l,u=ZD,y=0,b=!1;function I(oe){L();const le=u.subscribe(oe);let xe=!1;return()=>{xe||(xe=!0,le(),$())}}function o(){u.notify()}function D(){ie.onStateChange&&ie.onStateChange()}function k(){return b}function L(){y++,l||(l=e.subscribe(D),u=BK())}function $(){y--,l&&y===0&&(l(),l=void 0,u.clear(),u=ZD)}function q(){b||(b=!0,L())}function Z(){b&&(b=!1,$())}const ie={addNestedSub:I,notifyNestedSubs:o,handleChangeWrapper:D,isSubscribed:k,trySubscribe:q,tryUnsubscribe:Z,getListeners:()=>u};return ie}var UK=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",VK=UK(),$K=()=>typeof navigator<"u"&&navigator.product==="ReactNative",GK=$K(),qK=()=>VK||GK?Ae.useLayoutEffect:Ae.useEffect,WK=qK(),Uw=Symbol.for("react-redux-context"),Vw=typeof globalThis<"u"?globalThis:{};function HK(){if(!Ae.createContext)return{};const e=Vw[Uw]??(Vw[Uw]=new Map);let n=e.get(Ae.createContext);return n||(n=Ae.createContext(null),e.set(Ae.createContext,n)),n}var ZK=HK();function XK(e){const{children:n,context:l,serverState:u,store:y}=e,b=Ae.useMemo(()=>{const D=jK(y);return{store:y,subscription:D,getServerState:u?()=>u:void 0}},[y,u]),I=Ae.useMemo(()=>y.getState(),[y]);WK(()=>{const{subscription:D}=b;return D.onStateChange=D.notifyNestedSubs,D.trySubscribe(),I!==y.getState()&&D.notifyNestedSubs(),()=>{D.tryUnsubscribe(),D.onStateChange=void 0}},[b,I]);const o=l||ZK;return Ae.createElement(o.Provider,{value:b},n)}var YK=XK,KK=(e,n)=>n,qE=Ht([KK,xo,XW,Ya,o3,_f,B7,Ha],G7),WE=e=>{var n=e.currentTarget.getBoundingClientRect(),l=n.width/e.currentTarget.offsetWidth,u=n.height/e.currentTarget.offsetHeight;return{chartX:Math.round((e.clientX-n.left)/l),chartY:Math.round((e.clientY-n.top)/u)}},J3=fu("mouseClick"),Q3=Iy();Q3.startListening({actionCreator:J3,effect:(e,n)=>{var l=e.payload,u=qE(n.getState(),WE(l));(u==null?void 0:u.activeIndex)!=null&&n.dispatch(YH({activeIndex:u.activeIndex,activeDataKey:void 0,activeCoordinate:u.activeCoordinate}))}});var YS=fu("mouseMove"),eF=Iy();eF.startListening({actionCreator:YS,effect:(e,n)=>{var l=e.payload,u=n.getState(),y=IE(u,u.tooltip.settings.shared),b=qE(u,WE(l));y==="axis"&&((b==null?void 0:b.activeIndex)!=null?n.dispatch(Jz({activeIndex:b.activeIndex,activeDataKey:void 0,activeCoordinate:b.activeCoordinate})):n.dispatch(Kz()))}});function JK(e,n){return n instanceof HTMLElement?"HTMLElement <".concat(n.tagName,' class="').concat(n.className,'">'):n===window?"global.window":n}var XD={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index"},tF=mu({name:"rootProps",initialState:XD,reducers:{updateOptions:(e,n)=>{var l;e.accessibilityLayer=n.payload.accessibilityLayer,e.barCategoryGap=n.payload.barCategoryGap,e.barGap=(l=n.payload.barGap)!==null&&l!==void 0?l:XD.barGap,e.barSize=n.payload.barSize,e.maxBarSize=n.payload.maxBarSize,e.stackOffset=n.payload.stackOffset,e.syncId=n.payload.syncId,e.syncMethod=n.payload.syncMethod,e.className=n.payload.className}}}),QK=tF.reducer,{updateOptions:eJ}=tF.actions,rF=mu({name:"polarOptions",initialState:null,reducers:{updatePolarOptions:(e,n)=>n.payload}}),{updatePolarOptions:nQ}=rF.actions,tJ=rF.reducer,nF=fu("keyDown"),iF=fu("focus"),HE=Iy();HE.startListening({actionCreator:nF,effect:(e,n)=>{var l=n.getState(),u=l.rootProps.accessibilityLayer!==!1;if(u){var{keyboardInteraction:y}=l.tooltip,b=e.payload;if(!(b!=="ArrowRight"&&b!=="ArrowLeft"&&b!=="Enter")){var I=Number(PE(y,Wm(l))),o=_f(l);if(b==="Enter"){var D=L0(l,"axis","hover",String(y.index));n.dispatch(US({active:!y.active,activeIndex:y.index,activeDataKey:y.dataKey,activeCoordinate:D}));return}var k=UH(l),L=k==="left-to-right"?1:-1,$=b==="ArrowRight"?1:-1,q=I+$*L;if(!(o==null||q>=o.length||q<0)){var Z=L0(l,"axis","hover",String(q));n.dispatch(US({active:!0,activeIndex:q.toString(),activeDataKey:void 0,activeCoordinate:Z}))}}}}});HE.startListening({actionCreator:iF,effect:(e,n)=>{var l=n.getState(),u=l.rootProps.accessibilityLayer!==!1;if(u){var{keyboardInteraction:y}=l.tooltip;if(!y.active&&y.index==null){var b="0",I=L0(l,"axis","hover",String(b));n.dispatch(US({activeDataKey:void 0,active:!0,activeIndex:b,activeCoordinate:I}))}}}});var lu=fu("externalEvent"),oF=Iy();oF.startListening({actionCreator:lu,effect:(e,n)=>{if(e.payload.handler!=null){var l=n.getState(),u={activeCoordinate:M7(l),activeDataKey:c3(l),activeIndex:Bg(l),activeLabel:l3(l),activeTooltipIndex:Bg(l),isTooltipActive:O7(l)};e.payload.handler(u,e.payload.reactEvent)}}});var rJ=Ht([Zg],e=>e.tooltipItemPayloads),nJ=Ht([rJ,Fy,(e,n,l)=>n,(e,n,l)=>l],(e,n,l,u)=>{var y=e.find(o=>o.settings.dataKey===u);if(y!=null){var{positions:b}=y;if(b!=null){var I=n(b,l);return I}}}),aF=fu("touchMove"),sF=Iy();sF.startListening({actionCreator:aF,effect:(e,n)=>{var l=e.payload,u=n.getState(),y=IE(u,u.tooltip.settings.shared);if(y==="axis"){var b=qE(u,WE({clientX:l.touches[0].clientX,clientY:l.touches[0].clientY,currentTarget:l.currentTarget}));(b==null?void 0:b.activeIndex)!=null&&n.dispatch(Jz({activeIndex:b.activeIndex,activeDataKey:void 0,activeCoordinate:b.activeCoordinate}))}else if(y==="item"){var I,o=l.touches[0],D=document.elementFromPoint(o.clientX,o.clientY);if(!D||!D.getAttribute)return;var k=D.getAttribute(p8),L=(I=D.getAttribute(m8))!==null&&I!==void 0?I:void 0,$=nJ(n.getState(),k,L);n.dispatch(Yz({activeDataKey:L,activeIndex:k,activeCoordinate:$}))}}});var iJ=wR({brush:wY,cartesianAxis:_K,chartData:s9,graphicalItems:CZ,layout:N6,legend:A8,options:r9,polarAxis:wZ,polarOptions:tJ,referenceElements:CY,rootProps:QK,tooltip:KH}),oJ=function(n){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Chart";return c6({reducer:iJ,preloadedState:n,middleware:u=>u({serializableCheck:!1}).concat([Q3.middleware,eF.middleware,HE.middleware,oF.middleware,sF.middleware]),devTools:{serialize:{replacer:JK},name:"recharts-".concat(l)}})};function aJ(e){var{preloadedState:n,children:l,reduxStoreName:u}=e,y=ql(),b=Ae.useRef(null);if(y)return l;b.current==null&&(b.current=oJ(n,u));var I=MT;return Ae.createElement(YK,{context:I,store:b.current},l)}function sJ(e){var{layout:n,width:l,height:u,margin:y}=e,b=Ba(),I=ql();return Ae.useEffect(()=>{I||(b(L6(n)),b(z6({width:l,height:u})),b(R6(y)))},[b,I,n,l,u,y]),null}function lJ(e){var n=Ba();return Ae.useEffect(()=>{n(eJ(e))},[n,e]),null}var cJ=["children"];function uJ(e,n){if(e==null)return{};var l,u,y=hJ(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function hJ(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}function U0(){return U0=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},U0.apply(null,arguments)}var dJ={width:"100%",height:"100%"},fJ=Ae.forwardRef((e,n)=>{var l=JR(),u=QR(),y=tL();if(!x0(l)||!x0(u))return null;var{children:b,otherAttributes:I,title:o,desc:D}=e,k,L;return typeof I.tabIndex=="number"?k=I.tabIndex:k=y?0:void 0,typeof I.role=="string"?L=I.role:L=y?"application":void 0,Ae.createElement(Wk,U0({},I,{title:o,desc:D,role:L,tabIndex:k,width:l,height:u,style:dJ,ref:n}),b)}),pJ=e=>{var{children:n}=e,l=Ln(fx);if(!l)return null;var{width:u,height:y,y:b,x:I}=l;return Ae.createElement(Wk,{width:u,height:y,x:I,y:b},n)},YD=Ae.forwardRef((e,n)=>{var{children:l}=e,u=uJ(e,cJ),y=ql();return y?Ae.createElement(pJ,null,l):Ae.createElement(fJ,U0({ref:n},u),l)});function mJ(){var e=Ba(),[n,l]=Ae.useState(null),u=Ln(f8);return Ae.useEffect(()=>{if(n!=null){var y=n.getBoundingClientRect(),b=y.width/n.offsetWidth;Pc(b)&&b!==u&&e(F6(b))}},[n,e,u]),l}function KD(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);n&&(u=u.filter(function(y){return Object.getOwnPropertyDescriptor(e,y).enumerable})),l.push.apply(l,u)}return l}function gJ(e){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?KD(Object(l),!0).forEach(function(u){_J(e,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):KD(Object(l)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(l,u))})}return e}function _J(e,n,l){return(n=yJ(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function yJ(e){var n=vJ(e,"string");return typeof n=="symbol"?n:n+""}function vJ(e,n){if(typeof e!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var u=l.call(e,n);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var xJ=Ae.forwardRef((e,n)=>{var{children:l,className:u,height:y,onClick:b,onContextMenu:I,onDoubleClick:o,onMouseDown:D,onMouseEnter:k,onMouseLeave:L,onMouseMove:$,onMouseUp:q,onTouchEnd:Z,onTouchMove:ie,onTouchStart:oe,style:le,width:xe}=e,ge=Ba(),[ke,et]=Ae.useState(null),[ze,nt]=Ae.useState(null);u9();var pt=mJ(),Gt=Ae.useCallback(St=>{pt(St),typeof n=="function"&&n(St),et(St),nt(St)},[pt,n,et,nt]),ir=Ae.useCallback(St=>{ge(J3(St)),ge(lu({handler:b,reactEvent:St}))},[ge,b]),Br=Ae.useCallback(St=>{ge(YS(St)),ge(lu({handler:k,reactEvent:St}))},[ge,k]),Zt=Ae.useCallback(St=>{ge(Kz()),ge(lu({handler:L,reactEvent:St}))},[ge,L]),dr=Ae.useCallback(St=>{ge(YS(St)),ge(lu({handler:$,reactEvent:St}))},[ge,$]),Dr=Ae.useCallback(()=>{ge(iF())},[ge]),vr=Ae.useCallback(St=>{ge(nF(St.key))},[ge]),Ar=Ae.useCallback(St=>{ge(lu({handler:I,reactEvent:St}))},[ge,I]),zr=Ae.useCallback(St=>{ge(lu({handler:o,reactEvent:St}))},[ge,o]),qr=Ae.useCallback(St=>{ge(lu({handler:D,reactEvent:St}))},[ge,D]),lr=Ae.useCallback(St=>{ge(lu({handler:q,reactEvent:St}))},[ge,q]),br=Ae.useCallback(St=>{ge(lu({handler:oe,reactEvent:St}))},[ge,oe]),Ft=Ae.useCallback(St=>{ge(aF(St)),ge(lu({handler:ie,reactEvent:St}))},[ge,ie]),ot=Ae.useCallback(St=>{ge(lu({handler:Z,reactEvent:St}))},[ge,Z]);return Ae.createElement(m3.Provider,{value:ke},Ae.createElement(oU.Provider,{value:ze},Ae.createElement("div",{className:co("recharts-wrapper",u),style:gJ({position:"relative",cursor:"default",width:xe,height:y},le),onClick:ir,onContextMenu:Ar,onDoubleClick:zr,onFocus:Dr,onKeyDown:vr,onMouseDown:qr,onMouseEnter:Br,onMouseLeave:Zt,onMouseMove:dr,onMouseUp:lr,onTouchEnd:ot,onTouchMove:Ft,onTouchStart:br,ref:Gt},l)))}),bJ=["children","className","width","height","style","compact","title","desc"];function wJ(e,n){if(e==null)return{};var l,u,y=SJ(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function SJ(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}var TJ=Ae.forwardRef((e,n)=>{var{children:l,className:u,width:y,height:b,style:I,compact:o,title:D,desc:k}=e,L=wJ(e,bJ),$=$o(L,!1);return o?Ae.createElement(YD,{otherAttributes:$,title:D,desc:k},l):Ae.createElement(xJ,{className:u,style:I,width:y,height:b,onClick:e.onClick,onMouseLeave:e.onMouseLeave,onMouseEnter:e.onMouseEnter,onMouseMove:e.onMouseMove,onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,onContextMenu:e.onContextMenu,onDoubleClick:e.onDoubleClick,onTouchStart:e.onTouchStart,onTouchMove:e.onTouchMove,onTouchEnd:e.onTouchEnd},Ae.createElement(YD,{otherAttributes:$,title:D,desc:k,ref:n},Ae.createElement(OY,null,l)))}),EJ=["width","height"];function KS(){return KS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var u in l)({}).hasOwnProperty.call(l,u)&&(e[u]=l[u])}return e},KS.apply(null,arguments)}function AJ(e,n){if(e==null)return{};var l,u,y=IJ(e,n);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(u=0;u<b.length;u++)l=b[u],n.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(y[l]=e[l])}return y}function IJ(e,n){if(e==null)return{};var l={};for(var u in e)if({}.hasOwnProperty.call(e,u)){if(n.indexOf(u)!==-1)continue;l[u]=e[u]}return l}var PJ={top:5,right:5,bottom:5,left:5},CJ={accessibilityLayer:!0,layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:PJ,reverseStackOrder:!1,syncMethod:"index"},MJ=Ae.forwardRef(function(n,l){var u,y=Tp(n.categoricalChartProps,CJ),{width:b,height:I}=y,o=AJ(y,EJ);if(!x0(b)||!x0(I))return null;var{chartName:D,defaultTooltipEventType:k,validateTooltipEventTypes:L,tooltipPayloadSearcher:$,categoricalChartProps:q}=n,Z={chartName:D,defaultTooltipEventType:k,validateTooltipEventTypes:L,tooltipPayloadSearcher:$,eventEmitter:void 0};return Ae.createElement(aJ,{preloadedState:{options:Z},reduxStoreName:(u=q.id)!==null&&u!==void 0?u:D},Ae.createElement(bY,{chartData:q.data}),Ae.createElement(sJ,{width:b,height:I,layout:y.layout,margin:y.margin}),Ae.createElement(lJ,{accessibilityLayer:y.accessibilityLayer,barCategoryGap:y.barCategoryGap,maxBarSize:y.maxBarSize,stackOffset:y.stackOffset,barGap:y.barGap,barSize:y.barSize,syncId:y.syncId,syncMethod:y.syncMethod,className:y.className}),Ae.createElement(TJ,KS({},o,{width:b,height:I,ref:l})))}),OJ=["axis","item"],DJ=Ae.forwardRef((e,n)=>Ae.createElement(MJ,{chartName:"BarChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:OJ,tooltipPayloadSearcher:e9,categoricalChartProps:e,ref:n}));const JS={"Soil Fertility Map":"SFM","Green Forest Change":"SCL"};function JD(e){const n={};return e.features.forEach(l=>{var y;const u=(y=l.properties)==null?void 0:y.name;u&&(n[u]=(n[u]||0)+1)}),n}function QD(e){const n=Object.values(e).reduce((o,D)=>o+D,0),l=Object.values(e).map(o=>o/n),u=-l.reduce((o,D)=>o+D*Math.log(D),0),y=1-l.reduce((o,D)=>o+D*D,0),b=Object.keys(e).length,I=b>1?u/Math.log(b):1;return{shannon:Number(u.toFixed(4)),simpson:Number(y.toFixed(4)),richness:b,evenness:Number(I.toFixed(4))}}function kJ({onSelect:e}){const n=[{id:1,title:"Farm Monitoring",accent:"accent1",items:["View Farm Overview",{title:"Crop Details",children:["Live Satellite View","Historical Data"]}]},{id:2,title:"Organic Assessment",accent:"accent2",items:[{title:"Soil Health Map",children:["Soil Nutrients and Chemicals"]},{title:"Crop Health Analysis",children:["NDVI","SAVI","PVI"]},{title:"Forest Cover Change",children:["Green Forest Change"]},{title:"Water Resource Mapping",children:["NDWI","NDMI","MSI","Evapotranspiration"]},{title:"Organic Zone Boundaries",children:["Soil Fertility Map","Pesticide Drift Risk Map"]},{title:"Pollinator Activity Zones",children:["Pollinator Habitat Map","Pollinator Activity Map"]},{title:"Buffer Zone Assessment",children:["Buffer Zone Map","Buffer Zone Analysis"]},{title:"Carbon Sequestration",children:[]}]},{id:3,title:"Crop Details",accent:"accent7",items:["Land Use & Landscape ID","Main Crop Identification","Adjacent Land Use","Mixed Crop & Crop Cycle","Rotation Crop Identification","Crop Yield Estimation","Cover Cropping Implementation","Crop Rotation Planner",{title:"Agroforestry Integration",children:["Tracks Tree Planting & Maintenance","Green Cover Changes","Deforestation Monitoring"]},"No-Till Farming Zones",{title:"Soil Info",children:["Soil Erosion Risk Zones","Soil Carbon Content Tracking","Nutrient Balance Maps"]}]},{id:4,title:"Carbon & GHG Metrics",accent:"accent3",items:["CO Capture Data","GHG Emission Tracker","Carbon Credit Mgmt.","Emission Comparison"]},{id:5,title:"Biodiversity Assessment",accent:"accent4",items:[{title:"Terrestrial Biodiversity",children:["Bird Species Data","Species Observation Log","Wildlife Corridor Mapping","Invasive Species Data","Endangered Species Data","Tree Species Data","Pollinator Data"]},{title:"Aquatic Biodiversity",children:["Aquatic Biodiversity Data"]},{title:"Biodiversity Health & Indices",children:["Biodiversity Index Score","Soil Microbes & Biodiv."]},{title:"Biodiversity Visualization Tools",children:["Biodiv. Hotspot Viewer","Impact Heatmap"]},"Wildlife Data"]},{id:6,title:"Compliance & Regulatory",accent:"accent5",items:["Compliance Dashboard","Generate Compl. Reports","Submit Data to Regulators"]},{id:7,title:"SDGs",accent:"accent6",items:[]}],l={accent1:"bg-lime-300 text-black",accent2:"bg-cyan-300 text-black",accent3:"bg-pink-300 text-black",accent4:"bg-yellow-300 text-black",accent5:"bg-purple-300 text-black",accent6:"bg-blue-300 text-black",accent7:"bg-orange-300 text-black"},[u,y]=Ae.useState(null);return Me.jsxs("nav",{className:"w-64 bg-sidebar text-white p-4 font-body flex flex-col h-full",children:[Me.jsxs("div",{className:"flex-grow",children:[Me.jsx("h1",{className:"text-lg mb-4 font-semibold",children:"Organic Agriculture Assessments"}),n.map(b=>Me.jsxs("div",{className:"mb-3",children:[Me.jsxs("button",{className:`w-full text-left px-3 py-2 border rounded-lg flex justify-between items-center font-semibold transition ${u===b.id?"border-white bg-white bg-opacity-10":"border-gray-600"}`,onClick:()=>y(u===b.id?null:b.id),children:[Me.jsx("span",{children:b.title}),Me.jsx("span",{className:"transform transition",children:u===b.id?"":""})]}),u===b.id&&b.items.length>0&&Me.jsx("ul",{className:`mt-1 ml-2 rounded px-2 py-2 text-sm ${l[b.accent]}`,children:b.items.map((I,o)=>typeof I=="string"?Me.jsxs("li",{className:"cursor-pointer hover:underline",onClick:()=>{const D=JS[I.trim()]||I;e(b.title,D)},children:[" ",I]},o):Me.jsxs("li",{children:[Me.jsx("div",{className:"font-semibold mt-2",children:I.title}),Me.jsx("ul",{className:"ml-4 list-disc",children:I.children.map((D,k)=>Me.jsx("li",{className:"cursor-pointer hover:underline",onClick:()=>e(b.title,D),children:D},k))})]},o))})]},b.id))]}),Me.jsx("div",{className:"mt-auto pt-4 flex justify-end",children:Me.jsx("div",{className:"w-16 h-16 bg-white bg-opacity-20 rounded-lg flex items-center justify-center",children:Me.jsx("img",{src:"/ffbs-logo.png",alt:"Logo",className:"w-12 h-12 object-contain"})})})]})}function RJ({zoom:e,onZoom:n,onUploadClick:l}){return Me.jsxs("header",{className:"absolute top-0 left-0 right-0 flex justify-between items-center bg-black bg-opacity-60 text-white p-2 text-sm z-10",children:[Me.jsx("div",{className:"flex items-center gap-2"}),Me.jsxs("div",{className:"flex items-center gap-2",children:[Me.jsx("button",{className:"px-3 py-1 bg-white bg-opacity-20 rounded",children:"My Profile"}),Me.jsx("button",{className:"px-3 py-1 bg-white bg-opacity-20 rounded",children:"Login "}),Me.jsx("button",{className:"px-3 py-1 bg-white bg-opacity-20 rounded",children:""})]})]})}function LJ({open:e,onClose:n,section:l,item:u,gbifSpecies:y=[],inatSpecies:b=[],farms:I={},onFarmSelect:o,onUploadClick:D,satProvider:k,setSatProvider:L,selectedFarm:$,setSelectedFarm:q,selectedRangeRef:Z,selectedGHG:ie,setSelectedGHG:oe,thumbnails:le,setThumbnails:xe,mapInstance:ge,activeThumbnailId:ke,setActiveThumbnailId:et,ebirdSpecies:ze=[],ebirdHotspots:nt=[],resample:pt,setResample:Gt,selectedIndicator:ir,setSelectedIndicator:Br,currentFrameIndex:Zt,setCurrentFrameIndex:dr,setIndicatorFrames:Dr,indicatorFrames:vr=[],indicatorLayers:Ar,setIndicatorLayers:zr,hotspotVisible:qr,setHotspotVisible:lr,gbifVisible:br,setGbifVisible:Ft,inatVisible:ot,setInatVisible:St,esaVisible:Ur,setEsaVisible:gn,diversityMetrics:Sr,inatDiversityMetrics:kr,isLoading:Vr,setIsLoading:wn}){var Tn,Kt;const Qr=l?{"Farm Monitoring":"bg-lime-300","Organic Assessment":"bg-cyan-300","Carbon & GHG Metrics":"bg-pink-300","Biodiversity Assessment":"bg-yellow-300","Compliance & Regulatory":"bg-purple-300",SDGs:"bg-blue-300","Crop Details":"bg-orange-300"}[l]:"bg-gray-300";return Me.jsxs("div",{className:`fixed top-0 right-0 h-full w-80 ${Qr} p-4 transform transition-transform ${e?"translate-x-0":"translate-x-full"} z-20 overflow-y-auto`,children:[Me.jsx("button",{onClick:n,className:"absolute left-0 top-1/2 -translate-x-full bg-panelBg p-2 rounded-l",children:""}),Me.jsx("h2",{className:"text-xl mb-2 font-bold",children:l}),Me.jsxs("p",{className:"text-sm mb-4",children:["You selected: ",Me.jsx("strong",{children:u})]}),l==="Biodiversity Assessment"&&u==="Species Observation Log"&&Me.jsxs(Me.Fragment,{children:[Me.jsxs("div",{className:"mb-2 bg-white text-black rounded p-2 text-sm",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"My Farms"}),Me.jsx("ul",{className:"space-y-1",children:Object.keys(I).map(We=>Me.jsx("li",{children:Me.jsx("button",{onClick:()=>{o(We),q(We)},className:"w-full text-left hover:underline",children:We})},We))})]}),Me.jsxs("div",{className:"flex gap-2 mb-2",children:[Me.jsx("button",{onClick:()=>{if(!ge)return;const We=ge.getLayoutProperty("gbif-species-layer","visibility");ge.setLayoutProperty("gbif-species-layer","visibility",We==="visible"?"none":"visible")},className:"px-2 py-1 bg-blue-500 text-white text-xs rounded",children:"Toggle GBIF Layer"}),Me.jsx("button",{onClick:()=>{if(!ge)return;const We=ge.getLayoutProperty("inat-species-layer","visibility");ge.setLayoutProperty("inat-species-layer","visibility",We==="visible"?"none":"visible")},className:"px-2 py-1 bg-green-500 text-white text-xs rounded",children:"Toggle iNat Layer"})]}),Me.jsxs("div",{className:"mt-4 bg-white text-black rounded p-2 text-sm",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Biodiversity Metrics"}),br&&Sr&&Me.jsxs("div",{className:"mb-3",children:[Me.jsx("h4",{className:"text-xs font-bold text-green-700 mb-1",children:"From GBIF"}),Object.entries(Sr).map(([We,fr])=>Me.jsxs("div",{className:"mb-1",children:[Me.jsxs("p",{className:"text-xs",children:[We,": ",fr]}),Me.jsx("div",{className:"h-1 bg-gray-200 rounded",children:Me.jsx("div",{className:"h-1 bg-green-500 rounded",style:{width:`${Math.min(fr*100,100)}%`}})})]},We))]}),ot&&kr&&Me.jsxs("div",{children:[Me.jsx("h4",{className:"text-xs font-bold text-blue-700 mb-1",children:"From iNaturalist"}),Object.entries(kr).map(([We,fr])=>Me.jsxs("div",{className:"mb-1",children:[Me.jsxs("p",{className:"text-xs",children:[We,": ",fr]}),Me.jsx("div",{className:"h-1 bg-gray-200 rounded",children:Me.jsx("div",{className:"h-1 bg-blue-500 rounded",style:{width:`${Math.min(fr*100,100)}%`}})})]},We))]})]}),Me.jsxs("div",{className:"bg-white text-black rounded p-2 text-sm max-h-[400px] overflow-y-auto space-y-4",children:[Me.jsxs("div",{children:[Me.jsxs("h3",{className:"font-semibold mb-2",children:["GBIF Species (",y.length,")"]}),y.length===0?Me.jsx("p",{children:"No species found."}):Me.jsx("ul",{className:"list-disc list-inside space-y-1",children:y.map((We,fr)=>Me.jsx("li",{children:We},fr))})]}),Me.jsxs("div",{children:[Me.jsxs("h3",{className:"font-semibold mb-2",children:["iNaturalist Species (",b.length,")"]}),b.length===0?Me.jsx("p",{children:"No species found."}):Me.jsx("ul",{className:"list-disc list-inside space-y-1",children:b.map((We,fr)=>Me.jsx("li",{children:We},fr))})]})]})]}),l==="Biodiversity Assessment"&&u==="Bird Species Data"&&Me.jsxs("div",{className:"bg-white text-black rounded p-2 text-sm max-h-[400px] overflow-y-auto space-y-4",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"My Farms"}),Me.jsx("ul",{className:"space-y-1",children:Object.keys(I).map(We=>Me.jsx("li",{children:Me.jsx("button",{onClick:()=>{o(We),q(We)},className:"w-full text-left hover:underline",children:We})},We))}),Me.jsx("div",{className:"flex gap-2 mb-2",children:Me.jsx("button",{onClick:()=>{if(!ge)return;const We=ge.getLayoutProperty("ebird-species-layer","visibility");ge.setLayoutProperty("ebird-species-layer","visibility",We==="visible"?"none":"visible")},className:"px-2 py-1 bg-pink-600 text-white text-xs rounded",children:"Toggle eBird Layer"})}),Me.jsxs("h3",{className:"font-semibold mb-2",children:["eBird Species (",ze.length,")"]}),ze.length===0?Me.jsx("p",{children:"No species found."}):Me.jsx("ul",{className:"list-disc list-inside space-y-1",children:ze.map((We,fr)=>Me.jsx("li",{children:We},fr))})]}),l==="Compliance & Regulatory"&&Me.jsxs("div",{className:"bg-white text-black rounded p-2 text-sm mt-4 space-y-4",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Actions"}),Me.jsx("a",{href:"/reports/sample_report.pdf",target:"_blank",rel:"noopener noreferrer",className:"block w-full text-center px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:" View Compliance Report"})]}),l==="Biodiversity Assessment"&&u==="Biodiv. Hotspot Viewer"&&Me.jsxs("div",{className:"bg-white text-black rounded p-2 text-sm max-h-[400px] overflow-y-auto space-y-4",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"My Farms"}),Me.jsx("ul",{className:"space-y-1",children:Object.keys(I).map(We=>Me.jsx("li",{children:Me.jsx("button",{onClick:()=>{o(We),q(We)},className:"w-full text-left hover:underline",children:We})},We))}),Me.jsx("button",{onClick:D,className:"px-3 py-1 bg-white bg-opacity-20 rounded",children:"Upload Region of Interest"}),Me.jsxs("div",{className:"flex items-center justify-between",children:[Me.jsx("label",{className:"font-medium",children:"Toggle Hotspot Layer"}),Me.jsx("button",{onClick:()=>{const We="ebird-hotspots-layer";if(!(ge!=null&&ge.getLayer(We)))return;const jr=ge.getLayoutProperty(We,"visibility")==="visible"?"none":"visible";ge.setLayoutProperty(We,"visibility",jr),lr(jr==="visible")},className:`px-2 py-1 rounded ${qr?"bg-green-500":"bg-gray-400"} text-white text-sm`,children:qr?"Hide":"Show"})]}),Me.jsxs("h3",{className:"font-semibold mb-2",children:["Nearby eBird Hotspots (",nt.length,")"]}),!Array.isArray(nt)||nt.length===0?Me.jsx("p",{children:"No hotspots found."}):Me.jsxs("table",{className:"w-full text-xs border border-gray-300 bg-white text-black",children:[Me.jsx("thead",{className:"bg-gray-100 text-left",children:Me.jsxs("tr",{children:[Me.jsx("th",{className:"px-2 py-1 border-b",children:"Location"}),Me.jsx("th",{className:"px-2 py-1 border-b",children:"Latitude"}),Me.jsx("th",{className:"px-2 py-1 border-b",children:"Longitude"})]})}),Me.jsx("tbody",{children:nt.map((We,fr)=>Me.jsxs("tr",{className:"hover:bg-gray-50",children:[Me.jsx("td",{className:"px-2 py-1 border-b",children:We.locName}),Me.jsx("td",{className:"px-2 py-1 border-b",children:We.lat.toFixed(4)}),Me.jsx("td",{className:"px-2 py-1 border-b",children:We.lng.toFixed(4)})]},fr))})]})]}),l==="Crop Details"&&u==="Land Use & Landscape ID"&&Me.jsxs("div",{className:"bg-white text-black rounded p-2 text-sm mt-4 space-y-4",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"My Farms"}),Me.jsx("ul",{className:"space-y-1",children:Object.keys(I).map(We=>Me.jsx("li",{children:Me.jsx("button",{onClick:()=>{o(We),q(We)},className:"w-full text-left hover:underline",children:We})},We))}),Me.jsx("button",{onClick:D,className:"px-3 py-1 bg-white bg-opacity-20 rounded",children:"Upload Region of Interest"}),Me.jsx("h3",{className:"font-semibold text-sm",children:"ESA Global Landcover"}),Me.jsx("p",{className:"text-xs mb-2",children:"Toggle 30m ESA WorldCover raster layer visibility."}),$?Me.jsx("button",{onClick:()=>{if(!ge)return;const We="esa-worldcover-layer",jr=ge.getLayoutProperty(We,"visibility")==="visible"?"none":"visible";ge.setLayoutProperty(We,"visibility",jr),gn(jr==="visible"),console.log(` ESA visibility toggled: ${jr}`)},className:"w-full mb-2 px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:Ur?"Hide ESA Landcover Layer":"Show ESA Landcover Layer"}):Me.jsx("p",{className:"text-xs text-red-600",children:"Please select a farm first."})]}),l==="Carbon & GHG Metrics"&&u==="GHG Emission Tracker"&&Me.jsxs("div",{className:"bg-pink-100 text-black rounded-lg p-4 text-sm mt-4 shadow-md border border-pink-300",children:[Me.jsx("h3",{className:"text-base font-bold mb-3 text-pink-800",children:"GHG Indicators"}),Me.jsx("div",{className:"grid grid-cols-1 gap-3 ",children:[{code:"CO",name:"Carbon monoxide"},{code:"CH",name:"Methane"},{code:"NO",name:"Nitrogen dioxide"},{code:"O",name:"Ozone"},{code:"SO",name:"Sulfur dioxide"}].map((We,fr)=>Me.jsxs("button",{onClick:()=>{if(oe(We.code),We.code==="O"&&ge){const jr="ozone-global";ge.getLayer(jr)&&ge.removeLayer(jr),ge.getSource(jr)&&ge.removeSource(jr),ge.addSource(jr,{type:"image",url:"http://3.121.112.193:8000/static/ozone.png",coordinates:[[-179.989013671875,89.989013671875],[179.989013671875,89.989013671875],[179.989013671875,-89.989013671875],[-179.989013671875,-89.989013671875]]}),ge.addLayer({id:jr,type:"raster",source:jr,paint:{"raster-opacity":1}}),console.log(" Ozone layer added to map")}},className:`w-full text-left rounded-md px-3 py-2 border transition ${ie===We.code?"bg-pink-200 border-pink-500 font-semibold":"border-pink-200 hover:bg-pink-50"}`,children:[Me.jsx("span",{className:"font-mono text-pink-800",children:We.code})," "," ",Me.jsx("span",{className:"text-gray-700",children:We.name})]},fr))}),ie&&Me.jsxs("div",{className:"mt-4 text-sm text-center text-pink-700",children:["Selected Indicator:"," ",Me.jsx("span",{className:"font-bold text-pink-900",children:ie})]})]}),l==="Organic Assessment"&&Me.jsxs("div",{className:"bg-white text-black rounded p-2 text-sm mt-4 space-y-4",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"My Farms"}),Me.jsx("ul",{className:"space-y-1",children:Object.keys(I).map(We=>Me.jsx("li",{children:Me.jsx("button",{onClick:()=>{o(We),q(We)},className:"w-full text-left hover:underline",children:We})},We))}),Me.jsx("button",{onClick:D,className:"px-3 py-1 bg-white bg-opacity-20 rounded",children:"Upload Region of Interest"}),Me.jsxs("div",{className:"pt-2",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Select Date"}),Me.jsx(zv,{selectRange:!0,maxDate:new Date,onChange:We=>{console.log(" Selected range:",We),Z.current=We}})]}),Me.jsxs("div",{className:"mt-3",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Satellite Sensor"}),Me.jsxs("select",{value:k,onChange:We=>L(We.target.value),className:"w-full border rounded px-2 py-1 bg-white text-black",children:[Me.jsx("option",{value:"sentinel-2",children:"Sentinel-2"}),Me.jsx("option",{value:"landsat",children:"Landsat"}),Me.jsx("option",{value:"naip",children:"NAIP"})]})]}),Me.jsxs("div",{children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Cloud Cover (%)"}),Me.jsx("input",{type:"range",min:"0",max:"100",step:"10",value:50,onChange:()=>{},className:"w-full"}),Me.jsx("div",{className:"text-xs mt-1 text-right",children:"50%"})]}),Me.jsxs("select",{value:pt,onChange:We=>Gt(We.target.value),className:"w-full border px-2 py-1 rounded",children:[Me.jsx("option",{value:"1D",children:"Daily"}),Me.jsx("option",{value:"W",children:"Weekly"}),Me.jsx("option",{value:"MS",children:"Monthly"})]}),Me.jsx("button",{onClick:async()=>{var Di;wn(!0);const We=Z.current;if(!$||!We||!We[0]||!We[1]){alert("Please select a farm and date range."),wn(!1);return}const[fr,jr]=We,mr=I[$];if(!(mr!=null&&mr.wkt)){alert("Invalid farm geometry."),wn(!1);return}const en=mr.wkt.replace("POLYGON((","").replace("))","").split(",").map(ii=>ii.trim().split(" ").map(Number)),uo={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[en]}}]},Oi={satellite_sensor:k,indicator:JS[u.trim().toLowerCase()]||u,cloud_cover:50,resample:pt,start_date:fr.toISOString().split("T")[0],end_date:jr.toISOString().split("T")[0],geojson:uo};console.log(" Sending indicator request:",Oi);try{const ti=await(await fetch("http://3.70.245.77:3001/api/indicator/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Oi)})).json();console.log(ti,"products");const $i=((Di=ti==null?void 0:ti.result)==null?void 0:Di.products)||[];if($i.length===0){console.warn(" No indicator frames returned"),wn(!1);return}Dr($i),dr(0);const Zn=$i.map((Ii,ci)=>({id:`indicator-${ci}`,name:Ii.timestamp||`Layer ${ci+1}`,png_url:Ii.png_url,legend_url:Ii.legend_url,bbox:Ii.bounds,visible:!1}));console.log(" Received indicator products:",ti),zr(Zn)}catch(ii){console.error(" Request failed:",ii),alert("Request failed. See console for details.")}finally{wn(!1)}},className:"mt-4 px-3 py-1 bg-green-600 text-white rounded",children:Vr?"Loading...":"Confirm Indicator Request"}),vr.length>0&&Me.jsxs("div",{className:"bg-white text-black rounded p-2 text-sm mt-4 border border-gray-300",children:[Me.jsx("h3",{className:"font-semibold mb-1",children:"See temporal change"}),Me.jsx("input",{type:"range",min:0,max:vr.length-1,value:Zt,onChange:We=>dr(Number(We.target.value)),className:"w-full mt-1"}),Me.jsx("p",{className:"text-xs text-center mt-1",children:((Tn=vr[Zt])==null?void 0:Tn.timestamp)||"No timestamp"})]}),Ar.length>0&&Me.jsxs("div",{className:"mt-4 bg-white text-black rounded p-2 text-sm",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Indicator Layers"}),Me.jsx("div",{className:"max-h-64 overflow-y-auto space-y-3 pr-1",children:Ar.map((We,fr)=>Me.jsxs("div",{className:`border p-2 rounded shadow-sm cursor-pointer ${We.visible?"bg-green-100 border-green-400":"hover:bg-gray-100"}`,onClick:()=>{if(console.log(Ar),!ge)return;const jr=[...Ar],mr={...jr[fr]};mr.visible=!mr.visible,jr[fr]=mr,zr(jr);const en=mr.id;mr.visible?(ge.getLayer(en)&&ge.removeLayer(en),ge.getSource(en)&&ge.removeSource(en),ge.addSource(en,{type:"image",url:mr.png_url,coordinates:[[mr.bbox[0],mr.bbox[3]],[mr.bbox[2],mr.bbox[3]],[mr.bbox[2],mr.bbox[1]],[mr.bbox[0],mr.bbox[1]]]}),ge.addLayer({id:en,type:"raster",source:en,paint:{"raster-opacity":1}}),ge.fitBounds([[mr.bbox[0],mr.bbox[1]],[mr.bbox[2],mr.bbox[3]]],{padding:20}),console.log(" Added layer to map:",en)):(ge.getLayer(en)&&ge.removeLayer(en),ge.getSource(en)&&ge.removeSource(en),console.log(" Removed layer from map:",en))},children:[Me.jsx("p",{className:"font-semibold",children:We.name}),We.png_url&&Me.jsx("img",{src:We.png_url,alt:We.name,className:"w-full h-auto rounded"})]},We.id))})]}),Ar.length>0&&Me.jsxs("div",{className:"mt-4 bg-white text-black rounded p-2 text-sm border border-gray-300",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Available Indicator Layers"}),Me.jsx("ul",{className:"space-y-1 max-h-40 overflow-y-auto",children:Ar.map((We,fr)=>Me.jsxs("li",{className:"flex items-center justify-between",children:[Me.jsx("span",{children:We.name||`Layer ${fr+1}`}),Me.jsx("span",{className:"text-xs text-gray-500",children:We.visible?"Visible":"Hidden"})]},We.id))})]})]}),l==="Crop Details"&&u==="Main Crop Identification"&&Me.jsxs("div",{className:"bg-white text-black rounded p-2 text-sm mt-4 space-y-4",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"My Farms"}),Me.jsx("ul",{className:"space-y-1",children:Object.keys(I).map(We=>Me.jsx("li",{children:Me.jsx("button",{onClick:()=>{o(We),q(We)},className:"w-full text-left hover:underline",children:We})},We))}),Me.jsx("button",{onClick:D,className:"px-3 py-1 bg-white bg-opacity-20 rounded",children:"Upload Region of Interest"}),Me.jsxs("div",{className:"bg-white text-black rounded p-2 text-sm mt-4",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Search Crop Type"}),Me.jsx("ul",{className:"space-y-1",children:["Cotton","Linen","Hemp"].map((We,fr)=>Me.jsx("li",{children:Me.jsx("button",{onClick:()=>console.log("Selected:",We),className:"w-full text-left hover:underline",children:We})},fr))})]}),Me.jsxs("div",{className:"pt-2",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Select Date"}),Me.jsx(zv,{selectRange:!0,maxDate:new Date,onChange:We=>{console.log(" Selected range:",We),Z.current=We}})]}),Me.jsxs("div",{className:"mt-3",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Satellite Sensor"}),Me.jsxs("select",{value:k,onChange:We=>L(We.target.value),className:"w-full border rounded px-2 py-1 bg-white text-black",children:[Me.jsx("option",{value:"sentinel-2",children:"Sentinel-2"}),Me.jsx("option",{value:"landsat",children:"Landsat"}),Me.jsx("option",{value:"naip",children:"NAIP"})]})]}),Me.jsxs("div",{children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Cloud Cover (%)"}),Me.jsx("input",{type:"range",min:"0",max:"100",step:"10",value:50,onChange:()=>{},className:"w-full"}),Me.jsx("div",{className:"text-xs mt-1 text-right",children:"50%"})]}),Me.jsxs("select",{value:pt,onChange:We=>Gt(We.target.value),className:"w-full border px-2 py-1 rounded",children:[Me.jsx("option",{value:"1D",children:"Daily"}),Me.jsx("option",{value:"W",children:"Weekly"}),Me.jsx("option",{value:"MS",children:"Monthly"})]}),Me.jsx("button",{onClick:async()=>{var Di;wn(!0);const We=Z.current;if(!$||!We||!We[0]||!We[1]){alert("Please select a farm and date range."),wn(!1);return}const[fr,jr]=We,mr=I[$];if(!(mr!=null&&mr.wkt)){alert("Invalid farm geometry."),wn(!1);return}const en=mr.wkt.replace("POLYGON((","").replace("))","").split(",").map(ii=>ii.trim().split(" ").map(Number)),uo={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[en]}}]},Oi={satellite_sensor:k,indicator:JS[u.trim().toLowerCase()]||u,cloud_cover:50,resample:pt,start_date:fr.toISOString().split("T")[0],end_date:jr.toISOString().split("T")[0],geojson:uo};console.log(" Sending indicator request:",Oi);try{const ti=await(await fetch("http://3.70.245.77:3001/api/indicator/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Oi)})).json();console.log(ti,"products");const $i=((Di=ti==null?void 0:ti.result)==null?void 0:Di.products)||[];if($i.length===0){console.warn(" No indicator frames returned"),wn(!1);return}Dr($i),dr(0);const Zn=$i.map((Ii,ci)=>({id:`indicator-${ci}`,name:Ii.timestamp||`Layer ${ci+1}`,png_url:Ii.png_url,legend_url:Ii.legend_url,bbox:Ii.bounds,visible:!1,cotton:Ii.cotton_area_ha||0}));console.log(" Received indicator products layers:",Zn),zr(Zn)}catch(ii){console.error(" Request failed:",ii),alert("Request failed. See console for details.")}finally{wn(!1)}},className:"mt-4 px-3 py-1 bg-green-600 text-white rounded",children:Vr?"Loading...":"Confirm Indicator Request"}),Ar.length>0&&Me.jsxs("div",{className:"bg-white text-black rounded p-2 text-sm mt-4 border border-gray-300",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Cotton Area Over Time"}),Me.jsx("div",{className:"w-full overflow-x-auto",children:Me.jsx(I9,{width:"100%",height:300,children:Me.jsxs(DJ,{data:Ar.map(We=>({timestamp:We.name||"No timestamp",cotton:We.cotton||0})),children:[Me.jsx(H3,{strokeDasharray:"3 3"}),Me.jsx($E,{dataKey:"timestamp",angle:-45,textAnchor:"end",interval:0,height:60}),Me.jsx(GE,{label:{value:"Cotton Area (ha)",angle:-90,position:"insideLeft"}}),Me.jsx(y9,{}),Me.jsx(NE,{dataKey:"cotton",fill:"#82ca9d"})]})})})]}),vr.length>0&&Me.jsxs("div",{className:"bg-white text-black rounded p-2 text-sm mt-4 border border-gray-300",children:[Me.jsx("h3",{className:"font-semibold mb-1",children:"See temporal change"}),Me.jsx("input",{type:"range",min:0,max:vr.length-1,value:Zt,onChange:We=>dr(Number(We.target.value)),className:"w-full mt-1"}),Me.jsx("p",{className:"text-xs text-center mt-1",children:((Kt=vr[Zt])==null?void 0:Kt.timestamp)||"No timestamp"})]}),Ar.length>0&&Me.jsxs("div",{className:"mt-4 bg-white text-black rounded p-2 text-sm",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Indicator Layers"}),Me.jsx("div",{className:"max-h-64 overflow-y-auto space-y-3 pr-1",children:Ar.map((We,fr)=>Me.jsxs("div",{className:`border p-2 rounded shadow-sm cursor-pointer ${We.visible?"bg-green-100 border-green-400":"hover:bg-gray-100"}`,onClick:()=>{if(console.log(Ar),!ge)return;const jr=[...Ar],mr={...jr[fr]};mr.visible=!mr.visible,jr[fr]=mr,zr(jr);const en=mr.id;mr.visible?(ge.getLayer(en)&&ge.removeLayer(en),ge.getSource(en)&&ge.removeSource(en),ge.addSource(en,{type:"image",url:mr.png_url,coordinates:[[mr.bbox[0],mr.bbox[3]],[mr.bbox[2],mr.bbox[3]],[mr.bbox[2],mr.bbox[1]],[mr.bbox[0],mr.bbox[1]]]}),ge.addLayer({id:en,type:"raster",source:en,paint:{"raster-opacity":1}}),ge.fitBounds([[mr.bbox[0],mr.bbox[1]],[mr.bbox[2],mr.bbox[3]]],{padding:20}),console.log(" Added layer to map:",en)):(ge.getLayer(en)&&ge.removeLayer(en),ge.getSource(en)&&ge.removeSource(en),console.log(" Removed layer from map:",en))},children:[Me.jsx("p",{className:"font-semibold",children:We.name}),We.png_url&&Me.jsx("img",{src:We.png_url,alt:We.name,className:"w-full h-auto rounded"})]},We.id))})]}),Ar.length>0&&Me.jsxs("div",{className:"mt-4 bg-white text-black rounded p-2 text-sm border border-gray-300",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Available Indicator Layers"}),Me.jsx("ul",{className:"space-y-1 max-h-40 overflow-y-auto",children:Ar.map((We,fr)=>Me.jsxs("li",{className:"flex items-center justify-between",children:[Me.jsx("span",{children:We.name||`Layer ${fr+1}`}),Me.jsx("span",{className:"text-xs text-gray-500",children:We.visible?"Visible":"Hidden"})]},We.id))})]})]}),l==="Crop Details"&&u==="Green Cover Changes"&&Me.jsxs("div",{className:"bg-white text-black rounded p-2 text-sm mt-4 space-y-4",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"My Farms"}),Me.jsx("ul",{className:"space-y-1",children:Object.keys(I).map(We=>Me.jsx("li",{children:Me.jsx("button",{onClick:()=>{o(We),q(We)},className:"w-full text-left hover:underline",children:We})},We))}),Me.jsx("button",{onClick:D,className:"px-3 py-1 bg-white bg-opacity-20 rounded",children:"Upload Region of Interest"}),Me.jsxs("div",{children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Select Year Range"}),Me.jsx(zv,{selectRange:!0,maxDate:new Date,onChange:We=>{console.log(" Green cover year range:",We),Z.current=We}})]}),Me.jsx("button",{className:"w-full mt-3 px-3 py-1 bg-green-600 text-white rounded",onClick:async()=>{var Di,ii;const We=Z.current;if(!$||!We||!We[0]||!We[1]){alert("Please select a farm and year range.");return}const jr=I[$].wkt.replace("POLYGON((","").replace("))","").split(",").map(ti=>ti.trim().split(" ").map(Number)),mr={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[jr]}}]},en=We[0].getFullYear(),uo=We[1].getFullYear(),Oi=[en,uo];for(const ti of Oi)try{const Zn=await(await fetch("http://3.70.245.77:3001/api/landcover/esa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({geojson:mr,year:ti})})).json(),Ii=(ii=(Di=Zn==null?void 0:Zn.tilejson)==null?void 0:Di.tiles)==null?void 0:ii[0],ci=`greencover-${ti}`;if(!Ii){console.warn(`No tile returned for ${ti}`);continue}ge.getLayer(ci)&&ge.removeLayer(ci),ge.getSource(ci)&&ge.removeSource(ci),ge.addSource(ci,{type:"raster",tiles:[Ii],tileSize:256}),ge.addLayer({id:ci,type:"raster",source:ci,paint:{"raster-opacity":.8}}),ge.fitBounds([[Math.min(...jr.map(Co=>Co[0])),Math.min(...jr.map(Co=>Co[1]))],[Math.max(...jr.map(Co=>Co[0])),Math.max(...jr.map(Co=>Co[1]))]],{padding:20}),console.log(` Green cover layer for ${ti} added`)}catch($i){console.error(` Failed to fetch landcover for ${ti}`,$i)}},children:"Compare Green Cover Layers"})]}),l==="Farm Monitoring"&&Me.jsxs("div",{className:"bg-white text-black rounded p-2 text-sm mt-4 space-y-4",children:[Me.jsxs("div",{children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"My Farms"}),Me.jsx("ul",{className:"space-y-1",children:Object.keys(I).map(We=>Me.jsx("li",{children:Me.jsx("button",{onClick:()=>{o(We),q(We)},className:"w-full text-left hover:underline",children:We})},We))})]}),Me.jsx("button",{onClick:D,className:"px-3 py-1 bg-white bg-opacity-20 rounded",children:"Upload Region of Interest"}),u==="Historical Data"&&Me.jsxs("div",{className:"pt-2",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Select Date"}),Me.jsx(zv,{selectRange:!0,maxDate:new Date,onChange:We=>{console.log(" Selected range:",We),Z.current=We}}),Me.jsxs("div",{className:"mt-3",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Select Satellite Provider"}),Me.jsxs("select",{value:k,onChange:We=>L(We.target.value),className:"w-full border rounded px-2 py-1 bg-white text-black",children:[Me.jsx("option",{value:"Sentinel-2A",children:"Sentinel-2A"}),Me.jsx("option",{value:"Planet",children:"Planet"}),Me.jsx("option",{value:"Landsat",children:"Landsat"})]})]}),Me.jsx("button",{onClick:async()=>{var Di;const We=Z.current;if(!$||!We||!We[0]||!We[1]){alert("Please select a farm and a valid date range.");return}const[fr,jr]=We,en=I[$].wkt.replace("POLYGON((","").replace("))","").split(",").map(ii=>ii.trim().split(" ").map(Number)),Oi={geojson:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[en]}}]},start_date:fr.toISOString().split("T")[0],end_date:jr.toISOString().split("T")[0]};console.log(" Sending payload:",Oi);try{const ti=await(await fetch("http://3.70.245.77:3001/api/preview/historical-preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Oi)})).json();console.log(" Server response:",ti);const $i=(Di=ti.thumbnails)==null?void 0:Di.thumbnails;Array.isArray($i)?(xe($i),ge&&$i.forEach((Zn,Ii)=>{if(!Zn.bbox||!Zn.thumbnail_url)return;const ci=`thumb-${Zn.id}`;ge.getSource(ci)&&(ge.removeLayer(ci),ge.removeSource(ci)),ge.getLayer(ci)&&ge.removeLayer(ci),ge.getSource(ci)&&ge.removeSource(ci),ge.addSource(ci,{type:"image",url:Zn.thumbnail_url,coordinates:[[Zn.bbox[0],Zn.bbox[3]],[Zn.bbox[2],Zn.bbox[3]],[Zn.bbox[2],Zn.bbox[1]],[Zn.bbox[0],Zn.bbox[1]]]}),ge.addLayer({id:ci,type:"raster",source:ci,paint:{"raster-opacity":1}}),ge.addLayer({id:ci,type:"raster",source:ci,paint:{"raster-opacity":1}})})):(console.error(" Unexpected thumbnail format:",ti.thumbnails),alert("Error: No valid thumbnails found in response.")),console.log(ti.thumbnails)}catch(ii){console.error(" Request failed:",ii),alert("Failed to fetch historical data.")}},className:"mt-3 px-3 py-1 bg-blue-500 text-white rounded",children:"Confirm Historical Request"}),le.length>0&&Me.jsxs("div",{className:"mt-4 bg-white text-black rounded p-2 text-sm",children:[Me.jsx("h3",{className:"font-semibold mb-2",children:"Available Historical Products"}),Me.jsx("div",{className:"max-h-64 overflow-y-auto space-y-3 pr-1",children:le.map(We=>Me.jsxs("div",{className:`border p-2 rounded shadow-sm cursor-pointer ${ke===We.id?"bg-blue-100 border-blue-400":"hover:bg-gray-100"}`,onClick:()=>{if(!ge||!We.bbox||!We.thumbnail_url)return;const fr=`thumb-${We.id}`;if(ke===We.id){console.log(" Thumbnail already active:",We.id);return}if(ke){const jr=`thumb-${ke}`;ge.getLayer(jr)&&(ge.removeLayer(jr),console.log(" Removed old layer:",jr)),ge.getSource(jr)&&(ge.removeSource(jr),console.log(" Removed old source:",jr))}ge.getLayer(fr)&&ge.removeLayer(fr),ge.getSource(fr)&&ge.removeSource(fr),ge.addSource(fr,{type:"image",url:We.thumbnail_url,coordinates:[[We.bbox[0],We.bbox[3]],[We.bbox[2],We.bbox[3]],[We.bbox[2],We.bbox[1]],[We.bbox[0],We.bbox[1]]]}),ge.addLayer({id:fr,type:"raster",source:fr,paint:{"raster-opacity":1}}),ge.fitBounds([[We.bbox[0],We.bbox[1]],[We.bbox[2],We.bbox[3]]],{padding:20}),et(We.id),console.log(" Activated:",We.id)},children:[Me.jsx("p",{className:"text-sm font-semibold mb-1",children:We.name||`Product ${We.id}`}),We.thumbnail_url&&Me.jsx("img",{src:We.thumbnail_url,alt:We.id,className:"w-full h-auto rounded mb-1"}),Me.jsxs("p",{className:"text-xs text-gray-600",children:["ID: ",We.id]})]},We.id))})]})]})]})]})}function zJ(){const[e,n]=Ae.useState(!1),[l,u]=Ae.useState(null),[y,b]=Ae.useState(null),[I,o]=Ae.useState([]),[D,k]=Ae.useState(!0),[L,$]=Ae.useState([]),q=Ae.useRef(null),[Z,ie]=Ae.useState(null),[oe,le]=Ae.useState(null),[xe,ge]=Ae.useState(!1),[ke,et]=Ae.useState(1.5),[ze,nt]=Ae.useState(null),[pt,Gt]=Ae.useState(null),[ir,Br]=Ae.useState([]),[Zt,dr]=Ae.useState([]),[Dr,vr]=Ae.useState("sentinel-2"),[Ar,zr]=Ae.useState(null),[qr,lr]=Ae.useState(null),[br,Ft]=Ae.useState([]),[ot,St]=Ae.useState(null),[Ur,gn]=Ae.useState("NDVI"),[Sr,kr]=Ae.useState("W"),[Vr,wn]=Ae.useState([]),[Nt,Qr]=Ae.useState(0),[Tn,Kt]=Ae.useState([]),[We,fr]=Ae.useState(!0),[jr,mr]=Ae.useState(!0),[en,uo]=Ae.useState(!1),[Oi,Di]=Ae.useState(null);Ae.useEffect(()=>{if(!Z||Vr.length===0)return;const un=Vr[Nt];if(console.log(un,"frame"),!un)return;const zn=`indicator-${un.timestamp}`;Vr.forEach(An=>{const Nn=`indicator-${An.timestamp}`;Z.getLayer(Nn)&&Z.removeLayer(Nn),Z.getSource(Nn)&&Z.removeSource(Nn)});const[Cn,Fr,Bn,oi]=un.bounds;Z.addSource(zn,{type:"image",url:un.png_url,coordinates:[[Cn,oi],[Bn,oi],[Bn,Fr],[Cn,Fr]]}),Z.addLayer({id:zn,type:"raster",source:zn,paint:{"raster-opacity":.7}}),console.log("indicatorFrames",Vr),Z.fitBounds([[Cn,Fr],[Bn,oi]],{padding:20})},[Z,Vr,Nt]);const[ii,ti]=Ae.useState({"Farm A":{wkt:`POLYGON((
      -93.6500 42.0000,
      -93.6000 42.0000,
      -93.6000 42.0500,
      -93.6500 42.0500,
      -93.6500 42.0000
    ))`,center:[-93.625,42.025]},"Farm B":{wkt:`POLYGON((
      -97.7500 30.2500,
      -97.7000 30.2500,
      -97.7000 30.3000,
      -97.7500 30.3000,
      -97.7500 30.2500
    ))`,center:[-97.725,30.275]},"Farm C":{wkt:`POLYGON((
      -121.8500 37.2500,
      -121.8000 37.2500,
      -121.8000 37.3000,
      -121.8500 37.3000,
      -121.8500 37.2500
    ))`,center:[-121.825,37.275]},"Vidarbha (India)":{wkt:`POLYGON((
      78.06984963147914 20.94241023208771,
      78.06984963147914 20.938613302043947,
      78.07699495818684 20.938613302043947,
      78.07699495818684 20.94241023208771,
      78.06984963147914 20.94241023208771
    ))`,center:[78.0734,20.9405]},"Vehari (Pakistan)":{wkt:`POLYGON((
      72.35101123684856 30.03363958506469,
      72.35101123684856 30.025388200936632,
      72.37034727746854 30.025388200936632,
      72.37034727746854 30.03363958506469,
      72.35101123684856 30.03363958506469
    ))`,center:[72.3607,30.0295]},"Ske (Turkey)":{wkt:`POLYGON((
      27.424776374354934 37.74574178306483,
      27.428599808751244 37.74574178306483,
      27.428599808751244 37.750573765401114,
      27.424776374354934 37.750573765401114,
      27.424776374354934 37.74574178306483
    ))`,center:[27.4267,37.7481]}}),$i=Ae.useRef(null),Zn=(un,zn)=>{ie(un),le(zn),un.getSource("uploaded-geojson")||(un.addSource("uploaded-geojson",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),un.addLayer({id:"uploaded-geojson-layer",type:"fill",source:"uploaded-geojson",paint:{"fill-color":"#888","fill-opacity":.4}})),un.getSource("farm-polygons")||(un.addSource("farm-polygons",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),un.addLayer({id:"farm-polygons-layer",type:"fill",source:"farm-polygons",paint:{"fill-color":"#00ff00","fill-opacity":.3,"fill-outline-color":"#006600"}}),un.addSource("esa-worldcover",{type:"raster",tileSize:256,url:"https://planetarycomputer.microsoft.com/api/data/v1/item/tilejson.json?collection=esa-worldcover&item=ESA_WorldCover_10m_2021_v200_N36W123&assets=map&colormap_name=esa-worldcover&format=png"}),un.addLayer({id:"esa-worldcover-layer",type:"raster",source:"esa-worldcover",paint:{"raster-opacity":.5},layout:{visibility:"none"}}))},Ii=()=>{var un;(un=$i.current)==null||un.click()},ci=async un=>{var Fr;const zn=(Fr=un.target.files)==null?void 0:Fr[0];if(!zn||!Z)return;const Cn=new FormData;Cn.append("file",zn);try{const Bn=await fetch("http://3.70.245.77:3001/api/upload-geojson",{method:"POST",body:Cn}),{geojson:oi}=await Bn.json();Z.getSource("uploaded-geojson").setData(oi);let An=[];oi.features.forEach(Ki=>{const Qe=Ki.geometry;Qe.type==="Polygon"?Qe.coordinates.flat(1).forEach(Q=>An.push(Q)):Qe.type==="MultiPolygon"?Qe.coordinates.flat(2).forEach(Q=>An.push(Q)):Qe.type==="LineString"?Qe.coordinates.forEach(Q=>An.push(Q)):Qe.type==="Point"&&An.push(Qe.coordinates)});const Nn=An.map(Ki=>Ki[0]),Xn=An.map(Ki=>Ki[1]);Z.fitBounds([[Math.min(...Nn),Math.min(...Xn)],[Math.max(...Nn),Math.max(...Xn)]],{padding:20});const ki=[(Math.min(...Nn)+Math.max(...Nn))/2,(Math.min(...Xn)+Math.max(...Xn))/2],Dt=`POLYGON((${An.map(Ki=>`${Ki[0]} ${Ki[1]}`).join(",")}))`,mi=`Uploaded Farm ${Object.keys(ii).length+1}`;ti(Ki=>({...Ki,[mi]:{wkt:Dt,center:ki}}))}catch(Bn){console.error("Upload failed",Bn)}un.target.value=""},Co=async un=>{try{const Cn=await(await fetch("http://3.70.245.77:3001/api/gbif/species",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({geometry:un})})).json();console.log(" GBIF Response:",Cn);const Fr=(Cn==null?void 0:Cn.species)||[];Br(Array.from(new Set(Fr)));const Bn=JD(Cn.geojson);if(u(Bn),Object.keys(Bn).length>0){const Nn=QD(Bn);b(Nn)}if(!Z||!Cn.geojson)return;const oi="gbif-species-layer",An=oi;Z.getLayer(An)&&Z.removeLayer(An),Z.getSource(oi)&&Z.removeSource(oi),Z.hasImage("flora-icon")||Z.loadImage("/flower.png",(Nn,Xn)=>{if(Nn){console.error(" Failed to load flora icon",Nn);return}Z.hasImage("flora-icon")||Z.addImage("flora-icon",Xn,{pixelRatio:2})}),Z.hasImage("fauna-icon")||Z.loadImage("/fauna.png",(Nn,Xn)=>{if(Nn){console.error(" Failed to load fauna icon",Nn);return}Z.hasImage("fauna-icon")||Z.addImage("fauna-icon",Xn,{pixelRatio:2})}),Z.addSource(oi,{type:"geojson",data:Cn.geojson}),Z.addLayer({id:An,type:"symbol",source:oi,layout:{"icon-image":["match",["get","kingdom"],"Plantae","flora-icon","Animalia","fauna-icon","flora-icon"],"icon-size":.1,"icon-allow-overlap":!0,"icon-anchor":"center"}}),Z.on("click",An,Nn=>{const Xn=Nn.features[0].properties;new _p.Popup().setLngLat(Nn.lngLat).setHTML(`<strong>${Xn.name}</strong><br/>Kingdom: ${Xn.kingdom||"Unknown"}`).addTo(Z)}),console.log(" GBIF species added to map")}catch(zn){console.error(" Failed to fetch or render GBIF species:",zn),Br([])}},Ka=async(un,zn)=>{try{const Fr=await(await fetch("http://3.70.245.77:3001/api/ebird/species",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lat:un,lng:zn})})).json(),Bn=Fr.geojson,oi=Fr.speciesList||[];if(o(oi),console.log(" eBird Response:",Bn),!Z)return;const An="ebird-species-layer";Z.getLayer(An)&&Z.removeLayer(An),Z.getSource(An)&&Z.removeSource(An),Z.addSource(An,{type:"geojson",data:Bn}),Z.addLayer({id:An,type:"circle",source:An,paint:{"circle-radius":5,"circle-color":"#ff0080","circle-stroke-width":1,"circle-stroke-color":"#fff"}}),Z.on("click",An,Nn=>{const Xn=Nn.features[0].properties;new _p.Popup().setLngLat(Nn.lngLat).setHTML(`<strong>${Xn.comName}</strong><br/>Count: ${Xn.howMany}<br/>${Xn.locName||""}<br/>Date: ${Xn.obsDt}`).addTo(Z)}),console.log(" eBird species added to map")}catch(Cn){console.error(" Failed to fetch or render eBird species:",Cn)}},oa=async(un,zn)=>{try{const Cn=await fetch("http://3.70.245.77:3001/api/ebird/hotspots",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lat:un,lng:zn})}),{geojson:Fr}=await Cn.json();if(console.log(" Hotspot GeoJSON:",Fr),$(Fr.features.map(Bn=>({locName:Bn.properties.name,lat:Bn.geometry.coordinates[1],lng:Bn.geometry.coordinates[0]}))),Z){Z.getLayer("ebird-hotspots-layer")&&Z.removeLayer("ebird-hotspots-layer"),Z.getSource("ebird-hotspots")&&Z.removeSource("ebird-hotspots"),Z.addSource("ebird-hotspots",{type:"geojson",data:Fr});const Bn=Fr.features.reduce((oi,An)=>{const[Nn,Xn]=An.geometry.coordinates;return oi.extend([Nn,Xn])},new _p.LngLatBounds);Z.fitBounds(Bn,{padding:30}),Z.addLayer({id:"ebird-hotspots-layer",type:"heatmap",source:"ebird-hotspots",paint:{"circle-radius":6,"circle-color":"#ff6600","circle-stroke-width":1,"circle-stroke-color":"#333"}})}}catch(Cn){console.error(" Failed to fetch or add eBird hotspots to map:",Cn)}},ta=async un=>{try{const Cn=await(await fetch("http://3.70.245.77:3001/api/inaturalist/species",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({geometry:un})})).json();dr(Cn.species||[]);const Fr=Cn.geojson;if(console.log(" iNaturalist Response:",Cn),!Z||!Fr)return;const Bn=JD(Fr);if(Object.keys(Bn).length>0){const An=QD(Bn);Di(An)}const oi="inat-species-layer";Z.getLayer(oi)&&Z.removeLayer(oi),Z.getSource(oi)&&Z.removeSource(oi),Z.addSource(oi,{type:"geojson",data:Fr}),Z.addLayer({id:oi,type:"circle",source:oi,paint:{"circle-radius":6,"circle-color":"#1d4ed8","circle-stroke-width":1,"circle-stroke-color":"#fff"}}),Z.on("click",oi,An=>{const Nn=An.features[0].properties;new _p.Popup().setLngLat(An.lngLat).setHTML(`<strong>${Nn.name}</strong><br/>Observer: ${Nn.observer}<br/>Date: ${Nn.date}`).addTo(Z)}),console.log(" iNaturalist species added to map")}catch(zn){console.error(" Failed to fetch or render iNaturalist species:",zn),dr([]),Di(null)}},ho=async un=>{await Promise.all([Co(un),ta(un)])},js=async un=>{var Fr;const zn=ii[un];if(!Z||!zn)return;Z.flyTo({center:zn.center,zoom:16});const Cn=zn.wkt.replace("POLYGON((","").replace("))","").split(",").map(Bn=>Bn.trim().split(" ").map(Number));(Fr=Z.getSource("farm-polygons"))==null||Fr.setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[Cn]},properties:{name:un}}]})},fa=async(un,zn)=>{if(nt(un),Gt(zn),ge(!1),setTimeout(()=>ge(!0),50),un==="Biodiversity Assessment"){const Cn=ii[Ar];if(!Cn)return;const Fr=Cn.center,Bn=Cn.wkt;zn==="Species Observation Log"?await ho(Bn):zn==="Bird Species Data"?await Ka(Fr[1],Fr[0]):zn==="Biodiv. Hotspot Viewer"&&await oa(Fr[1],Fr[0])}},pa=un=>{var Xn;if(console.log(un.features),!un||!un.features||un.features.length===0)return;const zn=un.features[0];if(!zn||zn.geometry.type!=="Polygon")return;const Cn=(Xn=zn.geometry.coordinates)==null?void 0:Xn[0];if(!Cn)return;const Fr=Cn.map(ki=>ki[0]),Bn=Cn.map(ki=>ki[1]),oi=[(Math.min(...Fr)+Math.max(...Fr))/2,(Math.min(...Bn)+Math.max(...Bn))/2],An=`POLYGON((${Cn.map(ki=>`${ki[0]} ${ki[1]}`).join(",")}))`,Nn=`Drawn Farm ${Object.keys(ii).length+1}`;console.log(Nn),ti(ki=>({...ki,[Nn]:{wkt:An,center:oi}}))};return Me.jsxs("div",{className:"flex h-full overflow-hidden font-body",children:[Me.jsx(kJ,{onSelect:fa}),Me.jsxs("div",{className:"relative flex-1 bg-black overflow-hidden",children:[Me.jsx(RJ,{zoom:ke,onZoom:et,onUploadClick:Ii}),Me.jsx("input",{type:"file",accept:".geojson,application/geo+json",ref:$i,onChange:ci,className:"hidden"}),Me.jsx(N5,{zoom:ke,onMapReady:Zn,onDrawCreate:pa,onDrawUpdate:()=>{},onDrawDelete:()=>{},onMapClick:()=>{}}),en&&Me.jsxs("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 p-3 rounded shadow text-xs z-50",children:[Me.jsx("h4",{className:"font-semibold mb-2",children:"ESA Landcover Legend"}),Me.jsx("table",{className:"table-auto text-left",children:Me.jsx("tbody",{children:[{label:"Tree cover",color:"rgb(0, 100, 0)"},{label:"Shrubland",color:"rgb(255, 187, 34)"},{label:"Grassland",color:"rgb(255, 255, 76)"},{label:"Cropland",color:"rgb(240, 150, 255)"},{label:"Built-up",color:"rgb(250, 0, 0)"},{label:"Bare / sparse vegetation",color:"rgb(180, 180, 180)"},{label:"Snow and ice",color:"rgb(240, 240, 240)"},{label:"Permanent water bodies",color:"rgb(0, 100, 200)"},{label:"Herbaceous wetland",color:"rgb(0, 150, 160)"},{label:"Mangroves",color:"rgb(0, 207, 117)"},{label:"Moss and lichen",color:"rgb(250, 230, 160)"}].map((un,zn)=>Me.jsxs("tr",{children:[Me.jsx("td",{children:Me.jsx("div",{className:"w-4 h-4 mr-2 rounded",style:{backgroundColor:un.color}})}),Me.jsx("td",{className:"pl-2",children:un.label})]},zn))})})]}),(()=>{const un=Tn.some(Fr=>Fr.visible),zn=Vr.length>0,Cn=Vr[Nt];return un&&zn&&Cn?Me.jsxs("div",{className:"absolute bottom-24 left-4 bg-white bg-opacity-90 p-3 rounded shadow text-xs z-50",children:[Me.jsx("h4",{className:"font-semibold mb-2",children:"Indicator Legend"}),Me.jsx("img",{src:Cn.legend_url,alt:"Indicator Legend",className:"max-w-[180px] max-h-[50px] object-contain"})]}):null})(),Me.jsx(LJ,{open:xe,onClose:()=>ge(!1),section:ze,item:pt,gbifSpecies:ir,inatSpecies:Zt,farms:ii,onFarmSelect:js,onUploadClick:Ii,satProvider:Dr,setSatProvider:vr,selectedFarm:Ar,setSelectedFarm:zr,selectedRangeRef:q,selectedGHG:qr,setSelectedGHG:lr,thumbnails:br,setThumbnails:Ft,mapInstance:Z,activeThumbnailId:ot,setActiveThumbnailId:St,ebirdSpecies:I,ebirdHotspots:L,resample:Sr,setResample:kr,selectedIndicator:Ur,setSelectedIndicator:gn,currentFrameIndex:Nt,setCurrentFrameIndex:Qr,indicatorFrames:Vr,setIndicatorFrames:wn,indicatorLayers:Tn,setIndicatorLayers:Kt,hotspotVisible:D,setHotspotVisible:k,gbifVisible:We,setGbifVisible:fr,inatVisible:jr,setInatVisible:mr,esaVisible:en,setEsaVisible:uo,diversityMetrics:y,inatDiversityMetrics:Oi,isLoading:e,setIsLoading:n}),e&&Me.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:Me.jsx("div",{className:"h-24 w-24 rounded-full animate-spin border-8 border-t-8 border-b-8 border-white border-t-green-400 border-b-blue-400"})})]})]})}yj.createRoot(document.getElementById("root")).render(Me.jsx(dj.StrictMode,{children:Me.jsx(zJ,{})}));
